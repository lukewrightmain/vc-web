define(["require","exports","./c_tslib","./e_edison","./e_ui_page_files_router","./c_api_v2_noauth_client","./c_core_i18n","./c_core_uri","./c_previews_util","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_confirmation_modals_reset_access_modal","./c_ui_flag","./c_sharing_share_page_action_types","./c_components_form_validation_message","./c_src_utils_logging","./c_sharing_ui_util","./c_sharing_ui_notifications_util","./e_core_exception","./c_contacts_contact_token_state","./c_core_exception_info","./c_lodash-es_lodash","./c_share_modal_evolution_utils_logging","./c_ui-icon_line_send","./c_ui-icon_line_video","./c_core_browser_detection","./c_flows_logging_flows_loggers","./c_integrations_hellosign_deep_integration_launcher","./c_flows_utils_async_modal_launchers","./c_integrations_data_selectors","./c_docsend_analytics_add_on_data_apiUtils","./c_docsend_src_utils","./c_sharing_upsells_util","./c_flux_store_listener","./c_sharing_gating_util","./c_tabs_index","./c_components_sharing_modal_banner","./c_sharing_settings_utils_sharing_settings_util","./c_sharing_content_manager","metaserver/static/js/modules/constants/trademark","./c_controls_index","./c_browse_tts","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_spectrum_colorized_icon","./c_clipboard_v3","./c_core_notify","./c_spectrum_modal_utility_modal","./c_src_sink_index","./c_ui_bubble_dropdown_v2","./c_components_auto-folder-setup-checkbox_index","./c_icon_file_icon","./c_icon_icon_helper","./c_avatar_initials_avatar","./c_avatar_size","./c_ui_title_bubble","./c_spectrum_avatar_avatar_initials","./c_spectrum_avatar_avatar_color_util","./c_prop-types_index","./c_spectrum_tooltip","./c_spectrum_dropdown_button","./c_components_icons_icon_dropdown_selected","./c_integrations_profile_card_popover","./c_resize-observer-polyfill_dist_ResizeObserver","./c_ui_overlay","./c_spectrum_culled_list","metaserver/static/js/modules/constants/login_and_register","./c_ui-icon_line_link","./c_components_sharing_spinner","./c_components_approval-forms_approval_checkbox_in_share","./c_flows_redux_selectors","./c_flows_redux_store"],(function(e,t,s,n,i,a,r,o,l,c,d,h,p,m,u,g,f,_,E,S,M,k,b,v,C,y,w,I,T,A,L,R,N,x,P,F,O,D,$,B,U,H,V,G,W,K,z,j,q,Y,Z,Q,J,X,ee,te,se,ne,ie,ae,re,oe,le,ce,de,he,pe,me,ue,ge,fe){"use strict";const _e=/['&A-Za-z0-9\._%+-]+@[A-Za-z0-9-][A-Za-z0-9\.-]*\.[A-Za-z]{2,15}/gi,Ee=/[,|;>]+/;class Se extends n.react.exports.Component{constructor(e){super(e),this.ref=null,this.setRef=e=>{this.ref&&this.ro.unobserve(this.ref),this.ref=e,this.ref&&this.ro.observe(this.ref)},this.onResize=e=>{e.length>0&&this.props.onResize(e[0].contentRect)},this.ro=new le.index(this.onResize)}componentWillUnmount(){this.ref&&this.ro.unobserve(this.ref)}render(){return n.react.exports.createElement("div",{ref:this.setRef},this.props.children)}}Se.displayName="Resize";const Me="above";class ke extends n.react.exports.Component{constructor(e){super(e),this.id=M.uniqueId("integration_popover_"),this.resolvePortalPosition=()=>{if(this.portalInstance&&this.wrapperElementRef){const e=this.wrapperElementRef.childElementCount<2&&this.wrapperElementRef.firstElementChild||this.wrapperElementRef,{positioning:t=(()=>Me),positionOffset:s=0}=this.props,n=this.portalInstance.portalContentElementRef;let i={top:0,left:0};const a=e.getBoundingClientRect(),r=n.getBoundingClientRect();switch(t(this)){case"below":i={top:a.top+a.height+s,left:a.left+a.width/2-r.width/2};break;case"below_left":i={top:a.top+a.height+s,left:a.left+a.width-r.width};break;case"below_right":i={top:a.top+a.height+s,left:a.left};break;case"left":i={top:Math.min(a.top+a.height/2-r.height/2,document.documentElement.clientHeight-r.height-160),left:a.left-r.width-s};break;case"right":i={top:Math.min(a.top+a.height/2-r.height/2,document.documentElement.clientHeight-r.height-160),left:a.left+a.width+s};break;case"above":i={top:a.top-r.height-s,left:a.left+a.width/2-r.width/2}}this.portalInstance.portalContentElementRef.style.top=i.top+"px",this.portalInstance.portalContentElementRef.style.left=i.left+"px"}},this.handleMouseOverTrigger=this.handleMouseOverTrigger.bind(this),this.handleMouseOut=this.handleMouseOut.bind(this),this.handleOnFocus=this.handleOnFocus.bind(this),this.handleOnBlur=this.handleOnBlur.bind(this),this.handleClick=this.handleClick.bind(this),this.handleClickTrigger=this.handleClickTrigger.bind(this),this.closePortal=this.closePortal.bind(this),this.handleKeyEvent=this.handleKeyEvent.bind(this),this.handleScrollEvent=this.handleScrollEvent.bind(this),this.handleOnClickContent=this.handleOnClickContent.bind(this),this.hasInitiallyShown=!1,this.state={isShown:!!e.isShowInitially}}componentDidMount(){this.props.isShowInitially&&this.showPortal()}componentDidUpdate(){!this.hasInitiallyShown&&this.props.isShowInitially||this.state.isShown&&this.portalInstance?(this.mountListeners(),this.props.onWillShow&&this.props.onWillShow(this),this.portalInstance.mountPortal((()=>{this.props.onDidShow&&this.props.onDidShow(this),this.resolvePortalPosition()}))):this.portalInstance&&(this.unMountListeners(),this.props.onWillClose&&this.props.onWillClose(this),this.portalInstance.unMountPortal(),this.wrapperElementRef=null)}componentWillUnmount(){this.portalInstance&&this.portalInstance.unMountPortal(),this.unMountListeners()}mountListeners(){document.addEventListener("keydown",this.handleKeyEvent,!0),document.addEventListener("scroll",this.handleScrollEvent,!1),document.addEventListener("click",this.handleOnClickContent,!0)}unMountListeners(){document.removeEventListener("keydown",this.handleKeyEvent,!0),document.removeEventListener("scroll",this.handleScrollEvent,!1),document.removeEventListener("click",this.handleOnClickContent,!0)}handleOnFocus(e){this.showPortal()}handleOnBlur(e){}handleMouseOverTrigger(e){this.props.onMouseOverTrigger&&this.props.onMouseOverTrigger(e,this),this.showPortal()}handleMouseOut(e){this.props.shouldCloseOnMouseMoveOutTrigger&&this.props.shouldCloseOnMouseMoveOutTrigger(this)&&this.hidePortal()}handleClick(e){e.stopPropagation()}handleClickTrigger(e){this.props.onClickTrigger&&this.props.onClickTrigger(e,this),this.showPortal()}handleKeyEvent(e){if(this.state.isShown){const t=e.key;t===i.Key_enum.Key.Escape&&(this.closePortal(),this.props.onClickOutsideContent&&this.props.onClickOutsideContent(this),e.stopPropagation()),t!==i.Key_enum.Key.ArrowUp&&t!==i.Key_enum.Key.ArrowDown&&t!==i.Key_enum.Key.ArrowLeft&&t!==i.Key_enum.Key.ArrowRight||e.stopPropagation(),t===i.Key_enum.Key.Tab&&this.handleMouseOut()}}handleScrollEvent(){this.state.isShown&&this.resolvePortalPosition()}handleOnClickContent(e){this.contentElementRef&&this.contentElementRef.contains(e.target)||(this.props.onClickOutsideContent&&this.props.onClickOutsideContent(this),this.closePortal())}closePortal(){this.hidePortal(),this.props.onDidClose&&this.props.onDidClose(this)}showPortal(){this.setState({isShown:!0})}hidePortal(){this.props.isShowInitially&&!this.hasInitiallyShown&&(this.hasInitiallyShown=!0),this.setState({isShown:!1})}render(){const e=this.props.renderContent&&this.props.renderContent()||null;return n.react.exports.createElement("div",{"aria-describedby":this.props.id,onMouseLeave:this.handleMouseOut,onFocusCapture:this.handleOnFocus,onBlur:this.handleOnBlur,onClick:this.handleClick,className:this.props.wrapperClassName?this.props.wrapperClassName:"mc-positioned-portal-wrapper",ref:e=>this.wrapperElementRef=e,id:this.id},n.react.exports.createElement(ie.Portal,{ref:e=>this.portalInstance=e,className:"mc-positioned-portal-content",parentElement:this.props.portalParentElement||document.querySelector(`div#${this.id}`)},n.react.exports.createElement("div",{ref:e=>this.contentElementRef=e},this.props.autoRePosition?n.react.exports.createElement(Se,{onResize:this.resolvePortalPosition},e):e)),n.react.exports.createElement("div",{onMouseOver:this.handleMouseOverTrigger,onClick:this.handleClickTrigger},this.props.children))}}ke.displayName="IntegrationPopover";class be{constructor(){var e;this.onClickTrigger=()=>{this.clicked=!0},this.onClickOutsideContent=()=>{this.clicked=!1},this.shouldCloseOnMouseMoveOutTrigger=()=>!this.clicked,this.onDidShow=e=>{this.showingPortal&&this.showingPortal!==e&&this.showingPortal.closePortal(),this.showingPortal=e},this.onWillClose=e=>{this.showingPortal===e&&(this.showingPortal=null)},this.popover=(e=this,class extends n.react.exports.Component{constructor(){super(...arguments),this.openProfileCard=()=>{this.popoverRef&&(e.clicked=!0,this.popoverRef.showPortal())}}render(){const{upsellContent:t,profileCard:s,positioning:i,upsellPositioning:a,wrapperClassName:r,isShowInitially:o,children:l,positionOffset:c,portalParentElement:d,onClickTrigger:h,onMouseOverTrigger:p,autoRePosition:m}=this.props;return n.react.exports.createElement(ke,{ref:e=>this.popoverRef=e,renderContent:()=>e.clicked?s:t,onClickTrigger:(t,s)=>{e.onClickTrigger(s),h&&h(t)},onClickOutsideContent:e.onClickOutsideContent,onMouseOverTrigger:e=>{p&&p(e)},shouldCloseOnMouseMoveOutTrigger:e.shouldCloseOnMouseMoveOutTrigger,onDidShow:e.onDidShow,onWillClose:e.onWillClose,positioning:()=>!e.clicked&&a?a:i||Me,wrapperClassName:r,isShowInitially:o,positionOffset:c,portalParentElement:d,autoRePosition:m},l)}})}closePortal(){this.showingPortal&&(this.showingPortal.closePortal(),this.clicked=!1)}}const ve={shared_folder_member_policy:"team",shared_folder_link_restriction_policy:"members"},Ce={member_policy:"shared_folder_member_policy",shared_link_policy:"shared_folder_link_restriction_policy"};function ye(e){switch(e){case"restricted_by_parent_folder":return r.intl.formatMessage({id:"98DfV5",defaultMessage:"This setting is turned off for all files in this folder."});case"restricted_by_team":return r.intl.formatMessage({id:"AGa70V",defaultMessage:"Your admin has disabled this setting."});default:return}}function we(e,t){let s;return s=t instanceof i.FilePolicy?new i.FilePolicy:t instanceof i.FolderPolicy?new i.FolderPolicy:new i.LinkPolicy,e.keySeq().toArray().map((n=>{const i=e.get(n),a=t.get(n);("object"==typeof i?M.isEqual(i,a):i===a)||(s=s.set(n,i))})),s}function Ie(e,t,s,n,i,a){let r;const o=Ce[e];null!=o&&null!=i&&(r=i.get(o));let l=null!=(null!=t?t.get(e):void 0)?null!=t?t.get(e):void 0:s.get(e),c=null!=a.change_options&&a.change_options.allow;return null!=r&&ve[o]===r&&(c=!1,l=r),function(e){return-1!==[m.VIEWER_INFO_POLICY].indexOf(e)}(e)&&(c=function(e,t,s,n){return e===m.VIEWER_INFO_POLICY&&!n&&!!s&&(t&&"enabled"===t.get(m.VIEWER_INFO_POLICY)?!!s.disable_viewer_info&&s.disable_viewer_info.allow:!!s.enable_viewer_info&&s.enable_viewer_info.allow)}(e,s,a,n)),n&&(c=!1),[l,c]}const Te=O.SharingSettingsUtil(r.intl),Ae=e=>new i.LinkPolicy(Te.getLinkPolicy(e)),Le=(e,t,s)=>{const n=Te.getModifiedSettings(e,t,s);if(n)return n.error?(f.sharingNotificationError(n.error),null):{url:n.url,settings:n.settings,remove_expiration:n.remove_expiration}};function Re(e,t){return!!t&&t.some((t=>e===t.seen_state_user.user_id))}const Ne=new j.EventEmitter,xe={emit(e,t){Ne.emit(e,t)},on:(e,t)=>Ne.on(e,t),removeListener:(e,t)=>Ne.removeListener(e,t),removeAllListeners(){Ne.removeAllListeners()},eventNames:()=>Ne.eventNames()};var Pe=Object.freeze({__proto__:null,ActionsAdapter:xe});const Fe="confirm-with-option-modal";var Oe=function(e){if("string"==typeof e)return e;if("string"==typeof e.props)return e.props;if(e.props.text)return e.props.text;const t=[];return n.React$1.Children.forEach(e.props.children,(e=>t.push(Oe(e)))),t.join("")};const De=(e,t)=>new Promise((function(s,n){return e.setState(t,s)}));class $e extends n.React$1.Component{render(){const e=r.intl.formatMessage({id:"jxjvN9",defaultMessage:"We’ll let the owner know whenever you change these settings"});return n.React$1.createElement(F.SharingModalBanner,{className:this.props.isInSharingSettingsModal?"sharing-settings-modal__banner":void 0,type:"dark",message:e})}}$e.displayName="InformOwnerUpdateSection";i.injectInternalStyle("metaserver/static/js/sharing/views/sharing_settings_policy_view.module.out.css",(e=>"._sharing-settings-modal__toggle_v7upp_1{align-items:center;display:flex;justify-content:flex-end;line-height:24px}._sharing-settings-modal__toggle_v7upp_1 ._sharing-settings-modal__toggle_input_wrapper_v7upp_7{margin-left:var(--spacing__base_unit)}._sharing-settings-modal__toggle_v7upp_1 ._sharing-settings-modal-toggle-label_v7upp_10._toggle-disabled_v7upp_10{color:var(--color__disabled__text)}"));const Be="_sharing-settings-modal__toggle_v7upp_1",Ue="_sharing-settings-modal__toggle_input_wrapper_v7upp_7",He="_sharing-settings-modal-toggle-label_v7upp_10",Ve="_toggle-disabled_v7upp_10";class Ge extends n.React$1.Component{constructor(e){super(e),this.sharingModalSettingsRowLinkClicked=e=>{window.open(e,"_blank")},this.renderPolicyRow=(e,t,s,i,a)=>n.React$1.createElement(m.SharingModalSettingsRow,{policyFieldName:e,key:t.title,displayName:t.title,displayNameTitle:t.title,description:t.description,descriptionLinkUrl:t.descriptionLinkUrl,descriptionLinkText:t.descriptionLinkText,descriptionLinkOnClicked:this.sharingModalSettingsRowLinkClicked,rightSideElement:i,bottomElement:a})}renderDropdown(e,t,s,i,a,r){return n.React$1.createElement(m.SettingDropdown,{currentValue:t,valuesList:i,optionsDict:s,onValueSelected:a,disabled:r})}renderToggle(e,t,s,a,o){const l=o?(e,t)=>{}:a,c=i.classnames(He,{[Ve]:o}),d=r.intl.formatMessage({id:"HveuHT",defaultMessage:"Policy toggle"});return n.React$1.createElement("div",{className:Be},n.React$1.createElement(i.Text,{tagName:"label",htmlFor:`${e}_toggle`,className:c},s[t].label),n.React$1.createElement(B.Toggle,{className:Ue,"aria-label":d,id:`${e}_toggle`,checked:s[t].value,disabled:o,onChange:e=>{l(e.currentTarget.checked,e)}}))}}Ge.displayName="SharingSettingsPolicyView";class We extends Ge{render(){return this.renderPolicies()}renderPolicies(){const e=this.props.policies.map((e=>{const t=this.getPolicyDict(e);return this.renderPolicy(e,t)}));return n.React$1.createElement("div",null,e)}renderPolicy(e,t){let s,n,i;[s,n]=Ie(e,this.props.policyUpdate,this.props.currentPolicy,this.props.showContentManagerBridge,this.props.teamPolicy,this.props.permissions);const a=Object.keys(t.optionsDict);if(s&&!a.includes(s))throw new Error(`Invalid Policy: ${s}`);if(t.type===m.DROPDOWN){const r=t=>{this.props.onPolicyUpdate(e,t)};i=this.renderDropdown(e,s,t.optionsDict,a,r,!n)}else if(t.type===m.TOGGLE){const r=(s,n)=>{for(const n of a){t.optionsDict[n].value===s&&this.props.onPolicyUpdate(e,n)}};i=this.renderToggle(e,s,t.optionsDict,r,!n)}return this.renderPolicyRow(e,t,n,i)}isTeamMemberFolder(){return!this.isTeamFolderTree()&&this.props.ownerTeam}isTeamFolderTree(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree}getMemberPolicyQuestion(){return this.isTeamFolderTree()?r.intl.formatMessage({id:"+JxbQ8",defaultMessage:"Limit who can be added as a member of folders."}):r.intl.formatMessage({id:"lUdY7W",defaultMessage:"Limit who can be added as a member of this folder."})}getAclUpdatePolicyQuestion(){return this.isTeamFolderTree()?r.intl.formatMessage({id:"8eiYiI",defaultMessage:"Choose who can add people to folders."}):r.intl.formatMessage({id:"d2BniZ",defaultMessage:"Choose who can add people to this folder."})}getViewerInfoPolicyDescription(){return this.props.ownerTeam?this.props.isFolder?r.intl.formatMessage({id:"9Ihzjr",defaultMessage:"Show who viewed files in this folder to team members and people who can edit."}):r.intl.formatMessage({id:"pPFsa4",defaultMessage:"Show who viewed this file to team members and people who can edit."}):this.props.isFolder?r.intl.formatMessage({id:"FquCbz",defaultMessage:"Show who’s viewing files in this folder to people who can edit."}):r.intl.formatMessage({id:"VloA8O",defaultMessage:"Show who’s viewing this file to people who can edit."})}getPolicyDict(e){switch(e){case m.MEMBER_POLICY:return{title:r.intl.formatMessage({id:"Z0CQak",defaultMessage:"Folder membership"}),description:this.getMemberPolicyQuestion(),optionsDict:{anyone:{label:r.intl.formatMessage({id:"m1ZBqW",defaultMessage:"Anyone"})},team:{label:r.intl.formatMessage({id:"flkJcx",defaultMessage:"Only team members"})}},type:m.DROPDOWN};case m.ACL_UPDATE_POLICY:return{title:r.intl.formatMessage({id:"qG3VMJ",defaultMessage:"Manage access"}),description:this.getAclUpdatePolicyQuestion(),optionsDict:{editors:{label:this.isTeamFolderTree()||this.isTeamMemberFolder()?r.intl.formatMessage({id:"KBoyON",defaultMessage:"Team members who can edit"}):r.intl.formatMessage({id:"CyxyyA",defaultMessage:"Folder members"}),description:this.isTeamFolderTree()||this.isTeamMemberFolder()?r.intl.formatMessage({id:"rY7b9W",defaultMessage:"Team members with edit access can add people."}):r.intl.formatMessage({id:"U8/o8J",defaultMessage:"Members with edit access can add people."})},owner:{label:this.isTeamFolderTree()?r.intl.formatMessage({id:"FRQa4i",defaultMessage:"Only Team Admins"}):r.intl.formatMessage({id:"svCMOP",defaultMessage:"Only the owner"}),description:this.isTeamFolderTree()?r.intl.formatMessage({id:"kmb+og",defaultMessage:"Only Team Admins."}):r.intl.formatMessage({id:"mNi7Xx",defaultMessage:"Only the owner can add people."})}},type:m.DROPDOWN};case m.VIEWER_INFO_POLICY:return{title:r.intl.formatMessage({id:"OFgJ+q",defaultMessage:"Viewer info"}),description:this.getViewerInfoPolicyDescription(),optionsDict:{enabled:{label:r.intl.formatMessage({id:"4ASaZl",defaultMessage:"On"}),value:!0},disabled:{label:r.intl.formatMessage({id:"495asM",defaultMessage:"Off"}),value:!1}},type:m.TOGGLE};case m.FOLDER_LINK_AUDIENCE_POLICY:if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");return"team"===this.props.currentPolicy[m.FOLDER_LINK_AUDIENCE_POLICY]?this.renderFolderLinkPolicyDropdown():{title:r.intl.formatMessage({id:"dpUA0F",defaultMessage:"Link restrictions"}),description:r.intl.formatMessage({id:"ZnIqIh",defaultMessage:"Prevent non-members from accessing this folder via link."}),optionsDict:{members:{label:r.intl.formatMessage({id:"4ASaZl",defaultMessage:"On"}),value:!0},anyone:{label:r.intl.formatMessage({id:"495asM",defaultMessage:"Off"}),value:!1}},type:m.TOGGLE};default:throw new Error("Policy name not found")}}renderFolderLinkPolicyDropdown(){if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");return{title:r.intl.formatMessage({id:"dpUA0F",defaultMessage:"Link restrictions"}),description:r.intl.formatMessage({id:"W3KUO0",defaultMessage:"Limits who can access this folder via a link."}),optionsDict:{anyone:{label:r.intl.formatMessage({id:"xkdOhD",defaultMessage:"No restrictions"}),description:r.intl.formatMessage({id:"cLesiI",defaultMessage:"Show all access options for links."})},members:{label:r.intl.formatMessage({id:"Tj12s5",defaultMessage:"Invite-only"}),description:r.intl.formatMessage({id:"02i0Sa",defaultMessage:"Show “Only invited members” only."})},team:{label:r.intl.formatMessage({id:"axkOyT",defaultMessage:"Team only"}),description:r.intl.formatMessage({id:"chneWK",defaultMessage:"Show “Only people at {team_name}”."},{team_name:i.Emstring.em_snippet(this.props.ownerTeam.name,12)})}},type:m.DROPDOWN}}}const Ke=e=>{window.open(e,"_blank")};class ze extends n.React$1.Component{constructor(){super(...arguments),this.getPolicyDict=e=>this.props.getPolicyDict(e,this.props.isFolder),this.renderCannotPreviewBanner=()=>{if(!function(e,t){if(!e)return!1;if(null!=(null!=t?t.preview_type:void 0)){const{preview_type:e}=t;if(Array.from(l.VALID_PREVIEW_TYPES).includes(e))return!1}return!0}(!this.props.isFolder,this.props.linkMetadata))return;const e=i.file_extension(this.props.linkMetadata.name).toUpperCase();return n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:r.intl.formatMessage({id:"7E5yD4",defaultMessage:"{file_extension} files can’t be previewed. Downloads must be enabled to share."},{file_extension:`.${e}`})})},this.handleMultiplePolicyUpdate=e=>{const t=this.props.linkPolicy.merge(e);this.props.onPolicyUpdate(this.props.linkMetadata,t)},this.handlePolicyUpdate=(e,t)=>{const s=this.props.linkPolicy.set(e,t);this.props.onPolicyUpdate(this.props.linkMetadata,s)}}render(){const e=this.props.readOnlyPolicy;return n.React$1.createElement("div",null,n.React$1.createElement(m.SharingSettingsAudience,{intl:r.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),n.React$1.createElement(m.SharingSettingsExpire,{intl:r.intl,linkMetadata:this.props.linkMetadata,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),n.React$1.createElement(m.SharingSettingsDownload,{intl:r.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handlePolicyUpdate,onLinkClicked:Ke,banner:this.renderCannotPreviewBanner(),readOnlyPolicy:e,isEditFolderLink:!1}))}}ze.displayName="SharingSettingsLinkPolicyView";const je=m.SharingSettingsLinkPolicies(r.intl),qe=je.getShmodelInMultipleLinksPolicyDict,Ye=je.getRLPolicyDict,Ze=e=>{window.open(e,"_blank")};class Qe extends n.React$1.Component{constructor(){super(...arguments),this.getPolicyDict=e=>{const{link_permissions:t}=this.props.linkMetadata;return Ye(e,t.link_access_level,this.props.linkMetadata.isFolder())},this.handleMultiplePolicyUpdate=e=>{const t=this.props.linkPolicy.merge(e);this.props.onPolicyUpdate(this.props.linkMetadata,t)},this.handlePolicyUpdate=(e,t)=>{const s=this.props.linkPolicy.set(e,t);this.props.onPolicyUpdate(this.props.linkMetadata,s)}}render(){const e=this.props.readOnlyPolicy;return n.React$1.createElement("div",null,n.React$1.createElement(m.SharingSettingsAudience,{intl:r.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),n.React$1.createElement(m.SharingSettingsExpire,{intl:r.intl,linkMetadata:this.props.linkMetadata,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),n.React$1.createElement(m.SharingSettingsPassword,{intl:r.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),n.React$1.createElement(m.SharingSettingsDownload,{intl:r.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handlePolicyUpdate,onLinkClicked:Ze,readOnlyPolicy:e,isEditFolderLink:this.props.linkMetadata.isFolder(),banner:n.React$1.createElement(m.DisableDownloadsBanner,{intl:r.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy})}))}}Qe.displayName="SharingSettingsRighteousLinkPolicyView";const Je="scl-sharing-modal-footer-link";class Xe extends n.react.exports.PureComponent{render(){const e=i.classnames(Je,this.props.className);return n.react.exports.createElement("div",{className:e},!0!==this.props.isIconHidden&&n.react.exports.createElement("div",{className:`${Je}__icon`},this.props.icon?this.props.icon:n.react.exports.createElement(m.IconLink,null)),n.react.exports.createElement("div",{className:`${Je}__body`},this.props.body),n.react.exports.createElement("div",{className:`${Je}__actions`},this.props.actions))}}Xe.displayName="SharingModalFooterLink";const et=e=>n.react.exports.createElement(Xe,{className:e.className,icon:e.icon,body:e.statusNoLinkCreated,actions:n.react.exports.createElement(i.Button$1,{variant:"borderless",onClick:e.onClickButtonCreateLink},e.textButtonCreateLink)}),tt=function(e){const t=i.classnames(Je,`${Je}--copy`,e.className);return n.react.exports.createElement(Xe,{className:t,icon:e.icon?e.icon:n.react.exports.createElement(m.IconLink,{variant:"active"}),isIconHidden:e.isIconHidden,body:n.react.exports.createElement("input",Object.assign({readOnly:!0,autoFocus:!0,value:e.sharedLinkUrl,onClick:st,onFocus:st,"aria-label":e.labelSharedLinkUrl},e.inputProps)),actions:n.react.exports.createElement(i.Button$1,{variant:"borderless",onClick:e.onClickButton},e.textButton)})};tt.displayName="SharingModalFooterLinkCopy";const st=e=>{e.currentTarget.select()},nt=JSON.parse('\n    {"link-edit":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M19.9 9.17l1.377-1.377a1 1 0 0 1 1.415 0l1.364 1.364a1 1 0 0 1 0 1.414l-1.377 1.377L19.9 9.17zM9.653 19.415l9.193-9.192 2.779 2.779-9.193 9.192-2.779-2.779zM8.6 20.441l2.778 2.779-3.219 1.073a.5.5 0 0 1-.632-.633L8.6 20.441z\\" fill=\\"#000\\"></path>"},"link-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><path d=\\"M5 12c0-1.657 1.347-3 2.997-3h3.006A3 3 0 0 1 14 12v3H7.997A3 3 0 0 1 5 12zm1.5 0c0 .834.672 1.5 1.5 1.5h1.5V15H14v-2.5h-1.5v-.505c0-.818-.67-1.495-1.499-1.495H8c-.834 0-1.499.672-1.499 1.5z\\" fill=\\"#637282\\"></path><path d=\\"M19 12c0 1.657-1.347 3-2.997 3h-3.006A3 3 0 0 1 10 12V9h6.003A3 3 0 0 1 19 12zm-1.5 0c0-.834-.672-1.5-1.5-1.5h-1.5V9H10v2.5h1.5v.505c0 .818.67 1.495 1.499 1.495H16c.834 0 1.499-.672 1.499-1.5z\\" fill=\\"#637282\\"></path></g>"},"link-view":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M16 22c3.524 0 6.612-2.572 8.324-4.348a2.354 2.354 0 0 0 0-3.304C22.612 12.572 19.524 10 16 10s-6.612 2.572-8.324 4.348a2.354 2.354 0 0 0 0 3.304C9.388 19.428 12.476 22 16 22zm0-2c2.153 0 3.899-1.79 3.899-4S18.153 12 16 12s-3.899 1.79-3.899 4 1.746 4 3.899 4z\\" fill=\\"#000\\"></path><path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M16 18.5c1.346 0 2.437-1.12 2.437-2.5S17.346 13.5 16 13.5c-1.346 0-2.437 1.12-2.437 2.5s1.091 2.5 2.437 2.5z\\" fill=\\"#000\\"></path>"},"link":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#637282\\"><path d=\\"M6 16c0-2.21 1.794-4 4.007-4h4.986A4.006 4.006 0 0 1 19 16v4h-8.993A4.006 4.006 0 0 1 6 16zm2 0c0 1.112.898 2 2.005 2H13v2h6v-3h-2v-.999c0-1.1-.894-2.001-1.997-2.001H9.997A2 2 0 0 0 8 16z\\"></path><path d=\\"M26 16c0 2.21-1.794 4-4.007 4h-4.986A4.006 4.006 0 0 1 13 16v-4h8.993A4.006 4.006 0 0 1 26 16zm-2 0c0-1.112-.898-2-2.005-2H19v-2h-6v3h2v.999c0 1.1.894 2.001 1.997 2.001h5.006A2 2 0 0 0 24 16z\\"></path></g></g>"}}\n  '),it=e=>{const{name:t}=e,s=n.react.exports.createElement(V.SvgIconBundle,{focusable:"false",icon:nt[t]});return n.react.exports.createElement(H.Component,Object.assign({icon:s},e))};it.displayName="IconAcl";const at=function(e){const t=e.expires?e.expires.getTime():0;if(null!=e.expires){let e=t-(new Date).getTime();return e<0&&(e=0),Math.floor(e/864e5)}return-1},rt=function(e){return!1===e.link_permissions.allow_download?null!=e.expires?function(e){o.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const t=at(e);return(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"vZ+Gcq",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the folder. Expires in a day. Downloads disabled.} other{Anyone with this link and the password can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"public":return r.intl.formatMessage({id:"OrpLrY",defaultMessage:"{count, plural, one{Anyone with this link can view the folder. Expires in a day. Downloads disabled.} other{Anyone with this link can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"shared_folder_only":return r.intl.formatMessage({id:"dBd/+Q",defaultMessage:"{count, plural, one{Members of the folder with this link can view this folder. Expires in a day. Downloads disabled.} other{Members of the folder with this link can view this folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_and_password":return r.intl.formatMessage({id:"gSChY6",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the folder. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link and the password can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_only":return r.intl.formatMessage({id:"SkY8H3",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the folder. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"no_one":return r.intl.formatMessage({id:"45l3oV",defaultMessage:"{count, plural, one{Members of the folder with this link can view. Expires in a day. Downloads disabled.} other{Members of the folder with this link can view. Expires in {count} days. Downloads disabled.}}"},{count:t});case"only_you":return r.intl.formatMessage({id:"8vR+GP",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day. Downloads disabled.} other{Only you can view via this link. Expires in {count} days. Downloads disabled.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"7v6dcE",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link and the password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"public":return r.intl.formatMessage({id:"LhLDTC",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"shared_folder_only":return r.intl.formatMessage({id:"euxNFl",defaultMessage:"{count, plural, one{Members of the containing shared folder with this link can view the file. Expires in a day. Downloads disabled.} other{Members of the containing shared folder with this link can view this file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_and_password":return r.intl.formatMessage({id:"8EZlSa",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the file. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link and the password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_only":return r.intl.formatMessage({id:"+sU/hx",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"no_one":return r.intl.formatMessage({id:"9FCQD8",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day. Downloads disabled.} other{Members of the file with this link can view. Expires in {count} days. Downloads disabled.}}"},{count:t});case"only_you":return r.intl.formatMessage({id:"8vR+GP",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day. Downloads disabled.} other{Only you can view via this link. Expires in {count} days. Downloads disabled.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}})()}(e):(e=>(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"vS4Oei",defaultMessage:"Anyone with this link and password can view the folder. Downloads disabled."});case"public":return r.intl.formatMessage({id:"2q+G4r",defaultMessage:"Anyone with this link can view the folder. Downloads disabled."});case"shared_folder_only":return r.intl.formatMessage({id:"eW5qss",defaultMessage:"Members of the folder with this link can view the folder. Downloads disabled."});case"team_and_password":return r.intl.formatMessage({id:"BOIgzx",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the folder. Downloads disabled."});case"team_only":return r.intl.formatMessage({id:"xzbxdc",defaultMessage:"Anyone on your Dropbox team with this link can view the folder. Downloads disabled."});case"no_one":return r.intl.formatMessage({id:"9htZoO",defaultMessage:"Members of the folder with this link can view. Downloads disabled."});case"only_you":return r.intl.formatMessage({id:"fGFHbB",defaultMessage:"Only you can view via this link. Downloads disabled."});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"PqLAde",defaultMessage:"Anyone with this link and password can view the file. Downloads disabled."});case"public":return r.intl.formatMessage({id:"hgAISZ",defaultMessage:"Anyone with this link can view the file. Downloads disabled."});case"shared_folder_only":return r.intl.formatMessage({id:"GYDnJ7",defaultMessage:"Members of the containing shared folder with this link can view the file. Downloads disabled."});case"team_and_password":return r.intl.formatMessage({id:"pDYnvf",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the file. Downloads disabled."});case"team_only":return r.intl.formatMessage({id:"dYMwXa",defaultMessage:"Anyone on your Dropbox team with this link can view the file. Downloads disabled."});case"no_one":return r.intl.formatMessage({id:"vWPrZf",defaultMessage:"Members of the file with this link can view. Downloads disabled."});case"only_you":return r.intl.formatMessage({id:"fGFHbB",defaultMessage:"Only you can view via this link. Downloads disabled."});default:return ot(e.link_permissions.resolved_visibility)}})())(e):null!=e.expires?function(e){o.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const t=at(e);return(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"xYXFPH",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the folder. Expires in a day.} other{Anyone with this link and the password can view the folder. Expires in {count} days.}}"},{count:t});case"public":return r.intl.formatMessage({id:"xZI0xM",defaultMessage:"{count, plural, one{Anyone with this link can view the folder. Expires in a day.} other{Anyone with this link can view the folder. Expires in {count} days.}}"},{count:t});case"shared_folder_only":return r.intl.formatMessage({id:"YUkY7N",defaultMessage:"{count, plural, one{Members of the folder with this link can view the folder. Expires in a day.} other{Members of the folder with this link can view the folder. Expires in {count} days.}}"},{count:t});case"team_and_password":return r.intl.formatMessage({id:"t7SwRy",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the folder. Expires in a day.} other{Anyone on your Dropbox team with this link and the password can view the folder. Expires in {count} days.}}"},{count:t});case"team_only":return r.intl.formatMessage({id:"mY+P4M",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the folder. Expires in a day.} other{Anyone on your Dropbox team with this link can view the folder. Expires in {count} days.}}"},{count:t});case"no_one":return r.intl.formatMessage({id:"RHtmRP",defaultMessage:"{count, plural, one{Members of the folder with this link can view. Expires in a day.} other{Members of the folder with this link can view. Expires in {count} days.}}"},{count:t});case"only_you":return r.intl.formatMessage({id:"hTH6PN",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day.} other{Only you can view via this link. Expires in {count} days.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"RwPv2b",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the file. Expires in a day.} other{Anyone with this link and the password can view the file. Expires in {count} days.}}"},{count:t});case"public":return r.intl.formatMessage({id:"VGO9WL",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day.} other{Anyone with this link can view the file. Expires in {count} days.}}"},{count:t});case"shared_folder_only":return r.intl.formatMessage({id:"GDSx6k",defaultMessage:"{count, plural, one{Members of the containing shared folder with this link can view the file. Expires in a day.} other{Members of the containing shared folder with this link can view the file. Expires in {count} days.}}"},{count:t});case"team_and_password":return r.intl.formatMessage({id:"Zeh+SK",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the file. Expires in a day.} other{Anyone on your Dropbox team with this link and the password can view the file. Expires in {count} days.}}"},{count:t});case"team_only":return r.intl.formatMessage({id:"eTrJTC",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the file. Expires in a day.} other{Anyone on your Dropbox team with this link can view the file. Expires in {count} days.}}"},{count:t});case"no_one":return r.intl.formatMessage({id:"Pa7KCD",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day.} other{Members of the file with this link can view. Expires in {count} days.}}"},{count:t});case"only_you":return r.intl.formatMessage({id:"hTH6PN",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day.} other{Only you can view via this link. Expires in {count} days.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}})()}(e):(e=>(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"sYUe0C",defaultMessage:"Anyone with this link and password can view the folder."});case"public":return r.intl.formatMessage({id:"ysL13U",defaultMessage:"Anyone with this link can view the folder."});case"shared_folder_only":return r.intl.formatMessage({id:"kKbOL4",defaultMessage:"Members of the folder with this link can view the folder."});case"team_and_password":return r.intl.formatMessage({id:"GmhVIx",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the folder."});case"team_only":return r.intl.formatMessage({id:"82WU9J",defaultMessage:"Anyone on your Dropbox team with this link can view the folder."});case"no_one":return r.intl.formatMessage({id:"XqgOD/",defaultMessage:"Members of the folder with this link can view."});case"only_you":return r.intl.formatMessage({id:"MrEDaY",defaultMessage:"Only you can view via this link."});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return r.intl.formatMessage({id:"deMB/m",defaultMessage:"Anyone with this link and password can view the file."});case"public":return r.intl.formatMessage({id:"oxZeg7",defaultMessage:"Anyone with this link can view the file."});case"shared_folder_only":return r.intl.formatMessage({id:"a6Ka8X",defaultMessage:"Members of the containing shared folder with this link can view the file."});case"team_and_password":return r.intl.formatMessage({id:"35NLW6",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the file."});case"team_only":return r.intl.formatMessage({id:"xqds9K",defaultMessage:"Anyone on your Dropbox team with this link can view the file."});case"no_one":return r.intl.formatMessage({id:"qcHpky",defaultMessage:"Members of the file with this link can view."});case"only_you":return r.intl.formatMessage({id:"MrEDaY",defaultMessage:"Only you can view via this link."});default:return ot(e.link_permissions.resolved_visibility)}})())(e)};function ot(e){return _.reportStack(`Unknown audience when building link description: ${e}`,{severity:S.SEVERITY.CRITICAL,tags:["sharing"]}),""}const lt=function(e){const t=e.expires?e.expires.getTime():0;if(null!=e.expires){let e=t-(new Date).getTime();return e<0&&(e=0),Math.floor(e/864e5)}return-1},ct=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"cxrZ5f",defaultMessage:"Anyone with this link and password can edit the file. Downloads disabled."});case"team":return t?r.intl.formatMessage({id:"TQmLgY",defaultMessage:"Anyone on your {trademark_business} team with this link and password can edit the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"2bSlge",defaultMessage:"Anyone on the {trademark_business} team with this link and password can edit the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"whxBh0",defaultMessage:"Members of the file with this link and password can edit. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"PqLAde",defaultMessage:"Anyone with this link and password can view the file. Downloads disabled."});case"team":return t?r.intl.formatMessage({id:"AJEVeE",defaultMessage:"Anyone on your {trademark_business} team with this link and password can view the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"aEL0+O",defaultMessage:"Anyone on the {trademark_business} team with this link and password can view the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"dm25xu",defaultMessage:"Members of the file with this link and password can view. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},dt=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"Y/LBQu",defaultMessage:"Anyone with this link and password can edit the file."});case"team":return t?r.intl.formatMessage({id:"C4C3zD",defaultMessage:"Anyone on your {trademark_business} team with this link and password can edit the file."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"QrSEbK",defaultMessage:"Anyone on the {trademark_business} team with this link and password can edit the file."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"WsbIo+",defaultMessage:"Members of the file with this link and password can edit."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"deMB/m",defaultMessage:"Anyone with this link and password can view the file."});case"team":return t?r.intl.formatMessage({id:"jRW/3Y",defaultMessage:"Anyone on your {trademark_business} team with this link and password can view the file."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"pxf8F/",defaultMessage:"Anyone on the {trademark_business} team with this link and password can view the file."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"gQVZHe",defaultMessage:"Members of the file with this link and password can view."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},ht=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"EEvTVP",defaultMessage:"Anyone with this link can edit the file. Downloads disabled."});case"team":return t?r.intl.formatMessage({id:"3+mqzE",defaultMessage:"Anyone on your {trademark_business} team with this link can edit the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"xBbH4N",defaultMessage:"Anyone on the {trademark_business} team with this link can edit the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"nHOq1c",defaultMessage:"Members of the file with this link can edit. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"hgAISZ",defaultMessage:"Anyone with this link can view the file. Downloads disabled."});case"team":return t?r.intl.formatMessage({id:"9j7wtG",defaultMessage:"Anyone on your {trademark_business} team with this link can view the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"HwbdrG",defaultMessage:"Anyone on the {trademark_business} team with this link can view the file. Downloads disabled."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"vWPrZf",defaultMessage:"Members of the file with this link can view. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},pt=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"a3Sd0R",defaultMessage:"Anyone with this link can edit the file."});case"team":return t?r.intl.formatMessage({id:"d2zmmn",defaultMessage:"Anyone on your {trademark_business} team with this link can edit the file."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"BjuWgM",defaultMessage:"Anyone on the {trademark_business} team with this link can edit the file."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"+csK/m",defaultMessage:"Members of the file with this link can edit."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"oxZeg7",defaultMessage:"Anyone with this link can view the file."});case"team":return t?r.intl.formatMessage({id:"KQwzZb",defaultMessage:"Anyone on your {trademark_business} team with this link can view the file."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"1rEKxF",defaultMessage:"Anyone on the {trademark_business} team with this link can view the file."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"qcHpky",defaultMessage:"Members of the file with this link can view."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},mt=function(e,t){o.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"YGF1+m",defaultMessage:"{count, plural, one{Anyone with this link and password can edit the file. Expires in a day.} other{Anyone with this link and password can edit the file. Expires in {count} days.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"FmMziB",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"xBIzV+",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"Iyx6hS",defaultMessage:"{count, plural, one{Members of the file with this link and password can edit. Expires in a day.} other{Members of the file with this link and password can edit. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"ScWMex",defaultMessage:"{count, plural, one{Anyone with this link and password can view the file. Expires in a day.} other{Anyone with this link and password can view the file. Expires in {count} days.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"q2skMY",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password can view the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link and password can view the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"koMmbb",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can view the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link and password can view the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"q6m+2V",defaultMessage:"{count, plural, one{Members of the file with this link and password can view. Expires in a day.} other{Members of the file with this link and password can view. Expires in {count} days.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},ut=function(e,t){o.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"jpA9+q",defaultMessage:"{count, plural, one{Anyone with this link can edit the file. Expires in a day.} other{Anyone with this link can edit the file. Expires in {count} days.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"aL2iGX",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can edit the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"gbta7Y",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can edit the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"1EdolK",defaultMessage:"{count, plural, one{Members of the file with this link can edit. Expires in a day.} other{Members of the file with this link can edit. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"VGO9WL",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day.} other{Anyone with this link can view the file. Expires in {count} days.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"6+PaTo",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can view the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link can view the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"dShAa9",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can view the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link can view the file. Expires in {count} days.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"Pa7KCD",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day.} other{Members of the file with this link can view. Expires in {count} days.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},gt=function(e,t){o.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"CJtjRk",defaultMessage:"{count, plural, one{Anyone with this link can edit the file. Expires in a day. Downloads disabled.} other{Anyone with this link can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"5K8k8j",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can edit the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"2c8AqX",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can edit the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"zUmiuz",defaultMessage:"{count, plural, one{Members of the file with this link can edit. Expires in a day. Downloads disabled.} other{Members of the file with this link can edit. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"LhLDTC",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"b/mGhH",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"YxsBme",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"9FCQD8",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day. Downloads disabled.} other{Members of the file with this link can view. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},ft=function(e,t){o.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"9DkYwJ",defaultMessage:"{count, plural, one{Anyone with this link and password can edit the file. Expires in a day. Downloads disabled.} other{Anyone with this link and password can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"2WlplE",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"01SzRQ",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"i88LS8",defaultMessage:"{count, plural, one{Members of the file with this link and password can edit. Expires in a day. Downloads disabled.} other{Members of the file with this link and password can edit. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"/Ke+Ja",defaultMessage:"{count, plural, one{Anyone with this link and password can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link and password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?r.intl.formatMessage({id:"oSMrQu",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password and password can view the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link and password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"iN+FK7",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can view the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link and password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"yenocu",defaultMessage:"{count, plural, one{Members of the file with this link and password can view. Expires in a day. Downloads disabled.} other{Members of the file with this link and password can view. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},_t=function(e,t,s){return e.isRighteousLink()?s?function(e,t){return!1===e.link_permissions.allow_download?null!=e.expires?!1===e.link_permissions.require_password?gt(e,t):ft(e,t):!1===e.link_permissions.require_password?ht(e,t):ct(e,t):null!=e.expires?!1===e.link_permissions.require_password?ut(e,t):mt(e,t):!1===e.link_permissions.require_password?pt(e,t):dt(e,t)}(e,t):function(e,t){switch(e.link_permissions.link_access_level){case"editor":return Et(e,t);case"viewer":return St(e,t);default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}}(e,t):rt(e)},Et=function(e,t){switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"a3Sd0R",defaultMessage:"Anyone with this link can edit the file."});case"team":return t?r.intl.formatMessage({id:"d2zmmn",defaultMessage:"Anyone on your {trademark_business} team with this link can edit the file."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"BjuWgM",defaultMessage:"Anyone on the {trademark_business} team with this link can edit the file."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"+csK/m",defaultMessage:"Members of the file with this link can edit."});default:return ot(e.link_permissions.effective_audience)}},St=function(e,t){switch(e.link_permissions.effective_audience){case"public":return r.intl.formatMessage({id:"oxZeg7",defaultMessage:"Anyone with this link can view the file."});case"team":return t?r.intl.formatMessage({id:"KQwzZb",defaultMessage:"Anyone on your {trademark_business} team with this link can view the file."},{trademark_business:$.TRADEMARK_BUSINESS}):r.intl.formatMessage({id:"1rEKxF",defaultMessage:"Anyone on the {trademark_business} team with this link can view the file."},{trademark_business:$.TRADEMARK_BUSINESS});case"no_one":return r.intl.formatMessage({id:"qcHpky",defaultMessage:"Members of the file with this link can view."});default:return ot(e.link_permissions.effective_audience)}},Mt=["trackingId","href"];class kt extends n.React$1.Component{render(){return n.React$1.createElement(i.Link,Object.assign({},this.props),this.props.children)}}kt.displayName="TrackedLinkElement";const bt=(e=>{class t extends n.React$1.Component{constructor(){super(...arguments),this.getWhitelistedExtras=()=>{const e={};return Mt.forEach((t=>{this.props.hasOwnProperty(t)&&(e[`element_${t}`]=this.props[t])})),e},this.onClick=()=>{g.logTiburonEvent(this.props.contentInfo,this.props.user.id,u.TiburonEventName.ElementClick,this.getWhitelistedExtras())}}componentDidMount(){g.logTiburonEvent(this.props.contentInfo,this.props.user.id,u.TiburonEventName.ElementView,this.getWhitelistedExtras())}render(){return n.React$1.createElement(e,Object.assign({onClick:this.onClick},this.props))}}return t.displayName=`withSharingTracking(${i.getDisplayName(e)}`,t})(kt);function vt(e,t,s){return"M1V2"===t||"M1V2_LINK_SETTINGS"===t?1===e.paid?`/buy/professional?_tk=${s}`:`/pro/try?_tk=${s}`:(["M1V1","OFF","CONTROL"].indexOf(t)<0&&_.reportException({err:new Error(`Variant is ${t}`),tags:["share_modal_upsell_premium_sharing"],severity:S.SEVERITY.NONCRITICAL}),`/upgrade?oqa=sfp&_tk=${s}`)}class Ct extends n.React$1.Component{componentDidMount(){this.props.hasIncrementedCounter||void 0===this.props.hasSeenCounter||this.props.onSetSeenCounter(this.props.hasSeenCounter+1)}getCTAText(){return 1===this.props.user.paid?r.intl.formatMessage({id:"vFDLgh",defaultMessage:"Try it with Professional"}):r.intl.formatMessage({id:"iPDKbr",defaultMessage:"Try free with Professional"})}render(){return n.React$1.createElement(m.Banner,{showTopCaret:!0},n.React$1.createElement(i.Text,{size:"small",className:"scl-banner__text"},r.intl.formatMessage({id:"R2FTNc",defaultMessage:"Secure this link with a password and expiration."})," ",n.React$1.createElement(bt,{trackingId:"share_modal_pro_upsell_footer",user:this.props.user,contentInfo:this.props.contentInfo,href:vt(this.props.user,this.props.variant,"sharing_modal_upsell"),target:"_blank",rel:"noopener",hasNoUnderline:!0},this.getCTAText())))}}function yt(e){const t=i.COLORS.COLOR_INK_60;return"editor"===e?n.React$1.createElement(G.ColorizedIcon,{color:t},n.React$1.createElement(it,{name:"link-edit"})):n.React$1.createElement(G.ColorizedIcon,{color:t},n.React$1.createElement(it,{name:"link-view"}))}Ct.displayName="SharingModalUpsellPremiumSharing",r.intl.formatMessage({id:"tyzuDO",defaultMessage:"Link copied. Allows editing."}),r.intl.formatMessage({id:"6z63dh",defaultMessage:"Link copied. Allows viewing."});class wt extends n.React$1.Component{constructor(e){super(e),this.copyLink=()=>{W.copyToClipboard(this.getLink(),(()=>(this.props.modalClose(),f.showCopyLinkSuccessSnackbar(this.props.linkMetadata.url,this.props.linkAccessLevel))),(function(){f.sharingNotificationError(r.intl.formatMessage({id:"YHoriR",defaultMessage:"Unable to copy the link, please copy manually"}))}))},this.getSpectrumLinkText=e=>{switch(e){case"editor":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),n.React$1.createElement("br",null),this.renderLinkDescription());case"viewer":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),n.React$1.createElement("br",null),this.renderLinkDescription());default:return this.renderLinkDescription()}},this.getLink=()=>null!=this.props.linkMetadata?this.props.linkMetadata.url:"",this.getSpectrumNoLinkText=e=>{switch(e){case"editor":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"QfMy5I",defaultMessage:"No link created yet."}));case"viewer":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"QfMy5I",defaultMessage:"No link created yet."}));default:return r.intl.formatMessage({id:"le+3CZ",defaultMessage:"No link created yet"})}},this.onClickButtonCreateLink=()=>{this.setState({creatingLink:!0},(()=>this.handleCreateLinkClicked()))},this.handleCreateLinkClicked=()=>{this.props.actionHandler&&this.props.actionHandler.createSharedLink(this.props.linkAccessLevel)},this.getSpectrumLoadingText=e=>{switch(e){case"editor":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"d3Gvwr",defaultMessage:"Creating edit link..."}),n.React$1.createElement(m.ScooterLoader,null));case"viewer":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"rnuyM8",defaultMessage:"Creating view link..."}),n.React$1.createElement(m.ScooterLoader,null));default:return}},this.handleCopyLinkClicked=()=>{if(!this.state.showingUrl){const e={};if(this.props.linkMetadata){e.visibility=this.props.linkMetadata.link_permissions.resolved_visibility,e.expiration=this.props.linkMetadata.expires;const t=k.getLinkKey(this.props.linkMetadata.url);t.kind!==u.LinkKeyTypes.NONE&&(e[t.kind]=t.val,e.link_type=t.link_type)}this.props.contentInfo&&(g.logTiburonEvent(this.props.contentInfo,this.props.user.id,u.TiburonEventName.ClickTibCopyLink,e),g.logTiburonEvent(this.props.contentInfo,this.props.user.id,u.TiburonEventName.CopySharedLink,e))}return De(this,{showingUrl:!this.state.showingUrl,creatingLink:!1}).then(this.copyLink)},this.state={showingUrl:!1,creatingLink:!1}}getLinkabilityState(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo(),{permissions:t}=this.props;return e&&e.isCloudDoc()?this.getLinkabilityStateForCloudDoc():this.props.isTeamSharedFolder?l.LinkabilityStates.CANT_LINK_TEAM_FOLDER:(e.isFolder()||!e.isMetadataLoaded()||t.canCreateViewLink())&&(this.props.canShareLink||this.props.mode===l.MODES.LINK_ONLY)?l.LinkabilityStates.CAN_LINK:t.canInvite()?l.LinkabilityStates.INVITE_NO_LINK:l.LinkabilityStates.NO_INVITE_NO_LINK}getLinkabilityStateForCloudDoc(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();return this.props.linkMetadata||"editor"===this.props.linkAccessLevel&&e.permissionsObj().canCreateEditLink()||"viewer"===this.props.linkAccessLevel&&e.permissionsObj().canCreateViewLink()?l.LinkabilityStates.CAN_LINK:l.LinkabilityStates.NO_INVITE_NO_LINK}spectrumClassNames(){return"scl-sharing-modal-footer-link--no-border"}render(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo(),t=this.getLinkabilityState();if(t===l.LinkabilityStates.NO_INVITE_NO_LINK)return this.renderSpectrumCantLinkOrShare();if(t===l.LinkabilityStates.INVITE_NO_LINK)return this.renderSpectrumCantLinkCDM();if(t===l.LinkabilityStates.CANT_LINK_TEAM_FOLDER)return this.renderSpectrumCantLinkTeamFolder();if(this.props.linkMetadata){let t;return t=this.state.showingUrl?this.renderSpectrumCopyLink():this.renderSpectrumLink(),n.React$1.createElement(n.React$1.Fragment,null,t,e.hasCreatedLink()&&this.renderUpsellPremiumSharing())}return this.state.creatingLink?n.React$1.createElement(n.React$1.Fragment,null,this.renderSpectrumLoading(),this.renderUpsellPremiumSharing()):t===l.LinkabilityStates.CAN_LINK?this.renderSpectrumNoLink():null}getSpectrumLinkNoAvailableCloudDocText(e){switch(e){case"editor":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"5tpMRl",defaultMessage:"Link not available"}));case"viewer":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"5tpMRl",defaultMessage:"Link not available"}));default:return r.intl.formatMessage({id:"5tpMRl",defaultMessage:"Link not available"})}}renderSpectrumCantLinkOrShare(){return n.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLinkNoAvailableCloudDocText(this.props.linkAccessLevel)})}getSpectrumCantLinkCDMCloudDocText(e){switch(e){case"editor":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"3VVFir",defaultMessage:"Link not available. To share, invite specific people."}));case"viewer":return n.React$1.createElement("span",null,n.React$1.createElement("b",null,r.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),n.React$1.createElement("br",null),r.intl.formatMessage({id:"3VVFir",defaultMessage:"Link not available. To share, invite specific people."}));default:return r.intl.formatMessage({id:"3VVFir",defaultMessage:"Link not available. To share, invite specific people."})}}renderSpectrumCantLinkCDM(){const e=n.React$1.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"sGKSF8",defaultMessage:"Learn more"}));return n.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumCantLinkCDMCloudDocText(this.props.linkAccessLevel),actions:e})}renderSpectrumCantLinkTeamFolder(){const e=n.React$1.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"sGKSF8",defaultMessage:"Learn more"}));return n.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLinkNoAvailableCloudDocText(this.props.linkAccessLevel),actions:e})}renderLinkDescription(){let e;if(this.props.linkMetadata){const t=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();e=_t(this.props.linkMetadata,t.isUserOnOwnerTeam(),!0)}return e}renderSpectrumLink(){const e=n.React$1.createElement("span",{className:"copy-link-button"},r.intl.formatMessage({id:"DhomU6",defaultMessage:"Copy link"}));return n.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLinkText(this.props.linkAccessLevel),actions:n.React$1.createElement(i.Button$1,{className:"button-as-link copy-link-container",key:"copy",variant:"borderless",onClick:this.handleCopyLinkClicked},e)})}renderSpectrumCopyLink(){return n.React$1.createElement(tt,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),sharedLinkUrl:this.getLink(),labelSharedLinkUrl:r.intl.formatMessage({id:"9s4M13",defaultMessage:"Shared link URL"}),textButton:r.intl.formatMessage({id:"CgREwE",defaultMessage:"Hide link"}),onClickButton:this.handleCopyLinkClicked})}renderSpectrumNoLink(){return n.React$1.createElement(et,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),statusNoLinkCreated:this.getSpectrumNoLinkText(this.props.linkAccessLevel),textButtonCreateLink:r.intl.formatMessage({id:"/nFZR2",defaultMessage:"Create link"}),onClickButtonCreateLink:this.onClickButtonCreateLink})}renderSpectrumLoading(){return n.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLoadingText(this.props.linkAccessLevel)})}renderUpsellPremiumSharing(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo(),t=e=>{this.props.actionHandler&&this.props.actionHandler.setSeenUpsellCounterPref(e)};return e.isShareModalUpsellPremiumSharing()&&e.shareModalUpsellPremiumSharingVariant()&&!e.isCloudDoc()?n.React$1.createElement(Ct,{user:this.props.user,contentInfo:this.props.contentInfo,variant:e.shareModalUpsellPremiumSharingVariant(),hasIncrementedCounter:e.hasIncrementedUpsellCounter(),hasSeenCounter:e.hasSeenUpsellCounter(),onSetSeenCounter:t}):void 0}}wt.displayName="RighteousModalLinkInfo";class It extends n.React$1.Component{constructor(e){super(e),this.onClickButtonCreateLink=e=>{"editor"===e?this.setState({creatingEditLink:!0},(()=>this.handleCreateLinkClicked(e))):this.setState({creatingViewLink:!0},(()=>this.handleCreateLinkClicked(e)))},this.handleCreateLinkClicked=e=>{this.props.actionHandler&&this.props.actionHandler.createSharedLink(e).catch((()=>{"editor"===e&&this.state.creatingEditLink?this.setState({creatingEditLink:!1}):this.setState({creatingViewLink:!1})}))},this.handleClickDeleteLink=e=>{!function({contentInfo:e,client:t,url:s,contentName:o,onDeleteLink:l,onCancel:c,actionHandler:d}){const h=(s,n={})=>{g.logTiburonEvent(e,t.userId,s,n)};o=i.Emstring.em_snippet(o,i.SNIPPET_SIZES.FILENAME);const p=r.intl.formatMessage({id:"gbccCU",defaultMessage:"Delete link to “{name}”?"},{name:o}),m=()=>{i.Modal$1.close(),c&&c()};i.Modal$1.showInstance(n.React$1.createElement(i.Modal,{"aria-label":p,title:p,open:!0,onRequestClose:m},n.React$1.createElement(i.Modal.Header,{hasBottomSpacing:"title-standard"},n.React$1.createElement(i.Modal.Title,null,p)),n.React$1.createElement(i.Modal.Body,{hasVerticalSpacing:!1},r.intl.formatMessage({id:"poEviS",defaultMessage:"If you want to further restrict access, check the list of people who still have access."})),n.React$1.createElement(i.Modal.Footer,null,n.React$1.createElement(i.Button,{variant:"opacity",onClick:m},r.intl.formatMessage({id:"gZIlfg",defaultMessage:"Cancel"})),n.React$1.createElement(i.Button,{variant:"primary",onClick:()=>{h(u.TiburonEventName.AttemptDeleteSharedLink),U.logBrowseTTS("delete_link");const e=r.intl.formatMessage({id:"NEH57K",defaultMessage:"Deleting link to <st>{name}</st>..."},{st:e=>n.React$1.createElement("strong",null,e),name:o});f.sharingNotificationInProgress(e,!0),t.revokeSharedLink({url:s}).then((()=>{h(u.TiburonEventName.SucceedDeleteSharedLink,{http_status_code:200});const e=r.intl.formatMessage({id:"gfG7zK",defaultMessage:"Deleted link to <st>{name}</st>."},{st:e=>n.React$1.createElement("strong",null,e),name:o});d?f.showDeleteLinkSuccessSnackbar(e,(()=>d.showScreen(i.MANAGE_SCREEN)),"sharing-notification"):f.sharingNotificationSuccess(e),i.Modal$1.close(),l&&l()})).catch((e=>{if(e instanceof a.ApiError){const t=e;h(u.TiburonEventName.FailDeleteSharedLink,{http_status_code:t.raw&&t.raw.status,error_tag:t.error&&t.error[".tag"]||"undefined_error",error_summary:t.summary})}else h(u.TiburonEventName.FailDeleteSharedLink);throw e}))}},r.intl.formatMessage({id:"cRtuyn",defaultMessage:"Delete"})))))}({contentInfo:this.props.sharingInfo.contentInfo(),client:this.props.client,url:e.url,contentName:e.name,onDeleteLink:()=>{this.props.onDeleteLink(e)},onCancel:this.props.onCancelDeleteLink,actionHandler:this.props.actionHandler})},this.state={creatingEditLink:!1,creatingViewLink:!1}}render(){let e;"editor"===this.props.accessLevel?e=this.props.sharingInfo.editRighteousLink():(e=this.props.sharingInfo.viewRighteousLink(),e||(e=this.props.sharingInfo.shmodelLink()));const t=this.renderLinkPolicy(this.props.accessLevel,e);return n.React$1.createElement("div",{className:"scl-sharing-settings-links-section"},t)}emptyLinkCreateActions(e,t){return t?this.renderCreateLinkLoading(e):this.renderEmptyLinkPolicy(e)}renderLinkPolicy(e,t){if(!t)return"editor"===e?this.emptyLinkCreateActions(e,this.state.creatingEditLink):this.emptyLinkCreateActions(e,this.state.creatingViewLink);const s=this.props.updatedLinkPolicies[t.url],i=Ae(t),a=O.isReadOnlyPolicy(i,t.link_permissions);let r;return r=t.isRighteousLink()?n.React$1.createElement(Qe,{linkPolicy:s||i,linkMetadata:t,onPolicyUpdate:this.props.onPolicyUpdate,readOnlyPolicy:a}):n.React$1.createElement(ze,{linkPolicy:s||i,linkMetadata:t,isFolder:t.isFolder(),onPolicyUpdate:this.props.onPolicyUpdate,getPolicyDict:qe,readOnlyPolicy:a}),n.React$1.createElement(m.Card,{key:t.url||e,icon:yt(e),title:this.renderTitle(e),actions:this.renderLinkActions(t)},r)}renderLinkActions(e){return n.React$1.createElement(Tt,{linkMetadata:e,isLinkVisitor:this.props.isLinkVisitor,onClickDeleteLink:this.handleClickDeleteLink,accessLevel:this.props.accessLevel})}renderEmptyLinkPolicy(e){var t,s;const{sharingInfo:a}=this.props,o=this.props.sharingInfo.permissionsObj();let l;return l=O.canCreateLink(e,a.isCloudDoc(),a.isFolder(),a.isTeamSharedFolder(),a.isConfidentialFolder(),o.canInviteEditor(),a.canShareLink(),o.canCreateViewLink(),o.canCreateEditLink(),null===(t=null==a?void 0:a.metadata())||void 0===t?void 0:t.access_type,!!(null===(s=null==a?void 0:a.metadata())||void 0===s?void 0:s.path_lower),a.sharingPrefs().confidential_folder_links_enabled)?n.React$1.createElement("div",null,this.getEmptyLinkMessage(e)," ",n.React$1.createElement(i.Link,{id:"create-link",href:"#",onClick:()=>this.onClickButtonCreateLink(e)},r.intl.formatMessage({id:"F7gl6q",defaultMessage:"Create link"}))):r.intl.formatMessage({id:"DhAXrs",defaultMessage:"Link not available."}),n.React$1.createElement(m.Card,{key:e,icon:yt(e),title:this.renderTitle(e)},n.React$1.createElement("div",{className:"sharing-settings-modal__link-policy"},n.React$1.createElement("div",{className:"sharing-settings-modal__link-policy-text"},l)))}getEmptyLinkMessage(e){return"editor"===e?r.intl.formatMessage({id:"K79TJX",defaultMessage:"There isn’t a link for editing."}):r.intl.formatMessage({id:"B3RLyV",defaultMessage:"There isn’t a link for viewing."})}renderCreateLinkLoading(e){let t;const s=r.intl.formatMessage({id:"MnjJiE",defaultMessage:"Creating link"});return t=n.React$1.createElement("span",null,s,n.React$1.createElement(m.ScooterLoader,null)),n.React$1.createElement(m.Card,{key:e,icon:yt(e),title:this.renderTitle(e)},n.React$1.createElement("div",{className:"sharing-settings-modal__link-policy"},n.React$1.createElement("div",{className:"sharing-settings-modal__link-policy-text"},t)))}renderTitle(e){return"editor"===e?r.intl.formatMessage({id:"jN5OfV",defaultMessage:"People with this link can edit"}):r.intl.formatMessage({id:"xLAQNV",defaultMessage:"People with this link can view"})}}It.displayName="SharingSettingsLinkSection";class Tt extends n.React$1.Component{constructor(){super(...arguments),this.handleClickDelete=e=>{e.preventDefault(),this.props.onClickDeleteLink(this.props.linkMetadata)}}render(){return this.canDeleteLink()?n.React$1.createElement(i.Link,{id:"delete-link",href:"#",onClick:this.handleClickDelete},r.intl.formatMessage({id:"lDhFjo",defaultMessage:"Delete link"})):null}canDeleteLink(){return("editor"!==this.props.accessLevel||!this.props.isLinkVisitor)&&this.props.linkMetadata.link_permissions.can_revoke}}Tt.displayName="SharingSettingsLinkActions";const At=e=>{i.mountModal(n.React$1.createElement(Lt,Object.assign({},e)))},Lt=e=>{const[t,s]=n.React$1.useState(!0),a=(t=!1)=>{t&&i.logEvent({class:"onboard",action:"dismiss",object:"core_act_docsend_advanced_sharing_modal",properties:{experimentVariant:e.experimentVariant}}),s(!1)};n.react.exports.useEffect((()=>{R.setHasSeenDocsendModalInUserMetadata(i.mustGetActiveUser().id),i.Modal.setAppElement(document.body),i.logEvent({class:"onboard",action:"shown",object:"core_act_docsend_advanced_sharing_modal",properties:{experimentVariant:e.experimentVariant}})}),[]);const o=r.intl.formatMessage({id:"uguFZx",defaultMessage:"Secure sharing and analytics to help win new clients"}),l=r.intl.formatMessage({id:"/RJy7d",defaultMessage:"Custom security settings to keep sensitive files safe"}),c=r.intl.formatMessage({id:"YlpLOI",defaultMessage:"Document tracking to see how files are sharing and uncover decision makers"}),d=r.intl.formatMessage({id:"HpttW+",defaultMessage:"In-depth analytics to help refine your closing strategy"}),h=r.intl.formatMessage({id:"8Gobbg",defaultMessage:"Try Docsend"});return n.React$1.createElement(r.Provider,{value:r.intl},n.React$1.createElement(i.Modal,{open:t,onAfterClose:i.unmountModal,isCentered:!0},n.React$1.createElement("div",{style:{backgroundColor:"var(--color__inverse__attention__background)",display:"flex"}},n.React$1.createElement("div",{style:{margin:"auto"}},n.React$1.createElement(i.Image,{src:n.static_url("/static/metaserver/static/js/sharing/upsells/images/docsend_document_analytics-vflti6T_M.png"),width:"400px",height:"300px",style:{margin:"10px 0px"}}))),n.React$1.createElement(i.Modal.Header,{hasBottomSpacing:"title-standard"},n.React$1.createElement(i.Modal.Title,null,o)),n.React$1.createElement(i.Modal.Body,null,n.React$1.createElement("ul",null,n.React$1.createElement("li",null,l),n.React$1.createElement("li",null,c),n.React$1.createElement("li",null,d))),n.React$1.createElement(i.Modal.Footer,null,n.React$1.createElement(i.Button,{variant:"transparent",onClick:()=>a(!0)},i.CLOSE_BUTTON_TEXT),n.React$1.createElement("div",null),n.React$1.createElement(i.Button,{variant:"primary",onClick:()=>{i.logEvent({class:"onboard",action:"confirm",object:"core_act_docsend_advanced_sharing_modal",properties:{experimentVariant:e.experimentVariant}}),i.unsafe_open_tab(Rt()),a(!1)}},h))))};Lt.displayName="DocsendAdvancedSharingModal";const Rt=()=>new o.URI({scheme:"https",authority:"docsend.com",path:"/signup/dropbox",query:{utm_source:"Dropbox Referral",utm_medium:"Referral",utm_campaign:"core_act_docsend_advanced_sharing",signup_source:"docsend_advanced_sharing_modal"}}),Nt=n.React$1.createElement;class xt extends n.React$1.Component{constructor(e){super(e),this.onAfterModalClose=()=>s.__awaiter(this,void 0,void 0,(function*(){"V1"===this.props.sharingPrefs.core_act_docsend_advanced_sharing&&(yield R.canBeShownDocsendModal(this.props.user.id))&&At({experimentVariant:"V1"})})),this.handleSaveLinkSettings=()=>{U.logBrowseTTS("update_file_settings");for(const e of this.props.sharingInfo.sharedLinks()){const t=Ae(e),s=this.state.updatedLinkPolicies[e.url]||t;t.audience!==s.audience&&g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.ChangeSharedLinkAudience,Object.assign({old_audience:t.audience,new_audience:s.audience,screen:u.ScreenName.SettingsScreen},k.buildExtraFromLinkMetadata(e)))}this.saveLinkSettings()},this.saveLinkSettings=()=>{const e=this.getLinkSettingsToUpdate();e.errors||this.setState({isSubmitting:!0},(()=>{this.props.actionHandler.updateLinkSettings(e.requests).then((()=>{this.setState({isSubmitting:!1}),this.props.onDismiss&&this.props.onDismiss(this.getCurrentTab())})).catch((()=>{this.setState({isSubmitting:!1})}))}))},this.saveFileSettings=()=>{const e=we(this.state.desiredPolicy,this.props.currentPolicy);e&&De(this,{isSubmitting:!0}).then((()=>this.props.client.updatePolicy({contentId:this.props.sharingInfo.contentId(),newPolicy:e,actions:Object.keys(i.ALPHA_FILE_METADATA_PERMISSIONS)}))).catch(a.catchApiError((e=>{this.setState({isSubmitting:!1});const t=e&&e.message;return f.sharingNotificationError(t||r.intl.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."})),Promise.reject()}))).then((e=>{f.sharingNotificationSuccess(r.intl.formatMessage({id:"Hpq9jD",defaultMessage:"File settings updated."})),this.setState({isSubmitting:!1}),this.props.currentPolicy&&this.props.actionHandler.handleUpdateFilePolicy(e,this.props.currentPolicy),this.props.onDismiss&&this.props.onDismiss()})).then((()=>this.props.actionHandler.resetContactValidations()))},this.handleSetFolderPolicy=()=>{const e=we(this.state.desiredPolicy,this.props.currentPolicy),t=t=>{i.Snackbar.complete(r.intl.formatMessage({id:"wGHIQR",defaultMessage:"Folder settings updated."}),"sharing-notification"),null!=t&&(t.policy.shared_link_policy!==this.props.currentPolicy.shared_link_policy&&(this.props.actionHandler.fetchLinkMetadata(),i.getStoreForSharedWith().dispatch(i.sharedLinkDataOutOfDate(this.props.sharingInfo.displayPath()))),this.props.actionHandler.handleUpdateSharingSettings(t),i.dispatcherSingleton.dispatch({type:p.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS,user:this.props.user,sharedFolderMetadata:t,policyUpdate:e}),this.props.onSuccessSharing&&this.props.onSuccessSharing()),this.props.onDismiss&&this.props.onDismiss()},s=this.props.sharingInfo.metadata()&&this.props.sharingInfo.metadata().shared_folder_id;if(s)return this.props.client.updatePolicyAlpha({contentId:s,newPolicy:e,url:null!=this.props.linkMetadata?this.props.linkMetadata.url:void 0}).then(t).then((()=>this.props.actionHandler.resetContactValidations()));{const s=e=>{if(this.props.actionHandler.reportShareFailure)return this.props.actionHandler.reportShareFailure(e)};return this.props.actionHandler.shareIfFileFolder(r.intl.formatMessage({id:"AKdTOF",defaultMessage:"Updating folder settings..."}),e).then(t).then((()=>this.props.actionHandler.resetContactValidations())).catch(s)}},this.saveFolderSettings=()=>{this.props.isTeamSharedFolder||this.props.hasParentSharedFolder?function(e){const t=e.isTeamSharedFolder?K.purify.sanitize(r.intl.formatMessage({id:"p4X4PM",defaultMessage:"Your changes will be applied to this team folder and any folders inside it."})):K.purify.sanitize(r.intl.formatMessage({id:"ImAPkp",defaultMessage:"Your changes will be applied to this folder and any folders inside it."}));i.Modal$1.showInstance(n.react.exports.createElement(z.UtilityModal,{ariaLabel:r.intl.formatMessage({id:"SoVWmf",defaultMessage:"Save settings?"}),title:r.intl.formatMessage({id:"SoVWmf",defaultMessage:"Save settings?"}),overlayClickClose:!0,primaryAction:r.intl.formatMessage({id:"kTq6n5",defaultMessage:"Save settings"}),secondaryAction:r.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onPrimaryAction:e.onConfirm,onSecondaryAction:e.onCancel,open:!0,onRequestClose:e.onCancel},t))}({isTeamSharedFolder:this.props.isTeamSharedFolder,onConfirm:this.handleSetFolderPolicy,onCancel:i.Modal$1.close}):De(this,{isSubmitting:!0}).then((()=>{this.handleSetFolderPolicy().then((()=>{this.setState({isSubmitting:!1})})).catch(a.catchApiError((()=>this.setState({isSubmitting:!1}))))}))},this.handleUnshareFolder=()=>{if(g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.AttemptRemoveAllMembers),this.props.sharingInfo.metadata()&&null!=this.props.sharingInfo.metadata().shared_folder_id&&this.props.sharingInfo.permissionsObj().canUnshare()){const e=e=>{i.Snackbar.sync(r.intl.formatMessage({id:"2h4tij",defaultMessage:"Unsharing <st>{folder_name}</st>..."},{st:e=>n.React$1.createElement("strong",null,e),folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}),!0,"unshare-folder-notification");return this.props.client.unshare({contentId:this.props.sharingInfo.metadata()&&this.props.sharingInfo.metadata().shared_folder_id,leaveACopy:e}).then((()=>{g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.SucceedRemoveAllMembers,{http_status_code:200,response_status:"success"}),i.Snackbar.complete(r.intl.formatMessage({id:"tKbyJ8",defaultMessage:"Unshared <st>{folder_name}</st>."},{st:e=>n.React$1.createElement("strong",null,e),folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}),"unshare-folder-notification"),this.props.actionHandler.refreshSharedWithColumnContentData(),i.Modal$1.close(),i.dispatcherSingleton.dispatch({type:p.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS,metadata:this.props.sharingInfo.metadata(),user:this.props.user}),xe.emit("onSuccessUnsharing",{isFolder:this.props.sharingInfo.contentInfo().isFolder()})})).catch((e=>(g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.FailRemoveAllMembers,{http_status_code:e.raw&&e.raw.status,error_message:e.error[".tag"]?e.error[".tag"]:"undefined_error"}),"too_many_files"===e.error[".tag"]?this.tooManyFilesSnackbar():f.sharingNotificationError(e.message),i.dispatcherSingleton.dispatch({type:p.SharePageActionTypes.UNSHARE_FOLDER_ERROR,metadata:this.props.sharingInfo.metadata(),user:this.props.user}))))};return d.confirmResetAccess({allowLeaveACopy:this.props.sharingInfo.permissionsObj().canLeaveACopy(),contentName:this.props.folderName,isFolder:!0,isNestedSharedFolder:!!this.props.hasParentSharedFolder,onCancel:()=>i.Modal$1.close(),onConfirm:e})}},this.onSaveSettings=()=>{switch(this.getCurrentTab()){case m.FILE_SETTINGS:return this.saveFileSettings();case m.FOLDER_SETTINGS:return this.saveFolderSettings();case m.EDIT_LINK_SETTINGS:case m.VIEW_LINK_SETTINGS:return this.handleSaveLinkSettings();default:throw new Error("Unknown tab")}},this.onDeleteLink=e=>{this.props.actionHandler.refreshSharedWithColumnLinkData(),this.props.actionHandler.deleteLinkMetadata(e),this.props.onDismiss&&this.props.onDismiss(),this.props.actionHandler.openSharingSettingsModal(this.getCurrentTab())},this.onCancelDeleteLink=()=>{this.props.actionHandler.openSharingSettingsModal(this.getCurrentTab())},this.onUnshare=()=>{this.props.isFolder?this.handleUnshareFolder():this.handleUnshareFile()},this.renderTabGroups=()=>{const e=[];return this.getTabs().forEach((t=>{e.push(n.React$1.createElement(P.Tabs.Tab,{className:"sharing-settings-modal__tabs",id:t.id},t.label))})),n.React$1.createElement(P.Tabs.Group,{justified:!0},e)},this.renderTabPanels=()=>{const e=[];return this.getTabs().forEach((t=>{const s=this.getTabInfo(t.id);e.push(n.React$1.createElement(P.Tabs.Panel,{tabId:t.id},n.React$1.createElement("div",{className:"sharing-settings-modal__banners"},s.banner,s.description),n.React$1.createElement("div",{className:"sharing-settings-modal__tab-content"},s.content)))})),e},this.renderTabs=()=>n.React$1.createElement(P.Tabs,{selectedTab:this.getCurrentTab(),onSelection:this.onTabSelected},this.renderTabGroups(),this.renderTabPanels()),this.render=()=>{return n.React$1.createElement(i.Modal,{className:i.classnames(this.props.className,"scl-settings-modal"),"aria-label":this.renderTitle(),title:this.renderTitle(),open:!0,isCentered:!0,withCloseButton:"Close",onRequestClose:()=>{i.Modal$1.close(),this.onAfterModalClose()}},n.React$1.createElement(i.Modal.Header,{hasBottomSpacing:"title-standard"},n.React$1.createElement(i.Modal.Title,null,this.renderTitle())),n.React$1.createElement(i.Modal.Body,{hasVerticalSpacing:!1},this.renderTabs()),n.React$1.createElement(i.Modal.Footer,null,this.shouldShowUnshare()?n.React$1.createElement(i.Button,{variant:"transparent",onClick:this.onUnshare,"data-testid":"unshare_button"},(e=this.props.isFolder,t=this.props.isFolderInsideTeamFolderTree,e?t?r.intl.formatMessage({id:"11dNm1",defaultMessage:"Reset membership"}):r.intl.formatMessage({id:"qyAR1S",defaultMessage:"Unshare folder"}):r.intl.formatMessage({id:"px+mde",defaultMessage:"Unshare file"}))):void 0,n.React$1.createElement(i.Button,{variant:"opacity",onClick:()=>{var e,t;return null===(t=(e=this.props).onDismiss)||void 0===t?void 0:t.call(e,this.getCurrentTab())}},r.intl.formatMessage({id:"pTINM6",defaultMessage:"Cancel"})),this.renderPrimaryAction()));var e,t},this.renderPrimaryAction=()=>n.React$1.createElement(i.Button,{className:"confirm-button u-mar-left-s",variant:"primary",disabled:!this.allowSaveSettings()||this.state.isSubmitting,onClick:this.onSaveSettings},this.state.isSubmitting?r.intl.formatMessage({id:"qIDtpl",defaultMessage:"Saving..."}):r.intl.formatMessage({id:"rQzKcA",defaultMessage:"Save"})),this.handlePolicyUpdate=(e,t)=>{this.setState({desiredPolicy:this.state.desiredPolicy.set(e,t)})},this.onTabSelected=e=>{this.setState({currentTab:e}),g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.ViewSettingsTab,{settings_tab:e})},this.getCurrentTab=()=>this.state.currentTab||this.getTabs()[0].id,this.handleLinkPolicyUpdate=(e,t)=>{const s=this.state.updatedLinkPolicies;if(s[e.url]=t,this.props.sharingInfo.editRighteousLink()){const e=Ae(this.props.sharingInfo.editRighteousLink()).audience;i.isLinkAudienceLowerAccess(t.audience,e)&&this.setState({showDowngradeBanner:!0}),this.setState({showAdvancedSettingsWarning:!!t.expires||!!t.require_password})}this.setState({updatedLinkPolicies:s})},this.hideDowngradeBanner=()=>{this.setState({showDowngradeBanner:!1})},this.openManageAccess=e=>{e.preventDefault(),this.saveAndManageAccess()},this.saveAndManageAccess=()=>{for(const e of this.props.sharingInfo.sharedLinks()){const t=Ae(e),s=this.state.updatedLinkPolicies[e.url]||t;t.audience!==s.audience&&g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.ChangeSharedLinkAudience,Object.assign({old_audience:t.audience,new_audience:s.audience,screen:u.ScreenName.SettingsScreen},k.buildExtraFromLinkMetadata(e)))}const e=this.getLinkSettingsToUpdate();e.errors||this.setState({isSubmitting:!0},(()=>{this.props.actionHandler.updateLinkSettings(e.requests).then((()=>{this.setState({isSubmitting:!1}),this.props.actionHandler.showScreen(i.MANAGE_SCREEN)})).catch((()=>{this.setState({isSubmitting:!1})}))}))},this.state={currentTab:e.currentTab,isSubmitting:!1,updatedLinkPolicies:{},desiredPolicy:e.currentPolicy,showDowngradeBanner:!1,showAdvancedSettingsWarning:void 0}}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.props.sharingInfo.contentInfo();this.setState({isSubmitting:!1}),g.logTiburonEvent(e,this.props.user.id,u.TiburonEventName.ViewSettingsScreen,{settings_tab:this.getCurrentTab()}),g.logTiburonEvent(e,this.props.user.id,u.TiburonEventName.ViewSettingsTab,{settings_tab:this.getCurrentTab()}),g.publishShopModalEvent(i.CampaignEvents.SHARE_MODAL_SETTINGS_OPENED,e,this.props.sharingInfo.getReferrer()),"OFF"!==this.props.sharingPrefs.core_act_docsend_advanced_sharing&&("V1"===this.props.sharingPrefs.core_act_docsend_advanced_sharing&&R.setHasOpenedSharingSettingsInUserMetadata(this.props.user.id),i.logEvent({class:"onboard",action:"shown",object:"core_act_docsend_advanced_sharing_options",properties:{experimentVariant:this.props.sharingPrefs.core_act_docsend_advanced_sharing}}))}))}shouldShowUnshare(){return this.props.sharingInfo.permissionsObj().canUnshare()&&(!this.props.isFolder||!this.props.isInContentManager&&this.props.isSharedFolder)}getLinkSettingsToUpdate(){const e={errors:!1,requests:[]};for(const t of this.props.sharingInfo.sharedLinks()){const s=Ae(t),n=this.state.updatedLinkPolicies[t.url],i=Le(t,n||s,s);if(i&&i.settings)e.requests.push(i);else if(null===i){e.errors=!0;break}}return e}tooManyFilesSnackbar(){return i.Snackbar.show(Nt(i.Snackbar,{actionButtonText:r.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),closeButtonText:r.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),onActionClick:()=>i.open_tab("/help/files-folders/unshare-folder#foldersize"),title:r.intl.formatMessage({id:"DWcV9y",defaultMessage:"Unsharing unsuccessful. This folder has too many files."}),variant:"fail"}))}renderTitle(){let e;const t={file_or_folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)};return e=r.intl.formatMessage({id:"NHPru6",defaultMessage:"Settings for “{file_or_folder_name}”"},t),e}handleUnshareFile(){U.logBrowseTTS("unshare_file"),g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.AttemptRemoveAllMembers);d.confirmResetAccess({allowLeaveACopy:!1,contentName:this.props.folderName,isFolder:!1,isNestedSharedFolder:!1,onConfirm:()=>(i.Snackbar.sync(r.intl.formatMessage({id:"JopplL",defaultMessage:"Unsharing <st>{file_name}</st>..."},{st:e=>n.React$1.createElement("strong",null,e),file_name:this.props.folderName}),!0,"unshare-file-notification"),this.props.client.unshare({contentId:this.props.sharingInfo.contentId()}).then((()=>{g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.SucceedRemoveAllMembers,{http_status_code:200,response_status:"success"});const e=[this.props.sharingInfo.contentId().toString()];i.getStoreForSharedWith().dispatch(i.sharedFileDataOutOfDate(e)),i.Snackbar.complete(r.intl.formatMessage({id:"4fsv5F",defaultMessage:"Unshared <st>{file_name}</st>."},{st:e=>n.React$1.createElement("strong",null,e),file_name:this.props.folderName}),"unshare-file-notification"),i.Modal$1.close()})).catch((e=>{g.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,u.TiburonEventName.FailRemoveAllMembers,{http_status_code:e.raw&&e.raw.status,error_message:e.error[".tag"]?e.error[".tag"]:"undefined_error"})}))),onCancel:()=>i.Modal$1.close()})}getTabs(){const e=[];return this.props.currentPolicy&&(this.props.isFolder?e.push({id:m.FOLDER_SETTINGS,label:r.intl.formatMessage({id:"jR9e/q",defaultMessage:"Folder settings"})}):e.push({id:m.FILE_SETTINGS,label:r.intl.formatMessage({id:"TdlC4Q",defaultMessage:"File settings"})})),this.showEditLinkSettingsTab()&&e.push({id:m.EDIT_LINK_SETTINGS,label:r.intl.formatMessage({id:"DIbS2E",defaultMessage:"Link for editing"})}),this.showViewLinkSettingsTab()&&e.push({id:m.VIEW_LINK_SETTINGS,label:r.intl.formatMessage({id:"rvYosE",defaultMessage:"Link for viewing"})}),e}showEditLinkSettingsTab(){return!!this.props.sharingInfo.editRighteousLink()||(this.props.isFolder?this.props.sharingInfo.permissionsObj().canInviteEditor()&&!this.props.isTeamSharedFolder&&!this.props.isInContentManager:!this.props.isInContentManager&&this.props.sharingInfo.permissionsObj().canCreateEditLink())}showViewLinkSettingsTab(){return!this.props.isTeamSharedFolder&&!this.props.isInContentManager}isTeamFolderTree(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree}getFolderSettingsDescription(){let e;if(this.props.sharingInfo.permissionsObj().canChangeOptions()&&!this.props.user.is_team_admin)return e=this.isTeamFolderTree()?r.intl.formatMessage({id:"fYsGwY",defaultMessage:"Only team admins can change these settings."}):this.props.sharingInfo.isOwner()?r.intl.formatMessage({id:"fvfb8u",defaultMessage:"Only the owner (you) can change these settings. Settings apply to all folders in “{folder_name}.”"},{folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}):r.intl.formatMessage({id:"ZKGUCp",defaultMessage:"Only the owner can change these settings. Settings apply to all folders in “{folder_name}.”"},{folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}),n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:e})}getFileSettingsDescription(){if(this.props.sharingInfo.permissionsObj().canChangeOptions())return n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:r.intl.formatMessage({id:"JK63j9",defaultMessage:"Anyone with edit access can change these settings."})})}getFileSettingsBanner(){if(this.props.sharingInfo.permissionsObj().canChangeOptions())return;let e;var t,s;return this.props.currentPolicy&&this.props.permissions&&(t=this.props.currentPolicy,s=this.props.permissions,e="enabled"===t.get(m.VIEWER_INFO_POLICY)?s.disable_viewer_info?ye(s.disable_viewer_info.reason):void 0:s.enable_viewer_info?ye(s.enable_viewer_info.reason):void 0),e||(e=r.intl.formatMessage({id:"lxNU0Z",defaultMessage:"You don’t have permission to change the settings on this file."})),n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"error",message:e})}shouldRenderContentManagerBridge(){return!this.props.isInContentManager&&(!!x.GoldenGate.hasContentManagerAndSuperAdmin(this.props.user.id)&&(!!this.props.isTeamSharedFolder||!(!this.props.isFolderInsideTeamFolderTree||!this.props.isUserOnOwnerTeam)&&(this.props.currentTab===m.FOLDER_SETTINGS||!this.props.sharingInfo.permissionsObj().canInviteEditor())))}getFolderSettingsBanner(){let e;const t=r.intl.formatMessage({id:"PXwJ3O",defaultMessage:"These settings will apply to all folders inside “{folder_name}”."},{folder_name:this.props.folderName});if(this.props.isInContentManager&&this.isTeamFolderTree())e=t;else if(this.shouldRenderContentManagerBridge()){const t=i.parent_dir(this.props.sharingInfo.fqPath()),s=D.genContentManagerBridgeUri({containingFolder:t,filenameToSelect:this.props.folderName}),a=r.intl.formatMessage({id:"+XzGBK",defaultMessage:"These settings will apply to all folders inside “{folder_name}”. You can change these settings in the Admin Console."},{folder_name:this.props.folderName});e=n.React$1.createElement("div",null,a+" ",n.React$1.createElement("div",null,n.React$1.createElement("a",{href:s.toString(),target:"_blank",rel:"noreferrer"},r.intl.formatMessage({id:"hwq/Wo",defaultMessage:"Go to Admin Console."}))))}else if(this.isTeamFolderTree())e=n.React$1.createElement("div",null,t+" ",n.React$1.createElement("div",null,n.React$1.createElement("a",{href:"/team",target:"_blank"},r.intl.formatMessage({id:"RgAHdC",defaultMessage:"To edit, ask your admin."}))));else{if(this.props.sharingInfo.permissionsObj().canChangeOptions())return this.props.isInContentManager&&!this.isTeamFolderTree()?n.React$1.createElement($e,{isInSharingSettingsModal:!0}):void 0;e=r.intl.formatMessage({id:"7JZv2f",defaultMessage:"Only the owner can change these settings. Settings apply to all folders in “{folder_name}.”"},{folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)})}return n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"error",message:e})}linkControlPolicyWarning(e){const t=this.getCurrentLink(e);if(!t)return;const{link_permissions:s}=t,i=Ae(t),a=this.state.updatedLinkPolicies[t.url]||i,o=O.getLinkControlPolicyWarningText(i,a,s,r.intl);return o?n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"warn",message:o}):void 0}editFolderLinkSettingWarning(e){if("editor"!==e||!this.props.sharingInfo.isFolder())return;const t=this.getCurrentLink(e);if(t){if(void 0===this.state.showAdvancedSettingsWarning){if(!t.link_permissions.require_password&&!t.expires)return}else if(!this.state.showAdvancedSettingsWarning)return;return n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"warn",message:r.intl.formatMessage({id:"NCBSt0",defaultMessage:"This setting won’t apply to people who join this folder to collaborate."}),descriptionLinkUrl:"https://help.dropbox.com/files-folders/share/set-link-permissions",descriptionLinkText:r.intl.formatMessage({id:"TV9B2p",defaultMessage:"Learn More"})})}}getCurrentLink(e){let t;return"editor"===e?t=this.props.sharingInfo.editRighteousLink():(t=this.props.sharingInfo.viewRighteousLink(),t||(t=this.props.sharingInfo.shmodelLink())),t}getLinkSettingsBanner(e){let t=!1;const s=this.getCurrentLink(e);if(!s)return;if(s.isRighteousLink())!1===s.link_permissions.can_use_extended_sharing_controls&&(t=!0);else{const e=s.link_permissions;t=e.audience_options.filter((e=>e.disallowed_reason===i.LinkAudienceDisallowedReason.UserAccountType)).length>0||!1===e.can_disallow_download}if(this.props.sharingInfo&&this.props.sharingInfo.isFamilyUser()&&(t=!1),!t)return;let a,o;1===this.props.user.is_team?(a="/team/upgrade",o=r.intl.formatMessage({id:"TfYT+f",defaultMessage:"Upgrade to {trademark_business} to enable all link settings."},{trademark_business:$.TRADEMARK_BUSINESS})):(a="/upgrade?oqa=sfp&_tk=sg_pro_bundle_header",this.props.sharingInfo&&"OFF"!==this.props.sharingInfo.shareModalUpsellPremiumSharingVariant()&&(a=vt(this.props.user,this.props.sharingInfo.shareModalUpsellPremiumSharingVariant(),"sg_pro_bundle_header")),o=r.intl.formatMessage({id:"VvOgoh",defaultMessage:"Upgrade to Dropbox {trademark_professional} to enable all link settings."},{trademark_professional:$.TRADEMARK_PROFESSIONAL}));const l=n.React$1.createElement("div",null,n.React$1.createElement(bt,{trackingId:"link_settings_pro_upsell",user:this.props.user,contentInfo:this.props.sharingInfo&&this.props.sharingInfo.contentInfo(),href:a,target:"_blank",rel:"noopener noreferrer"},o));return n.React$1.createElement(F.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:l})}getFolderSettingPolicies(){const e=[];return Boolean(this.props.ownerTeam)&&e.push(m.MEMBER_POLICY),e.push(m.ACL_UPDATE_POLICY),Boolean(this.props.ownerTeam)&&e.push(m.FOLDER_LINK_AUDIENCE_POLICY),this.props.currentPolicy&&(this.props.currentPolicy instanceof i.FilePolicy||this.props.currentPolicy instanceof i.FolderPolicy)&&null!=this.props.currentPolicy.viewer_info_policy&&!this.shouldRenderContentManagerBridge()&&e.push(m.VIEWER_INFO_POLICY),e}getFileSettingPolicies(){const e=[];return this.props.currentPolicy&&(this.props.currentPolicy instanceof i.FilePolicy||this.props.currentPolicy instanceof i.FolderPolicy)&&null!=this.props.currentPolicy.viewer_info_policy&&e.push(m.VIEWER_INFO_POLICY),e}getTabInfo(e){switch(e){case m.FILE_SETTINGS:return{title:r.intl.formatMessage({id:"vTaaOS",defaultMessage:"File settings"}),banner:this.getFileSettingsBanner(),description:this.getFileSettingsDescription(),content:this.getFileFolderSettingsContent(this.getFileSettingPolicies())};case m.FOLDER_SETTINGS:return{title:r.intl.formatMessage({id:"3QmSF8",defaultMessage:"Folder settings"}),banner:this.getFolderSettingsBanner(),description:this.getFolderSettingsDescription(),content:this.getFileFolderSettingsContent(this.getFolderSettingPolicies())};case m.EDIT_LINK_SETTINGS:return{title:r.intl.formatMessage({id:"/0odKW",defaultMessage:"Link for editing"}),banner:this.getLinkSettingsBannerAndWarning("editor"),description:null,content:this.renderLinkSettings("editor")};case m.VIEW_LINK_SETTINGS:return{title:r.intl.formatMessage({id:"O2aovx",defaultMessage:"Link for viewing"}),banner:this.getLinkSettingsBannerAndWarning("viewer"),description:null,content:this.renderLinkSettings("viewer")};default:throw new Error("tabName not found")}}getFileFolderSettingsContent(e){const t=we(this.state.desiredPolicy,this.props.currentPolicy);return n.React$1.createElement(We,{policies:e,policyUpdate:t,isFolder:this.props.isFolder,isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,ownerTeam:this.props.ownerTeam,onPolicyUpdate:this.handlePolicyUpdate,teamPolicy:this.props.sharingInfo.teamPolicy(),currentPolicy:this.props.currentPolicy,showContentManagerBridge:this.shouldRenderContentManagerBridge(),permissions:this.props.permissions})}renderLinkSettings(e){if(this.props.sharingInfo)return n.React$1.createElement("div",null,this.state.showDowngradeBanner&&this.renderDowngradeBanner(),n.React$1.createElement(It,{client:this.props.client,sharingInfo:this.props.sharingInfo,sharingPrefs:this.props.sharingPrefs,updatedLinkPolicies:this.state.updatedLinkPolicies,onDeleteLink:this.onDeleteLink,onCancelDeleteLink:this.onCancelDeleteLink,onPolicyUpdate:this.handleLinkPolicyUpdate,actionHandler:this.props.actionHandler,accessLevel:e,isLinkVisitor:this.props.isLinkVisitor}))}renderDowngradeBanner(){return n.React$1.createElement(m.SharingModalDowngradeBanner,{header:r.intl.formatMessage(Pt.downgradeBannerHeader),subheader:r.intl.formatMessage(Pt.downgradeBannerSubheader),outlineButtonLabel:r.intl.formatMessage(Pt.downgradeBannerGotIt),transparentButtonLabel:r.intl.formatMessage(Pt.downgradeBannerManageLinks),onClickOutlineButton:this.hideDowngradeBanner,onClickCloseButton:this.hideDowngradeBanner,onClickTransparentButton:this.openManageAccess,showCloseButton:!0})}allowSaveSettings(){return[m.EDIT_LINK_SETTINGS,m.VIEW_LINK_SETTINGS].includes(this.getCurrentTab())?Object.keys(this.state.updatedLinkPolicies).length>0:!this.state.desiredPolicy.equals(this.props.currentPolicy)}getLinkSettingsBannerAndWarning(e){const t=this.linkControlPolicyWarning(e),s=this.editFolderLinkSettingWarning(e),i=this.getLinkSettingsBanner(e);if(s||t||i)return n.React$1.createElement("div",null,s,t,i)}}xt.displayName="SharingSettingsModal";const Pt=i.defineMessages({downgradeBannerHeader:{id:"V2Zurn",defaultMessage:"People who have used this link might still have access"},downgradeBannerSubheader:{id:"rqdCog",defaultMessage:"You can check the list of people with access and remove them."},downgradeBannerGotIt:{id:"YCTkuR",defaultMessage:"Got It"},downgradeBannerManageLinks:{id:"UBFEXr",defaultMessage:"Who still has access?"}}),Ft=i.requireCssWithComponent(xt,["/static/metaserver/static/css/sharing/share_modal-vflClWHjs.css","/static/metaserver/static/css/modal-vflf1hwfZ.css","/static/typescript/component_libraries/spectrum-sharing/src/index.web-vflfVzbR3.css"]);class Ot extends n.React$1.Component{constructor(){super(...arguments),this.dismissModal=()=>{i.Modal$1.close(),this.handleDismissed()},this.handleDismissed=()=>{this.props.onClose&&this.props.onClose()},this.handleNavigateToParentFolder=e=>()=>{i.Modal$1.close(),this.props.onParentFolderClicked&&this.props.onParentFolderClicked(e.path,this.arePermissionsAllowed(e.permissions))},this.arePermissionsAllowed=e=>e.some((e=>e&&e.allow)),this.getInfoStr=e=>"remove"===this.props.originalAction?r.intl.formatMessage({id:"Wg804T",defaultMessage:"{count, plural, one{To remove them from <b>{content_name}</b>, you'll need to remove them from the parent folder <b>{single_parent_folder_name}</b>.} other{To remove them from <b>{content_name}</b>, you'll need to remove them from the parent folders listed.}}"},Object.assign({count:this.props.memberAccessLevelResult.parentFolders.length},e)):r.intl.formatMessage({id:"u9QEXM",defaultMessage:"{count, plural, one{To change their access to <b>{content_name}</b>, you'll need to change their access to the parent folder <b>{single_parent_folder_name}</b>.} other{To change their access to <b>{content_name}</b>, you'll need to change their access to the parent folders listed.}}"},Object.assign({count:this.props.memberAccessLevelResult.parentFolders.length},e)),this.getSimpleContentInfoStr=e=>"remove"===this.props.originalAction?r.intl.formatMessage({id:"P4ldKD",defaultMessage:"Because they have access to the parent folder, they can't be removed from <b>{content_name}</b>."},e):r.intl.formatMessage({id:"FziuiR",defaultMessage:"Because they can edit the parent folder, their access to <b>{content_name}</b> can't be changed."},e),this.renderParentFolderContent=()=>n.React$1.createElement("div",null,this.getInfoStr({member_name:i.Emstring.em_snippet(this.props.memberDisplayName,i.SNIPPET_SIZES.DISPLAY_NAME),content_name:i.Emstring.em_snippet(this.props.contentInfo.name()||"",i.SNIPPET_SIZES.FILENAME),single_parent_folder_name:i.Emstring.em_snippet(1===this.props.memberAccessLevelResult.parentFolders.length?this.props.memberAccessLevelResult.parentFolders[0].name:"",i.SNIPPET_SIZES.FILENAME),b:e=>n.React$1.createElement("b",null,e)}),n.React$1.createElement("div",{className:"parent-folder-access-modal__folder-list u-mar-top-s"},n.React$1.createElement("ul",{className:"o-list-ui o-list-ui--dividers"},this.props.memberAccessLevelResult.parentFolders.map(this.renderParentFolder)))),this.renderParentFolder=e=>n.React$1.createElement("li",null,n.React$1.createElement("div",{className:"parent-folder-access-modal__parent-folder u-pad-vertical-xs u-pad-horizontal-s",onClick:this.handleNavigateToParentFolder(e)},n.React$1.createElement(h.Flag,{leftAttachment:n.React$1.createElement(i.SharedFolderIcon,null),rightAttachment:this.renderFolderLink(e),spacing:"xs"},n.React$1.createElement("span",{className:"parent-folder-access-modal__folder-name"},i.Emstring.em_snippet(e.name,i.SNIPPET_SIZES.FILENAME))))),this.renderFolderLink=e=>n.React$1.createElement("button",{className:"button-as-link",onClick:this.handleNavigateToParentFolder(e),type:"button"},this.arePermissionsAllowed(e.permissions)?r.intl.formatMessage({id:"IyoET0",defaultMessage:"Manage access"}):r.intl.formatMessage({id:"D3p2Rv",defaultMessage:"View folder"})),this.renderSimpleContent=()=>n.React$1.createElement("div",null,n.React$1.createElement("span",{className:"parent-folder-access-modal__warning"},this.getSimpleContentInfoStr({content_name:i.Emstring.em_snippet(this.props.contentInfo.name()||"",i.SNIPPET_SIZES.FILENAME),b:e=>n.React$1.createElement("b",null,e)})),n.React$1.createElement("div",{className:"u-mar-top-m clearfix"},n.React$1.createElement("div",{className:"u-l-fr"},n.React$1.createElement("button",{className:"c-btn c-btn--primary confirm-button",onClick:this.dismissModal},r.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}))))),this.getTitleStr=()=>"remove"===this.props.originalAction?this.displayParentFolderContent()?i.defineMessage({id:"W05Pm/",defaultMessage:"Couldn't remove {member_name}"}):i.defineMessage({id:"pE8z12",defaultMessage:"Can't remove {member_name}"}):this.displayParentFolderContent()?i.defineMessage({id:"o9ZIdD",defaultMessage:"Couldn't change access for {member_name}"}):i.defineMessage({id:"PR8RwD",defaultMessage:"Can't change access for {member_name}"}),this.displayParentFolderContent=()=>this.props.memberAccessLevelResult.parentFolders&&!this.props.isInContentManager}render(){const e=this.getTitleStr();return n.React$1.createElement(i.Modal$1,{autoClose:!1,className:"parent-folder-access-modal",buttonComponent:n.React$1.createElement("span",null),onDismissCompleted:this.handleDismissed,title:r.intl.formatMessage(e,{member_name:i.Emstring.em_snippet(this.props.memberDisplayName,i.SNIPPET_SIZES.DISPLAY_NAME)})},n.React$1.createElement("div",{className:"parent-folder-access-modal__contents"},this.displayParentFolderContent()?this.renderParentFolderContent():this.renderSimpleContent()))}}Ot.displayName="ParentFolderAccessModal";const Dt=(e,t,s,n)=>{a.catchApiError((()=>(s&&s(),i.Snackbar.close(n),e instanceof a.ServerError?i.Snackbar.fail(t):i.Modal$1.close(),K.Notify.error(e.message||r.intl.formatMessage({id:"EQfnGr",defaultMessage:"We were unable to complete your request."})),e)))(e)};class $t{constructor(e,t,s,n){this.initialIsConfidentialFolder=e,this.teamName=s,this.folderName=i.filename(t),this.parentFolderName=n,this.topMostLevelFolder=""===n,this.folderSnippet=i.Emstring.em_snippet(this.folderName,15),this.parentFolderSnippet=i.Emstring.em_snippet(this.parentFolderName,15),this.teamSnippet=i.Emstring.em_snippet(this.teamName,i.SNIPPET_SIZES.DISPLAY_NAME)}getActionString(){const e=i.Emstring.em_snippet(this.teamName,i.SNIPPET_SIZES.DISPLAY_NAME),t=this.topMostLevelFolder?r.intl.formatMessage({id:"xbrdNQ",defaultMessage:"Share with {team_name}"},{team_name:e}):r.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"});return this.initialIsConfidentialFolder?t:r.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"})}getTitleContent(){let e;return e=this.initialIsConfidentialFolder?this.topMostLevelFolder?r.intl.formatMessage({id:"XmdmiQ",defaultMessage:"Share “{folder_name}” with everyone at {team_name}?"},{folder_name:this.folderSnippet,team_name:this.teamSnippet}):r.intl.formatMessage({id:"o2uL8S",defaultMessage:"Share “{folder_name}” with everyone who can access “{parent_folder_name}”?"},{folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet}):this.topMostLevelFolder?r.intl.formatMessage({id:"fYJ2Zy",defaultMessage:"Remove members of {team_name}?"},{team_name:this.teamSnippet}):r.intl.formatMessage({id:"qioX4z",defaultMessage:"Remove members of “{folder_name}” folder?"},{folder_name:this.parentFolderSnippet}),e}getBodyContent(){let e;return e=this.initialIsConfidentialFolder?this.topMostLevelFolder?r.intl.formatMessage({id:"+yGlTj",defaultMessage:"<strong>{folder_name}</strong> won’t be shared privately any more. Everyone at {team_name} will have access to this folder."},{team_name:this.teamSnippet,folder_name:this.folderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}):r.intl.formatMessage({id:"qc2+KU",defaultMessage:"Everyone who can access <strong>{parent_folder_name}</strong> will be able to access this folder."},{parent_folder_name:this.parentFolderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}):this.topMostLevelFolder?r.intl.formatMessage({id:"EFGwFd",defaultMessage:"Members of {team_name} won’t be able to access <strong>{folder_name}</strong>."},{team_name:this.teamSnippet,folder_name:this.folderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}):r.intl.formatMessage({id:"8x9N0T",defaultMessage:"Members of <strong>{parent_folder_name}</strong> folder won’t be able to access <strong>{folder_name}</strong>."},{parent_folder_name:this.parentFolderSnippet,folder_name:this.folderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}),n.React$1.createElement("div",null,n.React$1.createElement("div",{className:"confirmation-modal__content"},e),n.React$1.createElement("br",null))}syncSnackMessage(e){return e?r.intl.formatMessage({id:"YFmCHZ",defaultMessage:"Removing members from <strong>{folder_name}</strong>…"},{folder_name:this.folderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}):this.topMostLevelFolder?r.intl.formatMessage({id:"4xzuPe",defaultMessage:"Sharing <strong>{folder_name}</strong> with everyone…"},{folder_name:this.folderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}):r.intl.formatMessage({id:"DI9fEf",defaultMessage:"Sharing <strong>{folder_name}</strong> with members of <strong>{parent_folder_name}</strong>…"},{folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)})}completeSnackMessage(e){return e?r.intl.formatMessage({id:"r445sC",defaultMessage:"Members removed from <strong>{folder_name}</strong>."},{folder_name:this.folderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}):this.topMostLevelFolder?r.intl.formatMessage({id:"a5EQjJ",defaultMessage:"<strong>{folder_name}</strong> shared with everyone."},{folder_name:this.folderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)}):r.intl.formatMessage({id:"67McYW",defaultMessage:"<strong>{folder_name}</strong> shared with members of <strong>{parent_folder_name}</strong>."},{folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet,strong:e=>n.React$1.createElement("strong",{style:{fontWeight:500}},e)})}failSnackMessage(e){return e?r.intl.formatMessage({id:"otsE6R",defaultMessage:"Too many members to restrict access. Try adding specific people to a new folder."}):r.intl.formatMessage({id:"Z4c55e",defaultMessage:"Couldn’t share folder. Try sharing again."})}}class Bt{constructor(e,t,s,a,o,l,c){this.getButtonText=()=>this.isDowngrading?r.intl.formatMessage({id:"/sfVvH",defaultMessage:"Change access"}):this.isTsdPlusOne?r.intl.formatMessage({id:"g7vg1d",defaultMessage:"Remove everyone"}):r.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"}),this.getConfirmModalTitleString=()=>this.isRelinquishment?r.intl.formatMessage({id:"amnrJj",defaultMessage:"Remove yourself from “{parent_folder}”?"},{parent_folder:this.parentFolderName}):this.isDowngrading?r.intl.formatMessage({id:"x01mJ5",defaultMessage:"Change how members can access “{current_folder}”?"},{current_folder:this.currentFolderName}):this.isTsdPlusOne?r.intl.formatMessage({id:"sSJ+PD",defaultMessage:"Remove everyone at {team_name}?"},{team_name:this.teamName}):r.intl.formatMessage({id:"F23jdQ",defaultMessage:"Remove a member of “{parent_folder}”?"},{parent_folder:this.parentFolderName}),this.getConfirmModalTitle=()=>{const e={current_folder:this.currentFolderName,parent_folder:this.parentFolderName,team_name:this.teamName,b:e=>n.React$1.createElement("b",{style:{fontWeight:500}},e)};let t;return t=this.isRelinquishment?i.defineMessage({id:"ANxsmU",defaultMessage:"<b>Remove yourself from “{parent_folder}”?</b>"}):this.isDowngrading?i.defineMessage({id:"fG6HZx",defaultMessage:"<b>Change how members can access “{current_folder}”?</b>"}):this.isTsdPlusOne?i.defineMessage({id:"7gnJT/",defaultMessage:"<b>Remove everyone at {team_name}?</b>"}):i.defineMessage({id:"tAFtaB",defaultMessage:"<b>Remove a member of “{parent_folder}”?</b>"}),r.intl.formatMessage(t,e)},this.getConfirmModalContent=()=>{const e={member_name:this.memberName,parent_folder:this.parentFolderName,current_folder:this.currentFolderName,team_name:this.teamName,b:e=>n.React$1.createElement("b",{style:{fontWeight:500}},e),br:n.React$1.createElement("br",null)};let t;return t=this.isRelinquishment?i.defineMessage({id:"hfMe4J",defaultMessage:"You won’t be able to see future changes to this shared folder, and new members of <b>{parent_folder}</b> won’t have access to this folder automatically."}):this.isTsdPlusOne?this.isDowngrading?i.defineMessage({id:"xO44hJ",defaultMessage:"{member_name} will only be able to view this folder, and new {team_name} members won’t be able to access it automatically.{br}{br}To add more people to this folder in the future, you’ll need to invite them directly."}):i.defineMessage({id:"8bNVGs",defaultMessage:"{team_name} members won’t be able to see future changes to <b>{current_folder}</b> automatically.{br}{br}To give people access to this folder in the future, you’ll need to invite them directly."}):this.isDowngrading?i.defineMessage({id:"eo+uWg",defaultMessage:"{member_name} will only be able to view this folder, and new members of <b>{parent_folder}</b> won’t be able to access it automatically.{br}{br}To add more people to this folder in the future, you’ll need to invite them directly."}):i.defineMessage({id:"zDnrtL",defaultMessage:"{member_name} and new members of the <b>{parent_folder}</b> folder won’t be able to see future changes to this shared folder.{br}{br}To add more people to this folder in the future, you’ll need to invite them directly."}),r.intl.formatMessage(t,e)},this.getSnackBarRemovingString=()=>{const e={b:e=>n.React$1.createElement("b",{style:{fontWeight:500}},e),current_folder:this.currentFolderName},t=this.isDowngrading?i.defineMessage({id:"0Lmb+Y",defaultMessage:"Changing access for <b>{current_folder}</b>…"}):this.memberIsGroup?i.defineMessage({id:"hpOZFA",defaultMessage:"Removing members from <b>{current_folder}</b>…"}):i.defineMessage({id:"tbN3jw",defaultMessage:"Removing member from <b>{current_folder}</b>…"});return r.intl.formatMessage(t,e)},this.getSnackBarCompleteString=()=>{const e={b:e=>n.React$1.createElement("b",{style:{fontWeight:500}},e),current_folder:this.currentFolderName},t=this.isDowngrading?i.defineMessage({id:"srndH4",defaultMessage:"Access changed for <b>{current_folder}</b>."}):this.memberIsGroup?i.defineMessage({id:"bnI+zs",defaultMessage:"Members removed from <b>{current_folder}</b>."}):i.defineMessage({id:"GWzQpn",defaultMessage:"Member removed from <b>{current_folder}</b>."});return r.intl.formatMessage(t,e)},this.getSnackBarFailString=()=>this.isDowngrading?r.intl.formatMessage({id:"5Yzfj9",defaultMessage:"Couldn’t change access. Try changing access again."}):this.memberIsGroup?r.intl.formatMessage({id:"NCQATi",defaultMessage:"Couldn’t remove members. Try removing them again."}):r.intl.formatMessage({id:"jHXRss",defaultMessage:"Couldn’t remove member. Try removing them again."}),this.isDowngrading=e,this.teamName=t,this.parentFolderName=s,this.currentFolderName=a,this.memberName=o,this.isTsdPlusOne=""===s,this.memberIsGroup=l,this.isRelinquishment=c}}i.injectInternalStyle("metaserver/static/js/sharing/views/inherited_members.module.out.css",(e=>"._inherited-members-modal-overlay_1sp0k_1{z-index:501}"));const Ut="_inherited-members-modal-overlay_1sp0k_1";class Ht extends n.React$1.Component{constructor(e){super(e),this.onToggleShowMemberList=()=>{0!==this.props.members.length&&this.setState({areMembersExpanded:!this.state.areMembersExpanded})},this.handleToggleInheritanceClick=e=>{this.props.actionHandler.handleSetConfidentialClick(!1,this.props.ownerTeamName)},this.state={areMembersExpanded:!1}}renderMembersList(){return this.state.areMembersExpanded?n.React$1.createElement("div",null,n.React$1.createElement("div",{className:"u-mar-top-xs u-mar-horizontal-xs u-pad-top-xs inherited-member-list__divider"}),n.React$1.createElement("div",null,n.React$1.createElement("ul",{className:"u-pad-horizontal-s u-pad-vertical-xs inherited-member-list__member"},this.props.children))):void 0}renderRemoveButton(){return this.props.canUpdateConfidentiality?n.React$1.createElement(i.Button$1,{className:"inherited-member-list__remove-button button-as-link",onClick:this.handleToggleInheritanceClick,variant:"styleless"},r.intl.formatMessage({id:"aPhz2c",defaultMessage:"Remove"})):void 0}renderTriangle(){return 0===this.props.members.length?n.React$1.createElement("div",{className:"u-pad-horizontal-xs"}):n.React$1.createElement(i.Button$1,{className:"u-pad-horizontal-xxs o-flag__fix inherited-member-list__triangle button-as-link",onClick:this.onToggleShowMemberList,variant:"styleless"},n.React$1.createElement(i.Sprite,{alt:r.intl.formatMessage({id:"Bcpu+z",defaultMessage:"Toggle whether inherited members are displayed or hidden"}),group:"web",name:this.state.areMembersExpanded?"triangle_open_1x":"triangle_closed_1x"}))}render(){const e=this.props.actionHandler.getSharingInfo().parentFolderName(),t=""===e?r.intl.formatMessage({id:"6fi/fQ",defaultMessage:"Everyone at {team_name}"},{team_name:i.Emstring.em_snippet(this.props.ownerTeamName,i.SNIPPET_SIZES.DISPLAY_NAME)}):r.intl.formatMessage({id:"U5hJI+",defaultMessage:"People with access to “{folder_name}” folder"},{folder_name:i.Emstring.em_snippet(e,i.SNIPPET_SIZES.FILENAME)});let s=0,a=null;this.props.memberCounts&&(a=this.props.contentInfo.isSharedFolder()?this.props.memberCounts.total_unique_inherited_members:this.props.memberCounts.total_unique_users),null!=a&&0!==a?s=a:this.props.members.forEach((e=>{e instanceof i.GroupMembershipInfo?s+=e.member_count:s++}));const o=r.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:s}),l=i.classnames([{"u-mar-bottom-xs":!0,"inherited-member-list__outer-expanded":this.state.areMembersExpanded,"inherited-member-list__outer-closed":!this.state.areMembersExpanded,"inherited-member-list__outer-spectrum":!0}]),c=i.classnames([{"inherited-member-list__inner":!this.state.areMembersExpanded}]);return n.React$1.createElement("div",{className:l},n.React$1.createElement("div",{className:c},n.React$1.createElement("div",{className:"o-flag inherited-member-list__toggle-show-member",onClick:this.onToggleShowMemberList},this.renderTriangle(),n.React$1.createElement("div",{className:"o-flag__flex u-pad-vertical-xs u-pad-right-s"},n.React$1.createElement("div",{className:"o-flag"},n.React$1.createElement("div",{className:"o-flag__fix"},n.React$1.createElement(i.IconContent,{name:"folder_shared-small"})),n.React$1.createElement("div",{className:"o-flag__flex u-pad-left-s"},n.React$1.createElement("div",{className:"inherited-member-list__member-str u-font-strong"},t),n.React$1.createElement("div",{className:"inherited-member-list__member-count-str u-font-meta"},o)),n.React$1.createElement("div",{className:"o-flag__fix u-pad-right-xxs"},this.renderRemoveButton())))),n.React$1.createElement("div",null,this.renderMembersList())))}}Ht.displayName="InheritedMembers";class Vt extends n.React$1.Component{constructor(e){super(e),this._onToggleConfidentialFolderFalse=()=>{this._onToggleConfidentialFolder(!1)},this.state={isAccepting:!1};const t=e.actionHandler.getSharingInfo().displayPath(),s=e.actionHandler.getSharingInfo().parentFolderName();this.contentGenerator=new $t(e.initialIsConfidentialFolder,t,e.teamName,s)}_onToggleConfidentialFolder(e){const t=!e,s=e===this.props.initialIsConfidentialFolder;e||this.setState({isAccepting:!0});const{actionHandler:a,contentInfo:o}=this.props;i.Snackbar.sync(this.contentGenerator.syncSnackMessage(s),!0,"share-folder-notification");const l=o.isSharedFolder();return a.handleSetConfidential(s).then((e=>{a.fetchDataAndShowShareModal(),s&&i.WebUserActionLog.log(this.props.userId,t?i.WebUserActionLogEvent.CONF_BY_MANAGE_ACCESS:i.WebUserActionLogEvent.CONF_BY_UNDO_AFTER_RESTORE_ACCESS,{ns_id:e.shared_folder_id,original_folder_type:l?i.WebUserActionLogExtraValue.SHARED_FOLDER:i.WebUserActionLogExtraValue.FILE_FOLDER})})).then((()=>{const e=this.contentGenerator.completeSnackMessage(s);t?i.Snackbar.show(n.React$1.createElement(i.Snackbar,{title:e,timeoutDelayMs:1e4,actionButtonText:r.intl.formatMessage({id:"OfxyEk",defaultMessage:"Undo"}),onActionClick:()=>this._onToggleConfidentialFolder(!0),closeButtonText:r.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),variant:"complete",id:"share-folder-notification"})):i.Snackbar.complete(e,"share-folder-notification")})).catch((e=>Dt(e,this.contentGenerator.failSnackMessage(s),(()=>this.setState({isAccepting:!1})),"share-folder-notification")))}render(){return n.React$1.createElement(z.UtilityModal,{ariaLabel:this.contentGenerator.getTitleContent(),title:this.contentGenerator.getTitleContent(),overlayClickClose:!0,primaryAction:this.contentGenerator.getActionString(),secondaryAction:r.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onPrimaryAction:this._onToggleConfidentialFolderFalse,onSecondaryAction:this.props.onCancel,open:!0,onRequestClose:this.props.onCancel,overlayClassName:Ut},this.contentGenerator.getBodyContent())}}Vt.displayName="SetInheritedMembersUIConfidentialModal";class Gt extends n.React$1.Component{constructor(e){super(e),this.actionCompleteCallback=()=>{const{actionHandler:e}=this.props;f.sharingNotificationSuccess(this.contentGenerator.getSnackBarCompleteString()),this.setState({removing:!1}),e.fetchDataAndShowShareModal()},this.removeTheSelectedMember=()=>{const{member:e,actionHandler:t,isUserSelf:s}=this.props,n=t.getContentInfo().id;return s?t.relinquishMembershipSimple(n,!1):t.removeMemberSimple(n,e.memberId(),!1)},this.changeAccessOfSelectedMember=()=>{const{newAccessLevel:e,actionHandler:t,member:s}=this.props,n=e;return t.changeMemberAccessSimple(t.getContentInfo().id,s.memberId(),n)},this.changeConfidentialAccess=()=>{const{actionHandler:e,userId:t,isSharedFolder:s,isDowngrading:n}=this.props;this.setState({removing:!0});return e.shareIfFileFolder(this.contentGenerator.getSnackBarRemovingString()).then((()=>e.handleSetConfidential(!0,!0).then((()=>this.logWebUserAction(t,n,e.getContentInfo().id,s))))).then((()=>n?this.changeAccessOfSelectedMember():this.removeTheSelectedMember())).then(this.actionCompleteCallback).catch((e=>Dt(e,this.contentGenerator.getSnackBarFailString(),(()=>this.setState({removing:!1})))))},this.state={removing:!1};const{member:t,teamName:s,parentFolderName:n,currentFolderName:a,isDowngrading:r,isUserSelf:o}=this.props;this.contentGenerator=new Bt(r,s,n,a,t.displayName()||"",t instanceof i.GroupMembershipInfo,o)}render(){return n.React$1.createElement(z.UtilityModal,{ariaLabel:this.contentGenerator.getConfirmModalTitleString(),title:this.contentGenerator.getConfirmModalTitleString(),overlayClickClose:!0,primaryAction:this.contentGenerator.getButtonText(),secondaryAction:r.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onPrimaryAction:this.changeConfidentialAccess,onSecondaryAction:this.props.actionHandler.openShareModal,open:!0,onRequestClose:this.props.actionHandler.openShareModal,overlayClassName:Ut},this.renderBody())}renderBody(){return n.React$1.createElement("div",null,n.React$1.createElement("div",{className:"confirmation-modal__content"},this.contentGenerator.getConfirmModalContent()),n.React$1.createElement("br",null))}logWebUserAction(e,t,s,n){i.WebUserActionLog.log(e,t?i.WebUserActionLogEvent.CONF_BY_DOWNGRADE_MEMBER:i.WebUserActionLogEvent.CONF_BY_REMOVE_MEMBER,{ns_id:s,original_folder_type:n?i.WebUserActionLogExtraValue.SHARED_FOLDER:i.WebUserActionLogExtraValue.FILE_FOLDER})}}Gt.displayName="SingleInheritedUserAccessChangeModal";const Wt={state:E.ContactTokenState.invalid,msg:g.CONTACT_ERROR_MESSAGES.SINGLE_INVALID};class Kt{constructor(e){this.validationStopWatchName="async_contact_server_side_validation",this.client=e,i.JSStopwatch.create_stopwatch_if_not_exist(this.validationStopWatchName)}validate(e,t,n,a,r){return s.__awaiter(this,void 0,void 0,(function*(){const s={};r.filter((e=>e.invalid)).forEach((e=>s[e.getKey()]=Wt));const o=r.filter((e=>!e.invalid));if(0===o.length)return s;const l=i.JSStopwatch.startSpan("validation",{stopwatchName:this.validationStopWatchName,async:!0});let c;try{g.logTiburonEvent(n,e,u.TiburonEventName.AttemptTargetValidation),c=yield this.client.validateMembers({contentId:t,accessLevel:a,members:i.contactsToMembers(o,!0)})}catch(t){g.logTiburonEvent(n,e,u.TiburonEventName.FailTargetValidation,{error:t.error?t.error[".tag"]:"unknown server error"});let s=[];try{s=o.map((e=>{const t=e.getContactID()||"";return{mtype:i.contactToMember(e,!0)[".tag"],ctype:e.type,value:`${t.slice(0,1)}__${t.slice(-3)}`,valLen:t.length}}))}catch(e){}_.reportStack("server error in contact validation",{severity:S.SEVERITY.NONCRITICAL,tags:["sharing"],exc_extra:{contactsDebug:s}})}if(!c)return s;g.logTiburonEvent(n,e,u.TiburonEventName.SucceedTargetValidation);const{results:d}=c,h={};return r.forEach((e=>{h[this.selectorToScalarKey(i.contactToMember(e,!0))]=e.getKey()})),d.forEach((e=>{const t=h[this.selectorToScalarKey(e.member)],n=e.target_invite_eligibility;s[t]=Object.assign(Object.assign({},this.calculateValidation(e.result)),{inviteAfterSharingEligibility:n})})),i.JSStopwatch.endSpan("validation",{stopwatchName:this.validationStopWatchName,spanId:l}),setTimeout((()=>i.JSStopwatch.flush_current_data()),0),s}))}selectorToScalarKey(e){const t=e[".tag"];return`${t}-${M.get(e,t)}`}calculateValidation(e){const t=e[".tag"];switch(t){case"allowed":const s=e.allowed[".tag"];switch(s){case"no_warning":return{state:E.ContactTokenState.ok,msg:null};case"outside_of_team":return{state:E.ContactTokenState.warn,msg:g.CONTACT_ERROR_MESSAGES.OUT_OF_TEAM};case"not_dropbox_user":return{state:E.ContactTokenState.warn,msg:"NOT_DROPBOX_USER"};default:return _.reportStack("New allowed warning type without handling",{tags:["sharing"],severity:S.SEVERITY.CRITICAL,exc_extra:{warning:s}}),{state:E.ContactTokenState.ok,msg:null}}case"disallowed":const n=e.disallowed[".tag"];switch(n){case"invalid_member":return{state:E.ContactTokenState.invalid,msg:g.CONTACT_ERROR_MESSAGES.SINGLE_INVALID};case"outside_of_team":return{state:E.ContactTokenState.invalid,msg:g.CONTACT_ERROR_MESSAGES.OUT_OF_TEAM};case"target_is_individual":return{state:E.ContactTokenState.invalid,msg:g.CONTACT_ERROR_MESSAGES.NONGROUP_INVITEE};case"no_permission":return{state:E.ContactTokenState.invalid,msg:g.CONTACT_ERROR_MESSAGES.NO_PERMISSION};default:return _.reportStack("New disallowed error type without handling",{tags:["sharing"],severity:S.SEVERITY.CRITICAL,exc_extra:{error:n}}),{state:"invalid",msg:g.CONTACT_ERROR_MESSAGES.NO_PERMISSION}}default:const i="Unpredicted state in client validation API response";throw _.reportStack(i,{tags:["sharing"],severity:S.SEVERITY.CRITICAL,exc_extra:{state:t}}),new Error(i)}}}const zt="sharing-notification";var jt;!function(e){e.RECORD_VIDEO_SNACKBAR_SHOWN="pg_snackbar_record_video_view",e.RECORD_VIDEO_SNACKBAR_TRY_CLICK="pg_snackbar_record_video_click",e.RECORD_VIDEO_SNACKBAR_DISMISS_CLICK="pg_snackbar_record_video_dismiss"}(jt||(jt={}));const qt="capture-record-video-menu-button",Yt=e=>{i.ProEventsLogger.log(jt.RECORD_VIDEO_SNACKBAR_TRY_CLICK,{user_id:e.userId});const t=document.getElementById(qt);t&&t.click(),i.Snackbar.close(zt)},Zt=()=>({name:"capture_record_video",icon:v.VideoLine,text:r.intl.formatMessage({id:"rzdYhe",defaultMessage:"Add commentary with video"}),onClick:Yt,dataUxaLog:"post_share_snackbar_record_video_click"}),Qt="sharing-notification";var Jt;!function(e){e.ESIGN_SNACKBAR_SHOWN="pg_snackbar_esign_view",e.ESIGN_SNACKBAR_TRY_CLICK="pg_snackbar_esign_click",e.ESIGN_SNACKBAR_DISMISS_CLICK="pg_snackbar_esign_dismiss"}(Jt||(Jt={}));const Xt=t=>{return Promise.all([new Promise((function(t,s){e(["./c_integrations_hellosign_deep_integration_launcher"],t,s)})),(n=t,s.__awaiter(void 0,void 0,void 0,(function*(){const{userId:e,filePath:t}=n,s=new i.UserApiV2Client;try{return(yield s.ns("files").rpc("get_metadata",{path:t},{subjectUserId:e})).id}catch(e){return _.reportException({err:new Error("Failed to get file id"),severity:S.SEVERITY.CRITICAL,exc_extra:{e:e},tags:["rich_snackbar","product-growth","post-sharing-eisgn-rich-snackbar"]}),Promise.reject(e)}})))]).then((([{getLauncher:e},s])=>{const{userId:n,filePath:a}=t;i.ProEventsLogger.log(Jt.ESIGN_SNACKBAR_TRY_CLICK,{user_id:n});const r=e();return r.init({entryPoint:"post_sharing_snackbar",file:{file_id:s,fq_path:a},source:"dropbox-file-hover-overflow-menu-send-for-esign"}),r})).then((e=>(e.launch(),e))).finally((()=>{i.Snackbar.close(Qt)}));var n},es=(e,t,s,a,o,l,c,d)=>{i.Snackbar.close(Qt);let h=l?void 0:r.intl.formatMessage({id:"ACOoAR",defaultMessage:"Did you know you can get this file signed, right in Dropbox?"});const p=r.intl.formatMessage({id:"NAMRb1",defaultMessage:"Send for signature"}),m=[{name:"send_for_signature",icon:b.SendLine,text:p,onClick:Xt,dataUxaLog:"post_share_snackbar_esign_click"}];return c&&(m.push(Zt()),h=void 0),n.React$1.createElement(i.Snackbar,{title:t,id:Qt,variant:"complete",onCloseClick:()=>{d(),i.ProEventsLogger.log(Jt.ESIGN_SNACKBAR_DISMISS_CLICK,{user_id:a})},onShown:()=>{i.ProEventsLogger.log(Jt.ESIGN_SNACKBAR_SHOWN,{user_id:a})},richSnackbarProps:{actionBarAlignment:"left",actions:m,helperText:h,clickHandlerArgs:{userId:a,filePath:s||e,ns_id:o}}})};function ts(e,t){return e.filter((e=>void 0!==e.email)).map((e=>({email:e.email,checkForInvite:t})))}function ss(e){return["member_invite_expand_eligibility","member_suggestion_expand_eligibility"].includes(e)}function ns(e){return e.formatMessage({id:"K/i5x+",defaultMessage:"Password required"})}function is(e,t){const s=function(e){const t=e.expires?e.expires.getTime():0,s=864e5;if(null!=e.expires){let e=t-(new Date).getTime();return e<0&&(e=0),Math.floor(e/s)}return-1}(t);return e.formatMessage({id:"fp7TGs",defaultMessage:"{count, plural, one{Expires in a day} other{Expires in {count} days}}"},{count:s})}function as(e,t){const s=[],n=O.getAudienceForLink(t.link_permissions),i=t.link_permissions.require_password||"password"===n,a=t.expires,r=!t.link_permissions.allow_download;return i&&s.push(ns(e)),a&&s.push(is(e,t)),r&&s.push(function(e){return e.formatMessage({id:"KjJiVt",defaultMessage:"Download disabled"})}(e)),s}class rs extends n.react.exports.Component{render(){return this.shouldRenderCopyLinkEducationTooltip()?n.react.exports.createElement(i.Tooltip,{triggerRef:this.props.linkRef,placement:"top",className:"scl-copy-link-education-tooltip",title:this.renderLinkSettingsTooltipContent()},this.props.children):this.props.children}renderLinkSettingsTooltipContent(){const e=as(this.props.intl,this.props.sharedLink),t=e.length;return n.react.exports.createElement(n.react.exports.Fragment,null,this.props.intl.formatMessage({id:"LLktNG",defaultMessage:"Link settings:"}),t>1?this.renderListOfSettings(e):this.renderOneSetting(e))}renderOneSetting(e){return n.react.exports.createElement(n.react.exports.Fragment,null," ",n.react.exports.createElement("span",null,e[0]))}renderListOfSettings(e){const t=[];return e.forEach((e=>{t.push(n.react.exports.createElement("li",null,e))})),n.react.exports.createElement(n.react.exports.Fragment,null,n.react.exports.createElement("ul",null,t))}shouldRenderCopyLinkEducationTooltip(){return as(this.props.intl,this.props.sharedLink).length>0}}rs.displayName="CopyLinkEducationTooltip";const os=n.React$1.createContext({logEvent:()=>{},experiments:{}}),ls=e=>{const t=n.React$1.useMemo((()=>({logEvent:e.logEvent,experiments:e.experiments})),[e.logEvent,e.experiments]);return n.React$1.createElement(os.Provider,{value:t},e.children)};ls.displayName="ShareModalEvolutionContextProvider";const cs=e=>{const t=e.getSharingInfo();return t&&t.sharingPrefs?t.sharingPrefs().core_act_receiver_red_carpet_variant:"OFF"},ds=e=>{const t=e.getSharingInfo();return t&&t.sharingPrefs?t.sharingPrefs().core_act_docsend_advanced_sharing:"OFF"},hs="share-modal-evolution-share-screen",ps=()=>{const e=document.createElement("input");e.value="sharing is caring",document.body.appendChild(e),e.select();const t=document.queryCommandEnabled("copy");return document.body.removeChild(e),t};class ms extends n.React$1.Component{constructor(e){super(e),this.linkRef=n.React$1.createRef(),this.handleCopyLinkClicked=e=>{e.preventDefault();const t=this.props.getEmailTokenCountFn();this.context.logEvent(u.TiburonEventName.CopySharedLink,this.props.sharedLink,{tokenized_contact_count:t}),W.copyToClipboard(this.props.sharedLink.url,(()=>this.handleClipboardSuccess()),(()=>this.copyLinkToClipboardRetryUsingNativeAPI()))},this.renderCopyLink=e=>n.React$1.createElement("div",{className:"sharing-modal-footer-link-div"},n.React$1.createElement(rs,{key:"copy-link-education-tooltip",intl:r.intl,sharedLink:this.props.sharedLink,linkRef:this.linkRef},n.React$1.createElement(i.Text,{size:this.props.size},n.React$1.createElement(i.Link,{key:"linkCopyToClipboard",href:"#",hasNoUnderline:!0,className:"copy-link-button",onClick:this.handleCopyLinkClicked,isBold:!0,ref:this.linkRef,"data-uxa-log":"sharing-modal-footer-copy-link"},n.React$1.createElement(i.UIIcon,{src:pe.LinkLine,size:this.props.size,"aria-label":""}),e))),this.renderBanner()),this.renderBanner=()=>{const e=this.getLinkRestrictions();return e?n.React$1.createElement(i.Text,{color:"faint"},n.React$1.createElement("span",{className:"sharing-modal-footer-link-margin"},e),n.React$1.createElement("span",{className:"sharing-modal-footer-restrictions-margin"},"·"),n.React$1.createElement(i.Link,{className:"sharing-modal-footer-restrictions-text",inverse:!0,href:"#",onClick:this.props.handleSettingsButtonClick},r.intl.formatMessage({id:"BypDcT",defaultMessage:"Modify"}))):""},this.focusOnInput=()=>{this.inputRef.current&&this.inputRef.current.select()},this.handleCopyLink=()=>{const e=this.props.getEmailTokenCountFn();this.context.logEvent(u.TiburonEventName.CopySharedLink,this.props.sharedLink,{tokenized_contact_count:e}),W.copyToClipboard(this.props.sharedLink.url,(()=>this.handleClipboardSuccess()),(()=>this.copyLinkToClipboardRetryUsingNativeAPI()))},this.renderViewedLinkCopiedText=()=>{const e="editor"===this.props.accessLevel;return n.React$1.createElement("div",{className:`${hs}-footer-link__link-copied`},n.React$1.createElement(i.UIIcon,{className:`${hs}-footer-link__link-copied-icon`,src:i.CheckmarkCircleLine}),n.React$1.createElement(i.Text,{tagName:"p",isBold:!0},e?r.intl.formatMessage({id:"dmwGjM",defaultMessage:"Edit link copied"}):r.intl.formatMessage({id:"opUQcS",defaultMessage:"View link copied"})))},this.inputRef=n.React$1.createRef(),this.state={copySuccess:!1}}componentDidUpdate(e){this.props.createdLink&&this.props.sharedLink&&e!==this.props&&ps()&&this.handleCopyLink()}render(){const e=r.intl.formatMessage({id:"t0Frp1",defaultMessage:"Copy link"});return this.props.createdLink&&this.state.copySuccess&&ps()?this.renderViewedLinkCopiedText():this.renderCopyLink(e)}handleClipboardSuccess(){this.setState({copySuccess:!0},(()=>{f.showCopyLinkSuccessSnackbar(this.props.sharedLink.url,this.props.accessLevel)})),g.trackUserLeapEvent(g.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,i.SHARE_ACTION_ORIGIN_TYPE.SHARE_LINK_MODAL),"V1"===ds(this.props.actionHandler)&&R.setIsEligibleForDocsendSplitShareItemInUserMetadata(this.props.user.id)}copyLinkToClipboardRetryUsingNativeAPI(){navigator.clipboard?navigator.clipboard.writeText(this.props.sharedLink.url).then((()=>this.handleClipboardSuccess()),(()=>this.handleClipboardFailureNativeAPI())):this.handleClipboardFailureNativeAPI()}handleClipboardFailureNativeAPI(){this.context.logEvent(u.TiburonEventName.CopySharedLinkFailure,this.props.sharedLink,{tokenized_contact_count:this.props.getEmailTokenCountFn(),error:"failed_copy_to_clipboard"}),this.setState({copySuccess:!1}),f.showCopyLinkErrorSnackbar(this.props.sharedLink.url,this.props.accessLevel)}getLinkRestrictions(){const e=this.props.sharedLink,t=O.getAudienceForLink(e.link_permissions),s=e.link_permissions.require_password||"password"===t,n=e.expires;return s&&n?r.intl.formatMessage({id:"RVzGyv",defaultMessage:"Restrictions apply"}):s?ns(r.intl):n?is(r.intl,e):void 0}}var us;function gs(){const e=i.Viewer.get_viewer().work_user;if(!e)throw new Error("No active work user");return new i.DefaultUserApiV2Client(e)}ms.displayName="CopyLinkSection",ms.contextType=os,t.GuestPassExpireAction=void 0,(us=t.GuestPassExpireAction||(t.GuestPassExpireAction={})).OFFBOARD="offboard",us.CONVERT="convert";const fs=n.React$1.createElement,_s=new Set;function Es(){const e=new i.PermissionSetting({allow:!1});return new i.MemberPermissions({make_editor:e,make_viewer:e,make_owner:e,remove:e})}function Ss(e){const t=i.AnonymousViewerUtils.getAnonymousUserIds(e),s=r.intl.formatMessage({id:"+s6D7j",defaultMessage:"Guest"});return t.map((e=>new i.UserMembershipInfo({access_type:"reader",account:new i.BasicAccount({account_id:e,display_name:s,familiar_name:s,given_name:s,surname:""}),account_id:e,initials:i.AnonymousViewerUtils.getAnonymousViewerInitials(s),is_inherited:!1,permissions:Es(),same_team:!1,time_last_seen:null})))}class Ms{static activityUserToContact(e,t=0){return{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:i.ContactTypes.DBX_ID,priority:t,photo_url:e.photo_circle_url}}static teamGroupInfoToContact(e){return new i.Contact({group_id:e.id,group_size:e.group_size,type:i.ContactTypes.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})}}const ks={TOP:"top",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",RIGHT:"right",RIGHT_TOP:"right-top",RIGHT_BOTTOM:"right-bottom",LEFT:"left",LEFT_TOP:"left-top",LEFT_BOTTOM:"left-bottom"};class bs extends n.React$1.Component{constructor(){super(...arguments),this._renderArrow=()=>null!=this.props.arrow?[n.React$1.createElement("div",{className:"react-bubble-box__arrow-border",key:"arrow-border"}),n.React$1.createElement("div",{className:"react-bubble-box__arrow",key:"arrow"})]:[]}UNSAFE_componentWillMount(){if("undefined"!=typeof window&&null!==window)return K.require_css("/static/metaserver/static/css/react/bubble_box-vflhusCtq.css")}render(){const e=["react-bubble-box",`react-bubble-box--arrow-${this.props.arrow}`,this.props.className],t=M.extend({},M.omit(this.props,["arrow","className"]),{className:e.join(" ")});return n.React$1.createElement("div",Object.assign({},t),this._renderArrow(),this.props.children)}}bs.displayName="Bubble",bs.ARROW=ks,bs.propTypes={arrow:i.PropTypes.oneOf(M.values(ks)),className:i.PropTypes.string},bs.defaultProps={arrow:null,className:""};class vs extends n.React$1.Component{render(){return this.props.isFolder?this.renderFolder():this.renderFile()}renderFile(){const e={file:{type:i.FileTypes.FILE,fq_path:this.props.filename},className:this.props.className,variant:"small"};return n.React$1.createElement(Z.FileIcon,Object.assign({},e))}renderFolder(){let e=i.FileTypes.FOLDER;this.props.pathExists&&(this.props.isTeamSharedFolder?e=i.FileTypes.TEAM_SHARED_FOLDER:this.props.isSharedFolder&&(e=i.FileTypes.SHARED_FOLDER));const t=Q.spectrumFolderIcon({fileType:e,isViewOnly:this.props.isViewOnly,isInTeamFolderTree:this.props.isFolderInsideTeamFolderTree,size:Q.SpectrumIconSize.Small,isConfidential:this.props.isConfidentialFolder||!1,iconPostfix:this.props.isConfidentialFolder?"_admin_view":""});return n.React$1.createElement(i.IconContent,{name:t,"aria-label":this.props.alt,role:"img",className:this.props.className})}}vs.displayName="ShareModalIcon";class Cs extends n.React$1.Component{constructor(e){super(e),this.handleContentNameFocus=()=>{this.setState({isFocusOnContentName:!0})},this.handleContentNameBlur=()=>{this.setState({isFocusOnContentName:!1})},this.state={isFocusOnContentName:this.props.isContentNameFocused},this.headerInputRef=n.React$1.createRef()}selectContentNameInput(){var e;this.headerInputRef&&(null===(e=this.headerInputRef.current)||void 0===e||e.select())}render(){return this.props.isCreatingNewFolder?n.React$1.createElement(m.SharingModalHeaderInput,{inputAutoFocus:void 0===this.props.initialContentName,forwardedRef:this.headerInputRef,icon:n.React$1.createElement(i.SharedFolderIcon,null),inputAriaLabel:this.props.contentNameMessage,inputPlaceholder:this.state.isFocusOnContentName?void 0:r.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),defaultValue:this.props.initialContentName,onClickCloseButton:this.props.onModalCloseClick,onInputChange:this.props.onContentNameInputChange,onInputFocus:this.handleContentNameFocus,onInputBlur:this.handleContentNameBlur,onInputKeyUp:this.props.onContentNameInputKeyUp,isContentNameFocused:this.state.isFocusOnContentName},this.shouldShowContentNameBubble()&&this.renderContentNameBubble()):n.React$1.createElement(m.SharingModalHeaderTitle,{closeButtonVisible:!0,icon:this.getIcon(),subTitle:!this.props.isLoading&&(this.props.subTitle||this.getMemberCountsString()),onClickCloseButton:this.props.onModalCloseClick,onClickSettingsButton:this.props.onSettingsButtonClick,settingsButtonVisible:this.props.isMetadataLoaded&&this.isContentSettingsEnabled(),title:this.getHeaderTitle()})}getHeaderTitle(){return this.props.initialContentName?this.props.initialContentName:i.Emstring.em_snippet(this.props.sharingInfo.name(),i.SNIPPET_SIZES.FILENAME)}isContentNameInputError(){return this.props.contentNameMessageLevel===l.CONTENT_NAME_MESSAGE_LEVELS.ERROR}shouldShowContentNameBubble(){return this.props.contentNameMessage&&(this.state.isFocusOnContentName||this.isContentNameInputError())}renderContentNameBubble(){return n.React$1.createElement(bs,{arrow:bs.ARROW.TOP,className:i.classnames("unified-share-modal__content-name__tooltip","u-pad-xs","u-font-strong",{"unified-share-modal__content-name__tooltip-error":this.isContentNameInputError()})},this.props.contentNameMessage)}getIcon(){const e=this.props.contentInfo;if(e.isFolder()){if(!e.extras.exists)return n.React$1.createElement(i.SharedFolderIcon,null);if(!this.props.isMetadataLoaded)return e.isTeamSharedFolder()||e.isFolderInsideTeamFolderTree()?n.React$1.createElement(i.TeamFolderIcon,null):e.isSharedFolder()?n.React$1.createElement(i.SharedFolderIcon,null):n.React$1.createElement(i.SimpleFolderIcon,null)}return n.React$1.createElement(vs,{alt:"",className:"unified-share-modal__title-icon",filename:this.props.sharingInfo.name(),isSharedFolder:e.isSharedFolder(),isFolder:e.isFolder(),isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:!0===this.props.isFolderInsideTeamFolderTree,isViewOnly:!this.props.canEdit,isConfidentialFolder:this.props.isInContentManager&&this.props.isConfidentialFolder,pathExists:e.pathExists()})}getSharingMemberCountsString(e){return this.ifAnyNonSelfMembers(e)?r.intl.formatMessage({id:"CQ2ZaT",defaultMessage:"Only you can access"}):r.intl.formatMessage({id:"bFyJSY",defaultMessage:"Shared with other people"})}ifAnyNonSelfMembers(e){const t=this.props.sharingInfo.members(),s=t.groups.count(),n=t.users.count(),i=this.props.sharingInfo.hasDirectMemberSelf(),a=this.props.sharingInfo.memberCounts().total_unique_users,r=0===s&&i;if(null===a||a<=1){const e=t.isOnlyMemberInAllGroups();return s>0&&e?0===n||i:r}return!1}getMemberCountsString(){const e=this.props.sharingInfo.memberNum();if(e&&!this.props.isSendingForSignature)return this.getSharingMemberCountsString(e)}isContentSettingsEnabled(){return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings}}Cs.defaultProps={isLoading:!1},Cs.displayName="ShareModalHeaderSection";const ys={[i.ACCESS_LEVEL.OWNER]:r.intl.formatMessage({id:"if8xIl",defaultMessage:"Owner"}),[i.ACCESS_LEVEL.WRITER]:r.intl.formatMessage({id:"ywqz2g",defaultMessage:"Can edit"}),[i.ACCESS_LEVEL.READER]:r.intl.formatMessage({id:"Gz5ABt",defaultMessage:"Can view"}),[i.ACCESS_LEVEL.READER_NO_COMMENT]:r.intl.formatMessage({id:"vQquJX",defaultMessage:"View-only"})};i.ACCESS_LEVEL.OWNER,r.intl.formatMessage({id:"if8xIl",defaultMessage:"Owner"}),i.ACCESS_LEVEL.WRITER,r.intl.formatMessage({id:"ywqz2g",defaultMessage:"Can edit"}),i.ACCESS_LEVEL.READER,r.intl.formatMessage({id:"Cgg/GQ",defaultMessage:"Can comment"}),i.ACCESS_LEVEL.READER_NO_COMMENT,r.intl.formatMessage({id:"Gz5ABt",defaultMessage:"Can view"});const ws={[i.MEMBER_ACTION.MAKE_EDITOR]:r.intl.formatMessage({id:"l98l5t",defaultMessage:"People can edit, delete, comment, and add the files to their Dropbox"}),[i.MEMBER_ACTION.MAKE_VIEWER]:r.intl.formatMessage({id:"b2gULy",defaultMessage:"People can view, download, and comment"}),[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]:r.intl.formatMessage({id:"SS1NPa",defaultMessage:"People can only view and download the files"})},Is={[i.MEMBER_ACTION.MAKE_EDITOR]:r.intl.formatMessage({id:"p1FXFw",defaultMessage:"People can edit, delete, comment, and add the file to their Dropbox"}),[i.MEMBER_ACTION.MAKE_VIEWER]:r.intl.formatMessage({id:"b2gULy",defaultMessage:"People can view, download, and comment"}),[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]:r.intl.formatMessage({id:"EYJ3Li",defaultMessage:"People can only view and download the file"})},Ts={[i.MEMBER_ACTION.MAKE_EDITOR]:r.intl.formatMessage({id:"65RS70",defaultMessage:"People can edit and comment"}),[i.MEMBER_ACTION.MAKE_VIEWER]:r.intl.formatMessage({id:"9zXodW",defaultMessage:"People can view and comment"})};i.MEMBER_ACTION.MAKE_EDITOR,r.intl.formatMessage({id:"UFB0OU",defaultMessage:"Lets them view, comment, and edit."}),i.MEMBER_ACTION.MAKE_VIEWER,r.intl.formatMessage({id:"dLWWVm",defaultMessage:"Lets them view and comment, but not edit."}),i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,r.intl.formatMessage({id:"Fp+s39",defaultMessage:"Lets them view only. They can’t see comments."}),i.MEMBER_ACTION.MAKE_EDITOR,r.intl.formatMessage({id:"UFB0OU",defaultMessage:"Lets them view, comment, and edit."}),i.MEMBER_ACTION.MAKE_VIEWER,r.intl.formatMessage({id:"dLWWVm",defaultMessage:"Lets them view and comment, but not edit."}),i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,r.intl.formatMessage({id:"Fp+s39",defaultMessage:"Lets them view only. They can’t see comments."});const As=({className:e,variant:t="default"})=>n.react.exports.createElement("svg",{className:e,xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",viewBox:"0 0 9 5"},n.react.exports.createElement("path",{fill:"none",fillRule:"evenodd",stroke:"highlighted"===t?"#0269D9":"#3E3E3E",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 1L4.5 4 1 1"})),Ls=({className:e,variant:t="default"})=>n.react.exports.createElement("svg",{className:e,width:"12px",height:"6px",viewBox:"0 0 12 6",xmlns:"http://www.w3.org/2000/svg"},n.react.exports.createElement("g",{stroke:"highlighted"===t?"#0269D9":"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",fillOpacity:"0.8"},n.react.exports.createElement("g",{fill:"#000000"},n.react.exports.createElement("polygon",{points:"6 5.01369863 11.4626866 0 12 0.493150685 6 6 0 0.493150685 0.537313433 0"})))),Rs=({className:e})=>n.react.exports.createElement("svg",{className:e,width:"7px",height:"4px",viewBox:"0 0 7 4",xmlns:"http://www.w3.org/2000/svg"},n.react.exports.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.react.exports.createElement("g",{transform:"translate(-509.000000, -24.000000)",fill:"#637282"},n.react.exports.createElement("g",{transform:"translate(444.000000, 16.000000)"},n.react.exports.createElement("polygon",{points:"65 8 72 8 68.5 12"}))))),Ns=({className:e})=>n.react.exports.createElement("svg",{className:e,width:"7px",height:"4px",viewBox:"0 0 7 4",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},n.react.exports.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},n.react.exports.createElement("g",{transform:"translate(-509.000000, -128.000000)",fill:"#007AF5"},n.react.exports.createElement("polygon",{id:"Arrow",points:"509 128 516 128 512.5 132"}))));As.displayName="IconDropdownCaretOsx",Ls.displayName="IconDropdownCaretWin",Rs.displayName="IconDropdownCaretWeb",Ns.displayName="IconDropdownCaretBlueWeb";const xs=(e,t)=>{var{ref:i}=e,a=s.__rest(e,["ref"]),r=t.ambManager;const{onMouseDown:o}=a;let l;return n.react.exports.createElement(ne.dist.Button,Object.assign({ref:e=>l=e,onClick:function(){a.disabled||(l&&n.reactDom.exports.findDOMNode(l).focus(),r.toggleMenu({},{focusMenu:!1}),o&&o.apply(this,arguments))}},a))};xs.contextTypes={ambManager:()=>null},xs.displayName="FixedAriaMenuButton";const Ps=e=>{var{children:t,className:a,ref:r,disabled:o,fullWidth:l,variant:c="secondary"}=e,d=s.__rest(e,["children","className","ref","disabled","fullWidth","variant"]);const h=i.classnames("mc-dropdown-menu-button","mc-button-styleless","mc-button-aria-wrapper",{"mc-button-full-width":l},a),p=d;return o&&(p.tabIndex=-1),n.react.exports.createElement(xs,Object.assign({tag:"button",type:"button",className:h,disabled:o},p),n.react.exports.createElement(ae.DropdownButton,{tagName:"span",disabled:o,fullWidth:l,variant:c},t))};Ps.displayName="DropdownMenuButton";const Fs=e=>{var{children:t,className:a,disabled:r,fullWidth:o,onSelection:l,ref:c}=e,d=s.__rest(e,["children","className","disabled","fullWidth","onSelection","ref"]);const h=i.classnames("mc-dropdown-menu",a,{"mc-dropdown-menu-full-width":o});let p=t;return t&&(p=n.react.exports.Children.map(t,(e=>{if(n.react.exports.isValidElement(e)&&e.type===Ps){const t={disabled:r};return n.react.exports.cloneElement(e,t)}return e}))),n.react.exports.createElement(ne.dist.Wrapper,Object.assign({className:h,onSelection:e=>{l&&l(e)},ref:c},d),p)};Fs.displayName="DropdownMenu";const Os=e=>{var{className:t,ref:a}=e,r=s.__rest(e,["className","ref"]);const o=i.classnames("mc-menu",t);return n.react.exports.createElement(ne.dist.Menu,Object.assign({tag:"ul",className:o,ref:a},r))};Os.displayName="Menu";const Ds=e=>{var{children:t,className:a,disabled:r,ref:o,selected:l,value:c}=e,d=s.__rest(e,["children","className","disabled","ref","selected","value"]);const h=i.classnames("mc-menu-item",a,{"mc-menu-item-disabled":r,"mc-menu-item-selected":l});return r?n.react.exports.createElement("li",Object.assign({className:h},d),n.react.exports.createElement(i.Button$1,{tagName:"span",variant:"styleless",className:"mc-menu-item-button",disabled:r},t)):n.react.exports.createElement(ne.dist.MenuItem,Object.assign({tag:"li",className:h,value:c},d),n.react.exports.createElement(i.Button$1,{variant:"styleless",className:"mc-menu-item-button"},t))};Ds.displayName="MenuItem";const $s=e=>{var{className:t}=e,a=s.__rest(e,["className"]);const r=i.classnames(t,"scl-sharing-menu");return n.react.exports.createElement(Os,Object.assign({className:r},a))};$s.displayName="SharingMenu";const Bs=e=>{var{value:t,label:a,description:r,selected:o,variant:l="default"}=e,c=s.__rest(e,["value","label","description","selected","variant"]);return n.react.exports.createElement(Ds,Object.assign({className:i.classnames({"scl-sharing-menu-item-border":"border"===l}),key:t,value:t,text:a,selected:o},c),o&&n.react.exports.createElement(re.IconDropdownSelectedBlue,{className:"scl-sharing-menu-item-selected-icon"}),n.react.exports.createElement("div",{className:i.classnames("scl-sharing-menu-item-wrapper",{"scl-sharing-menu-item-wrapper-selected":o})},n.react.exports.createElement("div",{className:i.classnames("scl-sharing-menu-item-label",{"scl-sharing-menu-item-label-default":"default"===l,"scl-sharing-menu-item-label-red":"red"===l})},a),n.react.exports.createElement("div",{className:"scl-sharing-menu-item-description"},r)))},Us="scl-sharing-portal-dropdown-button";class Hs extends n.react.exports.PureComponent{constructor(e){super(e),this.dropdownId=i.generateUUID("portalDropdown"),this.handleResizeEvent=()=>{this.state.isOpen&&this.resolvePortalPosition()},this.handleScrollEvent=()=>{this.state.isOpen&&this.resolvePortalPosition()},this.onMenuToggle=({isOpen:e})=>{e||this.positionedPortalEl.hidePortal(),this.setState({isOpen:e})},this.handlePortalDidShow=()=>{ne.dist.openMenu(this.dropdownId,{focusMenu:!0})},this.state={isOpen:!1}}componentDidUpdate(e,t){this.state.isOpen&&this.positionedPortalEl?(this.mountListeners(),this.resolvePortalPosition()):this.positionedPortalEl&&this.unMountListeners()}componentWillUnmount(){this.unMountListeners()}mountListeners(){document.addEventListener("scroll",this.handleScrollEvent,!1),window.addEventListener("resize",this.handleResizeEvent,!1)}unMountListeners(){document.removeEventListener("scroll",this.handleScrollEvent,!1),window.removeEventListener("resize",this.handleResizeEvent,!1)}resolvePortalPosition(){if(this.positionedPortalEl&&this.positionedPortalEl.portalInstance.portalContentElementRef){const e=n.reactDom.exports.findDOMNode(this.positionedPortalEl);if(!(e instanceof Element))throw new Error("Unable to find PositionedPortal DOM node - check if this SharingPortalDropdown is still mounted");{const t=e.getElementsByClassName(Us);if(!t.length)throw new Error("Unable to find SharingPortalDropdownButton - check if this SharingPortalDropdown is still mounted");{const e=t[0],s=this.positionedPortalEl.portalInstance.portalContentElementRef,n=e.getBoundingClientRect(),i=s.getBoundingClientRect(),a=10;let r={top:0,left:0};r=n.bottom+i.height>window.innerHeight?{top:n.top-i.height-a,left:n.left+n.width-i.width}:{top:n.top+n.height+a,left:n.left+n.width-i.width},s.style.top=r.top+"px",s.style.left=r.left+"px"}}}}render(){const{optionGroup:e,onSelection:t}=this.props;return n.react.exports.createElement(ie.PositionedPortal,{closeOnBlur:!1,ref:e=>this.positionedPortalEl=e,renderContent:()=>n.react.exports.createElement(ne.dist.Wrapper,{id:this.dropdownId,onSelection:t,onMenuToggle:this.onMenuToggle},n.react.exports.createElement(ne.dist.Button,{className:"scl-sharing-portal-dropdown-button-invisible"},e.label),n.react.exports.createElement($s,{className:"scl-sharing-portal-menu"},n.react.exports.createElement(n.react.exports.Fragment,null,e.options.map((t=>n.react.exports.createElement(Bs,{description:t.tooltip,key:t.apiId,label:t.label,selected:e.selectedApiId===t.apiId,value:t.apiId,variant:t.variant,disabled:t.disabled})))))),role:"sharing-dropdown",showOnMouseMove:!1,showOnClick:!0,onDidShow:this.handlePortalDidShow},n.react.exports.createElement(i.Button$1,{className:i.classnames(Us,{"scl-sharing-portal-dropdown-button-expanded":this.state.isOpen}),variant:"styleless"},e.label,(()=>this.state.isOpen?n.react.exports.createElement(Ns,{className:"scl-sharing-portal-dropdown-icon scl-sharing-portal-dropdown-icon-web"}):n.react.exports.createElement(Rs,{className:"scl-sharing-portal-dropdown-icon scl-sharing-portal-dropdown-icon-web"}))()))}}Hs.displayName="SharingPortalDropdown";class Vs extends n.react.exports.PureComponent{constructor(){super(...arguments),this.handleDropdownChange=e=>{const{id:t,onChange:s,optionGroup:n}=this.props;!s||n&&n.selectedApiId===e||s(t,e)}}render(){const{className:e,variant:t="default",position:s="default",tag:a}=this.props,r=a||"li",o=i.classnames(e,{"scl-member-row":!0,"scl-member-row-borderless":"borderless"===t,"scl-member-row-default":"default"===t,"scl-member-row-narrow":"narrow"===t},{"scl-member-row-positioned":"bottom"===s||"middle"===s,"scl-member-row-bottom":"bottom"===s});return n.react.exports.createElement(r,{className:o},n.react.exports.createElement("div",{className:"scl-member-row-outer"},this.renderAvatar(),n.react.exports.createElement("div",{className:"scl-member-row-info"},this.renderDisplayName(),this.renderMemberDetails())),this.renderRightSideElement())}renderAvatar(){const{avatarHidden:e,avatarUrl:t,avatarElement:s,displayName:i,id:a,initials:r,initialAvatarShape:o}=this.props;return e?n.react.exports.createElement("div",{className:"scl-member-row-avatar-empty"}):s||(t?n.react.exports.createElement(te.Avatar,{src:t,className:"scl-member-row-avatar"}):n.react.exports.createElement(m.SharingAvatarInitials,{avatarSize:32,backgroundColor:se.avatarColorForUserIdentifier(i||a),className:"scl-member-row-avatar",shape:o},r))}renderRightSideElement(){const{id:e,loadingSpinnerVisible:t,optionGroup:s,userDisabled:i}=this.props;let a=null;return t?a=n.react.exports.createElement(m.ScooterLoader,null):s&&(a=i||1===s.options.length&&s.selectedApiId===s.options[0].apiId?n.react.exports.createElement("div",null," ",s.label," "):n.react.exports.createElement(Hs,{id:e,optionGroup:s,onSelection:this.handleDropdownChange})),a}renderDisabledMessage(){return this.props.disabledMessage?[n.react.exports.createElement("span",{key:0,className:"u-font-meta dot"}," · "),n.react.exports.createElement("span",{key:1,className:"u-font-danger"}," ",this.props.disabledMessage)]:null}renderNameTitleAndText(){return n.react.exports.createElement("span",{className:"scl-member-row-info-display-name-title",title:this.props.displayName},this.props.truncatedDisplayName||this.props.displayName)}renderPASSDot(){return this.props.passString?n.react.exports.createElement("span",{className:"scl-member-row-dot"}," · "):null}renderOffTeamDot(){return this.props.offTeamMessage&&this.props.description?n.react.exports.createElement("span",{className:"u-font-meta"}," · "):null}renderPASS(){const{present:e,passString:t}=this.props;if(t){const s=i.classnames({"scl-member-row-last-seen":!0,"scl-member-row-last-seen-not-present":!e});return n.react.exports.createElement("span",{className:s},t)}return null}renderDisplayName(){return n.react.exports.createElement("div",{className:"scl-member-row-display-name"},n.react.exports.createElement("span",{className:this.props.onClickDisplayName?"scl-member-row-pointer":"",onClick:this.props.onClickDisplayName},this.renderNameTitleAndText(),this.renderDisabledMessage(),this.renderPASSDot(),this.renderPASS()))}renderOffTeamMessage(e){return e?n.react.exports.createElement("span",{className:"u-font-meta"},e):null}renderMemberDetails(){const{description:e,offTeamMessage:t,truncatedDescription:s}=this.props;return n.react.exports.createElement("div",{className:"scl-member-row-details"},n.react.exports.createElement("span",{className:this.props.onClickDetails?"scl-member-row-pointer":"",onClick:this.props.onClickDetails},n.react.exports.createElement("span",{className:"scl-member-row-details-span",title:e},s||e),this.renderOffTeamDot(),this.renderOffTeamMessage(t)))}}Vs.displayName="MemberRow";class Gs extends n.React$1.Component{constructor(){super(...arguments),this.popoverGroup=new be,this.onMemberRowChange=(e,t)=>{this.props.onAccessChangeInBubbleMenu(t)},this.openProfileCard=()=>{this.popoverRef&&this.popoverRef.openProfileCard()}}shouldLinkToGroup(){return this.props.member instanceof i.GroupMembershipInfo&&(!!this.props.member.same_team&&(!!this.props.user.is_team_admin||!!this.props.member.is_member&&this.props.member.group_management_type!==i.GroupManagementType.system_managed))}linkToGroup(e,t,s){const a=`/team#groups/${e.group_id}`,r=i.classnames({"u-font-meta":!s,"sharing-member-info__group-name-link":!0,"sharing-member-info__display-name-title":s});return n.React$1.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:r,title:e.group_name},t)}renderAvatar(e,t){const s=this.props.member.displayName()||"",a=this.getAvatarInitials(),o=t?"SQUARE":"CIRCLE",{member:l,user:c,contentInfo:d,isPresent:h,isProfileCardEnabled:p}=this.props,m=i.AnonymousViewerUtils.isAnonymousUserId(l.memberId())?l.memberId():s,u=n.React$1.createElement("div",{className:"o-flag__fix"},n.React$1.createElement(J.AvatarWithDefault,{dimension:X.AvatarSize.MEDIUM,photoUrl:e,shape:o,defaultAvatar:n.React$1.createElement(J.InitialsAvatarWithColorDerivedFromName,{dimension:X.AvatarSize.MEDIUM,shape:o,initials:a,name:m,alt:""})}));if(p){const t=i.initStoreForIntegration(this.props.user.id);let s,a;if(l instanceof i.GroupMembershipInfo){const e=l;let t="";this.shouldRenderGroupCount()&&(t=r.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:l.member_count})),s={avatarType:"group",targetGroup:{gid:e.group_id,groupName:e.displayName(),message:t}}}else if(l instanceof i.InviteeMembershipInfo){const t=l;s={avatarType:"invited_person",targetUser:{accountId:t.contact,displayName:t.displayName(),familiarName:t.displayName(),accessType:ys[t.access_type],email:t.contact,photoUrl:e||void 0}}}else if(l instanceof i.UserMembershipInfo){const t=l;s={avatarType:"joined_member",targetUser:{accountId:t.account_id,displayName:t.displayName()||t.email()||"",familiarName:t.displayName(),accessType:ys[t.access_type],isViewer:t.account_id===this.props.user.account_id,email:t.email(),photoUrl:e||void 0}},a=t.time_last_seen}const o={".tag":d.isFolder()?"folder":"file",id:i.fulfilled(d.idForLink()),name:d.name()};if(s)return n.React$1.createElement(oe.ProfileCardPopover,{popoverRef:e=>this.popoverRef=e,popoverGroup:this.popoverGroup,integrationStore:t,avatarInfo:s,entryPoint:"share_sheet",file:this.props.hasLinkMetadata?o:void 0,seenState:h?this.getPresentText():this.getLastSeenText(a),viewerId:c.id,positioning:"right",upsellPositioning:"right",portalParentElement:document.querySelector("body")||void 0,maxCalendarEventsToRender:1,autoRePosition:!0},n.React$1.createElement(i.Button$1,{variant:"circular"},u))}return u}getDisplayName(e,t){let s;this.props.member.displayName()&&(s=this.props.member.displayName()),s=void 0!==s?s:"";let n=this.getLastSeenText(e);this.props.isPresent?n=this.getPresentText():e&&(n=this.getLastSeenText(e));const a=this.getDisabledMessage(t);let r=0,o=0;n&&(r=new i.Emstring(`  ·  ${n}`).length),a&&(o=new i.Emstring(`  ·  ${a}`).length);const l=i.SNIPPET_SIZES.DISPLAY_NAME-r-o,c=i.Emstring.em_snippet(s,l);return this.shouldLinkToGroup()&&!this.shouldRenderGroupCount()?this.linkToGroup(this.props.member,c,!0):c}getAvatarInitials(){const e=this.props.member.displayName()||"";return i.getInitials(e)}getPresentText(){return r.intl.formatMessage({id:"BMhlbR",defaultMessage:"Viewing now"})}getLastSeenText(e){let t="";return e&&(t=r.intl.formatMessage({id:"uIg+ju",defaultMessage:"Viewed {time_str}"},{time_str:i.ago(e)})),t}getDisabledMessage(e){let t="";return e&&e.disabled&&(t=r.intl.formatMessage({id:"RBvabN",defaultMessage:"Deleted"})),t}getOffTeamMessage(e){let t="";const s=e&&!e.email;return!this.props.user.is_team||this.props.member.same_team||s||(t=r.intl.formatMessage({id:"x48gqV",defaultMessage:"Outside your Dropbox team"})),t}getMemberDetails(e,t){let s;return e?s=this.shouldLinkToGroup()?this.linkToGroup(this.props.member,e,!1):e:t&&t.email&&t.email_verified&&(s=t.email),s}isAllowedToRelinquishMembership(){return this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership}getOptionGroup(){let e=[],t="";const s=ys[this.props.member.access_type],n=(a=this.isAllowedToRelinquishMembership(),[[i.MEMBER_ACTION.MAKE_EDITOR,{value:i.ACCESS_LEVEL.WRITER,title:ys[i.ACCESS_LEVEL.WRITER],folder_description:ws[i.MEMBER_ACTION.MAKE_EDITOR],file_description:Is[i.MEMBER_ACTION.MAKE_EDITOR]}],[i.MEMBER_ACTION.MAKE_VIEWER,{value:i.ACCESS_LEVEL.READER,title:ys[i.ACCESS_LEVEL.READER],folder_description:ws[i.MEMBER_ACTION.MAKE_VIEWER],file_description:Is[i.MEMBER_ACTION.MAKE_VIEWER]}],[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,{value:i.ACCESS_LEVEL.READER_NO_COMMENT,title:ys[i.ACCESS_LEVEL.READER_NO_COMMENT],folder_description:ws[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT],file_description:Is[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]}],[i.MEMBER_ACTION.MAKE_OWNER,{value:i.ACCESS_LEVEL.OWNER,title:r.intl.formatMessage({id:"+ZJXxL",defaultMessage:"Make owner"})}],[i.MEMBER_ACTION.REMOVE,{value:"remove",title:a?r.intl.formatMessage({id:"eTtbKw",defaultMessage:"Remove my access"}):r.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"})}],[i.MEMBER_ACTION.MANAGE_LINK_ACCESS,{value:"manage_link_access",title:r.intl.formatMessage({id:"qG3VMJ",defaultMessage:"Manage access"})}]]);var a;for(const s of n){const n=s[0],i=s[1];this.props.member.access_type===i.value&&(t=i.value);const a=this.getOptionGroupOption(n,i);a&&e.push(a)}const o=e.find((e=>e.apiId===i.MEMBER_ACTION.MANAGE_LINK_ACCESS));return o&&(e=[o]),{id:`optionGroup${this.props.member.memberId()}`,label:s,options:e,selectedApiId:t,enabled:!this.props.isMemberActionPending}}getOptionGroupOption(e,t){if(t.value===i.MEMBER_ACTION.MANAGE_LINK_ACCESS&&this.props.isLinkVisitor)return{apiId:t.value,label:t.title,tooltip:r.intl.formatMessage({id:"Ja6XYU",defaultMessage:"Change or remove their access in link settings"}),disabled:!1};if(function(e,t,s,n,a){return t===s||n&&n.get(e)&&n.get(e).allow||t===i.MEMBER_ACTION.REMOVE&&a}(e,t.value,this.props.member.access_type,this.props.member.permissions,this.isAllowedToRelinquishMembership())){const e=this.props.contentInfo.isFolder()?t.folder_description:t.file_description,s=t.value===i.MEMBER_ACTION.REMOVE?"red":t.value===i.ACCESS_LEVEL.READER?"border":"default";return{apiId:t.value,label:t.title,tooltip:e||"",variant:s}}}renderSeenStateInfo(e,t){const s=r.intl.formatDate(t,{day:"numeric",month:"short",year:"numeric"}),i=r.intl.formatTime(t,{hour:"numeric",minute:"numeric"});return n.React$1.createElement(ee.TitleBubble,{content:n.React$1.createElement("div",null,s,i&&n.React$1.createElement("br",null),i),className:"timestamp-tooltip",children:n.React$1.createElement("span",null,e),position:ce.StickyPosition.BOTTOM,isTargetPositionFixed:!0})}shouldRenderGroupCount(){return this.props.member instanceof i.GroupMembershipInfo&&this.props.member.member_count}render(){const{member:e}=this.props;let t,s,a,o,l,c=!1,d="";if(e instanceof i.UserMembershipInfo){if(d=e.account_id,s=e.account,!s)return null;a=s.profile_photo_url,t=e.time_last_seen}else e instanceof i.GroupMembershipInfo&&(d=e.group_id,c=!0,"team"===e.group_type&&(a=n.static_url("/static/metaserver/static/images/icons/team_24@2x-vflR8kGKs.png")),this.shouldRenderGroupCount()&&(o=r.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:e.member_count})));return this.props.wrappedGroupViewersElement&&this.props.wrappedGroupViewersElement.element?l=this.props.wrappedGroupViewersElement.element:this.props.isPresent?l=this.getPresentText():t&&(l=this.renderSeenStateInfo(this.getLastSeenText(t),t)),n.React$1.createElement(Vs,{id:d,avatarUrl:a||"",avatarElement:this.renderAvatar(a,c),initialAvatarShape:c?"square":"circle",displayName:this.getDisplayName(t,s),userDisabled:null==s?void 0:s.disabled,disabledMessage:this.getDisabledMessage(s),description:this.getMemberDetails(o,s),passString:l,offTeamMessage:this.getOffTeamMessage(s),present:this.props.isPresent,initials:this.getAvatarInitials(),loadingSpinnerVisible:this.props.isMemberActionPending,optionGroup:this.getOptionGroup(),onChange:this.onMemberRowChange,variant:this.props.isInheritedMember?"borderless":"default",onClickDetails:this.props.isProfileCardEnabled?this.openProfileCard:void 0,onClickDisplayName:this.props.isProfileCardEnabled?this.openProfileCard:void 0})}}Gs.displayName="SharingMemberListItemElement",Gs.defaultProps={canInviteMembers:!1,canRelinquishMembership:!1,disabled:!1,isPresent:!1,isViewOnly:!1};const Ws=i.connect((e=>({isProfileCardEnabled:T.isProfileCardInShareSheetEnabled(e)})))(Gs);class Ks{constructor(e){e.when_last_seen&&(this.time_last_seen=new Date(1e3*e.when_last_seen));const t=e.seen_state_user;this.account_id=t.user_id,this.display_name=t.display_name,this.email=t.email,this.photo_circle_url=t.photo_circle_url,this.same_team=!0}displayName(){return this.display_name}memberId(){return this.account_id}}var zs,js;!function(e){function t(e,t){const s=t.has(e.account_id)?r.intl.formatMessage({id:"BMhlbR",defaultMessage:"Viewing now"}):i.ago(e.time_last_seen);return[n.React$1.createElement("tr",null,n.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},i.Emstring.em_snippet(e.displayName(),i.SNIPPET_SIZES.DISPLAY_NAME)),n.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell dot"},"·"),n.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__seen-string"},s))]}e.make=function(e,s){const i=r.intl.formatMessage({id:"4joFvJ",defaultMessage:"{count, plural, one{{count} viewer} other{{count} viewers}}"},{count:e.length}),a=e.length<=10,o=a?e.length:9;let l=t(e[0],s);for(let n=1;n<o;n++)l=l.concat(t(e[n],s));if(!a){const t=e.length-o,s=r.intl.formatMessage({id:"6gF5ZF",defaultMessage:"{count, plural, one{and {count} other} other{and {count} others}}"},{count:t});l=l.concat(n.React$1.createElement("tr",null,n.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},s)))}return{element:n.React$1.createElement(ee.TitleBubble,{content:n.React$1.createElement("table",{className:"group-tooltip__viewers-table"},n.React$1.createElement("tbody",null,l)),className:"group-tooltip",children:n.React$1.createElement("span",{className:"u-font-meta sharing-member-info__viewer-count-text"},i),position:ce.StickyPosition.BOTTOM,isTargetPositionFixed:!0}),elementText:i}}}(zs||(zs={})),function(e){e[e.RemoveAccess=0]="RemoveAccess",e[e.DowngradeAccess=1]="DowngradeAccess"}(js||(js={}));class qs extends n.React$1.Component{constructor(){super(...arguments),this.renderMembersListItem=(e,t,s)=>{const a=e.memberKey(),r=this.isLinkVisitor(e,t),o=this.props.groupSeenStateInfo[e.memberId()]?this.renderWrappedGroupViewersElement(e):void 0,l=this.props.canUpdateConfidentiality&&e.is_inherited,c=!!l||!this.props.contentInfo.isFileFolder()&&this.props.canRelinquishMembership;return n.React$1.createElement(Ws,{hasLinkMetadata:this.props.hasLinkMetadata,canInviteMembers:this.props.canInviteMembers,canRelinquishMembership:c,contentInfo:this.props.contentInfo,wrappedGroupViewersElement:o,isInheritedMember:s,isMemberActionPending:this.props.pendingMemberAction.has(a),isPresent:this.props.shouldShowPassUI&&this.isMemberCurrentlyViewing(e),key:a,member:e,user:this.props.user,onAccessChangeInBubbleMenu:t=>{const s=t===i.MEMBER_ACTION.REMOVE,n=t===i.MEMBER_ACTION.MANAGE_LINK_ACCESS,a=!s&&i.isLowerAccess(e.access_type,t),o=this.props.contentInfo.isSharedFolder()?e.inherited_access_type:e.access_type,c=s||a&&o&&i.isLowerAccess(o,t);if((s||a)&&this.props.onShowSecurityBanner){const e=s?js.RemoveAccess:js.DowngradeAccess;this.props.onShowSecurityBanner(e)}if(l&&c){const s=this.props.ownerTeamName,n={new_access:t,old_access:e.access_type,inherited_access:o};return g.logTiburonEvent(this.props.contentInfo,this.props.user.id,u.TiburonEventName.SelectChangeMemberPermission,n),this.props.actionHandler.handleInheritedMemberAccessChange(e,s,a,a?t:void 0)}if(n&&r){const t="writer"===e.access_type?"editor":"viewer",s={access_level:t};return g.logTiburonEvent(this.props.contentInfo,this.props.user.id,u.TiburonEventName.ClickManageAccess,s),this.props.actionHandler.handleLinkSettingsClick({isLinkOnly:!1,linkAccessLevel:t})}return this.props.actionHandler.handleMemberAccessChange(e,t)},isLinkVisitor:r})}}render(){const e=g.makeMemberSortCmp(this.props.user,this.props.presentAccountIds||i.immutable.exports.Set(),this.shouldSortUsingPassRules()),t=this.membersByInheritance();let s=t.get(!1);s&&(s=s.sort(e));let a=t.get(!0);a&&(a=a.sort(e));let o=null;return this.props.areMembersFullyLoaded||(o=n.React$1.createElement("div",{className:"sharing-member-list__loading c-loader u-mar-horizontal-auto u-l-b"},r.intl.formatMessage({id:"A0CVFo",defaultMessage:"Loading more members..."}))),n.React$1.createElement(i.Provider,{store:i.initStoreForIntegration(this.props.user.id)},n.React$1.createElement("div",{className:"sharing-member-list"},this.renderInheritedUI(s,a),o))}shouldSortUsingPassRules(){const e=l.passStore.getPassPermissions(this.props.contentInfo.extras.fileId);return null!=e&&(e.canReadPresence||e.canReadSeenState)}renderInheritedUI(e,t){const s=i.immutable.exports.Set(this.getLinkVisitors()),a=this.renderInheritedMembers(s,t);let r=null;e&&e.count()>0&&(r=n.React$1.createElement("div",null,e.map((e=>this.renderMembersListItem(e,s))).toArray()));const o=i.classnames({"o-list-ui":!0});return n.React$1.createElement("ul",{className:o},a,r)}renderInheritedMembers(e,t){const{isConfidentialFolder:s,ownerTeamName:i}=this.props;if(this.shouldShowInherited()&&i&&!s)return n.React$1.createElement(Ht,{actionHandler:this.props.actionHandler,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,memberCounts:this.props.memberCounts,members:t?t.toArray():[],ownerTeamName:i},t&&t.map((t=>this.renderMembersListItem(t,e,!0))))}getLinkVisitors(){return this.props.linkMembers.concat(this.props.guestMembers)}isLinkVisitor(e,t){return e instanceof i.UserMembershipInfo&&t.contains(e)}isMemberCurrentlyViewing(e){return!this.memberIsAssumed(e)&&(e instanceof i.UserMembershipInfo&&this.props.presentAccountIds&&this.props.presentAccountIds.has(e.account_id))}memberIsAssumed(e){return e instanceof i.UserMembershipInfo&&e.account_id===this.props.user.account_id&&i.Viewer.get_viewer().is_assume_user_session}dedupUsersAndLinkVisitors(e,t){let s=i.immutable.exports.Map();return t.forEach((e=>{s=s.set(e.memberKey(),e)})),s.merge(e)}membersByInheritance(){const e=this.getLinkVisitors(),t=e=>this.shouldShowInherited()&&e.is_inherited,{membership:s}=this.props;if(!s)return e.length>0?i.immutable.exports.List(e).groupBy(t):i.immutable.exports.Map();const{groups:n,invitees:a,users:r}=s,o=this.dedupUsersAndLinkVisitors(r,e);return n.valueSeq().concat(a.valueSeq(),o.valueSeq()).groupBy(t)}shouldShowInherited(){const e=this.props.actionHandler.getSharingInfo(),t=!!e.parentSharedFolderId();return e.isUserOnOwnerTeam()&&t}extractGroupSeenStateAndViewers(e){const t=this.props.groupSeenStateInfo[e.memberId()];let s=[];return this.props.presentAccountIds&&(s=t.map((e=>new Ks(e))).filter((e=>null!=e.time_last_seen||this.props.presentAccountIds.has(e.account_id)))),{singleGroupSeenStateInfo:t,viewers:s}}renderWrappedGroupViewersElement(e){const{viewers:t}=this.extractGroupSeenStateAndViewers(e);return t.length?zs.make(t,this.props.presentAccountIds):{element:null,elementText:""}}}qs.displayName="SharingMemberList",qs.defaultProps={disabled:!1,groupSeenStateInfo:{},guestMembers:[],linkMembers:[]};const Ys="scl-sharing-dropdown-menu",Zs=e=>{const{position:t,className:a}=e,r=s.__rest(e,["position","className"]),o=i.classnames(Ys,a,{[`${Ys}--right`]:"right"===t});return n.react.exports.createElement(Fs,Object.assign({className:o},r))};Zs.displayName="SharingDropdownMenu";const Qs="scl-sharing-dropdown-menu-button";class Js extends n.react.exports.PureComponent{render(){const e=this.props,{children:t,className:a}=e,r=s.__rest(e,["children","className"]),o=i.classnames(Qs,a);return n.react.exports.createElement(Ps,Object.assign({className:o},r),t,n.react.exports.createElement(As,{className:`${Qs}__icon ${Qs}__icon--osx`}),n.react.exports.createElement(Ls,{className:`${Qs}__icon ${Qs}__icon--win`}))}}Js.displayName="SharingDropdownMenuButton";const Xs="scl-sharing-dropdown-menu-item",en=e=>{var{description:t,label:a,selected:r,value:o}=e,l=s.__rest(e,["description","label","selected","value"]);return n.react.exports.createElement(Ds,Object.assign({className:Xs,key:o,value:o,text:a,selected:r},l),r&&n.react.exports.createElement(re.IconDropdownSelected,{className:`${Xs}__selected-icon`}),n.react.exports.createElement("div",{className:i.classnames(`${Xs}__wrapper`,{[`${Xs}__wrapper-selected`]:r})},n.react.exports.createElement("div",{className:`${Xs}__label`},a),t&&n.react.exports.createElement("div",{className:`${Xs}__description`},t)))};en.displayName="SharingDropdownMenuItem";const tn="scl-sharing-modal-contacts-field";class sn extends n.react.exports.Component{constructor(e){super(e),this.renderDropdown=()=>{const{labelledAccessTypes:e,selectedAccessType:t,showNoEditTooltip:s,noEditText:i}=this.props,a=t?t.label:void 0,r=n.react.exports.createElement(Zs,{position:"right",onSelection:this.handleChange},n.react.exports.createElement(Js,{disabled:s},a),n.react.exports.createElement(Os,null,n.react.exports.createElement(n.react.exports.Fragment,null,e.map((e=>n.react.exports.createElement(en,{"aria-label":e.ariaLabel,description:e.details,key:e.apiId,label:e.label,selected:t&&t.apiId===e.apiId,value:e.apiId}))))));return s?n.react.exports.createElement(ie.Tooltip,{positioning:"below",tooltipContent:i},r):r},this.handleChange=e=>{this.props.onAccessTypeChange&&this.props.onAccessTypeChange(e)}}render(){const{className:e,toLabel:t}=this.props,s=i.classnames(tn,e);return n.react.exports.createElement("div",{className:s},n.react.exports.createElement("div",{className:`${tn}__left`},n.react.exports.createElement("div",{className:`${tn}__to-label`},t),n.react.exports.createElement("div",{className:`${tn}__input`},this.props.contactsField)),n.react.exports.createElement("div",{className:`${tn}__right`},this.renderDropdown()))}}sn.displayName="SharingModalContactsField";class nn extends n.react.exports.PureComponent{render(){const{avatarUrl:e,displayName:t,validation:s}=this.props,i=n.react.exports.createElement("div",{style:{display:"flex",maxWidth:"200px"}},e&&n.react.exports.createElement(te.Avatar,{size:16,src:e}),n.react.exports.createElement("div",{style:{flex:"auto",marginLeft:"5px",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},t));return s&&"invalid"===s.state?n.react.exports.createElement(ie.Tooltip,{tooltipContent:s.msg?s.msg:""},i):i}}nn.displayName="SharingContactToken";const an=64,rn=10,on=1,ln="mc-suggestions-list",cn="mc-suggestions-list-suggestion";class dn extends n.react.exports.Component{constructor(e){super(e),this.requestedNextPage=!1,this.updatedFromNextPage=!1,this.renderSuggestionRow=(e,t,s)=>{const{selectedIndex:a=0,listItemHeight:r=an,id:o,assignActivedescendant:l,onSelect:c,renderSuggestion:d}=this.props,h=Array.isArray(r)?r[t]:r,p=t===a?i.classnames(cn,"selected"):i.classnames(cn);return n.react.exports.createElement("li",{id:l&&o&&l(o,t),key:t,role:"option","aria-selected":t===a,onClick:()=>c(e,t),className:p,style:{position:"absolute",top:s,height:h}},d(e))},this.onRangeInView=(e,t)=>{const{onNextPageRequested:s,suggestionsBuffer:n=rn,suggestions:i}=this.props;i.length-1-t<=n&&!this.requestedNextPage&&s&&(this.updatedFromNextPage=!0,s(),this.requestedNextPage=!0)},this.cachedSuggestions=e.suggestions}UNSAFE_componentWillUpdate(e){const{suggestions:t}=this.props;this.cachedSuggestions=e.suggestions,t.length!==e.suggestions.length&&(this.requestedNextPage=!1);const s=t!==e.suggestions,n=this.props.selectedIndex!==e.selectedIndex;!s&&n&&(this.cachedSuggestions=[...this.cachedSuggestions])}componentDidUpdate(){if(this.culledListInstance){const e=n.reactDom.exports.findDOMNode(this.culledListInstance);if(e instanceof Element){const{listItemHeight:t=an,selectedIndex:s=0}=this.props;let n=0,i=0;if(Array.isArray(t)){for(let e=0;e<s;e++)n+=t[e];i=n+t[s]}else n=t*s,i=t*(s+1);const a=i-(e.scrollTop+this.props.height);a>0&&(e.scrollTop+=a);const r=e.scrollTop-n;this.updatedFromNextPage||r>0&&(e.scrollTop=e.scrollTop-r)}}this.updatedFromNextPage=!1}getRenderHeightForList(){const{suggestions:e,height:t,listItemHeight:s=an}=this.props;if(0===e.length)return 0;let n=0;if(Array.isArray(s)){for(const e of s)if(n+=e,n>=t)break}else n=s*e.length;return Math.min(n,t)}render(){const{dig2retrofit:e,listItemHeight:t=an,suggestionsBuffer:s=rn,scrollThreshold:a=on,className:r,id:o,"aria-labelledby":l}=this.props,c=i.classnames(ln,r,{"mc-suggestions-list-dig2":e});return n.react.exports.createElement("div",{className:c,onMouseDown:e=>{e.preventDefault()}},n.react.exports.createElement(de.CulledList,{ref:e=>this.culledListInstance=e,className:"mc-suggestions-list-culled-list","aria-labelledby":l,id:o,role:"listbox",items:this.cachedSuggestions,listItemHeight:t,shouldUseWindowAsScrollContainer:!1,onRangeInView:this.onRangeInView,renderRow:this.renderSuggestionRow,scrollThreshold:a,itemBuffer:s,viewportHeight:this.getRenderHeightForList()}))}}const hn=e=>{let t,a;const{children:r,className:o,dig2retrofit:l,focused:c=!1,onClose:d,onClick:h,onKeyDown:p,onFocus:m,onBlur:u,selected:g=!1,variant:f="default",tabIndex:_=-1,tooltipContent:E}=e,S=s.__rest(e,["children","className","dig2retrofit","focused","onClose","onClick","onKeyDown","onFocus","onBlur","selected","variant","tabIndex","tooltipContent"]),M=i.classnames(o,{"mc-token":!0,"mc-token-error":"error"===f,"mc-token-focused":c,"mc-token-selected":g,"mc-token-warning":"warning"===f,"mc-token-dig2":l}),k=e.id?"tooltip-for-"+e.id:void 0,b=n.react.exports.createElement("svg",{width:13,height:13,viewBox:"0 0 24 24",className:"mc-token-close-icon"},n.react.exports.createElement("title",null,"Delete Token"),n.react.exports.createElement("path",{className:"mc-token-close-icon-x",d:"M12 10.586l-4.95-4.95L5.636 7.05l4.95\n        4.95-4.95 4.95 1.414 1.414 4.95-4.95\n        4.95 4.95 1.414-1.414-4.95-4.95\n        4.95-4.95-1.414-1.414z",fillRule:"evenodd"}));return n.react.exports.createElement("div",Object.assign({className:M,onKeyDown:e=>{const{key:t}=e;"Backspace"===t&&d&&(e.preventDefault(),d(e)),"Enter"===t&&h&&h(e),p&&p(e)},role:"button",onClick:e=>{const s=e.target;t===s||t.contains(s)||h&&h(e)},onFocus:e=>{const s=e.target;t===s||t.contains(s)||(m&&m(e),a&&a.showTooltip())},onBlur:e=>{u&&u(e),a&&a.hideTooltip()},tabIndex:_},S),n.react.exports.createElement(ie.Tooltip,{tooltipContent:E,ref:e=>a=e,id:k},n.react.exports.createElement("div",{className:"mc-token-inner-wrapper"},n.react.exports.createElement("div",{className:"mc-token-content"},r),n.react.exports.createElement("button",{className:"mc-token-close",onClick:e=>{d&&d(e)},tabIndex:-1,ref:e=>t=e},b))))};hn.displayName="Token";const pn=e=>{const{key:t}=e;if("ArrowRight"===t){const t=e.currentTarget.nextElementSibling;t&&t.focus()}if("ArrowLeft"===t){const t=e.currentTarget.previousElementSibling;t&&t.focus()}},mn=e=>{const{className:t,dig2retrofit:s,inputElement:a,inputProps:r,tokens:o}=e,l=i.classnames(t,{"mc-tokenized-input":!0,"mc-tokenized-input-dig2":s}),c=o.map((e=>n.react.exports.cloneElement(e,{onKeyDown:pn})));return n.react.exports.createElement("div",{className:l},c,n.react.exports.cloneElement(a,r))};mn.defaultProps={inputElement:n.react.exports.createElement("input",{className:"mc-tokenized-input-input","aria-label":"typeAhead input",onKeyDown:e=>{const t=e.currentTarget.selectionStart,s=e.currentTarget.selectionEnd,{key:n}=e;if(0===t&&s===t&&("ArrowLeft"===n||"Backspace"===n)){e.preventDefault();const t=e.currentTarget.previousElementSibling;t&&t.focus()}},placeholder:"Type here"}),tokens:[]},mn.displayName="TokenizedInput";const un="typeahead";class gn extends n.react.exports.Component{constructor(){super(...arguments),this.confirmedId=this.props.id||i.generateUUID(un),this.state={suggestionsListSelectedIndex:0,selectedToken:{content:null,key:"",variant:"default"},suggestionListVisible:!1,inputValue:""},this.handleOnClick=e=>{this.setState({selectedToken:e})},this.handleOnTokenBlur=()=>{this.setState({selectedToken:{content:null,key:"",variant:"default"}})},this.handleInputBlur=()=>{this.setState({suggestionListVisible:!1})},this.handleInputFocus=()=>{this.setState({suggestionListVisible:!0})},this.handleTokenFocus=e=>{this.setState({selectedToken:e})},this.handleOnSelect=(e,t)=>{this.props.onSelect(e,t,this.state.inputValue),this.setState({inputValue:""})},this.handleKeyDown=e=>{const{suggestions:t,tokenizeKeyCodes:s}=this.props,{suggestionsListSelectedIndex:n}=this.state,i=e.currentTarget.selectionStart,a=e.currentTarget.selectionEnd,{key:r,which:o}=e;if(0===i&&a===i&&("ArrowLeft"===r||"Backspace"===r)){e.preventDefault();const t=e.currentTarget.previousElementSibling;t&&t.focus()}(!s&&"Enter"===r||s&&-1!==s.indexOf(o))&&(e.preventDefault(),t.length?this.handleOnSelect(t[n],n):this.handleOnSelect(null,-1),this.setState({suggestionsListSelectedIndex:0})),"ArrowUp"===r&&this.setState({suggestionsListSelectedIndex:Math.max(n-1,0)}),"ArrowDown"===r&&this.setState({suggestionsListSelectedIndex:Math.min(n+1,t.length-1)})},this.handleOnChange=e=>{const t=e.currentTarget.value;this.setState({suggestionsListSelectedIndex:0,inputValue:t}),this.props.onChange(t)},this.handleOnRemove=(e,t)=>{this.setState({selectedToken:{content:null,key:"",variant:"default"}}),this.props.onRemoveToken(t.content);const s=e.currentTarget.previousElementSibling,n=e.currentTarget.nextElementSibling;s?s.focus():n&&n.focus()}}UNSAFE_componentWillReceiveProps(e){const{suggestions:t}=e;0===t.length&&this.setState({suggestionsListSelectedIndex:0}),this.props.id!==e.id&&(this.confirmedId=e.id||i.generateUUID(un))}renderTokens(){return this.props.tokens.map((e=>n.react.exports.createElement(hn,Object.assign({},this.props.tokenProps,{dig2retrofit:this.props.dig2retrofit,key:e.key,onClick:()=>this.handleOnClick(e),onClose:t=>this.handleOnRemove(t,e),onBlur:this.handleOnTokenBlur,onFocus:()=>this.handleTokenFocus(e),selected:e.key===this.state.selectedToken.key,variant:e.variant}),this.props.renderTokenContent(e.content))))}renderSuggestionsList(){const{suggestions:e,renderSuggestion:t,height:s,onNextPageRequested:i,listItemHeight:a,"aria-labelledby":r,assignActivedescendant:o}=this.props,{suggestionsListSelectedIndex:l}=this.state;if(this.shouldRenderSuggestionsList())return n.react.exports.createElement(dn,{id:this.confirmedId,"aria-labelledby":r,suggestions:e,onSelect:(e,t)=>this.handleOnSelect(e,t),renderSuggestion:t,height:s,listItemHeight:a,selectedIndex:l,onNextPageRequested:i,assignActivedescendant:o,dig2retrofit:this.props.dig2retrofit})}shouldRenderSuggestionsList(){return this.state.suggestionListVisible&&this.props.suggestions.length>0}render(){const{className:e="",dig2retrofit:t,inputElement:s,inputProps:a,"aria-labelledby":r,assignActivedescendant:o}=this.props,{inputValue:l,suggestionsListSelectedIndex:c}=this.state;return n.react.exports.createElement("div",{className:i.classnames("mc-typeahead",e),role:"combobox","aria-owns":this.confirmedId,"aria-expanded":this.shouldRenderSuggestionsList(),"aria-haspopup":"listbox"},n.react.exports.createElement(mn,{dig2retrofit:t,inputElement:s,tokens:this.renderTokens(),inputProps:Object.assign(Object.assign({},a),{"aria-labelledby":r,"aria-activedescendant":o&&this.confirmedId&&o(this.confirmedId,c),"aria-autocomplete":"list","aria-controls":this.confirmedId,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onChange:this.handleOnChange,onKeyDown:this.handleKeyDown,value:l})}),this.renderSuggestionsList())}}const fn=(_n=i.Contact,{tokenizeAllRawInputs(e){const t=this.tokenizeValidRawInputs(e);return t.length>0?t:[_n.buildFromRawEmail(e)]},tokenizeValidRawInputs:e=>(e.match(_e)||[]).map(_n.buildFromRawEmail),tokenizeDelimitedInputs(e){return Ee.test(e)?this.tokenizeValidRawInputs(e):[]}});var _n;class En{constructor(){}getKey(){return"expand-importer"}}class Sn{constructor({provider:e,connected:t}){this.provider=e,this.connected=t}getKey(){return`third-party-import${this.provider}`}}class Mn extends n.react.exports.Component{constructor(e){super(e),this.updateRecipientData=()=>{this.props.actionHandler.recipientsChange(this.props.typeaheadTokens,this.typeaheadInput.value)},this.filterContacts=e=>this.props.filterContacts?this.props.filterContacts(e):e.email!==this.props.user.email,this.handleTypeaheadOnChange=e=>{const t=fn.tokenizeDelimitedInputs(e);if(t.length>0)return this.validateAndAddTokens(t),void this.typeahead.setState({inputValue:""});this.showSuggestions(e),this.updateRecipientData()},this.handleExpandImport=()=>{this.tokenizeRawInput();const e=[];Array.from(i.ProfileServicesConstants.importable_contact_services()).map((t=>{if(this.profile_services){const s=new Sn({provider:t,connected:this.profile_services.service_is_connected(t)});e.push(s)}})),this.setState({typeaheadSuggestions:e})},this.handleThirdPartyImport=e=>{let t;if(o.assert((t=e.provider,Array.from(i.ProfileServicesConstants.importable_contact_services()).includes(t)),`invalid party contact provider ${e.provider}`),!this.profile_services||!this.profile_services.service_is_connected(e.provider))return this.link_handler.auth_service_with_user(e.provider,this.props.user.id,(e=>i.ProfileServicesLinkingHandler.show_import_notifications(e)));{const t=r.intl.formatMessage({id:"D/rjjz",defaultMessage:"You’re already connected to {service_name}"},{service_name:i.ProfileServicesConstants.to_name(e.provider)});K.Notify.success(t)}},this.handleTypeaheadSelect=(e,t,s)=>{if(e||s)if(e instanceof En)this.handleExpandImport();else if(e instanceof Sn)this.handleThirdPartyImport(e);else{e&&this._logTokenSelect(e,t,s);const n=e?[e]:fn.tokenizeAllRawInputs(s);this.validateAndAddTokens(n),this.setState({typeaheadSuggestions:[]})}},this.handleTypeaheadRemoveToken=e=>{const t=this.props.typeaheadTokens.filter((t=>t!==e));this._logTokenChangeEvent(e,!0),this.props.onTypeaheadTokensChange(t)},this.renderTypeaheadTokenContent=e=>{const t=this._getValidation(e);let s=e.name||e.email;"ok"!==t.state&&t.msg===g.CONTACT_ERROR_MESSAGES.OUT_OF_TEAM&&(s=e.email);return this._logTokenChangeEvent(e,!1,{did_select_suggestion:!1}),n.react.exports.createElement(nn,{avatarUrl:e.photo_url,displayName:s,validation:t})},this.setTypeaheadRef=e=>{this.typeahead=e},this.setTypeaheadInputRef=e=>{this.typeaheadInput=e},this.finishLogging=e=>{const t=this.contactsDataSource.getStats().numLocalContacts;if(this._flush_unfinished_queries_cache(),this.shouldLogSearch())return this.contact_search_logger.log_records(this.props.user.id,e,t)},this._logTokenSelect=(e,t,s)=>{const n={search_expr:s,selected_pos:t||0,num_query_results:this.state.typeaheadSuggestions.length,did_select_suggestion:!0};this._logTokenChangeEvent(e,!1,n)},this._logTokenChangeEvent=(e,t=!1,s={})=>{if(this.contact_search_logger&&e){if(!t){const t={context:this._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null,event_ts:window.performance.now()};for(const e in s)s[e]&&(t[e]=s[e]);return this.contact_search_logger.add_record(t)}{const t=e.getContactID();if(t)return this.contact_search_logger.flag_record_as_removed(t)}}},this._logSearchComplete=(e,t,s=!0)=>{if(!this.shouldLogSearch()||!e)return;const n=window.performance.now();let i=this.unfinished_contact_search_queries[e];if(!i)return;const a=i.begin_time;!("ttfr"in i)&&t>0&&(i.ttfr=Math.floor(n-a)),s?(i.local_duration=Math.floor(n-a),i.num_local_results=t):(i.remote_duration=Math.floor(n-a),i.num_additional_remote_results=t),i.num_results+=t;return(()=>this.contactsDataSource.isSearchLocalOnly()&&s||!s)()?(i=this._prepareSearchStatsForLogging(i,e,n,!0),this.contact_search_logger.add_timing_record(i),this.contact_search_logger.count_search(i.is_slow),delete this.unfinished_contact_search_queries[e]):void 0},this._logSearchBegin=e=>{if(!this.shouldLogSearch()||!e)return;const t=window.performance.now();return this._flush_unfinished_queries_cache(t),this.unfinished_contact_search_queries[e]={begin_time:t,num_results:0}},this._flush_unfinished_queries_cache=e=>{if(this.shouldLogSearch()){null==e&&(e=window.performance.now());for(const t in this.unfinished_contact_search_queries)if(this.unfinished_contact_search_queries[t]){let s=this.unfinished_contact_search_queries[t];e&&e-s.begin_time<i.CONTACTS_SEARCH_PREEMPTED_THRESHOLD&&(s.is_preempted=!0),s=this._prepareSearchStatsForLogging(s,t,e,!1),this.contact_search_logger.add_timing_record(s),this.contact_search_logger.count_search(s.is_slow)}return this.unfinished_contact_search_queries={}}},this._prepareSearchStatsForLogging=(e,t,s,n)=>{const i=e.begin_time;e.duration=Math.floor(s-i),"ttfr"in e?e.is_slow=e.ttfr>100:n&&0===e.num_results?e.is_slow=!1:e.is_slow=e.duration>100;const a=this.contactsDataSource.getStats().localContactsDownloadedTime;return e.started_before_download=null==a||i<a,"is_preempted"in e||(e.is_preempted=!1),e.context=this._getLoggingContext(),e.query_length=t.length,e.is_finished=n,e},this._getLoggingContext=()=>{let e="spectrum_tokenizer";return null!=this.props.context&&(e+=`_${this.props.context}`),e},this.state={typeaheadSuggestions:[]},this.link_handler=new i.ProfileServicesLinkingHandler,this.profile_services=null,this.props.teamGroupInfo||this.props.showContactImport&&this.props.user&&(this.profile_services=i.LinkedProfileServices.get_linked_profile_services_for_user(this.props.user.id))}getContacts(){return this.tokenizeRawInput(),this.props.typeaheadTokens}focusTypeaheadInput(){n.reactDom.exports.findDOMNode(this.typeaheadInput).focus()}addExternalContacts(e){this.validateAndAddTokens(e)}componentDidMount(){this.contactsDataSource=this.initContactsDataSource(this.props.user,this.filterContacts),this.props.shouldLogContactSearch&&(this.contact_search_logger=new i.ContactSearchLogger(this._getLoggingContext(),this.contactsDataSource.searchModeName),this.unfinished_contact_search_queries={}),this.props.initialTypeaheadTokens&&this.props.initialTypeaheadTokens.length>0&&this.validateAndAddTokens(this.props.initialTypeaheadTokens),this.props.focusOnMount&&this.focusTypeaheadInput(),this.props.actionHandler.suggestTargets({force_refresh:!0})}componentDidUpdate(e,t){if(this.contactsDataSource=this.initContactsDataSource(this.props.user,this.filterContacts),this.state.typeaheadSuggestions.length>0){const e=this.state.typeaheadSuggestions[0]instanceof En,s=this.state.typeaheadSuggestions[0]instanceof Sn;t.typeaheadSuggestions===this.state.typeaheadSuggestions||e?(e||s)&&this.typeahead.setState({suggestionsListSelectedIndex:-1}):this.typeahead.setState({suggestionsListSelectedIndex:0})}e.typeaheadTokens!==this.props.typeaheadTokens&&this.updateRecipientData()}tokenizeRawInput(){const e=this.typeaheadInput.value;if(""!==e){const t=fn.tokenizeAllRawInputs(e);this.validateAndAddTokens(t),this.typeahead.setState({inputValue:""})}}getSuggestionRenderer(){return this.props.renderTypeaheadSuggestion}getSuggestions(){return this.state.typeaheadSuggestions}render(){return n.react.exports.createElement(gn,{ref:this.setTypeaheadRef,className:this.props.className,height:160,inputProps:{ref:this.setTypeaheadInputRef,disabled:this.props.disabledInput,placeholder:this.props.typeaheadTokens.length>0?"":this.props.typeaheadPlaceholder,"aria-label":r.intl.formatMessage({id:"rQOIK5",defaultMessage:"Contact name"})},listItemHeight:48,onChange:this.handleTypeaheadOnChange,onRemoveToken:this.handleTypeaheadRemoveToken,onSelect:this.handleTypeaheadSelect,renderSuggestion:this.getSuggestionRenderer(),renderTokenContent:this.renderTypeaheadTokenContent,suggestions:this.getSuggestions(),suggestionsBuffer:0,tokens:this.createTypeaheadTokenObjects()})}initContactsDataSource(e,t){return new i.ContactsDataSourceV2(e,t,!1)}_getValidation(e){const t=this.props.actionHandler.getSharingInfo().recipientAccess(),s=this.props.actionHandler.getSharingInfo().recipientValidation()[t]||{},n=e.getKey();return s[n]?s[n]:{state:"pending",msg:null}}getVariantForTypeaheadToken(e){const t=this._getValidation(e);return"invalid"===t.state?"error":"warn"===t.state?"warning":"default"}createTypeaheadTokenObjects(){return this.props.typeaheadTokens.map((e=>({key:e.getKey(),variant:this.getVariantForTypeaheadToken(e),content:e})))}filterExistingTokens(e){if(!e)return[];const t=this.props.typeaheadTokens.map((e=>e.getKey()));return e.filter((e=>!t.includes(e.getKey())))}suggestSharingTargets(e){this.props.actionHandler.suggestTargets({query:e}).then((e=>{e?this.setSuggestions(this.filterExistingTokens(e.filter((e=>this.filterContacts(e))))):this.typeahead.setState({suggestionsListSelectedIndex:-1})}))}is_server_side_contact_search_on(){return"ON"===this.props.actionHandler.getSharingInfo().sharingPrefs().in_server_side_contact_search_settings}showSuggestions(e){if(this.is_server_side_contact_search_on())return this.suggestSharingTargets(e);this._logSearchBegin(e);const t=[];this.contactsDataSource.search(e,(s=>{t.push(...this.filterExistingTokens(s)),this.setSuggestions(t),this._logSearchComplete(e,(null!=s?s.length:void 0)||0,!0)}),(s=>{const n=this.filterExistingTokens(s);e===this.typeaheadInput.value&&n.length>0&&(t[t.length-1]instanceof En?t.push(...n.concat(t.pop())):t.push(...n),this.setState({typeaheadSuggestions:t})),this._logSearchComplete(e,s.length,!1)}))}setSuggestions(e){const t=e;this.props.teamGroupInfo?t.push(Ms.teamGroupInfoToContact(this.props.teamGroupInfo)):this.props.showContactImport&&t.push(new En),this.setState({typeaheadSuggestions:t})}validateAndAddTokens(e){const t=e.reduce(((e,t)=>(t.pending&&t.query&&e.push(t.query),e)),[]),s=t=>{const{onTypeaheadTokensChange:s,typeaheadTokens:n}=this.props,i=[],a=n.map((e=>e.getKey()));for(const s of e){let e=s;if(e.pending&&e.query){const s=this.contactsDataSource.normalizeQuery(e.query),n=this.determineQueryMatch(s,t[s]);n&&(e=n)}const n=e.getKey();a.includes(n)||(a.push(n),i.push(e))}s(n.concat(i))};if(!this.is_server_side_contact_search_on())return this.contactsDataSource.searchBatch(t,s,s);{const t=this.props.typeaheadTokens.map((e=>e.getKey())),s=[];for(const n of e){const e=n.getKey();t.includes(e)||(t.push(e),s.push(n))}this.props.onTypeaheadTokensChange(this.props.typeaheadTokens.concat(s))}}determineQueryMatch(e,t){if(!t||!e)return null;const s={email:[],name:[]};for(const n of t){const t=n.email?this.contactsDataSource.normalizeQuery(n.email):null,i=n.name?this.contactsDataSource.normalizeQuery(n.name):null;e===t?s.email.push(n):e===i&&s.name.push(n)}for(const e of["email","name"])if(1===s[e].length)return s[e][0];return null}shouldLogSearch(){return!this.is_server_side_contact_search_on()&&this.props.shouldLogContactSearch&&null!=this.contact_search_logger}}Mn.displayName="ShareContactsTokenizer",Mn.defaultProps={disabledInput:!1,shouldLogContactSearch:!1,renderTypeaheadSuggestion:e=>{return e instanceof En?n.react.exports.createElement("div",{className:"typeahead-option"},n.react.exports.createElement(h.Flag,{leftAttachment:n.react.exports.createElement(i.Image,{className:"u-pad-right-s",src:n.static_url("/static/metaserver/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:n.static_url("/static/metaserver/static/images/icons/icon-import@2x-vfluE8TBO.png")})},n.react.exports.createElement("div",{className:"option-primary option-only"},r.intl.formatMessage({id:"H3lmrv",defaultMessage:"Import contacts"})))):e instanceof Sn?(t=e,n.react.exports.createElement(kn,{import:t})):(e=>{const t=e.name||e.email,s=e.group_id?(e=>{const t=e.toUpperCase().split(" ");return`${t[0][0]}${t.length>1?t[t.length-1][0]:""}`})(e.name):i.getInitials(t),a=e.group_id?r.intl.formatMessage({id:"XMHn5C",defaultMessage:"{count, plural, one{# member} other{# members}}"},{count:e.group_size||0}):e.email;return n.react.exports.createElement(Vs,{id:e.getKey(),initials:s,avatarUrl:e.photo_url,description:a,displayName:t,tag:"div",variant:"narrow"})})(e);var t}};class kn extends n.react.exports.PureComponent{constructor(e){super(e),this.show_contact_import_spinner=e=>{if(this.props.import.provider===e.provider)return this.setState({showLoading:!0})},this.state={showLoading:!1}}componentDidMount(){return this.authCompleteListenerToken=i.addAuthCompleteListener(this.show_contact_import_spinner)}componentWillUnmount(){return i.removeAuthCompleteListener(this.authCompleteListenerToken)}render(){const{provider:e,connected:t}=this.props.import,s=i.ProfileServicesConstants.to_img_legacy(e);let a=i.ProfileServicesConstants.to_name(e);a=!t&&this.state.showLoading?r.intl.formatMessage({id:"3dBlC+",defaultMessage:"Importing {service_name} Contacts"},{service_name:a}):r.intl.formatMessage({id:"T+Ryks",defaultMessage:"Sign in with {service_name} to import contacts"},{service_name:a});const o=t?r.intl.formatMessage({id:"2/+46g",defaultMessage:"Connected"}):"";return n.react.exports.createElement("div",{className:"typeahead-option"},n.react.exports.createElement(h.Flag,{leftAttachment:n.react.exports.createElement(i.Image,{className:"u-pad-right-s",src:n.static_url(s[0]),srcHiRes:n.static_url(s[1])})},n.react.exports.createElement("div",{className:"option-primary"},a),n.react.exports.createElement("div",{className:"option-secondary u-font-meta"},o)))}}kn.displayName="ThirdPartyImportOption";class bn extends n.React$1.Component{constructor(e){super(e),this.finishLogging=e=>this.shareContactsTokenizerRef.finishLogging(e),this.setShareContactsTokenizerRef=e=>{this.shareContactsTokenizerRef=e},this.onTypeaheadTokensChange=e=>{this.setState({typeaheadTokens:e})},this.handleAccessTypeChange=e=>{this.props.actionHandler.changeRecipientAccess(e)},this.filterContacts=e=>this.props.isTeamSharedFolder?!!e.group_id:this.props.isInContentManager||e.email!==this.props.user.email,this.state={typeaheadTokens:[]}}getContacts(){return this.shareContactsTokenizerRef.getContacts()}focusTypeaheadInput(){return this.shareContactsTokenizerRef.focusTypeaheadInput()}addExternalContacts(e){return this.shareContactsTokenizerRef.addExternalContacts(e)}render(){const e=this.props.isTeamSharedFolder?r.intl.formatMessage({id:"aTEm56",defaultMessage:"Add groups:"}):r.intl.formatMessage({id:"bLfZ53",defaultMessage:"To:"}),t=r.intl.formatMessage({id:"CIbq3r",defaultMessage:"This file type can only be shared with view access"});return n.React$1.createElement(sn,{contactsField:this.renderContactsField(),labelledAccessTypes:this.getAccessTypes(),onAccessTypeChange:this.handleAccessTypeChange,selectedAccessType:this.getSelectedAccessType(),toLabel:e,showNoEditTooltip:this.props.contentInfo.isFile()&&!this.props.canInviteEditor,noEditText:t})}getAccessTypes(){const e=[],t=e=>r.intl.formatMessage({id:"+f5spv",defaultMessage:"change permission for users to {label}"},{label:e}),s=ys,n=this.props.contentInfo&&this.props.contentInfo.isFolder()?ws:this.props.actionHandler.getSharingInfo().isCloudDoc()?Ts:Is;return this.props.canInviteEditor&&e.push({apiId:i.ACCESS_LEVEL.WRITER,ariaLabel:t(i.ACCESS_LEVEL.WRITER),label:s[i.ACCESS_LEVEL.WRITER],details:n[i.MEMBER_ACTION.MAKE_EDITOR]}),this.props.canInviteViewer&&e.push({apiId:i.ACCESS_LEVEL.READER,ariaLabel:t(i.ACCESS_LEVEL.READER),label:s[i.ACCESS_LEVEL.READER],details:n[i.MEMBER_ACTION.MAKE_VIEWER]}),e}getSelectedAccessType(){const e=this.props.actionHandler.getSharingInfo(),t=this.getAccessTypes();let s;for(const n of t)n.apiId===e.recipientAccess()&&(s=n);return s}renderContactsField(){return n.React$1.createElement(Mn,{ref:this.setShareContactsTokenizerRef,actionHandler:this.props.actionHandler,typeaheadTokens:this.state.typeaheadTokens,onTypeaheadTokensChange:this.onTypeaheadTokensChange,context:this.props.context,focusOnMount:this.props.focusOnMount,initialTypeaheadTokens:this.props.initialTypeaheadTokens,typeaheadPlaceholder:this.props.typeaheadPlaceholder,user:this.props.user,filterContacts:this.filterContacts,shouldLogContactSearch:this.props.shouldLogContactSearch,showContactImport:this.props.showContactImport,teamGroupInfo:this.props.teamGroupInfo})}}bn.displayName="ShareModalContactsSection";const vn="scl-sharing-modal-footer-link-list";class Cn extends n.react.exports.PureComponent{render(){const e=i.classnames(vn,this.props.className);return n.react.exports.createElement("div",{className:e},n.react.exports.createElement("div",{className:`${vn}__header`},n.react.exports.createElement("div",{className:`${vn}__title`},this.props.title),n.react.exports.createElement("div",{className:`${vn}__actions`},this.props.actions)),n.react.exports.createElement("div",{className:`${vn}__items`},this.props.children))}}Cn.displayName="SharingModalFooterLinkList";class yn extends n.React$1.Component{constructor(){super(...arguments),this.onClickButtonLinkSettings=()=>{this.props.mode===l.MODES.LINK_ONLY?this.props.actionHandler.handleLinkSettingsClick():this.props.onLinkSettingsClick()}}renderSharedLinks(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();if(e.isCloudDoc()){let t,s;return e&&e.sharedLinks()&&(t=e.editRighteousLink(),s=e.viewRighteousLink(),s||(s=e.shmodelLink())),[this.renderModalLinkInfo(t,"editor"),this.renderModalLinkInfo(s,"viewer")]}{const t=e.shmodelLink();return this.renderModalLinkInfo(t,"viewer")}}renderModalLinkInfo(e,t){return n.React$1.createElement(wt,{key:t,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,linkMetadata:e,linkAccessLevel:t,mode:this.props.mode,user:this.props.user,isLinkMetadataLoaded:this.props.isLinkMetadataLoaded,isTeamSharedFolder:this.props.isTeamSharedFolder,canShareLink:this.props.canShareLink,permissions:this.props.permissions,modalClose:this.props.closeModalHandler})}renderActions(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();if(e.sharedLinks()&&e.sharedLinks().length>0&&(!e.isCloudDoc()||e.permissionsObj().canCreateEditLink()||e.permissionsObj().canCreateViewLink()))return n.React$1.createElement(i.Button$1,{variant:"borderless",onClick:this.onClickButtonLinkSettings},r.intl.formatMessage({id:"zxECIJ",defaultMessage:"Link settings"}))}render(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();return n.React$1.createElement("div",{className:i.classnames({"unified-share-modal-two-link-model":!0,"unified-share-modal-two-link-model--upsell-enabled":e.isShareModalUpsellPremiumSharing()})},(()=>this.props.isLinkMetadataLoaded?n.React$1.createElement(Cn,{className:i.classnames({"scl-sharing-modal-footer-link-list--no-border":this.props.mode===l.MODES.LINK_ONLY}),title:r.intl.formatMessage({id:"gzuZCm",defaultMessage:"Share a link"}),actions:this.renderActions()},this.renderSharedLinks()):void 0)())}}yn.displayName="ShareModalFooterLinkSection";class wn extends n.React$1.Component{constructor(){super(...arguments),this.handleCopyLinkClicked=()=>{W.copyToClipboard(this.getLinkUrl(),(()=>f.sharingNotificationSuccess(r.intl.formatMessage({id:"z1RKgB",defaultMessage:"Link copied to clipboard"}))),(()=>f.sharingNotificationError(r.intl.formatMessage({id:"zMYKz7",defaultMessage:"Unable to copy the link, please copy manually"})))),this.logCopyEvent()}}render(){const{className:e,sharingInfo:t,onClickCloseButton:s}=this.props;return n.React$1.createElement("div",{className:e},n.React$1.createElement(m.SharingModalHeaderTitle,{closeButtonVisible:!0,icon:n.React$1.createElement(i.IconContent,{name:"dlink-small"}),onClickCloseButton:s,title:t.name()}),n.React$1.createElement(tt,{labelSharedLinkUrl:r.intl.formatMessage({id:"vLmOAd",defaultMessage:"Shared link URL"}),isIconHidden:!0,inputProps:{autoFocus:!1},onClickButton:this.handleCopyLinkClicked,sharedLinkUrl:this.getLinkUrl(),textButton:r.intl.formatMessage({id:"L4Tupd",defaultMessage:"Copy link"})}))}getLinkUrl(){return this.props.sharingInfo.isLinkMetadataLoaded()?this.props.sharingInfo.sharedLinks()[0].url:""}logCopyEvent(){const e=this.props.sharingInfo.user(),t=this.props.sharingInfo.contentInfo();g.logTiburonEvent(t,e.id,u.TiburonEventName.CopySharedLink,{type:"pointer"})}}function In({level:e="defaultLevel",message:t}){if(!t)return null;const s={[g.ContactsErrorLevel.Error]:"error",[g.ContactsErrorLevel.Warn]:"warn",defaultLevel:"default"}[e];return n.React$1.createElement(F.SharingModalBanner,{className:"contacts-error-banner",type:s,message:t})}wn.displayName="ShareModalPointerMode";class Tn extends n.React$1.Component{constructor(){super(...arguments),this.getNoPermissionMessage=()=>this.props.isTeamSharedFolder?this.getTeamSharedFolderMessage():this.props.isFolder?r.intl.formatMessage({id:"7nUdHD",defaultMessage:"You don’t have permission to manage membership of this folder"}):r.intl.formatMessage({id:"Bg4C2n",defaultMessage:"You don’t have permission to manage membership of this file"})}render(){return n.React$1.createElement(F.SharingModalBanner,{message:this.getNoPermissionMessage()})}getTeamSharedFolderMessage(){return this.renderTeamFolderNoPermissionMessage()?r.intl.formatMessage({id:"Ia9tjc",defaultMessage:"This folder is automatically shared with all members of {team_name}"},{team_name:this.props.teamName}):r.intl.formatMessage({id:"6Vgz8b",defaultMessage:"Only <admin_link>admins</admin_link> and <group_link>group managers</group_link> can change team folder membership."},{admin_link:e=>n.React$1.createElement("a",{href:"/team?_tk=left_nav_team",target:"_blank",rel:"noreferrer"},e),group_link:e=>n.React$1.createElement("a",{href:"/help/7232#transfer",target:"_blank",rel:"noreferrer"},e)})}renderTeamFolderNoPermissionMessage(){return M.get(this.props,"members.groups",{}).some((e=>"team"===e.group_type&&M.get(e,"permissions.make_editor.allow")&&M.get(e,"permissions.make_viewer.allow")))}}Tn.displayName="SharingModalNoPermissionsSection";class An extends n.react.exports.Component{constructor(){super(...arguments),this.restoreAccessToConfidentialFolder=()=>{const{teamName:e,onRestoreAccessClick:t}=this.props;t(!0,e)}}render(){const{intl:e,teamName:t,parentFolderName:s,isRestoreAccessEnabled:a}=this.props;let r,o;""!==s?(r=e.formatMessage({id:"V1N9tG",defaultMessage:'This folder isn’t shared with everyone who has access to parent folder "{parent}".'},{parent:m.Emstring.em_snippet(s,i.SNIPPET_SIZES.FILENAME)}),o=e.formatMessage({id:"R+Gy+p",defaultMessage:"Share with everyone"})):(r=e.formatMessage({id:"z87QTd",defaultMessage:"This folder isn’t shared with everyone on {team_name}."},{team_name:m.Emstring.em_snippet(t,i.SNIPPET_SIZES.DISPLAY_NAME)}),o=e.formatMessage({id:"R+Gy+p",defaultMessage:"Share with everyone"}));const l=n.react.exports.createElement("div",{className:"confidential-folder-section"},r," ",a&&n.react.exports.createElement(i.Button,{className:"button-as-link","aria-label":o,key:"restore access",variant:"transparent",size:"small",hasNoUnderline:!0,onClick:this.restoreAccessToConfidentialFolder},o));return n.react.exports.createElement(F.SharingModalBanner,{type:"dark",message:l})}}An.displayName="ConfidentialFolderSection";class Ln extends n.react.exports.PureComponent{render(){const{className:e,children:t,onChange:s,value:a,placeholder:r}=this.props,o=i.classnames("scl-sharing-modal-message-field",e);return n.react.exports.createElement("div",{className:o},n.react.exports.createElement("textarea",{"aria-label":r,className:"scl-textarea",placeholder:r,onChange:s,value:a}),t)}}Ln.displayName="SharingModalMessageField";class Rn extends n.React$1.Component{constructor(){super(...arguments),this.handleSettingsButtonClick=e=>{e.preventDefault(),this.props.onSettingsButtonClick(),this.context.logEvent(u.TiburonEventName.ClickSettingsGear,void 0,{screen:u.ScreenName.ManageAccessScreen})}}render(){return n.React$1.createElement(m.SharingModalHeaderWithBackButton,{autoFocus:!0,closeButtonVisible:!0,settingsButtonVisible:!0,onClickBackButton:this.props.onBackButtonClick,onClickCloseButton:this.props.onCloseButtonClick,onClickSettingsButton:this.handleSettingsButtonClick,label:r.intl.formatMessage({id:"oMWVkR",defaultMessage:"Back"})})}}Rn.displayName="HeaderSection",Rn.contextType=os;const Nn=e=>e.type===i.ContactTypes.EMAIL?e.name&&e.name.length?Object.assign(Object.assign({".tag":"user",dbx_team_id:e.dbx_team_id||""},void 0!==e.photo_url?{photo_url:e.photo_url}:{}),{name:e.name,sort_key:e.name,dbx_account_id:e.dbx_account_id||"",email:e.email||""}):m.createFromEmail(e.email||""):e.type===i.ContactTypes.NEW_STYLE_GROUP?{".tag":"group",dbx_team_id:e.dbx_team_id||"",members:e.members||"",name:e.name,sort_key:e.name,group_id:e.group_id||"",group_size:e.group_size||0}:e.type===i.ContactTypes.DBX_ID?Object.assign(Object.assign({".tag":"user",dbx_team_id:e.dbx_team_id||""},void 0!==e.photo_url?{photo_url:e.photo_url}:{}),{name:e.name,sort_key:e.name,dbx_account_id:e.dbx_account_id||"",email:e.email||""}):m.createFromEmail(""),xn=e=>"email"===e[".tag"]?i.Contact.buildFromRawEmail(e.email):"group"===e[".tag"]?new i.Contact({type:i.ContactTypes.NEW_STYLE_GROUP,dbx_team_id:e.dbx_team_id,members:e.members,name:e.name,group_id:e.group_id,group_size:e.group_size}):"user"===e[".tag"]?e.dbx_account_id?new i.Contact(Object.assign(Object.assign({type:i.ContactTypes.EMAIL,dbx_team_id:e.dbx_team_id},void 0!==e.photo_url?{photo_url:e.photo_url}:{}),{name:e.name,invalid:!i.validateEmail(e.email),dbx_account_id:e.dbx_account_id,email:e.email})):i.Contact.buildFromRawEmail(e.email):m.exhausts(e,i.Contact.buildFromRawEmail("")),Pn=e=>"invalid"===e.state?{".tag":"disallowed",disallowed:{".tag":"other"}}:"ok"===e.state?{".tag":"allowed",allowed:{".tag":"no_warning"}}:"warn"===e.state?{".tag":"allowed",allowed:{".tag":"other"}}:{".tag":"other"},Fn=e=>"owner"===e?{".tag":"owner"}:"reader"===e?{".tag":"viewer"}:"writer"===e?{".tag":"editor"}:"reader_no_comment"===e?{".tag":"viewer_no_comment"}:{".tag":"other"},On=e=>"editor"===e?{".tag":"editor"}:"viewer"===e?{".tag":"viewer"}:m.exhausts(e,{".tag":"other"}),Dn=e=>{var t,s;const n=[];return void 0===e||((null===(t=e.invite_editor)||void 0===t?void 0:t.allow)&&n.push({action:{".tag":"invite_editor"},allow:!0}),(null===(s=e.invite_viewer)||void 0===s?void 0:s.allow)&&n.push({action:{".tag":"invite_viewer"},allow:!0})),n},$n=e=>{var t,s,n,i;const a=[];return void 0===e||((null===(t=e.invite_editor)||void 0===t?void 0:t.allow)&&a.push({action:{".tag":"invite_editor"},allow:!0}),(null===(s=e.invite_viewer)||void 0===s?void 0:s.allow)&&a.push({action:{".tag":"invite_viewer"},allow:!0}),(null===(n=e.create_edit_link)||void 0===n?void 0:n.allow)&&a.push({action:{".tag":"create_edit_link"},allow:!0}),(null===(i=e.create_view_link)||void 0===i?void 0:i.allow)&&a.push({action:{".tag":"create_view_link"},allow:!0})),a},Bn=e=>{var t,s,n,i,a;const r=e.metadata(),o=e.contentInfo();if(void 0===r)throw new Error("Adapter error.");if(r.isFolder()){if(r.isNewSharedFolder()){const e=r;return Object.assign(Object.assign({".tag":"file_folder",access_type:Fn(r.access_type),is_inside_team_folder:null!==(t=o.isFolderInsideTeamFolderTree())&&void 0!==t&&t,is_team_folder:null!==(s=o.isTeamSharedFolder())&&void 0!==s&&s,owner_team:e.owner_team,path_lower:e.path_lower},void 0!==e.is_confidential?{is_confidential:e.is_confidential}:{}),{name:r.name,policy:{acl_update_policy:{".tag":"other"},shared_link_policy:{".tag":"other"}},permissions:Dn(r.permissions)})}{const e=r;return Object.assign(Object.assign({".tag":"shared_folder",access_type:Fn(r.access_type),is_inside_team_folder:null!==(n=o.isFolderInsideTeamFolderTree())&&void 0!==n&&n,is_team_folder:null!==(i=o.isTeamSharedFolder())&&void 0!==i&&i,owner_team:e.owner_team,path_lower:e.path_lower},void 0!==e.is_confidential?{is_confidential:e.is_confidential}:{}),{name:r.name,permissions:Dn(r.permissions),policy:{member_policy:{".tag":e.policy.member_policy},resolved_member_policy:{".tag":e.policy.resolved_member_policy},acl_update_policy:{".tag":e.policy.acl_update_policy},download_policy:{".tag":e.policy.download_policy},viewer_info_policy:{".tag":e.policy.viewer_info_policy},shared_link_policy:{".tag":e.policy.shared_link_policy}},preview_url:e.preview_url||"",shared_folder_id:e.shared_folder_id.toString(),time_invited:(null===(a=e.time_invited)||void 0===a?void 0:a.toString())||""})}}{const e=r;return{".tag":"file",access_type:Fn(e.access_type),download_policy:{".tag":"other"},id:e.id,name:e.name,owner_team:e.owner_team,path_display:e.path_display,path_lower:e.path_lower,permissions:$n(e.permissions),policy:{acl_update_policy:{".tag":"other"},download_policy:{".tag":"other"},shared_link_policy:{".tag":"other"}},preview_url:""}}},Un=e=>{const t=e.user();return{id:t.id,email:t.email,is_team:!!t.is_team,is_team_admin:t.is_team_admin,account_id:t.account_id,team_dbtid:t.team_dbtid}},Hn=e=>{const t=e.sharedLinks();if(null==t)throw new Error("Adapt error");let s=[];for(let e of t)s.push((i=void 0,a=void 0,r=void 0,{".tag":(n=e).file_type,url:n.url,id:n.id,name:n.name,path_lower:n.path_lower,link_permissions:(i=n.link_permissions,{resolved_visibility:(r=i.resolved_visibility,"public"===r?{".tag":"public"}:"team_only"===r?{".tag":"team_only"}:"password"===r?{".tag":"password"}:"team_and_password"===r?{".tag":"team_and_password"}:"shared_folder_only"===r?{".tag":"shared_folder_only"}:"no_one"===r?{".tag":"no_one"}:"only_you"===r?{".tag":"only_you"}:m.exhausts(r,{".tag":"other"})),can_revoke:i.can_revoke,visibility_policies:[],can_set_expiry:i.can_set_expiry,can_remove_expiry:i.can_remove_expiry,allow_download:i.allow_download,can_allow_download:i.can_allow_download,can_disallow_download:i.can_disallow_download,allow_comments:i.allow_comments,team_restricts_comments:i.team_restricts_comments,effective_audience:(a=i.effective_audience,a?"public"===a?{".tag":"public"}:"team"===a?{".tag":"team"}:"password"===a?{".tag":"password"}:"no_one"===a?{".tag":"no_one"}:{".tag":"other"}:void 0),link_access_level:On(i.link_access_level)}),preview_type:n.preview_type}));var n,i,a,r;return{links:s,has_more:!1}},Vn=e=>{const t=e.sharingPrefs();if(void 0===t)throw new Error("Adapt error");return{confidential_folder_links_enabled:t.confidential_folder_links_enabled}},Gn=({user:e,contentInfo:t,sharingInfo:s,children:a})=>{const o=n.React$1.useCallback((e=>{"TEAMS_WEB"===e.type&&i.TeamsWebActionsLogger.log(e.payload.name,e.payload.extra)}),[t,e.id]),l=n.React$1.useMemo((()=>m.initializeSdk(e)),[e]);return n.React$1.createElement(m.Provider,{intl:r.intl,sdk:l,loggingSink:o,redirectWindowToken:he.REDIRECT_WINDOW_TOKEN,platform:m.Platforms.METASERVER,origin:t.extras.origin},n.React$1.createElement(m.MetadataProvider,{sharingObjectMetadata:Bn(s)},a))};Gn.displayName="SharingSdkProviderWithLoggingContext";class Wn extends n.react.exports.Component{constructor(e){super(e),this.state={objectMetadata:Bn(this.props.actionHandler.getSharingInfo()),linksMetadata:Hn(this.props.actionHandler.getSharingInfo()),sharingPrefs:Vn(this.props.actionHandler.getSharingInfo())}}render(){return n.react.exports.createElement(m.ShareModalManageLinksInner,{linksMetadata:this.state.linksMetadata,objectMetadata:this.state.objectMetadata,sharingPrefs:this.state.sharingPrefs,onViewLinkSettingsClick:this.props.onViewLinkSettingsClick,onEditLinkSettingsClick:this.props.onEditLinkSettingsClick})}}Wn.displayName="SharingSdkLinksInMemberList";const Kn=i.defineMessages({downgradeBannerHeader:{id:"YBKCoS",defaultMessage:"People who can view could still edit via link"},removeBannerHeader:{id:"w/RnTZ",defaultMessage:"People might still have access via link"},downgradeBannerSubheader:{id:"iYhJt/",defaultMessage:"You can delete the link to further restrict access."},downgradeBannerGotIt:{id:"YCTkuR",defaultMessage:"Got It"},downgradeBannerManageLinks:{id:"J9wEBS",defaultMessage:"Manage Links"}}),zn=i.defineMessages({peopleTab:{id:"kUwFiX",defaultMessage:"People"},linksTab:{id:"Iv9euZ",defaultMessage:"Links"}});class jn extends n.React$1.Component{constructor(e){super(e),this.setSelectedTab=e=>{this.setState({selectedTab:e}),this.context.logEvent(u.TiburonEventName.ViewManageAccessTab,void 0,{manage_access_tab:e,manually_switch_tab:!0})},this.getCurrentTab=()=>this.state.selectedTab,this.isMemberListEmpty=()=>{const e=this.props.membership,t=this.props.memberListProps.linkMembers,s=this.props.memberListProps.guestMembers,{groups:n,invitees:i,users:a}=e;return(!t||0===t.length)&&(!s||0===s.length)&&n.isEmpty()&&i.isEmpty()&&a.isEmpty()},this.handleViewLinkSettingsButtonClick=()=>{this.props.onLinkSettingsTextClick(m.VIEW_LINK_SETTINGS)},this.handleEditLinkSettingsButtonClick=()=>{this.props.onLinkSettingsTextClick(m.EDIT_LINK_SETTINGS)},this.enableSecurityBanner=e=>{this.setState({showSecurityBanner:!0,securityBannerType:e})},this.hideSecurityBanner=()=>{this.setState({showSecurityBanner:!1})},this.openLinkSettings=e=>{e.preventDefault(),this.props.actionHandler.openSharingSettingsModal("edit_link_settings")};const t=this.isMemberListEmpty()?u.ManageAccessTabName.ManageLinksTab:u.ManageAccessTabName.ManagePeopleTab;this.state={showSecurityBanner:!1,securityBannerType:js.DowngradeAccess,selectedTab:this.props.currentTab||t}}componentDidMount(){this.shouldRenderLinksInMemberList()?(this.context.logEvent(u.TiburonEventName.ViewManageAccessScreen,void 0,{manage_access_tab:this.getCurrentTab(),is_member_list_empty:this.isMemberListEmpty(),lml_variant:this.props.actionHandler.getSharingInfo().sharingPrefs().exp_links_in_member_list}),this.context.logEvent(u.TiburonEventName.ViewManageAccessTab,void 0,{manage_access_tab:this.getCurrentTab(),manually_switch_tab:!1})):this.context.logEvent(u.TiburonEventName.ViewManageAccessScreen,void 0,{lml_variant:this.props.actionHandler.getSharingInfo().sharingPrefs().exp_links_in_member_list})}render(){return this.shouldRenderLinksInMemberList()?this.renderManageAccessListWithLinksList():this.renderManageAccessList()}renderManageAccessList(){return n.React$1.createElement(m.ActionContainer,{header:this.getTitle(),headerSize:"small",banner:this.renderBanner(),showBorder:!0},this.isMemberListEmpty()?this.renderEmptyMemberList():n.React$1.createElement(qs,Object.assign({},this.props.memberListProps,{onShowSecurityBanner:this.enableSecurityBanner})))}renderMemberList(){return this.isMemberListEmpty()?this.renderEmptyMemberList():this.renderNotEmptyMemberList()}renderEmptyMemberList(){const e=this.props.actionHandler.getContentInfo().isFile(),t=this.props.actionHandler.getContentInfo().isFileFolder();return n.React$1.createElement(m.EmptyMemberList,{isFile:e,isFileFolder:t,canInviteMembers:this.props.canInviteMembers})}renderNotEmptyMemberList(){return n.React$1.createElement(qs,Object.assign({},this.props.memberListProps,{onShowSecurityBanner:this.enableSecurityBanner}))}shouldRenderLinksInMemberList(){return this.props.actionHandler.getSharingInfo().sharingPrefs().exp_links_in_member_list===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON}renderManageAccessListWithLinksList(){const e=r.intl.formatMessage(zn.peopleTab),t=r.intl.formatMessage(zn.linksTab);return n.React$1.createElement(m.ActionContainer,{header:this.getTitle(),headerSize:"small",banner:this.renderBanner(),showBorder:!1},n.React$1.createElement(P.Tabs,{selectedTab:this.getCurrentTab(),onSelection:this.setSelectedTab},n.React$1.createElement(P.Tabs.Group,null,n.React$1.createElement(P.Tabs.Tab,{id:u.ManageAccessTabName.ManagePeopleTab},e),n.React$1.createElement(P.Tabs.Tab,{id:u.ManageAccessTabName.ManageLinksTab},t)),n.React$1.createElement(P.Tabs.Panel,{tabId:u.ManageAccessTabName.ManagePeopleTab},n.React$1.createElement("div",{style:{border:"1px solid var(--color__faint__border)",marginTop:"18px",height:"250px",paddingTop:this.isMemberListEmpty()?"0px":"13px",overflowY:"auto"}},this.renderMemberList())),n.React$1.createElement(P.Tabs.Panel,{tabId:u.ManageAccessTabName.ManageLinksTab},n.React$1.createElement("div",{style:{marginTop:"18px"}},n.React$1.createElement(Gn,{user:this.props.user,contentInfo:this.props.actionHandler.getContentInfo(),sharingInfo:this.props.actionHandler.getSharingInfo()},n.React$1.createElement(Wn,{actionHandler:this.props.actionHandler,onViewLinkSettingsClick:this.handleViewLinkSettingsButtonClick,onEditLinkSettingsClick:this.handleEditLinkSettingsButtonClick}))))))}getTitle(){const e={fileName:i.Emstring.em_snippet(this.props.fileName,i.SNIPPET_SIZES.SHARE_ME_MANAGE_ACCESS_FILE_FOLDER_TITLE)};return this.shouldRenderLinksInMemberList()?r.intl.formatMessage({id:"ptXJuT",defaultMessage:"Access to <s>{fileName}</s>"},{fileName:e.fileName,s:e=>n.React$1.createElement("span",null,e)}):r.intl.formatMessage({id:"IQ37US",defaultMessage:"Who can access <s>{fileName}</s>"},{fileName:e.fileName,s:e=>n.React$1.createElement("span",null,e)})}noPermissionsSectionProps(){return{isFolder:this.props.isFolder,isTeamSharedFolder:this.props.isTeamSharedFolder,members:this.props.membership,teamName:this.props.ownerTeamName}}renderBanner(){if(!this.isMemberListEmpty()){if(!this.props.canInviteMembers)return n.React$1.createElement(Tn,Object.assign({},this.noPermissionsSectionProps()));if(this.props.editLinkExists&&this.state.showSecurityBanner){let e;switch(this.state.securityBannerType){case js.RemoveAccess:e=Kn.removeBannerHeader;break;case js.DowngradeAccess:default:e=Kn.downgradeBannerHeader}return n.React$1.createElement(m.SharingModalDowngradeBanner,{header:r.intl.formatMessage(e),subheader:r.intl.formatMessage(Kn.downgradeBannerSubheader),outlineButtonLabel:r.intl.formatMessage(Kn.downgradeBannerGotIt),transparentButtonLabel:r.intl.formatMessage(Kn.downgradeBannerManageLinks),onClickOutlineButton:this.hideSecurityBanner,onClickTransparentButton:this.openLinkSettings})}}}}jn.displayName="MainSection",jn.contextType=os,i.requireCssWithComponent(jn,["/static/metaserver/static/css/sharing/share_modal_evolution-vflntdKys.css"]);class qn extends n.React$1.Component{componentDidMount(){const e=this.props.lmlExperimentVariant;if(e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON||e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.CONTROL){const e=parseInt(localStorage.getItem("manageAccessPageViewsCount")||"[]");e?2!=e&&localStorage.setItem("manageAccessPageViewsCount",(e+1).toString()):localStorage.setItem("manageAccessPageViewsCount",1..toString())}}componentWillUnmount(){const e=this.props.lmlExperimentVariant;2===parseInt(localStorage.getItem("manageAccessPageViewsCount")||"[]")&&(e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON&&g.trackUserLeapEvent(g.SharingUserLeapEvent.SHARE_LINK_MEMBER_LIST_ON,this.props.lmlSprigSurveyOrigin),e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.CONTROL&&g.trackUserLeapEvent(g.SharingUserLeapEvent.SHARE_LINK_MEMBER_LIST_CONTROL,this.props.lmlSprigSurveyOrigin))}render(){return n.React$1.createElement("div",{className:"share-modal-evolution__manage-access-page"},n.React$1.createElement(Rn,{onBackButtonClick:this.props.onBackButtonClick,onCloseButtonClick:this.props.onCloseButtonClick,onSettingsButtonClick:this.props.onSettingsButtonClick}),n.React$1.createElement(jn,{canInviteMembers:this.props.canInviteMembers,fileName:this.props.fileName,isFolder:this.props.isFolder,isTeamSharedFolder:this.props.isTeamSharedFolder,memberListProps:this.props.memberListProps,membership:this.props.membership,ownerTeamName:this.props.ownerTeamName,actionHandler:this.props.actionHandler,editLinkExists:this.props.editLinkExists,onLinkSettingsTextClick:this.props.onLinkSettingsTextClick,user:this.props.user,currentTab:this.props.currentTab}))}}qn.displayName="ManageAccessModal";const Yn=i.requireCssWithComponent(qn,["/static/metaserver/static/css/sharing/share_modal_evolution-vflntdKys.css"]);class Zn extends n.React$1.Component{constructor(){super(...arguments),this.handleSettingsButtonClick=e=>{e.preventDefault(),this.props.onSettingsButtonClick(e),this.context.logEvent(u.TiburonEventName.ClickSettingsGear,void 0,{screen:u.ScreenName.ShareScreen})}}render(){const e=this.getSubTitle();return n.React$1.createElement(m.SharingModalHeaderTitle,{closeButtonVisible:!0,icon:this.getIcon(),subTitle:e,onClickCloseButton:this.props.onCloseButtonClick,onClickSettingsButton:this.handleSettingsButtonClick,settingsButtonVisible:this.props.contentInfo.isFolder()||this.props.showPassFileSettings,title:this.getHeaderTitle()})}getHeaderTitle(){return i.Emstring.em_snippet(this.props.sharingInfo.name(),i.SNIPPET_SIZES.FILENAME)}getIcon(){const{contentInfo:e}=this.props;return n.React$1.createElement(vs,{alt:"",filename:this.props.sharingInfo.name(),isSharedFolder:e.isSharedFolder(),isFolder:e.isFolder(),isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isViewOnly:!this.props.canEdit,isConfidentialFolder:this.props.isConfidentialFolder,pathExists:e.pathExists()})}getNumberOfPeopleShared(){const{membership:e,linkMembers:t,guestMembers:s}=this.props,{total_unique_users:n}=this.props.sharingInfo.memberCounts();return(n||e.getTotalMemberCount([]))+t.length+s.length}canViewInheritedMembers(){return!this.props.contentInfo.isFile()||this.props.membership.hasInheritedUsers()}getFinalNumberShared(){const e=this.props.sharingInfo.memberCounts();return e&&e.exceeds_count?this.props.sharingInfo.memberNum():this.getNumberOfPeopleShared()}hasExistingLink(){return 0!=this.props.sharingInfo.sharedLinks().length}showOnlyYouCanAccess(){if(this.props.sharingInfo.sharingPrefs().exp_links_in_member_list==l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON&&this.hasExistingLink())return!1;const e=this.getFinalNumberShared();return this.canViewInheritedMembers()&&(0===e||1===e)}disableManageAccessLink(){return this.showOnlyYouCanAccess()}getHeaderSubtitleDescription(){return this.showOnlyYouCanAccess()?r.intl.formatMessage({id:"CQ2ZaT",defaultMessage:"Only you can access"}):r.intl.formatMessage({id:"Yxc2O3",defaultMessage:"Who can access"})}getSubTitle(){const e=this.getHeaderSubtitleDescription(),t=this.disableManageAccessLink();return n.React$1.createElement(i.Text,{color:"faint",size:"small"},t?n.React$1.createElement("span",null,e):n.React$1.createElement(i.Link,{href:"#",hasNoUnderline:!0,onClick:e=>{e.preventDefault(),this.props.onManageAccessClick()}},e))}}function Qn(e){const t=r.intl.formatMessage({id:"YNOPIK",defaultMessage:"To create the view link, add this folder to Dropbox"});return!1==!!e.contentMetadata.path_lower&&e.contentMetadata.access_type===i.ACCESS_LEVEL.WRITER&&e.contentMetadata.isFolder()?n.React$1.createElement(i.Text,{size:e.size,color:"disabled",isBold:!0},n.React$1.createElement(i.UIIcon,{src:pe.LinkLine,size:e.size,"aria-label":""}),r.intl.formatMessage({id:"m9qOdI",defaultMessage:"Create and copy link"}),n.React$1.createElement(m.HelpInfo,{id:"cannotCopyLinkInfo",text:t})):n.React$1.createElement(i.Text,{size:e.size,color:"disabled",isBold:!0},n.React$1.createElement(i.UIIcon,{src:pe.LinkLine,size:e.size,"aria-label":""}),r.intl.formatMessage({id:"t0Frp1",defaultMessage:"Copy link"}),n.React$1.createElement(m.HelpInfo,{id:"cannotCopyLinkInfo",text:r.intl.formatMessage({id:"CqPhXv",defaultMessage:"You can only email this link"})}))}Zn.displayName="HeaderSection",Zn.contextType=os;class Jn extends n.React$1.Component{constructor(e){super(e),this.handleCreateLinkClick=e=>{e.preventDefault(),this.setState({isCreatingLink:!0},(()=>{this.props.onCreateLinkClick().finally((()=>{this.setState({isCreatingLink:!1})}))}))},this.state={isCreatingLink:!1}}render(){return this.state.isCreatingLink?this.renderCreatingLinkLoading():this.renderCreateLink()}renderCreatingLinkLoading(){return n.React$1.createElement(me.SharingSpinner,{ariaValue:"Loading xsmall",message:r.intl.formatMessage({id:"g7It2O",defaultMessage:"Creating link..."}),textSize:this.props.size})}renderCreateLink(){const{canCreateLink:e}=this.props,t=e=>n.React$1.createElement(i.Link,{key:"toCreateALink",id:"create-link",href:"#",hasNoUnderline:!0,onClick:this.handleCreateLinkClick,"aria-label":r.intl.formatMessage({id:"lCKMha",defaultMessage:"Create link"}),style:{paddingRight:"0"}},e);return e?n.React$1.createElement(i.Text,{size:this.props.size,isBold:!0},n.React$1.createElement(i.UIIcon,{src:pe.LinkLine,size:this.props.size,"aria-label":""}),n.React$1.createElement("div",{style:{whiteSpace:"pre",display:"flex"}},r.intl.formatMessage({id:"DW0r0G",defaultMessage:"<link>Create</link> and copy link"},{link:t}))):n.React$1.createElement(Qn,{contentMetadata:this.props.contentMetadata,size:this.props.size})}}Jn.displayName="CreateLinkSection",Jn.contextType=os;class Xn extends n.React$1.Component{constructor(e){super(e),this.handleCreateLinkClick=()=>("V1"===ds(this.props.actionHandler)&&R.setIsEligibleForDocsendSplitShareItemInUserMetadata(this.props.user.id),this.props.actionHandler.createSharedLink(this.props.accessLevel,this.props.selectedAudience,l.LINK_CREATION_SURFACE.COPY_OR_CREATE_LINK_SECTION)),this.handleSettingsButtonClick=e=>{let t;e.preventDefault(),"editor"===this.props.accessLevel?(this.props.actionHandler.openSharingSettingsModal("edit_link_settings"),t=u.SettingsTabName.EditLinkSettingsTab):(this.props.actionHandler.openSharingSettingsModal("view_link_settings"),t=u.SettingsTabName.ViewLinkSettingsTab),this.context.logEvent(u.TiburonEventName.OpenLinkSettingsModal,this.props.sharedLink,{settings_tab:t})},this.state={createdLink:!1}}componentDidUpdate(e){!e.sharedLink&&this.props.sharedLink&&e.accessLevel===this.props.accessLevel&&(this.setState({createdLink:!0}),setTimeout((()=>{this.setState({createdLink:!1})}),5e3))}render(){return this.props.sharedLink?n.React$1.createElement(ms,{accessLevel:this.props.accessLevel,modalClose:this.props.modalClose,sharedLink:this.props.sharedLink,getEmailTokenCountFn:this.props.getEmailTokenCountFn,size:this.props.size,handleSettingsButtonClick:this.handleSettingsButtonClick,createdLink:this.state.createdLink,isFolder:this.props.isFolder,user:this.props.user,actionHandler:this.props.actionHandler}):n.React$1.createElement(Jn,{onCreateLinkClick:this.handleCreateLinkClick,canCreateLink:this.props.canCreateLink,size:this.props.size,contentMetadata:this.props.contentMetadata})}}Xn.defaultProps={size:"small"},Xn.contextType=os,Xn.displayName="CopyOrCreateLinkSection";class ei extends n.react.exports.Component{constructor(e){super(e),this.cache={},this.getContacts=()=>this.state.contacts,this.finishLogging=()=>{},this.onInviteTargetsChange=e=>{this.cache=e.reduce(((e,t)=>{const s=m.getUniqueId(t),n=this.cache[s]||xn(t);return Object.assign(Object.assign({},e),{[s]:n})}),{});const t=e.map((e=>this.cache[m.getUniqueId(e)]||xn(e)));this.setState(Object.assign(Object.assign({},this.state),{contacts:t,inviteTargets:e})),this.props.onTypeaheadTokensChange(t),this.props.actionHandler.recipientsChange(t,"")},this.state={objectMetadata:Bn(this.props.actionHandler.getSharingInfo()),user:Un(this.props.actionHandler.getSharingInfo()),inviteTargets:this.props.initialTypeaheadTokens.map(Nn),contacts:this.props.initialTypeaheadTokens,isImportContactsExpanded:!1,isImportContactsLoading:!1},this.props.initialTypeaheadTokens&&this.props.initialTypeaheadTokens.length>0&&this.props.actionHandler.recipientsChange(this.props.initialTypeaheadTokens,"")}componentDidUpdate(e,t){e.typeaheadTokens!==this.props.typeaheadTokens&&this.state.contacts!==this.props.typeaheadTokens&&this.onInviteTargetsChange(this.props.typeaheadTokens.map(Nn))}render(){const e=On(this.props.accessLevel),t=((e,t)=>{const s=t.recipientAccess(),n=t.recipientValidation()[s]||{},i=e.map(xn).map((e=>e.getKey())),a=e.map(m.getUniqueId),r=a.reduce(((e,t,s)=>Object.assign({[t]:n[i[s]]},e)),{});return a.reduce(((e,t)=>{const s=r[t];if(!s)return e;const n={member:{".tag":"other"},result:Pn(s),target_invite_eligibility:{".tag":"other"}};return Object.assign(Object.assign({},e),{[t]:n})}),{})})(this.state.inviteTargets,this.props.actionHandler.getSharingInfo());return n.react.exports.createElement(m.TargetsTokenizer,{accessLevel:e,user:this.state.user,inviteTargets:this.state.inviteTargets,inviteTargetValidation:t,objectMetadata:this.state.objectMetadata,onInviteTargetsChange:this.onInviteTargetsChange})}}ei.displayName="SharingSdkTokenizer";const ti=new WeakMap,si=(e,t)=>{const s=(e=>{const t=ti.get(e);if(t)return t;{const t=(e=>{const t=[],s=(e,n=[])=>{if(0===e.length)t.push(n);else for(let t=0;t<e.length;t++){let i=e.slice(),a=i.splice(t,1);s(i.slice(),n.concat(a))}};return s(e),t})(e);return ti.set(e,t),t}})(t);return s[Math.floor(e/16)%s.length]},ni={buttonBorderWithLeftAlignment:{display:"flex",border:"1px solid #8C8279",borderBottom:"none"},fullWidthButton:{display:"flex",flexDirection:"column",marginBottom:"0px"}},ii=({initialTasks:e,onSharingTasksUpdated:t,userId:s})=>{const a=i.useIntl(),r=m.useLogger(),o=n.react.exports.useMemo((()=>si(s,(e=>[{id:"save_copy",title:e.formatMessage({id:"TOs55N",defaultMessage:"Save their own copy of this file"})},{id:"share_file",title:e.formatMessage({id:"siO/O2",defaultMessage:"Share with others to review"})},{id:"make_edits",title:e.formatMessage({id:"O9ZeeZ",defaultMessage:"Make edits to the file"})},{id:"leave_comment",title:e.formatMessage({id:"+UELQ9",defaultMessage:"Review and leave comments"})}])(a))),[a,s]),[l,c]=n.react.exports.useState(o.filter((t=>e.some((e=>e===t.id))))),[d,h]=n.react.exports.useState(!1),[p,u]=n.react.exports.useState(!1),g=n.react.exports.useRef(null),f=n.react.exports.useRef(null),_=l.length===o.length,E={addAllTasksButton:a.formatMessage({id:"clJoNf",defaultMessage:"Add all"}),removeAllTasksButton:a.formatMessage({id:"vh8X59",defaultMessage:"Remove all"}),addTaskButton:a.formatMessage({id:"YEtX8l",defaultMessage:"Add a request"}),taskMenuLabel:a.formatMessage({id:"atQ7Z3",defaultMessage:"Ask them to:"})},S=n.react.exports.useCallback((e=>{const s=l.includes(e),n=s?l.filter((t=>t!==e)):l.concat(e);c(n),t(n.map((e=>e.id))),r("SHARE_MODAL_TASK_MENU__RRC_SENDER__TASK_MENU_ITEM_CLICK",{task:e.id,state:s?"OFF":"ON",position:o.indexOf(e)})}),[c,t,l,r,o]),M=n.react.exports.useCallback((()=>{_?(c([]),t([])):(c(o),t(o.map((e=>e.id)))),r("SHARE_MODAL_TASK_MENU__RRC_SENDER__TOGGLE_ALL_CLICK",{state:_?"OFF":"ON"})}),[c,t,o,_,r]),k=n.react.exports.useCallback((e=>{r("SHARE_MODAL_TASK_MENU__RRC_SENDER__TASK_MENU_CLICK",{state:e.isOpen?"ON":"OFF",tasks:o.map((e=>e.id)).join()}),u(e.isOpen)}),[r]);return n.react.exports.useEffect((()=>{const e=e=>{"Escape"!==e.key&&"Tab"!==e.key||!f.current||(e.stopPropagation(),f.current({autoFocus:!0,ref:g}))};return p&&document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}}),[p]),n.react.exports.createElement("div",{style:ni.fullWidthButton},n.react.exports.createElement(i.Menu.Wrapper,{closeOnSelection:!1,onToggle:k,onSelection:S,isBlock:!0,matchContainingWidth:!0},(({getTriggerProps:e,getContentProps:t,closeMenu:s})=>(f.current=s,n.react.exports.createElement(n.react.exports.Fragment,null,n.react.exports.createElement(i.Button,Object.assign({},e(),{variant:"outline",ref:g,size:"large",fullWidth:!0,onFocus:()=>h(!0),onBlur:()=>h(!1),style:Object.assign(Object.assign({},ni.buttonBorderWithLeftAlignment),{boxShadow:d?"var(--boxshadow__focusring)":"none"}),withIconLeft:n.react.exports.createElement(i.UIIcon,{src:i.AddCircleLine,role:"presentation"})}),n.react.exports.createElement(i.Text,null,n.react.exports.createElement("u",null,E.addTaskButton)),n.react.exports.createElement(i.Text,null," ("),n.react.exports.createElement(i.Text,{color:"faint"},a.formatMessage({id:"OpRt+g",defaultMessage:"{numRequests, number} added"},{numRequests:l.length})),n.react.exports.createElement(i.Text,null,")")),n.react.exports.createElement(i.Menu.Content,Object.assign({},t(),{triggerRef:g,positioningStrategy:"fixed",auto:!0}),n.react.exports.createElement(i.Menu.Segment,{withLabel:E.taskMenuLabel},o.map((e=>n.react.exports.createElement(i.Menu.ActionItem,{key:e.id,value:e,role:"menuitemcheckbox","aria-checked":l.includes(e),withTitle:e.title,withLeftAccessory:n.react.exports.createElement(B.Checkbox,{checked:l.includes(e),readOnly:!0,tabIndex:-1})})))),n.react.exports.createElement(i.Menu.Segment,null,n.react.exports.createElement(i.Menu.Row,null,n.react.exports.createElement(i.Button,{variant:"transparent",onClick:M},_?E.removeAllTasksButton:E.addAllTasksButton)))))))))};ii.displayName="TaskMenu";const ai=({actionHandler:e,userId:t})=>{const s=n.react.exports.useMemo((()=>{const t=e.getSharingInfo();return t?t.getSharingTasks():[]}),[e]),a=n.react.exports.useCallback((()=>{const t=e.getSharingInfo(),s=t&&t.permissionsObj().canInviteEditor(),n=t&&t.recipientAccess()!==i.ACCESS_LEVEL.WRITER;s&&n&&e.changeRecipientAccess(i.ACCESS_LEVEL.WRITER)}),[e]),r=n.react.exports.useCallback((t=>{const s=e.getSharingInfo();!(s&&s.getSharingTasks().includes("make_edits"))&&t.includes("make_edits")&&a(),e.updateSharingTasks(t)}),[e,a]);return n.react.exports.createElement(ii,{initialTasks:s,onSharingTasksUpdated:r,userId:t})};ai.displayName="SharingSdkTaskMenu";function ri(e={}){return new Promise(((t,s)=>{!function(e){const t="/groups_ajax/"+e.method,s=e.reload_contacts||!1,n=i.Viewer.get_viewer().work_user,a=function(t){const a=JSON.parse(t);if(a.ok&&(e.success(a.data),oi()),s){i.getSearchConfigForUser(n).localCacheStore.getOrCreateForUser(n).load_contacts(!0)}},r=function(t){const s=t.responseText;e.error&&(e.error(s.slice(4)),oi())};i.WebRequest({url:t,type:"post",data:e.data,subject_user:n,success:a,error:r})}({method:"get_group_info",data:e,success:e=>{t(e)},error:e=>{s(e)}})}))}const oi=()=>{const e=document.querySelector(".error_msg");e&&(e.style.display="none")};class li{static initClass(){this.MAX_GROUP_NAME_LEN=100,this.MAX_ROWS_PER_PAGE=15,this.MAX_ROWS_TO_FETCH_FROM_SERVER=50}static isGroupDeleted(e){let t;return t=-1!==e.responseText.indexOf("group has been deleted"),t}static redirectToGroupsPage(e){let t;return t=e?"/":"groups",i.set_hash(t)}}li.initClass();i.injectInternalStyle("metaserver/static/js/business_space/browse/components/education_tag/education_tag.module.out.css",(e=>"._tag-section-tooltip_mo40d_1{color:var(--color__faint__text);display:block}._section-group-education-tag_mo40d_6{align-items:center;display:flex}"));const ci="_tag-section-tooltip_mo40d_1",di="_section-group-education-tag_mo40d_6",hi=()=>{const[e,t]=n.react.exports.useState(!1),s=n.react.exports.useRef(null);return n.react.exports.createElement(i.Text,{variant:"paragraph",size:"small",color:"faint",className:di},r.intl.formatMessage({id:"kmebBo",defaultMessage:"What are groups?"}),n.react.exports.createElement(i.IconButton,{id:"toggletip-button",size:"standard",variant:"transparent",ref:s,onClick:()=>t(!e)},n.react.exports.createElement(i.UIIcon,{className:ci,src:i.HelpLine,size:"standard","aria-label":"What are groups?"})),n.react.exports.createElement(i.Tooltip.Control,{open:e,triggerRef:s,auto:!0,placement:"top-end"},n.react.exports.createElement(i.Text,{tagName:"p",color:"standard",inverse:!0},r.intl.formatMessage({id:"gw/WIP",defaultMessage:"Groups allow you to quickly and easily share a folder or file to all group members. "}),n.react.exports.createElement("a",{href:"https://help.dropbox.com/teams-admins/team-member/groups",target:"_blank",rel:"noopener"},r.intl.formatMessage({id:"6gh7Br",defaultMessage:"Learn More"})))))};hi.displayName="EducationTag";i.injectInternalStyle("metaserver/static/js/business_space/browse/group_suggestion/group_suggestion_section.module.out.css",(e=>"._section-group-suggestion_1rfvu_1{display:flex;flex-direction:row;justify-content:space-between}._section-manage-your-groups-link_1rfvu_7{display:flex}"));const pi="_section-group-suggestion_1rfvu_1",mi="_section-manage-your-groups-link_1rfvu_7",ui=(e,t)=>e.length>1&&e.every((e=>!e.group_id&&(e.on_team||e.dbx_team_id&&e.dbx_team_id===t.team_dbtid))),gi=()=>{const e=document.querySelector(".server-error");e&&(e.style.display="none")},fi=e=>{const t=t=>{const s=e.user.is_team_admin?"/team/admin/groups?role=work#/":"/team#groups/";return()=>{i.open_tab(s+t)}},[a,o]=n.react.exports.useState(!1),[l,c]=n.react.exports.useState([]),[d,h]=n.react.exports.useState([]),[p,m]=n.react.exports.useState(!1),[u,g]=n.react.exports.useState(!1),f=e=>{const t=e.filter((e=>!!e.group_id));h(t)},E=t=>{o(t),e.setIsGroupCreationInProgress(t)};n.react.exports.useEffect((()=>{if(e.expBsxOrganizeAroundPeople){new i.ContactsDataSourceV2(e.user,void 0,!1).getAll(f)}}),[e.user]),n.react.exports.useEffect((()=>{if(c([]),g(!1),ui(e.contacts,e.user)&&e.expBsxOrganizeAroundPeople){const t=[],n=d.filter((t=>t.group_size===e.contacts.length+1&&!!t.group_id)).map((e=>{return n={group_id:e.group_id},s.__awaiter(void 0,void 0,void 0,(function*(){try{const a=yield ri(n);return S(a)&&(t.push(e),c(t),i.logEvent({class:"organize_around_people",action:"shown",object:"match_group_suggestion",properties:s})),a}catch(t){if(console.error(`Error on geting group info for group ${e.group_id}.`,t),gi(),"Actor must be in the group"===t)return null;throw _.reportException({err:t,tags:["get_group_info_failed"],severity:"non-critical"}),t}var s}));var n})),a=e=>{var t;M()&&!e.length&&i.logEvent({class:"organize_around_people",action:"shown",object:"create_group_suggestion",properties:t})};n.length?(m(!0),Promise.all(n).then((e=>{a(t)})).catch((e=>{g(!0)})).finally((()=>{m(!1),gi()}))):a(t)}}),[e.contacts,d]);const S=t=>{const s=e.contacts.map((e=>e.email));s.push(e.user.email);const n=new Set(t.users.map((e=>e.email)));return s.every((e=>n.has(e)))},M=()=>{var t;return e.user.is_team_admin||"admins_and_members"===(null===(t=e.teamPolicy)||void 0===t?void 0:t.group_creation_policy)};return p?n.React$1.createElement(i.ProgressBar,{in:!0,isIndeterminate:!0}):n.React$1.createElement(n.React$1.Fragment,null,e.expBsxOrganizeAroundPeople&&ui(e.contacts,e.user)&&0===l.length&&M()&&!u&&n.React$1.createElement("div",{className:pi},n.React$1.createElement(i.Button,{variant:"opacity",onClick:()=>((s,n)=>{let a="";const o=n.map((e=>e.name.split(" ")[0])).concat(s.fname);for(let e=0;e<o.length;e++){const t=o[e];if(0===e)a+=t;else{if(!((a+", "+t).length<=li.MAX_GROUP_NAME_LEN-"...".length)){a+="...";break}a+=", "+t}}const l=n.map((e=>({email:e.email,is_owner:!1})));var c;E(!0),i.Snackbar.sync(r.intl.formatMessage({id:"Ko1UZV",defaultMessage:"Creating group..."}),!1,"group-suggestion"),i.logEvent({class:"organize_around_people",action:"click",object:"create_group_suggestion",properties:c}),i.WebRequest$1({url:"/groups_ajax/make_new_group_with_users",data:{name:a,members:JSON.stringify([{name:s.display_name,email:s.email,is_owner:!0},...l]),is_admin_managed:!1},subject_user:s,success:(s,o)=>{const l=JSON.parse(o).data.id;e.updateGroupSelection(new i.Contact({type:i.ContactTypes.NEW_STYLE_GROUP,name:a,group_id:l,group_size:n.length+1,members:a,on_team:!0})),i.Snackbar.complete(r.intl.formatMessage({id:"2o8/E+",defaultMessage:"Group created and saved."}),"group-suggestion",{actionButtonText:r.intl.formatMessage({id:"H3Nuk5",defaultMessage:"Manage group"}),onActionClick:t(l),closeButtonText:r.intl.formatMessage({id:"Js0Z4W",defaultMessage:"Close"})}),E(!1)},error:()=>{i.Snackbar.fail(r.intl.formatMessage({id:"Pn6eNL",defaultMessage:"Error creating group."}),"group-suggestion"),E(!1)},complete:()=>{E(!1)}})})(e.user,e.contacts),isLoading:a},r.intl.formatMessage({id:"tyM1vU",defaultMessage:"Save as group"})),n.React$1.createElement(hi,null)),e.expBsxOrganizeAroundPeople&&l.length>0&&n.React$1.createElement(n.React$1.Fragment,null,l.map((t=>n.React$1.createElement(i.ChoiceChip,{onClick:()=>(t=>{var s;i.logEvent({class:"organize_around_people",action:"click",object:"match_group_suggestion",properties:s}),e.updateGroupSelection(t)})(t)},t.name)))),e.expBsxOrganizeAroundPeople&&e.contacts.some((e=>e.group_id))&&n.React$1.createElement("div",{className:mi},n.React$1.createElement(i.Text,{size:"standard"},n.React$1.createElement(i.Link,{href:"#",onClick:()=>{e.user.is_team_admin?i.open_tab("/team/admin/groups?role=work"):i.open_tab("/team#groups")},hasNoUnderline:!0},r.intl.formatMessage({id:"EMZfdS",defaultMessage:"Manage your groups"})))))},_i="share-modal-evolution-contacts-field";class Ei extends n.React$1.Component{constructor(e){super(e),this.updateGroupSelection=e=>{this.setState({typeaheadTokens:[e]})},this.getIsSharingSdkTokenizerEnabled=()=>{const e=this.props.actionHandler.getSharingInfo();return!(!e||!e.sharingPrefs)&&"ON"===e.sharingPrefs().sharing_sdk_tokenizer_variant},this.getIsExpBsxOrganizeAroundPeopleEnabled=()=>{const e=this.props.actionHandler.getSharingInfo();return!!e&&e.isExpBsxOrganizeAroundPeopleEnabled()},this.setIsGroupCreationInProgress=e=>{this.setState({isGroupCreationInProgress:e})},this.finishLogging=e=>this.shareContactsTokenizerRef.finishLogging(e),this.onTypeaheadTokensChange=e=>{this.setState({typeaheadTokens:e}),this.props.emailCountChangeCallback(e.length)},this.setShareContactsTokenizerRef=e=>{null!==e&&(this.shareContactsTokenizerRef=e)},this.filterContacts=e=>this.props.isTeamSharedFolder?!!e.group_id:e.email!==this.props.user.email,this.includeGroupTokens=()=>this.state.typeaheadTokens.some((({group_id:e})=>!!e)),this.shouldDisableApprovalCheckbox=()=>this.includeGroupTokens(),this.shouldCreateApproval=()=>{const{showApproval:e,sendApproval:t}=this.props;return e&&!this.shouldDisableApprovalCheckbox()&&t},this.renderApprovalTypeRadioButtons=()=>{const{actionHandler:e,showApproval:t,needsAllApprovers:s,sendApproval:i}=this.props,{typeaheadTokens:a}=this.state;return!t||!i||this.shouldDisableApprovalCheckbox()||a.length<2?null:n.React$1.createElement(ue.ApprovalTypeRadioButtonGroup,{needsAllApprovers:s,onChange:e.changeNeedsAllApprovers})},this.renderApprovalCheckbox=()=>{const{actionHandler:e,showApproval:t,sendApproval:s,recipientMessage:i}=this.props;if(!t||0===this.state.typeaheadTokens.length&&0===i.length)return null;const a=this.shouldDisableApprovalCheckbox();return n.React$1.createElement(ue.ApprovalCheckboxInShare,{disabled:a,checked:!a&&s,onChange:e.toggleSendApproval,onMount:e.logShownApprovalForm})},this.footerContent=()=>{let e=this.props.accessLevel,t=this.props.sharedLink,s=this.props.canCreateLink;return n.React$1.createElement(n.React$1.Fragment,null,this.shouldRenderPostNoteAsComment()&&this.renderPostNoteAsComment(),n.React$1.createElement(Xn,{size:"standard",accessLevel:e,actionHandler:this.props.actionHandler,modalClose:this.props.modalClose,sharedLink:t,getEmailTokenCountFn:this.props.getEmailTokenCountFn,canCreateLink:s,isFolder:this.props.isFolder,contentMetadata:this.props.contentMetadata,user:this.props.user}))},this.onEmailLinkButtonClick=()=>(this.logClickShareButtonLinkSettingsStatus(),this.shouldCreateApproval()?this.props.actionHandler.createApproval(this):this.props.actionHandler.sendShare(this)),this.onCheckboxToggled=()=>{this.props.actionHandler.changeCreateCommentCheckbox(!this.props.isPostNoteAsCommentChecked)},this.state={typeaheadTokens:this.props.initialTypeaheadTokens,isGroupCreationInProgress:!1}}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){this.isValidReceiverRedCarpetExposure()&&this.props.actionHandler.logIfHaventBefore(u.TiburonEventName.RRCSenderShareModalView,{variant:cs(this.props.actionHandler),file_ext:this.getWhitelistedExtension()})}))}getContacts(){return this.shareContactsTokenizerRef.getContacts()}getWhitelistedExtension(){const e=this.props.actionHandler.getSharingInfo();return e?l.getWhitelistedExtension(e.name()):""}isValidFileForReceiverRedCarpet(){return!this.props.isFolder&&!this.props.contentMetadata.name.endsWith(".paper")}isValidReceiverRedCarpetExposure(){return this.isValidFileForReceiverRedCarpet()&&"OFF"!==cs(this.props.actionHandler)}hasGroupInRecipientTokens(){return this.state.typeaheadTokens.some((e=>e.type===i.ContactTypes.NEW_STYLE_GROUP))}shouldRenderEmailShareTaskMenu(){const e="V1"===cs(this.props.actionHandler),t=this.isValidFileForReceiverRedCarpet();return e&&t&&this.shouldRenderMessageField()&&!this.hasGroupInRecipientTokens()}renderEmailShareTaskMenu(){return n.React$1.createElement(Gn,{user:this.props.user,contentInfo:this.props.actionHandler.getContentInfo(),sharingInfo:this.props.actionHandler.getSharingInfo()},n.React$1.createElement(ai,{actionHandler:this.props.actionHandler,userId:this.props.user.id}))}render(){const{contactsError:e,disabledContactsInput:t,creatingApprovalRequest:s}=this.props,a=i.classnames(["email-share",t?`${_i}__typeahead--disabled`:`${_i}__typeahead`,e&&e.level===g.ContactsErrorLevel.Error?"contacts-input-error":void 0]);return n.React$1.createElement(m.ActionSection,{footerContent:this.footerContent(),footerActions:n.React$1.createElement("span",{className:"scl-sharing-modal-footer"},n.React$1.createElement(i.Button,{isLoading:s,disabled:this.shouldDisableShareButton(),onClick:this.onEmailLinkButtonClick,variant:"primary",className:"email-link-button","data-uxa-log":"sharing-modal-footer-button-send-email"},this.getShareButtonText())),isHeaderBold:!1},this.renderContactTokenizer(a),this.renderApprovalTypeRadioButtons(),this.shouldRenderEmailShareTaskMenu()&&this.renderEmailShareTaskMenu(),this.shouldRenderMessageField()&&this.renderMessageField(),this.renderApprovalCheckbox())}shouldRenderMessageField(){return this.state.typeaheadTokens.length>0||this.props.recipientMessage.length>0}shouldDisableShareButton(){return this.props.isEmailSending||this.props.isTokenizerEmpty||this.props.contactsError&&this.props.contactsError.level===g.ContactsErrorLevel.Error||this.state.isGroupCreationInProgress}shouldRenderPostNoteAsComment(){return this.props.showPostNoteAsComment&&this.props.recipientMessage.length>0&&this.shouldRenderMessageField()}getTypeaheadPlaceholder(){return this.props.isTeamSharedFolder?r.intl.formatMessage({id:"VMGE6I",defaultMessage:"Group names"}):this.props.user.is_team?r.intl.formatMessage({id:"+nKRfb",defaultMessage:"Add an email, name, or group"}):r.intl.formatMessage({id:"bdV6O3",defaultMessage:"Add an email or name"})}getShareButtonText(){const e=r.intl.formatMessage({id:"vJGcTi",defaultMessage:"Share file"}),t=r.intl.formatMessage({id:"cHEg6H",defaultMessage:"Share folder"}),s=r.intl.formatMessage({id:"Qd1iC2",defaultMessage:"Sharing..."}),n=this.props.isFolder?t:e;return this.props.isEmailSending?s:n}renderContactTokenizer(e){const t=this.getIsSharingSdkTokenizerEnabled()?n.React$1.createElement(Gn,{user:this.props.user,contentInfo:this.props.actionHandler.getContentInfo(),sharingInfo:this.props.actionHandler.getSharingInfo()},n.React$1.createElement(n.React$1.Fragment,null,n.React$1.createElement(ei,{accessLevel:this.props.accessLevel,className:e,ref:this.setShareContactsTokenizerRef,actionHandler:this.props.actionHandler,disabledInput:this.props.disabledContactsInput,focusOnMount:!this.props.disabledContactsInput,initialTypeaheadTokens:this.props.initialTypeaheadTokens,typeaheadTokens:this.state.typeaheadTokens,onTypeaheadTokensChange:this.onTypeaheadTokensChange,shouldLogContactSearch:!0,typeaheadPlaceholder:this.getTypeaheadPlaceholder(),user:this.props.user,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.teamGroupInfo,filterContacts:this.filterContacts}),n.React$1.createElement(fi,{contacts:this.state.typeaheadTokens,user:this.props.user,expBsxOrganizeAroundPeople:this.getIsExpBsxOrganizeAroundPeopleEnabled(),updateGroupSelection:this.updateGroupSelection,teamPolicy:this.props.teamPolicy,setIsGroupCreationInProgress:this.setIsGroupCreationInProgress}))):n.React$1.createElement(n.React$1.Fragment,null,n.React$1.createElement(Mn,{className:e,ref:this.setShareContactsTokenizerRef,actionHandler:this.props.actionHandler,disabledInput:this.props.disabledContactsInput,focusOnMount:!this.props.disabledContactsInput,initialTypeaheadTokens:this.props.initialTypeaheadTokens,typeaheadTokens:this.state.typeaheadTokens,onTypeaheadTokensChange:this.onTypeaheadTokensChange,shouldLogContactSearch:!0,typeaheadPlaceholder:this.getTypeaheadPlaceholder(),user:this.props.user,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.teamGroupInfo,filterContacts:this.filterContacts}),n.React$1.createElement(fi,{contacts:this.state.typeaheadTokens,user:this.props.user,expBsxOrganizeAroundPeople:this.getIsExpBsxOrganizeAroundPeopleEnabled(),updateGroupSelection:this.updateGroupSelection,teamPolicy:this.props.teamPolicy,setIsGroupCreationInProgress:this.setIsGroupCreationInProgress}));return this.props.disabledContactsInput?n.React$1.createElement(i.Tooltip,{id:"tooltip-button",title:r.intl.formatMessage({id:"0S6iYY",defaultMessage:"This can only be shared with the link"})},n.React$1.createElement("div",{id:"contact_tokenizer_with_tooltip"},t)):t}renderMessageField(){return this.isValidReceiverRedCarpetExposure()&&this.props.actionHandler.logIfHaventBefore(u.TiburonEventName.RRCSenderNoteView,{variant:cs(this.props.actionHandler),file_ext:this.getWhitelistedExtension()}),n.React$1.createElement("div",{className:"share-modal-evolution-message-field"},n.React$1.createElement(i.TextArea,{placeholder:r.intl.formatMessage({id:"30bVmM",defaultMessage:"Add a note"}),"aria-label":r.intl.formatMessage({id:"30bVmM",defaultMessage:"Add a note"}),onChange:this.props.handleMessageChanged,value:this.props.recipientMessage}))}renderPostNoteAsComment(){const e=r.intl.formatMessage({id:"Jfn0Wa",defaultMessage:"Post this note as a comment"});return n.React$1.createElement(m.CheckboxWithLabel,{onCheckboxToggled:this.onCheckboxToggled,isChecked:this.props.isPostNoteAsCommentChecked,label:e,isCheckboxDisabled:""===this.props.recipientMessage,fontSize:"small"})}logClickShareButtonLinkSettingsStatus(){let e=!1,t=!1,s=!1;if(this.props.sharedLink){const n=O.getAudienceForLink(this.props.sharedLink.link_permissions);e=this.props.sharedLink.link_permissions.require_password||"password"===n,t=!!this.props.sharedLink.expires,s=!this.props.sharedLink.link_permissions.allow_download}this.context.logEvent(u.TiburonEventName.ClickShareButtonLinkSettingsStatus,this.props.sharedLink,{password:e,expiration:t,disable_download:s})}}Ei.contextType=os,Ei.displayName="EmailShare";class Si extends n.React$1.Component{constructor(e){super(e),this.state={numEmailTokens:this.props.initialTypeaheadTokens.length}}render(){return n.React$1.createElement(Ei,{actionHandler:this.props.actionHandler,contactsError:this.props.contactsError,isEmailSending:this.props.isEmailSending,disabledContactsInput:!this.props.canInviteByEmail,handleMessageChanged:this.props.handleMessageChanged,modalClose:this.props.modalClose,recipientMessage:this.props.recipientMessage,sharedLink:this.props.sharedLink,showPostNoteAsComment:this.props.showPostNoteAsComment,isFolder:this.props.isFolder,isPostNoteAsCommentChecked:this.props.isPostNoteAsCommentChecked,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,initialTypeaheadTokens:this.props.initialTypeaheadTokens,user:this.props.user,emailCountChangeCallback:this.updateEmailTokenCount.bind(this),accessLevel:this.props.accessLevel,getEmailTokenCountFn:this.getEmailTokenCount.bind(this),canCreateLink:this.props.canCreateLink,contentMetadata:this.props.contentMetadata,canCreateViewLinkForFolder:this.props.canCreateViewLinkForFolder,viewLinkForFolder:this.props.viewLinkForFolder,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,teamPolicy:this.props.teamPolicy})}updateEmailTokenCount(e){this.setState({numEmailTokens:e})}getEmailTokenCount(){return this.state.numEmailTokens}}Si.displayName="ShareLinkSection",Si.contextType=os;class Mi extends n.React$1.Component{constructor(e){super(e)}render(){return n.React$1.createElement(Si,{key:"shareLinkSection",accessLevel:this.props.accessLevel,actionHandler:this.props.actionHandler,canCreateLink:this.props.canCreateLink,canInviteByEmail:this.props.canInviteByEmail,contactsError:this.props.contactsError,isEmailSending:this.props.isEmailSending,handleMessageChanged:this.props.handleMessageChanged,modalClose:this.props.modalClose,recipientMessage:this.props.recipientMessage,sharedLink:this.props.sharedLink,isPostNoteAsCommentChecked:this.props.isPostNoteAsCommentChecked,isFolder:this.props.isFolder,showPostNoteAsComment:this.props.showPostNoteAsComment,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,initialTypeaheadTokens:this.props.initialTypeaheadTokens,user:this.props.user,contentMetadata:this.props.contentMetadata,canCreateViewLinkForFolder:this.props.canCreateViewLinkForFolder,viewLinkForFolder:this.props.viewLinkForFolder,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,teamPolicy:this.props.teamPolicy})}}Mi.displayName="LinkSection",Mi.contextType=os;class ki extends n.React$1.Component{render(){return n.React$1.createElement(m.Banner,{variant:"transparent-left"},n.React$1.createElement(i.Text,null,this.getNoPermissionsText()))}getNoPermissionsText(){return"editor"===this.props.accessLevel?this.props.isFolder?r.intl.formatMessage({id:"dooCWY",defaultMessage:"You can only share a link for viewing for this folder."}):r.intl.formatMessage({id:"XbAqHv",defaultMessage:"You can only share a link for viewing for this type of file."}):r.intl.formatMessage({id:"X+IYXP",defaultMessage:"This link type isn’t supported."})}}ki.displayName="NoPermissionsBanner";const bi=r.intl.formatMessage({id:"jAzCAz",defaultMessage:"can edit"}),vi=r.intl.formatMessage({id:"GKgRRt",defaultMessage:"can edit"}),Ci=r.intl.formatMessage({id:"wZejJ8",defaultMessage:"can view"}),yi=r.intl.formatMessage({id:"eCFw0p",defaultMessage:"can view"});function wi(e,t){return"public"===e?"editor"===t?bi:Ci:"editor"===t?vi:yi}function Ii(e,t){return"team_only"!==e&&"default_team_only"!==e||t&&"public"!==t?"default_no_one"===e?"no_one":null!=t?t:"public":"team"}function Ti(e,t,s,n,i,a,r){return t||(s?O.getAudienceForLink(s.link_permissions):e?function(e,t,s,n){if(t&&"members"===t.shared_link_policy)return"no_one";if(e){const t=e.shared_folder_link_restriction_policy,i=e.shared_link_create_policy;if(n)return"members"===t?"no_one":Ii(i,s);if("members"===t)return"no_one";if("team_only"===i||"default_team_only"===i)return"team";if("default_no_one"===i)return"no_one"}return s||"public"}(n,i,a,r):"no_one")}const Ai="share-modal-evolution-access-level-dropdown";class Li extends n.React$1.Component{constructor(){super(...arguments),this.renderDropdownOptions=e=>e.map((e=>n.React$1.createElement(i.Menu.SelectItem,{key:e.label,value:e.link_access_level,selected:this.props.selectedAccessLevel===e.link_access_level,disabled:!e.allowed},wi(this.props.selectedAudience,e.link_access_level)))),this.handleSelectedAccessLevelChange=e=>{this.props.selectedAccessLevel!==e&&this.props.onSelectedAccessLevelChange(e)}}render(){const e=this.props.linkAccessLevelOptions,t=1===e.length?" ":": ",s=i.classnames([`${Ai}`,e.length>1?`${Ai}__with-menu`:void 0]);return n.React$1.createElement("div",{className:s},n.React$1.createElement(i.Text,{className:`${Ai}__audience-text`},this.getAudienceText(),t),1===e.length?this.getCurrentAccessLevelText():this.renderAccessMenu(e))}getAudienceText(){const{contentMetadata:e,selectedAudience:t}=this.props;return function(e,t){switch(e){case"public":return r.intl.formatMessage({id:"vAFlk4",defaultMessage:"Anyone with this link"});case"team":return t?r.intl.formatMessage({id:"tOfnIZ",defaultMessage:"{team_name} members with this link"},{team_name:i.Emstring.em_snippet(t.name,i.SNIPPET_SIZES.COMPANY_NAME,1)}):r.intl.formatMessage({id:"wrE9Wi",defaultMessage:"Team Members with this link"});case"password":return r.intl.formatMessage({id:"QI5Jkq",defaultMessage:"People with the password for this link"});case"no_one":return r.intl.formatMessage({id:"SnIjdP",defaultMessage:"Only people invited"})}}(t,e.owner_team)}getCurrentAccessLevelText(){return n.React$1.createElement(i.Text,{className:`${Ai}__audience-text`,isBold:!0},wi(this.props.selectedAudience,this.props.selectedAccessLevel))}renderAccessMenu(e){return n.React$1.createElement(i.Menu.Wrapper,{onSelection:this.handleSelectedAccessLevelChange,isPortaled:!1,className:`${Ai}__unportaled-menu`},(({getContentProps:t,getTriggerProps:s})=>n.React$1.createElement(n.React$1.Fragment,null,n.React$1.createElement(i.Button,Object.assign({},s(),{variant:"transparent",withDropdownIcon:!0}),wi(this.props.selectedAudience,this.props.selectedAccessLevel)),n.React$1.createElement(i.Menu.Content,Object.assign({},t(),{placement:"bottom-end"}),n.React$1.createElement(i.Menu.Segment,null,this.renderDropdownOptions(e))))))}}Li.displayName="AccessLevelDropdown";class Ri extends n.React$1.Component{constructor(){super(...arguments),this.handleSettingsButtonClick=e=>{let t;e.preventDefault(),"editor"===this.props.selectedAccessLevel?(this.props.openSharingSettingsModal("edit_link_settings"),t=u.SettingsTabName.EditLinkSettingsTab):(this.props.openSharingSettingsModal("view_link_settings"),t=u.SettingsTabName.ViewLinkSettingsTab),this.context.logEvent(u.TiburonEventName.ClickSettingsText,this.props.sharedLink,{settings_tab:t})}}render(){const{canCreateLink:e,contentMetadata:t,linkAccessLevelOptions:s,onSelectedAccessLevelChange:a,selectedAccessLevel:r,selectedAudience:o,sharedLink:l,teamPolicy:c,defaultSharingLinkAudience:d,isUlssEnabled:h}=this.props,p=this.enableSettingsButton();return n.React$1.createElement(m.ActionSection,{layout:"columns"},n.React$1.createElement(Li,{selectedAccessLevel:r,linkAccessLevelOptions:s,contentMetadata:t,selectedAudience:Ti(e,o,l,c,t.policy,d,h),onSelectedAccessLevelChange:a}),n.React$1.createElement(i.Text,{size:"standard",color:p?"standard":"disabled"},this.renderSettingsButton(p)))}enableSettingsButton(){return this.props.canCreateLink||void 0!==this.props.sharedLink}renderSettingsButton(e){const t=r.intl.formatMessage({id:"Q8t9EL",defaultMessage:"Settings"});return e?n.React$1.createElement(i.Link,{href:"#",hasNoUnderline:!0,onClick:this.handleSettingsButtonClick},t):n.React$1.createElement(n.React$1.Fragment,null,t)}}Ri.displayName="AccessLevelSection",Ri.contextType=os;var Ni={expandedPanels:new Set([]),variant:"standard",headerTagName:"h1"},xi=n.react.exports.createContext(Ni),Pi=n.react.exports.createContext({itemId:"",isDisabled:!1,headerA11yProps:{id:"",ariaControls:""},setHeaderA11yProps:()=>{}}),Fi=n.react.exports.createContext({size:"medium"}),Oi=({className:e,children:t,variant:s="standard",expandedPanel:a="",expandedPanels:r=[],headerTagName:o="h2",...l})=>{const c=i.classnames("dig-Accordion",`dig-Accordion--${s}`,e);return n.react.exports.createElement(xi.Provider,{value:{expandedPanels:"blades"===s?new Set([a]):new Set(r),variant:s,headerTagName:o}},n.react.exports.createElement("div",{className:c,...l},t))};Oi.displayName="Accordion",Oi.Item=({itemId:e,className:t,isDisabled:s=!1,children:a,...r})=>{const{expandedPanels:o}=n.react.exports.useContext(xi),[l,c]=n.react.exports.useState({id:"",ariaControls:""}),d=o.has(e),h=i.classnames("dig-Accordion-item",{"dig-Accordion-item--isActive":d,"dig-Accordion-item--disabled":s},t);return n.react.exports.createElement(Pi.Provider,{value:{itemId:e,isDisabled:s,headerA11yProps:l,setHeaderA11yProps:c}},n.react.exports.createElement("div",{className:h,...r},a))},Oi.Header=({size:e="medium",spacing:t="medium",id:s,"aria-controls":a,className:r,children:o,...l})=>{const{expandedPanels:c,headerTagName:d}=n.react.exports.useContext(xi),{itemId:h,isDisabled:p,setHeaderA11yProps:m}=n.react.exports.useContext(Pi),u=c.has(h),g=i.classnames("dig-Accordion-header",`dig-Accordion-header-size--${e}`,`dig-Accordion-header-spacing--${t}`,r),f=n.react.exports.useMemo((()=>s||(e=>`${e}-header-id`)(h)),[h,s]),_=n.react.exports.useMemo((()=>a||(e=>`${e}-panel-id`)(h)),[h,a]);return n.react.exports.useEffect((()=>{m({id:f,ariaControls:_})}),[f,_,m]),n.react.exports.createElement(Fi.Provider,{value:{size:e}},n.react.exports.createElement(d,{className:g},n.react.exports.createElement("button",{className:"dig-Accordion-header-trigger",id:f,"aria-controls":_,...l,tabIndex:0,"aria-expanded":u,"aria-disabled":p,disabled:p},o)))},Oi.HeaderContent=({withTitle:e,withLeftAccessory:t,withTitleRightAccessory:s,withSubtitle:a})=>{const{variant:r,expandedPanels:o}=n.react.exports.useContext(xi),{itemId:l,isDisabled:c}=n.react.exports.useContext(Pi),{size:d}=n.react.exports.useContext(Fi),h=o.has(l),p=n.react.exports.useMemo((()=>"medium"===d?"standard":d),[d]),m=n.react.exports.useMemo((()=>c?"disabled":"blades"!==r||h?"standard":"faint"),[c,r,h]),u=n.react.exports.useMemo((()=>c?"disabled":"faint"),[c]);return n.react.exports.createElement(n.react.exports.Fragment,null,t&&n.react.exports.createElement("div",{className:"dig-Accordion-header-left-accessory"},t),n.react.exports.createElement("div",{className:"dig-Accordion-header-title-container"},n.react.exports.createElement("div",{className:"dig-Accordion-header-title-badge-container"},n.react.exports.createElement(i.Text,{isBold:!0,size:p,variant:"label",className:"dig-Accordion-header-title",color:m},e),s&&n.react.exports.createElement("div",{className:"dig-Accordion-header-title-right-accessory"},s)),n.react.exports.createElement(i.Text,{size:p,color:u,variant:"label",className:"dig-Accordion-header-subtitle"},a)),"standard"===r&&n.react.exports.createElement("div",{className:"dig-Accordion-header-chevron"},n.react.exports.createElement(i.UIIcon,{src:h?i.ChevronUpLine:i.ChevronDownLine,size:"small"})))},Oi.Panel=({children:e,spacing:t="medium",className:s,...a})=>{const{itemId:r,headerA11yProps:o}=n.react.exports.useContext(Pi),{expandedPanels:l}=n.react.exports.useContext(xi),c=l.has(r),d=i.classnames("dig-Accordion-panel",`dig-Accordion-panel-spacing--${t}`,s);return n.react.exports.createElement("div",{className:d,...a,role:"region",id:o.ariaControls,"aria-labelledby":o.id,"aria-hidden":!c,hidden:!c},e)};const Di={[g.ContactsErrorLevel.Error]:"error",[g.ContactsErrorLevel.Warn]:"warn",defaultLevel:"default"};class $i extends n.React$1.Component{constructor(e){super(e),this.handleAccordionClick=e=>{this.state.expandedPanels.includes(e)?this.setState({expandedPanels:this.state.expandedPanels.filter((t=>t!==e))}):this.setState({expandedPanels:[e]})},this.onTabSelected=e=>{this.props.actionHandler.changeRecipientAccess("editor"===e?i.ACCESS_LEVEL.WRITER:i.ACCESS_LEVEL.READER);const t="editor"===e?u.ShareTabName.EditTab:u.ShareTabName.ViewTab;this.context.logEvent(u.TiburonEventName.ViewShareTab,void 0,{share_tab:t})},this.onEmailTabSelected=e=>{this.props.actionHandler.changeEmailRecipientAccess("editor"===e?i.ACCESS_LEVEL.WRITER:i.ACCESS_LEVEL.READER)},this.state={expandedPanels:[]}}componentDidMount(){const e="editor"===this.props.selectedAccessLevel?u.ShareTabName.EditTab:u.ShareTabName.ViewTab;this.context.logEvent(u.TiburonEventName.ViewShareScreen,void 0,{share_tab:e}),this.context.logEvent(u.TiburonEventName.ViewShareTab,void 0,{share_tab:e})}render(){const{actionHandler:e,contentMetadata:t,selectedAccessLevel:s,selectedEmailAccessLevel:i,sharingInfo:a}=this.props;return 0===this.getLinkAccessLevelOptions().length?n.React$1.createElement(m.InfoBox,{imgPath:n.static_url("/static/metaserver/static/images/sharing/share_modal/no_access-vflRKAkm7.png"),imgAlt:r.intl.formatMessage({id:"jLOGFI",defaultMessage:"No permissions to share"}),title:r.intl.formatMessage({id:"XGWBlY",defaultMessage:"You can view, but not share"}),message:this.getNoPermissionsMessage()}):a.isDTLSM1Enabled()?n.React$1.createElement(n.React$1.Fragment,null,n.React$1.createElement(m.ActionContainer,{header:this.getHeaderDescription()},n.React$1.createElement(Ri,{selectedAccessLevel:i,canCreateLink:this.canCreateLink(s),contentMetadata:t,linkAccessLevelOptions:this.getLinkAccessLevelOptions(),selectedAudience:a.getSelectedAudienceByAccessLevel(s),sharedLink:this.getSharedLinkByAccessLevel(s),teamPolicy:a.teamPolicy(),onSelectedAccessLevelChange:this.onEmailTabSelected,openSharingSettingsModal:e.openSharingSettingsModal,defaultSharingLinkAudience:this.props.sharingInfo.getDefaultSharingLinkAudience()})),n.React$1.createElement(Oi,{variant:"standard",expandedPanels:this.state.expandedPanels},n.React$1.createElement(Oi.Item,{itemId:"email"},n.React$1.createElement(Oi.Header,{onClick:()=>this.handleAccordionClick("email")},n.React$1.createElement(Oi.HeaderContent,{withTitle:"or Share via email"})),n.React$1.createElement(Oi.Panel,null,this.showEmailSection(this.props.selectedEmailAccessLevel))))):n.React$1.createElement(m.ActionContainer,{header:this.getHeaderDescription()},this.renderAudienceConflictBanner(),n.React$1.createElement(m.FormValidationMessage,{message:this.props.contactsError.message,variant:this.getMessageType()}),n.React$1.createElement(Ri,{selectedAccessLevel:s,canCreateLink:this.canCreateLink(s),contentMetadata:t,linkAccessLevelOptions:this.getLinkAccessLevelOptions(),selectedAudience:a.getSelectedAudienceByAccessLevel(s),sharedLink:this.getSharedLinkByAccessLevel(s),teamPolicy:a.teamPolicy(),onSelectedAccessLevelChange:this.onTabSelected,openSharingSettingsModal:e.openSharingSettingsModal,defaultSharingLinkAudience:this.props.sharingInfo.getDefaultSharingLinkAudience(),isUlssEnabled:a.isUlssClientOn()}),"editor"===this.props.selectedAccessLevel?this.renderLinkSection("editor"):this.renderLinkSection("viewer"))}getMessageType(){const e=this.props.contactsError.level||"defaultLevel";return Di[e]}getSharedLinkByAccessLevel(e){let t;return"editor"===e?t=this.props.sharingInfo.editRighteousLink():"viewer"===e&&(t=this.props.sharingInfo.viewRighteousLink()||this.props.sharingInfo.shmodelLink()),t}canInvite(e){const t=this.props.sharingInfo.permissionsObj();switch(e){case"editor":return t.canInviteEditor();case"viewer":return t.canInviteViewer();default:return!1}}canCreateLink(e){const{sharingInfo:t,isTeamSharedFolder:s,contentMetadata:n}=this.props,i=this.props.sharingInfo.permissionsObj();return O.canCreateLink(e,t.isCloudDoc(),t.isFolder(),s,t.isConfidentialFolder(),i.canInviteEditor(),t.canShareLink(),i.canCreateViewLink(),i.canCreateEditLink(),n.access_type,!!n.path_lower,t.sharingPrefs().confidential_folder_links_enabled)}validateAccessLevel(e){return this.canInvite(e)||this.canCreateLink(e)||void 0!==this.getSharedLinkByAccessLevel(e)}validateEmailAccessLevel(e){return this.canInvite(e)}renderAudienceConflictBanner(){const e=this.props.sharingInfo.isUlssClientOn(),t=this.getNewLastSeenTeamPolicyAudience(),s=this.getSharedLinkByAccessLevel(this.props.selectedAccessLevel);if(e&&t&&!s){this.props.actionHandler.setLastSeenTeamPolicyAudience((e=>{switch(e){case"unknown":return{".tag":"unknown"};default:return{".tag":"public"};case"default_no_one":case"no_one":return{".tag":"no_one"};case"team_only":case"default_team_only":return{".tag":"team"}}})(t));const e=this.props.contactsError.message?"share-modal-evolution__audience-conflict-banner-with-other-banner":"share-modal-evolution__audience-conflict-banner-with-no-banner";return n.React$1.createElement("div",{className:e},n.React$1.createElement(i.Banner,{withLeftIcon:n.React$1.createElement(i.UIIcon,{src:i.InfoLine})},n.React$1.createElement(i.Banner.Message,null,this.getAudienceConflictBannerText())))}return n.React$1.createElement(n.React$1.Fragment,null)}showEmailSection(e){const{actionHandler:t,sharingInfo:s}=this.props;return n.React$1.createElement(Ei,{actionHandler:t,contactsError:this.props.contactsError,isEmailSending:this.props.isEmailSending,disabledContactsInput:!this.canInvite(e),handleMessageChanged:this.props.handleMessageChanged,modalClose:this.props.closeModalHandler,recipientMessage:this.props.recipientMessage,sharedLink:this.getSharedLinkByAccessLevel(e),showPostNoteAsComment:s.permissionsObj().canShareMessageAsComment(),isFolder:s.isFolder(),isPostNoteAsCommentChecked:s.isShareMessageAsCommentChecked(),isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,initialTypeaheadTokens:this.props.initialTypeaheadTokens,user:this.props.user,accessLevel:e,selectedEmailAccessLevel:e,onSelectedEmailAccessLevelChange:this.onEmailTabSelected,emailAccessLevelOptions:this.getEmailAccessLevelOptions(),canCreateLink:this.canCreateLink(e),contentMetadata:this.props.contentMetadata,canCreateViewLinkForFolder:this.canCreateLink("viewer"),viewLinkForFolder:s.shmodelLink(),showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,teamPolicy:s.teamPolicy(),emailCountChangeCallback:this.updateEmailTokenCount.bind(this),getEmailTokenCountFn:this.getEmailTokenCount.bind(this)})}updateEmailTokenCount(e){}getEmailTokenCount(){}renderLinkSection(e){const{actionHandler:t,sharingInfo:s}=this.props;return this.validateAccessLevel(e)?n.React$1.createElement(Mi,{accessLevel:e,actionHandler:t,canCreateLink:this.canCreateLink(e),canInviteByEmail:this.canInvite(e),contactsError:this.props.contactsError,contentMetadata:this.props.contentMetadata,isEmailSending:this.props.isEmailSending,handleMessageChanged:this.props.handleMessageChanged,initialTypeaheadTokens:this.props.initialTypeaheadTokens,isPostNoteAsCommentChecked:s.isShareMessageAsCommentChecked(),isTokenizerEmpty:this.props.isTokenizerEmpty,isTeamSharedFolder:this.props.isTeamSharedFolder,onManageAccessClick:this.props.onManageAccessClick,recipientMessage:this.props.recipientMessage,user:this.props.user,sharedLink:this.getSharedLinkByAccessLevel(e),modalClose:this.props.closeModalHandler,isFolder:s.isFolder(),teamPolicy:s.teamPolicy(),showPostNoteAsComment:s.permissionsObj().canShareMessageAsComment(),canCreateViewLinkForFolder:this.canCreateLink("viewer"),viewLinkForFolder:s.shmodelLink(),showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest}):n.React$1.createElement(ki,{accessLevel:e,isFolder:s.isFolder()})}getHeaderDescription(){return this.props.sharingInfo.isFolder()?r.intl.formatMessage({id:"hMjxKh",defaultMessage:"Share this folder"}):r.intl.formatMessage({id:"8fJdJ4",defaultMessage:"Share this file"})}getLinkAccessLevelOptions(){const e=[];return e.push({link_access_level:"viewer",allowed:this.validateAccessLevel("viewer"),label:"can view"}),e.push({link_access_level:"editor",allowed:this.validateAccessLevel("editor"),label:"can edit"}),e.filter((e=>e.allowed))}getEmailAccessLevelOptions(){const e=[];return e.push({link_access_level:"viewer",allowed:this.validateEmailAccessLevel("viewer"),label:"can view"}),e.push({link_access_level:"editor",allowed:this.validateEmailAccessLevel("editor"),label:"can edit"}),e.filter((e=>e.allowed))}getNoPermissionsMessage(){return this.props.sharingInfo.isFolder()?r.intl.formatMessage({id:"fpgILd",defaultMessage:"To share this folder, ask someone else for access to edit."}):r.intl.formatMessage({id:"m4b4bb",defaultMessage:"To share this file, ask someone else for access to edit."})}getNewLastSeenTeamPolicyAudience(){const e=this.props.sharingInfo.isUlssClientOn(),t=this.props.sharingInfo.getLastSeenTeamPolicyAudience(),s=this.props.sharingInfo.teamPolicy(),n=this.props.sharingInfo.getDefaultSharingLinkAudience();if(e&&s&&function(e,t){if(!e||!t)return!1;const s=e.shared_folder_link_restriction_policy;if(s&&"members"===s){if("no_one"!==t)return!0}else{const s=e.shared_link_create_policy;if(!s)return!1;if(Ii(s,t)!==t)return!0}return!1}(s,n)){if("members"===s.shared_folder_link_restriction_policy){if("no_one"!==t)return"no_one"}else if(t!==(e=>{switch(e){default:return"public";case"team_only":case"default_team_only":return"team";case"default_no_one":return"no_one"}})(s.shared_link_create_policy))return s.shared_link_create_policy}}getAudienceConflictBannerText(){return r.intl.formatMessage({id:"suIfYq",defaultMessage:"Your admin has changed the <b>Who has access</b> default link sharing settings, but you can still adjust settings for certain items."},{b:e=>n.React$1.createElement("b",null,e)})}}$i.displayName="MainSection",$i.contextType=os,i.requireCssWithComponent($i,["/static/metaserver/static/css/sharing/share_modal_evolution-vflntdKys.css"]);class Bi extends n.React$1.Component{constructor(){super(...arguments),this.getDocsendAnalyticsAddOnEntryPointMetadata=()=>{var e;const{contentMetadata:t,sharingInfo:s,user:n,docsendAnalyticsAddOnMetadata:a}=this.props,r=L.getDocsendAnalyticsAddOnConfig(n,a.variant),o=r.coreSharingModal.showFooterWhenViewAccess&&"writer"!==s.recipientAccess()||r.coreSharingModal.showFooterWhenEditAccess,l=r.isSupportedFile((null===(e=s.sharingInfoState().linkMetadata)||void 0===e?void 0:e.file_size)||0,i.file_extension(t.name));return o&&l&&t.path_lower&&t.isFile()?{showEntryPoint:!0,entryPointProps:{fileName:t.name,user:n,fileId:t.id,path:t.path_lower,variant:r.variantForLogging,linkMetadata:a,waitForLinkMetadata:r.coreSharingModal.fetchAnalyticsLink}}:{showEntryPoint:!1}}}render(){const{actionHandler:e,contactsError:t,contentMetadata:s,isEmailSending:i,handleManageAccessClick:a,handleMessageChanged:r,initialTypeaheadTokens:o,isTeamSharedFolder:l,isTokenizerEmpty:c,sharingInfo:d,showPassFileSettings:h,onCloseButtonClick:p,onSettingsButtonClick:m,recipientMessage:u,user:g,guestMembers:f,linkMembers:_,showApproval:E,sendApproval:S,needsAllApprovers:M,creatingApprovalRequest:k}=this.props;return n.React$1.createElement("div",{className:"share-modal-evolution-share-screen"},n.React$1.createElement(Zn,{canEdit:d.permissionsObj().canEdit(),isConfidentialFolder:d.isConfidentialFolder(),isTeamSharedFolder:d.isTeamSharedFolder(),isFolderInsideTeamFolderTree:d.isFolderInsideTeamFolderTree(),showPassFileSettings:h,contentInfo:d.contentInfo(),guestMembers:f,linkMembers:_,membership:d.members(),onCloseButtonClick:p,onManageAccessClick:a,onSettingsButtonClick:m,sharingInfo:d}),n.React$1.createElement($i,{actionHandler:e,closeModalHandler:p,contactsError:t,contentMetadata:s,isEmailSending:i,handleMessageChanged:r,initialTypeaheadTokens:o,isTeamSharedFolder:l,isTokenizerEmpty:c,onManageAccessClick:a,recipientMessage:u,sharingInfo:d,user:g,selectedAccessLevel:"writer"===this.props.sharingInfo.recipientAccess()?"editor":"viewer",selectedLinkAccessLevel:"writer"===this.props.sharingInfo.linkRecipientAccess(s)?"editor":"viewer",selectedEmailAccessLevel:"writer"===this.props.sharingInfo.emailRecipientAccess()?"editor":"viewer",showApproval:E,sendApproval:S,needsAllApprovers:M,creatingApprovalRequest:k}))}}Bi.displayName="ShareScreen";const Ui=i.requireCssWithComponent(Bi,["/static/metaserver/static/css/sharing/share_modal_evolution-vflntdKys.css"]);class Hi extends n.React$1.Component{constructor(){super(...arguments),this.handleManageAccessClick=()=>{this.handleLogEvent(u.TiburonEventName.ClickWhoCanAccess),this.props.showScreen(i.MANAGE_SCREEN)},this.handleBackButtonClick=()=>{this.props.showScreen(i.SHARE_SCREEN)},this.handleLogEvent=(e,t,s)=>{const{contentMetadata:n,user:i}=this.props;this.props.logTiburonEvent(e,i.id,Object.assign(Object.assign({},k.buildExtraFromMetadata(n,t)),s))}}render(){return n.React$1.createElement(i.LayerContext.Provider,{value:{zIndex:1e4}},n.React$1.createElement(ls,{logEvent:this.handleLogEvent,experiments:this.props.actionHandler.getSharingInfo().getExperiments()},n.React$1.createElement("div",{className:"share-modal-evolution"},this.renderActiveScreen())))}renderActiveScreen(){return this.props.currentScreen===i.MANAGE_SCREEN?n.React$1.createElement(Yn,Object.assign({},this.manageAccessPageProps())):n.React$1.createElement(Ui,Object.assign({},this.getShareScreenProps()))}manageAccessPageProps(){const{isFolder:e,isTeamSharedFolder:t,onSettingsButtonClick:s,onLinkSettingsTextClick:n,sharingInfo:i,onCloseButtonClick:a,actionHandler:r,user:o,currentTab:l}=this.props;return{canInviteMembers:i.permissionsObj().canInvite(),fileName:i.name(),isFolder:e,isTeamSharedFolder:t,memberListProps:this.props.memberListProps,membership:i.members(),onBackButtonClick:this.handleBackButtonClick,onCloseButtonClick:a,onSettingsButtonClick:s,onLinkSettingsTextClick:n,ownerTeamName:this.props.ownerTeam?this.props.ownerTeam.name:void 0,actionHandler:r,editLinkExists:!!i.editRighteousLink(),user:o,lmlSprigSurveyOrigin:i.contentInfo().extras.origin,lmlExperimentVariant:i.sharingPrefs().exp_links_in_member_list,currentTab:this.getManageAccessPageTab(l)}}getManageAccessPageTab(e){if(e==u.ManageAccessTabName.ManagePeopleTab||e==u.ManageAccessTabName.ManageLinksTab)return e}getShareScreenProps(){return{actionHandler:this.props.actionHandler,contactsError:this.props.contactsError,contentMetadata:this.props.contentMetadata,isEmailSending:this.props.isEmailSending,handleManageAccessClick:this.handleManageAccessClick,handleMessageChanged:this.props.handleMessageChanged,initialTypeaheadTokens:this.props.initialTypeaheadTokens,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,onCloseButtonClick:this.props.onCloseButtonClick,onSettingsButtonClick:this.props.onSettingsButtonClick,recipientMessage:this.props.recipientMessage,sharingInfo:this.props.sharingInfo,user:this.props.user,guestMembers:this.props.guestMembers,linkMembers:this.props.linkMembers,showPassFileSettings:this.props.showPassFileSettings,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,docsendAnalyticsAddOnMetadata:this.props.docsendAnalyticsAddOnMetadata}}}Hi.displayName="ShareModalEvolution";const Vi=i.requireCssWithComponent(Hi,["/static/metaserver/static/css/sharing/share_modal_evolution-vflntdKys.css","/static/metaserver/static/css/dig-components/index.web-vflvPodS4.css"]);function Gi(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=new i.UserApiV2Client,s=i.mustGetActiveUserId(),n={user_id:s,task:e};t.ns("custom_onboarding").rpc("update_task",n,{subjectUserId:s}).catch((t=>{var s;_.reportException({err:t,tags:["onboarding_checklist","updated_task"],severity:S.SEVERITY.NONCRITICAL,exc_extra:{task_type:null===(s=e.type)||void 0===s?void 0:s[".tag"]}})}))}))}class Wi extends n.react.exports.PureComponent{render(){const{className:e,children:t,textButtonShare:s,isButtonShareDisabled:a,onClickButtonShare:r}=this.props,o=i.classnames("scl-sharing-modal-footer-inband",e,"scl-sharing-modal-footer");return n.react.exports.createElement("div",{className:o},t,n.react.exports.createElement("div",{className:"scl-sharing-modal-footer-inband__spacer"}),n.react.exports.createElement(i.Button$1,{variant:"primary",className:"scl-sharing-modal-footer-inband__button","aria-label":s,onClick:r,disabled:a},s))}}Wi.defaultProps={isButtonShareDisabled:!1},Wi.displayName="SharingModalFooterInband";class Ki extends n.React$1.PureComponent{isInbandFooterDisabled(){return this.props.isTokenizerEmpty||this.props.contactsError&&this.props.contactsError.level===g.ContactsErrorLevel.Error||!!this.props.contentNameMessage}render(){const{mode:e,children:t,shareButtonLabelOverride:s}=this.props;switch(e){case l.MODES.SHARE:return n.React$1.createElement(Wi,{isButtonShareDisabled:this.isInbandFooterDisabled(),textButtonShare:s||(this.props.isTeamSharedFolder?r.intl.formatMessage({id:"YcxVqg",defaultMessage:"Add"}):r.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"})),onClickButtonShare:this.props.onShareButtonClick},t);case l.MODES.SHARE_SENDING:return n.React$1.createElement(Wi,{isButtonShareDisabled:!0,textButtonShare:s||(this.props.isTeamSharedFolder?r.intl.formatMessage({id:"JowGoo",defaultMessage:"Adding..."}):r.intl.formatMessage({id:"WyW2Um",defaultMessage:"Sharing..."})),onClickButtonShare:M.noop},t);case l.MODES.MEMBERSHIP:return this.props.isInContentManager&&!this.props.contentInfo.pathExists()?n.React$1.createElement(Wi,{isButtonShareDisabled:!1,textButtonShare:s||(this.props.isTeamSharedFolder?r.intl.formatMessage({id:"YcxVqg",defaultMessage:"Add"}):r.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"})),onClickButtonShare:this.props.onShareButtonClick}):null;default:return null}}}Ki.displayName="ShareModalFooterSection";class zi extends n.React$1.Component{constructor(){super(...arguments),this.afterLoad=()=>{this.hasPerformedAfterLoad=!0,this.props.user.is_team&&Gi({type:{".tag":"share_file"},is_completed:!0})},this.isGoldenGateTeamOverLimit=()=>g.shouldEnforceMemberLimits(this.props.user,this.props.isTeamSharedFolder,this.props.isFolderInsideTeamFolderTree)&&(null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:0)>=x.GoldenGate.SHARING_TOTAL_LIMIT,this.handleLogTiburonEvent=(e,t,s)=>{const{modalSessionId:n,origin:a}=this.props.contentInfo.extras;i.ShareTibEventLogger.log(t,e,a,Object.assign(Object.assign({},s),{modal_session_id:n}))},this.handleMessageChanged=e=>{this.props.actionHandler.changeRecipientMessage(e.target.value)},this.linkSectionProps=()=>({actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,mode:this.props.mode,user:this.props.user,onLinkSettingsClick:this.props.onLinkSettingsClick,closeModalHandler:this.props.onModalCloseClick,isLinkMetadataLoaded:this.props.isLinkMetadataLoaded,isTeamSharedFolder:this.props.isTeamSharedFolder,canShareLink:this.props.canShareLink,permissions:this.props.sharingPermissions}),this._addEveryoneGroup=()=>this.contactsSection.addExternalContacts([Ms.teamGroupInfoToContact(this.props.teamGroupInfo)]),this.headerSectionProps=()=>({ref:this.setHeaderSectionRef,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,contentNameMessage:this.props.contentNameMessage,contentNameMessageLevel:this.props.contentNameMessageLevel,canEdit:this.props.canEdit,isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isConfidentialFolder:this.props.isConfidentialFolder,isContentNameFocused:this.props.isContentNameFocused,isCreatingNewFolder:this.props.isCreatingNewFolder,isMetadataLoaded:this.props.isMetadataLoaded,initialContentName:this.props.initialContentName,onModalCloseClick:this.props.onModalCloseClick,onSettingsButtonClick:this.props.onSettingsClick,onContentNameInputChange:this.handleContentNameInputChange,onContentNameInputKeyUp:this.handleContentNameInputKeyUp,ownerTeam:this.props.ownerTeam,sharingInfo:this.props.actionHandler.getSharingInfo(),showPassFileSettings:this.props.showPassFileSettings,user:this.props.user}),this.contactsSectionProps=()=>({ref:this.setContactsSectionRef,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,canInviteEditor:this.props.sharingPermissions.canInviteEditor(),canInviteViewer:this.props.sharingPermissions.canInviteViewer(),context:"spectrum",focusOnMount:this.props.focusOnMount&&this.props.contentInfo.pathExists(),initialTypeaheadTokens:this.getInitialTypeaheadTokens(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,memberCountWithRecipients:this.props.memberCountWithRecipients,ownerTeam:this.props.ownerTeam,shouldLogContactSearch:!0,typeaheadPlaceholder:this.getTypeaheadPlaceholder(),user:this.props.user,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.isTeamSharedFolder?this.props.teamGroupInfo:void 0}),this.handleContentNameInputChange=e=>{this.props.actionHandler.handleContentNameChange(e.currentTarget.value)},this.handleContentNameInputKeyUp=e=>{e.key===i.Key_enum.Key.Enter&&this.contactsSection&&this.contactsSection.focusTypeaheadInput()},this.handleShareButtonClick=()=>s.__awaiter(this,void 0,void 0,(function*(){const{actionHandler:e}=this.props;if(this.props.isCreatingNewFolder)try{return yield e.setContentNameAndSendShare(this.contactsSection)}catch(e){this.headerSection.selectContentNameInput(),this.props.onSetContentNameAndSendShareFail&&this.props.onSetContentNameAndSendShareFail(e)}else yield e.sendShare(this.contactsSection)})),this.setContactsSectionRef=e=>{this.contactsSection=e},this.setHeaderSectionRef=e=>{this.headerSection=e}}componentDidMount(){this.hasPerformedAfterLoad=!1,this.logTTI()}componentDidUpdate(e,t){return this.logTTI()}logTTI(){if(this.props.contentInfo.extras.origin===i.SHARE_ACTION_ORIGIN_TYPE.GRANT_ACCESS&&this.props.mode!==l.MODES.LOADING&&i.mark_time_to_interactive(),this.props.mode===l.MODES.LINK_ONLY&&this.props.isLinkMetadataLoaded?this.props.actionHandler.logIfHaventBefore(u.TiburonEventName.ViewLinkOnlyModal,{link_only_reason:this.props.linkOnlyReason||"undefined"}):this.props.mode!==l.MODES.LOADING&&this.props.actionHandler.logIfHaventBefore(u.TiburonEventName.ViewShareModal),this.props.mode===l.MODES.LOADING||this.hasPerformedAfterLoad||this.afterLoad(),this.props.mode===l.MODES.MEMBERSHIP)return this.props.actionHandler.logIfHaventBefore(u.TiburonEventName.MemberListLoaded,{member_count:this.props.actionHandler.getSharingInfo().memberNum()})}render(){let e=`${this.props.mode}`;this.props.mode===l.MODES.MEMBERSHIP&&(this._shouldRenderMainMembershipMode()||(e="no-main-membership"));const t=i.classnames("unified-share-modal",`unified-share-modal--${e}`,"unified-share-modal--two-link",{"unified-share-modal--loading":e===l.MODES.LOADING,"unified-share-modal--auto-folder":this.shouldRenderAutoFolderCheckbox()});switch(this.props.mode){case l.MODES.LINK_ONLY:return n.React$1.createElement("div",{className:t},n.React$1.createElement(Cs,Object.assign({},this.headerSectionProps())),this.props.linkOnlyReason!==l.LINK_ONLY_REASON.LINKS_PAGE&&this.renderLinkOnlyNoPermissionSection(),this.renderLinkOnlyFooter());case l.MODES.POINTER:return n.React$1.createElement(wn,{className:t,sharingInfo:this.props.sharingInfo,onClickCloseButton:this.props.onModalCloseClick});case l.MODES.LOADING:return n.React$1.createElement("div",{className:t},n.React$1.createElement(Cs,Object.assign({},this.headerSectionProps(),{isLoading:!0})),this._renderMainLoading());case l.MODES.EVOLUTION:return n.React$1.createElement("div",{className:t},n.React$1.createElement(Vi,Object.assign({},this.shareModalEvolutionProps())));default:return n.React$1.createElement("div",{className:t},n.React$1.createElement(Cs,Object.assign({},this.headerSectionProps())),this._renderToSection(),n.React$1.createElement(In,Object.assign({},this.props.contactsError)),this.shouldRenderConfidentialFolderSection()&&n.React$1.createElement(An,Object.assign({},this.confidentialFolderSectionProps())),this.shouldRenderInformOwnerUpdateSection()&&n.React$1.createElement($e,null),this._renderMainSection(),this.shouldRenderAutoFolderCheckbox()&&n.React$1.createElement(Y.AutoFolderSetupCheckbox,{automateOptionChecked:!!this.props.automationOptionChecked,onAutomationOptionToggle:this.props.actionHandler.toggleAutomationOption,intl:r.intl,inShareModal:!0}),this.shouldRenderFooterSection()&&this.renderFooterSection())}}_renderToSection(){return this.props.showContentManagerBridge?this._renderContentManagerBridge():this.props.sharingPermissions.canInvite()?this.isGoldenGateTeamOverLimit()?this._renderOverLimitSection():n.React$1.createElement(bn,Object.assign({},this.contactsSectionProps())):n.React$1.createElement(Tn,Object.assign({},this.noPermissionsSectionProps()))}noPermissionsSectionProps(){return{isFolder:this.props.contentInfo.isFolder(),isTeamSharedFolder:this.props.isTeamSharedFolder,members:this.props.members,teamName:this.props.ownerTeam&&this.props.ownerTeam.name}}shouldRenderAutoFolderCheckbox(){const e=i.getStoreForBrowse(),{expFlowsCoreFolderSetupFlow:t}=i.browsePostTTIExperiments(e.getState()),s=this.props.sharingInfo.fqPath(),n=s?ge.getUserAutomation(s)(fe.getStoreForAutomations().getState()):void 0;return"INCLUDE_SHARING"===t&&!n}shouldRenderContentSettingsShareButton(){return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||this.inShareMode()||this.props.isInContentManager}inShareMode(){return[l.MODES.SHARE,l.MODES.SHARE_SENDING].includes(this.props.mode)}shouldRenderFooterSection(){return!!this.props.isMetadataLoaded&&(this.shouldRenderLinkRowInFooter()||this.shouldRenderContentSettingsShareButton())}renderFooterSection(){const e=i.classnames(["unified-share-modal__section","unified-share-modal__section--footer"]);return n.React$1.createElement("div",{className:e},this.shouldRenderLinkRowInFooter()?this.renderLinkRowContent():n.React$1.createElement(Ki,Object.assign({},this.shareButtonProps())))}shareButtonProps(){return{mode:this.props.mode,contentInfo:this.props.contentInfo,contactsError:this.props.contactsError,contentNameMessage:this.props.contentNameMessage,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,onShareButtonClick:this.handleShareButtonClick,shareButtonLabelOverride:this.props.shareButtonLabelOverride}}_shouldRenderMainMembershipMode(){return this.props.sharingPermissions.canInvite()||this._showSharingMemberList()}_renderMainSection(){switch(this.props.mode){case l.MODES.MEMBERSHIP:return this._shouldRenderMainMembershipMode()?this._renderMainMembership():null;case l.MODES.SHARE:case l.MODES.SHARE_SENDING:return this._renderMainShare();default:return null}}confidentialFolderSectionProps(){const{ownerTeam:e,contentInfo:t,actionHandler:s}=this.props;return{intl:r.intl,teamName:e?e.name:"",parentFolderName:s.getSharingInfo().parentFolderName(),isRestoreAccessEnabled:t.pathExists(),onRestoreAccessClick:s.handleSetConfidentialClick}}shouldRenderConfidentialFolderSection(){return this.props.isConfidentialFolder&&this.props.canUpdateConfidentiality}hasOwnersThatAreNotCurrentUser(){const e=this.props.members;if(null==e)return!1;return e.users.filter((e=>e.access_type===i.ACCESS_LEVEL.OWNER&&e.team_member_id!==this.props.user.team_member_id)).size>0}shouldRenderInformOwnerUpdateSection(){return!!this.props.sharingInfo.metadata()&&(this.props.isInContentManager&&this.props.contentInfo.isFolder()&&!this.props.isTeamSharedFolder&&!this.props.isFolderInsideTeamFolderTree&&this.hasOwnersThatAreNotCurrentUser())}_renderContentManagerBridge(){const e=this.props.actionHandler.getSharingInfo(),t=i.parent_dir(e.displayPath()),s=e.name(),a=D.genContentManagerBridgeUri({containingFolder:t,filenameToSelect:s}),o=n.React$1.createElement("span",null,r.intl.formatMessage({id:"EpLafK",defaultMessage:"You can manage access in the <link>admin console</link>."},{link:e=>n.React$1.createElement("a",{href:a.toString(),target:"_blank",rel:"noreferrer"},e)}));return n.React$1.createElement(F.SharingModalBanner,{message:o})}_renderOverLimitSection(){const e=r.intl.formatMessage({id:"JSd+J1",defaultMessage:"This folder is over its {member_limit}-member limit."},{member_limit:x.GoldenGate.SHARING_TOTAL_LIMIT}),t=n.React$1.createElement("div",null,n.React$1.createElement("div",null,e),n.React$1.createElement("div",null,r.intl.formatMessage({id:"wFsjaI",defaultMessage:"Please remove some members."})," ",n.React$1.createElement("a",{href:"/help/9292",target:"_blank",rel:"noopener"},r.intl.formatMessage({id:"epmnB3",defaultMessage:"Learn more."}))));return n.React$1.createElement(F.SharingModalBanner,{message:t})}_renderMainLoading(){return n.React$1.createElement("div",{className:i.classnames(["unified-share-modal__main","unified-share-modal__section","unified-share-modal__section--no-border",this.shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer-spectrum"])},n.React$1.createElement("div",{className:"unified-share-modal__loader-wrapper"},n.React$1.createElement("div",{className:"c-loader"},r.intl.formatMessage({id:"/DGYJM",defaultMessage:"Loading..."}))))}renderLinkOnlyFooter(){return n.React$1.createElement("div",{className:i.classnames(["unified-share-modal__section","unified-share-modal__section--footer"])},this.props.isLinkMetadataLoaded?this.renderLinkRowContent():this.renderLinkOnlyLoading())}renderLinkRowContent(){if(!this.props.isInContentManager)return n.React$1.createElement(yn,Object.assign({},this.linkSectionProps()))}getLinkOnlyReasonMessage(){const e=this.props.sharingInfo.countsExceedNsLimit();switch(this.props.linkOnlyReason){case l.LINK_ONLY_REASON.INSIDE_SHARED_FOLDER:return n.React$1.createElement("span",null,r.intl.formatMessage({id:"vApw15",defaultMessage:"This folder can only be shared as a link because it’s in a shared folder."})," ",n.React$1.createElement("a",{href:"/help/1931",target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.CONTAINS_SHARED_FOLDER:return n.React$1.createElement("span",null,r.intl.formatMessage({id:"0er2Ve",defaultMessage:"This folder can only be shared as a link because it contains a shared folder."})," ",n.React$1.createElement("a",{href:"/help/1931",target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.TOTAL_MOUNTS_EXCEEDED:return n.React$1.createElement("div",{className:"scl-sharing-modal-banner--left"},n.React$1.createElement("b",null,g.getLinkOnlyTitle()),n.React$1.createElement("br",null),e?g.getTotalMountsExceededLinkOnlyMsg(e):g.getTotalMountsExceededMsg()," ",n.React$1.createElement("a",{href:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.HOME_MOUNTS_EXCEEDED:return n.React$1.createElement("div",{className:"scl-sharing-modal-banner--left"},n.React$1.createElement("b",null,g.getLinkOnlyTitle()),n.React$1.createElement("br",null),e?g.getHomeMountsExceededLinkOnlyMsg(e):g.getHomeMountsExceededMsg()," ",n.React$1.createElement("a",{href:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.TREE_SIZE_EXCEEDED:return n.React$1.createElement("div",{className:"scl-sharing-modal-banner--left"},n.React$1.createElement("b",null,g.getLinkOnlyTitle()),n.React$1.createElement("br",null),e?g.getTreeSizeExceededLinkOnlyMsg(e):g.getTreeSizeExceededMsg()," ",n.React$1.createElement("a",{href:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",target:"_blank",rel:"noopener noreferrer"},r.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));default:return r.intl.formatMessage({id:"RSBaM6",defaultMessage:"This folder can only be shared as a link."})}}renderLinkOnlyNoPermissionSection(){let e;return e=this.props.actionHandler.getSharingInfo().isOSXPackage()?r.intl.formatMessage({id:"vJ3Igb",defaultMessage:"This package file can only be shared as a link."}):this.getLinkOnlyReasonMessage(),n.React$1.createElement(F.SharingModalBanner,{message:e})}renderLinkOnlyLoading(){return n.React$1.createElement("div",{className:"unified-share-modal__link-info--loading"},n.React$1.createElement(m.ScooterLoader,{"aria-label":r.intl.formatMessage({id:"qxfDnR",defaultMessage:"Loading..."})}))}_showSharingMemberList(){return!!this.props.sharingInfo.hasNonSelfMembers()||(this.props.isFolderInsideTeamFolderTree?1===this.props.members.users.size||!this.props.isConfidentialFolder:this.props.guestMembers.length>0||this.props.linkMembers.length>0)}_renderMemberList(){return n.React$1.createElement("div",{className:i.classnames(["unified-share-modal__section","unified-share-modal__section--no-padding","unified-share-modal__section--no-border"])},n.React$1.createElement(qs,Object.assign({},this.memberListProps())))}shareModalEvolutionProps(){return{actionHandler:this.props.actionHandler,contactsError:this.props.contactsError,contentMetadata:this.props.metadata,currentScreen:this.props.currentScreen,currentTab:this.props.currentTab,isEmailSending:this.props.sharingInfo.uiMode()===l.MODES.SHARE_SENDING,handleMessageChanged:this.handleMessageChanged,initialTypeaheadTokens:this.getInitialTypeaheadTokens(),isFolder:this.props.contentInfo.isFolder(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,logTiburonEvent:this.handleLogTiburonEvent,memberListProps:this.memberListProps(),onCloseButtonClick:this.props.onModalCloseClick,onSettingsButtonClick:this.props.onSettingsClick,onLinkSettingsTextClick:this.props.onLinkSettingsTextClick,ownerTeam:this.props.ownerTeam,recipientMessage:this.props.recipientMessage,sharingInfo:this.props.sharingInfo,showScreen:this.props.actionHandler.showScreen,user:this.props.user,guestMembers:this.props.guestMembers,linkMembers:this.getFilteredLinkMembers(),showPassFileSettings:this.props.showPassFileSettings,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,docsendAnalyticsAddOnMetadata:this.props.docsendAnalyticsAddOnMetadata}}memberListProps(){return{actionHandler:this.props.actionHandler,areMembersFullyLoaded:this.props.areMembersFullyLoaded,canInviteMembers:this.props.sharingPermissions.canInvite(),hasLinkMetadata:this.props.isLinkMetadataLoaded,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,disabled:this.props.showContentManagerBridge,groupSeenStateInfo:this.props.groupSeenStateInfo,guestMembers:this.props.guestMembers,isConfidentialFolder:this.props.isConfidentialFolder,linkMembers:this.getFilteredLinkMembers(),memberCounts:this.props.memberCounts,membership:this.props.members,ownerTeamName:this.props.ownerTeam?this.props.ownerTeam.name:void 0,pendingMemberAction:this.props.pendingMemberAction,presentAccountIds:this.props.presentAccountIds,shouldShowPassUI:this.props.isPassEnabled&&i.fetchingStatusIsSuccessful(this.props.passFetchingStatus),user:this.props.user}}_renderTeamSharedFolderBanner(){let e;return e=null!=this.props.teamGroupInfo?[n.React$1.createElement("p",{className:"u-mar-top-xxl"},n.React$1.createElement("a",{onClick:this._addEveryoneGroup},r.intl.formatMessage({id:"DnaiNC",defaultMessage:"Add everyone at {team_name}"},{team_name:this.props.ownerTeam.name}))),n.React$1.createElement("p",null,r.intl.formatMessage({id:"ix7pHj",defaultMessage:"Or, add groups to this team folder."})+" ",n.React$1.createElement("a",{onClick:this.props.onCreateGroupCallback},r.intl.formatMessage({id:"tthwuJ",defaultMessage:"Create a group"})))]:n.React$1.createElement("p",{className:"u-mar-top-xxl"},r.intl.formatMessage({id:"IjevGW",defaultMessage:"Add groups to this team folder."})+" ",n.React$1.createElement("a",{onClick:this.props.onCreateGroupCallback},r.intl.formatMessage({id:"tthwuJ",defaultMessage:"Create a group"}))),n.React$1.createElement("div",{className:i.classnames(["unified-share-modal__section","unified-share-modal__section--no-border"])},n.React$1.createElement("div",{className:i.classnames(["unified-share-modal__no-members-banner","u-font-center","u-font-meta","u-font-center","u-font-meta"])},e))}_renderMainMembership(){const e=i.classnames(["unified-share-modal__main",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0]);return this._showSharingMemberList()?n.React$1.createElement("div",{className:e},this._renderMemberList()):this.props.isTeamSharedFolder?n.React$1.createElement("div",{className:e},this._renderTeamSharedFolderBanner()):n.React$1.createElement("div",{className:e},n.React$1.createElement(Ln,Object.assign({},this.messageFieldProps())))}messageFieldProps(){return{placeholder:r.intl.formatMessage({id:"LQgYei",defaultMessage:"Add a message (optional)"}),onChange:this.handleMessageChanged,value:this.props.recipientMessage}}_renderMainShare(){return n.React$1.createElement("div",{className:"unified-share-modal__main"},!this.props.isTeamSharedFolder&&n.React$1.createElement(Ln,Object.assign({},this.messageFieldProps())))}_isPassInfoLoaded(){return i.fetchingStatusIsComplete(this.props.passFetchingStatus)}shouldRenderLinkRowInFooter(){return this.props.mode!==l.MODES.SHARE&&this.props.mode!==l.MODES.SHARE_SENDING&&!this.props.isInContentManager}getInitialTypeaheadTokens(){const{recipientTokens:e,initialRecipientTokens:t}=this.props;return e?t.concat(e):t}hasEditLink(){return this.props.sharingInfo.editRighteousLink()}hasViewLink(){return this.props.sharingInfo.viewRighteousLink()||this.props.sharingInfo.shmodelLink()}getTypeaheadPlaceholder(){return this.props.isTeamSharedFolder?r.intl.formatMessage({id:"GLQxt4",defaultMessage:"Group names"}):this.props.user.is_team?r.intl.formatMessage({id:"BoLL3S",defaultMessage:"Email, name, or group"}):r.intl.formatMessage({id:"EUp7Eo",defaultMessage:"Email or name"})}getFilteredLinkMembers(){var e;const t=this.hasEditLink(),s=this.hasViewLink(),n=[];for(const a of this.props.linkMembers){const r=a&&a.access_type;if(r)switch(r){case i.ACCESS_LEVEL.OWNER:n.push(a);break;case i.ACCESS_LEVEL.WRITER:t&&n.push(a);break;case i.ACCESS_LEVEL.READER:case i.ACCESS_LEVEL.READER_NO_COMMENT:(s||(null===(e=this.props.presentAccountIds)||void 0===e?void 0:e.has(a.account_id)))&&n.push(a)}}return n}}zi.displayName="ShareModalContentSpectrum",zi.defaultProps={headerId:"unified-share-modal-title",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:l.MODES.MEMBERSHIP,onFolderSettingsClick:null,guestMembers:[],linkMembers:[],onCreateGroupCallback:()=>{i.redirect("/team#groups/newgroup")}};const ji=i.requireCssWithComponent(zi,["/static/metaserver/static/css/spectrum/index.web-vflJy4G-t.css","/static/typescript/component_libraries/spectrum-sharing/src/index.web-vflfVzbR3.css","/static/metaserver/static/css/react/contacts_tokenizer-vflR-o-P-.css","/static/metaserver/static/css/scooter/scooter-scoped-vfl0EaHDR.css","/static/metaserver/static/css/sharing/share_modal-vflClWHjs.css","/static/metaserver/static/css/modal-vflf1hwfZ.css"],[q.BubbleDropdown]);class qi extends n.React$1.Component{constructor(e){super(e),this.spectrumModalClassName="scl-share-modal",this.handleKeyDown=e=>{e.key===i.Key_enum.Key.Escape&&this.onModalCloseClick()},this.preventEventBubbling=e=>e.stopPropagation(),this.onModalCloseClick=()=>s.__awaiter(this,void 0,void 0,(function*(){var e;const{onCancel:t,contentInfo:s}=this.props;t&&t();const n=this.getTokenizer();n&&n.finishLogging(!1),this.setState({open:!1}),i.dispatchModalClosed(),g.trackUserLeapEvent(g.SharingUserLeapEvent.SHARE_MODAL_CLOSE,s.extras.origin),g.logTiburonEvent(s,this.props.user.id,u.TiburonEventName.CloseShareModal),g.publishShopModalEvent(i.CampaignEvents.SHARE_MODAL_CLOSED,s,this.props.sharingInfo.getReferrer(),!0),"V1"===this.props.sharingPrefs.core_act_docsend_advanced_sharing&&(yield R.canBeShownDocsendModal(this.props.user.id))&&At({experimentVariant:"V1"}),this.props.sharingInfo.contentInfo().pathExists()&&this.props.sharingInfo.automationOptionChecked()&&I.asyncLaunchAddOrEditAutoFolderModal({fqPath:this.props.sharingInfo.fqPath(),nsId:null===(e=this.props.sharingInfo.metadata())||void 0===e?void 0:e.nsId(),user:this.props.user,entryPoint:"share_modal",source:"add_from_folder_creation"})})),this.getSpectrumModalElement=()=>document.getElementsByClassName(this.spectrumModalClassName)[0],this.onModalReady=()=>{i.dispatchModalOpened();const e=this.getSpectrumModalElement();e&&e.addEventListener("keypress",this.preventEventBubbling,!1)},this.handleDismiss=e=>{this.showPreviousScreen(e),this.props.openSettingsFromTheExternalSharePageQuickActions&&this.onModalCloseClick()},this.showPreviousScreen=e=>{let t;e!=m.EDIT_LINK_SETTINGS&&e!=m.VIEW_LINK_SETTINGS||(t=this.state.previousTab),this.setState({currentScreen:this.state.previousScreen,currentTab:t,previousTab:void 0})},this.onSettingsClick=()=>{g.logTiburonEvent(this.props.contentInfo,this.props.user.id,this.props.sharingInfo.isFolder()?u.TiburonEventName.OpenFolderSettingsModal:u.TiburonEventName.OpenFileSettingsModal),this.setState({currentTab:this.props.sharingInfo.isFolder()?m.FOLDER_SETTINGS:m.FILE_SETTINGS,previousScreen:this.state.currentScreen,currentScreen:i.SETTINGS_SCREEN})},this.onLinkSettingsClick=()=>{let e=m.VIEW_LINK_SETTINGS;this.props.sharingInfo.permissionsObj().canCreateEditLink()&&(e=m.EDIT_LINK_SETTINGS),g.logTiburonEvent(this.props.contentInfo,this.props.user.id,u.TiburonEventName.OpenLinkSettingsModal,{settings_tab:e}),this.setState({currentTab:e,previousScreen:this.state.currentScreen,currentScreen:i.SETTINGS_SCREEN})},this.onLinkSettingsTextClick=e=>{this.setState({previousTab:u.ManageAccessTabName.ManageLinksTab,currentTab:e,previousScreen:this.state.currentScreen,currentScreen:i.SETTINGS_SCREEN})},this.state={open:!0,currentScreen:e.initialScreen?e.initialScreen:i.SHARE_SCREEN,currentTab:e.initialCurrentTab,previousScreen:i.SHARE_SCREEN,previousTab:void 0}}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown,!1);const e=this.getTokenizer();this.props.actionHandler.onShareModalUnmount(e);const t=this.getSpectrumModalElement();t&&t.removeEventListener("keypress",this.preventEventBubbling,!1)}getTokenizer(){return this.refs.content&&this.refs.content.getWrappedComponent()&&this.refs.content.getWrappedComponent().refs.tokenizer}getClient(){return this.props.sharingInfo.isFolder()?new i.FolderShareApiClient({userId:this.props.user.id,isNonUserRelativeContext:this.props.isInContentManager}):new i.FileShareApiClient({userId:this.props.user.id})}getIsPassEnabled(){const e=l.passStore.getPassPermissions(this.props.contentInfo.extras.fileId);return!!e&&e.canReadPresence}isPassInfoLoaded(){return i.fetchingStatusIsComplete(this.props.passFetchingStatus)}shouldRenderMainLoading(){if(this.props.sharingInfo.fetchMetadataStatus()===l.FETCH_METADATA_STATUS.FAIL)return!1;const e=this.props.isLinkMetadataLoaded||!this.props.sharingInfo.shouldFetchLinkMetadata(),t=this.props.sharingInfo.isMetadataLoaded()&&this.props.sharingInfo.areSharingPrefsLoaded(),s=this.props.sharingInfo.hasNonSelfMembers()||this.props.areMembersFullyLoaded,n=!this.getIsPassEnabled()||this.isPassInfoLoaded(),i=this.props.shouldBlockMemberListOnPassLoad&&!n;return!t||!s||i||!e}getFinalUIMode(){return this.props.uiMode===l.MODES.POINTER?l.MODES.POINTER:this.shouldRenderMainLoading()?l.MODES.LOADING:this.shouldRenderShareME()?l.MODES.EVOLUTION:this.props.uiMode}render(){let e;if(e=this.props.sharingInfo.isFolder()?this.props.sharingInfo.folderPolicy():this.props.sharingInfo.filePolicy(),this.state.currentScreen===i.SETTINGS_SCREEN&&e){const t=this.props.actionHandler.getCachedLinkSeenStateInfo();return n.React$1.createElement(Ft,{className:this.spectrumModalClassName,actionHandler:this.props.actionHandler,sharingInfo:this.props.sharingInfo,sharingPrefs:this.props.sharingPrefs,client:this.getClient(),currentTab:this.state.currentTab,currentPolicy:e,folderName:this.props.sharingInfo.name(),isFolder:this.props.sharingInfo.isFolder(),isSharedFolder:this.props.contentInfo.isSharedFolder(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,user:this.props.user,onDismiss:this.handleDismiss,onSuccessSharing:this.props.onSuccessSharing,isLinkVisitor:Re(this.props.user.account_id,t)})}{const e=i.classnames(this.spectrumModalClassName,{"scl-share-modal--overflow-visible":this.getFinalUIMode()===l.MODES.EVOLUTION});return n.React$1.createElement(r.Provider,{value:r.intl},n.React$1.createElement(i.Modal,{"app-element":document.getElementById("embedded-app")||document.body,"aria-label":r.intl.formatMessage({id:"XTD4g+",defaultMessage:"Sharing Modal"}),className:e,"body-class-name":"scl-share-modal-content uxa-modal","body-id":"unified-share-modal",open:this.state.open,width:540,onLoad:this.onModalReady,onRequestClose:this.onModalCloseClick,shouldCloseOnOverlayClick:!0},this.renderModalContent()))}}renderModalContent(){const e=!!(this.props.contentInfo.isFile()?this.props.filePolicy&&this.props.filePolicy.viewer_info_policy:this.props.folderPolicy&&this.props.folderPolicy.viewer_info_policy),t={currentScreen:this.state.currentScreen,headerId:"unified-share-modal-title",isCreatingNewFolder:this.isCreatingNewFolder(),isLimitedTeam:this.props.viewer.team_is_limited,isPassEnabled:this.getIsPassEnabled(),mode:this.getFinalUIMode(),showContentManagerBridge:this.shouldRenderContentManagerBridge(),showPassFileSettings:e,onLinkSettingsClick:this.onLinkSettingsClick,onModalCloseClick:this.onModalCloseClick,onLinkSettingsTextClick:this.onLinkSettingsTextClick,onSettingsClick:this.onSettingsClick,currentTab:this.state.currentTab},s=Object.assign(Object.assign({},this.props),t);return n.React$1.createElement(ji,Object.assign({},s))}shouldRenderContentManagerBridge(e=!1){return!this.props.isInContentManager&&(!!x.GoldenGate.hasContentManagerAndSuperAdmin(this.props.user.id)&&(!!this.props.isTeamSharedFolder||!(!this.props.isFolderInsideTeamFolderTree||!this.props.isUserOnOwnerTeam)&&(e||!this.props.sharingPermissions.canInviteEditor())))}isCreatingNewFolder(){const e=this.props.contentInfo;return e.isFolder()&&!e.extras.exists}shouldRenderShareME(){return this.props.sharingInfo.fetchMetadataStatus()!==l.FETCH_METADATA_STATUS.FAIL&&this.props.sharingInfo.shouldFetchLinkMetadata()}}qi.displayName="ShareModal";const Yi=N.listenToStores(qi,{sharingInfoStore:l.sharingInfoStore,passStore:l.passStore},(e=>{const t=e.actionHandler.getSharingInfo(),s=t.getInitialProps(),{groupSeenStateInfo:n,linkSeenStateInfo:a,presentAccountIds:r,passFetchingStatus:o}=e.actionHandler.getPassInfo();return{sharingInfo:t,actionHandler:e.actionHandler,areMembersFullyLoaded:t.areMembersFullyLoaded(),areSharingPrefsLoaded:t.areSharingPrefsLoaded(),canChangeOptions:t.permissionsObj().canChangeOptions(),canEdit:t.permissionsObj().canEdit(),canRelinquishMembership:t.permissionsObj().canRelinquishMembership(),canShareLink:t.canShareLink(),canUnshareFile:t.permissionsObj().canUnshare(),canUnshareFolder:t.permissionsObj().canUnshare(),canUpdateConfidentiality:t.permissionsObj().canUpdateConfidentiality(),contactsError:t.contactsError(),contentInfo:t.contentInfo(),contentNameMessage:t.contentNameMessage(),contentNameMessageLevel:t.contentNameMessageLevel(),filePolicy:t.filePolicy(),folderPolicy:t.folderPolicy(),guestMembers:Ss(r),groupSeenStateInfo:n,hasDisplayableMembers:t.hasDisplayableMembers(),hasParentSharedFolder:t.hasParentSharedFolder(),initialContentName:s.initialContentName,initialRecipientTokens:t.initialRecipientTokens(),sharingPrefs:t.sharingPrefs(),isConfidentialFolder:t.isConfidentialFolder(),isContentNameFocused:t.isContentNameFocused(),isFolderInsideTeamFolderTree:t.isFolderInsideTeamFolderTree(),isInContentManager:s.isInContentManager,isLinkMetadataLoaded:t.isLinkMetadataLoaded(),isMetadataLoaded:t.isMetadataLoaded(),isOwner:t.isOwner(),isCurrentAccountLoaded:t.isCurrentAccountLoaded(),isTeamSharedFolder:t.isTeamSharedFolder(),isTokenizerEmpty:t.isTokenizerEmpty(),isUserOnOwnerTeam:t.isUserOnOwnerTeam(),linkMembers:(l=a,l?l.map((e=>{const{seen_state_user:{user_id:t,display_name:s,email:n,photo_circle_url:a,sharing_access_type:r},when_last_seen:o}=e;let l=i.ACCESS_LEVEL.READER;return r&&"edit_link_access"===r.type&&(l=i.ACCESS_LEVEL.WRITER),new i.UserMembershipInfo({access_type:l,account:new i.BasicAccount({account_id:t,display_name:s,email:n,email_verified:!0,familiar_name:"",given_name:"",profile_photo_url:a,surname:""}),account_id:t,initials:i.getInitials(s),is_inherited:!1,permissions:Es(),same_team:!0,time_last_seen:o?new Date(1e3*o):null})})):[]),linkMetadata:t.linkMetadata(),linkOnlyReason:t.linkOnlyReason(),memberCounts:t.memberCounts(),memberCountWithRecipients:t.memberCountWithRecipients(),members:t.members(),metadata:t.metadata(),ownerTeam:t.ownerTeam(),passFetchingStatus:o,pendingMemberAction:t.pendingMemberAction(),permissions:t.permissions(),sharingPermissions:t.permissionsObj(),presentAccountIds:i.immutable.exports.Set(r),recipientMessage:t.recipientMessage(),recipientTokens:t.recipientTokens(),shareButtonLabelOverride:s.shareButtonLabelOverride,shareFolderPromise:t.shareFolderPromise(),shouldBlockMemberListOnPassLoad:t.shouldBlockMemberListOnPassLoad(),initialScreen:e.initialScreen,initialCurrentTab:e.initialCurrentTab,teamPolicy:t.teamPolicy(),uiMode:t.uiMode(),user:t.user(),onCancel:s.onCancel,onCreateGroupCallback:t.onCreateGroupCallback(),onDeleteLink:s.onDeleteLink,onSetContentNameAndSendShareFail:s.onSetContentNameAndSendShareFail,onShareClick:s.onShareClick,onSuccessSharing:s.onSuccessSharing,teamGroupInfo:s.teamGroupInfo,viewer:i.Viewer.get_viewer(),focusOnMount:s.focusOnMount,openSettingsFromTheExternalSharePageQuickActions:e.actionHandler.getOpenSettingsFromTheExternalSharePageQuickActions(),creatingApprovalRequest:t.creatingApprovalRequest(),showApproval:s.showApproval,sendApproval:t.sendApproval(),needsAllApprovers:t.needsAllApprovers(),automationOptionChecked:t.automationOptionChecked(),docsendAnalyticsAddOnMetadata:Object.assign({variant:s.docsendAnalyticsAddOn},t.modalInfoState().docsendAnalyticsLink)};var l}));t.Accordion=Oi,t.DropdownMenu=Fs,t.DropdownMenuButton=Ps,t.IntegrationPopoverGroup=be,t.KeyCodes={TAB:9,ENTER:13,SPACE:32},t.MemberRow=Vs,t.Menu=Os,t.MenuItem=Ds,t.ShareModal=Yi,t.ShareModalActionHandler=class{constructor(t,o,c,h,_,E,S){this.groupSeenStateInfo=null,this.linkSeenStateInfo=null,this.presentAccountIds=null,this.hasLoggedSet={},this.setUrl=null,this.hasLoggedApprovalFormShown=!1,this.changeAccess=(e,t,s=!1)=>{let n=Promise.resolve({});const a=e.memberId(),o=this.getContentInfo(),c=o.id,d=this.sharingInfo.isNonUserRelativeContext();if(t===i.MEMBER_ACTION.REMOVE)a!==this.user.account_id||d?n=(o.isFileFolder()?this.client.getParentFolderAccess({contentId:this.sharingInfo.parentSharedFolderId(),memberId:a}):this.removeMember(c,e,s,o.isFolder())).then((t=>{this.showParentFolderAccessModalIfQualified("remove",e,t)})):this.relinquishMembership(c,s);else if(t===i.ACCESS_LEVEL.OWNER)n=this.client.transferContent({contentId:c,memberId:a}).then((()=>{this.dispatch(l.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS),f.sharingNotificationSuccess(r.intl.formatMessage({id:"sAxJWH",defaultMessage:"Made {name} the owner"},{name:e.displayName()})),this.fetchDataAndShowShareModal()}));else{let s;if(o.isFileFolder()&&t===i.ACCESS_LEVEL.READER)s=this.client.getParentFolderAccess({contentId:this.sharingInfo.parentSharedFolderId(),memberId:a,accessLevel:t});else{const n=this.getContentInfo().isFileFolder();n&&this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:e});const a=e.is_inherited&&t===i.ACCESS_LEVEL.READER&&e.inherited_access_type!==i.ACCESS_LEVEL.READER;s=this.shareIfFileFolder(a?void 0:r.intl.formatMessage({id:"xYinYM",defaultMessage:"Updating member access..."})).then((()=>(n&&this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e}),this.changeMemberAccess(this.getContentInfo().id,e,t)))).catch((t=>{this.reportShareFailure(t),n&&this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e})}))}n=s.then((t=>{this.fetchInitialData(),this.handleShowUpdatedMembers(e,t)}))}return n.then(this.refreshSharedWithColumnContentData)},this.handleShowUpdatedMembers=(e,t)=>{this.isMemberAccessLevelQualified(t)?(this.showParentFolderAccessModal("update",e,t),i.Snackbar.close()):i.Snackbar.complete(r.intl.formatMessage({id:"x5Je3g",defaultMessage:"Member access updated."}),"sharing-notification")},this.changeRecipientAccess=e=>s.__awaiter(this,void 0,void 0,(function*(){this.dispatch(l.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS,{newAccess:e}),yield this.validateContacts(this.getSharingInfo().recipientTokens())})),this.changeLinkRecipientAccess=e=>s.__awaiter(this,void 0,void 0,(function*(){this.dispatch(l.ShareModalActionTypes.CHANGE_LINK_RECIPIENT_ACCESS,{newAccess:e})})),this.changeEmailRecipientAccess=e=>s.__awaiter(this,void 0,void 0,(function*(){this.dispatch(l.ShareModalActionTypes.CHANGE_EMAIL_RECIPIENT_ACCESS,{newAccess:e}),yield this.validateContacts(this.getSharingInfo().recipientTokens())})),this.changeRecipientMessage=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE,{message:e})},this.appendToRecipientMessage=e=>{this.dispatch(l.ShareModalActionTypes.APPEND_TO_RECIPIENT_MESSAGE,{messageToAppend:e})},this.changeCreateCommentCheckbox=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_CREATE_COMMENT_CHECKBOX,{checked:e})},this.logShownApprovalForm=()=>{var e;this.hasLoggedApprovalFormShown||(this.hasLoggedApprovalFormShown=!0,null===(e=this.approvalClient)||void 0===e||e.logger.logShownRequestForm(this.sharingInfo.contentId().toString(),"share_modal"))},this.toggleAutomationOption=()=>{this.sharingInfo.automationOptionChecked()?y.PapLogger.logDeselectAutoFolderSetupCheckbox({actionSurface:"share_modal"}):y.PapLogger.logSelectAutoFolderSetupCheckbox({actionSurface:"share_modal"}),this.dispatch(l.ShareModalActionTypes.TOGGLE_OPEN_AUTOMATIONS)},this.toggleSendApproval=()=>{this.dispatch(l.ShareModalActionTypes.TOGGLE_SEND_APPROVAL)},this.changeNeedsAllApprovers=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_NEEDS_ALL_APPROVERS,{needsAllApprovers:e})},this.createApproval=e=>s.__awaiter(this,void 0,void 0,(function*(){var t,s;if(!this.approvalClient)return;const n="flows-approval-snackbar",a=this.getSharingInfo().getInitialProps(),o=this.sharingInfo.contentId().toString(),c=this.sharingInfo.recipientTokens(),d=c.length,h=this.sharingInfo.needsAllApprovers(),p=this.sharingInfo.recipientMessage(),m=this.sharingInfo.recipientAccess();if(i.Snackbar.sync(r.intl.formatMessage({id:"rfZeo4",defaultMessage:"Sharing file and sending approval {numApprovers, plural, one {email} other {emails}}..."},{numApprovers:d}),!0,n),this.dispatch(l.ShareModalActionTypes.CREATE_APPROVAL_REQUEST),yield this.recipientsChange(e.getContacts()),yield this.validateContacts(this.sharingInfo.recipientTokens()),this.sharingInfo.contactsError().level===g.ContactsErrorLevel.Error)return void this.log(u.TiburonEventName.FailInbandShare,{error_message:void 0,error_tag:"contacts_error"});let f="";try{this.approvalClient.logger.logSubmitApprovalRequest({actionSurface:"share_modal",approvalDetailsLength:p.length,entryPoint:this.getContentInfo().extras.origin,fileId:o,numApprovers:c.length,requiresAll:h});const{comment_id:e}=yield this.approvalClient.createApproval(o,p,c.map((({email:e})=>({email:e}))),h);this.approvalClient.logger.logSubmitApprovalSuccess(o,"share_modal",p.length,JSON.stringify(c.map((({dbx_account_id:e})=>e))),h,c.length,e),this.dispatch(l.ShareModalActionTypes.CREATE_APPROVAL_SUCCESS)}catch(e){f=(null===(t=e.error)||void 0===t?void 0:t[".tag"])||"unknown",i.Snackbar.fail(r.intl.formatMessage({id:"NvrwMd",defaultMessage:"Couldn't share file or send approval request."},{numApprovers:d}),n),this.approvalClient.logger.logSubmitApprovalFailure({actionSurface:"share_modal",fileId:o,errorReason:f}),this.dispatch(l.ShareModalActionTypes.CREATE_APPROVAL_FAILURE)}if(f)return;let _=!1;try{yield this.sendShare(e,{keepModalOpen:!1,suppressAllSnackbars:!0,suppressSuccessSnackbar:!0,suppressNotifications:!0})}catch(e){m!==i.ACCESS_LEVEL.READER&&(_=!0)}null===(s=a.onCreateApprovalSuccess)||void 0===s||s.call(a),_?i.Snackbar.fail(r.intl.formatMessage({id:"8l0aUb",defaultMessage:"Sent approval request, but couldn't share the file with edit access."},{numApprovers:d}),n):i.Snackbar.complete(r.intl.formatMessage({id:"l4nAAD",defaultMessage:"File shared and approval request sent."}),n)})),this.enableNamespaceCreation=e=>this.getContentInfo().isFileFolder()&&"editor"===e&&this.getSharingInfo().fetchMetadataStatus()!==l.FETCH_METADATA_STATUS.FAIL,this.createNamespaceIfNeeded=(e,t)=>{if(!this.enableNamespaceCreation(e))return Promise.resolve({});if(void 0===t)return Promise.resolve({});if(this.sharingInfo.shareFolderPromise())return this.sharingInfo.shareFolderPromise();let s;return null!=this.sharingInfo.shouldSyncThisFolder()&&(s=this.sharingInfo.shouldSyncThisFolder()?"default":"not_synced"),this.shareFolderSimple(this.getFqPath(),this.sharingInfo.shareAsConfidential(),s)},this.getCreateSharedLinkTTI=e=>Date.now()-e,this.buildExtraFieldForCreateSharedLinkEvents=(e,t,s)=>({is_alpha:!0,access:s,include_ns_creation:e,timing:this.getCreateSharedLinkTTI(t)}),this.createSharedLink=(e,t,s)=>{const n=Date.now(),o=this.enableNamespaceCreation(e),c=e||"viewer";this.log(u.TiburonEventName.ClickTibCreateLink),this.log(u.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:c}),this.dispatch(l.ShareModalActionTypes.CREATE_LINK_REQUEST),"editor"===e?i.Snackbar.sync(r.intl.formatMessage({id:"OvEApa",defaultMessage:"Creating edit link..."}),!1,"sharing-notification"):i.Snackbar.sync(r.intl.formatMessage({id:"8PPImn",defaultMessage:"Creating view link..."}),!1,"sharing-notification");const d={};e&&(d.access=e),t&&(d.audience=t);const h=this.getContentInfo(),p=h.fileId()||h.displayPath();return this.client.createSharedLink({fileIdOrPath:p,settings:d}).then((t=>{var a;this.dispatch(l.ShareModalActionTypes.CREATE_LINK_SUCCESS,{linkMetadata:t}),this.refreshSharedWithColumnLinkData(),this.log(u.TiburonEventName.SucceedCreateSharedLinkWithSettings,Object.assign(Object.assign({http_status_code:200,response_status:"success"},this.buildExtraFieldForCreateSharedLinkEvents(o,n,c)),k.buildExtraFromLinkMetadata(t))),g.trackUserLeapEvent(g.SharingUserLeapEvent.SHARE_LINK_CREATE_SUCCESS,i.SHARE_ACTION_ORIGIN_TYPE.SHARE_LINK_MODAL);const d=this.getSharingInfo().modalInfoState().recipientAccess,h=d?d===i.ACCESS_LEVEL.WRITER?"editor":"viewer":e,p=e!==h;s===l.LINK_CREATION_SURFACE.COPY_OR_CREATE_LINK_SECTION&&ps()&&!p||("editor"===e?i.Snackbar.complete(r.intl.formatMessage({id:"JtONmB",defaultMessage:"Edit link created."}),"sharing-notification"):i.Snackbar.complete(r.intl.formatMessage({id:"ufl8ka",defaultMessage:"View link created."}),"sharing-notification")),(null===(a=this.getSharingInfo().sharingPrefs())||void 0===a?void 0:a.efl_delay_ns_creation_to_receiver_enabled)||this.createNamespaceIfNeeded(e,t).catch((t=>{this.log(u.TiburonEventName.FailCreateNamespaceAfterLinkCreated,{http_status_code:t.raw&&t.raw.status,error_tag:t.error&&t.error[".tag"]||"undefined_error",error_summary:t&&t.summary,access:e})}))})).catch(a.catchApiError((e=>(e instanceof a.AppError&&e.error&&"access_denied"===e.error[".tag"]?this.getContentInfo().isFolder()?f.sharingNotificationError(r.intl.formatMessage({id:"/ivxG2",defaultMessage:"You don’t have permission to create a link to this folder"})):f.sharingNotificationError(r.intl.formatMessage({id:"p1EB+W",defaultMessage:"You don’t have permission to create a link to this file"})):this.showStandardError(e),e.error&&"shared_link_already_exists"===e.error[".tag"]?this.log(u.TiburonEventName.SucceedCreateSharedLinkWithSettings,Object.assign({http_status_code:e.raw&&e.raw.status,response_status:"success"},this.buildExtraFieldForCreateSharedLinkEvents(o,n,c))):this.log(u.TiburonEventName.FailCreateSharedLinkWithSettings,Object.assign({http_status_code:e.raw&&e.raw.status,error_tag:e.error&&e.error[".tag"]||"undefined_error",error_summary:e&&e.summary,fail_at:"link_creation"},this.buildExtraFieldForCreateSharedLinkEvents(o,n,c))),this.dispatch(l.ShareModalActionTypes.CREATE_LINK_FAILURE),Promise.reject(e)))))},this.fetchMetadataForFile=e=>l.SharingActions.loadFileMetadata({user:this.user,contentId:e.id,sourceUrl:e.url(),client:this.client}).catch(a.catchApiError((t=>{this.handleLoadingError(t,e)}))),this.fetchMetadataForFileFolder=e=>{const t=i.MEMBER_ACTION.ALL,n=i.VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE,r={actions:Object.keys(n),listMembersArg:{actions:t},shouldParseMetadataFromError:!0};let o,l;const c=!!this.sharingInfo.isNonUserRelativeContext();return c&&!this.user.is_cdm_member?(o=e=>s.__awaiter(this,void 0,void 0,(function*(){const t=this.contentManagerValidateFolderPath(e);return this.client.validatePathContinue(t,!1)})),l={nsId:e.nsId(),nsPath:e.nsPath()}):(o=this.client.validateFqPath,l={fqPath:e.displayPath(),shareAsConfidential:this.sharingInfo.shareAsConfidential()}),o(Object.assign(Object.assign({},l),r)).then((({metadata:e,inheritedMembers:t})=>{this.handleGetMetadataSuccess(e);const s=this.getContentInfo();this.listMembers({contentId:s.id,url:s.url(),members:s.isFileFolder()&&t||void 0,isNonUserRelativeContext:c})})).catch(a.catchApiError((t=>{this.handleLoadingError(t,e)})))},this.fetchMetadataForSharedFolder=e=>this.client.getMetadata({contentId:e.id,isInSharedFolder:e.isInSharedFolder(),actions:Object.keys(i.ALPHA_FOLDER_METADATA_PERMISSIONS)}).then(this.handleGetMetadataSuccess).catch(a.catchApiError((t=>{this.handleLoadingError(t,e)}))),this.handleSetConfidentialClick=(e,t)=>{i.Modal$1.showInstance(n.React$1.createElement(Vt,{actionHandler:this,initialIsConfidentialFolder:e,contentInfo:this.getContentInfo(),teamName:t,onCancel:this.openShareModal,userId:this.user.id}))},this.handleInheritedMemberAccessChange=(e,t,s,a)=>{const r=this.getContentInfo(),o=this.getSharingInfo();i.Modal$1.showInstance(n.React$1.createElement(Gt,{actionHandler:this,member:e,teamName:t,userId:this.user.id,isSharedFolder:r.isSharedFolder(),parentFolderName:o.parentFolderName(),currentFolderName:o.name(),isUserSelf:e.memberId()===this.user.account_id,isDowngrading:s,newAccessLevel:a}))},this.handleMemberAccessChange=(e,t)=>{const s=e.displayName();if(t===i.MEMBER_ACTION.REMOVE||t===i.ACCESS_LEVEL.OWNER){const a=t===i.MEMBER_ACTION.REMOVE&&e.memberId()===this.user.account_id,o=this.getContentInfo().isFolder(),l=this.getContentInfo().isNestedSharedFolder(),c=e.permissions.leave_a_copy&&e.permissions.leave_a_copy.allow,h=s=>{this.changeAccess(e,t,!0===s)},p=this.openManageAccessModal,m=()=>{i.Modal$1.close(void 0,Fe)},u=this.getSharingInfo().parentFolderName(),g=this.getSharingInfo().isConfidentialFolder(),f=e.type()===i.MembershipType.GROUPS,_=this.getSharingInfo().isNonUserRelativeContext(),E=this.getSharingInfo().isFolderInsideTeamFolderTree(),S=t===i.MEMBER_ACTION.REMOVE&&e.is_inherited;a?d.showRelinquishMembershipConfirmationModal(o,l,h,p,c,g):S&&o&&!E?this.changeAccess(e,t):function(e="",t,s,a,o=!1,l,c,h=!1,p,m,u=!1){let g,f,_,E,S;const M=i.Emstring.em_snippet(e,40);let k=null;t===i.MEMBER_ACTION.REMOVE?(_=r.intl.formatMessage({id:"sIVZG2",defaultMessage:"Remove {name}?"},{name:M}),s?(g=a&&!h?m?r.intl.formatMessage({id:"ru4Qhg",defaultMessage:"If you remove <strong>{name}</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access <strong>{parentname}</strong> will still be able to access this folder."},{strong:e=>n.React$1.createElement("strong",null,e),name:M,parentname:m}):r.intl.formatMessage({id:"8rlotY",defaultMessage:"If you remove <strong>{name}</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access the parent folder will still be able to access this folder."},{strong:e=>n.React$1.createElement("strong",null,e),name:M}):r.intl.formatMessage({id:"03tbWi",defaultMessage:"If you remove <strong>{name}</strong>, they won’t be able to see future changes to this shared folder."},{strong:e=>n.React$1.createElement("strong",null,e),name:M}),o&&(k=r.intl.formatMessage({id:"RB9i4M",defaultMessage:"Let {name} keep a copy of this shared folder"},{name:M}))):(g=u?r.intl.formatMessage({id:"D0n7tP",defaultMessage:"Keep in mind, if group members have a shared link to this file, they might still be able to view or edit it."}):r.intl.formatMessage({id:"nAwKbF",defaultMessage:"Keep in mind, if they have a shared link to this file, they might still be able to view or edit it."}),E=r.intl.formatMessage({id:"S+RxKh",defaultMessage:"More about links"}),S=()=>i.open_tab("https://help.dropbox.com/files-folders/share/remove-link")),f=r.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"})):(p?(_=r.intl.formatMessage({id:"Px//wf",defaultMessage:"Make {name} the owner of this folder and all contained files and folders?"},{name:M}),g=r.intl.formatMessage({id:"gek9SL",defaultMessage:"Settings for this folder will now be managed by {name}. Keep in mind, if they’re not on your Dropbox team, you won’t be able to manage this folder here anymore."},{name:M})):(_=r.intl.formatMessage({id:"khEZSl",defaultMessage:"Make {name} the owner of this folder?"},{name:M}),g=r.intl.formatMessage({id:"y7GDnJ",defaultMessage:"{name} will become the owner of all items in this folder. Only they will be able to unshare or change folder settings."},{name:M})),f=r.intl.formatMessage({id:"+ZJXxL",defaultMessage:"Make owner"}));i.Modal$1.showInstance(n.React$1.createElement(d.ConfirmWithOptionModal,{autoClose:!1,confirmText:f,cancelText:r.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),link:E,onConfirm:l,onCancel:c,onClickLink:S,optionLabel:k,showOption:null!=k,title:_},g),!0,Fe)}(s,t,o,l,c,h,m,g,_,u,f)}else this.changeAccess(e,t)},this.handleGetMetadataSuccess=e=>{this.dispatch(l.ShareModalActionTypes.FETCH_METADATA_SUCCESS,{metadata:e}),i.dispatcherSingleton.dispatch({type:p.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:this.user})},this.handleLinkSettingsClick=(e={isLinkOnly:!0,linkAccessLevel:"viewer"})=>{i.TeamsWebActionsLogger.log("open_link_settings_modal");let t,s=m.VIEW_LINK_SETTINGS;"editor"===e.linkAccessLevel&&(s=m.EDIT_LINK_SETTINGS),this.log(u.TiburonEventName.OpenLinkSettingsModal,{settings_tab:s}),e.isLinkOnly||(t=this.sharingInfo.isFolder()?this.sharingInfo.folderPolicy():this.sharingInfo.filePolicy()),i.Modal$1.showInstance(n.React$1.createElement(Ft,{actionHandler:this,sharingInfo:this.sharingInfo,sharingPrefs:this.sharingInfo.sharingPrefs(),client:this.client,currentTab:s,currentPolicy:t,folderName:this.sharingInfo.name(),isFolder:this.sharingInfo.isFolder(),isSharedFolder:this.getContentInfo().isSharedFolder(),isFolderInsideTeamFolderTree:this.sharingInfo.isFolderInsideTeamFolderTree(),isInContentManager:this.getSharingInfo().isNonUserRelativeContext(),isTeamSharedFolder:this.sharingInfo.isTeamSharedFolder(),isUserOnOwnerTeam:this.sharingInfo.isUserOnOwnerTeam(),linkMetadata:this.sharingInfo.linkMetadata(),onDismiss:()=>i.Modal$1.close(),permissions:this.sharingInfo.permissions(),ownerTeam:this.sharingInfo.ownerTeam(),user:this.user,isLinkVisitor:Re(this.user.account_id,this.linkSeenStateInfo)}))},this.handleLoadingError=(e,t)=>{var s,n,o;if(e instanceof a.AppError){if("not_a_member"===(null===(s=e.error)||void 0===s?void 0:s[".tag"])||"no_access"===(null===(n=e.error)||void 0===n?void 0:n[".tag"]))f.sharingNotificationError(r.intl.formatMessage({id:"O4CWz2",defaultMessage:"You don’t have permission to share this folder"})),i.Modal$1.close();else if("invalid_id"===(null===(o=e.error)||void 0===o?void 0:o[".tag"]))f.sharingNotificationError(r.intl.formatMessage({id:"4GGEvb",defaultMessage:"This folder can’t be shared"})),i.Modal$1.close();else if(e.error&&e.error.too_many_mounts&&t.isFolder()&&!t.extras.exists){const t=g.NSF_HELP_ARTICLE_LINK;(e.error.too_many_mounts[".tag"]===l.NS_LIMIT_ERROR.TOTAL_MOUNTS_EXCEEDED||e.error.too_many_mounts[".tag"]===l.NS_LIMIT_ERROR.HOME_MOUNTS_EXCEEDED||e.error.too_many_mounts[".tag"]===l.NS_LIMIT_ERROR.TREE_SIZE_EXCEEDED)&&f.failSnackbarWithHelpCenter(g.namespaceLimitExceededFailCreateSharedFolderSnackbarMsg(e),t),i.Modal$1.close()}const a=e.error&&e.error.bad_path&&e.error.bad_path[".tag"],c=e.error&&e.error.too_many_mounts&&e.error.too_many_mounts[".tag"];this.dispatch(l.ShareModalActionTypes.FETCH_METADATA_FAILURE,{reason:a||c,countExceedNsLimit:c&&g.getExceededCountInfo(e)})}else this.showStandardError(e),i.Modal$1.close()},this.handleSetConfidential=(e,t=!1)=>{const s=this.getContentInfo(),n=s.isSharedFolder()?s.sharedFolderId().toString():void 0,r=e=>(this.handleGetMetadataSuccess(e),e),o=(e,t,s)=>this.client.setConfidentiality({contentId:e,confidential:t,keepInheritedMembers:s}).then(r);return n?o(n,e,t):this.client.share({fqPath:this.getFqPath(),confidential:e}).then(r).catch((s=>{if(s instanceof a.AppError&&s.error&&s.error.bad_path&&"already_shared"===s.error.bad_path[".tag"]){const n=i.folderMetadataApiToRecord(s.error.bad_path);this.handleGetMetadataSuccess(n);const a=this.getContentInfo().sharedFolderId();return o(a.toString(),e,t)}return Promise.reject(s)}))},this.openShareModal=()=>{i.Modal$1.showInstance(fs(this.shareModalClass,{actionHandler:this}))},this.openSharingSettingsModal=e=>{i.Modal$1.showInstance(fs(this.shareModalClass,{actionHandler:this,initialScreen:i.SETTINGS_SCREEN,initialCurrentTab:e}))},this.showScreen=(e,t)=>{switch(e){case i.SHARE_SCREEN:this.openShareModal();break;case i.SETTINGS_SCREEN:{const e=this.getSharingInfo().isFolder()?m.FOLDER_SETTINGS:m.FILE_SETTINGS,s=t||e;this.openSharingSettingsModal(s);break}case i.MANAGE_SCREEN:this.openManageAccessModal();break;default:this.openShareModal()}},this.openManageAccessModal=()=>{i.Modal$1.showInstance(fs(this.shareModalClass,{actionHandler:this,initialScreen:i.MANAGE_SCREEN}))},this.recipientsChange=(e,t="")=>Promise.resolve({}).then((()=>this.dispatch(l.ShareModalActionTypes.CHANGE_RECIPIENTS,{recipientTokens:e,recipientRawInput:t}))).then((()=>this.validateContacts(e))),this.redirectToPath=(t,s)=>{if(null!=this.setUrl&&this.getSharingInfo().getInitialProps().content&&this.getSharingInfo().fqPath()){const n=t=>{s&&new Promise((function(t,s){e(["./c_sharing_share_modal_util"],t,s)})).then((({showShareModal:e})=>e(this.user,t,{origin:i.SHARE_ACTION_ORIGIN_TYPE.PARENT_FOLDER_MODAL},this.setUrl)))};if(t!==this.getSharingInfo().fqPath()){const e=i.browse_uri_for_fq_path(this.user,t);e.updateQuery({[i.BrowseQueryArg.share_manage_access]:"true"}),i.browserRedirectWrapper(e,!0)}else n(this.getSharingInfo().getInitialProps().content)}else{const e=i.browse_uri_for_fq_path(this.user,t);s&&e.updateQuery({shareoptions:"1"}),i.browserRedirectWrapper(e,!0)}},this.refreshSharedWithColumnContentData=()=>{if(this.getContentInfo().isFolder())i.getStoreForSharedWith().dispatch(i.sharedFolderDataOutOfDate());else{const e=[this.getContentInfo().id.toString()];i.getStoreForSharedWith().dispatch(i.sharedFileDataOutOfDate(e))}},this.shareIfFileFolder=(e,t)=>{if(this.getSharingInfo().shouldCloseImmediately()?i.Modal$1.close():null!=e&&i.Snackbar.sync(e,!0,"sharing-notification"),!this.getContentInfo().isFileFolder())return Promise.resolve({});if(this.sharingInfo.shareFolderPromise())return this.sharingInfo.shareFolderPromise();let s;return null!=this.sharingInfo.shouldSyncThisFolder()&&(s=this.sharingInfo.shouldSyncThisFolder()?"default":"not_synced"),this.shareFolderSimple(this.getFqPath(),this.sharingInfo.shareAsConfidential(),s,t)},this.reportShareFailure=e=>{e instanceof a.RateLimitError?f.failSnackbarWithHelpCenter(r.intl.formatMessage({id:"/sRvdA",defaultMessage:"Folder updates in progress — please try again later."}),"/help/9259"):e instanceof a.AppError&&"too_many_files"===e.error[".tag"]?f.failSnackbarWithHelpCenter(r.intl.formatMessage({id:"Js1Gcw",defaultMessage:"Couldn’t share. If this folder has a lot of files, try sharing fewer files."}),"/support",g.getContactSupportMessage()):e instanceof a.AppError&&"internal_error"===e.error[".tag"]?f.failSnackbarWithHelpCenter(r.intl.formatMessage({id:"7/f5Vp",defaultMessage:"Couldn’t share, but it might work if you reload the page and try again."}),"/support",g.getContactSupportMessage()):g.isTotalMountsExceededError(e)||g.isTreeSizeExceededError(e)||g.isHomeMountsExceededError(e)?f.failSnackbarWithHelpCenter(g.namespaceLimitExceededFailCreateSharedFolderSnackbarMsg(e),g.NSF_HELP_ARTICLE_LINK):i.Snackbar.fail(g.convertIfHTML(g.genAddMemberErrorMessage(e)),"sharing-notification")},this.showParentFolderAccessModalIfQualified=(e,t,s)=>{this.isMemberAccessLevelQualified(s)&&this.showParentFolderAccessModal(e,t,s)},this.showParentFolderAccessModal=(e,t,s)=>{this.log(u.TiburonEventName.OpenParentFolderAccessModal,{num_parent_folders:s.parentFolders&&s.parentFolders.length||0}),i.Modal$1.showInstance(n.React$1.createElement(Ot,{contentInfo:this.getContentInfo(),memberAccessLevelResult:s,memberDisplayName:t.displayName()||"",originalAction:e,isInContentManager:this.sharingInfo.isNonUserRelativeContext(),onClose:this.openShareModal,onParentFolderClicked:this.redirectToPath}))},this.parseParentFolderAccessError=e=>{let t=e.error;if("member_error"===e.error[".tag"]&&(t=e.error.member_error),"no_explicit_access"===t[".tag"])return i.memberAccessLevelApiToRecord(this.user.id,t);this.showStandardError(e)},this.changeLinkAudienceSelection=(e,t)=>{this.dispatch(l.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SELECTION,{accessLevel:e,audience:t})},this.removeLinkAudienceSelection=e=>{this.dispatch(l.ShareModalActionTypes.REMOVE_LINK_AUDIENCE_SELECTION,{accessLevel:e})},this.updateLinkAudience=(e,t)=>{const s=Ae(e).set("audience",t),n=Ae(e),i=Le(e,s,n);return i&&i.settings?(this.log(u.TiburonEventName.ChangeSharedLinkAudience,Object.assign({old_audience:n.audience,new_audience:t,screen:u.ScreenName.ShareScreen},k.buildExtraFromLinkMetadata(e))),this.updateLinkSettings([i])):Promise.reject(`Error getting modified settings for audience ${t}`)},this.updateLinkSettings=e=>Promise.all(e.map((e=>this.client.modifySharedLinkSettings(e)))).then((e=>{f.sharingNotificationSuccess(r.intl.formatMessage({id:"8TOykk",defaultMessage:"Settings saved."}));const t=[];for(const s of this.sharingInfo.sharedLinks()){const n=e.find((e=>(s.link_permissions.link_access_level||"viewer")===(e.link_permissions.link_access_level||"viewer")));t.push(n||s)}this.setSharedLinks(t),this.refreshSharedWithColumnLinkData()})).catch((()=>(f.sharingNotificationError(r.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."})),Promise.reject()))),this.waitForAllMembersLoaded=()=>{if(this.sharingInfo.areMembersFullyLoaded())return Promise.resolve({});const e=this.sharingInfo.fetchingMembersRequest();return e&&e.promise||Promise.resolve({})},this.onPageNavigationAttempt=e=>{if(_s.size>0)return this.log(u.TiburonEventName.AttemptNavigateAwayDuringShare),e.preventDefault(),e.returnValue="",""},this.onPageNavigationAway=e=>{_s.size>0&&this.log(u.TiburonEventName.SucceedNavigateAwayDuringShare)},this.getShopModalPrereqs=()=>{const e=this.getContentInfo();let t={},s=!1;return e.isFile()&&e.name()&&(t=g.getShopModalCtx(e,this.getSharingInfo().getReferrer()),s=i.hasEventInHistory(i.CampaignEvents.SHARE_MODAL_SETTINGS_OPENED,t)),{contextData:t,shouldShowShopModal:s}},this.client=t,this.asyncContactValidator=new Kt(this.client),this.user=o,this.shareModalClass=c,this.setUrl=h||null,this.contentManagerValidateFolderPath=_,this.openSettingsFromTheExternalSharePageQuickActions=E,this.approvalClient=S}initializeShareModal(e,t={}){const s=e.contentInfo;return i.dispatcherSingleton.dispatch({type:l.ShareModalActionTypes.SHARE_MODAL_OPEN,data:{initialProps:t,shareModalInfoAttrs:e},contentIds:l.getContentIdsForContentInfo(s),user:this.user}),this.sharingInfo=l.sharingInfoStore.getSharingInfo(this.user.id,s.id),this.fetchInitialData()}fetchDataAndShowShareModal(){this.fetchInitialData(),this.openShareModal()}fetchInitialData(){const e=this.sharingInfo.contentInfo(),t=this.sharingInfo.isNonUserRelativeContext();this.beginTime=Date.now(),this.isSendForSignatureEnabled=T.isSendForSignatureEnabled(this.getIntegrationStoreState(this.user.id)),this.fetchPassInfo();const s=[];return e.isFileFolder()?s.push(this.fetchMetadataForFileFolder(e)):(s.push(this.listMembers({contentId:e.id,url:e.url(),isNonUserRelativeContext:t})),e.isFile()?s.push(this.fetchMetadataForFile(e)):e.isSharedFolder()&&s.push(this.fetchMetadataForSharedFolder(e))),s.push(this.fetchMemberCounts()),s.push(this.fetchCurrentAccount()),s.push(this.fetchSharingPrefs()),this.sharingInfo.shouldFetchLinkMetadata()&&s.push(this.fetchLinkMetadata()),this.shouldFetchDocsendAnalyticsLink()&&s.push(this.fetchDocsendAnalyticsLink()),Promise.all(s)}fetchPassInfo(){this.sharingInfo.shouldBlockMemberListOnPassLoad()&&setTimeout((()=>this.dispatch(l.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD)),4e3);const{shouldFetchPass:e,fileId:t}=this.getPassFetchingInfo();if(!e||!t)return;this.clearCachedPassInfo();const s=l.passStore.passFetchingStatus(t);if(i.fetchingStatusIsSuccessful(s)){const{groupSeenStateInfo:e,linkSeenStateInfo:s}=l.passStore.getLinkAndGroupSeenStateInfo(t);this.groupSeenStateInfo=e,this.linkSeenStateInfo=s,this.presentAccountIds=l.passStore.presence(t)}else s===i.PassFetchingStatus.NOT_YET_KNOWN&&l.PassHelpers.setup({user:this.user,fileData:this.getFileData(),prevFileData:null,shouldWritePresence:!1,skipSharingEndpoints:!0})}getIntegrationStoreState(e){return i.initStoreForIntegration(e).getState()}getAsyncContactValidator(){return this.asyncContactValidator}getSharingInfo(){return this.sharingInfo}clearCachedPassInfo(){[this.groupSeenStateInfo,this.linkSeenStateInfo,this.presentAccountIds]=[null,null,null]}getPassInfo(){const e=this.getContentInfo();if(e.isFolder())return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.ERROR};if(this.groupSeenStateInfo&&this.linkSeenStateInfo&&this.presentAccountIds)return{groupSeenStateInfo:this.groupSeenStateInfo,linkSeenStateInfo:this.linkSeenStateInfo,presentAccountIds:this.presentAccountIds,passFetchingStatus:i.PassFetchingStatus.PASS_SUCCESS};{const t=this.getPassFetchingInfo().fileId;if(!t)return[this.groupSeenStateInfo,this.presentAccountIds]=[{},[],[]],{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.ERROR};const s=l.passStore.getPassPermissions(t),n=l.passStore.passFetchingStatus(t);if(!i.fetchingStatusIsComplete(n))return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.FETCHING};if(null==s||!s.canReadPresence)return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.ERROR};const{linkSeenStateInfo:a,groupSeenStateInfo:r}=l.passStore.getLinkAndGroupSeenStateInfo(t);return this.linkSeenStateInfo=a,this.groupSeenStateInfo=r,this.presentAccountIds=[...l.passStore.presence(t)||[]],this.isContentInfoForFilePreview(e)&&this.presentAccountIds.indexOf(this.user.account_id)<0&&this.presentAccountIds.push(this.user.account_id),{groupSeenStateInfo:this.groupSeenStateInfo,linkSeenStateInfo:this.linkSeenStateInfo,presentAccountIds:this.presentAccountIds,passFetchingStatus:n}}}getCachedLinkSeenStateInfo(){var e;return null!==(e=this.linkSeenStateInfo)&&void 0!==e?e:[]}getPassFetchingInfo(){const e=this.getContentInfo();if(e.extras.origin&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW","PREVIEW_PAGE","PREVIEW_PAGE_FACEPILE","PAPER_INTEGRATION","GOOGLE_DSS"].indexOf(e.extras.origin)>=0&&e.isFile()){const{fileId:t}=e.extras,s=this.isContentInfoForFilePreview(e);return{shouldFetchPass:!!t&&!s&&e.isFile(),fileId:t}}return{shouldFetchPass:!1}}getUrl(){const e=this.sharingInfo.linkMetadata();return e?e.url:void 0}getFileData(e){const{fileId:t=null}=this.getPassFetchingInfo();return{file:{file_id:t},url:e}}getContentInfo(){return this.sharingInfo.contentInfo()}getOpenSettingsFromTheExternalSharePageQuickActions(){return this.openSettingsFromTheExternalSharePageQuickActions}dispatch(e,t={}){i.dispatcherSingleton.dispatch({type:e,data:t,contentIds:[this.getContentInfo().id],user:this.user})}changeMemberAccessSimple(e,t,s){return this.client.updateMember({contentId:e,memberId:t,accessLevel:s})}changeMemberAccess(e,t,s){const n=t.access_type;return this.log(u.TiburonEventName.SelectChangeMemberPermission,{new_access:s,old_access:n}),this.dispatch(l.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:s}),this.changeMemberAccessSimple(e,t.memberId(),s).then((e=>{if(this.log(u.TiburonEventName.SucceedChangeMemberPermission,{http_status_code:200,response_status:"success",is_alpha:!1}),e.access_level&&e.warning)return this.dispatch(l.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:e.access_level}),e})).catch(a.catchApiError((e=>{const s=e.error&&e.error[".tag"];return this.log(u.TiburonEventName.FailChangeMemberPermission,{http_status_code:e.raw&&e.raw.status,error_tag:s||"undefined",is_alpha:!1}),this.dispatch(l.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:n}),this.parseParentFolderAccessError(e)})))}_constructSearchResults(e){return e.map((e=>{if("group_id"in e)return new i.Contact({type:i.ContactTypes.NEW_STYLE_GROUP,group_id:e.group_id,name:e.name,members:e.members,on_team:e.dbx_team_id===this.user.team_dbtid,group_size:e.group_size});if("dbx_account_id"in e)return new i.Contact({type:i.ContactTypes.EMAIL,dbx_account_id:e.dbx_account_id,dbx_team_id:e.dbx_team_id,name:e.name,email:e.email,photo_url:e.photo_url,on_team:e.dbx_team_id===this.user.team_dbtid});throw new Error("Could not parse contact result.")}))}suggestTargets(e,t){return this.client.targetsSearch(e,t).then((e=>{this.log(u.TiburonEventName.AttemptTargetSearch);const t=this._constructSearchResults(e.entries);return this.log(u.TiburonEventName.SucceedTargetSearch),t})).catch(a.catchApiError((e=>{t&&t.aborted||(this.log(u.TiburonEventName.AttemptTargetSearch),this.log(u.TiburonEventName.FailTargetSearch,{error:e.message}),this.showStandardError(e))}))).catch((e=>{this.log(u.TiburonEventName.FailTargetSearch,{error:e.message})}))}validateContacts(e){return s.__awaiter(this,void 0,void 0,(function*(){return yield this._validateContacts(e,!1)}))}resetContactValidations(){return s.__awaiter(this,void 0,void 0,(function*(){return yield this._validateContacts(this.getSharingInfo().recipientTokens(),!0)}))}_validateContacts(e,t=!1){return s.__awaiter(this,void 0,void 0,(function*(){const s=this.getSharingInfo(),n=s.recipientAccess(),i=s.recipientValidation()[n]||{},a=t?e:e.filter((e=>!i[e.getKey()]));if(0===a.length)return;let r={};if(s.sharingPrefs().in_server_side_contact_validation_settings){const e=s.contentInfo(),t=e.isFileFolder()?this.getFqPath():String(e.id);r=yield this.getAsyncContactValidator().validate(this.user.id,t,e,s.recipientAccess(),a)}else r=this.localValidation(a);this.dispatch(l.ShareModalActionTypes.UPDATE_RECIPIENT_VALIDATION,{recipientValidation:{[n]:r},resetCurrentValidations:t})}))}localValidation(e){const t=this.getSharingInfo(),s={};return e.forEach((e=>s[e.getKey()]=g.validateContact(e,this.user,t.ownerTeam(),t.folderPolicy(),t.isTeamSharedFolder(),t.isFolderInsideTeamFolderTree(),t.memberCountWithRecipients()))),s}fetchLinkMetadata(){return"/"!==this.getContentInfo().displayPath()?(this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST),this.client.sharedLinkInfo({fileIdOrPath:this.getContentInfo().idForLink()}).then((e=>{this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{sharedLinks:e})})).catch((()=>{this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE);this.isContentInfoForPaper(this.getContentInfo())||this.sharingInfo.isNonUserRelativeContext()||(this.showStandardError(),i.Modal$1.close())}))):Promise.resolve({})}fetchMemberCounts(){const e=this.getContentInfo();return e.isFile()?l.SharingActions.fetchFileMemberCount({user:this.user,contentId:e.id,limit:i.FETCH_FILE_MEMBER_COUNT_LIMIT}):e.isSharedFolder()||e.isFolder()&&e.isInSharedFolder()?l.SharingActions.fetchFolderMemberCount({user:this.user,contentId:e.isSharedFolder()?e.sharedFolderId():e.nsId(),client:this.client}):Promise.resolve({})}fetchSharingPrefs(){return this.dispatch(l.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST),this.client.getSharingPrefs().then((e=>{this.dispatch(l.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS,{sharingPrefs:e})}))}setLastSeenTeamPolicyAudience(e){return this.client.setSharingPrefs({last_seen_team_policy_audience:e})}setSeenUpsellCounterPref(e){return this.dispatch(l.ShareModalActionTypes.SET_UPSELL_COUNTER_PREF),this.client.setSharingPrefs({has_seen_share_modal_upsell_premium_sharing_counter:e}).then((()=>{this.dispatch(l.ShareModalActionTypes.SET_UPSELL_COUNTER_PREF_SUCCESS)}))}setHasSeenPostSharingEsignPref(){return this.client.setSharingPrefs({has_seen_esign_post_sharing:!0})}setLastSeenPostSharingEsignTsPref(){return this.client.setSharingPrefs({is_in_esign_post_sharing_exclusion_period:!0})}onShareModalUnmount(e){var t;this.teardownPass();const s=e&&e.serializeInputData()||{};this.dispatch(l.ShareModalActionTypes.SHARE_MODAL_CLOSE,s);const n=this.getSharingInfo().getInitialProps();null===(t=n.onClose)||void 0===t||t.call(n)}fetchCurrentAccount(){return this.dispatch(l.ShareModalActionTypes.FETCH_CURRENT_ACCOUNT_REQUEST),this.client.getLightweightAccountCached().then((e=>{this.dispatch(l.ShareModalActionTypes.FETCH_CURRENT_ACCOUNT_SUCCESS,{teamPolicy:e.team_policies,isFamilyUser:e.is_family_user})}))}getAccountInfo(){return this.client.getCurrentAccountCached()}handleContentNameChange(e){const t="SIMPLIFIED_WIZARD_UI::CONTENT_NAME_CHANGE";this.hasLoggedSet[t]||(this.sharingExperimentsLog(t),this.hasLoggedSet[t]=!0),this.dispatch(l.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE,{name:e})}handleUpdateFilePolicy(e,t){this.handleUpdateSharingSettings(e);const s=this.getSharingInfo().filePolicy(),{fileId:n}=this.getPassFetchingInfo();if(n)if(s.viewer_info_policy===i.ViewerInfoPolicy.disabled&&t.viewer_info_policy===i.ViewerInfoPolicy.enabled)this.clearCachedPassInfo(),l.PassActions.resetPassInfo(n),l.PassActions.fetchPassError(n),this.dispatch(l.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO);else{const e=s.audience===i.LinkAudience.members!=(t.audience===i.LinkAudience.members),a=s.viewer_info_policy===i.ViewerInfoPolicy.enabled&&t.viewer_info_policy===i.ViewerInfoPolicy.disabled;if(e||a){this.clearCachedPassInfo();const e=this.getUrl();a&&this.listMembers({contentId:n,url:e,isNonUserRelativeContext:this.sharingInfo.isNonUserRelativeContext()});const t=this.isContentInfoForFilePreview(this.getContentInfo());l.PassHelpers.setup({user:this.user,fileData:this.getFileData(e),prevFileData:null,shouldWritePresence:t,skipSharingEndpoints:!0})}}}handleUpdateSharingSettings(e){this.dispatch(l.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS,{metadata:e})}listMembers({contentId:e,url:t,members:s,isNonUserRelativeContext:n=!1}){return l.SharingActions.listMembers({user:this.user,contentId:e,isFolder:this.sharingInfo.isFolder(),url:t,members:s,client:this.client,isNonUserRelativeContext:n})}addMembers(e,t,s=!1,n){const a=e.map((e=>({member:i.createUnionScalar(e.contactType(),e.contactId()),access_level:i.accessLevelConstToApi(e.access_type)})));return this.client.addMembersWithAccessLevel({contentId:t,members:a,customMessage:n,quiet:s})}isContentInfoForFilePreview(e){return("PREVIEW_PAGE"===e.extras.origin||"PREVIEW_PAGE_FACEPILE"===e.extras.origin)&&!e.isFolder()}isContentInfoForPaper(e){return e.extras&&"PAPER_INTEGRATION"===e.extras.origin}log(e,t={}){g.logTiburonEvent(this.getContentInfo(),this.user.id,e,t)}logIfHaventBefore(e,t={},s=!0){this.hasLoggedSet[e]||(this.hasLoggedSet[e]=!0,s&&(t.timing=Date.now()-this.beginTime),this.log(e,t))}redirectToBrowseUrl(e){if(null!=this.setUrl)this.setUrl({path:e});else{const t=i.browse_uri_for_fq_path(this.user,e);i.browserRedirectWrapper(t)}}redirectToUpgrade(){i.browserRedirectWrapper("/upgrade?oqa=spw")}refreshSharedWithColumnLinkData(){i.getStoreForSharedWith().dispatch(i.sharedLinkDataOutOfDate(this.getContentInfo().displayPath()))}relinquishMembershipSimple(e,t){return this.client.relinquishMembership({contentId:e,leaveACopy:t}).then((()=>{i.Modal$1.close(),this.redirectToBrowseUrl("/")}))}relinquishMembership(e,t){const s=this.getContentInfo();return this.relinquishMembershipSimple(e,t).then((()=>{s.isFolder()?f.sharingNotificationSuccess(r.intl.formatMessage({id:"CD+ZYc",defaultMessage:"Folder access removed."})):f.sharingNotificationSuccess(r.intl.formatMessage({id:"GTNg67",defaultMessage:"File access removed."}))}))}removeMemberSimple(e,t,s){return this.client.removeMember({contentId:e,memberId:t,leaveACopy:s})}removeMember(e,t,s,n){return this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:t}),this.log(u.TiburonEventName.AttemptRemoveMember),this.removeMemberSimple(e,t.memberId(),s).then((e=>(this.log(u.TiburonEventName.SucceedRemoveMember,{http_status_code:200}),this.fetchInitialData().then((()=>{if(e&&null!=e.access_level&&null!=e.warning)return this.dispatch(l.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS,{member:t,access:e.access_level}),e;n?f.sharingNotificationSuccess(r.intl.formatMessage({id:"CD+ZYc",defaultMessage:"Folder access removed."})):f.sharingNotificationSuccess(r.intl.formatMessage({id:"GTNg67",defaultMessage:"File access removed."})),this.dispatch(l.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS,{member:t}),this.fetchMemberCounts()}))))).catch((e=>{if(e instanceof a.ApiError){const s=e;return this.log(u.TiburonEventName.FailRemoveMember,{http_status_code:s.raw&&s.raw.status,error_tag:s.error&&s.error[".tag"]||"undefined_error",error_summary:s.summary}),this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:t}),this.parseParentFolderAccessError(s)}throw this.log(u.TiburonEventName.FailRemoveMember),e}))}setContentNameAndSendShare(e){const t=this.sharingInfo.contentNameInputValue(),s=i.parent_dir(this.sharingInfo.fqPath()),n=g.getNewFolderPathFromContentName(t,s);let a=!this.sharingInfo.isNonUserRelativeContext();this.getSharingInfo().shouldSuppressRedirectToBrowse()&&(a=!1);let r=a&&!i.shouldUseReactRouter();return this.getSharingInfo().shouldCloseImmediately()&&(r=!0),new Promise(((s,o)=>{new c.SharingApi(this.user).validate_new_sf_path(t,n,(()=>{this.dispatch(l.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS,{newFolderPath:n}),this.sendShare(e,{keepModalOpen:a,suppressSuccessSnackbar:r}).then((()=>{var e;if(this.sharingInfo.shareAsConfidential()&&i.WebUserActionLog.log(this.user.id,i.WebUserActionLogEvent.CONF_BY_CREATE_CONFIDENTIAL_FOLDER,{ns_id:this.sharingInfo.contentId(),who_has_access:i.WebUserActionLogExtraValue.SPECIFIC_PEOPLE,location:this.sharingInfo.isNonUserRelativeContext()?i.WebUserActionLogExtraValue.CONTENT_MANAGER:i.WebUserActionLogExtraValue.BROWSE}),a){const t=i.browse_uri_for_fq_path(this.user,n);t.updateQuery("show_share_success_snackbar","1"),this.sharingInfo.automationOptionChecked()&&(i.shouldUseReactRouter()&&(i.browserRedirectWrapper(t),I.asyncLaunchAddOrEditAutoFolderModal({fqPath:n,nsId:null===(e=this.sharingInfo.metadata())||void 0===e?void 0:e.nsId(),user:this.user,entryPoint:"share_modal",source:"add_from_folder_creation"}),s()),t.updateQuery("automations","from_share")),i.browserRedirectWrapper(t)}s()}))}),(e=>{this.sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::INVALID_CONTENT_NAME");const t=c.extractErrors(e.responseText),s=t.folder_name&&t.folder_name.message_text;this.dispatch(l.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR,{errorMsg:s}),o(s)}))}))}setSharedLinks(e){this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{sharedLinks:e})}deleteLinkMetadata(e){this.dispatch(l.ShareModalActionTypes.DELETE_LINK_METADATA_SUCCESS,{deletedLink:e})}enableImmediateModalClose(e){const{inviteEligibleNotSeenContacts:t}=this.sharingInfo.getEligibleInviteAfterSharingContacts(),s=this.sharingInfo.sharingPrefs().invite_after_sharing_modal_variant;return e||0===t.length||"not_enabled"===s}getTasksToCreate(e){let t;switch(e){default:t=[];break;case"V1":t=this.sharingInfo.getSharingTasks();break;case"V2":case"V3":t=["save_copy","leave_comment"]}return t}createSharingTasks(){return s.__awaiter(this,void 0,void 0,(function*(){try{const e=cs(this),t="OFF"!==e,s=this.sharingInfo.isFolder(),n=this.sharingInfo.name().endsWith(".paper"),a=this.sharingInfo.recipientTokens(),r=a.some((e=>e.type===i.ContactTypes.NEW_STYLE_GROUP));if(t&&!s&&!n&&!r){const t=this.sharingInfo.contentInfo().id,s=this.sharingInfo.recipientMessage(),n=a.map((e=>e.email)),i=this.getTasksToCreate(e),r=i.map((e=>({".tag":e})));this.log(u.TiburonEventName.RRCSenderShareModalShareClick,{variant:e,tasks:i.join(),num_emails:n.length,note_length:s.length,file_ext:l.getWhitelistedExtension(this.sharingInfo.name())}),yield this.client.createSharingTasks({fileId:t,note:s,emails:n,sharingTasks:r})}}catch(e){this.log(u.TiburonEventName.RRCSenderCreateSharingTasksError,{error_message:null==e?void 0:e.message,error_tag:(null==e?void 0:e.error)&&e.error[".tag"]||"undefined_error"})}}))}sendShare(e,t={keepModalOpen:!1,suppressSuccessSnackbar:!1,suppressAllSnackbars:!1,suppressNotifications:!1}){const o={outcomeHasBeenLogged:!1},c=(e,t)=>{this.log(e,t),o.outcomeHasBeenLogged=!0},d=this.getContentInfo().isFileFolder(),h=this.getSharingInfo().getInitialProps(),p=this.sharingInfo.contentInfo().id;h.onShareClick&&h.onShareClick(this.getSharingInfo().recipientTokens(),this.getSharingInfo().recipientAccess());const m=_s.has(p);this.log(u.TiburonEventName.ClickInbandShareButton,{in_progress:m});const _=Date.now();let E,S;return this.recipientsChange(e.getContacts()).then((()=>this.validateContacts(this.sharingInfo.recipientTokens()))).then((()=>{if(S=this.sharingInfo.contactsError().level,S===g.ContactsErrorLevel.Error)return Promise.reject({});this.enableImmediateModalClose(t.keepModalOpen)&&(i.Modal$1.close(),this.log(u.TiburonEventName.CloseShareModal,{time_modal_opened:Date.now()-_})),window.addEventListener("beforeunload",this.onPageNavigationAttempt),window.addEventListener("unload",this.onPageNavigationAway),_s.add(p),this.dispatch(l.ShareModalActionTypes.SEND_SHARE_REQUEST),E=i.contactsToMembers(this.sharingInfo.recipientTokens());const e=this.sharingInfo.contentInfo().extras.origin;return e!==i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS&&e!==i.SHARE_ACTION_ORIGIN_TYPE.WIZARD||i.WebUserActionLog.log(this.user.id,i.WebUserActionLogEvent.NEW_FOLDER_ADD_MEMBER,{num_invites:E.length}),this.shareIfFileFolder(t.suppressAllSnackbars?void 0:r.intl.formatMessage({id:"lhzBKS",defaultMessage:"Sharing <st>{folder_name}</st>..."},{st:e=>n.React$1.createElement("strong",null,e),folder_name:i.Emstring.em_snippet(this.sharingInfo.name(),i.SNIPPET_SIZES.FILENAME)}))})).then((()=>this.createSharingTasks())).then((()=>this.client.addMembers({accessLevel:this.sharingInfo.recipientAccess(),contentId:this.sharingInfo.contentInfo().id,customMessage:this.sharingInfo.recipientMessage(),members:E,addMessageAsComment:!!this.sharingInfo.recipientMessage()&&this.sharingInfo.isShareMessageAsCommentChecked()&&this.sharingInfo.permissionsObj().canShareMessageAsComment(),quiet:t.suppressNotifications||!1}))).catch((e=>{if(e instanceof a.ApiError){const s=e.error&&e.error[".tag"];this.dispatch(l.ShareModalActionTypes.SEND_SHARE_FAILURE),t.suppressAllSnackbars||this.reportShareFailure(e),c(u.TiburonEventName.FailInbandShare,{http_status_code:e.raw&&e.raw.status,error_tag:s||"undefined",error_summary:"summary"in e?e.summary:"message"in e?e.message:"undefined",timing:Date.now()-_,num_recipients:E.length})}else c(u.TiburonEventName.FailInbandShare,{error_message:e.message,error_tag:S===g.ContactsErrorLevel.Error?"contacts_error":null});return Promise.reject({})})).then((()=>{var e,a,o,p,m,S,M,k;if(c(u.TiburonEventName.SucceedInbandShare,{timing:Date.now()-_,num_recipients:E.length}),this.dispatch(l.ShareModalActionTypes.SEND_SHARE_SUCCESS),this.sharingInfo.isShowingFileUploadToolkitCampaign())i.publishEvent(i.CampaignEvents.FILE_SHARE_SUCCESS,{context:{file_name:this.sharingInfo.name(),file_extension:i.file_extension(this.sharingInfo.name()),file_path:this.sharingInfo.fqPath()}}),f.showInBandShareSuccessSnackbar(this.sharingInfo.name());else{xe.emit("onSuccessSharing",{origin:this.sharingInfo.contentInfo().extras.origin,wasFileFolder:d}),this.fetchMemberCounts();const l=this.sharingInfo.contentInfo().extras.origin,{contextData:c,shouldShowShopModal:u}=this.getShopModalPrereqs();if(!t.suppressSuccessSnackbar&&!t.suppressAllSnackbars){const e=this.sharingInfo.name(),t=(k=this.getSharingInfo().sharingPrefs().capture_sdk_integration_voice_overs_variant,!!document.getElementById(qt)&&"V2"===k);if(this.shouldShowEsignDiscoveryUpsell()&&!u){const s=this.sharingInfo.hasSeenEsignPostSharing();s||this.setHasSeenPostSharingEsignPref(),((e,t,s,n,a,r,o,l)=>{i.Snackbar.show(es(e,t,s,n,a,r,o,l))})(e,f.formatSuccessMessageForFolder(e),this.sharingInfo.fqPath(),this.user.id,Number(this.sharingInfo.contentId()),s,t,(()=>{this.setLastSeenPostSharingEsignTsPref()}))}else t&&!u?(p=e,m=f.formatSuccessMessageForFolder(e),S=this.sharingInfo.fqPath(),M=this.user.id,i.Snackbar.close(zt),i.Snackbar.show(n.React$1.createElement(i.Snackbar,{title:m,id:zt,variant:"complete",onCloseClick:()=>{i.ProEventsLogger.log(jt.RECORD_VIDEO_SNACKBAR_DISMISS_CLICK,{user_id:M})},onShown:()=>{i.ProEventsLogger.log(jt.RECORD_VIDEO_SNACKBAR_SHOWN,{user_id:M})},richSnackbarProps:{actionBarAlignment:"left",actions:[Zt()],helperText:r.intl.formatMessage({id:"OcVFQv",defaultMessage:"Did you know you can record a voice-over and attach it to your file?"}),clickHandlerArgs:{userId:M,filePath:S||p}}}))):f.showInBandShareSuccessSnackbar(this.sharingInfo.name());i.UserSurvey.addAttribute("isFolder",String(this.sharingInfo.isFolder())),g.trackUserLeapEvent(g.SharingUserLeapEvent.SHARE_SUCCESS,l)}if(l!==i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS&&l!==i.SHARE_ACTION_ORIGIN_TYPE.WIZARD||i.WebUserActionLog.log(this.user.id,i.WebUserActionLogEvent.NEW_SHARED_FOLDER_SUCCESS,{}),null===(e=h.onSuccessSharing)||void 0===e||e.call(h),this.sharingInfo.automationOptionChecked()&&I.asyncLaunchAddOrEditAutoFolderModal({fqPath:this.sharingInfo.fqPath(),nsId:null===(a=this.sharingInfo.metadata())||void 0===a?void 0:a.nsId(),user:this.user,entryPoint:"share_modal",source:"add_from_folder_creation"}),this.refreshSharedWithColumnContentData(),!t.keepModalOpen){const{inviteEligibleNotSeenContacts:e,inviteEligibleSeenContacts:t}=this.sharingInfo.getEligibleInviteAfterSharingContacts(),n=this.getSharingInfo().sharingPrefs().invite_after_sharing_modal_variant;if(function(e,t){const s=e.length>0&&(function(e){return["admin_invite_after_move","admin_invite_expand_eligibility"].includes(e)}(t)||ss(t));return Boolean(s)}(e,n)){i.Modal$1.close();const a=(o=t,[...ts(e,!0),...ts(o,!1)]);if("admin_invite_expand_eligibility"===n&&1===a.length){const e=a[0],t=Date.now(),i=this.loadShowGuestPassAdminInviteAfterSharingModal(),r=this.loadShowAdminInviteAfterSharingModal();(function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=gs(),s={guest_email:e};try{return!!(yield t.ns("guest_pass").rpc("get_invite_eligibility",s,{})).eligible}catch(e){throw new Error(e.error[".tag"])}}))})(e.email).then((e=>{e?i.then((e=>{e({eligibleUser:a[0],modalOrigin:l})})):r.then((e=>{e({eligibleUsers:a,adminModalVariant:n,modalOrigin:l,modalLoadingStartTime:t})}))}))}else if("admin_invite_expand_eligibility"===n){const e=Date.now();this.loadShowAdminInviteAfterSharingModal().then((t=>{t({eligibleUsers:a,adminModalVariant:n,modalOrigin:l,modalLoadingStartTime:e})}))}else if(ss(n)){const e=Date.now();this.loadShowMemberInviteAfterSharingModal().then((t=>{t({eligibleUsers:a,memberModalVariant:n,sharingOrigin:l,modalLoadingStartTime:e})}))}}else if(u){const e=g.getShopModalLoggingParams(this.getContentInfo(),this.getSharingInfo().getReferrer());i.publishEvent(i.CampaignEvents.SHARE_MODAL_CLOSED,{context:c,loggingParams:e})}else i.Modal$1.close()}"V1"===this.sharingInfo.sharingPrefs().core_act_docsend_advanced_sharing&&R.setIsEligibleForDocsendSplitShareItemInUserMetadata(this.user.id)}return Promise.resolve()})).finally((()=>{o.outcomeHasBeenLogged||this.log(u.TiburonEventName.InconclusiveInbandShare),_s.delete(p)}))}loadShowAdminInviteAfterSharingModal(){return s.__awaiter(this,void 0,void 0,(function*(){const{showAdminInviteAfterSharingModal:t}=yield new Promise((function(t,s){e(["./c_modals_invite_after_sharing_admin_invite_after_sharing_modal"],t,s)}));return t}))}loadShowGuestPassAdminInviteAfterSharingModal(){return s.__awaiter(this,void 0,void 0,(function*(){const{showGuestPassAdminInviteAfterSharingModal:t}=yield new Promise((function(t,s){e(["./c_modals_guest_pass_guest_pass_admin_invite_after_sharing_modal"],t,s)}));return t}))}loadShowMemberInviteAfterSharingModal(){return s.__awaiter(this,void 0,void 0,(function*(){const{showMemberInviteAfterSharingModal:t}=yield new Promise((function(t,s){e(["./c_modals_invite_after_sharing_member_invite_after_sharing_modal"],t,s)}));return t}))}shareFolderSimple(e,t=!1,s,n){const r=e=>{this.dispatch(l.ShareModalActionTypes.SHARE_FOLDER_SUCCESS,{metadata:e}),i.dispatcherSingleton.dispatch({type:p.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:this.user})},o={fqPath:e,confidential:t,syncSetting:s,folderPolicy:n||null},c=this.client.share(o);return this.dispatch(l.ShareModalActionTypes.SHARE_FOLDER_REQUEST,{promise:c}),c.then(r).catch((e=>{if(e instanceof a.AppError&&e.error&&e.error.bad_path&&"already_shared"===e.error.bad_path[".tag"]){const t=i.folderMetadataApiToRecord(e.error.bad_path);return r(t)}return this.dispatch(l.ShareModalActionTypes.SHARE_FOLDER_FAILURE),Promise.reject(e)}))}getFqPath(){let e;return e=this.sharingInfo.isNonUserRelativeContext()&&!this.user.is_cdm_member?`ns:${this.getContentInfo().nsId()}${this.getContentInfo().nsPath()}`:this.getContentInfo().displayPath(),e}isMemberAccessLevelQualified(e){return null!=e}sharingExperimentsLog(e,t={}){const s=this.getContentInfo().extras.modalSessionId;t.modalSessionId=t.modalSessionId||s,i.SharingExperimentsLogger.log(this.user.id,e,t)}teardownPass(){this.clearCachedPassInfo(),this.getPassFetchingInfo().shouldFetchPass&&l.PassHelpers.teardown({user:this.user,fileData:this.getFileData(),async:!0,shouldWritePresence:!1})}showStandardError(e){const t=e&&e.message;f.sharingNotificationError(t||r.intl.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}))}shouldShowEsignDiscoveryUpsell(){return w.HELLOSIGN_SUPPORTED_EXTENSIONS.includes("."+i.file_extension(this.sharingInfo.name()))&&!this.sharingInfo.isInEsignPostSharingExclusionPeriod()&&this.isSendForSignatureEnabled&&!C.is_supported_mobile_browser()}updateSharingTasks(e){this.dispatch(l.ShareModalActionTypes.UPDATE_SHARING_TASKS,{sharingTasks:e})}shouldFetchDocsendAnalyticsLink(){var e;const t=this.sharingInfo.contentInfo(),s=L.getDocsendAnalyticsAddOnConfig(this.user,this.sharingInfo.getInitialProps().docsendAnalyticsAddOn);return s.coreSharingModal.fetchAnalyticsLink&&s.isSupportedFile((null===(e=this.sharingInfo.sharingInfoState().linkMetadata)||void 0===e?void 0:e.file_size)||0,i.file_extension(t.name()))&&"string"==typeof this.sharingInfo.contentInfo().id}fetchDocsendAnalyticsLink(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.sharingInfo.contentInfo(),t=i.file_extension(e.name());this.dispatch(l.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_REQUEST);const s=yield A.getLink(this.client,e.id,t,"share_modal",{subjectUserId:this.user.id});s?this.dispatch(l.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_SUCCESS,{linkData:{link:s.link,hasNewerFileVersion:s.file_has_newer_version,fileTimestampMicro:s.file_hlc_unix_micros}}):this.dispatch(l.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_FAILURE)}))}},t.Token=hn,t.TokenizedInput=mn,t.Typeahead=gn,t.actions_adapter_esnext=Pe,t.fetchTeamGuestPassDetails=function(){return s.__awaiter(this,void 0,void 0,(function*(){const e=gs();let t;try{t=yield e.ns("guest_pass").rpc("get_team_details",{},{})}catch(e){throw new Error(e.error[".tag"])}if(void 0===t.remaining_guest_passes||void 0===t.used_guest_passes||void 0===t.guest_pass_duration_days||void 0===t.is_team_eligible_for_guest_pass)throw new Error("Missing data in response");return{remainingGuestPasses:t.remaining_guest_passes,usedGuestPasses:t.used_guest_passes,guestPassDurationDays:t.guest_pass_duration_days,isTeamEligibleForGuestPass:t.is_team_eligible_for_guest_pass}}))},t.getTasks=function(){return s.__awaiter(this,void 0,void 0,(function*(){const e=new i.UserApiV2Client,t=i.mustGetActiveUserId(),s=yield e.ns("custom_onboarding").rpc("get_tasks",{user_id:t},{subjectUserId:t}).catch((e=>{_.reportException({err:e,tags:["onboarding_checklist"],severity:S.SEVERITY.NONCRITICAL})}));return null==s?void 0:s.tasks}))},t.getText=Oe,t.updateTask=Gi}));
//# sourceMappingURL=c_sharing_actions_share_modal.js-vfl5cxCXk.map
