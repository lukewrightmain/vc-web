define(["exports","./c_tslib","./e_edison","./e_ui_page_files_router","./c_ui-icon_line_comment","./c_src_file_viewer_components","./c_core_utils_time_utils","./c_src_toolbar","./c_lodash-es_lodash"],(function(e,t,a,r,n,o,i,c,s){"use strict";function l(e){const t={},a=e.text.split(/#xywh=/i);if(t.imageUrl=a[0],2===a.length){const e=a[1].split(/[ ,]+/);4===e.length&&(t.imageX=+e[0],t.imageY=+e[1],t.imageWidth=+e[2],t.imageHeight=+e[3])}return t}function _(e){const t=l(e);return t.imageUrl?o.preloadImage(t.imageUrl):Promise.reject("Unable to get imageUrl from vtt cue")}function d(e){return new Promise(((t,a)=>{const r=[],n=new WebVTT.Parser(window,WebVTT.StringDecoder());n.oncue=function(e){r.push(e)},n.onparsingerror=function(e){a(e)},n.onflush=function(){t(r)},n.parse(e),n.flush()}))}function m(e){return(a=e,t.__awaiter(void 0,void 0,void 0,(function*(){return(yield fetch(a,{method:"GET",credentials:"include"})).text()}))).then(d);var a}r.injectInternalStyle("typescript/libraries/file-viewer/src/video_controls/audio_video_markers.module.out.css",(e=>'._commentMarkersContainer_1wc9d_1{height:var(--spacing__unit--0_5);left:0;position:absolute;top:2px;width:100%}._thumbnailHolder_1wc9d_9{height:var(--spacing__unit--1);left:0;position:absolute;top:0;width:100%}._thumbnailWrapper_1wc9d_17{background-clip:content-box;background-color:var(--color__faint__background);bottom:0;opacity:0;padding-bottom:20px;pointer-events:none;position:absolute;transition:opacity .2s ease-in-out;width:128px}._thumbnailWrapper_1wc9d_17:after{content:"";height:24px;left:50%;pointer-events:auto;position:absolute;transform:translate(-50%);width:100%}._lightTheme_1wc9d_39 ._thumbnailWrapper_1wc9d_17{background-color:var(--color__inverse__faint__background)}.vjs-progress-control:hover ._thumbnailWrapper_1wc9d_17{opacity:1}._thumbnailHolderComment_1wc9d_47{background-color:var(--color__core__accent);cursor:pointer;text-align:center}._commentIconHolder_1wc9d_53{align-items:center;display:none;justify-content:center;width:100%}._thumbnailHolderComment_1wc9d_47:hover ._commentIconHolder_1wc9d_53{display:flex}._thumbnailHolderComment_1wc9d_47:hover ._thumbnailTime_1wc9d_64{display:none}._thumbnailLoadError_1wc9d_68{padding:0 var(--spacing__unit--0_5);width:80px}._thumbnailImage_1wc9d_73{height:72px;margin:2px auto 0;position:relative}._thumbnailImage_1wc9d_73,._thumbnailTime_1wc9d_64{align-items:center;display:flex;justify-content:center}._thumbnailTime_1wc9d_64{font-feature-settings:"tnum";color:var(--color__standard__text);font-family:inherit;font-size:14px;font-variant-numeric:tabular-nums;height:24px;width:100%}._lightTheme_1wc9d_39 ._thumbnailTime_1wc9d_64{color:var(--color__inverse__standard__text)}._timeLine_1wc9d_99{background-clip:content-box;background-color:var(--color__core__primary);bottom:2px;display:none;height:var(--spacing__unit--0_5);padding-left:calc(50% - 1px);padding-right:calc(50% - 1px);position:absolute;width:100%;z-index:1}.vjs-progress-control:hover ._timeLine_1wc9d_99{display:block}._rangeMarkersContainer_1wc9d_117{height:var(--spacing__unit--0_5);left:0;position:absolute;top:2px;width:100%}._rangeMarker_1wc9d_117{background-color:var(--color__inverse__success__text);border-left:1px solid var(--color__core__primary);border-right:1px solid var(--color__core__primary)}._commentMarker_1wc9d_1,._rangeMarker_1wc9d_117{height:100%;pointer-events:none;position:absolute}._commentMarker_1wc9d_1{background-color:var(--color__core__primary);width:2px}'));var u;function p(e){var t;switch(null===(t=e.annotation)||void 0===t?void 0:t.type){case"audio":case"video":return e.annotation.time/100;default:return}}!function(e){e.Requesting="requesting",e.Failed="failed",e.ImageLoaded="image_loaded"}(u||(u={}));const h=({duration:e,thread:t,className:r})=>{const n=p(t);if(void 0===n)return null;const o=0===e?0:100*n/e;return a.React$1.createElement("div",{className:r,style:{left:`${o}%`}})};h.displayName="Marker";const g=({threads:e,vttUrl:t,onScrubberThumbnailsLoaded:d,duration:g,openThreadInRightRail:v,showInverse:b})=>{const f=a.react.exports.useRef([]),w=r.useIntl(),[x,k]=a.react.exports.useState(u.Requesting),[y,R]=a.react.exports.useState(0),[M,$]=a.react.exports.useState(0),[E,T]=a.react.exports.useState(),[I,C]=a.react.exports.useState(0),N=a.react.exports.useRef(null),L=r.useSelector((e=>e.showResolvedComments)),S=a.React$1.useMemo((()=>e?L?Object.entries(e):Object.entries(e).filter((e=>!e[1].resolvedInfo)):void 0),[e,L]),H=a.React$1.useMemo((()=>S&&S.find((e=>{const t=p(e[1]);return void 0!==t&&100*Math.abs(I-t)/g<2}))),[S,I,g]),j=o.useStabilizedCallback((e=>{H&&(null==v||v(H[1]),e.stopPropagation())}));a.react.exports.useEffect((()=>{t&&m(t).then((e=>{f.current=e,e&&e.length>0&&_(e[0]).then((()=>{k(u.ImageLoaded),null==d||d(!0)})).catch((()=>{null==d||d(!1),k(u.Failed)}))})).catch((()=>{null==d||d(!1),k(u.Failed)}))}),[t,d]);const U=s.throttle(o.useStabilizedCallback((e=>{if(!e.currentTarget)return;const a=e.currentTarget.getBoundingClientRect(),r=a.width,n=e.clientX-a.left,o=Math.min(Math.max(n,0),r)/r*g;if($(a.width),R(e.clientX-a.left),C(o),t&&f.current){const e=f.current.find((e=>e.startTime<=o&&e.endTime>=o));e&&T(l(e))}})),50);a.react.exports.useEffect((()=>{const e=N.current;if(e)return e.addEventListener("click",j),()=>e.removeEventListener("click",j)}),[j,N]);const{imageUrl:V,imageX:W,imageY:F,imageWidth:P,imageHeight:z}=E||{},A=x===u.Failed?80:128,q=x===u.ImageLoaded?{background:`url("${V}") no-repeat -${W}px -${F}px`,width:P,height:z}:x===u.Failed?{display:"none"}:{},D=Math.min(Math.max(0,y-A/2),M-A),X={left:D},B={left:y-(D+A/2)},O=i.formatTime(I,g,i.showTimestampDecimalPlaces(g)),Y=w.formatMessage({id:"3Unj79",defaultMessage:"Loading video thumbnail"});return a.React$1.createElement(a.React$1.Fragment,null,S&&a.React$1.createElement("div",{className:"_commentMarkersContainer_1wc9d_1"},S.map((e=>a.React$1.createElement(h,{className:"_commentMarker_1wc9d_1",key:e[0],duration:g,thread:e[1]})))),a.React$1.createElement("div",{className:r.classnames("_thumbnailHolder_1wc9d_9",{_lightTheme_1wc9d_39:!b}),onMouseMove:U},a.React$1.createElement("div",{className:r.classnames("_thumbnailWrapper_1wc9d_17",{_thumbnailHolderComment_1wc9d_47:!!H,_thumbnailLoadError_1wc9d_68:!!t&&x===u.Failed}),style:X,ref:N},!!t&&a.React$1.createElement("div",{className:"_thumbnailImage_1wc9d_73",style:q},x===u.Requesting?a.React$1.createElement(r.Spinner,{"aria-valuetext":Y,size:"small"}):null),!!H&&!!t&&a.React$1.createElement("div",{className:"_commentIconHolder_1wc9d_53"},a.React$1.createElement(r.IconButton,{className:r.classnames(c.regularButton),variant:"transparent",size:"small",inverse:!0},a.React$1.createElement(r.UIIcon,{src:n.CommentLine}))),!!t&&a.React$1.createElement("div",{className:"_thumbnailTime_1wc9d_64"}," ",O," "),a.React$1.createElement("div",{className:"_timeLine_1wc9d_99",style:B}))))};g.displayName="AudioVideoMarkersComponent",g.displayName="AudioVideoMarkersComponent";const v=e=>{var{container:r}=e,n=t.__rest(e,["container"]);return a.reactDom.exports.createPortal(a.React$1.createElement(g,Object.assign({},n)),r)};v.displayName="AudioVideoMarkers";e.AudioVideoMarkers=v,e.AudioVideoMarkersComponent=g,e.TimeRangeMarker=({timeRange:e,duration:t,container:r})=>{const n=0===t?0:100*e.start/t;let o;return o=e.end?0===t?0:100*(e.end-e.start)/t:0===t?0:100*(t-e.start)/t,a.reactDom.exports.createPortal(a.React$1.createElement("div",{className:"_rangeMarkersContainer_1wc9d_117"},a.React$1.createElement("div",{className:"_rangeMarker_1wc9d_117",style:{left:`${n}%`,width:`${o}%`}})),r)},e.loadVtt=m,e.parseVttCue=l,e.preloadThumbImage=_}));
//# sourceMappingURL=c_src_video_controls_audio_video_markers.js-vflbP0xJC.map
