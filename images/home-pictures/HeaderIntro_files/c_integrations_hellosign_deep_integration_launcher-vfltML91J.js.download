define(["require","exports","./c_tslib","./e_edison","./c_core_notify","./c_ui-icon_line_signature","./e_ui_page_files_router","./e_core_exception","./c_controls_index","./c_src_instrumentation_function_wrapper","./c_src_instrumentation_constants","./c_core_i18n","./c_ui-icon_line_delete","./c_table_index","./c_spectrum_icon_form_index","./c_src_text","metaserver/static/js/modules/constants/page_load","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","./c_core_exception_info","./c_api_v2_noauth_client","./c_core_uri","./c_dropins_sdk_refactor_src_v2_entry","./c_base64","./c_stormcrow_stormcrow_exposure_logger","./c_account_email_verify_reasons","./c_lodash-es_lodash","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_src_sink_index","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","metaserver/static/js/modules/constants/request","./c_csrf","./c_browser_cookies","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","./c_ui-icon_line_arrow-down","./c_ui-icon_line_arrow-up","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle"],(function(e,t,n,i,s,a,r,o,c,l,g,d,h,u,m,p,f,_,E,R,S,v,I,y,b,T,C,w,N,x,$,P,k,A,O,M,D,U,F,L,H,W,j,q,B,z,V,G,Q,K,Y,Z,X,J){"use strict";function ee(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var te=ee(E);class ne{constructor(e=document.body,t=document,n=window){this.show=()=>{this.anchor.contains(this.container)||this.anchor.appendChild(this.container),this.container.hidden=!1},this.hide=()=>{this.container.hidden=!0},this.reset=()=>{this.anchor.removeChild(this.container),this.container=this.createContainer()},this.renderContent=e=>{i.reactDom.exports.render(e,this.container)},this.hideOverflow=()=>{this.windowObj.scrollTo(0,0),this.documentEl.documentElement.classList.add("hs-int-hellosign-overflow-hide")},this.removeHideOverflow=()=>{this.documentEl.documentElement.classList.remove("hs-int-hellosign-overflow-hide")},this.createContainer=()=>{const e=document.createElement("div");return e.className="hs-int-full-screen-container",e.hidden=!0,e},this.container=this.createContainer(),this.anchor=e,this.documentEl=t,this.windowObj=n,s.require_css("/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css")}}const ie={nextButton:d.intl.formatMessage({id:"6752Ag",defaultMessage:"Next"}),addSignerButton:d.intl.formatMessage({id:"oXwe58",defaultMessage:"Add signer"}),selfSignButton:d.intl.formatMessage({id:"/dgTxh",defaultMessage:"I’m the only signer"}),subTitle:d.intl.formatMessage({id:"H+e+Nv",defaultMessage:"Who needs to sign"}),emailOptedInStatement:d.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."}),emailErrorMessage:d.intl.formatMessage({id:"sUFO8F",defaultMessage:"A valid email is required"}),nameErrorMessage:d.intl.formatMessage({id:"QKJ1Bh",defaultMessage:"A valid name is required"}),nameHeader:d.intl.formatMessage({id:"uHIr29",defaultMessage:"Name"}),emailHeader:d.intl.formatMessage({id:"POr9LO",defaultMessage:"Email"})};var se;!function(e){e.EMAIL="email",e.NAME="name"}(se||(se={}));const ae=r.requireCssWithComponent((({onAcceptTos:e,onStart:t,logEvent:n,fileName:s,onClose:a,optInRequired:o,userHasSeenModal:m,onContinueWithoutTos:p})=>{const[f,_]=i.React$1.useState(!1),E=i.React$1.useRef(1),[R,S]=i.React$1.useState([{email:"",name:""}]),[v,I]=i.React$1.useState(!1),[y,b]=i.React$1.useState(!1),T=i.React$1.useRef(new Set),C=i.React$1.useRef(new Set),[w,N]=i.React$1.useState(new Set),[x,$]=i.React$1.useState(new Set),P=l.functionWrapperProvider(n,g.InstrFeatureType.TosWithRecipientsInfo);i.React$1.useEffect((()=>{r.ProEventsLogger.log("bt_tos_modal_with_recipients_info_shown")}),[]);const k=()=>{D(!1)&&(t(),m?p(R):e(!o||y,R))},A=i.React$1.createRef(),O=()=>b((e=>!e)),M=e=>{const t=e.trim();if(t){const e=t.split("@");if(2!==e.length)return!1;{const[t,n]=e,i=/^[\x00-\x7f]*$/,s=/^[\w!#$%&'*+\-\/=?^`{|}~.]+$/,a=new RegExp("^([a-z0-9][a-z0-9\\-]*\\.)+([a-z]+|xn--[a-z0-9\\-]+)$","i");return!!s.test(t)&&!(!n||i.test(n)&&!a.test(n))}}return!1},D=e=>{if(v)return!0;let t=!0,n=!0;for(const i in R){const s=R[i].email,a=R[i].name;s&&(t=!1,M(s)?T.current.has(i)&&T.current.delete(i):(n=!1,e||(T.current=T.current.add(i))),a||(n=!1,e||(C.current=C.current.add(i)))),a&&(t=!1,a.trim()?C.current.has(i)&&C.current.delete(i):(n=!1,e||(C.current=C.current.add(i))),s||(e||(T.current=T.current.add(i)),n=!1)),a||s||(T.current.has(i)&&T.current.delete(i),C.current.has(i)&&C.current.delete(i))}t&&(C.current=C.current.add("0"),T.current=T.current.add("0"));const i=new Set(T.current);N(i);const s=new Set(C.current);return $(s),!t&&n},U=l.onClickWrapper(P,g.InstrActionType.AcceptTOS,k),F=l.onClickWrapper(P,g.InstrActionType.ContinueWithSignersModal,k),L=l.onClickWrapper(P,g.InstrActionType.CancelFlow,a),H=l.onClickWrapper(P,g.InstrActionType.ViewTerms,(()=>{})),W=l.onClickWrapper(P,g.InstrActionType.ViewPrivacyPolicy,(()=>{})),j=l.onClickWrapper(P,g.InstrActionType.AddSigner,(()=>{if(19===E.current)return;E.current+=1;const e=R.slice();e.push({email:"",name:""}),S(e)})),q=l.onClickWrapper(P,g.InstrActionType.ToggleSelfSign,(()=>{E.current=1,I((e=>!e));S([{email:"",name:""}]),T.current=new Set,C.current=new Set,N(T.current),$(C.current)}),{extra:{is_self_sign:v?"OFF":"ON"}}),B=r.defineMessage({id:"Yzyn1+",defaultMessage:"I agree to the Dropbox Sign <term>Terms</term> and <policy>Privacy Policy</policy>. We’ll create a Dropbox Sign account with your Dropbox email address if you don’t have one, or link your existing one if you do. Your accounts will be linked across platforms."}),z=d.intl.formatMessage(r.defineMessage({id:"7KWXXT",defaultMessage:"I understand this is the legal representation of the signature."})),V=d.intl.formatMessage(B,{term:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:H},e),policy:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:W},e)}),G=()=>{_((e=>!e)),r.ProEventsLogger.log("toggle_tos_checkbox")},Q=d.intl.formatMessage(B,{term:e=>e,policy:e=>e}),K=i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-file-icon-and-file-name"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(r.FileIcon,{path:s,"aria-label":s,role:"img",variant:"small",className:"hs-int-tos-redesign-file-icon"}),i.React$1.createElement(r.Text,{variant:"label",size:"standard",isBold:!0,className:"hs-int-tos-redesign-file-name"},s))),i.React$1.createElement(r.IconButton,{"aria-label":"close",className:"hs-int-tos-redesign-header-close-button",onClick:()=>{L(),_(!1),E.current=1;S([{email:"",name:""}]),I(!1),b(!1),T.current=new Set,C.current=new Set,N(T.current),$(C.current)},variant:"transparent",size:"small"},i.React$1.createElement(r.UIIcon,{src:r.CloseLine}))),Y=e=>i.React$1.createElement("div",{className:"hs-int-tos-redesign-error-message"},i.React$1.createElement(r.Text,{color:"error"},i.React$1.createElement(r.UIIcon,{src:r.WarningLine,size:"standard"})),i.React$1.createElement("div",{style:{width:5}}),i.React$1.createElement(r.Text,{color:"error"},e)),Z=i.React$1.useCallback(((e,t)=>!v&&(t===se.EMAIL?w.has(String(R.indexOf(e))):t===se.NAME&&x.has(String(R.indexOf(e))))),[w,x,R]),X=i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-container"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-header-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-header"},i.React$1.createElement(r.Title,{size:"large",className:"hs-int-tos-redesign-recipients-info-header"},ie.subTitle),i.React$1.createElement(r.Text,{color:"faint"},d.intl.formatMessage({id:"CIydf/",defaultMessage:"Step 1 of 3"}))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-head-button"},i.React$1.createElement(r.Button,{variant:"transparent",onClick:q,withIconLeft:v?i.React$1.createElement(r.UIIcon,{src:r.CheckmarkLine,role:"presentation","data-uxa-log":"bt_tos_with_recipients_info_toggle_self_sign"}):null},ie.selfSignButton))),i.React$1.createElement(u.Table,{className:"hs-int-tos-redesign-recipients-table",hasDividers:!1,spacing:"standard",verticalAlign:"top",style:{margin:-15}},i.React$1.createElement(u.Table.Body,null,R.map((e=>i.React$1.createElement(u.Table.Row,{key:R.indexOf(e)},i.React$1.createElement(u.Table.Cell,{width:"50%"},i.React$1.createElement(r.Text,{isBold:!0,color:v?"disabled":"standard"},ie.nameHeader),i.React$1.createElement("div",{style:{height:10}}),i.React$1.createElement(r.TextInput,{wrapperProps:Z(e,se.NAME)?{className:"hs-int-tos-redesign-recipients-table-input--red"}:void 0,"aria-label":"recipient-name-input",onChange:t=>((e,t)=>{const n=R.slice();n[t].name=e,S(n),D(!0)})(t.target.value,R.indexOf(e)),value:e.name,placeholder:ie.nameHeader,ref:A,disabled:v}),Z(e,se.NAME)?Y(ie.nameErrorMessage):null),i.React$1.createElement(u.Table.Cell,{width:"50%"},i.React$1.createElement(r.Text,{isBold:!0,color:v?"disabled":"standard"},ie.emailHeader),i.React$1.createElement("div",{style:{height:10}}),i.React$1.createElement(r.TextInput,{wrapperProps:Z(e,se.EMAIL)?{className:"hs-int-tos-redesign-recipients-table-input--red"}:void 0,"aria-label":"recipient-email-input",onChange:t=>((e,t)=>{const n=R.slice();n[t].email=e,S(n),D(!0)})(t.target.value,R.indexOf(e)),placeholder:ie.emailHeader,value:e.email,ref:A,disabled:v}),Z(e,se.EMAIL)?Y(ie.emailErrorMessage):null),i.React$1.createElement(u.Table.Cell,{width:"fill-container",className:Z(e,se.NAME)||Z(e,se.EMAIL)?"hs-int-tos-redesign-recipients-table-delete-button--middle":"hs-int-tos-redesign-recipients-table-delete-button--bottom"},i.React$1.createElement(r.IconButton,{"aria-label":"delete",className:"hs-int-tos-redesign-recipients-info-delete-button",onClick:()=>(e=>{if(E.current>1){E.current-=1;const t=R.slice();t.splice(e,1),S(t),T.current.has(String(e))&&T.current.delete(String(e));const n=new Set(T.current);for(const t of n)if(Number(t)>e){const e=Number(t)-1;T.current.delete(t),T.current.add(String(e))}N(T.current),C.current.has(String(e))&&C.current.delete(String(e));const i=new Set(C.current);for(const t of i)if(Number(t)>e){C.current.delete(t);const e=Number(t)-1;C.current.add(String(e))}$(C.current)}})(R.indexOf(e)),variant:"transparent",disabled:0===R.indexOf(e)&&1===R.length},i.React$1.createElement(r.UIIcon,{src:h.DeleteLine,className:0===R.indexOf(e)&&1===R.length?"":"hs-int-tos-redesign-recipients-info-delete-button-icon"}))))))))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-button-section"},i.React$1.createElement(r.Button,{variant:"outline",size:"large",onClick:j,disabled:v||19===E.current,"data-uxa-log":"bt_tos_with_recipients_info_add_signer"},ie.addSignerButton))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-checkbox"},m?null:i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-terms-checkbox"},i.React$1.createElement(c.Checkbox,{onChange:G,checked:f,"aria-label":Q,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(r.Text,{size:"small"},V," ",i.React$1.createElement("br",null)," ",z)),o&&!m?i.React$1.createElement("div",{className:"hs-int-tos-redesign-email-promotion-checkbox"},i.React$1.createElement(c.Checkbox,{onChange:O,checked:y,"aria-label":ie.emailOptedInStatement,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(r.Text,{size:"small"},ie.emailOptedInStatement)):null)));return i.React$1.createElement("div",{className:"hs-int-tos-redesign-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-header-container"},K),i.React$1.createElement("div",{className:"hs-int-tos-redesign-scrollable-content-container"},X),i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-footer-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-action-button"},i.React$1.createElement(r.Button,{onClick:m?F:U,title:ie.nextButton,variant:"primary",disabled:!f&&!m,className:"hs-int-tos-accept-button","data-uxa-log":"bt_tos_with_recipients_info_next_button"},ie.nextButton))))}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),re={nextButton:d.intl.formatMessage({id:"6752Ag",defaultMessage:"Next"}),subTitle:d.intl.formatMessage({id:"L94peq",defaultMessage:"Agree to Dropbox Sign Terms"}),emailOptedInStatement:d.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."})},oe=r.requireCssWithComponent((({onAcceptTos:e,onStart:t,logEvent:n,fileName:s,onClose:a,optInRequired:o,userHasSeenModal:h,onContinueWithoutTos:u})=>{const[m,p]=i.React$1.useState(!1),[f,_]=i.React$1.useState(!1),E=l.functionWrapperProvider(n,g.InstrFeatureType.TosWithRecipientsInfo);i.React$1.useEffect((()=>{r.ProEventsLogger.log("bt_tos_modal_self_sign_shown")}),[]);const R=()=>{t(),h?u():e(!o||f)},S=()=>_((e=>!e)),v=l.onClickWrapper(E,g.InstrActionType.AcceptTOS,R),I=l.onClickWrapper(E,g.InstrActionType.ContinueWithSignersModal,R),y=l.onClickWrapper(E,g.InstrActionType.CancelFlow,a),b=l.onClickWrapper(E,g.InstrActionType.ViewTerms,(()=>{})),T=l.onClickWrapper(E,g.InstrActionType.ViewPrivacyPolicy,(()=>{})),C=r.defineMessage({id:"pAaV0h",defaultMessage:"I agree to the <term>Dropbox Sign Terms</term>. Learn about how we use and protect your data in our <policy>Privacy Policy</policy>. We’ll create a Dropbox Sign account with your Dropbox email address, or link to your existing account."}),w=d.intl.formatMessage(r.defineMessage({id:"7KWXXT",defaultMessage:"I understand this is the legal representation of the signature."})),N=d.intl.formatMessage(C,{term:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:b},e),policy:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:T},e)}),x=()=>{p((e=>!e)),r.ProEventsLogger.log("toggle_tos_checkbox")},$=d.intl.formatMessage(C,{term:e=>e,policy:e=>e}),P=i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(r.Title,{size:"large",className:"hs-int-tos-redesign-self-sign-header"},re.subTitle),i.React$1.createElement(r.IconButton,{"aria-label":"close",className:"hs-int-tos-redesign-header-close-button",onClick:()=>{y(),p(!1)},variant:"transparent",size:"small"},i.React$1.createElement(r.UIIcon,{src:r.CloseLine}))),k=i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-container"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-content-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-sub-header"},i.React$1.createElement(r.Text,{color:"faint"},d.intl.formatMessage({id:"CIydf/",defaultMessage:"Step 1 of 3"})))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-file-icon-and-file-name"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(r.FileIcon,{path:s,"aria-label":s,role:"img",variant:"small",className:"hs-int-tos-redesign-self-sign-file-icon"}),i.React$1.createElement(r.Text,{variant:"label",size:"standard",isBold:!0,className:"hs-int-tos-redesign-self-sign-file-name"},s))))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-checkbox"},h?null:i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-terms-checkbox"},i.React$1.createElement(c.Checkbox,{onChange:x,checked:m,"aria-label":$,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(r.Text,{size:"small"},N," ",i.React$1.createElement("br",null),i.React$1.createElement("br",null)," ",w)),o&&!h?i.React$1.createElement("div",{className:"hs-int-tos-redesign-email-promotion-checkbox"},i.React$1.createElement(c.Checkbox,{onChange:S,checked:f,"aria-label":re.emailOptedInStatement,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(r.Text,{size:"small"},re.emailOptedInStatement)):null)));return i.React$1.createElement("div",{className:"hs-int-tos-redesign-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-header-container"},P),i.React$1.createElement("div",{className:"hs-int-tos-redesign-content-container"},k),i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-footer-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-action-button"},i.React$1.createElement(r.Button,{onClick:h?I:v,title:re.nextButton,variant:"primary",disabled:!m&&!h,className:"hs-int-tos-accept-button","data-uxa-log":"bt_tos_with_recipients_info_next_button"},re.nextButton))))}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),ce=({color:e})=>{const t="sapphire"===e?"#0d2484":"white";return i.React$1.createElement("svg",{width:"48",height:"40",viewBox:"0 0 48 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i.React$1.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7061 14.9679L0 7.51017L11.7888 0L23.5682 7.5045L35.3483 0L47.1366 7.51017L35.4305 14.9677L47.1368 22.4256L35.3481 29.9359L23.5683 22.4313L11.7886 29.9359L0 22.4256L11.7061 14.9679ZM23.5682 7.51584L35.2656 14.9679L23.5683 22.4199L11.871 14.9677L23.5682 7.51584ZM23.6531 39.9351L11.8644 32.4247L23.6531 24.9153L35.4419 32.4247L23.6531 39.9351Z",fill:t}))};function le(){switch(f.PAGE_LOCALE||"en_US"){case"da_DK":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-da_DK-vflev2nla.gif");case"de":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-de-vflmTVCdO.gif");case"en_GB":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-en_GB-vflmA_g94.gif");case"es":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-es-vfllHw0PM.gif");case"es_ES":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-es_ES-vflRmKQl4.gif");case"fr":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-fr-vflqcThGf.gif");case"id":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-id-vflT5Hn2D.gif");case"it":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-it-vflOYD-0N.gif");case"ja":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ja-vfliiIOOL.gif");case"ko":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ko-vflSPFPmr.gif");case"ms":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ms-vfli8wwVt.gif");case"nb_NO":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-nb_NO-vflcDuOCP.gif");case"nl_NL":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-nl_NL-vflPQqelQ.gif");case"pl":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-pl-vflwp4_NJ.gif");case"pt_BR":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-pt_BR-vflm25c60.gif");case"ru":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ru-vfl6KsI3f.gif");case"sv_SE":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-sv_SE-vflPSZhlS.gif");case"th_TH":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-th_TH-vflI-EUYa.gif");case"uk_UA":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-uk_UA-vflCSYd-h.gif");case"zh_CN":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-zh_CN-vfldFx8CJ.gif");case"zh_TW":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-zh_TW-vflbjmtiv.gif");default:return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-vfl5F6roQ.gif")}}ce.displayName="DropboxLogo";const ge={agree:d.intl.formatMessage({id:"k2WBHu",defaultMessage:"Agree"}),cancel:d.intl.formatMessage({id:"fCZlT5",defaultMessage:"Cancel"}),chooseFile:d.intl.formatMessage({id:"SvnKud",defaultMessage:"Choose a File"})};var de;!function(e){e.AcceptPage="accept_page",e.ChooseFilePage="choose_file_page"}(de||(de={}));const he=({primaryButtonText:e,onClickPrimaryButton:t,primaryButtonDisabled:n,secondaryButtonText:s,onClickSecondaryButton:a,leftColumnContent:o,rightColumnContent:c,onClose:l,blueSide:g})=>{const h=d.intl.formatMessage({id:"9yYWu+",defaultMessage:"Close"}),u=s&&a?i.React$1.createElement(r.Button,{onClick:a,title:s,variant:"opacity"},s):null,p=i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-action-buttons"},u,i.React$1.createElement("div",{style:{width:10}}),i.React$1.createElement(r.Button,{onClick:t,title:e,variant:"primary",disabled:n,className:"hs-int-tos-accept-button"},e)),[f,_]="left"===g?["hs-int-tos-container-left-col-blue","hs-int-tos-container-right-col"]:["hs-int-tos-container-left-col","hs-int-tos-container-right-col-blue"];return i.React$1.createElement("div",{className:"hs-int-tos-container"},i.React$1.createElement("div",{className:f},i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-logo"},i.React$1.createElement(ce,{color:"left"===g?"white":"sapphire"})),i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-content"},o),"left"===g?null:p),i.React$1.createElement("div",{className:_},i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-close-wrapper"},i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-close"},i.React$1.createElement(r.Button,{onClick:l,title:h,variant:"transparent",hasNoUnderline:!0},i.React$1.createElement(m.IconForm,{name:"cancel"})))),i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-content"},c),"left"===g?p:null))};he.displayName="TermsOfServiceContainer";const ue=r.requireCssWithComponent((({onAcceptTos:e,onClose:t,onStart:n,onChooseFile:s,chooseFileRequired:a,logEvent:o,optInRequired:h,pageNum:u})=>{const[m,f]=i.React$1.useState(u||1),[E,R]=i.React$1.useState(!1),[S,v]=i.React$1.useState(!1),I=l.functionWrapperProvider(o,g.InstrFeatureType.HelloSignDeepIntegrationTOS),y=({title:e,subTitle:t,textColor:n})=>i.React$1.createElement("div",null,i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-title"},i.React$1.createElement(p.Text,{fontWeight:"medium",color:n,size:"xxxlarge",className:"left-col-title-text"},e)),i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-subtitle"},i.React$1.createElement(p.Text,{color:n,size:"large",className:"left-col-subtitle-text"},t))),b=()=>{const e=de.ChooseFilePage,n=l.onClickWrapper(I,g.InstrActionType.ChooseFile,s,{extra:{tos_page_name:e}}),[a,r]=[ge.chooseFile,n],o=i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(y,{title:d.intl.formatMessage({id:"AzuKe2",defaultMessage:"Simple, secure eSignatures"}),subTitle:d.intl.formatMessage({id:"bBvwr6",defaultMessage:"Send, sign and store your most important documents - all in Dropbox"}),textColor:"text"}),i.React$1.createElement("ol",{className:"hs-int-tos-info-page-right-col-intro"},[d.intl.formatMessage({id:"hRdISa",defaultMessage:"<bold>Simply add signers</bold> by email address to send out for signature requests."},{bold:(...e)=>i.React$1.createElement(p.Text,{color:"text",size:"small",fontWeight:"medium"},e)}),d.intl.formatMessage({id:"LTJsAc",defaultMessage:"<bold>Easily prep your document</bold> by placing fields to specify the sections that needs to be signed, dated and more."},{bold:(...e)=>i.React$1.createElement(p.Text,{color:"text",size:"small",fontWeight:"medium"},e)}),d.intl.formatMessage({id:"swViYV",defaultMessage:"<bold>Choose your Dropbox folder</bold> for your signed copy to be automatically saved and safely stored."},{bold:(...e)=>i.React$1.createElement(p.Text,{color:"text",size:"small",fontWeight:"medium"},e)})].map(((e,t)=>i.React$1.createElement(p.Text,{color:"text",size:"small",key:t},i.React$1.createElement("li",null,0!==t?i.React$1.createElement("div",{style:{height:16}}):null,e)))))),c=d.intl.formatMessage({id:"tp+m7M",defaultMessage:"Dropbox Sign Deep Integration"}),h=i.React$1.createElement("div",{className:"hs-int-tos-info-page-right-col"},i.React$1.createElement("img",{src:le(),alt:c,className:"hs-int-tos-info-page-right-col-media"}));return i.React$1.createElement(he,{primaryButtonText:a,onClickPrimaryButton:r,leftColumnContent:o,rightColumnContent:h,onClose:t,blueSide:"right"})};if(1===m)return(()=>{const s=de.AcceptPage,o=l.onClickWrapper(I,g.InstrActionType.AcceptTOS,(()=>{a?f((e=>e+1)):n(),e(!h||S)}),{extra:{tos_page_name:s}}),u=l.onClickWrapper(I,g.InstrActionType.CancelFlow,t,{extra:{tos_page_name:s}}),m=l.onClickWrapper(I,g.InstrActionType.ViewTerms,(()=>{}),{extra:{tos_page_name:s}}),_=l.onClickWrapper(I,g.InstrActionType.ViewPrivacyPolicy,(()=>{}),{extra:{tos_page_name:s}}),b=i.React$1.createElement(y,{title:d.intl.formatMessage({id:"7httnm",defaultMessage:"Get documents signed with Dropbox Sign"}),subTitle:d.intl.formatMessage({id:"4Wcb1b",defaultMessage:"Dropbox Sign lets you request signatures or sign documents right from Dropbox."}),textColor:"text-inverted"}),T=r.defineMessage({id:"4DXKsB",defaultMessage:"I agree to the Dropbox Sign <term>Terms</term> and <policy>Privacy Policy</policy>."}),C=d.intl.formatMessage(T,{term:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:m},e),policy:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:_},e)}),w=d.intl.formatMessage(T,{term:e=>e,policy:e=>e}),N=d.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."}),x=i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-content"},i.React$1.createElement(p.Text,{color:"text",size:"large"},d.intl.formatMessage({id:"B9nvoc",defaultMessage:"We’ll create a Dropbox Sign account for you automatically."}),i.React$1.createElement("br",null),i.React$1.createElement("br",null),d.intl.formatMessage({id:"eL77jo",defaultMessage:"If you already have a Dropbox Sign account, we’ll link it to your Dropbox account if the email address for both are the same."})),i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-tos-content"},i.React$1.createElement(p.Text,{color:"text",size:"large"},d.intl.formatMessage({id:"HDZWlz",defaultMessage:"Click Agree to:"})),i.React$1.createElement("ul",{className:"hs-int-tos-accept-page-right-col-tos-content-list"},i.React$1.createElement("li",{className:"hs-int-tos-accept-page-right-col-tos-content-list-item"},i.React$1.createElement(p.Text,{color:"text",size:"large"},d.intl.formatMessage({id:"d0qVW8",defaultMessage:"Give Dropbox Sign full access to your Dropbox account."}))),i.React$1.createElement("li",{className:"hs-int-tos-accept-page-right-col-tos-content-list-item"},i.React$1.createElement(p.Text,{color:"text",size:"large"},d.intl.formatMessage({id:"TwhAg2",defaultMessage:"Give Dropbox full access to your Dropbox Sign account."}))))),i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-checkbox"},i.React$1.createElement(c.Checkbox,{onChange:()=>R((e=>!e)),checked:E,"aria-label":w,className:"hs-int-tos-accept-page-right-col-checkbox-square"}),i.React$1.createElement("div",{style:{width:10}}),i.React$1.createElement(p.Text,{color:"text",size:"medium"},C)),h?i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-email-promotion-checkbox"},i.React$1.createElement(c.Checkbox,{onChange:()=>v((e=>!e)),checked:S,"aria-label":N,className:"hs-int-tos-accept-page-right-col-email-promotion-checkbox-square"}),i.React$1.createElement("div",{style:{width:10}}),i.React$1.createElement(p.Text,{color:"text",size:"medium"},N)):null);return i.React$1.createElement(he,{primaryButtonText:ge.agree,onClickPrimaryButton:o,primaryButtonDisabled:!E,secondaryButtonText:ge.cancel,onClickSecondaryButton:u,leftColumnContent:b,rightColumnContent:x,onClose:u,blueSide:"left"})})();if(2===m)return a?_.safari||_.mozilla?b():(s(),null):b();throw`wrong page number in TOS page: ${m}`}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),me=r.requireCssWithComponent((({title:e,body:t,buttonName:n,learnMoreLink:s,onClose:a})=>{const[o,c]=i.react.exports.useState(!0),l=()=>{c((e=>!e)),a()},g=d.intl.formatMessage({id:"zcHXrL",defaultMessage:"Learn more"});return i.react.exports.createElement(r.Modal,{className:"hs-int-safari-unspported-modal",open:o,width:"small",isCentered:!0,withCloseButton:"Close",onRequestClose:l},i.react.exports.createElement(r.Modal.Header,{hasBottomSpacing:"title-standard"},i.react.exports.createElement(r.Title,null,e)),i.react.exports.createElement(r.Modal.Body,{hasVerticalSpacing:!1},t),i.react.exports.createElement(r.Modal.Footer,null,i.react.exports.createElement(r.Button,{variant:"transparent",onClick:()=>{r.open_tab(s)}},g),i.react.exports.createElement("div",{style:{display:"none"}},i.react.exports.createElement(r.Button,{variant:"opacity"},"Button")),i.react.exports.createElement(r.Button,{variant:"primary",onClick:l},n)))}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),pe=e=>{var{dimming:t,centeredContent:s}=e,a=n.__rest(e,["dimming","centeredContent"]);const r=["hs-int-dimmer-background",s?"hs-int-dimmer-background-centered":""],o={};return void 0!==t&&(o.backgroundColor="rgba(0, 0, 0, 0.5)"),i.React$1.createElement("div",{className:r.join(" "),style:o},a.children)};pe.displayName="Background";const fe=r.requireCssWithComponent(pe,["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]);var _e,Ee,Re;!function(e){e.APP_CONFIGURE="hellosign:configure",e.APP_ERROR="hellosign:error",e.APP_INITIALIZE="hellosign:initialize",e.DEEP_INTEGRATION_FINISHED="hellosign:deepIntegrationFinished",e.USER_CANCEL_REQUEST="hellosign:userCancelRequest",e.USER_CREATE_TEMPLATE="hellosign:userCreateTemplate",e.USER_DECLINE_REQUEST="hellosign:userDeclineRequest",e.USER_FINISH_REQUEST="hellosign:userFinishRequest",e.USER_PREP_SEND_EDITOR_CONTINUE="hellosign:userPrepSendEditorContinue",e.USER_PREP_SEND_LOG="hellosign:userPrepSendLog",e.USER_REASSIGN_REQUEST="hellosign:userReassignRequest",e.USER_SEND_REQUEST="hellosign:userSendRequest",e.USER_SIGN_REQUEST="hellosign:userSignRequest",e.USER_PREP_SEND_EDITOR_DELETE_DOC="hellosign:userPrepSendEditorDeleteDoc",e.VERIFY_DOMAIN_REQUEST="hellosign:verifyDomainRequest",e.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS="hellosign:deepIntegrationWaitingForRecipients"}(_e||(_e={})),function(e){e.RECIPIENTS_PAGE="recipients",e.EDITOR_PAGE="place-fields",e.SAVE_BACK_LOCATION_SELECTION="dropin",e.REVIEW="review",e.FINAL_LOADING="deep-integration-save-back-loading"}(Ee||(Ee={})),function(e){e.DEEP_INTEGRATION_SEND_RECIPIENTS="dropbox:deepIntegrationSendRecipients"}(Re||(Re={}));const Se=e=>"object"==typeof e&&"string"==typeof e.type&&(void 0===e.payload||"object"==typeof e.payload),ve=e=>!!Se(e)&&!(e.type!==_e.VERIFY_DOMAIN_REQUEST||!e.payload||"string"!=typeof e.payload.token),Ie={[_e.APP_CONFIGURE]:e=>!!Se(e)&&e.type===_e.APP_CONFIGURE,[_e.APP_ERROR]:e=>!!Se(e)&&e.type===_e.APP_ERROR,[_e.APP_INITIALIZE]:e=>!!Se(e)&&e.type===_e.APP_INITIALIZE,[_e.DEEP_INTEGRATION_FINISHED]:e=>!!Se(e)&&!(e.type!==_e.DEEP_INTEGRATION_FINISHED||!e.payload||"string"!=typeof e.payload.filePath),[_e.USER_CANCEL_REQUEST]:e=>!!Se(e)&&e.type===_e.USER_CANCEL_REQUEST,[_e.USER_CREATE_TEMPLATE]:e=>!!Se(e)&&e.type===_e.USER_CREATE_TEMPLATE,[_e.USER_DECLINE_REQUEST]:e=>!!Se(e)&&e.type===_e.USER_DECLINE_REQUEST,[_e.USER_FINISH_REQUEST]:e=>!!Se(e)&&e.type===_e.USER_FINISH_REQUEST,[_e.USER_PREP_SEND_EDITOR_CONTINUE]:e=>!!Se(e)&&e.type===_e.USER_PREP_SEND_EDITOR_CONTINUE,[_e.USER_PREP_SEND_LOG]:e=>!!Se(e)&&e.type===_e.USER_PREP_SEND_LOG,[_e.USER_REASSIGN_REQUEST]:e=>!!Se(e)&&e.type===_e.USER_REASSIGN_REQUEST,[_e.USER_SEND_REQUEST]:e=>!!Se(e)&&e.type===_e.USER_SEND_REQUEST,[_e.USER_SIGN_REQUEST]:e=>!!Se(e)&&e.type===_e.USER_SIGN_REQUEST,[_e.USER_PREP_SEND_EDITOR_DELETE_DOC]:e=>!!Se(e)&&e.type===_e.USER_PREP_SEND_EDITOR_DELETE_DOC,[_e.VERIFY_DOMAIN_REQUEST]:ve,[_e.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:e=>!!Se(e)&&e.type===_e.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS},ye=()=>{},be={[_e.APP_CONFIGURE]:ye,[_e.APP_ERROR]:ye,[_e.APP_INITIALIZE]:ye,[_e.DEEP_INTEGRATION_FINISHED]:ye,[_e.USER_CANCEL_REQUEST]:ye,[_e.USER_CREATE_TEMPLATE]:ye,[_e.USER_DECLINE_REQUEST]:ye,[_e.USER_FINISH_REQUEST]:ye,[_e.USER_PREP_SEND_EDITOR_CONTINUE]:ye,[_e.USER_PREP_SEND_LOG]:ye,[_e.USER_REASSIGN_REQUEST]:ye,[_e.USER_SEND_REQUEST]:ye,[_e.USER_SIGN_REQUEST]:ye,[_e.USER_PREP_SEND_EDITOR_DELETE_DOC]:ye,[_e.VERIFY_DOMAIN_REQUEST]:ye,[_e.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:ye};class Te{constructor(e,t,n={},i){this.startListening=()=>{window&&window.addEventListener("message",this.onMessageHandler)},this.stopListening=()=>{window&&window.removeEventListener("message",this.onMessageHandler)},this.onMessageHandler=e=>{if(!this.canHandleMessage(e))return;const t=e.data;if(!Se(t))return void this.unknownMessageHandler("unknown",JSON.stringify(t));if(!(0,Ie[t.type])(t))return void this.unknownMessageHandler(t.type,JSON.stringify(t));const n=this.externalHandlers[t.type];if(!n)throw`couldn't find messageHandler for message type ${t.type}`;ve(t)&&this.respondVerifyDomainRequest(t),n(t)},this.respondVerifyDomainRequest=e=>{this.allowedSource&&this.allowedSource.postMessage({type:"hellosign:verifyDomainResponse",payload:{token:e.payload.token}},this.allowedOrigin)},this.sendRecipients=e=>{this.allowedSource&&this.allowedSource.postMessage({type:Re.DEEP_INTEGRATION_SEND_RECIPIENTS,payload:e},this.allowedOrigin)},this.canHandleMessage=e=>e.origin===this.allowedOrigin&&e.source===this.allowedSource,this.allowedOrigin=e,this.allowedSource=t,this.externalHandlers=Object.assign(Object.assign({},be),n),this.unknownMessageHandler=i}static new(e,t,n={},i){return new Te(e,t,n,i)}}class Ce extends i.React$1.Component{constructor(e){super(e),this.setIframeRef=e=>{this.iframeRef=e,this.iframeRef.onload=()=>{this.setState({appInitialized:!0})}},this.getMessageHandlers=()=>({[_e.APP_INITIALIZE]:this.handleAppInitializedMessage,[_e.DEEP_INTEGRATION_FINISHED]:this.props.onComplete,[_e.USER_CREATE_TEMPLATE]:this.props.onComplete,[_e.USER_SEND_REQUEST]:this.props.onComplete,[_e.USER_CANCEL_REQUEST]:this.props.onClose,[_e.USER_PREP_SEND_LOG]:this.props.onLog,[_e.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:this.handleWaitingForRecipientsMessage}),this.handleWaitingForRecipientsMessage=()=>{if(!this.props.recipientInfo){const e=new Error("No Recipient info provided but was requested by iframe");throw o.reportException({err:e,severity:R.SEVERITY.CRITICAL,tags:["hellosign_deepintegration","better-together"]}),e}this.channel.sendRecipients(this.props.recipientInfo)},this.handleUnknownMessage=(e,t)=>{console.log(e),console.log(t)},this.handleAppInitializedMessage=()=>{this.setState({appInitialized:!0}),this.props.linkHelloSign()},this.getEditorDomain=()=>{const{url:e}=this.props,t=e.getAuthority();return`${e.getScheme()}://${t}`},this.state={appInitialized:!1}}componentDidMount(){this.channel=Te.new(this.getEditorDomain(),this.iframeRef.contentWindow,this.getMessageHandlers(),this.handleUnknownMessage),this.channel.startListening()}componentWillUnmount(){this.channel.stopListening()}render(){const{url:e}=this.props,t=i.React$1.createElement(d.IntlProvider,{defaultLocale:"en-US",locale:d.localeToBcp47LangTag(f.PAGE_LOCALE),messages:te},i.React$1.createElement("div",{className:"hs-int-hellosign-loading"},i.React$1.createElement(r.Spinner,{className:"hs-int-hellosign-spinner","aria-valuetext":"Loading large",size:"large"}),i.React$1.createElement("div",{className:"hs-int-hellosign-loading-copy"},i.React$1.createElement(r.Title,{size:"standard"},i.React$1.createElement(r.FormattedMessage,{id:"JZpfYr",defaultMessage:"Preparing document..."})))));return i.React$1.createElement("div",{className:"hs-int-hellosign-page"},!this.state.appInitialized&&t,i.React$1.createElement("iframe",{ref:this.setIframeRef,className:"hs-int-hellosign-page-iframe",src:e.toString()}))}}Ce.displayName="HelloSign";const we=r.requireCssWithComponent(Ce,["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),Ne=[".doc",".docx",".pdf",".ppsx",".ppt",".pptx",".jpg",".jpeg",".png",".xls",".xlsx",".txt",".html",".gif"],xe=()=>{const e=r.getActiveUser();return e?new r.DefaultUserApiV2Client(e):new S.NoAuthApiV2Client};class $e{constructor(t){this.optInRequired=!1,this.init=e=>{let t=e.apiV2Client||this.config.apiV2Client;void 0===e.apiV2Client&&e.user&&e.user!==this.config.user&&(t=new r.DefaultUserApiV2Client(e.user)),this.config.selfSign=!1,this.config=Object.assign(Object.assign(Object.assign({},this.config),e),{apiV2Client:t}),this.recipientInfo=void 0,this.refreshUserSettings(),this.refreshCheckSkipTos(),this.refreshFeatureVariant()},this.launch=()=>{if(!this.readyToLaunch()||!this.sendForSignatureEnabled)throw this.config.logEvent({event_name:g.InstrEventType.Failure,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:g.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),new Error("launcher isn't ready to launch. Make sure you have correctly initialized it.");return this.config.logEvent({event_name:g.InstrEventType.SelectAction,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:g.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),_.msie?(this.config.logEvent({event_name:g.InstrEventType.ActionTaken,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:g.InstrActionType.MSIEUnsupported,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.showUnsupportedBrowserSnackbar(),Promise.resolve()):Promise.all([this.sendForSignatureEnabled,this.safariFixDisabled]).then((([e,t])=>{if(!e)return this.config.logEvent({event_name:g.InstrEventType.ActionTaken,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:g.InstrActionType.FeatureDisabled,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),void this.showTeamDisabledSnackbar();if(this.config.container.show(),_.safari){if(void 0===t)throw"safariFixDisabled is not loaded.";const{variant:e}=t;if("ON"!==e)return this.config.logEvent({event_name:g.InstrEventType.ActionTaken,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:g.InstrActionType.SafariUnsupported,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),void this.showSafariUnsupportedModal()}return this.tosAccepted.then((e=>n.__awaiter(this,void 0,void 0,(function*(){const{canSkipTos:t,emailUnverified:n}=yield this.checkCanSkipTos();n?this.showVerifyEmailDialog():e||t?!_.safari&&!_.mozilla||this.config.hasOwnProperty("file")?yield this.showHelloSignPage():this.showTosChooseFilePage():yield this.showTosAcceptTermsPage()})))).catch((e=>{console.log(e),this.reset(),this.config.logEvent({event_name:g.InstrEventType.Failure,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:g.InstrActionType.Start,entry_point:this.config.entryPoint,error:e},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})})}))}))},this.hideOverflow=()=>{this.config.hasOwnProperty("file")||this.config.container.hideOverflow()},this.removeHideOverflow=()=>{this.config.hasOwnProperty("file")||this.config.container.removeHideOverflow()},this.show=()=>{this.hideOverflow(),this.config.container.show()},this.hide=()=>{this.removeHideOverflow(),this.config.container.hide()},this.resetWhenCancelled=e=>{if(e.payload&&e.payload.path)switch(e.payload.path){case Ee.RECIPIENTS_PAGE:r.UserSurvey.trackEvent("hs_exit_who_needs_to_sign_screen","hellosign_deep_integration");break;case Ee.EDITOR_PAGE:r.UserSurvey.trackEvent("hs_exit_editor","hellosign_deep_integration");break;case Ee.REVIEW:r.UserSurvey.trackEvent("hs_exit_final_send_for_sig_screen","hellosign_deep_integration")}return this.reset()},this.reset=()=>(this.config.container.reset(),this.config.templateRoute=void 0,this.removeHideOverflow(),this.recipientInfo=void 0,this.refreshCheckSkipTos(),this.refreshUserSettings()),this.showTosChooseFilePage=()=>n.__awaiter(this,void 0,void 0,(function*(){this.hideOverflow(),this.config.container.renderContent(i.React$1.createElement(fe,{dimming:!0,centeredContent:!0},i.React$1.createElement(ue,{onAcceptTos:this.acceptTosInUserSettings,onClose:this.hide,onStart:this.showHelloSignPage,onChooseFile:this.showHelloSignPage,chooseFileRequired:void 0===this.config.file,logEvent:this.config.logEvent,optInRequired:this.optInRequired,pageNum:2})))})),this.showTosAcceptTermsPage=()=>n.__awaiter(this,void 0,void 0,(function*(){const e=this.showHelloSignPage;this.hideOverflow();const t=this.config.file;if(this.config.templateFlow||!t||this.config.selfSign)if(t&&this.config.selfSign){const n=(null==t?void 0:t.fq_path)?String(null==t?void 0:t.fq_path.split("/").slice(-1)):"";this.config.container.renderContent(i.React$1.createElement(fe,{dimming:!0,centeredContent:!0},i.React$1.createElement(oe,{onAcceptTos:this.acceptTosInUserSettings,onContinueWithoutTos:this.updateRecipientsInfo,onStart:e,onClose:this.hide,logEvent:this.config.logEvent,fileName:n,optInRequired:this.optInRequired,userHasSeenModal:!1})))}else this.config.container.renderContent(i.React$1.createElement(fe,{dimming:!0,centeredContent:!0},i.React$1.createElement(ue,{onAcceptTos:this.acceptTosInUserSettings,onClose:this.hide,onStart:e,onChooseFile:e,chooseFileRequired:void 0===this.config.file,logEvent:this.config.logEvent,optInRequired:this.optInRequired})));else{const n=(null==t?void 0:t.fq_path)?String(null==t?void 0:t.fq_path.split("/").slice(-1)):"";this.config.container.renderContent(i.React$1.createElement(fe,{dimming:!0,centeredContent:!0},i.React$1.createElement(ae,{onAcceptTos:this.acceptTosInUserSettings,onContinueWithoutTos:this.updateRecipientsInfo,onStart:e,onClose:this.hide,logEvent:this.config.logEvent,fileName:n,optInRequired:this.optInRequired,userHasSeenModal:!1})))}})),this.showVerifyEmailDialog=()=>n.__awaiter(this,void 0,void 0,(function*(){return new Promise((function(t,n){e(["./c_account_email"],t,n)})).then((({EmailVerification:e})=>{const t=this.config.user||r.getActiveUser();e.get_for_user(t).show_resend_verify_modal(T.EmailVerificationReasons.SIGN_DOCUMENTS,(()=>this.reset()),{hideChangeEmail:!0})}))})),this.showSafariUnsupportedModal=()=>{const e=d.intl.formatMessage({id:"WC+meb",defaultMessage:"Couldn’t start signature request"}),t=d.intl.formatMessage({id:"vxnAb7",defaultMessage:"This feature isn’t available on Safari, but will be soon. Please try on a different browser."}),n=d.intl.formatMessage({id:"WAQpuN",defaultMessage:"Close"});this.hideOverflow(),this.config.container.renderContent(i.React$1.createElement(fe,{dimming:!0,centeredContent:!0},i.React$1.createElement(me,{title:e,body:t,buttonName:n,learnMoreLink:"https://help.dropbox.com/installs-integrations/third-party/hellosign#sign",onClose:this.reset})))},this.showFileChooser=e=>new Promise(((t,n)=>{const i={success:function(e){e.length&&t(e[0]),t(void 0)},cancel:function(){t(void 0)},linkType:"direct",multiselect:!1,extensions:Ne,folderselect:!1,initialNavigationPath:e};I.Dropbox.choose(i)})),this.showHelloSignPage=()=>n.__awaiter(this,void 0,void 0,(function*(){const{fileId:e,filePath:t}=yield this.getFileIdAndPath();if(!e)return;let n;this.hideOverflow(),_.safari&&(n=yield this.getDBXAuthLink());const s=yield this.getHelloSignUrl(e,t,n,this.allowEmailOptedIn),a=yield this.getVariant(this.signaturesTabOnShareVariant),r=yield this.getVariant(this.signaturesHubVariant);this.config.container.renderContent(i.React$1.createElement(fe,{centeredContent:!0},i.React$1.createElement(we,{onClose:this.resetWhenCancelled,onComplete:e=>this.handleSignatureRequestComplete(e,a,r),onLog:this.handleLog,recipientInfo:this.getRecipientsPayload(),url:s,linkHelloSign:this.linkHelloSignIfNecessary})))})),this.getRecipientsPayload=()=>{let e;return this.config.selfSign?e={selfSign:this.config.selfSign,signers:[],recipientReassignment:!1,recipientOrder:!1}:this.recipientInfo&&(e=this.recipientInfo),e},this.dbxCollectedRecipientInfo=()=>!!this.config.selfSign||!!this.recipientInfo,this.showTeamDisabledSnackbar=()=>{this.showFailSnackbar(d.intl.formatMessage({id:"7NLYW8",defaultMessage:"The HelloSign integration has been disabled by your admin."}),d.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}))},this.showSendForSignatureSuccessSnackbar=(e,t)=>{switch(this.config.entryPoint){case"landing_page":return void r.redirect("/hellosign/home");case"share_page_signature_tab_default":case"share_page_signature_tab_empty_state":return void r.redirect("/share/signatures");default:if(this.config.entryPoint.startsWith("signature_hub"))return void r.redirect("/signatures")}if("signature-hub"===this.config.source)return void r.redirect("/signatures");const n=this.config.user;if(!n)throw new Error("User is missing in the config.");const s={name:"track_status",icon:a.SignatureLine,onClick:function(n){const i=["rich_snackbar_click","track_signature_status",e].join("_");let s;r.ProEventsLogger.log(i,{action:"rich_snackbar_click",variant:e}),"V1"===e?s="/hellosign/home":"V2"===e?s="/share/signatures":"V1"===t||"V2"===t?s="/signatures":(o.reportException({err:new Error(`Unexpected click for feature ${g.InstrFeatureType.SignaturesTabOnShare}with variant ${e}`),severity:R.SEVERITY.NONCRITICAL,tags:["rich_snackbar","product-growth"]}),s="/hellosign/home");s+="?_tk=post_signature_send_snackbar",r.redirect(s)},text:d.intl.formatMessage({id:"6B08Qw",defaultMessage:"Track status"})},c={clickHandlerArgs:{userId:n.id,filePath:""},actions:[s],actionBarAlignment:"left"},l=d.intl.formatMessage({id:"h7GFOm",defaultMessage:"File shared for signature"});r.Snackbar.show(i.React$1.createElement(r.Snackbar,{id:"track_status_snackbar",title:l,variant:"complete",richSnackbarProps:c,timeoutDelayMs:1e4}))},this.showUnsupportedBrowserSnackbar=()=>{this.showFailSnackbar(d.intl.formatMessage({id:"Cl3pwT",defaultMessage:"This feature isn’t available on Internet Explorer. Please try on a different browser."}),d.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}))},this.showFailSnackbar=(e,t)=>{r.Snackbar.show(i.React$1.createElement(r.Snackbar,{variant:"fail",timeoutDelayMs:1e4,title:e,closeButtonText:t}))},this.showRedirectSnackbar=()=>{r.Snackbar.show(i.React$1.createElement(r.Snackbar,{variant:"complete",timeoutDelayMs:1e4,title:d.intl.formatMessage({id:"rdpIKz",defaultMessage:"Redirecting you to the file preview."})}))},this.linkHelloSignIfNecessary=()=>n.__awaiter(this,void 0,void 0,(function*(){(yield this.isHelloSignProfileServiceLinked())?this.config.logEvent({event_name:g.InstrEventType.ActionTaken,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:g.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}):yield this.linkHelloSign()})),this.getDBXAuthLink=()=>n.__awaiter(this,void 0,void 0,(function*(){if(!this.config.user)throw"launcher isn't ready to launch. Make sure you have correctly initialized it.";if(yield this.isHelloSignProfileServiceLinked())return;const e=new r.ProfileServicesLinkingHandler,t=yield e.auth_service_with_user_promise(r.ProfileServicesConstants.HELLOSIGN,this.config.user.id,null,"link_contacts",r.AuthWindowOption.HIDDEN_IFRAME,void 0,void 0,void 0,void 0,!0);return(null==t?void 0:t.dbx_auth)||void 0})),this.linkHelloSign=()=>n.__awaiter(this,void 0,void 0,(function*(){if(!this.config.user)throw"launcher isn't ready to launch. Make sure you have correctly initialized it.";const e=new r.ProfileServicesLinkingHandler;this.config.logEvent({event_name:g.InstrEventType.ServiceConnectionFlowStart,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),yield e.auth_service_with_user_promise(r.ProfileServicesConstants.HELLOSIGN,this.config.user.id,null,"link_contacts",r.AuthWindowOption.HIDDEN_IFRAME).then((({success:e})=>{e?console.log("HelloSign OAuth succeeded"):console.log("HelloSign OAuth failed")})).catch((e=>{console.log(e)})).finally((()=>{this.config.logEvent({event_name:g.InstrEventType.ServiceConnectionFlowEnd,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})})}))})),this.isHelloSignProfileServiceLinked=()=>this.config.apiV2Client.ns("profile_services").rpc("list_linked_services",void 0,{}).then((e=>e.linked_services.filter((e=>"hellosign"===e.service_type[".tag"]&&"is_connected"===e.connection_state[".tag"])).length>0)),this.getHelloSignUrl=(e,t,i,s)=>n.__awaiter(this,void 0,void 0,(function*(){var n;const a=yield this.helloSignEnvironment;if(!a)throw"launcher has not been initialized, please call init() first";const{user:o,templateFlow:c,templateRoute:l}=this.config;if(!o)throw"launcher has not been initialized with a valid user, please set a user in init() first";i&&(i=y.encode(i));let g=new v.URI;return g.setScheme("https"),g.setAuthority(a.domain),g.setPath("/dropbox/embedded"),g.updateQuery({client_id:a.client_id,user:o.account_id,role:o.role,file_id:e,file_path:t,dbx_auth:i,email_optin:"boolean"==typeof s?String(s):void 0,utm_source:null!==(n=this.config.utmSource)&&void 0!==n?n:"dropbox-deep-integration",dbx_locale:f.PAGE_LOCALE,di_hs_home:"1",rpbhp:String(this.dbxCollectedRecipientInfo())}),this.isOnDevbox()&&g.updateQuery({parent_url:r.get_origin()}),c&&(g.updateQuery({template:"1"}),l&&(l.startsWith("http")?(g=v.URI.parse(l),g.updateQuery({client_id:a.client_id,parent_url:window.location.href,js_version:"2.0"})):g.setPath(l))),g})),this.isOnDevbox=()=>/^https:\/\/.*\.dev\.corp\.dropbox\.com$/.test(r.get_origin()),this.getFileIdAndPath=()=>n.__awaiter(this,void 0,void 0,(function*(){let e=this.config.file;if(!e){!_.safari&&!_.mozilla&&this.hide();const t=yield this.showFileChooser(this.config.fileChooserInitialNavigationPath);if(!t)return{};!_.safari&&!_.mozilla&&this.show(),e={file_id:t.id}}return e?e.fq_path?{fileId:e.file_id,filePath:e.fq_path.split("/").slice(0,-1).join("/")}:{fileId:e.file_id}:{}})),this.readyToLaunch=()=>!("unknown"===this.config.entryPoint||void 0===this.tosAccepted||!this.config.user),this.refreshUserSettings=()=>{const e=this.config.apiV2Client.ns("integrations").rpc("get_user_settings",{},{});return this.config.logEvent({event_name:g.InstrEventType.APITrace,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"get_user_settings",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),e.then((e=>{var t;this.optInRequired=!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.opt_in_required)})),this.tosAccepted=e.then((e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.tos_accepted)})),this.helloSignEnvironment=e.then((e=>e.hellosign_environment)),this.sendForSignatureEnabled=e.then((e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.send_for_signature_enabled)})),this.userSawSignersModal=e.then((e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.user_saw_signers_modal)})),Promise.all([this.tosAccepted,this.helloSignEnvironment,this.sendForSignatureEnabled,this.userSawSignersModal])},this.refreshCheckSkipTos=()=>n.__awaiter(this,void 0,void 0,(function*(){this.canSkipTosRequest=this.config.apiV2Client.ns("hellosign").rpc("ensure_dropbox_managed_link",void 0,{})})),this.refreshFeatureVariant=()=>{const e=this.config.apiV2Client.ns("integrations").rpc("are_features_available",{features:[{feature:g.InstrFeatureType.HelloSignDeepIntegrationSafariFixDisabled},{feature:g.InstrFeatureType.SignaturesTabOnShare},{feature:g.InstrFeatureType.SignaturesHub}]},{});return this.config.logEvent({event_name:g.InstrEventType.APITrace,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"are_features_available",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.safariFixDisabled=e.then((e=>e.features[0])),this.signaturesTabOnShareVariant=e.then((e=>e.features[1])),this.signaturesHubVariant=e.then((e=>e.features[2])),Promise.all([this.safariFixDisabled,this.signaturesTabOnShareVariant,this.signaturesHubVariant])},this.acceptTosInUserSettings=(e,t)=>{t?this.config.apiV2Client.ns("integrations").rpc("set_user_settings",{hellosign_settings:{tos_accepted:!0,user_saw_signers_modal:!0}},{}).then((()=>{this.tosAccepted=Promise.resolve(!0),this.userSawSignersModal=Promise.resolve(!0)})):this.config.apiV2Client.ns("integrations").rpc("set_user_settings",{hellosign_settings:{tos_accepted:!0}},{}).then((()=>{this.tosAccepted=Promise.resolve(!0)})),this.config.logEvent({event_name:g.InstrEventType.APITrace,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"set_user_settings",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.allowEmailOptedIn=e,this.updateRecipientsInfo(t)},this.updateRecipientsInfo=e=>{const t=null==e?void 0:e.filter((e=>!!e.name));if(t&&t.length>0){const e={selfSign:!1,signers:t,recipientReassignment:!1,recipientOrder:!1};this.recipientInfo=e}else t&&0===t.length&&(this.config.selfSign=!0)},this.getFileExtensionForLog=e=>{if(!e)return"file_not_selected";try{let t;return e.filename?t=r.file_extension(e.filename):e.fq_path&&(t=r.file_extension(r.filename(e.fq_path))),t?Ne.includes("."+t)?t:"not_in_loggable_allowlist":"file_name_unknown"}catch(e){return"error_getting_filename"}},this.handleSignatureRequestComplete=(e,t,n)=>{var i,s,a,o;if(e&&e.payload&&"contract_management_send_for_signature"===this.config.entryPoint)return this.config.logEvent({event_name:g.InstrEventType.UpdateFile,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),e.type===_e.DEEP_INTEGRATION_FINISHED&&(null===(s=(i=this.config).afterComplete)||void 0===s||s.call(i,e.payload)),void this.reset();if(this.logSignaturesTabOnShareExposure(g.InstrFeatureType.SignaturesTabOnShare,t),e&&e.payload){const i=Object.assign(Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),e.type!==_e.USER_CREATE_TEMPLATE&&e.payload.signatureRequestId?{signature_request_id:e.payload.signatureRequestId}:{}),{file_extension:this.getFileExtensionForLog(this.config.file),self_sign:e.payload.isSelfSign,template_guid:e.payload.template_guid});switch(this.config.logEvent({event_name:g.InstrEventType.UpdateFile,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:i}),e.type){case _e.USER_SEND_REQUEST:this.config.logEvent({event_name:g.InstrEventType.UseTemplateComplete,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:i});break;case _e.USER_CREATE_TEMPLATE:this.config.logEvent({event_name:g.InstrEventType.CreateOrEditTemplateComplete,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:i});break;case _e.DEEP_INTEGRATION_FINISHED:default:let e=g.InstrEventType.SendForSignatureComplete;i.self_sign&&(e=g.InstrEventType.SelfSignComplete),this.config.logEvent({event_name:e,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:i})}const s=e.payload.filePath,a=e.payload.isDocToTemplateEnabled;if((this.isSignaturesTabOnShareExpOn(t)||this.isSignaturesHubOn(n))&&e.type===_e.DEEP_INTEGRATION_FINISHED)this.showSendForSignatureSuccessSnackbar(t,n);else if(!["signature_hub_create_template","signature_hub_use_template","signature_hub_edit_template","signature_hub_delete_template","signature_hub_empty_template_tab_create_template","signature_hub_snackbar_use_template"].includes(this.config.entryPoint))if(this.showRedirectSnackbar(),this.config.entryPoint.startsWith("signature_hub"))r.redirect(v.URI.parse("/signatures").toString());else if(s&&s.includes("/hellosign/home")){const e=v.URI.parse(s);e.updateQuery({new:"1"}),a&&e.updateQuery({"doc-to-template":"1"}),r.redirect(e.toString())}else if(e.type===_e.USER_CREATE_TEMPLATE){const t=e.payload.template_guid,n=v.URI.parse("/hellosign/templates");t&&n.updateQuery({guid:t,"use-template-modal":"1"}),r.redirect(n.toString())}else if(e.type===_e.USER_SEND_REQUEST){const t=v.URI.parse("/hellosign/home"),n=e.payload.signatureRequestId;n&&t.updateQuery({request:n}),a&&t.updateQuery({"doc-to-template":"1"}),r.redirect(t.toString())}else r.redirect(new v.URI({path:`/preview${s}`}).toString())}null===(o=(a=this.config).afterComplete)||void 0===o||o.call(a,e.payload),this.reset()},this.checkCanSkipTos=()=>n.__awaiter(this,void 0,void 0,(function*(){var e;let t=!1,n=!1;try{yield this.canSkipTosRequest,t=!0}catch(t){"unverified_email"===(null===(e=t.error)||void 0===e?void 0:e[".tag"])&&(n=!0)}return{canSkipTos:t,emailUnverified:n}})),this.getVariant=e=>n.__awaiter(this,void 0,void 0,(function*(){if(!e)return!1;const t=yield e;if(void 0===t)return!1;const{available:n,variant:i}=t;return"available"===n[".tag"]&&void 0!==i&&"OFF"!==i&&i})),this.config=t,I.Dropbox.init({appKey:"dropbox",productKey:"hellosign"})}handleLog(e){var t;this.config.logEvent({event_name:g.InstrActionType.PrepSendLog,feature_name:g.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign(Object.assign({entry_point:this.config.entryPoint},null!==(t=null==e?void 0:e.payload)&&void 0!==t?t:{}),this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})})}isSignaturesTabOnShareExpOn(e){return"V1"===e||"V2"===e}isSignaturesHubOn(e){return"V1"===e||"V2"===e}logSignaturesTabOnShareExposure(e,t){if(this.isSignaturesTabOnShareExpOn(t)){(new b.StormcrowExposureLogger).logExposure(e,t);const n={stormcrowVariantInfo:{feature:e,variant:t}};r.getGatingClientSingleton().logExposure(n)}}}const Pe=C.memoize((()=>{const e={entryPoint:"unknown",container:new ne,apiV2Client:xe(),logEvent:r.createIntegrationsActionsLogger().logEvent,user:r.getActiveUser()};return new $e(e)}));t.HELLOSIGN_SUPPORTED_EXTENSIONS=Ne,t.getLauncher=Pe}));
//# sourceMappingURL=c_integrations_hellosign_deep_integration_launcher.js-vflCnTa18.map
