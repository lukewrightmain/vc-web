define("typescript/dropbox/proto/js_init_data/web_timing_logger/web_timing_logger_pb",["require","exports","@bufbuild/protobuf"],(function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebTimingLoggerServerContext_DWSOptions=e.WebTimingLoggerServerContext_SourceType=e.WebTimingLoggerServerContext=void 0;class n extends i.Message{constructor(t){super(),this.isDws=!1,this.sourceType=s.UNKNOWN,this.subtypes={},this.url="",i.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new n).fromBinary(t,e)}static fromJson(t,e){return(new n).fromJson(t,e)}static fromJsonString(t,e){return(new n).fromJsonString(t,e)}static equals(t,e){return i.proto3.util.equals(n,t,e)}}var s;e.WebTimingLoggerServerContext=n,n.runtime=i.proto3,n.typeName="web_timing_logger.WebTimingLoggerServerContext",n.fields=i.proto3.util.newFieldList(()=>[{no:1,name:"is_dws",kind:"scalar",T:8},{no:2,name:"dws_opts",kind:"message",T:r},{no:3,name:"source_type",kind:"enum",T:i.proto3.getEnumType(s)},{no:4,name:"subtypes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"url",kind:"scalar",T:9}]),(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.DESKTOP_WEB=1]="DESKTOP_WEB",t[t.MOBILE_WEB=2]="MOBILE_WEB"})(s=e.WebTimingLoggerServerContext_SourceType||(e.WebTimingLoggerServerContext_SourceType={})),i.proto3.util.setEnumType(s,"web_timing_logger.WebTimingLoggerServerContext.SourceType",[{no:0,name:"UNKNOWN"},{no:1,name:"DESKTOP_WEB"},{no:2,name:"MOBILE_WEB"}]);class r extends i.Message{constructor(t){super(),this.isDws2=!1,this.isEarlyEnsemble=!1,this.jsPreloading=!1,i.proto3.util.initPartial(t,this)}static fromBinary(t,e){return(new r).fromBinary(t,e)}static fromJson(t,e){return(new r).fromJson(t,e)}static fromJsonString(t,e){return(new r).fromJsonString(t,e)}static equals(t,e){return i.proto3.util.equals(r,t,e)}}e.WebTimingLoggerServerContext_DWSOptions=r,r.runtime=i.proto3,r.typeName="web_timing_logger.WebTimingLoggerServerContext.DWSOptions",r.fields=i.proto3.util.newFieldList(()=>[{no:1,name:"is_dws2",kind:"scalar",T:8},{no:2,name:"is_early_ensemble",kind:"scalar",T:8},{no:3,name:"js_preloading",kind:"scalar",T:8}])})),define("metaserver/static/js/perf_tools/resource_utils",["require","exports","tslib","metaserver/static/js/clean/js_client_stopwatch","metaserver/static/js/perf_tools/cpu_utils"],(function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.summarizePerformanceResourceTimings=e.logResourceTiming=e.logResourcesData=void 0,s=i.__importStar(s),e.logResourcesData=function(t){(function(t){const e=window.requireContexts;if(!e)return;const i=s.listExecutionPerfMeasurementsForRequireContexts(e),r=n.JSStopwatch.createDetachedStopwatch("resource_init_timeline",t);i.forEach(t=>{const e=r.startSpan(t.name,{startTime:t.startTime});r.addSpanAnnotation(t.name,"totalTimeNs",Math.round(1e6*t.totalTime).toString(),e),r.endSpan(t.name,{endTime:t.startTime+t.totalTime,spanId:e})}),r.logData()})(t),(function(t){const e=n.JSStopwatch.createDetachedStopwatch("resource_timeline",t),i={},s=window.performance.getEntriesByType("resource");if(s instanceof Array)for(const t of s){let n=o(t);if(!n)continue;const s=i[n]||0;i[n]=s+1,s>0&&(n=`${n}-${s}`);const r=e.startSpan(n,{startTime:t.startTime,async:!0}),c=a(t);e.addSpanAnnotation(n,"type",c,r),0===t.transferSize?e.addSpanAnnotation(n,"cached","true",r):void 0===t.transferSize?e.addSpanAnnotation(n,"cached","unknown",r):e.addSpanAnnotation(n,"cached","false",r),t.responseEnd<t.startTime?(e.addSpanAnnotation(n,"negativeSpanLength",(t.responseEnd-t.startTime).toString(),r),e.endSpan(n,{endTime:t.startTime,spanId:r})):e.endSpan(n,{endTime:t.responseEnd,spanId:r})}e.logData()})(t)};const r=document&&document.createElement?document.createElement("a"):null;function o(t){if(r){if(r.href=t.name,r.host.match(/dropboxstatic.com$/)&&r.pathname.match(/^\/static/)){let t=r.pathname;const e=t.match(/vfl[a-zA-Z0-9]*\.[a-z]*$/);e&&e.index&&(t=t.substring(0,e.index-1));const i="/static/";return t.startsWith(i)&&(t=t.substring(i.length)),t}return r.host.match(/photos-[0-9]+.dropbox.com$/)&&r.pathname.match(/^\/t\/2/)?"/thumbnail":void 0}}function a(t){const{name:e,initiatorType:i}=t,n=e.lastIndexOf(".");if(n>0){const t=e.substring(n);if([".png",".gif",".jpg",".svg"].indexOf(t)>-1)return"img";if(".js"===t)return"script";if(".css"===t)return"css"}return-1===["css","img","script","link"].indexOf(i)?"xmlhttprequest"===i?"ajax":"other":i}e.logResourceTiming=function(t){const e=window.performance.getEntriesByType("resource").filter(e=>-1!==e.name.indexOf(t))[0];if(!e||!e.responseEnd)return;const i=`resource_response_end_${t}`;return n.JSStopwatch.create_stopwatch_if_not_exist("resource_timing"),n.JSStopwatch.recordTrace(i,{stopwatchName:"resource_timing",traceTime:e.responseEnd}),e},e.summarizePerformanceResourceTimings=function(t,e){const i={pre:{},total:{}};if(n.JSStopwatch.create_stopwatch_if_not_exist("resource_timeline"),t instanceof Array)for(const n of t){const t=a(n),s=[];e&&n.responseEnd<=e&&(t in i.pre||(i.pre[t]={count:0,total_time:0,last_transfer_end:0}),s.push(i.pre[t])),t in i.total||(i.total[t]={count:0,total_time:0,last_transfer_end:0}),s.push(i.total[t]),s.forEach((function(e){var i;e.count++,e.total_time+=n.duration,e.last_transfer_end=Math.max(e.last_transfer_end,n.responseEnd),("css"===(i=t)||"script"===i||"img"===i||"video"===i)&&void 0!==n.transferSize&&void 0!==n.encodedBodySize&&n.encodedBodySize<Number.MAX_SAFE_INTEGER&&(e.total_size=e.total_size||0,e.transfer_size=e.transfer_size||0,0!==n.transferSize&&(e.transfer_size+=n.encodedBodySize),e.total_size=e.total_size||0,e.total_size+=n.encodedBodySize)}))}return i}})),define("metaserver/static/js/clean/js_client_stopwatch",["require","exports","tslib","metaserver/static/js/core/xhr","metaserver/static/js/clean/js_basic_stopwatch","metaserver/static/js/modules/constants/request","metaserver/static/js/core/assert","metaserver/static/js/core/browser","metaserver/static/js/core/exception"],(function(t,e,i,n,s,r,o,a,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JSStopwatch=e.ReservedAnnotationKey=void 0,r=i.__importStar(r),a=i.__importStar(a);class _{constructor(t){this.id=t}}e.ReservedAnnotationKey=_,_.REQUEST_ID=new _("dropbox.js_client_stopwatch.request_id"),_.CORRELATION_ID=new _("dropbox.js_client_stopwatch.correlation_id"),_.URL=new _("dropbox.js_client_stopwatch.url");class l{constructor(){this.GLOBAL_SW_NAME="GLOBAL_STOPWATCH",this.flush_interval=6e4,this.debugEnabled=!0,this.strictAssert=!1,this.intervalId=null,this.clientStopwatchCounter=1,this.reset()}reset(){this.globalStopwatches={},this.clientStopwatches={},this.clientStopwatchCounter=1,this.sentInitialData=!1,this.create_stopwatch(this.GLOBAL_SW_NAME),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null}reset_individual_stopwatch(t){this.stopwatch_exists(t)?this.globalStopwatches[t].reset():this._report_sw_misuse(`tried to reset the stopwatch ${t} but it does not exist`)}stopwatch_exists(t){return t in this.globalStopwatches}create_stopwatch(t,e){this.stopwatch_exists(t)?this._report_sw_misuse(`tried to create a new stopwatch ${t} but it already exists`):this.globalStopwatches[t]=(0,s.createStopwatch)(t,this.strictAssert,e)}createDetachedStopwatch(t,e={}){const i=(0,s.createStopwatch)(t,this.strictAssert,e.tags,!0,e.annotations),n=new d(this.clientStopwatchCounter++,t,i,e.request_id,e.correlation_id,e.url);return this.clientStopwatches[n.id]=n,n}deleteStopwatch(t){delete this.clientStopwatches[t.id]}create_stopwatch_if_not_exist(t,e){this.stopwatch_exists(t)||this.create_stopwatch(t,e)}getStopwatch(t){return this.stopwatch_exists(t)?this.globalStopwatches[t]:(this._report_sw_misuse(`${t} doesn't exist`),null)}recordTrace(t,e={}){const i=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null==i)return;const n={traceTime:e.traceTime};return i.recordTrace(t,n)}startSpan(t,e={}){const i=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null==i)return;const n={startTime:e.startTime,async:e.async};return i.start(t,n)}endSpan(t,e={}){const i=this.getStopwatch(e.stopwatchName||this.GLOBAL_SW_NAME);if(null!=i)return i.end(t,{spanId:e.spanId,endTime:e.endTime})}addSpanAnnotation(t,e,i,n={}){const s=this.getStopwatch(n.stopwatchName||this.GLOBAL_SW_NAME);null!=s&&s.addSpanAnnotation(t,e,i,n.spanId)}log_stored_results(){this.sentInitialData?this._report_sw_misuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.flush_current_data(),this.sentInitialData=!0,this.intervalId=setInterval(this.flush_current_data.bind(this),this.flush_interval))}_report_sw_misuse(t){t=`ClientStopwatch: ${t}`,this.strictAssert?(0,o.assert)(!1,t):(0,c.reportStack)(t,{severity:c.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})}flush_current_data(){for(const t in this.globalStopwatches)this.globalStopwatches.hasOwnProperty(t)&&l.logStopwatchData(this.globalStopwatches[t]);for(const t in this.clientStopwatches)this.clientStopwatches.hasOwnProperty(t)&&l.logStopwatchData(this.clientStopwatches[t].stopwatch)}static logStopwatchData(t){const e=t.popResolvedSpans(),i=t.name,n={};if(Object.keys(e).length>l.MAXSPANS){let s=0;n[i]={};for(const r in e)e.hasOwnProperty(r)&&(n[i][r]=e[r],s===l.MAXSPANS&&(n[i].annotations=t.annotations,l.send_spans(n),s=0,n[i]={}),s++)}else n[i]=e;0!==Object.keys(n[i]).length&&(n[i].annotations=t.annotations,l.send_spans(n))}static send_spans(t){const e=JSON.stringify(t),i={request_id:r.REQUEST_ID,url:a.get_href().replace("/dws2",""),aggregated_sw_data:e};(0,n.sendXhr)("/log_js_sw_data",i)}print_stopwatches_debug(){const t=this.get_debug_data();console.table&&console.groupCollapsed&&console.groupEnd&&t&&t.length>0&&(console.groupCollapsed("Request timeline"),console.table(t),console.groupEnd())}get_debug_data(){const t=[];for(const e in this.globalStopwatches)if(this.globalStopwatches.hasOwnProperty(e)){const i=this.globalStopwatches[e].peekResolvedSpans();for(const n in i)if(i.hasOwnProperty(n)){const r=i[n],o={stopwatchName:e,spanName:r.name,time:r.start_time+r.total_time};r.type!==s.TimingDataType.AsyncSpan&&r.type!==s.TimingDataType.Span||(o.startTime=r.start_time),r.type===s.TimingDataType.Span&&(o.info=`Total time: ${r.total_time}ms`),t.push(o)}}return t.sort((t,e)=>t.time-e.time),t}}l.MAXSPANS=2e3,e.JSStopwatch=new l;class d{constructor(t,e,i,n,s,r){this.sentInitialData=!1,this.strictAssert=!1,this.id=t,this.stopwatch=i,this._request_id=n,this._correlation_id=s,this._url=r,this._request_id&&this.stopwatch.addAnnotation(_.REQUEST_ID.id,this._request_id),this._correlation_id&&this.stopwatch.addAnnotation(_.CORRELATION_ID.id,this._correlation_id),this._url&&this.stopwatch.addAnnotation(_.URL.id,this._url)}set request_id(t){this._request_id=t,this._request_id?this.stopwatch.addAnnotation(_.REQUEST_ID.id,this._request_id):this.stopwatch.removeAnnotation(_.REQUEST_ID.id)}set correlation_id(t){this._correlation_id=t,this._correlation_id?this.stopwatch.addAnnotation(_.CORRELATION_ID.id,this._correlation_id):this.stopwatch.removeAnnotation(_.CORRELATION_ID.id)}set url(t){this._url=t,this._url?this.stopwatch.addAnnotation(_.URL.id,this._url):this.stopwatch.removeAnnotation(_.URL.id)}startSpan(t,e){return this.stopwatch.start(t,e)}endSpan(t,e){return this.stopwatch.end(t,e)}addSpanAnnotation(t,e,i,n){this.stopwatch.addSpanAnnotation(t,e,i,n)}recordTrace(t,e,i){this.stopwatch.recordTrace(t,{traceTime:e,annotations:i})}recordEntries(t){for(const e of t)if(e.type===s.TimingDataType.Trace)this.recordTrace(e.name,e.endTime,e.annotations);else{const t=e.startTime||0,i=this.startSpan(e.name,{startTime:Math.min(t,e.endTime),async:e.type===s.TimingDataType.AsyncSpan,annotations:e.annotations});e.endTime<t&&this.addSpanAnnotation(e.name,"negativeSpanLength",(e.endTime-t).toString(),i),this.endSpan(e.name,{spanId:i,endTime:Math.max(t,e.endTime)})}}logData(){this.sentInitialData?this.reportMisuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.stopwatch.attach(),this.sentInitialData=!0,setTimeout(()=>{e.JSStopwatch.flush_current_data()},0))}addAnnotation(t,e){this.stopwatch.addAnnotation(t,e)}removeAnnotation(t){this.stopwatch.removeAnnotation(t)}reportMisuse(t){t=`ClientStopwatch: ${t}`,this.strictAssert?(0,o.assert)(!1,t):(0,c.reportStack)(t,{severity:c.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})}}})),define("metaserver/static/js/clean/js_basic_stopwatch",["require","exports","metaserver/static/js/core/assert","metaserver/static/js/core/exception"],(function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createStopwatch=e.NoopStopwatchInstance=e.JSBasicStopwatchImpl=e.TimingDataType=void 0;const s=!(!window.performance||!window.performance.now);let r=0;var o;(function(t){t[t.Span=1]="Span",t[t.AsyncSpan=2]="AsyncSpan",t[t.Trace=3]="Trace"})(o=e.TimingDataType||(e.TimingDataType={}));class a{constructor(t,e,i,n=!1,s){this.name=t,this.strictAssert=e,this.activeSpans={},this.aggregateSpans={},this._annotations=Object.assign({},s),this.spanStack=[],this.stopwatchTags=i||[],this.detached=n}reset(){this.activeSpans={},this.spanStack=[],this.aggregateSpans={},this._annotations={}}get annotations(){return this._annotations}addAnnotation(t,e){this._annotations[t]=e}removeAnnotation(t){delete this._annotations[t]}popResolvedSpans(){if(this.detached)return{};{const t=this.aggregateSpans;return this.aggregateSpans={},t}}peekResolvedSpans(){return this.detached?{}:this.aggregateSpans}static newSpanID(){const t=String(r);return r++,t}static resolveTime(t){return void 0===t&&(t=window.performance.now()),Math.round(t)}_resolveParent(t){if(t.type!==o.Span)return void(t.parent="");const e=this.spanStack[this.spanStack.length-1];if(e)if(e!==t.name)this._report_sw_misuse(`Closing ${e} while the latest open span is ${t.name}.\n        You are either mixing sync and async spans or closing sync spans out of order.`);else{this.spanStack.pop();let e="";for(const t of this.spanStack)e+=`${t}#`;t.parent=e}else this._report_sw_misuse(`${t.name} isn't a synchronous span and has to be started with "async:true".`)}recordTrace(t,e={}){const i=a.resolveTime(e.traceTime),n=a.newSpanID(),s={name:t,span_id:n,start_time:0,end_time:i,annotations:Object.assign({},e.annotations),type:o.Trace,parent:""};return this.recordSpan(this.stopwatchTags,s),n}start(t,e={}){t||this._report_sw_misuse("Reporting a span without a name");const i=a.resolveTime(e.startTime);e.async||this.spanStack.push(t);const n=a.newSpanID(),s={name:t,span_id:n,start_time:i||0,annotations:Object.assign({},e.annotations),type:e.async?o.AsyncSpan:o.Span};return t in this.activeSpans||(this.activeSpans[t]=[]),this.activeSpans[t].push(s),n}end(t,e={}){const i=this.findTimerDataIndex(t,e.spanId);if(-1===i)return;const n=this.activeSpans[t],s=n[i];n.splice(i,1),this._resolveParent(s);const r=a.resolveTime(e.endTime);if(!(r<s.start_time))return s.end_time=r,this.recordSpan(this.stopwatchTags,s),s.span_id;this._report_sw_misuse(`span ${t} has set an endTime earlier than start_time`)}addSpanAnnotation(t,e,i,n){const s=this.findTimerDataIndex(t,n);-1!==s&&(this.activeSpans[t][s].annotations[e]=i)}attach(){this.detached=!1}findTimerDataIndex(t,e){if(!(t in this.activeSpans)||0===this.activeSpans[t].length)return this._report_sw_misuse(`tried to find ${t} but that span doesn't exist`),-1;let i=-1;const n=this.activeSpans[t];if(void 0===e)i=0;else for(let t=0;t<n.length;t++)if(n[t].span_id===e){i=t;break}return-1===i&&this._report_sw_misuse(`tried to find ${t} with id ${e} but that span doesn't exist`),i}_report_sw_misuse(t){t=`JSBasicStopwatch ${this.name}: ${t}`,this.strictAssert?(0,i.assert)(!1,t):(0,n.reportStack)(t,{severity:n.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})}recordSpan(t,e){const i=`${e.parent}${e.name}`;i in this.aggregateSpans||(this.aggregateSpans[i]={name:e.name,start_time:e.start_time,total_time:0,num_calls:0,annotations:Object.keys(e.annotations).length>0?e.annotations:void 0,parent:e.parent||"",stopwatch_tags:t.length>0?t:void 0,type:e.type});const n=this.aggregateSpans[i];if(void 0!==e.end_time){if(n.type===o.Trace?(n.total_time=e.end_time-e.start_time,n.num_calls=1):(n.total_time+=e.end_time-e.start_time,n.num_calls+=1),Object.keys(e.annotations).length>0)if(n.annotations)for(const t in e.annotations)e.annotations.hasOwnProperty(t)&&(n.annotations[t]=e.annotations[t]);else n.annotations=e.annotations}else this._report_sw_misuse(`Span ${i} reported with undefined end_time`)}}e.JSBasicStopwatchImpl=a;e.NoopStopwatchInstance=new class{constructor(){this.name="",this.annotations={}}reset(){}attach(){}addAnnotation(t,e){}removeAnnotation(t){}popResolvedSpans(){return{}}peekResolvedSpans(){return{}}start(t,e){}end(t,e){}recordTrace(t,e){}addSpanAnnotation(t,e,i,n){}},e.createStopwatch=function(t,i,n,r=!1,o){return s?new a(t,i,n,r,o):e.NoopStopwatchInstance}})),define("metaserver/static/js/perf_tools/cpu_utils",["require","exports","metaserver/static/js/clean/js_client_stopwatch"],(function(t,e,i){"use strict";var n;function s(t){if(t.require&&t.require.perfMeasurements){let e=0;return t.require.perfMeasurements.map(({name:t,startTime:i,totalTime:n})=>(t.endsWith("anon")&&(t+="-"+e++),{jsExecutionType:c(t),name:t,startTime:i,totalTime:n}))}{const e=t.module_callback_times;return Object.keys(e).filter(t=>e[t].callbackDuration&&e[t].callbackTime).map(t=>({jsExecutionType:c(t),name:t,startTime:e[t].callbackTime,totalTime:e[t].callbackDuration}))}}function r(t){let e=[];for(const i in t)if(t.hasOwnProperty(i)){const n=t[i];e=e.concat(s(n))}return e}function o(t){return Object.keys(t).map(e=>{const i=t[e];return{measurement:{jsExecutionType:a(e),name:e,startTime:i.start,totalTime:i.end-i.start},annotations:i.annotations}})}function a(t){return t.startsWith("dws-processChunk")?n.DWS:n.UNKNOWN}function c(t){return t.startsWith("execCb.anon")||t.startsWith("overhead.anon")||t.startsWith("execCb.require-tier")||t.startsWith("overhead.require-tier")?n.OTHER:t.startsWith("execCb")||t.startsWith("overhead")?n.MODULE:n.UNKNOWN}Object.defineProperty(e,"__esModule",{value:!0}),e.logCumulativeExecutionTimes=e.cumulativeExecutionTimesBefore=e.listAnnotatedExecutionPerfMeasurementsForEnsemble=e.listExecutionPerfMeasurementsForRequireContexts=e.getAllGlobalExecutionPerfMeasurements=e.ALL_JS_EXECUTION_TYPES=e.JSExecutionType=void 0,(function(t){t.DWS="dws",t.MODULE="module",t.OTHER="other",t.UNKNOWN="unknown"})(n=e.JSExecutionType||(e.JSExecutionType={})),e.ALL_JS_EXECUTION_TYPES=[n.DWS,n.MODULE,n.OTHER,n.UNKNOWN],e.getAllGlobalExecutionPerfMeasurements=function(){let t=[];return window.ensemble&&window.ensemble.getJSStopwatchData&&(t=t.concat(o(window.ensemble.getJSStopwatchData()).map(({measurement:t})=>t))),window.requireContexts&&(t=t.concat(r(window.requireContexts))),t},e.listExecutionPerfMeasurementsForRequireContexts=r,e.listAnnotatedExecutionPerfMeasurementsForEnsemble=o,e.cumulativeExecutionTimesBefore=function(t,e){const i={};for(const n in t)if(t.hasOwnProperty(n)){const s=t[n];i[n]={},e.forEach(t=>{0<t.startTime&&t.startTime<s&&(i[n][t.jsExecutionType]=i[n][t.jsExecutionType]||0,i[n][t.jsExecutionType]+=t.totalTime)})}return i},e.logCumulativeExecutionTimes=function(t,n){const s=i.JSStopwatch.createDetachedStopwatch("cumulative_cpu_time",t);for(const t in n)n.hasOwnProperty(t)&&e.ALL_JS_EXECUTION_TYPES.forEach(e=>{s.recordTrace(`cpu_before_${t}_due_to_${e}`,n[t][e]||0)});s.logData()}})),define("metaserver/static/js/perf_tools/browser_perf_utils",["require","exports","tslib","metaserver/static/js/core/xhr","metaserver/static/js/modules/constants/request","metaserver/static/js/clean/js_client_stopwatch","metaserver/static/js/modules/constants/webtiming"],(function(t,e,i,n,s,r,o){"use strict";function a(t){const e=window.performance.timing,i={navigation_start:e.navigationStart,unload_event_start:e.unloadEventStart,unload_event_end:e.unloadEventEnd,redirect_start:e.redirectStart,redirect_end:e.redirectEnd,fetch_start:e.fetchStart,domain_lookup_start:e.domainLookupStart,domain_lookup_end:e.domainLookupEnd,connect_start:e.connectStart,secure_connect_start:e.secureConnectionStart,connect_end:e.connectEnd,request_start:e.requestStart,response_start:e.responseStart,response_end:e.responseEnd,dom_loading:e.domLoading,dom_interactive:e.domInteractive,dom_content_loaded_event_start:e.domContentLoadedEventStart,dom_content_loded_event_end:e.domContentLoadedEventEnd,dom_complete:e.domComplete,load_event_start:e.loadEventStart,load_event_end:e.loadEventEnd},a={};a.request_id=s.REQUEST_ID,a.referrer=document.referrer;const c=r.JSStopwatch.createDetachedStopwatch("browser_perf",t);for(const t in i)i.hasOwnProperty(t)&&(a[t]=i[t],i[t]&&c.recordTrace(t,i[t]-e.navigationStart));c.logData(),o.LOG_BROWSER_PERFORMANCE_INFO&&n.sendXhr("/alternate_wtl_browser_performance_info",a)}Object.defineProperty(e,"__esModule",{value:!0}),e.logBrowserPerformanceInfo=e.logBrowserPerfData=void 0,n=i.__importStar(n),s=i.__importStar(s),o=i.__importStar(o),e.logBrowserPerfData=function(t){(function(t){const e=r.JSStopwatch.createDetachedStopwatch("performance_marks",t),i=window.performance.getEntriesByType("mark");if(i instanceof Array)for(const t of i)e.recordTrace(t.name,t.startTime);e.logData()})(t),a(t)},e.logBrowserPerformanceInfo=a})),define("metaserver/static/js/perf_tools/web_timing_logger_types",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebTimerEvent=e.NavigationType=void 0;class i{static getFromNavigation(t){switch(t.type){case t.TYPE_NAVIGATE:return i.NAVIGATE;case t.TYPE_RELOAD:return i.RELOAD;case t.TYPE_BACK_FORWARD:return i.BACK_FORWARD}}}e.NavigationType=i,i.NAVIGATE="navigate",i.RELOAD="reload",i.BACK_FORWARD="back_forward";class n{constructor(t,e,i=!1,s=!0){this.name=t,this.flag=1<<e,this.triggersLogging=i,this.ordered=s,n.allEvents.push(this)}}e.WebTimerEvent=n,n.allEvents=[],n.APPLICATION_START=new n("application_code_start",1),n.LOAD_END=new n("load_end",2,!0,!1),n.FETCHED_DATA_FOR_TTI=new n("fetched_data_required_for_tti",3),n.MARK_TIME_TO_INTERACTIVE=new n("mark_time_to_interactive",4),n.TIME_TO_INTERACTIVE=new n("time_to_interactive",5,!0,!0)})),define("metaserver/static/js/clean/visibility_logging",["require","exports","metaserver/static/js/clean/js_client_stopwatch","metaserver/static/js/clean/js_basic_stopwatch"],(function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logVisibilityChangeEvents=e.logPaintPerformance=void 0,e.logPaintPerformance=function(t){if(!window.performance||!window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("paint").map(t=>({type:n.TimingDataType.Trace,name:t.name,endTime:t.startTime}));if(e.length>0){const n=i.JSStopwatch.createDetachedStopwatch("paint",t);n.recordEntries(e),n.logData()}},e.logVisibilityChangeEvents=function(t,e){if(!window.performance||!window.performance.getEntriesByType)return;let s=Number.MAX_VALUE;t.time_to_interactive&&(s=t.time_to_interactive-t.start_time);const r=window.performance.getEntriesByType("mark").filter(t=>t.name.startsWith("VisibilityState.")).map(t=>({visibility:t.name,time:t.startTime})),o={"VisibilityState.visible":0,"VisibilityState.hidden":0};let a;const c=t=>{a&&a.time<s&&(o[a.visibility]=(o[a.visibility]||0)+Math.min(t,s)-a.time)},_=[];r.forEach((t,e)=>{c(t.time),_.push({type:n.TimingDataType.Trace,name:`visibility-change-${e}`,endTime:t.time,annotations:{visibility:t.visibility}}),a=0===e?{visibility:t.visibility,time:0}:t}),c(window.performance.now());for(const t in o)o.hasOwnProperty(t)&&_.push({type:n.TimingDataType.Trace,name:`total-${t}-time`,endTime:o[t]});const l=i.JSStopwatch.createDetachedStopwatch("visibility",e);l.recordEntries(_),l.logData()}})),define("metaserver/static/js/clean/web_module_timing",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.add_module=e.get_module_times=void 0,e.get_module_times=function(){const t=[];for(const e in window.requireContexts){const i=window.requireContexts[e].module_callback_times;for(const e in i)if(i.hasOwnProperty(e)){const n=i[e];if(null!=n.loadTime){const e={load_time:n.loadTime,callback_duration:n.callbackDuration,callback_time:n.callbackTime,name:n.name,url:n.url,parent:n.parent};t.push(e)}}}return t},e.add_module=function(){}})),define("metaserver/static/js/clean/web_timing_logger",["require","exports","tslib","typescript/libraries/shared/apex-metrics/src/index","metaserver/static/js/clean/active_user","metaserver/static/js/metrics/index","metaserver/static/js/clean/event_load","metaserver/static/js/clean/web_module_timing","metaserver/static/js/clean/window_util","metaserver/static/js/perf_tools/resource_utils","metaserver/static/js/perf_tools/web_timing_logger_types","metaserver/static/js/perf_tools/web_timing_utils","metaserver/static/js/clean/js_client_stopwatch","metaserver/static/js/perf_tools/browser_perf_utils","metaserver/static/js/clean/init_react","metaserver/static/js/perf_tools/cpu_utils","metaserver/static/js/clean/js_basic_stopwatch","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/page_load","metaserver/static/js/core/assert","metaserver/static/js/core/browser","metaserver/static/js/core/exception","metaserver/static/js/core/xhr","typescript/dropbox/proto/js_init_data/web_timing_logger/web_timing_logger_pb","metaserver/static/js/clean/visibility_logging","metaserver/static/js/user_centric_perf_metrics/metrics_logger"],(function(t,e,i,n,s,r,o,a,c,_,l,d,m,u,p,h,g,w,f,v,S,T,b,y,E,x,N){"use strict";var I;Object.defineProperty(e,"__esModule",{value:!0}),e.log_js_modules_fetched_data_required_for_tti=e.log_js_modules_application_code_start=e.waitForTTI=e.mark_time_to_interactive=e.set_tti_exclusion_flow=e.time_since_start=e.start_time=e.reset=e.initialize=e.initialize_module=e.time_to_interactive=e.delete_timer=e.get_timer=void 0,o=i.__importStar(o),c=i.__importStar(c),w=i.__importStar(w),f=i.__importStar(f),v=i.__importStar(v),T=i.__importStar(T),b=i.__importStar(b),y=i.__importStar(y),E=i.__importStar(E),(function(t){t[t.NEW=1]="NEW",t[t.RUNNING=2]="RUNNING",t[t.ABORTED=3]="ABORTED",t[t.CLOSED=4]="CLOSED"})(I||(I={}));const A=["navigation_type","referrer","repo_rev","source_type","active_user_id"],O=["tti_flow","tti_exclusion_flow","is_dws2"];function L(){return"hidden"===window.document.visibilityState}const C=[[l.WebTimerEvent.APPLICATION_START,l.WebTimerEvent.FETCHED_DATA_FOR_TTI,l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE],[l.WebTimerEvent.TIME_TO_INTERACTIVE]].reverse();let D=1;const M=["requirejs_start","ensemble_payload_start","body_start"];const j=["craft_fast_prefetch_done","dws_core_externals_loaded","dws_ensemble_init","dws-processChunk-embedded-app-done-1","dws-processChunk-embedded-app-require_config-1","module_init","last_js_const_end","pagelet_render_on_page_embedded-app","pagelet_css_loaded_embedded-app"];class P{constructor(){m.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),this.shouldLogJsModuleTimes=()=>Math.random()<.001}buildBaseParams(t,e,i={}){const n=t.start_time,r=t.subtypes||{};t.tti_flow&&(r.tti_flow=t.tti_flow);const o={log_source:e.name,subtypes:JSON.stringify(r),correlation_id:t.correlation_id};let a;t.extra_columns&&Object.keys(t.extra_columns).forEach(e=>{const i=t.extra_columns[e];i&&(o[e]=i)}),Object.keys(i).forEach(t=>{const e=i[t];e&&(o[t]=e)}),w.IS_HTTP2&&(o.is_spdy=!0),t.is_pagelet&&(o.is_pagelet=!0),t.is_dws&&(o.is_dws=!0),t.is_early_ensemble&&(o.is_early_ensemble=!0),o.delayed_tti_for_css=t.delayed_tti_for_css,""!==t.tti_exclusion_flow&&(o.tti_exclusion_flow=t.tti_exclusion_flow),a=t.log_time_to_interactive&&null!=t.time_to_interactive?t.time_to_interactive-n:null;const c={navigation_type:this.get_navigation_type(),server_request_start_time:w.REQUEST_START_TIME,extra_columns:JSON.stringify(o),subtypes:JSON.stringify(r),source_type:t.source_type,page_load_time:t.end_time-t.start_time,repo_rev:v.REPO_REV};return this.shouldLogJsModuleTimes()&&X(c),t.log_time_to_interactive&&(c.time_to_interactive=a),c.url=T.get_href(),0===c.url.indexOf("/dws2/")&&(c.url=c.url.substring("/dws2/".length-1)),c.active_user_id=(0,s.getActiveUserId)(),c.referrer=document.referrer,c.request_id=t.request_id||w.REQUEST_ID,c.request_tracing_enabled=w.REQUEST_TRACING_ENABLED,window.ensemble&&window.ensemble.viewer&&(c.dws_page_name=window.ensemble.getPageName()),window.EDISON_PAGE_NAME&&(c.edison_page_name=window.EDISON_PAGE_NAME),c}get_navigation_type(){return l.NavigationType.getFromNavigation(window.performance.navigation)}log(t,e){const i=m.JSStopwatch.startSpan("wtl_endpoint",{stopwatchName:"web_timing_logger"});m.JSStopwatch.addSpanAnnotation("wtl_endpoint","navigation_type",e.navigation_type,{stopwatchName:"web_timing_logger",spanId:i}),Object.keys(e).forEach(t=>{"number"==typeof e[t]&&(e[t]=Math.round(e[t]))});const n=y.sendXhr("/alternate_wtl",e);n.onreadystatechange=t=>{n.readyState===XMLHttpRequest.DONE&&200===n.status&&m.JSStopwatch.endSpan("wtl_endpoint",{stopwatchName:"web_timing_logger",spanId:i})}}}class R extends P{constructor(){super()}shouldLog(t){return t.initialized&&!t.have_logged_web_timing&&void 0!==t.end_time&&(!t.log_time_to_interactive||null!=t.time_to_interactive)}logTiming(t,e){t.have_logged_web_timing=!0;const i=this.buildBaseParams(t,e),n=F(t,i);return this.log(t,i),n}get_navigation_type(){return"ajax"}}class k extends P{constructor(){super()}shouldLog(t){if(!t.initialized||t.have_logged_web_timing)return!1;const e=window.performance.timing,i=t.start_time,n=t.end_time;return!(!i||!n)&&!(t.log_time_to_interactive&&!(t.tti_at_dom_interactive&&(null==e?void 0:e.domInteractive))&&null==t.time_to_interactive)}logTiming(t,e){const i=performance.getEntriesByType("navigation")[0],s=(0,h.getAllGlobalExecutionPerfMeasurements)();let o=t.timesStagesWereReached["dws_embedded-app_require_config_callback"];void 0===o?o=t.timesStagesWereReached.application_code_start:t.timesStagesWereReached.hasOwnProperty("application_code_start")&&(o=Math.min(o,t.timesStagesWereReached.application_code_start)),m.JSStopwatch.startSpan("process_nav_timing",{stopwatchName:"web_timing_logger"});const a=this.buildBaseParams(t,e,{}),c=F(t,a),d=window.ensemble&&window.ensemble.getJSStopwatchData?window.ensemble.getJSStopwatchData():{},g=(0,_.summarizePerformanceResourceTimings)(performance.getEntriesByType("resource"),o);if(i)a.browser_time=Math.round(i.redirectStart||i.fetchStart),a.redirect_time=Math.round(i.fetchStart),a.dns_time=Math.round(i.domainLookupEnd),a.tcp_connect_time=Math.round(i.secureConnectionStart||i.requestStart),a.ssl_connect_time=Math.round(i.requestStart),a.time_to_first_byte=Math.round(i.responseStart),a.time_to_last_byte=Math.round(i.responseEnd),a.dom_load_time=Math.round(i.domContentLoadedEventEnd);else{const e=performance.timing;a.browser_time=e.redirectStart-t.start_time,a.redirect_time=e.fetchStart-t.start_time,a.dns_time=e.domainLookupEnd-t.start_time,a.tcp_connect_time=(e.secureConnectionStart||e.requestStart)-t.start_time,a.ssl_connect_time=e.requestStart-t.start_time,a.time_to_first_byte=e.responseStart-t.start_time,a.time_to_last_byte=e.responseEnd-t.start_time,a.dom_load_time=e.domContentLoadedEventEnd-t.start_time}a.idle_cpu_time=t.timing_results?Math.round(t.timing_results.idleCPUTime):void 0,a.total_tracked_cpu_time=t.timing_results?Math.round(t.timing_results.totalTrackedCPUTime):void 0,a.untracked_time_after_first_byte=t.timing_results&&null!=t.timing_results.untrackedTimeAfterFirstByte?Math.round(t.timing_results.untrackedTimeAfterFirstByte):void 0,(function(t,e){for(const i in t)t.hasOwnProperty(i)&&(e[`resource_${i}_count`]=t[i].count,e[`resource_${i}_avg_time`]=t[i].total_time/t[i].count||1,void 0!==t[i].total_size&&(e[`resource_${i}_total_size`]=t[i].total_size),void 0!==t[i].transfer_size&&(e[`resource_${i}_transfer_size`]=t[i].transfer_size))})(g.total,a),(function(t,e){let i;for(i in t)if(t.hasOwnProperty(i)){const n=t[i];for(const t in n)if(n.hasOwnProperty(t)){const s=n[t].transfer_size,r=n[t].total_size,o=n[t].count,a=n[t].total_time;if(e.recordTrace(`${i}_${t}_count`,o),e.recordTrace(`${i}_${t}_total_time`,a),void 0!==s&&void 0!==r&&r>0){const n=s/r;e.recordTrace(`${i}_${t}_transferred_size`,s),e.recordTrace(`${i}_${t}_total_size`,r),e.recordTrace(`${i}_percent_${t}_transferred`,100*n)}e.recordTrace(`${i}_last_${t}_transfer_end`,n[t].last_transfer_end)}}e.logData()})(g,m.JSStopwatch.createDetachedStopwatch("resources_percent_transferred",c)),m.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_resources","1",{stopwatchName:"web_timing_logger"}),this.shouldLogJsModuleTimes()&&X(a),m.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_modules","1",{stopwatchName:"web_timing_logger"}),m.JSStopwatch.endSpan("process_nav_timing",{stopwatchName:"web_timing_logger"}),t.is_pagelet&&Object.getOwnPropertyNames(d).length>0&&(function(t,e,i){const n=(function(t,e){const i=(0,h.listAnnotatedExecutionPerfMeasurementsForEnsemble)(e),n=m.JSStopwatch.createDetachedStopwatch("ensemble",t),s=i.map(({measurement:t,annotations:e})=>({name:t.name,startTime:t.startTime,endTime:t.startTime+t.totalTime,annotations:e}));return Q(n,s),n})(i,e);let s=void 0,r=void 0;for(const i in e)e.hasOwnProperty(i)&&(Y.includes(i)&&(t.timesStagesWereReached[i]=e[i].start),["dws_embedded-app_require_config_callback"].includes(i)&&(s=s?Math.min(s,e[i].end):e[i].end),H.test(i)&&(r=r?Math.max(r,e[i].end):e[i].end));r&&n.recordTrace("last_js_const_end",r);s&&n.recordTrace("module_init",s)})(t,d,c),(0,u.logBrowserPerfData)(c),(function(t,e,i){(0,h.logCumulativeExecutionTimes)(t,(0,h.cumulativeExecutionTimesBefore)(e,i))})(c,t.timesStagesWereReached,s),this.get_navigation_type()===l.NavigationType.NAVIGATE&&((function(t){const e=(0,p.getReactInitData)();Q(m.JSStopwatch.createDetachedStopwatch("init_react",t),e)})(c),(0,_.logResourcesData)(c)),m.JSStopwatch.log_stored_results();const w=(function(t,e){const i={is_dws:String(t.is_dws),source_type:String(t.source_type),rollup_format:t.rollup_format,is_build_time_prefetches_enabled:String(t.is_build_time_prefetches_enabled)};let n="";return t.subtypes.amp_tti_flow?n=t.subtypes.amp_tti_flow:e.dws_page_name?n=`dws_page_name:${e.dws_page_name}`:e.edison_page_name&&(n=`edison_page_name:${e.edison_page_name}`),""!==n&&(i.product=n),e.navigation_type&&(i.navigation_type=e.navigation_type),i})(t,a),f=(0,r.getMetricsReporter)().child(w),v=(function(t,e){return e.navigation_type===l.NavigationType.NAVIGATE||"ajax"===e.navigation_type})(0,a),S=(0,r.getUnloadMetricsReporter)().child(w);return(0,N.logUserCentricPerfMetrics)(S,v,g),v&&((function(t,e){if(t.time_to_interactive){e.createStats({ns:"web_timing",name:"temp/time-to-interactive"}).recordDuration(t.time_to_interactive,n.TimeUnit.MILLISECONDS)}})(a,f),(function(t,e){let i;for(i in t)if(t.hasOwnProperty(i)){const s=t[i];for(const t in s)if(s.hasOwnProperty(t)){const{transfer_size:r,total_size:o,count:a,total_time:c,last_transfer_end:_}=s[t];e.createStats({ns:"web_timing",name:`temp/resources/${i}/${t}/count`}).record(a),e.createStats({ns:"web_timing",name:`temp/resources/${i}/${t}/total-time`}).recordDuration(c,n.TimeUnit.MILLISECONDS),e.createStats({ns:"web_timing",name:`temp/resources/${i}/${t}/last-transfer-end`}).recordDuration(_,n.TimeUnit.MILLISECONDS),void 0!==r&&void 0!==o&&o>0&&(e.createStats({ns:"web_timing",name:`temp/resources/${i}/${t}/transferred-size`}).record(r),e.createStats({ns:"web_timing",name:`temp/resources/${i}/${t}/total-size`}).record(o))}}})(g,f),t.is_pagelet&&Object.getOwnPropertyNames(d).length>0&&(function(t,e,i){const s=(0,h.listAnnotatedExecutionPerfMeasurementsForEnsemble)(e);let r=void 0,o=void 0;s.forEach(({measurement:e})=>{const s=e.startTime+e.totalTime;-1!==j.indexOf(e.name)&&i.createStats({ns:"web_timing",name:`temp/ensemble-timing/${e.name}`}).recordDuration(s,n.TimeUnit.MILLISECONDS),Y.includes(e.name)&&(t.timesStagesWereReached[e.name]=e.startTime),["dws_embedded-app_require_config_callback"].includes(e.name)&&(r=r?Math.min(r,s):s),H.test(e.name)&&(o=o?Math.max(o,s):s)}),void 0!==o&&i.createStats({ns:"web_timing",name:"temp/last-js-const-end"}).recordDuration(o,n.TimeUnit.MILLISECONDS),void 0!==r&&i.createStats({ns:"web_timing",name:"temp/module-init"}).recordDuration(r,n.TimeUnit.MILLISECONDS)})(t,d,f),(function(t){performance.getEntriesByType("mark").filter(t=>M.indexOf(t.name)>-1).forEach(e=>{t.createStats({ns:"web_timing",name:`temp/browser-perf/marks/${e.name}`}).recordDuration(e.startTime,n.TimeUnit.MILLISECONDS)})})(f),(function(t){const[e=null]=performance.getEntriesByType("navigation");e&&([["temp/browser-perf/navigation/unload-event-start",e.unloadEventStart],["temp/browser-perf/navigation/unload-event-end",e.unloadEventEnd],["temp/browser-perf/navigation/dom-interactive",e.domInteractive],["temp/browser-perf/navigation/dom-content-loaded-event-start",e.domContentLoadedEventStart],["temp/browser-perf/navigation/dom-content-loaded-event-end",e.domContentLoadedEventEnd],["temp/browser-perf/navigation/dom-complete",e.domComplete],["temp/browser-perf/navigation/load-event-start",e.loadEventStart],["temp/browser-perf/navigation/load-event-end",e.loadEventEnd],["temp/browser-perf/navigation/redirect-count",e.redirectCount],["temp/browser-perf/navigation/worker-start",e.workerStart],["temp/browser-perf/navigation/redirect-start",e.redirectStart],["temp/browser-perf/navigation/redirect-end",e.redirectEnd],["temp/browser-perf/navigation/fetch-start",e.fetchStart],["temp/browser-perf/navigation/domain-lookup-start",e.domainLookupStart],["temp/browser-perf/navigation/domain-lookup-end",e.domainLookupEnd],["temp/browser-perf/navigation/connect-start",e.connectStart],["temp/browser-perf/navigation/connect-end",e.connectEnd],["temp/browser-perf/navigation/secure-connect-start",e.secureConnectionStart],["temp/browser-perf/navigation/request-start",e.requestStart],["temp/browser-perf/navigation/response-start",e.responseStart],["temp/browser-perf/navigation/response-end",e.responseEnd],["temp/browser-perf/navigation/transfer-size",e.transferSize]].forEach(([e,i])=>{if("number"==typeof i){t.createStats({ns:"web_timing",name:e}).recordDuration(i,n.TimeUnit.MILLISECONDS)}}),[["temp/browser-perf/navigation/encoded-body-size",e.encodedBodySize],["temp/browser-perf/navigation/decoded-body-size",e.decodedBodySize]].forEach(([e,i])=>{if("number"==typeof i){t.createStats({ns:"web_timing",name:e}).record(i)}}))})(f)),(0,x.logPaintPerformance)(c),(0,x.logVisibilityChangeEvents)(t,c),t.have_logged_web_timing=!0,this.log(t,a),c}log(t,e){super.log(t,e)}}class W{constructor(t,e,i,n){this.childSpans=[],this.spanName=t,this.startTime=null!=i?i:d.WebTimingUtil.getNow(),this.originTs=e,this.startTimeOffsetMS=this.startTime-e,this.endCallback=n}startSpan(t){const e=new W(t,this.originTs);return this.childSpans.push(e),e}markSpan(t,e){const i=new W(t,this.originTs,this.startTime);this.childSpans.push(i),i.endSpan(e)}endSpan(t){this.endTime=void 0!==t?t:d.WebTimingUtil.getNow(),this.childSpans.forEach(t=>{t.hasEnded()||t.endSpan(this.endTime)}),this.endCallback&&this.endCallback(this)}getEndTimeOffsetMS(){return void 0!==this.endTime?this.endTime-this.originTs:void 0}hasEnded(){return void 0!==this.endTime}}class q{constructor(t,e,i,n=!1){this.timerState=I.RUNNING,this.loggedEvents=0,this.activeSpans=[],this.endedSpans=[],this.context=t,this.timingStopwatch=e,this.userStopwatch=i,this.id=D++,this.strictAssert=n}startSpan(t){const e=new W(t,this.context.start_time,void 0,t=>{this.endSpan(t)});return this.activeSpans.push(e),e}markSpan(t,e={}){if(this.userStopwatch){const i=void 0===e.startTime?0:e.startTime,n=this.timeSinceStart(e.endTime),s=this.userStopwatch.startSpan(t,{startTime:i});this.userStopwatch.endSpan(t,{spanId:s,endTime:n})}else{const i=new W(t,this.context.start_time,e.startTime);i.endSpan(e.endTime),this.endedSpans.push(i)}}endSpan(t){const e=this.activeSpans.indexOf(t);e>=0&&(delete this.activeSpans[e],this.userStopwatch?this.recordSpan(t):this.endedSpans.push(t))}recordSpan(t){const e=this.userStopwatch.startSpan(t.spanName,{startTime:t.startTimeOffsetMS});t.childSpans.forEach(t=>{this.recordSpan(t)}),this.userStopwatch.endSpan(t.spanName,{spanId:e,endTime:t.getEndTimeOffsetMS()})}getContextName(){return this.context.context_name}applicationStart(){this.logEvent(l.WebTimerEvent.APPLICATION_START)}fetchedDataRequiredForTTI(){this.logEvent(l.WebTimerEvent.FETCHED_DATA_FOR_TTI)}startTime(){return this.context.start_time}timeSinceStart(t){return(t||d.WebTimingUtil.getNow())-this.context.start_time}timeToInteractive(){return this.context.time_to_interactive}reportTTIAfterPaint(){const t=new d.CancellableCallback(()=>{this.reportTTI()});return window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{t.exec()})}),t}setExtraColumns(t){this.context.extra_columns=t}excludeFromTTI(t){""!==this.context.tti_exclusion_flow&&(this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+","),this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+t}logEvent(t,e){this.logEventInternal(t,!0,e)}logSilentEvent(t,e){this.logEventInternal(t,!1,e)}logEventInternal(t,e,i){this.loggedEvents|=t.flag,t.ordered&&this.validateEventOrder(t);const n=this.timeSinceStart(i);this.context.timesStagesWereReached[t.name]=n,this.timingStopwatch.recordTrace(t.name,n),window.performance.mark&&window.performance.mark(t.name),e&&t.triggersLogging&&this.logIfReady(t)}validateEventOrder(t){let e=0;for(const i of C){if(i.includes(t))break;for(const t of i)e|=t.flag}const i=e&this.loggedEvents;if(i>0){const e=l.WebTimerEvent.allEvents.filter(t=>(t.flag&i)>0).map(t=>t.name);this.reportSwMisuse(`Received ${t.name} after [${e.join(",")}]`)}}logIfReady(t){if(this.logger.shouldLog(this.context)){this.addEventBasedTiming();const e=this.logger.logTiming(this.context,t);z(this.timingStopwatch,e),z(this.userStopwatch,e),this.timingStopwatch.logData(),this.userStopwatch.logData(),this.timerState=I.CLOSED}}addEventBasedTiming(){const t=window.performance.timing;this.context.tti_at_dom_interactive&&(this.context.time_to_interactive=t.domInteractive,this.logSilentEvent(l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE,this.context.time_to_interactive),this.logSilentEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive))}reportSwMisuse(t){t=`WebTimer: ${t}`,this.strictAssert?(0,S.assert)(!1,t):b.reportStack(t,{severity:b.SEVERITY.NONCRITICAL,tags:["web_timing_logger"]})}}class U extends q{constructor(t){super(t,m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:t.correlation_id}),m.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:t.correlation_id}),!1),this.logger=new R}initialize(t){this.context.initialized||(this.context.initialized=!0,this.context.log_time_to_interactive=t.requireTTI,this.context.tti_flow=t.url,this.timingStopwatch.url=this.context.tti_flow,this.userStopwatch.url=this.context.tti_flow)}start(){this.isUsable()&&this.timerState===I.NEW&&(this.context.start_time=d.WebTimingUtil.getNow(),this.timerState=I.RUNNING)}restart(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.have_logged_web_timing=!1,this.context.correlation_id=d.WebTimingUtil.generateCorrelationId(),this.context.start_time=d.WebTimingUtil.getNow(),this.context.end_time=void 0,this.context.time_to_interactive=null,this.timerState=I.RUNNING,m.JSStopwatch.deleteStopwatch(this.timingStopwatch),this.timingStopwatch=m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id}),m.JSStopwatch.deleteStopwatch(this.userStopwatch),this.userStopwatch=m.JSStopwatch.createDetachedStopwatch("user_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id})}abort(){this.timerState!==I.CLOSED&&(this.timerState=I.ABORTED)}markTimeToInteractive(){this.isUsable()&&(this.logEvent(l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),L()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())}reportTTI(){if(null!=this.context.time_to_interactive)return;this.context.time_to_interactive=d.WebTimingUtil.getNow(),this.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE),new Promise((e,i)=>{t(["metaserver/static/js/logging/telemetry"],e,i)}).then(i.__importStar).then(({getGlobalTelemetrySingleton:t})=>{t().sendOnce()});const e=this.timeSinceStart(this.context.time_to_interactive);Z(this.id,e,!0)}end(t){this.isUsable()&&(void 0===this.context.end_time&&(this.context.end_time=d.WebTimingUtil.getNow()),this.context.request_id=t,this.timingStopwatch.request_id=t,this.userStopwatch.request_id=t,this.logEvent(l.WebTimerEvent.LOAD_END))}waitForTTI(t){return new Promise((e,i)=>{if(null!=this.context.time_to_interactive)return void e();let n;const s=t=>{window.removeEventListener("TTI."+this.id,s),clearTimeout(n),e()};window.addEventListener("TTI."+this.id,s),t&&void 0!==t.timeoutMS&&(n=setTimeout(s,t.timeoutMS))})}isUsable(){return this.timerState===I.NEW||this.timerState===I.RUNNING}}class B extends q{constructor(t){super(t,m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:t.correlation_id}),m.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:t.correlation_id}),!1),this.logger=new k}initialize(t){var e;if(!this.context.initialized){this.context.log_time_to_interactive=t.requireTTI,this.context.is_pagelet=!!t.is_pagelet,this.context.is_dws=!!t.is_dws,this.context.is_dws2=!!t.is_dws2,this.context.is_early_ensemble=!!t.is_early_ensemble,this.context.tti_at_dom_interactive=!!t.tti_at_dom_interactive,this.context.source_type=null!=t.source_type?t.source_type:"web",this.context.subtypes=null!=t.subtypes?t.subtypes:{},this.context.tti_exclusion_flow=null!=t.tti_exclusion_flow?t.tti_exclusion_flow:"",this.context.have_logged_web_timing=!1,this.context.delayed_tti_for_css=!1,this.context.rollup_format=t.rollup_format||"off",this.context.initialized=!0,this.context.is_build_time_prefetches_enabled=!!t.is_build_time_prefetches_enabled,t.url&&(this.context.tti_flow=t.url,this.timingStopwatch.url=t.url,this.userStopwatch.url=t.url),this.context.subtypes.tti_flow&&(this.context.tti_flow=this.context.subtypes.tti_flow);let i=0;if(f.LOG_TIMING_DELAY&&(i=600),m.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),o.window_load(()=>{setTimeout(()=>this.end(),i)}),c.onPageRestore(t=>{const e=m.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:this.context.correlation_id});e.recordTrace("page_restore"),e.logData()}),null===(e=window._timingData)||void 0===e?void 0:e.tti){this.context.time_to_interactive=window._timingData.tti.getTime(),this.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),Z(void 0,this.timeSinceStart(this.context.time_to_interactive))}}}start(){this.isUsable()&&this.timerState===I.NEW&&(this.timerState=I.RUNNING)}restart(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.correlation_id=d.WebTimingUtil.generateCorrelationId(),this.context.end_time=void 0,this.context.time_to_interactive=null,this.timerState=I.RUNNING,this.timingStopwatch=m.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:this.context.correlation_id}),this.userStopwatch=m.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:this.context.correlation_id})}abort(){this.timerState!==I.CLOSED&&(this.timerState=I.ABORTED)}markTimeToInteractive(){if(window.ensemble&&window.ensemble.waitingForCss)return this.context.delayed_tti_for_css=!0,void(window.ensemble.mark_tti_callback=()=>{this.markTimeToInteractive()});null!=this.context.time_to_interactive||this.context.tti_at_dom_interactive||(this.logEvent(l.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),L()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())}reportTTI(){if(null==this.context.time_to_interactive)if(window._timingData&&null!=window._timingData.tti?this.context.time_to_interactive=window._timingData.tti.getTime():this.context.time_to_interactive=d.WebTimingUtil.getNow(),window.ensemble&&window.ensemble.snapshotTimingProfile&&(this.context.timing_results=window.ensemble.snapshotTimingProfile()||null),window.RUNNING_IN_EDISON)new Promise((e,i)=>{t(["js/edison/edison"],e,i)}).then(i.__importStar).then(({Edison:t})=>{const e=t.getPrefetchCounts(),i={};for(const t of Object.keys(e))i[t]=e[t].toString();this.context.subtypes=Object.assign(Object.assign({},i),this.context.subtypes),this.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),Z(void 0,this.timeSinceStart(this.context.time_to_interactive))});else{this.logEvent(l.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),Z(void 0,this.timeSinceStart(this.context.time_to_interactive))}}end(t){this.isUsable()&&void 0===this.context.end_time&&(this.context.end_time=d.WebTimingUtil.getNow(),this.logEvent(l.WebTimerEvent.LOAD_END),this.context.tti_at_dom_interactive&&Z())}waitForTTI(t){return new Promise((e,i)=>{if(window.ensemble){if(window.ensemble.ttiMarked)return void e()}else if(null!=this.context.time_to_interactive)return void e();let n;const s=t=>{window.removeEventListener("TTI",s),clearTimeout(n),e()};window.addEventListener("TTI",s),t&&void 0!==t.timeoutMS&&(n=setTimeout(s,t.timeoutMS))})}isUsable(){return this.timerState===I.NEW||this.timerState===I.RUNNING}}const J={};let $;function F(t,e){const i={};for(const t of A){const n=e[t];n&&(i[t]=String(n))}const n=t;for(const t of O){const e=n[t];e&&(i[t]=String(e))}return{correlation_id:t.correlation_id,request_id:e.request_id,annotations:i}}function z(t,e){if(e.annotations)for(const i in e.annotations)if(e.annotations.hasOwnProperty(i)){const n=e.annotations[i];n&&t.addAnnotation(i,String(n))}e.correlation_id&&t.addAnnotation(m.ReservedAnnotationKey.CORRELATION_ID.id,e.correlation_id),e.request_id&&t.addAnnotation(m.ReservedAnnotationKey.REQUEST_ID.id,e.request_id),e.url&&t.addAnnotation(m.ReservedAnnotationKey.URL.id,e.url)}function V(t){return t?(function(t){const e=t;return J[e]||(J[e]=new U(d.WebTimingUtil.newContext(!0,t))),J[e]})(t):($||K(),$)}function G(t={}){V().initialize({requireTTI:!!t.log_time_to_interactive,is_pagelet:t.is_pagelet,is_dws:t.is_dws,is_dws2:t.is_dws2,is_early_ensemble:t.is_early_ensemble,tti_at_dom_interactive:t.tti_at_dom_interactive,source_type:t.source_type,subtypes:t.subtypes,tti_exclusion_flow:t.tti_exclusion_flow,url:t.url,rollup_format:t.rollup_format,is_build_time_prefetches_enabled:t.is_build_time_prefetches_enabled})}function K(){$=new B(d.WebTimingUtil.newContext(!1,"default_timer"))}function Q(t,e){t.recordEntries(e.map(t=>({type:0!==t.startTime?g.TimingDataType.Span:g.TimingDataType.Trace,name:t.name,startTime:t.startTime,endTime:t.endTime,annotations:t.annotations}))),t.logData()}K(),e.get_timer=V,e.delete_timer=function(t){delete J[t]},e.time_to_interactive=function(){return V().timeToInteractive()},e.initialize_module=G,e.initialize=function(t,e){const i=e.dwsOpts;let n;switch(e.sourceType){case E.WebTimingLoggerServerContext_SourceType.UNKNOWN:n="unknown";break;case E.WebTimingLoggerServerContext_SourceType.MOBILE_WEB:n="mobile";break;case E.WebTimingLoggerServerContext_SourceType.DESKTOP_WEB:n="web"}const s={is_pagelet:e.isDws,is_dws:e.isDws,is_dws2:null!=i&&i.isDws2,is_early_ensemble:null!=i&&i.isEarlyEnsemble,subtypes:Object.assign(Object.assign({},e.subtypes),{js_preloading:null!=i&&i.jsPreloading?"true":"false"}),source_type:n,url:e.url};G(Object.assign(Object.assign({},s),t))},e.reset=K,e.start_time=function(){return V().startTime()},e.time_since_start=function(){return V().timeSinceStart()},e.set_tti_exclusion_flow=function(t){V().excludeFromTTI(t)};const Y=["dws_ensemble_init","dws_embedded-app_require_config_callback","dws-processChunk-embedded-app-require_config-1"],H=new RegExp("dws-processChunk-embedded-app-const_module.*");function X(t){const e=(0,a.get_module_times)(),i=[];for(const t of e){const e=t.url;if(void 0===e&&t.name&&-1===t.name.indexOf("!")){b.reportStack(`Module ${t.name} with invalid map object fetched by requirejs`,{severity:b.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]});continue}let n=[];if(e&&(n=window.performance.getEntriesByName(e,"resource")),0!==n.length)t.start_time=n[0].startTime+n[0].duration;else{if(!("callback_duration"in t))continue;t.start_time=0}i.push(t)}t.js_module_times=JSON.stringify(i)}function Z(t,e,i=!1){if(window.ensemble&&window.ensemble.markTTI)window.ensemble.markTTI();else{const e=new CustomEvent(void 0!==t?`TTI.${t}`:"TTI",{bubbles:!0,cancelable:!0});window.dispatchEvent(e)}const n=new CustomEvent("time_to_interactive",{detail:{value:e,isAjax:i},bubbles:!0,cancelable:!0});window.dispatchEvent(n)}e.mark_time_to_interactive=function(t={}){const e=V();e.setExtraColumns(t),e.markTimeToInteractive()},e.waitForTTI=function(t){return V().waitForTTI(t)},e.log_js_modules_application_code_start=function(){V().applicationStart()},e.log_js_modules_fetched_data_required_for_tti=function(){V().fetchedDataRequiredForTTI()}})),define("metaserver/static/js/clean/window_util",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.onPageRestore=e.onBeforeUnload=void 0,e.onBeforeUnload=function(t){window.addEventListener("beforeunload",(function e(){t(),window.removeEventListener("beforeunload",e)}))},e.onPageRestore=function(t){window.addEventListener("pageshow",(function e(i){i.persisted&&(t(),window.removeEventListener("pageshow",e))}))}})),define("metaserver/static/js/core/transport/query_string_helpers",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TRACKING_PARAMS_LIST=e.parseQueryString=e.filterQueryObject=e.getQueryString=e.getTrackingParamsAsJSON=e.getTrackingParams=e.getParsedQueryString=void 0;const i=["gclid","oqa","trigger","_tk","_camp","_ad","_net","_kw","utm_campaign","utm_content","utm_medium","utm_source","utm_term","cont"];function n(t=window){return t.location.search}function s(t){const e={};if(t.length){const i=t.substring(1).replace(/&amp;/g,"&").split("&");for(const t of i){let[i,n]=t.split("=");i&&n&&(i=i.trim(),n=n.trim(),i.length&&n.length&&(e[i]=decodeURIComponent(n.replace(/\+/g," "))))}}return e}function r(t,e){return e.reduce((e,i)=>(t.hasOwnProperty(i)&&(e[i]=t[i]),e),{})}function o(t){return r(t||s(n()),i)}e.TRACKING_PARAMS_LIST=i,e.getQueryString=n,e.parseQueryString=s,e.getParsedQueryString=function(){return s(n())},e.filterQueryObject=r,e.getTrackingParams=o,e.getTrackingParamsAsJSON=function(){const t=o();return JSON.stringify(t)}})),define("js/filepath/filepath",["require","exports"],(function(t,e){"use strict";function i(t){return t?("/"!==t.charAt(0)&&(t=`/${t}`),"/"===t.charAt(t.length-1)?t.substr(0,t.length-1):t):""}function n(t){if(!t)return{name:"",ext:""};const e=t.split("."),i=t.length>0&&"."===t[0];let n=t.indexOf(".")<0;i&&(n=e.length<=2);const s=e.pop();return s&&!n?{name:e.join("."),ext:s}:{name:t,ext:""}}function s(t){return n(t).ext.toLowerCase()}function r(t){return t.split("/").slice(0,-1).join("/")||"/"}Object.defineProperty(e,"__esModule",{value:!0}),e.joinPathWithFileName=e.parentDirName=e.child_dir=e.parent_dirs=e.parent_dir=e.file_extension_for_logging=e.file_extension=e.split_filename=e.filename_without_extension=e.filename=e.inSubDirectory=e.inSameDirectory=e.paths_are_equal=e.depth=e.normalize=void 0,e.normalize=i,e.depth=function(t){return i(t).split("/").length-1},e.paths_are_equal=function(t,e){return i(t).toLowerCase()===i(e).toLowerCase()},e.inSameDirectory=function(t){if(!t.length)return!1;const e=r(t[0]);return!t.find(t=>r(t)!==e)},e.inSubDirectory=function(t,e){const n=(t=i(t)).split("/"),s=(e=i(e)).split("/");if(s.length<=n.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==s[t])return!1;return!0},e.filename=function(t,e){const n=(t=i(t)).split("/").pop();return n||(e||"Dropbox")},e.filename_without_extension=function(t){return t?-1===t.indexOf(".")?t:t.split(".").slice(0,-1).join("."):""},e.split_filename=n,e.file_extension=s,e.file_extension_for_logging=function(t){return-1===t.indexOf(".")?"":s(t).toLowerCase()},e.parent_dir=r,e.parent_dirs=function(t){const e=[];let i=r(t);for(;"/"!==i;)e.push(i),i=r(i);return e},e.child_dir=function(t){return t.split("/").pop()||""},e.parentDirName=function(t){const e=t.split("/");return e.length>1?e[e.length-2]:""},e.joinPathWithFileName=function({fqPath:t,fileName:e}){return[t,e].join("/"===t?"":"/")}})),define("metaserver/static/js/user_centric_perf_metrics/utils",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.waitForPageHidden=e.waitForPageLoad=void 0;e.waitForPageLoad=()=>"complete"===document.readyState?Promise.resolve():new Promise((t,e)=>{window.addEventListener("load",()=>{t()})});e.waitForPageHidden=()=>new Promise((t,e)=>{const i=e=>{"pagehide"!==e.type&&"hidden"!==document.visibilityState||(document.removeEventListener("visibilitychange",i,!0),window.removeEventListener("pagehide",i,!0),t())};document.addEventListener("visibilitychange",i,!0),window.addEventListener("pagehide",i,!0)})})),define("metaserver/static/js/user_centric_perf_metrics/annotations",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationNameEnum=void 0,(function(t){t.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS="long_input_delay_callback_latency_overhead_ms",t.AVG_LONG_INPUT_DELAY_MS="long_input_delay_ms"})(e.AnnotationNameEnum||(e.AnnotationNameEnum={}))})),define("metaserver/static/js/user_centric_perf_metrics/map_path_to_product",["require","exports","metaserver/static/js/modules/constants/page_load"],(function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mapPathToProduct=void 0,e.mapPathToProduct=function(t){var e;const i=window.EDISON_PAGE_NAME,s=null===(e=window.ensemble)||void 0===e?void 0:e.getPageName(),r=t.pathname.substring(1).split("/"),o=n(t,r,null!=i?i:s);return o||(i?`edison_page_name:${i}`:s?`dws_page_name:${s}`:"UNKNOWN")};const n=(t,e,n)=>{var h,g;i.PAGE_LOCALE===e[0]&&e.shift();const w=null!==(h=e[0])&&void 0!==h?h:"",f=null!==(g=e[1])&&void 0!==g?g:"";switch(w){case"":return"homepage:loggedout";case"home":case"personal":case"work":return t.searchParams.has("preview")?"browse:preview":"browse";case"account":return d(f);case"business":return s(f);case"content_hub":return r(f,e);case"forgot":return"forgot_password";case"forgot_finish":return"forgot_password:finish";case"h":return"home";case"history":return"version_history";case"login_notification":return _(f);case"manage":return m(f);case"preview":return"standalone_preview";case"product-updates":return u(f);case"s":return"shared_link:file";case"sh":return"shared_link:folder";case"scl":return c(f);case"share":return a(f);case"transfer":return l(f,e);case"search":return t.searchParams.get("query")?"search_results_page":"search_zero_state";case"dash-home":case"dash":case"dash_uninstall":case"dash_uninstall_survey_results":return p(e);case"backup":case"collections":case"deleted_files":case"events":case"login":case"mobile":case"photos":case"plans":case"recents":case"report_abuse":case"request":case"requests":case"signatures":case"starred":case"switch_login":case"time_tracking":case"trello_powerup":case"verify_code":return w}if("warp_page"===n)return o(e,4)},s=t=>{switch(t){case"":return"business";case"buy":return"business:buy";case"solutions":return"business:solutions";case"try":return"business:try";case"plans-comparison":return"business:plans_comparison"}},r=(t,e)=>{switch(t){case"":return"content_hub";case"files":return"content_hub:files";case"s":return"content_hub:shared_link:file";case"sh":return"content_hub:shared_link:folder";case"playground":return"empty"===e[2]?"content_hub:test_pages:empty_page":"chrome"===e[2]?"content_hub:test_pages:chrome_only":void 0;default:return}},o=(t,e)=>{if(e<1)return;let i="";for(let n=0;n<e&&n<t.length;n++)t[n]&&(i+=(n>0?":":"")+t[n]);return i},a=t=>{switch(t){case"recents":return"shared:recents";case"folders":return"shared:folders";case"files":return"shared:files";case"links":return"shared:links";case"signatures":return"shared:signatures"}},c=t=>{switch(t){case"fi":return"shared_content_link:file";case"fo":return"shared_content_link:folder"}},_=t=>{switch(t){case"not_sure":return"login_notification:not_sure";case"this_was_me":return"login_notification:this_was_me"}},l=(t,e)=>{var i;switch(t){case"manage":return"transfer:manage";default:if("edit"===(null!==(i=e[2])&&void 0!==i?i:""))return"transfer:edit"}if(!t)return"transfer:create"},d=t=>{switch(t){case"connected_apps":return"account:app";case"branding":return"account:branding";case"general":return"account:general";case"family":return"account:family";case"notifications":return"account:notifications";case"plan":return"account:plan";case"security":return"account:security";case"privacy":return"account:privacy";case"sharing":return"account:sharing"}},m=t=>{switch(t){case"subscriptions":return"manage:subscriptions";case"billing":return"manage:billing"}},u=t=>t.includes("dbx")?"product_updates:dbx_monthly_update":t.includes("hs")?"product_updates:hs_monthly_update":"product_updates",p=t=>{const[e="",i="",n=""]=t;switch(e){case"dash_uninstall":return"dash:uninstall";case"dash_uninstall_survey_results":return"dash:uninstall_survey_results";case"dash":switch(i){case"download":return"dash:download"}break;case"dash-home":switch(i){case"":return"dash:home";case"activity":return"dash:activity";case"connectors":return"dash:connectors";case"stacks":return"library"===n?"dash:library":"dash:stack_view"}}return"dash:unknown"}})),define("metaserver/static/js/user_centric_perf_metrics/metrics_collector",["require","exports","tslib","@dropbox/ttvc","metaserver/static/js/core/exception","web-vitals","metaserver/static/js/user_centric_perf_metrics/utils","js/browser/cookies"],(function(t,e,i,n,s,r,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetricsCollector=void 0;e.MetricsCollector=class{constructor(){this.numLongInputDelays=0,this.ttiSubscribers=new Set,this.annotations=new Map,this.onTTFB=r.onTTFB,this.onFCP=r.onFCP,this.onLCP=r.onLCP,this.onCLS=r.onCLS,this.onFID=r.onFID,this.onINP=r.onINP,this.onTTVC=n.onTTVC;const t=a.Cookies.read("enable_ttvc_debugging");try{(0,n.init)({debug:"ON"===t,idleTimeout:2e3})}catch(t){(0,s.reportException)({err:t,severity:"non-critical",force:!0,tags:["user_centric_perf","ttvc"]})}window.PerformanceObserver&&(this.performanceObserver=new PerformanceObserver((t,e)=>{const i=this.getTTIValue(t);i&&(this.ttiSubscribers.forEach(t=>t(i)),e.disconnect())}),this.performanceObserver.observe({entryTypes:["mark"]}))}getTTI(t){this.ttiSubscribers.add(t);const e=this.getTTIValue(performance);return e&&t(e),()=>this.ttiSubscribers.delete(t)}getTTIValue(t){let e=void 0;const i=t.getEntriesByName("time_to_interactive","mark");if(i.length){e=i[0].startTime}return e}getLongInputDelays(t){return i.__awaiter(this,void 0,void 0,(function*(){yield(0,o.waitForPageLoad)(),yield(0,o.waitForPageHidden)(),t(this.numLongInputDelays)}))}}})),define("metaserver/static/js/user_centric_perf_metrics/metrics_logger",["require","exports","typescript/libraries/shared/apex-metrics/src/index","metaserver/static/js/user_centric_perf_metrics/metrics_collector","metaserver/static/js/user_centric_perf_metrics/annotations","metaserver/static/js/user_centric_perf_metrics/visually_complete_logger","metaserver/static/js/logging/hive/schemas/web-visually_complete","metaserver/static/js/edison/ui/spa_product_name","metaserver/static/js/user_centric_perf_metrics/map_path_to_product","metaserver/static/js/user_centric_perf_metrics/largest_contentful_paint_logger","metaserver/static/js/logging/hive/schemas/web-largest_contentful_paint","metaserver/static/js/user_centric_perf_metrics/time_to_first_byte_logger","metaserver/static/js/logging/hive/schemas/web-time_to_first_byte","metaserver/static/js/user_centric_perf_metrics/visually_complete_helpers"],(function(t,e,i,n,s,r,o,a,c,_,l,d,m,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.logUserCentricPerfMetrics=e.MetricsLogger=void 0;class p{constructor(t=null,e=new n.MetricsCollector){this.AMP_NAMESPACE="user_centric_perf",this.shouldLogToAmp=!1,t&&(this._metricsReporter=t),this.metricsCollector=e}static getSingleton(){return p.instance||(p.instance=new p),p.instance}get metricsReporter(){if(!this._metricsReporter)throw new Error("Must set `metricsReporter` on MetricsLogger before deriving metrics");return this._metricsReporter}set metricsReporter(t){this._metricsReporter=t}deriveAndLogAllMetrics(){this.deriveAndLogTimeToFirstByte(),this.deriveAndLogFirstContentfulPaint(),this.deriveAndLogLargestContentfulPaint(),this.deriveAndLogFirstInputDelay(),this.deriveAndLogCumulativeLayoutShift(),this.deriveAndLogTimeToVisuallyComplete(),this.deriveAndLogNumLongInputDelays(),this.deriveAndLogTimeToConsistentlyInteractive(),this.deriveAndLogInteractionToNextPaint(),this.logTimeToInteractive(),this.observeRageClicks()}deriveAndLogTimeToFirstByte(){this.metricsCollector.onTTFB(t=>{this.logMetricToAmp("time_to_first_byte_ms",t.value);const{productName:e,webserver:n}=this.getProductNameAndServer();"UNKNOWN"!==e&&(this.logMetricToAmp("ttfb",t.value,i.TimeUnit.MILLISECONDS,{product:e,web_server:n}),d.timeToFirstByteLogger.log(new m.TimeToFirstByteEventRow({time_to_first_byte:Math.round(t.value),product_name:e})))})}deriveAndLogFirstContentfulPaint(){this.metricsCollector.onFCP(t=>{this.logMetricToAmp("time_to_first_contentful_paint_ms",t.value)})}deriveAndLogLargestContentfulPaint(){this.metricsCollector.onLCP(t=>{this.logMetricToAmp("time_to_largest_contentful_paint_ms",t.value);const{productName:e}=this.getProductNameAndServer();_.largestContentfulPaintLogger.log(new l.LargestContentfulPaintEventRow({largest_contentful_paint:Math.round(t.value),product_name:e}));const i=new CustomEvent("largest_contentful_paint",{detail:{value:t.value}});window.dispatchEvent(i)})}deriveAndLogFirstInputDelay(){this.metricsCollector.onFID(t=>{const e=t.entries[0].startTime;this.logMetricToAmp("time_to_first_input_ms",e),this.logMetricToAmp("first_input_delay_ms",t.value)})}deriveAndLogCumulativeLayoutShift(){this.metricsCollector.onCLS(t=>{this.logMetricToAmp("cumulative_layout_shift",t.value,null)})}deriveAndLogInteractionToNextPaint(){this.metricsCollector.onINP(t=>{this.logMetricToAmp("interaction_to_next_paint_ms",t.value)})}deriveAndLogTimeToVisuallyComplete(){this.metricsCollector.onTTVC(t=>{var e;if(t.duration<0)return;const{productName:n,webserver:s}=this.getProductNameAndServer(),c=null!==(e=(0,a.getSpaProductName)())&&void 0!==e?e:"UNKNOWN",_="script"===t.detail.navigationType?"ajax":t.detail.navigationType;r.timeToVisuallyCompleteLogger.log(new o.VisuallyCompleteEventRow({time_to_visually_complete:Math.round(t.duration),last_visible_change:(0,u.getTTVCDetail)(t),product_name:n,navigation_type:_})),0===t.start?this.logMetricToAmp("time_to_visually_complete_ms",t.duration,i.TimeUnit.MILLISECONDS,{did_network_timeout:t.detail.didNetworkTimeOut.toString()}):this.logMetricToAmp("time_to_visually_complete_ajax_ms",t.duration,i.TimeUnit.MILLISECONDS,{product:c,navigation_type:"ajax",did_network_timeout:t.detail.didNetworkTimeOut.toString()});const l={did_network_timeout:t.detail.didNetworkTimeOut.toString(),navigation_type:_};this.resourceSummary&&this.resourceSummary.total.script&&(l.all_js_loaded_from_cache=(0===this.resourceSummary.total.script.transfer_size).toString()),t.start>0&&(l.product=c),this.logMetricToAmp("time_to_visually_complete_all_ms",t.duration,i.TimeUnit.MILLISECONDS,l,!0),"UNKNOWN"!==c&&this.logMetricToAmp("time_to_visually_complete_spa_product_name_ms",t.duration,i.TimeUnit.MILLISECONDS,Object.assign(Object.assign({},l),{product:c}),!0),"UNKNOWN"!==n&&this.logMetricToAmp("ttvc",t.duration,i.TimeUnit.MILLISECONDS,Object.assign(Object.assign({},l),{product:n,web_server:s}),!0);const d=new CustomEvent("visually_complete",{detail:{value:t.duration,navigation_type:t.start>0?"ajax":"page_load"}});window.dispatchEvent(d);try{performance.mark("visually_complete",{startTime:t.duration}),performance.measure("visually_complete",{start:t.start,duration:t.duration})}catch(t){}})}deriveAndLogNumLongInputDelays(){this.metricsCollector.getLongInputDelays(t=>{this.logMetricToAmp("num_long_input_delays",t,null);const e=this.metricsCollector.annotations.get(s.AnnotationNameEnum.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS),i=this.metricsCollector.annotations.get(s.AnnotationNameEnum.AVG_LONG_INPUT_DELAY_MS);"number"==typeof e&&this.logMetricToAmp("long_input_delay_observation_overhead_ms",e),"number"==typeof i&&this.logMetricToAmp("avg_long_input_delay_ms",i)})}logTimeToInteractive(){this.metricsCollector.getTTI(t=>{const{productName:e,webserver:n}=this.getProductNameAndServer();"UNKNOWN"!==e&&this.logMetricToAmp("tti",t,i.TimeUnit.MILLISECONDS,{product:e,web_server:n},!0)})}deriveAndLogTimeToConsistentlyInteractive(){}observeRageClicks(){}getProductNameAndServer(){const t=(0,c.mapPathToProduct)(new URL(window.location.toString()));let e="unknown";return window.RUNNING_IN_EDISON?e="edison":window.ensemble&&(e="dws"),{productName:t,webserver:e}}logMetricToAmp(t,e,n=i.TimeUnit.MILLISECONDS,s,r=!1){if(!r&&!this.shouldLogToAmp)return;const o=this.metricsReporter.createStats(this.createAMPMetric(t),s);n?o.recordDuration(e,i.TimeUnit.MILLISECONDS):o.record(e)}createAMPMetric(t){return{ns:this.AMP_NAMESPACE,name:`browser/${t}`}}}e.MetricsLogger=p,void 0!==window&&p.getSingleton();e.logUserCentricPerfMetrics=(t,e,i)=>{const n=p.getSingleton();n.metricsReporter=t,n.shouldLogToAmp=e,n.resourceSummary=i,n.deriveAndLogAllMetrics()}})),define("metaserver/static/js/user_centric_perf_metrics/visually_complete_logger",["require","exports","metaserver/static/js/logging/telemetry"],(function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.timeToVisuallyCompleteLogger=void 0,e.timeToVisuallyCompleteLogger=new i.HiveLogger})),define("metaserver/static/js/logging/hive/schemas/web-visually_complete",["require","exports","metaserver/static/js/modules/constants/request"],(function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VisuallyCompleteEventRow=void 0;e.VisuallyCompleteEventRow=class{constructor(t){this.category="web-visually_complete",this.user_id=null,this.country=null,this.referrer=null,this.session_id=null,this.user_agent=null,this.ua_browser_name=null,this.ua_browser_version=null,this.time_to_visually_complete=t.time_to_visually_complete,this.last_visible_change=t.last_visible_change,this.product_name=t.product_name,this.navigation_type=t.navigation_type,this.request_id=i.REQUEST_ID,Object.seal(this)}}})),define("metaserver/static/js/user_centric_perf_metrics/visually_complete_helpers",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getTTVCDetail=void 0;const i=new RegExp("^(?:data|aria)-"),n=new Set(["value","alt","title","style"]);function s(t){const e=[];for(const i of t.attributes)e.push(i.name);for(const s of e)if("src"===s||"href"===s){const e=t.getAttribute(s);try{t.setAttribute(s,new URL(e).hostname)}catch(e){t.setAttribute(s,"****")}}else i.test(s)?t.setAttribute(s,"****"):n.has(s)&&t.setAttribute(s,"****");return t}e.getTTVCDetail=t=>{const e=t.detail.lastVisibleChange;let i="";if(e instanceof HTMLElement){i="load event: "+s(e.cloneNode(!1)).outerHTML}else e&&(i="mutation: "+(function(t){const e={type:t.type,target:t.target,addedNodes:t.addedNodes,removedNodes:t.removedNodes,attributeName:t.attributeName,attributeNamespace:t.attributeNamespace};return JSON.stringify(e,(t,e)=>{if(null!=e&&0!==Object.keys(e).length){if(e instanceof Element)return s(e=e.cloneNode(!1)).outerHTML;if(!(e instanceof Node))return e}}," ")})(e));return i}}));
//# sourceMappingURL=pkg-timing-new-proto.min.js-vflhFHHuP.map