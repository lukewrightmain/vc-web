define(["require","exports","./c_tslib","./e_ui_page_files_router","./e_edison","./c_src_file_viewer_components","./c_src_video_controls_video_controls_toolbar","./c_videojs_dist_video","./c_src_core_resizer","./c_preview_audio_video_helper_image_size","./c_preview_audio_video_helper_utils","./c_ui-icon_line_settings","./c_src_video_controls_audio_video_markers","./c_ui-icon_fill_sound-on","./c_ui-icon_line_sidebar-show","./c_ui-icon_line_sound-on","./c_core_logging_constants","./c_core_logging_video","./c_core_utils_time_utils","./c_src_logging_performance","./c_lodash-es_lodash","./c_preview_audio_video_video_editing_utils","./c_src_ui_error_boundary","./c_ui-icon_fill_play-circle","./c_src_hooks_use_toolbar_override","./c_core_utils_redesign2023"],(function(e,t,r,o,i,a,n,s,l,c,d,u,p,m,h,_,v,g,f,b,y,k,w,E,S,R){"use strict";class C{constructor(){this.average=0,this.count=0}getAverage(){return this.average}add(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++}addArray(e){const t=e.reduce(((e,t)=>e+t)),r=this.count+e.length;this.average=(this.average*this.count+t)/r,this.count=r}}o.injectInternalStyle("typescript/libraries/file-viewer/src/preview_audio_video/components/audio_waveform.module.out.css",(e=>".vjs-audio-waveform{background-color:var(--color__faint__background);width:100%}._waveform_sushl_5{background-color:var(--color__faint__background);overflow:hidden;position:relative}._waveform--hidden_sushl_10{bottom:51px;display:inline-block;left:0;margin:auto;pointer-events:none;position:absolute;right:0;top:0}"));const x="audioWaveform",T=s.videojs.getComponent("Component"),V="#637282";class $ extends T{constructor(e,t){super(e,t),this.setSeekTime=e=>{this.player().currentTime(e)},this.mount=()=>{i.reactDom.exports.render(i.React$1.createElement(P,{onSeek:this.setSeekTime,duration:this.player().duration(),player:this.player(),waveformHeights:this.waveformHeights,hideControls:this.hideControls}),this.el())},this.waveformHeights=t.waveformHeights,this.hideControls=t.hideControls,e.ready(this.mount),this.addClass("vjs-audio-waveform")}dispose(){i.reactDom.exports.unmountComponentAtNode(this.el())}}const P=({player:e,duration:t,onSeek:r,waveformHeights:o,hideControls:a})=>{const n=i.react.exports.useRef(!1),[s,c]=i.react.exports.useState(),d=i.react.exports.useRef(null),[u,p]=i.react.exports.useState(null);i.react.exports.useEffect((()=>{const r=()=>{const r=e.currentTime()/(t||e.duration()||1/0);c(r)};return e.on("timeupdate",r),()=>{e.off("timeupdate",r)}}),[e,t]);const m=({height:e,width:t})=>{p({width:t,height:a?e:e-51-10})};function h(t){c(t);const o=t*e.duration();r(o)}return i.React$1.useEffect((()=>{d.current&&m({height:d.current.clientHeight,width:d.current.clientWidth})}),[]),i.React$1.createElement(l.Resizer,{elementRef:d,onResize:m},i.React$1.createElement("div",{style:{height:"100%",width:"100%"},ref:d},i.React$1.createElement(M,{onMouseMove:function(e,t){n.current&&h(t)},onMouseDown:function({},e){n.current=!0,h(e)},onMouseUp:function(){n.current=!1},scrubPercent:s,waveformHeights:o,width:null==u?void 0:u.width,height:null==u?void 0:u.height})))};P.displayName="AudioWaveform";const M=({onMouseUp:e,height:t,scrubPercent:r,width:o,waveformHeights:a,onMouseDown:n,onMouseMove:s})=>{const l=i.React$1.useRef(null);i.react.exports.useEffect((()=>(document.addEventListener("mouseup",p),document.addEventListener("mousemove",u),()=>{document.removeEventListener("mouseup",p),document.removeEventListener("mousemove",u)})),[]);const c=i.react.exports.useCallback((function(){const{current:e}=l;if(!e)return;const i=e.getContext("2d");if(!i)return;if(!t||!o)return;const n=function(e){const t=Math.floor((e-2)/4);return function(e,t,r=1){const o=[];if(void 0===e||0===e.length||t<=0||isNaN(t))return o;const i=[];for(let e=0;e<t;e++)i.push(new C);let a=0,n=0;for(let r=0;r<e.length;r++){const s=e[r],l=Math.floor(r*t/e.length),c=i[l];c.add(s),o[l]=c.getAverage(),l!==n&&(a=Math.max(a,o[n]),n=l)}return a=Math.max(a,o[t-1]),o.map((e=>e*r/a))}(a,t,.85)}(o);e.width=1*o,e.height=1*t,i.globalAlpha=0,i.fillStyle="black",i.fillRect(0,0,o,t),i.globalAlpha=1;const s=r*o;let c=0;if(s)for(i.fillStyle="rgba(27, 39, 51, 0.08)",i.fillRect(0,0,s,t),i.fillStyle="#1B2733";c<n.length;c++){const e=4*c,r=n[c],o=r*t,a=(1-r)*t;if(e+2>=s){i.fillRect(e,a,s-e,o),i.globalAlpha=.3,i.fillStyle=V,i.fillRect(s,a,e+2-s,o),c++;break}i.fillRect(e,a,2,o)}for(i.globalAlpha=.3,i.fillStyle=V;c<n.length;c++){const e=n[c];i.fillRect(4*c,(1-e)*t,2,e*t)}}),[t,o,r]);function d(e){if(!l.current)return null;const t=l.current.getBoundingClientRect();return(e.pageX-t.left)/t.width}function u(e){s&&requestAnimationFrame((()=>{const t=d(e);t&&s(e,t)}))}function p(t){if(e){const r=d(t);r&&e(t,r)}}return i.react.exports.useEffect((()=>{l.current&&c()}),[c]),i.React$1.createElement("canvas",{className:"_waveform_sushl_5",ref:l,style:{position:"relative",overflow:"hidden"},onMouseDown:function(e){const t=e.nativeEvent;if(0===t.button&&n){const e=d(t);e&&n(t,e)}},"data-testid":"fv-sdk-audio-preview-waveform-canvas"})};var I;M.displayName="AudioWaveformView",function(e){e[e.VIDEOJS_PLAYLIST_RETRY_THRESHOLD=10]="VIDEOJS_PLAYLIST_RETRY_THRESHOLD"}(I||(I={}));o.injectInternalStyle("typescript/libraries/file-viewer/src/preview_audio_video/settings_menu/settings_menu.module.out.css",(e=>"._quality-badge_1984y_1{align-items:center;border-radius:0;display:flex;font-size:8px;font-weight:500;height:10px;justify-content:center;line-height:11px;min-width:15px;padding:0;position:absolute;right:0;top:0;width:15px}._quality-badge-embed_1984y_19{top:6px}"));function j(e){return i.React$1.createElement("li",{onClick:e.onClick,role:"menuitem",className:"vjs-menu-top-level-item"},i.React$1.createElement("div",{className:"vjs-menu-top-level-item-group"},i.React$1.createElement("div",{className:"vjs-menu-top-level-item-text"},e.label),i.React$1.createElement("div",{className:"vjs-menu-top-level-item-selected-value"},e.current),i.React$1.createElement(o.UIIcon,{src:o.ChevronRightLine})))}function N({children:e}){return i.React$1.createElement("div",{className:"vjs-menu-top-level"},e)}function O(e){const t=e.items.map((t=>{const{key:r,label:a,marginText:n}=t,s=e.selected&&e.selected.includes(r);return i.React$1.createElement("li",{className:"vjs-menu-settings-sub-menu-item-row",key:r},i.React$1.createElement("div",{className:"vjs-menu-settings-sub-menu-item-margin-text"},n),i.React$1.createElement("div",{className:o.classnames({"vjs-menu-settings-sub-menu-item":!0,"vjs-menu-settings-sub-menu-item-selected":s})},i.React$1.createElement("button",{className:"vjs-menu-settings-sub-menu-item-button",role:"menuitem",onClick:!s||e.allowReselect?()=>e.onSelected(r,a):void 0},a)))}));return i.React$1.createElement("div",{className:"vjs-menu-settings-sub-menu"},i.React$1.createElement("button",{role:"button",className:"vjs-menu-settings-sub-menu-title",onClick:e.onBack},i.React$1.createElement(o.UIIcon,{src:o.ChevronLeftLine}),i.React$1.createElement("div",{className:"vjs-menu-settings-sub-menu-title-text"},e.title)),i.React$1.createElement("ul",null,t))}function D(e){return e.showing?i.React$1.createElement("div",{className:"vjs-menu"},i.React$1.createElement("ul",{className:"vjs-menu-content"},function(e){return e.activeId&&e.activeId in e?e[e.activeId]:e.topLevel}(e))):null}const L=({label:e,autoSelecting:t,selectedQuality:r,qualityList:o,onBack:a,onQualitySelected:n})=>{const s=t?["auto"]:[],l=r?s.concat([r.key]):s,c=o.map((e=>({key:e.key,label:e.label,marginText:e.sublabel}))).concat([{key:"auto",label:"Auto"}]);return i.React$1.createElement(O,{key:"qualitySelector",items:c,title:e,onSelected:(e,o)=>{"auto"===e&&t&&r?n(r.key,r.label):(t||r&&e!==r.key)&&n(e,o)},onBack:a,selected:l,allowReselect:!0})};L.displayName="QualitySelector";const A=[.5,1,1.25,1.5,2],B="vjsSettingsMenu",F=s.videojs.getComponent("Component");class U extends F{constructor(e,t){super(e,t),this.audioMenuItems=[],this.setPlaybackRate=e=>{this.player().playbackRate(e)},this.setAudioTrack=e=>{this.player().audioTracks()[e].enabled=!0},this.mount=()=>{var e;i.reactDom.exports.render(i.React$1.createElement(q,{intl:this.intl,onPlaybackRateSelected:this.setPlaybackRate,quality:null===(e=this.qualityManager)||void 0===e?void 0:e.generateQualityProps(),playbackRateItems:this.playbackRateItems,tracks:this.audioMenuItems,onNewAudioTrackSelected:this.setAudioTrack}),this.el())},null==e||e.ready(this.mount),this.addClass("vjs-settings-menu"),this.onSelectQuality=null==t?void 0:t.onSelectQuality,this.intl=null==t?void 0:t.intl,(null==t?void 0:t.showAudioTrackSubmenuInEmbed)&&e.on("loadedmetadata",(()=>{const t=Array.from(e.audioTracks());this.audioMenuItems=n.getAudioTrackNames(t,this.intl.locale,this.intl).map(((e,t)=>({key:t.toString(),label:e})))})),this.playbackRateItems=A.map((e=>{const t=this.intl.formatNumber(e,{minimumFractionDigits:1});return{key:e.toString(),label:this.intl.formatMessage({id:"nu0Yus",defaultMessage:"{rate}x"},{rate:t})}})),this.qualityManager=new n.VideoQualityManager(e,this.mount,this.onSelectQuality)}dispose(){i.reactDom.exports.unmountComponentAtNode(this.el())}}const q=({intl:e,onPlaybackRateSelected:t,playbackRateItems:r,quality:a,tracks:n,onNewAudioTrackSelected:s})=>{var l,c;const[d,p]=i.react.exports.useState(!1),[m,h]=i.react.exports.useState(),_=i.React$1.useMemo((()=>r.find((e=>"1"===e.key))),[r]),[v,g]=i.react.exports.useState((null==_?void 0:_.label)||""),[f,b]=i.react.exports.useState(0);const y={role:"menubutton","aria-haspopup":!0,"aria-expanded":d},k=e.formatMessage({id:"kTwqOm",defaultMessage:"Quality"}),w=e.formatMessage({id:"7sloqR",defaultMessage:"Speed"}),E=e.formatMessage({id:"pE97ks",defaultMessage:"Audio Track"}),S=a&&a.selectedQuality&&a.selectedQuality.sublabel;return i.React$1.createElement(o.ClickOutside,{isActive:d,onClickOutside:function(){d&&p(!1)},shouldPropagateMouseEvents:!0},i.React$1.createElement("div",{className:o.classnames("vjs-button","vjs-control","vjs-menu-button-popup")},i.React$1.createElement(o.IconButton,Object.assign({variant:"transparent",onClick:function(){p(!d)},inverse:!0,className:o.classnames("vjs-button","vjs-control","vjs-menu-button-popup","vjs-settings-menu-trigger")},y),S&&i.React$1.createElement(o.AccessoryBadge,{status:"attention",className:o.classnames("_quality-badge_1984y_1","_quality-badge-embed_1984y_19")},S),i.React$1.createElement(o.UIIcon,{src:u.SettingsLine})),i.React$1.createElement(D,{showing:d,activeId:m,topLevel:i.React$1.createElement(N,null,i.React$1.createElement(j,{label:w,current:v,onClick:()=>h("playbackRate")}),a&&a.qualityList.length>1?i.React$1.createElement(j,{label:k,current:null===(l=a.selectedQuality)||void 0===l?void 0:l.label,onClick:()=>h("qualitySelector")}):null,n.length>1?i.React$1.createElement(j,{label:E,current:null===(c=n[f])||void 0===c?void 0:c.label,onClick:()=>h("audioSelector")}):null),playbackRate:i.React$1.createElement(O,{key:"playbackRate",items:r,title:w,onSelected:function(e,r){g(r),t(parseFloat(e))},onBack:()=>h(void 0),selected:[v]}),qualitySelector:a?i.React$1.createElement(L,Object.assign({label:k,onBack:()=>h(void 0)},a,{onQualitySelected:function(e,t){a.onQualitySelected(e,t)}})):null,audioSelector:i.React$1.createElement(O,{key:"audioSelector",items:n,title:E,onSelected:function(e){b(parseFloat(e)),s(parseFloat(e))},onBack:()=>h(void 0)})})))};q.displayName="SettingsMenuComponent",s.videojs.registerComponent(B,U);const H="mouseTimeDisplay",z=s.videojs.getComponent("Component");var J;!function(e){e.Requesting="requesting",e.Failed="failed",e.ImageLoaded="image_loaded"}(J||(J={}));class Q extends z{constructor(e,t){var r;super(e,t),this.mount=()=>{i.reactDom.exports.render(i.React$1.createElement(K,{vttUrl:this.src,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,ref:e=>this.thumbnailComponent=e}),this.el())},this.src=null!==(r=null==t?void 0:t.src)&&void 0!==r?r:"",this.thumbnailComponent=null,this.onScrubberThumbnailsLoaded=null==t?void 0:t.onScrubberThumbnailsLoaded,e&&e.ready(this.mount)}dispose(){i.reactDom.exports.unmountComponentAtNode(this.el())}update(e,t){const r=this.player().duration();this.thumbnailComponent&&this.thumbnailComponent.update(e,t,r)}}class K extends i.React$1.Component{constructor(e){super(e),this.thumbs=[],this.state={seekPointX:0,playerWidth:0,formattedTime:"",thumbLoadState:null!=e.vttUrl?J.Requesting:J.Failed},e.vttUrl&&p.loadVtt(e.vttUrl).then((t=>{if(this.thumbs=t,t&&t.length>0)return p.preloadThumbImage(t[0]).then((()=>{this.setState({thumbLoadState:J.ImageLoaded}),e.onScrubberThumbnailsLoaded&&e.onScrubberThumbnailsLoaded(!0)})).catch((()=>{e.onScrubberThumbnailsLoaded&&(e.onScrubberThumbnailsLoaded(!1),this.setState({thumbLoadState:J.Failed}))}))})).catch((()=>{e.onScrubberThumbnailsLoaded&&(e.onScrubberThumbnailsLoaded(!1),this.setState({thumbLoadState:J.Failed}))}))}update(e,t,r){const o=t*r,i=e.width*t;let a={};if(this.thumbs){const e=this.thumbs.find((e=>e.startTime<=o&&e.endTime>=o));e&&(a=p.parseVttCue(e))}const n=s.videojs.formatTime(o,r);this.setState(Object.assign({playerWidth:e.width,seekPointX:i,formattedTime:n},a))}render(){const{playerWidth:e,seekPointX:t,formattedTime:r,imageUrl:a,imageX:n,imageY:s,imageWidth:l,imageHeight:c,thumbLoadState:d}=this.state;let u={},p=128;switch(d){case J.ImageLoaded:u={background:`url("${a}") no-repeat -${n}px -${s}px`,width:l,height:c};break;case J.Failed:p=40,u={display:"none"}}const m=Math.min(Math.max(0,t-p/2),e-p),h={left:m,width:p},_={left:t-(m+p/2)};return i.React$1.createElement("div",{className:"vjs-thumbnail-wrapper",style:h},i.React$1.createElement("div",{className:"vjs-thumbnail-image",style:u},d===J.Requesting?i.React$1.createElement(o.Spinner,{"aria-valuetext":"Loading the video thumbnail",size:"small"}):null),i.React$1.createElement("div",{className:"vjs-thumbnail-time"}," ",r," "),i.React$1.createElement("div",{className:"vjs-time-line",style:_}))}}K.displayName="VideoThumbnailsComponent";const G=s.videojs.getComponent("Component"),Y="vjsMediaIcon";class W extends G{constructor(e,t){super(e,t),this.mount=()=>{const e={[n.MediaIcons.Play]:_.PlayLine,[n.MediaIcons.Pause]:_.PauseLine,[n.MediaIcons.Volume]:m.SoundOnFill,[n.MediaIcons.VolumeMuted]:m.SoundOffFill,[n.MediaIcons.FullScreen]:h.FullscreenLine,[n.MediaIcons.FullScreenExit]:h.FullscreenExitLine,[n.MediaIcons.Settings]:m.SettingsFill}[this.iconId];i.ReactDOM.render(i.React$1.createElement("div",null,i.React$1.createElement(o.UIIcon,{className:this.iconId,src:e})),this.el())},this.iconId=null==t?void 0:t.iconId,e&&e.ready(this.mount)}dispose(){i.ReactDOM.unmountComponentAtNode(this.el()),super.dispose()}}const X="vjsTitle",Z=s.videojs.getComponent("Component");class ee extends Z{constructor(e,t){var r;super(e,t),this.mount=()=>{i.ReactDOM.render(i.React$1.createElement("div",{className:"vjs-title"},this.title),this.el())},this.title=null!==(r=null==t?void 0:t.title)&&void 0!==r?r:"",this.addClass("vjs-title-wrapper"),e&&e.ready(this.mount)}dispose(){i.ReactDOM.unmountComponentAtNode(this.el()),super.dispose()}}const te=s.videojs.getComponent("Button");class re extends te{constructor(e,t){super(e,t),this.disposeEvents=()=>{},this.mount=()=>{const e="forward"===this.direction?_.ForwardTenSecondsLine:_.BackTenSecondsLine;i.ReactDOM.render(i.React$1.createElement(o.UIIcon,{src:e}),this.el())},this.direction=t.direction,this.controller=new n.SkipSecondsController({direction:t.direction,player:e,intl:t.intl,onSkip:()=>{t.onSkipSeconds(this.direction)}}),this.on("click",this.controller.skipPlayer.bind(this.controller)),this.on("dispose",(()=>{this.disposeEvents(),i.ReactDOM.unmountComponentAtNode(this.el())}));const r=e=>e?this.disable():this.enable();e.ready((()=>{this.mount(),this.disposeEvents=d.disableAtEndpoint(e,this.direction,r)}))}}class oe extends re{constructor(e,t){super(e,Object.assign(Object.assign({},t),{direction:"backward"})),this.addClass(n.rewindButton)}}class ie extends re{constructor(e,t){super(e,Object.assign(Object.assign({},t),{direction:"forward"})),this.addClass(n.fastforwardButton)}}const ae=s.videojs.getComponent("component"),ne="VideoBufferingLoadingSpinner";class se extends ae{constructor(e,t){super(e,t),this.mount=()=>{i.reactDom.exports.render(i.React$1.createElement("div",{className:n.loadingSpinnerContainer},i.React$1.createElement(o.Spinner,{className:"updated-loading-spinner",size:"standard"})),this.el())},e.on("waiting",this.mount)}}const le=(e,t)=>{const r=[g.VideoPreviewEvent.PlayerRendered,g.VideoPreviewEvent.FirstClickPlay,g.VideoPreviewEvent.MediaError];if(e&&!r.includes(t))return e.duration()||void 0},ce={preload:"auto",controls:!0,playbackRates:[.5,1,1.25,1.5,2],nativeControlsForTouch:a.is_mobile_or_tablet(),controlBar:{children:["progressControl","playToggle","currentTimeDisplay","remainingTimeDisplay","timeDivider","durationDisplay"]},html5:{vhs:{overrideNative:!0,withCredentials:!0},nativeTextTracks:a.is_mobile_or_tablet()}},de={preload:"auto",controls:!0,playbackRates:[.5,1,1.25,1.5,2],nativeControlsForTouch:a.is_mobile_or_tablet(),controlBar:{children:["remainingTimeDisplay"]},html5:{vhs:{overrideNative:!0,withCredentials:!0},nativeTextTracks:a.is_mobile_or_tablet()}},ue=`.${n.loadingSpinnerContainer}`,pe="application/vnd.apple.mpegurl";function me({previewMetadata:t,rivieraData:l,previewKey:u,fileViewerId:p,fileViewerUiData:m,isAudio:h,hideControls:_,initialVideoBandwidth:k,videoBufferLength:w,bufferMoreBeforePlay:E,useBufferBasedABR:S,onRenderSucceeded:R,onInteractive:C,timeRange:T,showAudioTrackSubmenuInEmbed:V}){var P,M,j,N,O,D;const L=o.useIntl(),A=o.useDispatch(),[F,q]=i.react.exports.useState(),z=n.useDuration(F),{muted:J,volume:K}=o.useSelector(a.getVolumeState),G=i.react.exports.useRef(null),Z=i.react.exports.useRef(null),te=i.react.exports.useRef(0),re=i.react.exports.useRef(void 0),ae=i.react.exports.useRef(0),me=i.react.exports.useRef({}),he="video"===(null===(P=null==t?void 0:t.content)||void 0===P?void 0:P[".tag"])||"audio"===(null===(M=null==t?void 0:t.content)||void 0===M?void 0:M[".tag"])?t.content:null,_e="video"===(null===(j=null==t?void 0:t.content)||void 0===j?void 0:j[".tag"])?t.content:null,ve=o.useSelector((e=>a.getFilePreviewSessionId(e,p))),ge=o.useSelector((e=>a.getFilePreviewUi(e,p,u))),fe=a.filterAudioVideoFilePreviewUiState(ge),be=null==fe?void 0:fe.isDefaultAudioTrackSelected,ye=null==l?void 0:l.waveformData,ke=null==l?void 0:l.isTruncated,we=i.react.exports.useRef(g.VideoPreviewEvent.VideoStartsPlaying),Ee=i.react.exports.useRef(),Se=i.react.exports.useRef(),Re=i.react.exports.useRef(),Ce=i.react.exports.useRef(1),xe=i.react.exports.useRef({qualityLabel:"auto",isUserSelected:!1,isLowestAvailable:!1}),Te=i.react.exports.useRef(null),Ve=i.react.exports.useRef(0),$e=i.react.exports.useRef({}),Pe=i.react.exports.useRef(0),Me=i.react.exports.useRef(0),Ie=i.react.exports.useRef(null),je=i.react.exports.useRef(null),Ne=i.react.exports.useRef(0),Oe=i.react.exports.useRef(0),De=i.react.exports.useRef(!1),Le=i.react.exports.useRef(!1),Ae=null==he?void 0:he.transcode_url,Be=null==_e?void 0:_e.transcode_urls_separate_resolutions,Fe=(null==_e?void 0:_e.poster_url_tmpl)?d.tagCriticalPathContentRequest(c.getSizedImageUrl(_e.poster_url_tmpl),ve):void 0,Ue=null==_e?void 0:_e.thumb_scrubber_vtt_url,{logPlayerRendered:qe,logVideoMetadataLoaded:He,logVideoHasMultipleTracks:ze,logVideoProgressThroughThreshold:Je}=(({videoPlayer:e,previewSessionId:t,fileViewerId:r,videoTruncated:i})=>{const n=o.useDispatch(),s=(o,s)=>{null!=t&&n(a.logVideoEvent({eventName:o,fileViewerId:r,previewSessionId:t,videoTruncated:i,videoDuration:le(e,o),extra:s}))};return{logPlayerRendered:()=>{s(g.VideoPreviewEvent.PlayerRendered)},logVideoMetadataLoaded:()=>{e&&s(g.VideoPreviewEvent.VideoMetadataLoaded)},logVideoHasMultipleTracks:()=>{e&&e.audioTracks().length>1&&s(g.VideoPreviewEvent.HasMultipleAudioTracks)},logVideoProgressThroughThreshold:t=>{if(e&&t){const r=e.duration();t>=1&&s(g.VideoPreviewEvent.VideoProgress1Second),r&&t/r>=.02&&s(g.VideoPreviewEvent.VideoProgress2Percent)}}}})({videoPlayer:F,previewSessionId:ve,fileViewerId:p,videoTruncated:!!ke}),Qe=i.react.exports.useCallback(((e,t)=>{null!=ve&&Ee.current!==e&&(Ee.current=e,A(a.logSessionEvent({event:e,fileViewerId:p,previewSessionId:ve,extra:t})))}),[A,p,ve]),Ke=i.react.exports.useCallback(((e,t)=>{Ee.current!==e&&(Ee.current=e,A(a.logPreviewEvent({event:e,fileViewerId:p,extra:t})))}),[A,p]),Ge=a.useStabilizedCallback(((e,t)=>{A(a.logUserActionEvent({userAction:e,fileViewerId:p,actionContext:v.UserActionContext.Toolbar,extra:t}))})),Ye=i.react.exports.useCallback(((e,t)=>{null!=ve&&A(a.logVideoEvent({eventName:e,fileViewerId:p,previewSessionId:ve,videoTruncated:ke,videoDuration:le(F,e),extra:t}))}),[ve,A,p,ke,F]),We=i.react.exports.useCallback(((e,t,r)=>{null!=ve&&A(a.logVideoEventQuantity({eventName:e,quantity:t,fileViewerId:p,previewSessionId:ve,videoTruncated:ke,videoDuration:le(F,e),extra:r}))}),[ve,A,p,ke,F]),Xe=i.react.exports.useCallback(((e,t,r)=>{null!=ve&&A(a.logVideoEventDuration({eventName:e,durationInMs:t,fileViewerId:p,previewSessionId:ve,videoTruncated:ke,videoDuration:le(F,e),extra:r}))}),[ve,A,p,ke,F]),Ze=i.react.exports.useCallback(y.once((()=>{var e,t,r;if(!h){const o={num_stalls:Ne.current.toString(),total_stall_duration:Oe.current.toString(),video_quality:xe.current.qualityLabel,play_duration_seconds:Ve.current.toString(),play_duration_seconds_quality_breakdown:JSON.stringify($e.current),was_preview_ever_offline:De.current.toString()};if(Ve.current&&Xe(g.VideoPreviewEvent.PlayDurationMs,1e3*Ve.current,{video_quality:xe.current.qualityLabel,play_duration_seconds_quality_breakdown:o.play_duration_seconds_quality_breakdown}),null!==Ie.current&&(o[g.VideoPreviewEvent.TimeToFirstFrame]=Ie.current.toString(),Xe(g.VideoPreviewEvent.TimeToFirstFrame,Ie.current)),Ve.current>0){const e=Ne.current/Ve.current;o[g.VideoPreviewEvent.StallsPerSecondOfPlayback]=e.toString(),We(g.VideoPreviewEvent.StallsPerSecondOfPlayback,e);const t=Oe.current/Ve.current;o[g.VideoPreviewEvent.TotalStallDurationOverTotalPlaybackDuration]=(t/1e3).toString(),Xe(g.VideoPreviewEvent.TotalStallDurationOverTotalPlaybackDuration,t)}const i=null===(e=null==F?void 0:F.getVideoPlaybackQuality)||void 0===e?void 0:e.call(F);if(i&&"number"==typeof i.droppedVideoFrames&&(o.dropped_video_frames=i.droppedVideoFrames.toString(),We(g.VideoPreviewEvent.DroppedVideoFrames,i.droppedVideoFrames),"number"==typeof i.totalVideoFrames&&i.totalVideoFrames>0)){const e=i.droppedVideoFrames/i.totalVideoFrames;o.dropped_video_frames_over_total_video_frames=e.toString(),We(g.VideoPreviewEvent.DroppedVideoFramesOverTotalVideoFrames,e)}if(F){const e=null===(r=null===(t=d.getTechFromPlayer(F))||void 0===t?void 0:t.vhs)||void 0===r?void 0:r.stats;if(e&&"number"==typeof e.mediaBytesTransferred&&"number"==typeof e.mediaTransferDuration&&e.mediaTransferDuration>0){const t=e.mediaBytesTransferred/(e.mediaTransferDuration/1e3);o.network_bandwidth_bytes_per_second=t.toString(),We(g.VideoPreviewEvent.NetworkBandwidthBytesPerSecond,t)}}Je(Ve.current),Ye(g.VideoPreviewEvent.VideoPlaybackSmoothness,o)}})),[Ye,h]),et=a.useStabilizedCallback(Ze),tt=i.react.exports.useCallback((()=>{A(a.setupGetPlayDurationSeconds({getPlayDurationSeconds:()=>({play_duration_seconds:Ve.current,play_duration_seconds_cc:Pe.current,play_duration_seconds_transcript:Me.current})}))}),[A]),rt=i.react.exports.useCallback(y.once((()=>{Ye(g.VideoPreviewEvent.FirstClickPlay)})),[Ye]),ot=i.react.exports.useCallback((e=>{A(a.updateAudioVideoPlaybackState(Object.assign({fileViewerId:p,previewKey:u},e)))}),[A,u,p]),it=i.react.exports.useCallback((e=>{ot({currentTimestamp:e})}),[ot]),at=i.react.exports.useCallback((e=>{Re.current=e,ot({currentTimestamp:e,isPlaying:!1}),Ye(g.VideoPreviewEvent.VideoPaused,{video_timestamp:e.toString()})}),[Ye,ot]),nt=i.react.exports.useCallback((e=>{ot({currentTimestamp:e,isPlaying:!0}),rt()}),[rt,ot]),st=i.react.exports.useCallback(((e,t,r,o)=>{var i,a;if(null!==je.current){const e=performance.now()-je.current;Oe.current+=e,je.current=null,Ye(g.VideoPreviewEvent.VideoStalledResume,{total_stall_duration:e.toString(),video_height:(null==r?void 0:r.toString())||"0",video_width:(null==o?void 0:o.toString())||"0",old_video_time:null===(i=Re.current)||void 0===i?void 0:i.toString(),new_video_time:null===(a=Se.current)||void 0===a?void 0:a.toString()})}Se.current&&Re.current&&(Ye(g.VideoPreviewEvent.SeekVideo,{old_video_time:Re.current.toString(),new_video_time:Se.current.toString()}),Re.current=void 0,Se.current=void 0),ot({currentTimestamp:e,isPlaying:!0}),Ye(we.current,{play_latency:t.latency.toString(),play_latency_since:t.trigger.toString(),video_quality:xe.current.qualityLabel}),we.current=g.VideoPreviewEvent.VideoResumesPlaying}),[Ye,ot]),lt=i.react.exports.useCallback((()=>{Ze(),Ye(g.VideoPreviewEvent.MediaEnded)}),[Ye,Ze]),ct=i.react.exports.useCallback((e=>{e!==Ce.current&&(Ce.current=e,Ke(v.EventType.VideoPlaybackRateChanged,{playback_rate:e.toString()}))}),[Ke]),dt=i.react.exports.useCallback((e=>{je.current=performance.now(),Ne.current+=1,ot({currentTimestamp:e,isPlaying:!1})}),[ot]),ut=i.react.exports.useCallback((e=>{e&&(Ye(g.VideoPreviewEvent.MediaError,{errorCode:e.code?e.code.toString():"",errorMessage:e.message||""}),"needflash"===e.message)?Qe(v.SessionEventType.FilePreviewSupportDenied):(e&&"No compatible source was found for this media."!==e.message&&Qe(v.SessionEventType.FilePreviewDownloadFailed),C())}),[Qe,Ye,C]),pt=i.react.exports.useCallback(((e,t)=>{Ye(g.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:t.toString()})}),[Ye]),mt=i.react.exports.useCallback(((e,t)=>{Se.current=t}),[]),ht=i.react.exports.useCallback(((e,t,r,o)=>{Ye(g.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:t.toString(),video_height:(null==r?void 0:r.toString())||"0",video_width:(null==o?void 0:o.toString())||"0"})}),[Ye]),_t=i.react.exports.useCallback((e=>{Ye(e?g.VideoPreviewEvent.ScrubberThumbnailsLoaded:g.VideoPreviewEvent.ScrubberThumbnailsFailed)}),[Ye]),vt=i.react.exports.useCallback((e=>{const t=xe.current.qualityLabel;xe.current=e,Ye(g.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:t,new_video_quality:e.qualityLabel,video_quality_changer:e.isUserSelected?"user_selected":"auto_resolution_picker"})}),[Ye]),gt=i.react.exports.useCallback((e=>{Ye(g.VideoPreviewEvent.TimeToLoad,{time_to_load:e.toString()})}),[Ye]),ft=i.react.exports.useCallback((e=>{Ge(v.UserAction.ChangePlaybackPosition,{playback_control:e})}),[Ge]),bt=i.react.exports.useCallback((()=>A(a.clearVideoRequests())),[A]),yt=a.useStabilizedCallback((()=>{F&&(C(),R(),qe(),b.PreviewsEventLogger.mark(b.PreviewsTimingEvents.FVSDK_VIDEO_PLAYER_READY),tt(),jt(F),d.getTechFromPlayer(F)&&(F.volume(K),F.muted(J)))})),kt=a.useStabilizedCallback((()=>{const e={fileViewerId:p,previewKey:u,sourceContext:v.UserActionContext.SurfaceGesture},t=m.isFullScreen;A(t?a.exitFullScreen(e):a.enterFullScreen(e))})),wt=i.react.exports.useMemo((()=>Object.assign(Object.assign({},de),{userActions:{doubleClick:kt}})),[kt]);i.react.exports.useEffect((()=>{window.addEventListener("offline",(function(){De.current=!0}),{once:!0})}),[]),i.react.exports.useEffect((()=>{var e;if(!G.current)return;const t=_?wt:ce;if(null!==k){const r=(null===(e=null===s.videojs||void 0===s.videojs?void 0:s.videojs.Vhs)||void 0===e?void 0:e.BANDWIDTH_VARIANCE)||1.2;t.html5.vhs=Object.assign(Object.assign({},t.html5.vhs),{bandwidth:k.bandwidth*r+1,limitRenditionByPlayerDimensions:!k.ignoreVideoPlayerSize})}w&&s.videojs.Vhs&&(s.videojs.Vhs.GOAL_BUFFER_LENGTH_RATE=w.goalBufferLengthRate,s.videojs.Vhs.MAX_GOAL_BUFFER_LENGTH=w.maxGoalBufferLength),S&&(t.html5.vhs=Object.assign(Object.assign({},t.html5.vhs),{bufferBasedABR:!0}));const r=s.videojs(G.current,Object.assign(Object.assign({},t),{language:L.locale,languages:{[L.locale]:{"Play Video":L.formatMessage({id:"UYH9A3",defaultMessage:"Play Video"})}},bigPlayButton:!1}),yt);return q(r),()=>{et(),function(e){if(e)try{e.trigger("shutdown"),e.dispose()}catch(e){}}(r),q(void 0)}}),[yt,wt,_,et]),i.react.exports.useEffect((()=>F&&d.setupVideoJsEvents(F,{loadedmetadata:()=>{ze(),He()}},!0)),[F]);const Et=a.useStabilizedCallback((()=>{if(F){const e=F.audioTracks(),t=e&&e[0].enabled;A(a.setIsDefaultAudioTrackSelected({fileViewerId:p,previewKey:u,isDefaultAudioTrackSelected:t}))}}));i.react.exports.useEffect((()=>{if(F){const e=F.audioTracks();return e.addEventListener("change",Et),()=>{e.removeEventListener("change",Et)}}}),[F,Et]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{seeked:y.debounce((()=>Ge(v.UserAction.AudioVideoSeeked)),200)})}),[F]),i.react.exports.useEffect((()=>{if(!E||!F)return;const e=T?T.start:0;F.currentTime(e),F.muted(!0);const t=()=>{F.muted(J),je.current=null,Ne.current=0,Oe.current=0,Le.current=!1};d.setupVideoJsEvents(F,{playing:()=>{d.setupVideoJsEvents(F,{pause:t},!0),F.pause(),F.currentTime(e)}},!0),Le.current=!0,F.play()}),[F,E]);const St=o.useSelector((e=>a.getVideoRequests(e)));i.react.exports.useEffect((()=>{null==Fe||T||null==F||F.poster(Fe)}),[Fe,F,T]),i.react.exports.useEffect((()=>{if(!_&&F){const e=()=>{const e={fileViewerId:p,previewKey:u,sourceContext:v.UserActionContext.SurfaceGesture,skipAction:!0};document.fullscreenElement?A(a.enterFullScreen(e)):A(a.exitFullScreen(e))};return d.setupVideoJsEvents(F,{fullscreenchange:e})}}),[F,_]),i.react.exports.useEffect((()=>{if(F){const e=()=>{if(F.paused())Te.current=null;else{const e=performance.now();if(null!==Te.current){const t=(e-Te.current)/1e3;Ve.current+=t,$e.current.hasOwnProperty(xe.current.qualityLabel)?$e.current[xe.current.qualityLabel]+=t:$e.current[xe.current.qualityLabel]=t,(null==fe?void 0:fe.isClosedCaptionShowing)&&(Pe.current+=t),(null==fe?void 0:fe.isTranscriptShowing)&&(Me.current+=t)}Te.current=e}it(F.currentTime())};return d.setupVideoJsEvents(F,{timeupdate:e})}}),[it,F,null==fe?void 0:fe.isClosedCaptionShowing,null==fe?void 0:fe.isTranscriptShowing]);const Rt=a.useStabilizedCallback((e=>{if(F){const t=document.querySelector(".vjs-poster");t&&(t.style.display=e?"block":"none")}})),Ct=a.useStabilizedCallback((e=>{if(F){const t=document.querySelector(ue);t&&(t.style.display=e?"flex":"none")}}));function xt(e){te.current=performance.now(),Z.current=e}i.react.exports.useEffect((()=>{if(F){const e=()=>{Le.current||(null==Z.current&&xt(g.VideoPreviewEvent.VideoStartsPlaying),nt(F.currentTime()),Rt(!1))},t=()=>{Le.current||st(F.currentTime(),function(){const e=performance.now(),t=Z.current;if(null==t)throw new Error("Expected non-null playLatencyTrigger");return{latency:e-te.current,trigger:t}}(),F.videoHeight(),F.videoWidth())},r=()=>{Le.current||(xt(g.VideoPreviewEvent.VideoPaused),F.currentTime(F.currentTime()),at(F.currentTime()))},o=()=>{Ct(!1),Rt(!0),lt()};return d.setupVideoJsEvents(F,{play:e,playing:t,pause:r,ended:o})}}),[at,nt,st,F,lt]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{userinactive:()=>ct(F.playbackRate())})}),[ct,F]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{waiting:()=>dt(F.currentTime())})}),[dt,F]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{canplay:()=>{(null==re?void 0:re.current)&&null===Ie.current&&(Ie.current=performance.now()-re.current)}},!0)}),[F]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{canplaythrough:()=>{(null==re?void 0:re.current)&&gt(performance.now()-re.current)}},!0)}),[gt,F]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{error:e=>{var t;const r=null!==(t=null==F?void 0:F.error())&&void 0!==t?t:e;ut(r)}})}),[ut,F]),i.react.exports.useEffect((()=>{if(F&&!_)return d.setupVideoJsEvents(F,{ratechange:()=>pt(1,F.playbackRate())})}),[pt,_,F]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{waiting:()=>Ct(!0),playing:()=>Ct(!1)})}),[F,Ct]),i.react.exports.useEffect((()=>{if(F){const e=()=>{ae.current=F.currentTime(),Rt(!1),Ct(!0)},t=()=>{var e,t;Ct(!1),mt(ae.current,F.currentTime()),null===(t=null===(e=F.getChild("controlBar"))||void 0===e?void 0:e.getChild("currentTimeDisplay"))||void 0===t||t.updateContent()};return d.setupVideoJsEvents(F,{seeked:t,seeking:e})}}),[mt,F]),i.react.exports.useEffect((()=>{if(F)return d.setupVideoJsEvents(F,{stalled:()=>{xt(g.VideoPreviewEvent.VideoStalled),ht(F.currentTime(),F.playbackRate(),F.videoHeight(),F.videoWidth())}})}),[ht,F]),i.react.exports.useEffect((()=>{F&&(F.one("loadstart",(()=>{re.current=performance.now();const e=d.getTechFromPlayer(F);e&&e.on("retryplaylist",(()=>{const t=e.vhs.selectPlaylist();let r;if(!e.vhs||!t||!(r=t.resolvedUri))return;const o=me.current;(++o[r]||(o[r]=1))>I.VIDEOJS_PLAYLIST_RETRY_THRESHOLD&&F.error(`Maximum retry limit reached for ${r}`)}))})),F.one("play",(()=>{F.controlBar.on("mouseleave",(()=>{F.options({inactivityTimeout:2e3})}))})))}),[F]),i.react.exports.useEffect((()=>{St.length>0&&F&&(St.forEach((e=>{switch(e.videoRequestType){case"seek":!function(e,t){r.__awaiter(this,void 0,void 0,(function*(){e.currentTime(t/100),e.pause()}))}(F,e.time);break;case"seekRelative":!function(e,t){0===e.currentTime()&&(e.play(),e.pause()),e.currentTime(e.currentTime()+t),e.pause()}(F,e.delta);break;case"pause":F.pause()}})),bt())}),[St,bt,F]),i.react.exports.useEffect((()=>{const e=null==F?void 0:F.getChild("LoadingSpinner");e&&(null==F||F.removeChild(e)),null==F||F.addChild(ne)}),[F]),i.react.exports.useEffect((()=>{if(_||!F)return;if(!F.getChild("ControlBar"))return;const e=F.controlBar.addChild(n.vjsComponentKeys.rewind,{intl:L,onSkipSeconds:ft},2),t=F.controlBar.addChild(n.vjsComponentKeys.fastForward,{intl:L,onSkipSeconds:ft},3);return()=>{F.controlBar.removeChild(e),F.controlBar.removeChild(t)}}),[F,_,L,ft]);const Tt="video"===(null===(N=null==t?void 0:t.content)||void 0===N?void 0:N[".tag"])&&a.shouldShowTranscriptUi(null==l?void 0:l.transcript,t.content.transcript_permission),Vt=i.react.exports.useCallback((e=>{var r,o,i;if("video"!==(null===(r=null==t?void 0:t.content)||void 0===r?void 0:r[".tag"]))return;const n="opted_in"===(null===(i=null===(o=null==t?void 0:t.content)||void 0===o?void 0:o.transcript_permission)||void 0===i?void 0:i[".tag"])?"true":"false";Ge(v.UserAction.ClosedCaptionsClick,{cc_opt_in:n}),A(a.setIsClosedCaptionShowing({fileViewerId:p,previewKey:u,showing:e})),Ge(v.UserAction.ClosedCaptionsClickSuccess,{cc_opt_in:n,new_cc_state_open:e?"true":"false"}),Ge(v.UserAction.ToggleClosedCaptions,{cc_opt_in:n,new_cc_state_open:e?"true":"false"})}),[Ge,null==t?void 0:t.content,A,p,u]),[$t,Pt]=i.react.exports.useState(!1),Mt=!h&&Tt&&!_&&"video"===(null===(O=null==t?void 0:t.content)||void 0===O?void 0:O[".tag"])&&a.shouldEnableClosedCaptionsButton(null===(D=null==t?void 0:t.content)||void 0===D?void 0:D.transcript_permission,null==l?void 0:l.transcript);i.react.exports.useEffect((()=>{$t||Mt&&(()=>{r.__awaiter(this,void 0,void 0,(function*(){const{registerClosedCaptioningButton:t}=yield new Promise((function(t,r){e(["./c_src_video_controls_video_controls_toolbar"],t,r)})).then((function(e){return e.closed_captioning_button_esnext}));t(),Pt(!0)}))})()}),[$t,Mt]),i.react.exports.useEffect((()=>{if(!$t||!F)return;if(!F.getChild("ControlBar"))return;const e=F.controlBar.addChild(n.vjsComponentKeys.closedCaptioning,{player:F,onClick:Vt});return()=>{F.controlBar.removeChild(e)}}),[$t,Vt,F]);const It=i.react.exports.useRef(null),jt=i.react.exports.useCallback((e=>{if(!(null==_e?void 0:_e.generated_captions_url))return;const t=e.addRemoteTextTrack({src:_e.generated_captions_url,kind:"subtitles",label:L.formatMessage({id:"c5OdNb",defaultMessage:"CC: Auto generated"}),default:!1,id:"captions-autogenerated"},!1);It.current=t}),[L,null==_e?void 0:_e.generated_captions_url]);return a.useUponTranscriptGeneration(null==l?void 0:l.transcript,(()=>{be&&It.current&&(null==_e?void 0:_e.generated_captions_url)&&F&&(null==F||F.removeRemoteTextTrack(It.current),jt(F))})),i.react.exports.useEffect((()=>{s.videojs.registerComponent(X,ee),s.videojs.registerComponent(Y,W),s.videojs.registerComponent(x,$),s.videojs.registerComponent(B,U),s.videojs.registerComponent(n.VJS_PORTAL,n.VjsPortalDestination),s.videojs.registerComponent(n.vjsComponentKeys.fastForward,ie),s.videojs.registerComponent(n.vjsComponentKeys.rewind,oe),s.videojs.registerComponent(ne,se)}),[]),i.react.exports.useEffect((()=>{z&&s.videojs.setFormatTime(f.customVideoJsFormatTime(z))}),[z]),i.react.exports.useEffect((()=>{_||s.videojs.getComponent(H)||s.videojs.registerComponent(H,Q)}),[_]),i.react.exports.useEffect((()=>{if(!s.videojs.getComponent("TruncatedBar")){const e=s.videojs.getComponent("Component"),t=s.videojs.extend(e,{createEl(t="div",r={},o={}){r=Object.assign(Object.assign({},r),{className:"truncated-bar"});const i=e.prototype.createEl.call(this,t,r,o);return i.innerText=L.formatMessage({id:"X/6mDh",defaultMessage:"Youâ€™re watching a preview. To watch the full video, download or add it to your Dropbox."}),i}});s.videojs.registerComponent("TruncatedBar",t)}if(F){const e=F.addChild("TruncatedBar");return()=>F.removeChild(e)}}),[L,F]),i.react.exports.useEffect((()=>{if(h&&F){const e=F.addChild(x,{waveformHeights:ye,hideControls:_});return()=>F.removeChild(e)}return()=>{}}),[F,Ae,ye]),i.react.exports.useEffect((()=>{if(!F)return;const e=[],t=null==F?void 0:F.getChild("ControlBar"),r=null==t?void 0:t.getChild("progressControl"),o=null==r?void 0:r.getChild("seekBar"),i=null==o?void 0:o.getChild("playProgressBar"),s=null==i?void 0:i.getChild("timeTooltip");if(null!=o&&!_){const t=o.addChild(n.VJS_PORTAL);e.push((()=>F.removeChild(t)))}if(s&&(null==i||i.removeChild(s)),null!=t&&!_){const r=t.addChild(X,{title:""}),o=t.addChild(n.VJS_PORTAL,{elementAttrs:{class:"onboarding-indicator"}}),i=t.addChild("volumePanel");e.push((()=>{t.removeChild(r),t.removeChild(o),t.removeChild(i)}));const s=null==i?void 0:i.getChild("muteToggle");if(null!=s){const t=s.addChild(Y,{iconId:n.MediaIcons.Volume}),r=s.addChild(Y,{iconId:n.MediaIcons.VolumeMuted});e.push((()=>{s.removeChild(t),s.removeChild(r)}))}if(!a.is_mobile_or_tablet()){const r=t.addChild(B,{intl:L,initialSrc:{src:Ae,type:pe},srcMap:Be,onSelectQuality:vt,showAudioTrackSubmenuInEmbed:V});e.push((()=>t.removeChild(r)))}}if(!h&&null!=t&&!_){const r=t.addChild("fullscreenToggle"),o=r.addChild(Y,{iconId:n.MediaIcons.FullScreen}),i=r.addChild(Y,{iconId:n.MediaIcons.FullScreenExit});e.push((()=>{r.removeChild(o),r.removeChild(i),t.removeChild(r)}))}if(!a.is_mobile_or_tablet()&&!h&&null!=o&&!_){const t=o.getChild("mouseTimeDisplay");null!=t&&(o.removeChild(t),e.push((()=>{o.isDisposed()||o.addChild(t)})));const r=o.addChild(H,{componentClass:H,src:Ue,onScrubberThumbnailsLoaded:y.once(_t)});e.push((()=>{o.removeChild(r)}))}if(null!=t&&!_){const r=t.getChild("playToggle");if(null!=r){const t=r.addChild(Y,{iconId:n.MediaIcons.Play}),o=r.addChild(Y,{iconId:n.MediaIcons.Pause});e.push((()=>{r.removeChild(t),r.removeChild(o)}))}}return()=>{for(const t of e)t()}}),[Ae,F]),{player:F,audioVideoRef:G,duration:z,videoTruncated:ke||!1,src:Ae,quality:xe.current,onSelectQuality:vt,vttThumbnailsUrl:Ue}}const he=i.react.exports.memo((e=>{const{pluginProps:t,activeOverlayPlugin:r}=e;if(null!=r&&null!=t){const{layerUI:{LayerWithEventBubbling:e}}=r,o=Object.assign(Object.assign({},t),{layer:{}});if(null!=e)return i.react.exports.createElement(e,Object.assign({},o))}return null}));he.displayName="AudioVideoLayers",he.displayName="AudioVideoLayers";o.injectInternalStyle("typescript/libraries/file-viewer/src/preview_audio_video/slow-connection-banner.module.out.css",(e=>":root{--abovePreviewZIndex:10}._slowConnectionBanner_atica_5{background-color:var(--color__faint__background);position:absolute;width:100%;z-index:var(--abovePreviewZIndex)}"));const _e=i.React$1.memo((({message:e,onClose:t})=>{const r=o.useIntl();return i.React$1.createElement(o.Banner,{type:"warning",onRequestClose:t,withCloseButton:r.formatMessage({id:"dNehK+",defaultMessage:"Close"})},i.React$1.createElement(o.Banner.Message,null,e))}));_e.displayName="PreviewBanner";const ve=i.React$1.memo((({player:e,isShown:t,setIsShown:r,quality:n,logVideoAction:s})=>{const l=o.useIntl(),c=l.formatMessage({id:"TBFntk",defaultMessage:"Your internet connection is slow."}),d=l.formatMessage({id:"Sos/rL",defaultMessage:"Your internet connection is slow. Your video might play better if you choose a lower quality in settings."}),[u,p]=i.React$1.useState(!1),[m,h]=i.React$1.useState(0),_=a.useStabilizedCallback((()=>{r(!1),h(3)}));return i.react.exports.useEffect((()=>{if(e){const t=()=>{p(!0)},r=()=>{p(!1)};return e.on("waiting",t),e.on("playing",r),e.on("canplay",r),()=>{e.off("waiting",t),e.off("playing",r),e.off("canplay",r)}}}),[e]),i.react.exports.useEffect((()=>{if(u){const e=window.setTimeout((()=>{if(u&&m<2){h(m+1),r(!0);const e=n.isUserSelected?"manual":"auto";s(g.VideoPreviewEvent.SlowConnectionBannerShown,{video_quality:e})}}),5e3);return()=>{window.clearTimeout(e)}}r(!1)}),[u]),t?i.React$1.createElement("div",{className:"_slowConnectionBanner_atica_5"},i.React$1.createElement(_e,{message:!n.isUserSelected||"auto"===n.qualityLabel||n.isLowestAvailable?c:d,onClose:_})):null}));ve.displayName="SlowConnectionBanner";const ge=(e,t)=>{const r=90===t.rotate||270===t.rotate;return{height:r?e.width:e.height,width:r?e.height:e.width}};o.injectInternalStyle("typescript/libraries/file-viewer/src/preview_audio_video/video_editing/video_editing.module.out.css",(e=>":root{--right__rail__width:57px;--right__rail__width__opened:329px;--preview__margin:2px;--trim__track__border__width:4px;--preview__track__height:60px;--crop__border:8px solid var(--color__standard__background);--crop__handle__offset:-14px;--crop__corner__offset:-6px}._trimming-ui_188kh_12{background-color:var(--color__inverse__standard__background);max-width:2500px;min-width:600px;padding:16px;transition-delay:var(--duration__333);width:100%}._trim-control-bar_188kh_22{align-items:center;display:flex;height:72px;margin-bottom:16px;padding:4px;position:relative}._trim-button-holder_188kh_31{display:flex}._trim-button-holder_188kh_31>button:nth-child(1n+2){margin-left:8px}._trim-previews_188kh_39{align-items:center;display:flex;height:var(--preview__track__height);margin:0 2px;overflow:hidden;position:relative;width:100%}._trim-control-track-wrapper_188kh_49{height:100%;left:0;position:absolute;top:0;width:100%}._trim-control-track_188kh_49{border:4px solid var(--color__inverse__attention__border);top:0}._trim-control-track_188kh_49,._trim-control-track-overlay_188kh_65{box-sizing:border-box;height:100%;position:absolute}._trim-control-track-overlay_188kh_65{background-color:var(--color__utility__overlay);border:6px solid var(--color__inverse__standard__background);pointer-events:none}._trim-control-track-overlay_188kh_65._left-track-overlay_188kh_74{border-right-width:0}._trim-control-track-overlay_188kh_65._right-track-overlay_188kh_78{border-left-width:0}._trim-drag-box_188kh_82{height:100%;position:absolute;width:1px}._trim-drag-box_188kh_82._left-box_188kh_88{left:0}._trim-drag-box_188kh_82._right-box_188kh_92{right:0}._trim-handle-wrapper_188kh_96{display:flex;height:100%}._trim-handle_188kh_96{cursor:ew-resize;height:25px;margin:auto;position:relative;width:20px}._trim-handle_188kh_96>svg>rect{fill:var(--color__inverse__attention__border)}._trim-handle_188kh_96>svg>path{fill:var(--color__standard__background)}._trim-handle_188kh_96:focus-visible{outline:auto}._trim-handle_188kh_96._left-handle_188kh_121{left:-14px}._trim-handle_188kh_96._right-handle_188kh_125{right:9px}._trim-timestamp_188kh_129{align-items:center;border-radius:8px;display:flex;font-family:var(--type__body__small--fontfamily);font-size:var(--type__body__small--fontsize);font-weight:var(--type__body__small--fontweight);height:16px;justify-content:center;position:absolute;right:8px;top:12px}._trim-time-marker_188kh_143{height:calc(var(--preview__track__height) + 4px);left:0;position:absolute;top:4px;width:2px}._trim-current-time-marker_188kh_151{background-color:var(--color__standard__background)}._trim-hover-time-marker_188kh_155{background-color:var(--color__inverse__faint__text);cursor:pointer}._snackBar_188kh_161{bottom:10px;display:flex;justify-content:center;min-width:600px;pointer-events:none;position:fixed;z-index:500}._snackBar_188kh_161 *{pointer-events:auto}._snackBar_188kh_161>*{flex-grow:1}._crop-box-container_188kh_179{pointer-events:all}._crop-box_188kh_179,._crop-box-container_188kh_179{height:100%;left:0;position:absolute;top:0;width:100%}._crop-box_188kh_179{outline:4px solid var(--color__standard__background);pointer-events:none}._crop-line_188kh_199{align-items:center;display:flex;justify-content:center;pointer-events:auto;position:absolute}._crop-line-left_188kh_207,._crop-line-right_188kh_208{cursor:ew-resize;height:calc(100% - 48px);margin-bottom:24px;margin-top:24px;top:0;width:24px}._crop-handle_188kh_217:focus-visible{outline:auto}._crop-line-left_188kh_207{left:var(--crop__handle__offset)}._crop-line-left_188kh_207 ._crop-handle_188kh_217{border-left:var(--crop__border);height:28px}._crop-line-right_188kh_208 ._crop-handle_188kh_217{border-right:var(--crop__border);height:28px}._crop-line-top_188kh_235 ._crop-handle_188kh_217{border-top:var(--crop__border);width:36px}._crop-line-bottom_188kh_240 ._crop-handle_188kh_217{border-bottom:var(--crop__border);width:36px}._crop-line-right_188kh_208{right:var(--crop__handle__offset)}._crop-line-bottom_188kh_240,._crop-line-top_188kh_235{cursor:ns-resize;height:24px;left:0;margin-left:16px;margin-right:16px;width:calc(100% - 32px)}._crop-line-top_188kh_235{top:var(--crop__handle__offset)}._crop-line-bottom_188kh_240{bottom:var(--crop__handle__offset)}._crop-corner_188kh_267{height:24px;pointer-events:auto;position:absolute;width:28px}._crop-corner_188kh_267 ._crop-handle_188kh_217{height:18px;position:absolute;width:22px}._crop-corner-bottom-right_188kh_283,._crop-corner-top-left_188kh_282{cursor:nwse-resize}._crop-corner-bottom-left_188kh_288,._crop-corner-top-right_188kh_287{cursor:nesw-resize}._crop-corner-top-left_188kh_282{left:var(--crop__corner__offset);top:var(--crop__corner__offset)}._crop-corner-bottom-right_188kh_283{bottom:var(--crop__corner__offset);right:var(--crop__corner__offset)}._crop-corner-top-right_188kh_287{right:var(--crop__corner__offset);top:var(--crop__corner__offset)}._crop-corner-bottom-left_188kh_288{bottom:var(--crop__corner__offset);left:var(--crop__corner__offset)}._crop-corner-top-left_188kh_282 ._crop-handle_188kh_217{border-left:var(--crop__border);border-top:var(--crop__border);left:0;top:0}._crop-corner-top-right_188kh_287 ._crop-handle_188kh_217{border-right:var(--crop__border);border-top:var(--crop__border);right:0;top:0}._crop-corner-bottom-left_188kh_288 ._crop-handle_188kh_217{border-bottom:var(--crop__border);border-left:var(--crop__border);bottom:0;left:0}._crop-corner-bottom-right_188kh_283 ._crop-handle_188kh_217{border-bottom:var(--crop__border);border-right:var(--crop__border);bottom:0;right:0}._crop-center-container_188kh_339{height:100%;padding:10px;position:absolute;width:100%}._corp-center-container_188kh_347:focus{border:2px solid var(--color__utility__focusring);border-radius:2px}._crop-center_188kh_339{cursor:pointer;height:100%;pointer-events:auto;width:100%}"));const fe="_crop-line_188kh_199",be="_crop-corner_188kh_267",ye=i.React$1.createContext(null),ke=k.getEmptyDragImage(),we=e=>{const{onEditError:t}=i.React$1.useContext(ye);return i.React$1.createElement(w.ErrorBoundary,{onError:t,fallback:null},i.React$1.createElement(Ee,Object.assign({},e)))};we.displayName="CropBox";const Ee=({actualVideoDimensions:e,unrotatedScreenDimensions:t,rotateAndFlip:r,lastCursorRef:a,player:n})=>{const{overrideState:s,updateState:l}=i.react.exports.useContext(ye),c=i.react.exports.useRef(null),d=i.react.exports.useRef(null),u=(p=t,{width:Math.floor(p.width),height:Math.floor(p.height)});var p;const m=i.react.exports.useMemo((()=>new Me(e,u,r)),[]);i.react.exports.useMemo((()=>{var e;m.updateScreenDimensions(u,r),null===(e=d.current)||void 0===e||e.setPlacement(m.getScreenRect())}),[u.width,u.height,r.rotate,r.flip]);const h=ge(u,r),_=i.react.exports.useMemo((()=>Re(n,h,m,l,c,d)),[h.width,h.height]);i.react.exports.useEffect((()=>{var e;s&&(m.updateCropState(s.crop),null===(e=d.current)||void 0===e||e.setPlacement(m.getScreenRect()))}),[s]);const v=Object.assign(Object.assign({},_),{lastCursorRef:a});return i.React$1.createElement("div",{className:"_crop-box-container_188kh_179",ref:c},i.React$1.createElement(Ce,{controlRef:d,screenDimensions:h},i.React$1.createElement(Se,Object.assign({className:o.classnames(be,"_crop-corner-top-left_188kh_282")},v,{edge:"top-left"})),i.React$1.createElement(Se,Object.assign({className:o.classnames(fe,"_crop-line-top_188kh_235")},v,{edge:"top"})),i.React$1.createElement(Se,Object.assign({className:o.classnames(be,"_crop-corner-top-right_188kh_287")},v,{edge:"top-right"})),i.React$1.createElement(Se,Object.assign({className:o.classnames(fe,"_crop-line-left_188kh_207")},v,{edge:"left"})),i.React$1.createElement(Se,Object.assign({className:o.classnames(fe,"_crop-line-right_188kh_208")},v,{edge:"right"})),i.React$1.createElement(Se,Object.assign({className:o.classnames(be,"_crop-corner-bottom-left_188kh_288")},v,{edge:"bottom-left"})),i.React$1.createElement(Se,Object.assign({className:o.classnames(fe,"_crop-line-bottom_188kh_240")},v,{edge:"bottom"})),i.React$1.createElement(Se,Object.assign({className:o.classnames(be,"_crop-corner-bottom-right_188kh_283")},v,{edge:"bottom-right"})),i.React$1.createElement("div",{className:"_crop-center-container_188kh_339"},i.React$1.createElement(Se,Object.assign({className:o.classnames("_crop-center_188kh_339")},v,{edge:"center"})))))};Ee.displayName="_CropBox";const Se=({className:e,onDrag:t,onDragEnd:r,onDragStart:a,onKeyboardMove:n,edge:s,lastCursorRef:l})=>{i.react.exports.useEffect((()=>{const e=c.current;if(e&&t&&r){const o=e=>{var r,o;const i=e.clientX||(null===(r=l.current)||void 0===r?void 0:r.clientX)||0,a=e.clientY||(null===(o=l.current)||void 0===o?void 0:o.clientY)||0;0!==i&&0!==a&&t(i,a,s)},i=e=>{a(e.clientX,e.clientY),e.stopPropagation(),e&&e.dataTransfer&&(e.dataTransfer.setDragImage(ke,0,0),e.dataTransfer.effectAllowed="move")},c=e=>{const t=e.shiftKey?1:10,r="ArrowLeft"===e.key?-1:"ArrowRight"===e.key?1:0,o="ArrowUp"===e.key?-1:"ArrowDown"===e.key?1:0;0===r&&0===o||n(r*t,o*t,s)};return e.addEventListener("drag",o),e.addEventListener("dragstart",i),e.addEventListener("dragend",r),e.addEventListener("keydown",c),()=>{e.removeEventListener("drag",o),e.removeEventListener("drag",i),e.removeEventListener("dragend",r),e.removeEventListener("keydown",c)}}}),[t,r,a,n,s]);const c=i.React$1.useRef(null),d=(e=>{const t=o.useIntl();switch(e){case"top":return t.formatMessage({id:"NV8Xtw",defaultMessage:"Top Crop Slider. Use arrow keys to adjust"});case"bottom":return t.formatMessage({id:"QLhtqE",defaultMessage:"Bottom Crop Slider. Use arrow keys to adjust"});case"left":return t.formatMessage({id:"5jGDUN",defaultMessage:"Left Crop Slider. Use arrow keys to adjust"});case"right":return t.formatMessage({id:"r2i2x0",defaultMessage:"Right Crop Slider. Use arrow keys to adjust"});case"top-left":return t.formatMessage({id:"a7lZtV",defaultMessage:"Top Left Crop Slider. Use arrow keys to adjust"});case"top-right":return t.formatMessage({id:"G4Pxdu",defaultMessage:"Top Right Crop Slider. Use arrow keys to adjust"});case"bottom-left":return t.formatMessage({id:"IVwISB",defaultMessage:"Bottom Left Crop Slider. Use arrow keys to adjust"});case"bottom-right":return t.formatMessage({id:"+Pql5f",defaultMessage:"Bottom Right Crop Slider. Use arrow keys to adjust"});default:return""}})(s);return i.React$1.createElement("div",{className:e,ref:c,draggable:!0},i.React$1.createElement("div",{className:"_crop-handle_188kh_217","aria-label":d,tabIndex:0}))};Se.displayName="DragHandle";const Re=(e,t,r,o,i,a)=>{let n,s,l,c,d,u=r.getScreenRect();const p=(t,o)=>{var a;s=t,l=o,u=r.getScreenRect(),c=u.top,d=u.left,n=null===(a=i.current)||void 0===a?void 0:a.getBoundingClientRect(),e.pause()},m=()=>{var e;const t=r.getCropState();r.updateScreenRect(u),null===(e=a.current)||void 0===e||e.setPlacement(u);const i=r.getCropState();(null==t?void 0:t.height)==(null==i?void 0:i.height)&&(null==t?void 0:t.width)==(null==i?void 0:i.width)&&(null==t?void 0:t.left)==(null==i?void 0:i.left)&&(null==t?void 0:t.top)==(null==i?void 0:i.top)||o((e=>Object.assign(Object.assign({},e),{crop:i,counts:Object.assign(Object.assign({},e.counts),{crop:(e.counts.crop||0)+1})})))},h=e=>{const t=u.left+u.width,r=Math.floor(k.clamp(e,0,t-40)),o=r-u.left;u.left=r,u.width=u.width-o},_=e=>{const r=Math.floor(k.clamp(e,u.left+40,t.width));u.width=r-u.left},v=e=>{const t=u.top+u.height,r=Math.floor(k.clamp(e,0,t-40)),o=r-u.top;u.top=r,u.height=u.height-o},g=e=>{const r=Math.floor(k.clamp(e,u.top+40,t.height));u.height=r-u.top},f=(e,t)=>{u.left=k.clamp(e,0,n.width-u.width),u.top=k.clamp(t,0,n.height-u.height)};return{onDrag:(e,t,r)=>{var o;const i=e-n.left,p=t-n.top;switch(r){case"left":h(i);break;case"right":_(i);break;case"top":v(p);break;case"bottom":g(p);break;case"top-left":v(p),h(i);break;case"top-right":v(p),_(i);break;case"bottom-left":g(p),h(i);break;case"bottom-right":g(p),_(i);break;case"center":if(s&&l){f(d+(e-s),c+(t-l))}}null===(o=a.current)||void 0===o||o.setPlacement(u)},onDragEnd:m,onDragStart:p,onKeyboardMove:(e,t,r)=>{p();const{left:o,top:i,width:a,height:n}=u,s=o+a,l=i+n;switch(r){case"left":h(o+e);break;case"right":_(s+e);break;case"top":v(i+t);break;case"bottom":g(l+t);break;case"top-left":h(o+e),v(i+t);break;case"top-right":_(s+e),v(i+t);break;case"bottom-left":g(l+t),h(o+e);break;case"bottom-right":g(l+t),_(s+e);break;case"center":h(o+e),_(s+e),v(i+t),g(l+t)}m()}}},Ce=({controlRef:e,children:t,screenDimensions:r})=>{const o=i.react.exports.useRef(null),a=i.react.exports.useRef(null);return i.react.exports.useImperativeHandle(e,(()=>({setPlacement:e=>{var t;k.updatePositionStyle(o,e),null===(t=a.current)||void 0===t||t.setPlacement(e)}}))),i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(xe,{controlRef:a,screenDimensions:r}),i.React$1.createElement("div",{className:"_crop-box_188kh_179",ref:o},t))};Ce.displayName="CropBoxWithOverlay";const xe=i.React$1.memo((({controlRef:e,screenDimensions:t})=>{const r=i.react.exports.useRef(null);return i.react.exports.useImperativeHandle(e,(()=>({setPlacement:e=>{const t=r.current.style;t.x=`${e.left}px`,t.y=`${e.top}px`,t.width=`${e.width}px`,t.height=`${e.height}px`}}))),i.React$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height},i.React$1.createElement("mask",{id:"crop-cutout"},i.React$1.createElement("rect",{x:"0",y:"0",width:t.width,height:t.height,fill:"white"}),i.React$1.createElement("rect",{fill:"black",ref:r})),i.React$1.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"black",opacity:"0.4",mask:"url(#crop-cutout)"}))}));xe.displayName="CropOverlay";const Te=(e,t,r,o)=>Ve((({left:e,top:t,right:r,bottom:o},i,a)=>{const n=(360+a.rotate-i.rotate)%360,s=(0===n||180===n)&&i.flip!==a.flip,l=s?r:e,c=s?e:r,d=(90===n||270===n)&&i.flip!==a.flip,u=d?t:o,p=d?o:t;if(0===n)return{left:l,top:p,right:c,bottom:u};if(90===n)return{left:u,top:l,right:p,bottom:c};if(180===n)return{left:c,top:u,right:l,bottom:p};if(270===n)return{left:p,top:c,right:u,bottom:l};throw new Error("diff must be a multiple of 90 degress")})(e,t,r),o),Ve=(e,t)=>{const{left:r,top:o,right:i,bottom:a}=e;return{left:r*t,top:o*t,right:i*t,bottom:a*t}},$e=(e,t)=>{const{left:r,top:o,right:i,bottom:a}=e,{width:n,height:s}=t;return{left:Math.round(r),top:Math.round(o),width:k.clamp(Math.round(n-r-i),0,n),height:k.clamp(Math.round(s-o-a),0,s)}},Pe=(e,t)=>{const{left:r,top:o,width:i,height:a}=e,{width:n,height:s}=t;return{left:r,top:o,right:Math.max(0,n-r-i),bottom:Math.max(0,s-o-a)}};class Me{constructor(e,t,r){this.updateScreenDimensions=(e,t)=>{this.scale=e.height/this.actualVideoDimensions.height,this.rotatedScreenDimensions=ge(e,t),this.rotateAndFlip=t,this.updateScreenRectFromCropState()},this.updateScreenRect=e=>{this.screenRect=Ve(Pe(e,this.rotatedScreenDimensions),1),this.updateCropStateFromScreenRect()},this.updateCropState=e=>{const{width:t,height:r}=this.actualVideoDimensions,o=e||{left:0,top:0,width:t,height:r};this.cropRect=Pe(o,this.actualVideoDimensions),this.updateScreenRectFromCropState()},this.getCropState=()=>{const{left:e,top:t,bottom:r,right:o}=this.cropRect;if(0!=e||0!=t||0!=r||0!=o)return $e(this.cropRect,this.actualVideoDimensions)},this.getScreenRect=()=>$e(this.screenRect,this.rotatedScreenDimensions),this.actualVideoDimensions=e,this.scale=t.height/e.height,this.rotatedScreenDimensions=ge(t,r),this.rotateAndFlip=r,this.screenRect={left:0,top:0,right:0,bottom:0},this.cropRect={left:0,top:0,right:0,bottom:0}}updateScreenRectFromCropState(){this.screenRect=Te(this.cropRect,{rotate:0,flip:!1},this.rotateAndFlip,this.scale)}updateCropStateFromScreenRect(){this.cropRect=Te(this.screenRect,this.rotateAndFlip,{rotate:0,flip:!1},1/this.scale)}}const Ie=e=>{const[t,r]=i.react.exports.useState(!e.paused()),o=i.React$1.useCallback((()=>{r(!e.paused())}),[e]),a=i.React$1.useCallback((()=>{t?e.pause():e.play()}),[e,t]);return i.React$1.useEffect((()=>d.setupVideoJsEvents(e,{play:o,pause:o})),[e]),{isVideoPlaying:t,toggleVideoPlayback:a}};o.injectInternalStyle("typescript/libraries/file-viewer/src/preview_audio_video/big_play_button_overlay.module.out.css",(e=>"._bigPlayButtonOverlay_oefuc_1{align-items:center;display:flex;height:inherit;justify-content:center;opacity:0;pointer-events:none;position:absolute;transition:opacity var(--duration__125) var(--easing__linear);width:inherit}div:hover>._bigPlayButtonOverlay_oefuc_1:not(._hidden_oefuc_16){opacity:1;transition:opacity var(--duration__125) var(--easing__linear)}._bigPlayButtonOverlay_oefuc_1._hidden_oefuc_16{opacity:0}._bigPlayButtonOverlay_oefuc_1 svg{color:var(--color__inverse__faint__text);cursor:pointer;height:128px;width:128px}"));const je="_bigPlayButtonOverlay_oefuc_1",Ne="_hidden_oefuc_16",Oe=({player:e})=>{const t=o.useIntl(),[r,a]=i.React$1.useState(!1),{isVideoPlaying:n}=Ie(e),s=i.React$1.useCallback((()=>{a(!0)}),[]),l=i.React$1.useCallback((()=>{a(!1)}),[]);return i.React$1.useEffect((()=>d.setupVideoJsEvents(e,{waiting:s,playing:l,seeking:s,seeked:l})),[l,s,e]),i.React$1.createElement("div",{className:o.classnames(je,{[Ne]:r||n})},i.React$1.createElement(o.UIIcon,{"aria-label":t.formatMessage({id:"0t/POJ",defaultMessage:"Play video"}),role:"button",src:E.PlayCircleFill}))};var De;Oe.displayName="BigPlayButtonOverlay",t.VideoEditErrorType=void 0,(De=t.VideoEditErrorType||(t.VideoEditErrorType={})).OVER_QUOTA="over_quota_error",De.ON_GOING_EDITING_JOB="on_going_editing_job";const Le=e=>{const{isModalOpen:r,onClose:a,errorType:n}=e,s=o.useIntl(),l=((e,r)=>{switch(r){case t.VideoEditErrorType.OVER_QUOTA:return e.formatMessage({id:"6moWwa",defaultMessage:"Your Dropbox is full. To save changes to this video, free up some space by removing files, or upgrade to add more storage to your Dropbox."});case t.VideoEditErrorType.ON_GOING_EDITING_JOB:return e.formatMessage({id:"43xhNY",defaultMessage:"Video cannot be edited until the last edit operation is completed."});default:return e.formatMessage({id:"Zzj+kf",defaultMessage:"Something went wrong and we werenâ€™t able to save the changes to this video."})}})(s,n),c=((e,r)=>r===t.VideoEditErrorType.ON_GOING_EDITING_JOB?e.formatMessage({id:"71Vu2Q",defaultMessage:"Video canâ€™t be edited"}):e.formatMessage({id:"CaZjc7",defaultMessage:"Canâ€™t save the changes"}))(s,n);return r?i.React$1.createElement(o.Modal,{open:r,isCentered:!0,shouldCloseOnOverlayClick:!1},i.React$1.createElement(o.Modal.Header,{hasBottomSpacing:"title-standard"},i.React$1.createElement(o.Modal.Title,null,c)),i.React$1.createElement(o.Modal.Body,{hasVerticalSpacing:!1},i.React$1.createElement(o.Text,{variant:"paragraph"},l)),i.React$1.createElement(o.Modal.Footer,null,i.React$1.createElement(o.Button,{variant:"primary",onClick:a},s.formatMessage({id:"cTSpdH",defaultMessage:"OK"})))):null};Le.displayName="EditErrorModal";const Ae=e=>{const{filePath:t,originalFileName:r,progress:n,onClose:s,fileName:l,errorType:c}=e,d=o.useIntl(),[u,p]=i.React$1.useState(!1),m=a.getParentFolderFromPath(t),h="saved-copy"===n||"saved-original"===n;i.React$1.useMemo((()=>{"save-error"===n&&p(!0)}),[n]);const{closeMessage:_,progressMessage:v,snackbarMessage:g}=i.React$1.useMemo((()=>{let e=0;const t={b:t=>i.React$1.createElement(o.Text,{isBold:!0,inverse:!0,key:e++},t)},a="saved-original"===n?d.formatMessage({id:"Eg7HDm",defaultMessage:"Close"}):d.formatMessage({id:"vcNtoG",defaultMessage:"Hide"});let s;switch(n){case"saving-original":s=d.formatMessage({id:"IiApYH",defaultMessage:"Saving changes to <b>{fileName}</b>..."},Object.assign({fileName:l},t));break;case"saving-copy":s=d.formatMessage({id:"yZx7pP",defaultMessage:"Saving a copy of <b>{fileName}</b>..."},Object.assign({fileName:r},t));break;case"saved-original":s=d.formatMessage({id:"mY6DLD",defaultMessage:"Saved changes to <b>{fileName}</b>"},Object.assign({fileName:l},t));break;case"saved-copy":s=m&&""!==m&&"/"!==m?d.formatMessage({id:"IkJzmj",defaultMessage:"Saved <b>{fileName}</b> to <b>{folderName}</b>"},Object.assign({fileName:l,folderName:m},t)):d.formatMessage({id:"eSwxni",defaultMessage:"Saved <b>{fileName}</b> to your Dropbox"},Object.assign({fileName:l,folderName:m},t))}return{closeMessage:a,snackbarMessage:s,progressMessage:d.formatMessage({id:"qCkn8L",defaultMessage:"Save in progress"})}}),[n,l,t]),f=i.React$1.useCallback((()=>{p(!1),s()}),[]);return i.React$1.createElement("div",{className:"_snackBar_188kh_161"},i.React$1.createElement(Le,{isModalOpen:u,onClose:f,errorType:c}),!u&&g&&i.React$1.createElement(o.Snackbar$1,{open:!0,timeout:0},h&&i.React$1.createElement(o.UIIcon,{src:o.CheckmarkLine}),i.React$1.createElement(o.Snackbar$1.Message,null,g),i.React$1.createElement(o.Snackbar$1.Actions,null,i.React$1.createElement(o.Button,{variant:"transparent",inverse:!0,onClick:s},_)),!h&&i.React$1.createElement(o.Snackbar$1.ProgressBar,null,i.React$1.createElement(o.ProgressBar,{"aria-valuetext":v,in:!0,inverse:!0,isIndeterminate:!0}))))};Ae.displayName="EditProgressSnackbar";const Be=({onClose:e,message:t})=>{const r=o.useIntl();return i.React$1.createElement("div",{className:a.snackbar},i.React$1.createElement(o.Snackbar$1,{open:!0,timeout:0},i.React$1.createElement(o.UIIcon,{src:o.WarningLine}),i.React$1.createElement(o.Snackbar$1.Message,null,t),i.React$1.createElement(o.Snackbar$1.Actions,null,i.React$1.createElement(o.Button,{variant:"transparent",inverse:!0,onClick:e},r.formatMessage({id:"fBCQm0",defaultMessage:"Hide"})))))};Be.displayName="ErrorSnackbar";const Fe=({liveFeedback:e,duration:t})=>{const r=o.useIntl(),a=i.React$1.useMemo((()=>{var o,i;if(null==e||null==t)return"";switch(e.type){case"trim":return r.formatMessage({id:"owWBS3",defaultMessage:"Trim range updated to {startTimeStamp} to {endTimeStamp}"},{startTimeStamp:f.formatTime(e.videoEditState.trim.start,t,f.showTimestampDecimalPlaces(t)),endTimeStamp:f.formatTime(e.videoEditState.trim.end,t,f.showTimestampDecimalPlaces(t))});case"rotate":return r.formatMessage({id:"rWfLpE",defaultMessage:"Video rotated to {deg} degrees"},{deg:e.videoEditState.rotate});case"crop":return r.formatMessage({id:"szsmS+",defaultMessage:"Video crop box updated with width: {width}, height: {height}"},{width:null===(o=e.videoEditState.crop)||void 0===o?void 0:o.width,height:null===(i=e.videoEditState.crop)||void 0===i?void 0:i.height});case"save-in-progress":return r.formatMessage({id:"Bp+pM2",defaultMessage:"Saving in progress. Page will be redirected when saved successfully"});case"cancel":return r.formatMessage({id:"kqdWzd",defaultMessage:"Video Editing has been canceled"});default:return""}}),[e,t]);return i.React$1.createElement("div",{style:{opacity:0,position:"absolute"},"aria-live":"polite"},a)};Fe.displayName="VideoEditingLiveFeedback";const Ue=({isEditingVideo:e,duration:r,fileViewerId:n,timeRange:s,children:l})=>{const c=o.useDispatch(),d=o.useIntl(),u=function(e){const[t,r]=i.React$1.useState(e),[o,a]=i.React$1.useState((()=>({undoStates:[],currentState:e(),redoStates:[]}))),n=i.React$1.useCallback((()=>{const{undoStates:e,redoStates:t,currentState:i}=o;if(0===e.length)return;const n=e[e.length-1];a({undoStates:e.slice(0,-1),redoStates:[i,...t],currentState:n}),r(n)}),[o]),s=i.React$1.useCallback((()=>{const{undoStates:e,redoStates:t,currentState:i}=o;if(0===t.length)return;const n=t[0];a({undoStates:[...e,i],redoStates:t.slice(1),currentState:n}),r(n)}),[o]),l=i.React$1.useCallback((e=>{a((t=>{const{currentState:r,undoStates:o}=t;return{undoStates:[...o,r],redoStates:[],currentState:e(r)}})),r(void 0)}),[]),c=i.React$1.useCallback((e=>{a({undoStates:[],redoStates:[],currentState:e}),r(e)}),[]);return{state:o.currentState,overrideState:t,hasRedo:o.redoStates.length>0,hasUndo:o.undoStates.length>0,updateState:l,undo:n,redo:s,reset:c}}((()=>k.createInitialVideoEditState(r,s))),{liveFeedback:p,updateLiveFeedback:m,resetLiveFeedback:h}=(e=>{const[t,r]=i.React$1.useState(void 0),o=i.React$1.useRef(void 0);return i.React$1.useEffect((()=>{if(null!=o.current){const i=o.current;if("save-in-progress"===(null==t?void 0:t.type)||"cancel"===(null==t?void 0:t.type))return;k.checkHasTrimRangeChange(i.trim,e.trim)?r({type:"trim",videoEditState:e}):i.rotate!==e.rotate?r({type:"rotate",videoEditState:e}):e.crop&&(null==i.crop||k.checkHasCropCoordChange(i.crop,e.crop))&&r({type:"crop",videoEditState:e})}o.current=e}),[e]),{liveFeedback:t,updateLiveFeedback:r,resetLiveFeedback:()=>r(void 0)}})(u.state),[_,g]=i.React$1.useState(null),[f,b]=i.React$1.useState(!1),y=i.React$1.useCallback((()=>{b(!0)}),[]),[w,E]=i.React$1.useState(!1),R=i.React$1.useCallback((()=>{c(a.cancelEditingVideo({fileViewerId:n,sourceContext:v.UserActionContext.VideoEditing})),E(!0)}),[]),C=i.React$1.useCallback((e=>{g(e),b(!1)}),[]);S.useOverrideToolbar(n,e||_&&!f||w?"hidden":void 0);const x=i.React$1.useMemo((()=>Object.assign(Object.assign({},u),{updateEditProgress:C,onEditError:R,updateLiveFeedback:m,resetLiveFeedback:h,isVideoEditing:!!_&&("saving-copy"===_.progress||"saving-original"===_.progress||"save-error"===_.progress&&_.errorType===t.VideoEditErrorType.ON_GOING_EDITING_JOB)})),[u,R,_]);return i.React$1.createElement(ye.Provider,{value:x},l,_&&!f&&i.React$1.createElement(Ae,Object.assign({},_,{onClose:y})),w&&i.React$1.createElement(Be,{message:d.formatMessage({id:"q7SgCs",defaultMessage:"An error occurred."}),onClose:()=>E(!1)}),i.React$1.createElement(Fe,{liveFeedback:p,duration:r}))};Ue.displayName="VideoEditingContextProvider";const qe=e=>{if(e){const t=e.getAllQueryStringParameters(),{edit:o}=t,i=r.__rest(t,["edit"]);e.replaceState(i)}},He=a.is_mobile_or_tablet(),ze=i.React$1.lazy((()=>r.__awaiter(void 0,void 0,void 0,(function*(){const{VideoEditUi:t}=yield new Promise((function(t,r){e(["./c_preview_audio_video_video_editing_video_edit_ui"],t,r)}));return{default:t}})))),Je=e=>i.React$1.createElement(i.React$1.Suspense,{fallback:i.React$1.createElement("div",{className:n.editUiWrapper})},i.React$1.createElement(ze,Object.assign({},e)));Je.displayName="VideoEditUi";const Qe=t=>{var r;const{previewMetadata:s,rivieraData:c,fileViewerId:u,activeCommentPlugin:p,activeOverlayEditPlugin:m,isAudio:h,onInteractive:_,fileViewerUiData:v,onRenderSucceeded:g,previewKey:f,config:y,fileInfo:k,pluginProps:w,header:E,fileSaver:S,height:C,fileConfig:x,responsiveSize:T}=t,V=R.isRedesign2023Enabled(y),$=a.useFileViewerSelector(a.getIsEditingVideo,u),P=y.mobile_web,M=y.preview_content_only||a.is_mobile_or_tablet()||a.noToolbarShown(T,y),I=!(M||P||$||V),j=M&&!V,N=n.validateAudioTrackSubmenuInEmbed(y.previews_exp_multi_audio_track),O=y.fvsdk_slow_connection_banner,[D,L]=i.react.exports.useState(!1),A=null===(r=t.fileMetadata)||void 0===r?void 0:r.timeRange,B=i.react.exports.useRef(),{player:F,videoTruncated:U,audioVideoRef:q,src:H,quality:z,onSelectQuality:J,vttThumbnailsUrl:Q,duration:K}=me({previewMetadata:s,rivieraData:c,previewKey:f,fileViewerId:u,fileViewerUiData:v,isAudio:h,hideControls:!j,initialVideoBandwidth:y.initial_video_bandwidth,videoBufferLength:y.previews_exp_video_buffer_length,bufferMoreBeforePlay:y.previews_exp_video_buffer_more_before_play,useBufferBasedABR:y.previews_exp_enable_vhs_buffer_based_abr,showAudioTrackSubmenuInEmbed:N,onRenderSucceeded:g,onInteractive:_,timeRange:A}),G=n.useLogVideoAction(u,U,K),Y=i.react.exports.useRef(null),W=i.React$1.useRef(null),[X,Z]=i.React$1.useState(null),[ee,te]=i.react.exports.useState({rotate:0,flip:!1}),re=a.isNestedArchiveFilePreviewKey(f)||null==k?void 0:k.file_id,oe=i.React$1.useMemo((()=>F?[d.getPlayPauseKeybinding(F)]:[]),[F]),{setVideoPlayer:ie,setSelectVideoQualityCallback:ae}=a.usePreviewControls(),ne=i.React$1.useCallback((e=>{Z(e)}),[]);(e=>{const t=a.useFileViewerContext().batteries.optionalIOClients.urlClient,r=a.useStabilizedCallback(((r,o)=>{!e&&o&&qe(t)}));i.React$1.useEffect((()=>{const e=null==t?void 0:t.onQueryStringParameterChange("edit",r);return()=>{null==e||e()}}),[t,r])})($),i.react.exports.useEffect((()=>(F&&(null==ie||ie(F),null==ae||ae(J)),()=>{null==ie||ie(void 0),null==ae||ae(void 0)})),[F]),b.PreviewsEventLogger.mark(b.PreviewsTimingEvents.FVSDK_VIDEO_CONTAINER_START),b.useMarkTimingEventOnMount(b.PreviewsTimingEvents.FVSDK_VIDEO_CONTAINER_MOUNT),i.react.exports.useEffect((()=>{if(!h&&F&&X)return d.setupVideoJsEvents(F,{canplay:()=>{y.enable_video_editing&&new Promise((function(t,r){e(["./c_preview_audio_video_video_editing_video_edit_ui"],t,r)}))}},!0)}),[h,F,y,X]);const se=a.usePreviewKeySelector(a.getVideoDimensions,f),le=((e,t,r)=>{if(!e||!t)return null;const o=e.width,i=e.height,a=t.width,n=t.height;if(0===o||0===i||0===a||0===n)return null;const{width:s,height:l}=ge({width:o,height:i},r),c=n/l,d=a/s,u=Math.min(c,d);return{height:u*i,width:u*o}})(se,X,ee),ce=le?ge(le,ee):null,de=le&&ce?{"--video-height":`${le.height}px`,"--video-width":`${le.width}px`,width:`${ce.width}px`,height:`${ce.height}px`}:void 0;if(i.react.exports.useEffect((()=>{var e;const t=e=>{B.current={clientX:e.clientX,clientY:e.clientY}};return null===(e=Y.current)||void 0===e||e.addEventListener("dragover",t),()=>{var e;null===(e=Y.current)||void 0===e||e.removeEventListener("dragover",t)}}),[]),!re)return null;const ue=Object.assign(Object.assign({},t),{pluginProps:w,activeOverlayPlugin:m||p});return i.React$1.createElement("div",{className:o.classnames(a.headerContainer,{[n.mobileWebHeaderContainer]:P}),"data-testid":"fvsdk_preview_audio_video",ref:Y},w&&i.React$1.createElement(a.PluginHeader,{pluginProps:w,activeCommentPlugin:p,header:E}),i.React$1.createElement(a.KeyboardBindingConnector,{name:"preview_video",keyboardBindings:oe}),i.React$1.createElement(Ue,{isEditingVideo:$,duration:K,fileViewerId:u,timeRange:A},i.React$1.createElement(a.OverlayTransition,{active:$,className:n.app,style:{maxHeight:C}},O&&i.React$1.createElement(ve,{player:F,isShown:D,setIsShown:L,quality:z,logVideoAction:G}),i.React$1.createElement(he,Object.assign({},ue)),i.React$1.createElement(l.Resizer,{elementRef:W,onResize:ne},i.React$1.createElement("div",{className:o.classnames(n.videoPlayer,{[n.audioPlayer]:h,[n.withV2Toolbar]:I,"touch-device":He,[n.isFullScreen]:v.isFullScreen,[n.isSlowConnectionBannerShowing]:D,[n.isRedesign2023]:V,[n.isEditingVideo]:$}),ref:W,onClick:()=>{const e=null==p?void 0:p.commentUI.mediaScrubber.onClickOutsideMarkers;e&&e()},role:"presentation"},i.React$1.createElement("div",{key:H,"data-vjs-player":!0,className:n.rotationParentContainer,style:de},i.React$1.createElement(Ke,{audioVideoRef:q,"data-testid":"video-js",isAudio:h,videoTruncated:U,rotation:ee.rotate,flip:ee.flip,controls:!0},i.React$1.createElement("source",{src:H,type:pe})),F&&!h&&!$&&!He&&i.React$1.createElement(Oe,{player:F}),y.enable_video_editing&&F&&$&&le&&se&&i.React$1.createElement(we,{unrotatedScreenDimensions:le,rotateAndFlip:ee,actualVideoDimensions:se,lastCursorRef:B,player:F})),V&&!$&&i.React$1.createElement("div",{className:n.videoControlsWrapper,"data-testid":"preview-video-controls-toolbar"},i.React$1.createElement(n.VideoControlToolbar,{player:F,isVideo:!h,fileViewerId:u,previewKey:f,fileRivieraData:c,activeCommentPlugin:p,showInverse:!1,featureConfig:y}))),$&&F&&se&&i.React$1.createElement(Je,{fileViewerId:u,featureConfig:y,vttThumbnailsUrl:Q,duration:K,player:F,previewKey:f,fileConfig:x,videoDimensions:se,onRotateFlipChange:te,fileSaver:S,timeRange:A,lastCursorRef:B})))))};Qe.displayName="UnconnectedPreviewAudioVideo";const Ke=e=>{var{isAudio:t,children:o,audioVideoRef:s,videoTruncated:l,rotation:c,flip:d}=e,u=r.__rest(e,["isAudio","children","audioVideoRef","videoTruncated","rotation","flip"]);const p=a.is_mobile_or_tablet()?"nodownload":"",m=`video-js vjs-default-skin vjs-big-play-centered ${l?"show-truncated-bar":""} `,h=((e,t)=>({transform:`${t?"scaleX(-1) ":""}rotate(${e}deg)`}))(c,d);return t?i.React$1.createElement("audio",Object.assign({controlsList:p,ref:s,className:m},u),o):i.React$1.createElement("div",{className:n.rotationContainer,style:h},i.React$1.createElement("video",Object.assign({ref:s,controlsList:p,className:m,crossOrigin:"use-credentials"},u),o))};Ke.displayName="VideoAudioTag",Qe.displayName="UnconnectedPreviewAudioVideo";const Ge=e=>{const{fileViewerId:t,previewKey:r}=e,o=a.usePreviewState(t,r,a.filterAudioVideoFilePreviewUiState);return o?i.React$1.createElement(Qe,Object.assign({},e,o)):null};Ge.displayName="PreviewAudioVideo";var Ye=Object.freeze({__proto__:null,UnconnectedPreviewAudioVideo:Qe,VideoAudioTag:Ke,PreviewAudioVideo:Ge});t.VideoEditingContext=ye,t.leftBox="_left-box_188kh_88",t.leftHandle="_left-handle_188kh_121",t.leftTrackOverlay="_left-track-overlay_188kh_74",t.preview_video_esnext=Ye,t.rightBox="_right-box_188kh_92",t.rightHandle="_right-handle_188kh_125",t.rightTrackOverlay="_right-track-overlay_188kh_78",t.trimButtonHolder="_trim-button-holder_188kh_31",t.trimControlBar="_trim-control-bar_188kh_22",t.trimControlTrack="_trim-control-track_188kh_49",t.trimControlTrackOverlay="_trim-control-track-overlay_188kh_65",t.trimControlTrackWrapper="_trim-control-track-wrapper_188kh_49",t.trimCurrentTimeMarker="_trim-current-time-marker_188kh_151",t.trimDragBox="_trim-drag-box_188kh_82",t.trimHandle="_trim-handle_188kh_96",t.trimHandleWrapper="_trim-handle-wrapper_188kh_96",t.trimHoverTimeMarker="_trim-hover-time-marker_188kh_155",t.trimPreviews="_trim-previews_188kh_39",t.trimTimeMarker="_trim-time-marker_188kh_143",t.trimTimestamp="_trim-timestamp_188kh_129",t.trimmingUi="_trimming-ui_188kh_12",t.useVideoEditHistoryChange=e=>{const t=a.useFileViewerContext().batteries.optionalIOClients.urlClient;i.React$1.useEffect((()=>{const t=()=>e({forward:()=>window.history.go(1)});return window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t)}}),[e]),i.React$1.useEffect((()=>(null==t||t.setQueryStringParameter("edit","1"),()=>{qe(t)})),[t])},t.useVideoPlaybackState=Ie}));
//# sourceMappingURL=c_src_preview_audio_video_preview_video.js-vfl4xKPHY.map
