define(["exports","./c_tslib","./e_ui_page_files_router","./e_edison","./c_raf_throttle","./c_lodash-es_lodash"],(function(t,e,o,s,i,n){"use strict";var r;t.StickyPosition=void 0,(r=t.StickyPosition||(t.StickyPosition={}))[r.TOP_LEFT=1]="TOP_LEFT",r[r.TOP=2]="TOP",r[r.TOP_RIGHT=3]="TOP_RIGHT",r[r.LEFT_TOP=4]="LEFT_TOP",r[r.LEFT=5]="LEFT",r[r.LEFT_BOTTOM=6]="LEFT_BOTTOM",r[r.RIGHT_TOP=7]="RIGHT_TOP",r[r.RIGHT=8]="RIGHT",r[r.RIGHT_BOTTOM=9]="RIGHT_BOTTOM",r[r.BOTTOM_LEFT=10]="BOTTOM_LEFT",r[r.BOTTOM=11]="BOTTOM",r[r.BOTTOM_RIGHT=12]="BOTTOM_RIGHT",r[r.TOP_ALIGN_LEFT=13]="TOP_ALIGN_LEFT",r[r.TOP_ALIGN_RIGHT=14]="TOP_ALIGN_RIGHT",r[r.LEFT_ALIGN_TOP=15]="LEFT_ALIGN_TOP",r[r.LEFT_ALIGN_BOTTOM=16]="LEFT_ALIGN_BOTTOM",r[r.RIGHT_ALIGN_TOP=17]="RIGHT_ALIGN_TOP",r[r.RIGHT_ALIGN_BOTTOM=18]="RIGHT_ALIGN_BOTTOM",r[r.BOTTOM_ALIGN_LEFT=19]="BOTTOM_ALIGN_LEFT",r[r.BOTTOM_ALIGN_RIGHT=20]="BOTTOM_ALIGN_RIGHT";const l=function({targetNode:e,isTargetFixed:s,position:i,offset:n}){return(r,l)=>{if(null==e)return null;const a=e.getBoundingClientRect(),h={top:a.top+document.body.scrollTop,left:a.left+document.body.scrollLeft};if(s&&(h.top-=window.pageYOffset,l&&(h.left-=window.pageXOffset)),null==r)return{top:h.top,left:h.left};switch((null==n?void 0:n.vertical)&&(h.top+=n.vertical),(null==n?void 0:n.horizontal)&&(h.left+=n.horizontal),i){case t.StickyPosition.TOP_LEFT:return{top:h.top-r.offsetHeight,left:h.left+.5*e.offsetWidth-.75*r.offsetWidth};case t.StickyPosition.TOP:return{top:h.top-r.offsetHeight,left:h.left+.5*(e.offsetWidth-r.offsetWidth)};case t.StickyPosition.TOP_RIGHT:return{top:h.top-r.offsetHeight,left:h.left+.5*e.offsetWidth-.25*r.offsetWidth};case t.StickyPosition.LEFT_TOP:return{top:h.top+.5*e.offsetHeight-.75*r.offsetHeight,left:h.left-r.offsetWidth};case t.StickyPosition.LEFT:return{top:h.top+.5*(e.offsetHeight-r.offsetHeight),left:h.left-r.offsetWidth};case t.StickyPosition.LEFT_BOTTOM:return{top:h.top+.5*e.offsetHeight-.25*r.offsetHeight,left:h.left-r.offsetWidth};case t.StickyPosition.RIGHT_TOP:return{top:h.top+.5*e.offsetHeight-.75*r.offsetHeight,left:h.left+e.offsetWidth};case t.StickyPosition.RIGHT:return{top:h.top+.5*(e.offsetHeight-r.offsetHeight),left:h.left+e.offsetWidth};case t.StickyPosition.RIGHT_BOTTOM:return{top:h.top+.5*e.offsetHeight-.25*r.offsetHeight,left:h.left+e.offsetWidth};case t.StickyPosition.BOTTOM_LEFT:return{top:h.top+e.offsetHeight,left:h.left+.5*e.offsetWidth-.75*r.offsetWidth};case t.StickyPosition.BOTTOM:return{top:h.top+e.offsetHeight,left:h.left+.5*(e.offsetWidth-r.offsetWidth)};case t.StickyPosition.BOTTOM_RIGHT:return{top:h.top+e.offsetHeight,left:h.left+.5*e.offsetWidth-.25*r.offsetWidth};case t.StickyPosition.TOP_ALIGN_LEFT:return{top:h.top-r.offsetHeight,left:h.left};case t.StickyPosition.TOP_ALIGN_RIGHT:return{top:h.top-r.offsetHeight,left:h.left+e.offsetWidth-r.offsetWidth};case t.StickyPosition.LEFT_ALIGN_TOP:return{top:h.top,left:h.left-r.offsetWidth};case t.StickyPosition.LEFT_ALIGN_BOTTOM:return{top:h.top+e.offsetHeight-r.offsetHeight,left:h.left-r.offsetWidth};case t.StickyPosition.RIGHT_ALIGN_TOP:return{top:h.top,left:h.left+e.offsetWidth};case t.StickyPosition.RIGHT_ALIGN_BOTTOM:return{top:h.top+e.offsetHeight-r.offsetHeight,left:h.left+e.offsetWidth};case t.StickyPosition.BOTTOM_ALIGN_LEFT:return{top:h.top+e.offsetHeight,left:h.left};case t.StickyPosition.BOTTOM_ALIGN_RIGHT:return{top:h.top+e.offsetHeight,left:h.left+e.offsetWidth-r.offsetWidth};default:return o.enforceExhaustive(i)}}};class a extends s.React$1.Component{constructor(t){super(t),this._getStyle=()=>{const t=this.props.isTargetFixed?"fixed":"absolute";return n.extend({outline:0,position:t},this.state.positioning)},this._createScrollHandler=()=>{const t=n.debounce(this._throttle.request,500);return()=>(this._throttle.request(),t())},this._updatePositioning=()=>{if(!this.refs.root)return;const t=this.props.getPositioning(s.reactDom.exports.findDOMNode(this),this.props.compensateForHorizontalScroll);return null!=t?this.setState({positioning:t},(()=>"function"==typeof this.props.onReposition?this.props.onReposition(this.state.positioning):void 0)):void 0},this._throttle=new i.RafThrottle(this._updatePositioning),this.state={positioning:this.props.initialPositioning}}componentDidMount(){window.addEventListener("resize",this._throttle.request),this.props.compensateForHorizontalScroll&&(this._scrollHandler=this._createScrollHandler(),window.addEventListener("scroll",this._scrollHandler)),this._updatePositioning()}componentDidUpdate(t){if(this.props!==t)return this._throttle.request()}componentWillUnmount(){this._throttle.cancelPending(),window.removeEventListener("resize",this._throttle.request),this.props.compensateForHorizontalScroll&&window.removeEventListener("scroll",this._scrollHandler)}render(){return s.React$1.createElement("div",{ref:"root",style:this._getStyle(),tabIndex:-1},this.props.children)}}a.displayName="FreePositioned",a.defaultProps={isTargetFixed:!1,initialPositioning:null,compensateForHorizontalScroll:!0};class h extends s.React$1.Component{constructor(){super(...arguments),this.overlayContentRef=s.React$1.createRef(),this.overlayContentDidMount=()=>{this.props.isContentFocusable&&(this._focusElementInOverlay(),this._bindOverlayHandlers()),this.props.isFullScreen&&(this._setScreenReaderHiddenForSiblingsAndAncestors(this.overlayContentRef.current,!0),o.scroll_lock_document()),this.props.onRendered()},this._bindOverlayHandlers=()=>{window.addEventListener("mousedown",this._handleFocusOutOverlay,!0),window.addEventListener("blur",this._handleFocusIntoIframe,!0)},this._unbindOverlayHandlers=()=>{window.removeEventListener("mousedown",this._handleFocusOutOverlay,!0),window.removeEventListener("blur",this._handleFocusIntoIframe,!0)},this._getContentStyle=()=>this.props.position&&!this.props.isFullScreen?{top:this.props.position.top,left:this.props.position.left}:{},this._setScreenReaderHiddenForSiblingsAndAncestors=(t,e)=>{if(!t)return;const{parentElement:o}=t;if(o){const s=Array.from(o.children).filter((e=>e!==t&&"#accessible-announce"!==e.id));e?s.forEach((t=>{t.setAttribute("aria-hidden","true")})):s.forEach((t=>{t.removeAttribute("aria-hidden")})),o!==this._rootContainer&&this._setScreenReaderHiddenForSiblingsAndAncestors(o,e)}},this._focusElementInOverlay=()=>{var t;let e=null===(t=this.overlayContentRef.current)||void 0===t?void 0:t.firstElementChild;if(e&&null==e.getAttribute("tabindex")&&(e=this.overlayContentRef.current),this.props.shouldAutoFocusOverlayContent&&this.overlayContentRef.current){const t=o.getTabbableElementsIn(this.overlayContentRef.current);t.length>0&&(e=t[0])}requestAnimationFrame((()=>{e instanceof HTMLElement&&e.focus()}))},this._handleKeyDown=t=>{this.props.isContentFocusable&&(t.key===o.Key_enum.Key.Tab?this._handleTabNavigate(t):t.key===o.Key_enum.Key.Escape&&this._blur(t,this.overlayTarget))},this._handleFocusOutOverlay=t=>{var e;this.props.isContentFocusable&&(t.target===this.overlayTarget||this.overlayTarget.contains(t.target)||(null===(e=this.overlayContentRef.current)||void 0===e?void 0:e.contains(t.target))||this._blur(t,t.target||this.overlayTarget))},this._handleFocusIntoIframe=t=>{this.props.document.activeElement&&"IFRAME"===this.props.document.activeElement.tagName&&this._blur(t,this.props.document.activeElement)},this._handleTabNavigate=t=>{const e=this.overlayContentRef.current;if(e)if(this.props.shouldTrapKeyboardFocus||this.props.isFullScreen)t.target instanceof Element&&o.keepFocusIn(e,t.target,t.nativeEvent);else{let s,i;const n=o.getTabbableElementsIn(e),r=n[0],l=n[n.length-1];if(t.shiftKey&&(s=t.target,[e,r].includes(s)))this._blur(t,this.overlayTarget);else if(!t.shiftKey&&(i=t.target,[e,l].includes(i))){let e=this.overlayTarget;if(this.overlayTarget.parentNode){const t=o.getFocusableElementsIn(this.overlayTarget.parentNode),s=t.indexOf(e);s<t.length-1&&(e=t[s+1])}this._blur(t,e)}}},this._blur=(t,e)=>{t.preventDefault(),t.stopPropagation(),e.focus(),this.props.onBlur&&this.props.onBlur()}}UNSAFE_componentWillMount(){this._rootContainer=this.props.document.body,this.overlayTarget=this.props.overlayTarget||this.props.document.activeElement}componentDidUpdate(t){this.overlayContentRef.current&&!t.isContentFocusable&&this.props.isContentFocusable&&(this._focusElementInOverlay(),this._bindOverlayHandlers())}componentWillUnmount(){this._unbindOverlayHandlers(),this.props.isFullScreen&&(this._setScreenReaderHiddenForSiblingsAndAncestors(this.overlayContentRef.current,!1),o.scroll_unlock_document())}render(){return s.React$1.createElement(o.Portal,{className:"react-overlay-portal-container",parentElement:this.props.overlayRoot||this._rootContainer,onRendered:this.overlayContentDidMount},s.React$1.createElement("div",{ref:this.overlayContentRef,tabIndex:-1,className:o.classnames(this.props.className,{"react-overlay":!0,"react-overlay--is-fullscreen":this.props.isFullScreen}),style:this._getContentStyle(),role:this.props.isFullScreen?"dialog":void 0,onKeyDown:this._handleKeyDown},this.props.children))}}h.displayName="Overlay",h.defaultProps={overlayRoot:null,overlayTarget:null,isFullScreen:!1,shouldTrapKeyboardFocus:!1,isContentFocusable:!0,shouldAutoFocusOverlayContent:!0,position:null,onRendered:n.noop,onBlur:n.noop};const c=o.requireCssWithComponent(o.withDocument(h),["/static/metaserver/static/css/react/overlay-vflNXoFem.css"]);class f extends s.React$1.Component{constructor(){super(...arguments),this.state={readyToFocusInOverlay:!1},this._handlePositionUpdated=t=>{!this.currentPositioning&&this.props.isContentFocusable&&this.setState({readyToFocusInOverlay:!0}),this.currentPositioning=t,this.props.onReposition&&this.props.onReposition(t)}}render(){const t=this.props,{position:o,children:i,onReposition:n}=t,r=e.__rest(t,["position","children","onReposition"]);return s.React$1.createElement(c,Object.assign({overlayTarget:this.props.targetNode,isFullScreen:!1,isContentFocusable:this.state.readyToFocusInOverlay,className:this.props.className},r),s.React$1.createElement(a,Object.assign({getPositioning:l({targetNode:this.props.targetNode,isTargetFixed:Boolean(this.props.isTargetPositionFixed),position:this.props.position,offset:this.props.positionOffset}),isTargetFixed:this.props.isTargetPositionFixed,onReposition:this._handlePositionUpdated},r),this.props.children))}}f.displayName="PositionedOverlay",f.defaultProps={isTargetPositionFixed:!1,isContentFocusable:!0},t.Overlay=c,t.PositionedOverlay=f}));
//# sourceMappingURL=c_ui_overlay.js-vfln4GHuY.map
