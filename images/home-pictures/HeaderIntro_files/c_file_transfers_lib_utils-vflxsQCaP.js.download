define(["exports","./c_tslib","./c_api_v2_noauth_client","./e_ui_page_files_router","./c_src_common_constants2","./c_file_transfers_lib_urls","./c_core_browser_detection","./c_browser_cookies","./c_downloads","./e_core_exception","./c_upload_kit_lib_types","./c_core_i18n","./c_lodash-es_lodash"],(function(e,t,r,i,n,o,a,s,l,c,d,u,f){"use strict";function _(e){return i.format_date_utc(e,"yyyy-MM-ddTHH:mm:ssZ")}var p,m,g,S,T,F,h,E,w,v,y,L;e.UserFlow=void 0,(p=e.UserFlow||(e.UserFlow={})).TRANSFER_MANAGEMENT_MODAL="transfer_management_modal",p.MANAGEMENT_LIST_VIEW="management_list_view",p.CREATION="creation",p.RECIPIENT="recipient",p.BROWSE="browse",p.TRANSFER_CREATION_MODAL="transfer_creation_modal",e.ModalVisibilityChange=void 0,(m=e.ModalVisibilityChange||(e.ModalVisibilityChange={})).OPEN="open",m.CANCEL="cancel",m.OK="ok",e.SettingsVisibilityChange=void 0,(g=e.SettingsVisibilityChange||(e.SettingsVisibilityChange={})).OPEN="open",g.CLOSE="close",e.TransferListView=void 0,(S=e.TransferListView||(e.TransferListView={}))[S.Active=0]="Active",S[S.Expired=1]="Expired",S[S.All=2]="All",e.Actions=void 0,(T=e.Actions||(e.Actions={})).ChangeSettingsModalState="FileTransfers/ChangeSettingsModalState",T.ChangeConfirmTransferDeletionModalState="FileTransfers/ChangeConfirmTransferDeletionModalState",T.LogTransferCreationModalOpened="FileTransfers/LogTransferCreationModalOpened",T.CopyTransferLink="FileTransfers/CopyTransferLink",T.DeleteTransferSummary="FileTransfers/DeleteTransferSummary",T.ExpireTransferSummary="FileTransfers/ExpireTransferSummary",T.ReactivateTransferSummary="FileTransfers/ReactivateTransferSummary",T.FinishedEditing="FileTransfers/FinishedEditing",T.HideOnboardingStep="FileTransfers/HideOnboardingStep",T.InitApp="FileTransfers/InitApp",T.LogAllItemsUploaded="FileTransfers/LogAllItemsUploaded",T.LogAutoDownload="FileTransfers/LogAutoDownload",T.LogOnboarding="FileTransfers/LogOnboarding",T.LogEmailFeedback="FileTransfers/LogEmailFeedback",T.LogUpsell="FileTransfers/LogUpsell",T.MarkOnboardingStepComplete="FileTransfers/MarkOnboardingStepComplete",T.MarkServerRestrictedFiles="FileTransfers/MarkServerRestrictedFiles",T.MetadataUpdated="FileTransfers/MetadataUpdated",T.SendTransferViaEmail="FileTransfers/SendTransferViaEmail",T.TrackUserLeapEvent="FileTransfers/TrackUserLeapEvent",T.ReceivedTransferRowClick="FileTransfers/ReceivedTransferRowClick",T.TransferManagementTabClick="FileTransfers/TransferManagementTabClick",T.SetActiveUserId="FileTransfers/SetActiveUserId",T.SetBackground="FileTransfers/SetBackground",T.SetBackgroundPreview="FileTransfers/SetBackroundPreview",T.SetLogo="FileTransfers/SetLogo",T.SaveLogo="FileTransfers/SaveLogo",T.SetCurrentTransfer="FileTransfers/SetCurrentTransfer",T.SetExpiration="FileTransfers/SetExpiration",T.SetIsShared="FileTransfers/SetShareStatus",T.SetIsShareComplete="FileTransfer/SetShareComplete",T.ChangeManagementModalState="FileTransfers/ChangeManagementModalState",T.SetProductConfig="FileTransfers/SetProductConfig",T.SetRecipients="FileTransfers/SetRecipients",T.SetShareUrl="FileTransfers/SetShareUrl",T.SetFileTransfersUserMetadata="FileTransfers/SetFileTransfersUserMetadata",T.UpdateTransferSummaries="FileTransfers/UpdateTransferSummaries",T.AddNewTransferSummary="FileTransfers/AddNewTransferSummary",T.UpdateReceivedTransferSummaries="FileTransfers/UpdateReceivedTransferSummaries",T.ViewFeedbackForm="FileTransfers/ViewFeedbackForm",T.TemporarilySaveEmailFormInfo="FileTransfers/TemporarilySaveEmailFormInfo",T.ClearSavedEmailFormInfo="FileTransfers/ClearSavedEmailFormInfo",T.LogInternetDisconnected="FileTransfers/LogInternetDisconnected",T.LogOnboardingStepShown="FileTransfers/LogOnboardingStepShown",T.MarkOnboardingStepShown="FileTransfers/MarkOnboardingStepShown",T.LogShareError="FileTransfers/LogShareError",T.UpdateSettingsFromManagementModal="FileTransfers/UpdateSettingsFromManagementModal",T.LogSettingsClicked="LogSettingsClicked",T.RemoveReceivedTransferFromList="FileTransfers/RemoveReceivedTransferFromList",T.LogRemoveReceivedTransferClicked="FileTransfers/LogRemoveReceivedTransferClicked",T.LogShopEntryPointViewed="FileTransfers/LogShopEntryPointViewed",T.LogShopEntryPointClicked="FileTransfers/LogShopEntryPointClicked",e.UploadStatus=void 0,(F=e.UploadStatus||(e.UploadStatus={}))[F.Waiting=0]="Waiting",F[F.Uploading=1]="Uploading",F[F.Success=2]="Success",F[F.Error=3]="Error",e.FileSource=void 0,(h=e.FileSource||(e.FileSource={})).Dropbox="dropbox",h.Computer="computer",h.Transfer="transfer",e.OriginalFileSource=void 0,(E=e.OriginalFileSource||(e.OriginalFileSource={})).Dropbox="dropbox",E.Computer="computer",E.Unknown="unknown",e.UploadActionSource=void 0,(w=e.UploadActionSource||(e.UploadActionSource={})).DRAG_DROP="drag_drop",w.DROPBOX_CHOOSER_ADDITIONAL="dropbox_chooser_additional",w.DROPBOX_CHOOSER_INITIAL="dropbox_chooser_initial",w.UPLOAD_BUTTON_ADDITIONAL="upload_button_additional",w.UPLOAD_BUTTON_INITIAL="upload_button_initial",w.DESKTOP_CONTEXT_MENU="desktop_context_menu",w.PAGELET_ON_LOAD="pagelet_on_load",w.TRANSFER_CREATION_MODAL_ON_LOAD="transfer_creation_modal_on_load",e.UploadErrorType=void 0,(v=e.UploadErrorType||(e.UploadErrorType={})).EmptyFile="empty_file",v.IgnoredFile="ignored_file",v.OverMaxFileSize="over_max_file_size",v.PointerFile="pointer_file",v.TemporaryFile="temporary_file",v.InvalidChar="invalid_char",v.NotFound="not_found",v.NoPermission="no_permission",v.Restricted="restricted",v.InvalidArgs="invalid_args",v.Unknown="unknown",e.UploadCancelSource=void 0,(y=e.UploadCancelSource||(e.UploadCancelSource={})).CancelButton="cancel_button",y.WindowClose="window_close",function(e){e[e.NOT_STARTED=0]="NOT_STARTED",e[e.DOWNLOADING=1]="DOWNLOADING",e[e.ERROR=2]="ERROR",e[e.PAUSED=3]="PAUSED",e[e.FETCHING_TOKENS=4]="FETCHING_TOKENS",e[e.CANCELED=5]="CANCELED",e[e.COMPLETED=6]="COMPLETED"}(L||(L={}));class C extends Error{constructor(e){super(e),this.message=e,this.name="BlockTokenExpired"}}function A(e){return{recipient:{".tag":"email_address",email_address:e.email}}}function O(e,t={}){return void 0===t.numDecimalPlaces&&(e<i.SWITCH_UNIT_THRESHOLD*n.BYTES_IN_KILOBYTE?t.numDecimalPlaces=0:e<i.SWITCH_UNIT_THRESHOLD*n.BYTES_IN_MEGABYTE?t.numDecimalPlaces=1:t.numDecimalPlaces=2),i.format_bytes(e,t.numDecimalPlaces,t.includeSpace,t.lazy,t.allowNegative)}function I(e){const t=localStorage.getItem(e);return null===t?null:parseInt(t,10)}function U(e){const t=localStorage.getItem(e);return null===t?null:"true"===t}function D(e,t){localStorage.setItem(e,t.toString())}const b="transfer_agreed_to_tos";const N="fileTransferEverSetBackground";const k="fileTransferHasEverSetLogo";function R(e,t){return e.title||x(e.summary_file_names,e.display_file_count,t)}function x(e,t,r){return 0===e.length?u.intl.formatMessage({id:"syJiNE",defaultMessage:"Transfer with no items"}):t<=1?u.intl.formatMessage({id:"8oHG0B",defaultMessage:"{item_name}"},{item_name:r?M(e[0]):e[0]}):u.intl.formatMessage({id:"IUBT/B",defaultMessage:"{item_name} + {item_count}"},{item_name:r?M(e[0]):e[0],item_count:t-1})}function M(e){let t=e;if(e.length>o.MAX_LEN_OF_FILE_NAME){t=`${e.slice(0,o.LEN_OF_FILE_NAME_PREFIX)}...${e.slice(e.length-o.LEN_OF_FILE_NAME_SUFFIX)}`}return t}function P(t,r){return{id:t.transfer_file_id,isDir:t.obsolete_is_dir,path:t.relative_path,size:t.file_size,source:e.FileSource.Transfer,originalSource:r,thumbnailUrl:t.thumbnail_url||null,fileForPreview:t.file_preview_info}}function B(t){return{id:t.file_id,isDir:t.is_dir,path:i.filename(t.ns_path),size:t.bytes,source:e.FileSource.Dropbox,originalSource:e.OriginalFileSource.Dropbox,thumbnailUrl:null}}function V(e){const t=e.split("/");return t[t.length-1]}function j(e,t={}){return Object.assign({id:e.id,isDir:e.isDir,name:V(e.path),size:e.size,thumbnailUrl:e.thumbnailUrl,fileForPreview:e.fileForPreview},t)}function z(e){return null===H(e)}function H(e){let t;if("dest"in e)t=e.dest;else if("fullPath"in e){if(!e.fullPath)return null;t=e.fullPath,"/"===t.charAt(0)&&(t=e.fullPath.substring(1))}else{if(!("path"in e))throw new Error("file must be either PluploadFile, StateFileInfo, or FileSystemEntry");if(!e.path)return null;t=e.path}const r=t.split("/");return r.length<=1?null:r[0]}function W(e){return e||o.NULL_FILE_TRANSFER_KEY}function Y(t){return t.isDir&&t.source===e.FileSource.Computer}function K(e,t={}){const r=document.getElementsByName("file-downloads-iframe");for(const e of Array.from(r))e&&e.parentNode&&e.parentNode.removeChild(e);const i=document.createElement("iframe");i.name="file-downloads-iframe",i.src="about:blank",i.setAttribute("style","display: none;"),document.body.appendChild(i);const n=i.contentDocument,o=n.createElement("form");o.action=e,o.method="post",Object.keys(t).forEach((e=>{const r=document.createElement("input");r.type="hidden",r.name=e,r.value=t[e],o.appendChild(r)})),n.body.appendChild(o),o.submit()}function G(e,t=[]){const r=[],n=[],o=new Set,a=new Set;return t.filter((e=>z(e))).forEach((e=>{o.add(e.id),a.add(e.path.toLowerCase())})),e.forEach((e=>{let t;const s=i.split_filename(e.path);let l;if(a.has(e.path.toLowerCase())){if(o.has(e.id))return;let i,n=1;do{i=`${s.name} (${n})`,t=s.ext?`${i}.${s.ext}`:i,n++}while(a.has(t.toLowerCase()));o.add(e.id),a.add(t.toLowerCase()),l=Object.assign(Object.assign({},e),{path:t}),r.push(l)}else z(e)?(o.add(e.id),a.add(e.path.toLowerCase()),l=Object.assign({},e)):l=Object.assign({},e);n.push(l)})),{files:n,filesRenamed:r}}const $=864e5;function X(e,t){return Math.round((t.getTime()-e.getTime())/$)}function q(e,t){const r=X(new Date(e.getFullYear(),e.getMonth(),e.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate()));switch(r){case n.ExpirationOption.SEVEN_DAYS:case n.ExpirationOption.THIRTY_DAYS:case n.ExpirationOption.NINETY_DAYS:return r;default:return n.ExpirationOption.CUSTOM}}function J(e,t){const r={ctaCopy:e.cta_copy,ctaLink:e.cta_link,productName:e.product_name};return t&&(r.ctaLink=o.addTrackingParams(r.ctaLink,{},t)),r}function Z(e){return t=>function(e){return e.value?e.value[".tag"]:"other"}(t)===e}const Q=Z("image"),ee=Z("video");function te(e){return!!e.color_hex&&!e.asset}function re(e){return!!e.asset&&Q(e.asset)}function ie(e){return!!e.asset&&ee(e.asset)}function ne(){return i.UUID.v4()}function oe(e,t){return t?f.filter(t,(t=>t.status===e)).length:0}function ae(e,t){if(!e.isDir)throw Error("Can only get children of a directory");return t.filter((t=>t.path!==e.path&&t.path.startsWith(`${e.path}/`)))}function se(t,r){return t.every((t=>r[t.id]&&r[t.id].status===e.UploadStatus.Success))}function le(e,t){const r=e=>Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),i=r(t)-r(e);return new Date(+e+i)}function ce(e){var t;switch(null===(t=e.error_type)||void 0===t?void 0:t[".tag"]){case"not_found":return d.UploadErrorType.NotFound;case"no_permission":return d.UploadErrorType.NoPermission;case"restricted":return d.UploadErrorType.Restricted;case"invalid_args":return d.UploadErrorType.InvalidArgs;default:return d.UploadErrorType.Unknown}}function de(e){return e?n.DEFAULT_EXPIRATION_OPTION_PAID:n.DEFAULT_EXPIRATION_OPTION_FREE}const ue=(e,t)=>{const r=o.prepareFileIdsParam(e);i.Snackbar.sync(u.intl.formatMessage({id:"EmOY+w",defaultMessage:"Creating new transfer..."}),!1,"create-transfer"),i.redirect(o.createTransferUrlWithParams({referrer:t,fileids:r}))},fe=(e,t)=>e&&t.length>0&&!t.some((e=>e.is_cloud_doc))&&!t.some(i.File.isNoAccessSharedFolder);var _e=Object.freeze({__proto__:null,contactToEmailRecipient:A,sortByCreationTimeDesc:function(e,t=!0){return t?[...e].sort(((e,t)=>e.creation_time<t.creation_time?1:t.creation_time<e.creation_time?-1:0)):[...e].sort(((e,t)=>e.creation_time>t.creation_time?1:t.creation_time>e.creation_time?-1:0))},sortByExpirationTimeDesc:function(e,t=!0){return t?[...e].sort(((e,t)=>e.expiration_time&&t.expiration_time?e.expiration_time<t.expiration_time?1:t.expiration_time<e.expiration_time?-1:0:0)):[...e].sort(((e,t)=>e.expiration_time&&t.expiration_time?e.expiration_time>t.expiration_time?1:t.expiration_time>e.expiration_time?-1:0:0))},sortByNameDesc:function(e,t=!0){return t?[...e].sort(((e,t)=>{const r=void 0!==e.title?e.title:e.summary_file_names[0],i=void 0!==t.title?t.title:t.summary_file_names[0];return i&&r?r.toLocaleLowerCase()<i.toLocaleLowerCase()?1:i.toLocaleLowerCase()<r.toLocaleLowerCase()?-1:0:0})):[...e].sort(((e,t)=>{const r=void 0!==e.title?e.title:e.summary_file_names[0],i=void 0!==t.title?t.title:t.summary_file_names[0];return r&&i?r.toLocaleLowerCase()>i.toLocaleLowerCase()?1:i.toLocaleLowerCase()>r.toLocaleLowerCase()?-1:0:0}))},sortByFirstReceivedTimeDesc:function(e,t=!0){return t?[...e].sort(((e,t)=>e.first_received_time<t.first_received_time?1:t.first_received_time<e.first_received_time?-1:0)):[...e].sort(((e,t)=>e.first_received_time>t.first_received_time?1:t.first_received_time>e.first_received_time?-1:0))},sortReceivedByNameDesc:function(e,t=!0){return t?[...e].sort(((e,t)=>{const r=void 0!==e.title?e.title:e.summary_file_names[0],i=void 0!==t.title?t.title:t.summary_file_names[0];return r&&i?r.toLocaleLowerCase()<i.toLocaleLowerCase()?1:i.toLocaleLowerCase()<r.toLocaleLowerCase()?-1:0:0})):[...e].sort(((e,t)=>{const r=void 0!==e.title?e.title:e.summary_file_names[0],i=void 0!==t.title?t.title:t.summary_file_names[0];return r&&i?r.toLocaleLowerCase()>i.toLocaleLowerCase()?1:i.toLocaleLowerCase()>r.toLocaleLowerCase()?-1:0:0}))},sortReceivedByExpirationDesc:function(e,t=!0){return t?[...e].sort(((e,t)=>e.expiration_time&&t.expiration_time?e.expiration_time<t.expiration_time?1:t.expiration_time<e.expiration_time?-1:0:0)):[...e].sort(((e,t)=>e.expiration_time&&t.expiration_time?e.expiration_time>t.expiration_time?1:t.expiration_time>e.expiration_time?-1:0:0))},DEFAULT_LOCALE:"en",SUPPORTED_LOCALES:["da_DK","de","en","en_GB","es","es_ES","fr","id","it","ja","ko","ms","nb_NO","nl_NL","pl","pt_BR","ru","sv_SE","th_TH","uk_UA","zh_CN","zh_TW"],formatBytes:O,incrementLocalStorageValueForKey:function(e){const t=I(e);D(e,t?t+1:1)},getLocalStorageNumberValueForKey:I,getLocalStorageBooleanValueForKey:U,setLocalStorageValueForKey:D,HAS_USER_AGREED_TO_LOGGED_OUT_TRANSFER_TOS_KEY:b,hasUserAgreedToLoggedOutTransferTOS:function(){return!!s.Cookies.read(b)},markUserAgreedToLoggedOutTransferTOS:function(){s.Cookies.create(b,"true")},hasAtLeastOneFileDownloaded:function(e){return null!==sessionStorage.getItem(`fileTransferAtLeastOneFileDownloaded:${e}`)},markAtLeastOneFileDownloaded:function(e){sessionStorage.setItem(`fileTransferAtLeastOneFileDownloaded:${e}`,"true")},hasEverSetBackground:function(){return null!==localStorage.getItem(N)},markHasEverSetBackground:function(){localStorage.setItem(N,"true")},hasEverSetLogo:function(){return null!==localStorage.getItem(k)},markHasEverSetLogo:function(){localStorage.setItem(k,"true")},generateTransferSummaryTitle:R,generateTransferTitle:x,formatLongFileNameForDisplay:M,createDirectoryStateFileInfo:function(t,r){let n=e.OriginalFileSource.Unknown;return r===e.FileSource.Dropbox?n=e.OriginalFileSource.Dropbox:r===e.FileSource.Computer&&(n=e.OriginalFileSource.Computer),{id:i.UUID.v4(),isDir:!0,path:t,size:0,source:r,originalSource:n,thumbnailUrl:null}},transferFileAsStateFileInfo:P,chooserFileAsStateFileInfo:function({id:t,isDir:r,name:i,bytes:n}){return{id:t,isDir:r,path:i,size:n,source:e.FileSource.Dropbox,originalSource:e.OriginalFileSource.Dropbox,thumbnailUrl:null}},pluploadFileAsStateFileInfo:function(t){return{id:t.id,isDir:0===t.size,path:t.dest,size:t.size,source:e.FileSource.Computer,originalSource:e.OriginalFileSource.Computer,thumbnailUrl:null}},browseFileAsStateFileInfo:B,fileAsStateFileInfo:function(t){return{path:t.name,id:t.name,size:t.size||0,isDir:!1,source:e.FileSource.Computer,originalSource:e.OriginalFileSource.Computer,thumbnailUrl:null}},fileSysEntrytoStateFileInfo:function(t,r){return{path:t.name,id:t.name,size:r,isDir:!1,source:e.FileSource.Computer,originalSource:e.OriginalFileSource.Computer,thumbnailUrl:null}},fileNameFromPath:V,stateFileInfoAsFileInfo:j,sumBytes:function(e){return e.reduce(((e,t)=>e+t.size),0)},fileSystemDirectoryEntryAsStateFileInfo:function(t){return{id:i.UUID.v4(),isDir:!0,path:t.fullPath?t.fullPath.substring(1):t.name,size:0,source:e.FileSource.Computer,originalSource:e.OriginalFileSource.Computer,thumbnailUrl:null}},isAtRoot:z,getRootDirectory:H,getTransferFilesKey:W,isLocalDirectory:Y,downloadZipFromUrl:K,displayDownloadSnackbarError:function(e){i.Snackbar.fail(u.intl.formatMessage({id:"eIzkSh",defaultMessage:"Something's not working. Try downloading again."}),"download-transfer-notification"),c.reportException({err:e,tags:["js:file_transfers"]})},downloadFiles:function(e,n,o,a){return t.__awaiter(this,void 0,void 0,(function*(){const s=function(e,n,o,a){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:n,requested_files_by_id:o,is_preview_download:a||!1};return e?yield(new i.UserApiV2Client).ns("file_transfers").rpc("files/download",t,{subjectUserId:e}):yield(new r.NoAuthApiV2Client).ns("file_transfers").rpc("files/download_logged_out",t,{})}))}(n,e,o,a);return s.then((e=>{const t=e.post_params?JSON.parse(e.post_params):{},r=e.url.toString();0===Object.keys(t).length?l.get({url:r}):K(r,t)})),s}))},renameDuplicateFiles:G,DAYS_IN_MS:$,getDateDiff:X,isTransferExpired:function(e){return e.getTime()<Date.now()},estimateExpirationOption:q,getUpsellProps:J,isColorBackground:te,isImageBackground:re,isVideoBackground:ie,getImageBackgroundAsset:function(e){return re(e)?e.asset.value:null},getVideoBackgroundAsset:function(e){return ie(e)?e.asset.value:null},generateTransferTrackingId:ne,numWaiting:t=>oe(e.UploadStatus.Waiting,t),numSuccess:t=>oe(e.UploadStatus.Success,t),getChildrenFiles:ae,areItemsUploaded:se,computeCreationRelativeExpirationDate:le,browserSupportsNativeFS:function(){return!(!a.checkBrowserVersion(a.chromium(),86,!0)&&!a.checkBrowserVersion(a.safari,15.2,!0))},getBlocks:function(e,n,o){return t.__awaiter(this,void 0,void 0,(function*(){return function(e,n,o){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:o,requested_files_by_id:[n]};return e?yield(new i.UserApiV2Client).ns("file_transfers").rpc("files/get_blocks",t,{subjectUserId:e}):yield(new r.NoAuthApiV2Client).ns("file_transfers").rpc("files/get_blocks_logged_out",t,{})}))}(e,n,o)}))},getBlock:function(e,r){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield fetch(`https://${e}/web_download_chunks_batch`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`web_block_request_tokens=${JSON.stringify([r])}`});if(!t.ok)throw 403===t.status?new C("Refresh block tokens"):new Error("Blockserver error");return t}))},convertToUploadErrorType:ce,getDefaultExpirationOption:de,redirectToCreateTransferWithFiles:ue,shouldShowTransferInSplitShare:fe});e.addFilesByBlocks=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:r||void 0,files_to_add:n};return yield(new i.UserApiV2Client).ns("file_transfers").rpc("files/add_by_blocks",t,{subjectUserId:e})}))},e.addFilesById=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:r||void 0,files_to_add:n};return yield(new i.UserApiV2Client).ns("file_transfers").rpc("files/add_by_id",t,{subjectUserId:e})}))},e.addRecipientsAndSend=function(e,r,n,o){return t.__awaiter(this,void 0,void 0,(function*(){const t=[],a=(new i.UserApiV2Client).ns("file_transfers");for(let i=0;i<r.length;i+=10){const s={recipients:r.slice(i,i+10),message_body:n,transfer_id:o};t.push(a.rpc("recipients/add_and_send",s,{subjectUserId:e}))}return yield Promise.all(t),{}}))},e.areItemsUploaded=se,e.browseFileAsStateFileInfo=B,e.computeCreationRelativeExpirationDate=le,e.contactToEmailRecipient=A,e.convertToUploadErrorType=ce,e.createTransfer=function(e,r){return t.__awaiter(this,void 0,void 0,(function*(){const t={};return r&&(t.client_generated_tracking_id=r),yield(new i.UserApiV2Client).ns("file_transfers").rpc("create",t,{subjectUserId:e})}))},e.estimateExpirationOption=q,e.fetchFiles=function(e,n){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:n};return e?yield(new i.UserApiV2Client).ns("file_transfers").rpc("files/list",t,{subjectUserId:e}):yield(new r.NoAuthApiV2Client).ns("file_transfers").rpc("files/list_logged_out",t,{})}))},e.formatBytes=O,e.formatTimestamp=_,e.generateTransferSummaryTitle=R,e.generateTransferTrackingId=ne,e.getChildrenFiles=ae,e.getDateDiff=X,e.getDefaultExpirationOption=de,e.getFileTransfersUserMetadata=function(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=yield i.getUserMetadata(["FILE_TRANSFER_SHOULD_NOTIFY_CREATOR_ON_DOWNLOAD","FILE_TRANSFER_EXPIRATION_OPTION"],e);return{defaultExpirationOption:t.FILE_TRANSFER_EXPIRATION_OPTION,defaultShouldNotifyCreatorOnDownloadSetting:t.FILE_TRANSFER_SHOULD_NOTIFY_CREATOR_ON_DOWNLOAD}}))},e.getFolderSizes=function(e,r){return t.__awaiter(this,void 0,void 0,(function*(){return yield(new i.UserApiV2Client).ns("folders_info").rpc("get_folder_sizes",{paths:r},{subjectUserId:e})}))},e.getLocalStorageBooleanValueForKey=U,e.getProductConfig=function(e){return t.__awaiter(this,void 0,void 0,(function*(){return e?yield(new i.UserApiV2Client).ns("file_transfers").rpc("product_config/get",{},{subjectUserId:e}):yield(new r.NoAuthApiV2Client).ns("file_transfers").rpc("product_config/get",{},{})}))},e.getTransferFilesKey=W,e.getUpsellProps=J,e.isAtRoot=z,e.isColorBackground=te,e.isImageBackground=re,e.isLocalDirectory=Y,e.isVideoBackground=ie,e.logProductAnalyticsEvent=function(e,n,o){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:n.transferId,event_name:n.eventName,file_expiration:n.fileExpiration,file_transfer_flow:n.fileTransferFlow,client_generated_transfer_tracking_id:n.clientGeneratedTransferTrackingId,extra:JSON.stringify(n.extra)};return o?e?new i.UserApiV2Client(new i.BeaconTransport).ns("file_transfers").rpc("product_analytics/log_event",t,{subjectUserId:e}):new r.NoAuthApiV2Client(new i.BeaconTransport).ns("file_transfers").rpc("product_analytics/log_event_logged_out",t,{}):e?yield(new i.UserApiV2Client).ns("file_transfers").rpc("product_analytics/log_event",t,{subjectUserId:e}):yield(new r.NoAuthApiV2Client).ns("file_transfers").rpc("product_analytics/log_event_logged_out",t,{})}))},e.redirectToCreateTransferWithFiles=ue,e.removeFileByPath=function(e,r,n){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:r,requested_files_by_path:n};return yield(new i.UserApiV2Client).ns("file_transfers").rpc("files/remove",t,{subjectUserId:e})}))},e.renameDuplicateFiles=G,e.setLocalStorageValueForKey=D,e.share=function(e,r){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:r};return yield(new i.UserApiV2Client).ns("file_transfers").rpc("share",t,{subjectUserId:e})}))},e.shouldShowTransferInSplitShare=fe,e.stateFileInfoAsFileInfo=j,e.transferFileAsStateFileInfo=P,e.updateMetadata=function(e,r,n,o,a,s){return t.__awaiter(this,void 0,void 0,(function*(){const t={transfer_id:r};return void 0!==n&&(t.expiration_time_update={".tag":"expiration_time",expiration_time:_(n)}),void 0!==a&&(t.password_update=""===a?{".tag":"no_password"}:{".tag":"password",password:a}),void 0!==o&&(t.should_notify_creator_on_download_update={".tag":"should_notify_creator_on_download",should_notify_creator_on_download:o}),void 0!==s&&(t.title_update=""===s?{".tag":"no_title"}:{".tag":"title",title:s}),yield(new i.UserApiV2Client).ns("file_transfers").rpc("update_metadata",t,{subjectUserId:e})}))},e.utils_esnext=_e}));
//# sourceMappingURL=c_file_transfers_lib_utils.js-vflPDlt-7.map
