define(["exports","./e_ui_page_files_router","./e_edison","./c_core_i18n","./c_react_query_api_helpers_queries_contacts","./c_react_query_api_helpers_queries_result_suggestions","./c_react_query_api_helpers_queries_search_experiments","metaserver/static/js/modules/constants/files_spa","./c_tslib","./c_apex-metrics_src_types","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_lodash-es_lodash","./c_core_notify","./c_core_uri","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/core/langpack","./c_react_query_api_helpers_helpers"],(function(e,s,t,o,g,i,n,u,r,a,S,l,h,d,c,p,m,_,y,I,R,L,w,D,T,O,f,Q,E,v,P,F,G,q,j,C,N,A,x,U,M){"use strict";class k extends t.React$1.PureComponent{constructor(){super(...arguments),this.dismissSuggestions=()=>{this.props.dismissAllSuggestions({query:this.props.normalizedQuery}),this.props.setHighlightedRow({index:void 0}),this.props.onFocusInput&&this.props.onFocusInput()},this.handleSuggestionClick=e=>{if(this.isInZeroStateDropdown()&&this.props.onSearchEnter&&!s.isPreviewableSuggestion(e)&&this.props.onSearchEnter(),s.isQuerySuggestion(e))s.logQuerySuggestionClicked(this.getGroupIndexOfSuggestion(e),this.props.querySuggestions,s.SuggestionSource.SUGGESTIONS_DROPDOWN),this.props.setQuery({query:e.query,alwaysTriggerSearch:!0});else if(s.isTagsSuggestion(e)){s.logTagSuggestionsClicked(this.getGroupIndexOfSuggestion(e),this.props.tagsSuggestions,void 0,s.SuggestionSource.SUGGESTIONS_DROPDOWN);const t=s.updateQueryWithTagsSuggestion(this.props.normalizedQuery,e.tag);this.props.setQuery({query:t,alwaysTriggerSearch:!0})}else if(s.isResultSuggestion(e)){if(this.props.resultSuggestionsForSearchArgs&&this.props.idToResultSuggestions){const t=this.props.idToResultSuggestions.get(e.resultId);t&&this.props.onResultSuggestionClick({result:t,resultList:s.immutable.exports.List(this.props.resultSuggestionsForSearchArgs)})}}else s.isRecentItemSuggestion(e)?this.props.onRecentItemSuggestionClick({url:e.url}):(s.logPeopleFilterClicked(this.getGroupIndexOfSuggestion(e),this.props.peopleSuggestions.length,void 0,s.SuggestionSource.SUGGESTIONS_DROPDOWN),this.props.setFilteredAccountId({filteredAccountId:e.id}),this.props.setQuery({query:"",alwaysTriggerSearch:!0}));s.isPreviewableSuggestion(e)||this.dismissSuggestions()},this.getGroupIndexOfSuggestion=e=>{for(const s of this.props.suggestions)for(let t=0;t<=s.suggestions.length;t+=1)if(s.suggestions[t]===e)return t}}componentDidMount(){var e,t;this.shouldLogQuerySuggestionsShown()&&s.logQuerySuggestionsDisplayed(this.props.querySuggestions,s.SuggestionSource.SUGGESTIONS_DROPDOWN),this.shouldLogPeopleSuggestionsShown()&&s.logPeopleFilterShown(this.props.peopleSuggestions.length,s.SuggestionSource.SUGGESTIONS_DROPDOWN),this.shouldLogTagsSuggestionsShown()&&s.logTagSuggestionsDisplayed(this.props.tagsSuggestions,s.SuggestionSource.SUGGESTIONS_DROPDOWN),this.shouldLogResultSuggestionsShown()&&s.logResultSuggestionsDisplayed(s.SuggestionSource.SUGGESTIONS_DROPDOWN,null!==(t=null===(e=this.props.resultSuggestionsForSearchArgs)||void 0===e?void 0:e.length)&&void 0!==t?t:0,this.props.resultSuggestionsRequestId)}componentDidUpdate(e){var t,o;!this.shouldLogQuerySuggestionsShown()||this.shouldLogQuerySuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||s.logQuerySuggestionsDisplayed(this.props.querySuggestions,s.SuggestionSource.SUGGESTIONS_DROPDOWN),!this.shouldLogPeopleSuggestionsShown()||this.shouldLogPeopleSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||s.logPeopleFilterShown(this.props.peopleSuggestions.length,s.SuggestionSource.SUGGESTIONS_DROPDOWN),!this.shouldLogTagsSuggestionsShown()||this.shouldLogTagsSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||s.logTagSuggestionsDisplayed(this.props.tagsSuggestions,s.SuggestionSource.SUGGESTIONS_DROPDOWN),!this.shouldLogResultSuggestionsShown()||this.shouldLogResultSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||s.logResultSuggestionsDisplayed(s.SuggestionSource.SUGGESTIONS_DROPDOWN,null!==(o=null===(t=this.props.resultSuggestionsForSearchArgs)||void 0===t?void 0:t.length)&&void 0!==o?o:0,this.props.resultSuggestionsRequestId)}shouldLogQuerySuggestionsShown(e=this.props){return e.querySuggestionsLoadingState===s.QuerySuggestionsLoadingState.LOADED&&this.shouldShowQuerySuggestions(e)}shouldLogPeopleSuggestionsShown(e=this.props){return e.peopleSuggestionsLoadingState===s.PeopleSuggestionsLoadingState.LOADED&&this.shouldShowPeopleSuggestions(e)}shouldShowQuerySuggestions({normalizedQuery:e,querySuggestions:s}=this.props){return!!e&&!!s&&!!s.length}shouldShowPeopleSuggestions({normalizedQuery:e,filteredAccountId:s,peopleSuggestions:t}=this.props){return!(!e||s||!t||!t.length||this.props.isPeopleSuggestionFromPeopleFilter)}shouldLogTagsSuggestionsShown(e=this.props){return e.tagsSuggestionsLoadingState===s.TagsSuggestionsLoadingState.LOADED&&this.shouldShowTagsSuggestions(e)}shouldShowTagsSuggestions({normalizedQuery:e,tagsSuggestions:t,manualTaggingVariant:o}=this.props){return s.isTaggingEnabled(o)&&!!s.normalizeForTagsSuggestions(e)&&!!t&&!!t.length}shouldShowResultSuggestions({normalizedQuery:e,resultSuggestionsForSearchArgs:s}=this.props){return!!e.length&&!!(null==s?void 0:s.length)}shouldLogResultSuggestionsShown(e=this.props){return e.resultSuggestionsLoadingState===s.ResultSuggestionsLoadingState.LOADED&&this.shouldShowResultSuggestions(e)}isInZeroStateDropdown(){return s.shouldUseZeroStateDropdown()}shouldShowDashCampaign(){return s.shouldShowDashCampaignInZeroStateDropdown()}shouldShowRecentItemSuggestions({recentItemSuggestions:e}=this.props){return((null==e?void 0:e.length)||0)>0}render(){const{suggestions:e,highlightedSuggestion:o,manualTaggingVariant:g,suggestionSectionOrder:i,normalizedQuery:n}=this.props,u=this.shouldShowQuerySuggestions(),r=this.shouldShowPeopleSuggestions(),a=this.shouldShowTagsSuggestions(),S=this.shouldShowResultSuggestions(),l=this.isInZeroStateDropdown()&&0===n.length&&this.shouldShowRecentItemSuggestions(),h=this.shouldShowDashCampaign()&&l;return u||r||a||S||l?t.React$1.createElement("div",{className:"search__dropdown"},t.React$1.createElement(s.SearchSuggestions,{suggestions:e,suggestionSectionOrder:i,onSuggestionClick:this.handleSuggestionClick,ariaLabel:"",highlightedSuggestion:o,showTagsSuggestions:s.isTaggingEnabled(g)})):h?t.React$1.createElement(s.CampaignSlot,{slotId:"top_search_dropdown"}):null}}k.displayName="SearchSuggestionsComponent";const b={setQuery:s.setQuery,setHighlightedRow:s.setHighlightedRow,setFilteredAccountId:s.setFilteredAccountId,dismissAllSuggestions:s.dismissAllSuggestions,onResultSuggestionClick:s.onResultSuggestionClick,onRecentItemSuggestionClick:s.onRecentItemSuggestionClick},z=s.connect((e=>({highlightedRow:s.highlightedRow(e),suggestionSectionOrder:s.suggestionSectionOrder(e),normalizedQuery:s.normalizedQuery(e),filteredAccountId:s.filteredAccountId(e),apiCommonFields:s.apiCommonFields(e),backups:s.backups(e),typeaheadSessionId:s.typeaheadSessionId(e),suggestions:s.suggestions(e),highlightedSuggestion:s.highlightedSuggestion(e),querySuggestions:s.querySuggestions(e)||[],peopleSuggestions:s.peopleSuggestions(e)||[],isPeopleSuggestionFromPeopleFilter:s.isPeopleSuggestionFromPeopleFilter(e),tagsSuggestions:s.tagsSuggestions(e)||[],resultSuggestionsForSearchArgs:s.resultSuggestionsForSearchArgs(e)||[],idToResultSuggestions:s.idToResultSuggestions(e),manualTaggingVariant:s.manualTaggingVariant$1(e),user:s.user$1(e),querySuggestionsLoadingState:s.querySuggestionsLoadingState(e),peopleSuggestionsLoadingState:s.peopleSuggestionsLoadingState(e),tagsSuggestionsLoadingState:s.tagsSuggestionsLoadingState(e),resultSuggestionsLoadingState:s.resultSuggestionsLoadingState(e),recentItemSuggestionsLoadingState:s.recentItemSuggestionsLoadingState(e)})),b),W=z(k),Z=e=>{var u;const{highlightedRow:r,normalizedQuery:a,peopleSuggestionsLoadingState:S,recentItemSuggestionsLoadingState:l,suggestionSectionOrder:h,tagsSuggestionsLoadingState:d,querySuggestionsLoadingState:c,resultSuggestionsLoadingState:p,backups:m,typeaheadSessionId:_}=e,y=s.mustGetActiveUser(),I=n.searchExperimentsRequestPackage.useQuery({}),R=n.formatSearchInputExperiments(null===(u=I.data)||void 0===u?void 0:u.experiments),L=R.manualTaggingVariant,w=s.shouldUseZeroStateDropdown(),D=w&&0===a.length,[T,O]=g.useContactsQueryBy(a,!0),[f,Q]=i.useZeroStatePeopleSuggestionQuery(w,i.PEOPLE_SUGGESTIONS_DROPDOWN_LIMIT),E=D?i.formatZeroPeopleSuggestionsLoadingState(f):g.formatPeopleSuggestionsLoadingState(T);let v,P=[];S&&S!==s.PeopleSuggestionsLoadingState.DISMISSED&&(P=D?Q:O,v={title:o.intl.formatMessage({id:"pEhPUj",defaultMessage:"People"}),suggestionSection:s.SuggestionSection.PEOPLE,suggestions:g.formatPeopleSuggestionsForSuggestionsDropdown(P,a)});const[F,G]=i.useTagsSuggestionsQueryBy(a,s.isTaggingEnabled(L)),[q,j]=i.useZeroStateTagsSuggestions(w),C=D?i.formatTagsSuggestionsLoadingState(q):i.formatTagsSuggestionsLoadingState(F);let N,A=[];d&&d!==s.TagsSuggestionsLoadingState.DISMISSED&&(A=D?j:G,N={title:o.intl.formatMessage({id:"OQYnUK",defaultMessage:"Tags"}),suggestionSection:s.SuggestionSection.TAGS,suggestions:i.formatTagsSuggestions(D?j:G)});const x=s.searchSessionManager.getSearchSessionId({searchSessionExtensionType:"PASSIVE"}),[U,M]=i.useQuerySuggestionsQueryBy(a,x,_),b=i.formatQuerySuggestionsLoadingState(U);let z,W=[];c&&c!==s.QuerySuggestionsLoadingState.DISMISSED&&(W=M,z={title:o.intl.formatMessage({id:"mH5jmX",defaultMessage:"Search suggestions"}),suggestionSection:s.SuggestionSection.QUERY,suggestions:i.formatQuerySuggestions(M)});const Z=Object.assign(Object.assign({},e.apiCommonFields),{searchSessionId:x,maxResults:s.MAX_SEARCH_RESULT_SUGGESTIONS_TO_FETCH,start:0,isDropdown:!0,isForResultSuggestions:!0,filenameOnly:!0,includeHighlights:!1,includeSnippets:!1,skipLogging:!0}),[H,V,$]=i.useResultSuggestionsQueryBy(Z,R),B=i.formatResultSuggestionsLoadingState(H);let X,Y=[],K=s.immutable.exports.Map();p&&p!==s.ResultSuggestionsLoadingState.DISMISSED&&(Y=V,K=s.immutable.exports.Map(Y.map((e=>[s.getIdForSearchResult(e),e]))),X={title:o.intl.formatMessage({id:"njcnFp",defaultMessage:"Results"}),suggestionSection:s.SuggestionSection.RESULT,suggestions:V.map((e=>{const t=null==m?void 0:m.find((t=>e instanceof s.File&&t.id===e.file_id));return i.formatResultSuggestion(e,t)}))});const J=[...e.suggestions];v&&J.push(v),N&&J.push(N),z&&J.push(z),X&&J.push(X);const[ee,se]=i.useRecentItemsQuery(y,w),te=i.formatRecentItemSuggestionsLoadingState(ee);let oe,ge=[];l&&l!==s.RecentItemSuggestionsLoadingState.DISMISSED&&(ge=se,oe={title:o.intl.formatMessage({id:"g0Mjyt",defaultMessage:"Recent files"}),suggestionSection:s.SuggestionSection.RECENT,suggestions:i.formatRecentItemSuggestions(se)});const ie=[];oe&&ie.push(oe),v&&ie.push(v),N&&ie.push(N);const ne=D?ie:J,ue=s.getHighlightedSuggestion(ne,r,h);return t.React$1.createElement(k,Object.assign({},e,{manualTaggingVariant:L,suggestions:ne,highlightedSuggestion:ue,peopleSuggestions:P,peopleSuggestionsLoadingState:E,tagsSuggestions:A,tagsSuggestionsLoadingState:C,querySuggestions:W,querySuggestionsLoadingState:b,resultSuggestionsForSearchArgs:Y,resultSuggestionsLoadingState:B,resultSuggestionsRequestId:$,recentItemSuggestions:ge,recentItemSuggestionsLoadingState:te,idToResultSuggestions:K}))},H=z(Z),V=s.shouldUseReactQueryForSearchInput()?H:W;e.ConnectedSearchSuggestions=V,e.ReactQuerySearchSuggestionsComponent=Z,e.SearchSuggestionsComponent=k}));
//# sourceMappingURL=c_single_page_input_suggestions.js-vflL3Ees_.map
