define(["exports","./c_tslib","./c_src_utils_logging","./e_ui_page_files_router","./c_sharing_ui_notifications_util","./c_share_modal_evolution_utils_logging","./c_core_browser_detection","./c_clipboard_v3"],(function(e,r,a,t,i,o,s,n){"use strict";var c,_;!function(e){e.SHARED_LINK_ALREADY_EXISTS="shared_link_already_exists",e.ACCESS_DENIED="access_denied",e.PATH="path",e.NOT_FOUND="not_found",e.EMAIL_NOT_VERIFIED="email_not_verified",e.SETTINGS_ERROR="settings_error",e.NOT_AUTHORIZED="not_authorized",e.UNDEFINED_ERROR="undefined_error"}(c||(c={})),function(e){e.CLIPBOARD_API="clipboard_api",e.EXEC_COMMAND="exec_command"}(_||(_={}));const u="sharing-notification",d=e=>{const{metadata:r}=e;n.copyToClipboard(r.url,(()=>{l(e,_.EXEC_COMMAND)}),(()=>{p(e)}))},l=(e,r)=>{const t=e.metadata?e.metadata.url:"";i.showCopyLinkSuccessSnackbar(t,g(e.metadata)),h({file:e.file,user:e.user,event:a.TiburonEventName.CopySharedLink,metadata:e.metadata,extras:{created_new_link:e.isNewlyCreated,copy_method:r},surfaceOrigin:e.userActionSource})},p=e=>{(e=>{if(navigator.clipboard){const r=e.metadata.url;navigator.clipboard.writeText(r).then((function(){l(e,_.CLIPBOARD_API)}),(function(){f(e)}))}else f(e)})(e)},f=e=>{const r=e.metadata?e.metadata.url:"";i.showCopyLinkErrorSnackbar(r,g(e.metadata)),h({file:e.file,user:e.user,event:a.TiburonEventName.CopySharedLinkFailure,metadata:e.metadata,extras:{error:"failed_copy_to_clipboard"},surfaceOrigin:e.userActionSource})},E=e=>e.file_id||e.fq_path,g=e=>{const r=e?e.link_permissions.link_access_level:void 0;let a="viewer";return r&&(a=r.hasOwnProperty(".tag")?r[".tag"]:r),a},h=({file:e,user:r,event:a,metadata:i,extras:n={},surfaceOrigin:c})=>{const _=c===t.ActionSourceValue.OVERFLOW_MENU?t.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU:t.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON,u=s.get_browser_info();t.ShareTibEventLogger.log(r.id,a,_,Object.assign(Object.assign(Object.assign({},o.buildExtraFromLinkMetadata(i)),{file_id:e.file_id,fq_path:e.fq_path,browser:u.browser,browser_version:u.version}),n))},O=({file:e,user:r,surfaceOrigin:t,exceptionType:i,httpCode:o})=>{h({file:e,user:r,event:a.TiburonEventName.FailCreateSharedLinkWithSettings,extras:{error_message:i,http_status_code:o,is_alpha:!1},surfaceOrigin:t}),h({file:e,user:r,event:a.TiburonEventName.CopySharedLinkFailure,extras:{error:i},surfaceOrigin:t})},S=e=>new t.FileShareApiClient({userId:e.id}),m=()=>{const e=document.createElement("input");e.value="sharing is caring",document.body.appendChild(e),e.select();const r=document.queryCommandEnabled("copy");return document.body.removeChild(e),r};function C(e,r,o){r(!1,E(e.file)),m()?d(e):i.showCopyLinkCTASnackbar(e.metadata.url,(()=>{(e=>{t.Snackbar.close(u),d(e)})(e)}),u,g(e.metadata));const s=e.isNewlyCreated?200:o&&o.raw&&o.raw.status;h({file:e.file,user:e.user,event:a.TiburonEventName.SucceedCreateSharedLinkWithSettings,metadata:e.metadata,extras:{created_new_link:e.isNewlyCreated,http_status_code:s,response_status:"success",is_alpha:!1},surfaceOrigin:e.userActionSource})}e.copyLink=function(e,a,t,o,s){s=s||{access:{".tag":"max"}},i.showCopyLinkProgressSupportedBrowserSnackbar();const n=E(a);t(!0,n),S(e).createSharedLinkNonAlpha({fileIdOrPath:n,settings:s}).then((r=>{C({file:a,user:e,metadata:r,isNewlyCreated:!0,userActionSource:o},t)})).catch((s=>r.__awaiter(this,void 0,void 0,(function*(){var r;if(s.error[".tag"]===c.SHARED_LINK_ALREADY_EXISTS){let i=null===(r=s.error.shared_link_already_exists)||void 0===r?void 0:r.metadata;if(!i){i=(yield S(e).sharedLinkInfo({fileIdOrPath:a.fq_path}))[0]}C({file:a,user:e,metadata:i,isNewlyCreated:!1,userActionSource:o},t,s)}else if(s.error[".tag"]===c.ACCESS_DENIED)t(!1,n),i.showCopyLinkNoPermissionSnackbar(),O({file:a,user:e,surfaceOrigin:o,exceptionType:s.error[".tag"],httpCode:s.raw&&s.raw.status});else if(s.error[".tag"]===c.SETTINGS_ERROR&&s.error.settings_error[".tag"]===c.NOT_AUTHORIZED)t(!1,n),i.showCopyLinkNoPermissionSnackbar(),O({file:a,user:e,surfaceOrigin:o,exceptionType:s.error.settings_error[".tag"],httpCode:s.raw&&s.raw.status});else if(s.error[".tag"]===c.PATH&&s.error.path[".tag"]===c.NOT_FOUND)t(!1,n),i.showCopyLinkNotFoundSnackbar(),O({file:a,user:e,surfaceOrigin:o,exceptionType:s.error.path[".tag"],httpCode:s.raw&&s.raw.status});else if(s.error[".tag"]===c.EMAIL_NOT_VERIFIED)t(!1,n),i.showCopyLinkEmailNotVerifiedSnackbar(),O({file:a,user:e,surfaceOrigin:o,exceptionType:s.error[".tag"],httpCode:s.raw&&s.raw.status});else{t(!1,n);const r=s.error[".tag"]?s.error[".tag"]:c.UNDEFINED_ERROR;i.showCopyLinkCatchallSnackbar(),O({file:a,user:e,surfaceOrigin:o,exceptionType:r,httpCode:s.raw&&s.raw.status})}}))))},e.isBrowserCopyEnabled=m}));
//# sourceMappingURL=c_file_actions_actions_share_copy_link.js-vfl6hgDQ6.map
