define(["exports","./e_ui_page_files_router","./e_edison","./c_tslib","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_notify","./c_core_i18n","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register"],(function(t,e,s,n,a,r,o,c,i,_,m,u,f,l,d,v,p,g,h,j,T,x,A,S,U,k,O,R,y,C,D,E,I,X,b,B,N){"use strict";const F="data-uxa-matcher-configs",J="data-uxa-variant-tokens",w="variants",M=",",G=":",V="https://dropbox.com/ux_analytics";let W=0;const q=(t=!1)=>{const s=(t,e)=>{const s=[],n=document.head.querySelectorAll(`meta[${t}]`);return n?(Array.prototype.forEach.call(n,(n=>{try{const a=n.getAttribute(t);if(!a)return;e?s.push(...JSON.parse(a)):s.push(a)}catch(t){}})),s):[]};if(t&&W>1||!t&&W)return;W++,(()=>{const t=e.getUXVariantsFromDOM();if(!t)return;const s=Q(t,"matchers"),n=[];for(const[t,e]of s){const s={feature_name:t,event_name:JSON.parse(e).event_name};n.push(s)}z({variant_tokens:t,matchers:n})})();const n=s(F,!0),a=s(J,!1);if(!n.length||!a.length)return;z({variant_tokens:a.join(M),matchers:n})},P=(t,e)=>{let s;s=t.startsWith("adobetarget")?"adobe_target_variants":"variants",e[s]?e[s]+=M+t:e[s]=t};const H=(t,e)=>{const s=t=>decodeURIComponent(escape(t)),[n,a,r]=t.split(".").map((t=>atob(t.split("_").join("/").split("-").join("+"))));if(!r)return;if("JWT"!==JSON.parse(s(n)).typ)return;const o=JSON.parse(s(a)),c=o[e];return o.iss===V?c:void 0},Q=(t,e)=>{const s=H(t,e),n=[];for(const t of s.split(M)){const e=t.split(G);2===e.length&&n.push(e.map(decodeURIComponent))}return n},$=t=>t.startsWith("adobetarget:")?(t=>{const e=t.split(M),s=[];for(const t of e)try{const[e,n,a]=t.split(G);s.push([e+G+decodeURIComponent(n),decodeURIComponent(a)])}catch(t){continue}return s})(t):Q(t,w);function z(t){if(!t)return;self._DBX_UX_variants_configStore=self._DBX_UX_variants_configStore||{};const e=self._DBX_UX_variants_configStore,{variant_tokens:s,matchers:n}=t;if(s)for(const t of s.split(M)){const s=$(t);if(s)for(const[n,a]of s)e.assignments=e.assignments||{},e.assignments[n]={variant:a,variantToken:t}}if(n)for(const t of n){e.matchers=e.matchers||{};const s=t.event_name;e.matchers[s]=e.matchers[s]||{};const n={feature_name:t.feature_name,event_name:s,is_pre_tti:t.is_pre_tti,like:t.like},a=JSON.stringify(n);e.matchers[s][a]=n}}t.ADOBE_TARGET_FEATURE_CONFIG_DATA_ATTRIBUTE=J,t.ADOBE_TARGET_MATCHER_CONFIG_DATA_ATTRIBUTE=F,t.DROPBOX_VARIANTS_ISSUER=V,t.addConfig=z,t.addConfigsFromDOM=q,t.addMatchedVariantsToEvent=function(t){const e=(t,e)=>void 0===t||((t,e)=>{if(void 0===t)return!0;const s=t;for(const t in s)if(String(e[t])!==String(s[t]))return!1;return!0})(t.extra,e.extra);if("undefined"==typeof self||!self)return;let s;q();const n=self._DBX_UX_variants_configStore,a={};if(t&&n&&n.matchers&&t.eventName&&(s=n.matchers[t.eventName]))for(const r in s){if(!n.assignments||!s.hasOwnProperty(r))continue;const o=s[r],c=n.assignments[o.feature_name];c&&(void 0===a[c.variantToken]&&e(o.like,t)&&(t.extra||(t.extra={}),P(c.variantToken,t.extra),a[c.variantToken]=!0))}},t.getVariant=function(t){const e=self._DBX_UX_variants_configStore;return(e&&e.assignments&&e.assignments[t]||{}).variant||"OFF"},t.parseJWTToDict=t=>{const e=H(t,w),s={};for(const t of e.split(M)){const e=t.split(G);2===e.length&&(s[decodeURIComponent(e[0])]=decodeURIComponent(e[1]))}return s},t.resetMetaTagConfigQueryCount=()=>{W=0}}));
//# sourceMappingURL=c_ux_analytics_ux_variants.js-vflXnjovg.map
