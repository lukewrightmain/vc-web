define(["exports","./e_ui_page_files_router","./e_edison","./c_core_i18n","./c_core_notify","./c_lodash-es_lodash"],(function(e,t,s,r,i,o){"use strict";class n extends s.React$1.Component{render(){return s.React$1.createElement("ul",{className:"tree-view__group",role:"group"},this.props.children)}}n.displayName="TreeGroupView";class a extends s.React$1.Component{constructor(){super(...arguments),this.handleClick=e=>{if(e.preventDefault(),e.stopPropagation(),this.props.item.disabled)return;const t=s.reactDom.exports.findDOMNode(this.refs.expandButton);t&&t.contains(e.target)||this.props.onClick&&this.props.onClick(this.props.item)},this.handleExpandClick=e=>{e.preventDefault(),this.props.onExpandButtonClick&&this.props.onExpandButtonClick(this.props.item,!this.props.isExpanded)}}renderExpandButton(){return s.React$1.createElement("div",{className:t.classnames("tree-view__expand-button",{"is-disabled":this.props.disabled}),onClick:this.handleExpandClick,ref:"expandButton",role:"button"},this.props.useDIGExpandButton?s.React$1.createElement(s.React$1.Fragment,null,!this.props.isExpanded&&s.React$1.createElement("div",{className:t.classnames("tree-view__expand-button-vertical",{"is-disabled":this.props.disabled})}),s.React$1.createElement("div",{className:t.classnames("tree-view__expand-button-horizontal",{"is-disabled":this.props.disabled})})):s.React$1.createElement(t.Sprite,{group:"web",name:this.props.isExpanded?"bullet_minus":"bullet_plus",alt:this.props.isExpanded?r.intl.formatMessage({id:"nPGI06",defaultMessage:"Collapse"}):r.intl.formatMessage({id:"mGnlBs",defaultMessage:"Expand"})}))}renderIcon(){const{item:e}=this.props,{icon:r,disabled:i}=e;return s.React$1.createElement("div",{className:"tree-view__icon-wrapper"},s.React$1.createElement(t.IconContent,{className:"tree-view__item-icon",name:t.convertLegacyFolderIconToSpectrum(r,"small"),disabled:i||this.props.disabled,height:19,width:19}))}render(){const e=!this.props.canExpand,r=t.classnames({"tree-view__item":!0,"tree-view__item--leaf":e}),i=this.props.canExpand&&!this.props.showAsHeader;return s.React$1.createElement("li",{key:this.props.item.key,id:this.props.id,className:r,onClick:this.handleClick,role:"treeitem","aria-disabled":this.props.item.disabled||this.props.disabled,"aria-label":this.props.item.label,"aria-level":this.props.level+1,"aria-selected":!!this.props.isSelected||void 0,"aria-expanded":i?this.props.isExpanded:void 0},s.React$1.createElement("span",{className:t.classnames({"tree-view__item-row":!0,"tree-view__item-row--disabled":this.props.item.disabled||this.props.disabled}),style:{paddingLeft:this.props.showAsHeader||!this.props.level?0:this.props.level*(this.props.useDIGExpandButton?24:15)}},this.props.showAsHeader||e?void 0:this.renderExpandButton(),this.props.item.icon?this.renderIcon():void 0,this.props.item.label?s.React$1.createElement("span",{className:"tree-view__item-label"},t.Emstring.em_snippet(this.props.item.label,20)):void 0),this.props.children)}}a.defaultProps={isSelected:!1,isExpanded:!1,canExpand:!1,level:0,onClick:o.noop,onExpandButtonClick:o.noop,showAsHeader:!1,useDIGExpandButton:!1,disabled:!1},a.displayName="TreeItemView";class l extends s.React$1.Component{renderIcon(){return this.props.useDIGIcon?s.React$1.createElement("div",{className:"tree-view__icon-wrapper"},s.React$1.createElement(t.IconContent,{className:"tree-view__item-icon",name:t.convertLegacyFolderIconToSpectrum(this.props.item.icon,"small"),disabled:!0})):this.props.item.icon?s.React$1.createElement(t.Sprite,{className:"tree-view__header-icon",group:"web",name:this.props.item.icon,alt:""}):null}render(){return s.React$1.createElement("div",{className:t.classnames("tree-view__item-row","tree-view__item-row--disabled")},this.renderIcon(),s.React$1.createElement("h3",{className:"tree-view__header",id:this.props.id},this.props.item.label))}}l.displayName="TreeHeaderView";class d extends s.React$1.Component{constructor(){super(...arguments),this.state={selectedItemKey:this.props.defaultSelectedPath?this.props.defaultSelectedPath:null,expandedItemKeys:t.immutable.exports.Set([this.props.tree.rootItem.key]),showFocused:!1},this.selectItem=e=>{this.props.disabled||(this.setState({selectedItemKey:null!=e&&e.key?e.key:null}),this.props.onItemSelected(e))},this.handleExpandButtonClick=(e,t)=>{this.setState({expandedItemKeys:this.setItemExpanded(e.key,t)}),this.props.onItemExpanded(e,t)},this.handleKeyDown=e=>{switch(e.key){case t.Key_enum.Key.ArrowUp:this.advanceSelection(!0)&&e.preventDefault();break;case t.Key_enum.Key.ArrowDown:this.advanceSelection(!1)&&e.preventDefault();break;case t.Key_enum.Key.ArrowRight:if(null!=this.state.selectedItemKey){const t=this.props.tree.items.get(this.state.selectedItemKey);this.canItemExpand(t)&&(this.handleExpandButtonClick(t,!0),e.preventDefault())}break;case t.Key_enum.Key.ArrowLeft:if(this.state.selectedItemKey){const t=this.props.tree.items.get(this.state.selectedItemKey);this.canItemExpand(t)&&(this.handleExpandButtonClick(t,!1),e.preventDefault())}}},this.rootRef=s.React$1.createRef(),this.handleOnFocus=()=>this.setState({showFocused:!0}),this.handleOnBlur=()=>this.setState({showFocused:!1})}UNSAFE_componentWillReceiveProps(e){e.resetSelectedItem&&e.resetSelectedItem!==this.props.resetSelectedItem&&this.setState({selectedItemKey:null})}componentDidUpdate(e,t){if(this.state.selectedItemKey&&this.state.selectedItemKey!==t.selectedItemKey&&this.rootRef.current){const e=this.rootRef.current,t=e.querySelector('[aria-selected="true"]');t&&this.scrollElementIntoViewIfNeeded(t,e)}}scrollElementIntoViewIfNeeded(e,t){const s=t.getBoundingClientRect(),r=e.getBoundingClientRect();if(e.offsetTop-t.scrollTop<0)return void e.scrollIntoView(!0);const i=s.height,o=t.scrollTop+i,n=r.height;e.offsetTop+n>o&&n<i&&e.scrollIntoView(!1)}hasSelectableRootItem(){const{rootStyle:e}=this.props;return e===t.RootStyle.TreeItem||e===t.RootStyle.HeaderItem}getHTMLIdPrefix(){return this.HTMLIdPrefix||(this.HTMLIdPrefix=`tree-view-${Math.floor(16777215*Math.random()).toString(16)}`)}getLastLeafOf(e){const t=this.props.tree.getChildItems(e);return this.state.expandedItemKeys.contains(e.key)&&null!=t&&t.size>0?this.getLastLeafOf(t.last()):e}getPrevItem(e){if(!e)return null;const t=this.props.tree.getParentItem(e);if(!t)return null;const s=this.props.tree.getChildItems(t),r=s.indexOf(e);if(r>0)return this.getLastLeafOf(s.get(r-1));if(0===r){return t===this.props.tree.rootItem&&!this.hasSelectableRootItem()?null:t}return null}getNextItem(e,t=!0){if(!e)return null;const s=this.state.expandedItemKeys.contains(e.key)&&this.props.tree.isParent(e);if(t&&s)return this.props.tree.getChildItems(e).first();const r=this.props.tree.getParentItem(e);if(!r)return null;const i=this.props.tree.getChildItems(r),o=i.size-1,n=i.indexOf(e);return n===o?this.getNextItem(r,!1):0<=n&&n<o&&i.get(n+1)||null}advanceSelection(e=!1){if(!this.state.selectedItemKey){let e;if(this.hasSelectableRootItem())e=this.props.tree.rootItem;else{const t=this.props.tree.getChildItems(this.props.tree.rootItem);e=t?t.first():null}return this.selectItem(e),!0}const t=this.props.tree.items.get(this.state.selectedItemKey),s=e?this.getPrevItem(t):this.getNextItem(t);return!!s&&(this.selectItem(s),!0)}getValidHTMLIdForItem(e){return`${this.getHTMLIdPrefix()}${e.key}`.replace(/\s+/g,"_")}setItemExpanded(e,t){return t?this.state.expandedItemKeys.add(e):this.state.expandedItemKeys.delete(e)}canItemExpand(e){return e&&(e.canExpand||this.props.tree.isParent(e))}renderSingleItem(e,t,r,i={}){const o=Object.assign({id:this.getValidHTMLIdForItem(e),key:e.key,item:e,isSelected:this.state.selectedItemKey===e.key,isExpanded:this.state.expandedItemKeys.contains(e.key)||e.forceExpanded,canExpand:this.canItemExpand(e)&&!e.forceExpanded,level:t,onClick:this.selectItem,onExpandButtonClick:this.handleExpandButtonClick},i),n=this.props.treeItemView;return s.React$1.createElement(n,Object.assign({},o),r)}renderItemAndDescendants(e,t){let s;const r=this.state.expandedItemKeys.contains(e.key)||e.forceExpanded;return this.props.tree.isParent(e)&&r&&(s=this.renderChildrenOfItemAsGroup(e,t+1)),this.renderSingleItem(e,t,s,{useDIGExpandButton:this.props.useDIGExpandButton,disabled:this.props.disabled})}renderChildrenOfItemAsGroup(e,t){if(!e||!this.props.tree.isParent(e))return null;const r=this.props.tree.getChildItems(e).map((e=>this.renderItemAndDescendants(e,t)));return s.React$1.createElement(n,null,r.toJS())}render(){let e,r,i;const{rootItem:o}=this.props.tree;if(this.props.rootStyle===t.RootStyle.TreeItem)r=s.React$1.createElement(n,null,this.renderItemAndDescendants(o,0));else if(this.props.rootStyle===t.RootStyle.HeaderItem)e=this.getValidHTMLIdForItem(o),r=s.React$1.createElement(n,null,this.renderSingleItem(o,0,null,{showAsHeader:!0,id:e,disabled:this.props.disabled}),this.renderChildrenOfItemAsGroup(o,0));else if(this.props.rootStyle===t.RootStyle.StaticHeader)e=this.getValidHTMLIdForItem(o),r=s.React$1.createElement(n,null,s.React$1.createElement(l,{item:o,id:e,useDIGIcon:this.props.useDIGExpandButton}),this.renderChildrenOfItemAsGroup(o,0));else{if(this.props.rootStyle!==t.RootStyle.None)throw new Error(`Unknown root style: ${this.props.rootStyle}`);r=this.renderChildrenOfItemAsGroup(this.props.tree.rootItem,0)}if(this.props.defaultSelectedPath?this.state.selectedItemKey&&this.state.selectedItemKey in this.props.tree.items:this.state.selectedItemKey){const e=this.props.tree.items.get(this.state.selectedItemKey);i=this.getValidHTMLIdForItem(e)}return s.React$1.createElement("div",{role:"tree",tabIndex:0,onFocus:this.handleOnFocus,onBlur:this.handleOnBlur,className:t.classnames("tree-view","ax-focusable",{"is-focused":this.state.showFocused&&!this.props.disabled,"is-disabled":this.props.disabled}),"aria-labelledby":e||void 0,"aria-activedescendant":i,onKeyDown:this.handleKeyDown,ref:this.rootRef},r,this.props.children)}}d.defaultProps={rootStyle:t.RootStyle.None,onItemSelected:e=>{},onItemExpanded:(e,t)=>{},treeItemView:a,defaultSelectedPath:"",useDIGExpandButton:!1,disabled:!1},d.displayName="TreeViewWithoutCSS";const p=t.requireCssWithComponent(d,["/static/metaserver/static/css/react/tree_view-vfl59yfhc.css","/static/metaserver/static/css/accessibility-vfliGZNRm.css"]);var c;e.RootIcon=void 0,(c=e.RootIcon||(e.RootIcon={})).BRIEFCASE="s_briefcase",c.HOUSE="s_house",c.DROPBOX="dropbox",c.TEAM="folder_team";const h=e=>new t.FolderTreeItem({key:e.path,label:t.filename(e.path),canExpand:e.has_subdirs,icon:e.icon,disabled:e.read_only},e.contained_ns);class m extends s.React$1.Component{constructor(){super(...arguments),this._pendingAjaxRequest=null,this._pendingAjaxRequestAbortController=null,this.state={showLoadingScreen:!1,tree:t.Tree.createWithRootItem(new t.TreeItem({key:"/",icon:this.props.rootIcon,label:this.props.treeRootName}))},this.asyncFetchSubFoldersForItem=e=>{var t;const r=e===this.state.tree.rootItem;r&&this.setState({showLoadingScreen:!0}),this._pendingAjaxRequest&&(null===(t=this._pendingAjaxRequestAbortController)||void 0===t||t.abort()),this._pendingAjaxRequestAbortController=new AbortController,this._pendingAjaxRequest=this.props.mkAjaxRequest(e.key,this._pendingAjaxRequestAbortController.signal),Promise.resolve(this._pendingAjaxRequest).then((t=>{const s=this.parseFolderList(t),r=this.state.tree.setChildItems(e,s);this.setState({tree:r})})).catch(this.props.handleError).then((()=>{if(null==this._pendingAjaxRequest)return;this._pendingAjaxRequest=null,r&&(this.props.isLoadingAdditionalData||this.setState({showLoadingScreen:!1}));const e=s.reactDom.exports.findDOMNode(this.refs.treeView);e&&e.focus()}))},this.handleItemSelected=e=>{null!==e&&(e instanceof t.FolderTreeItem?this.props.onFolderSelected(e.key,e.folderNsId,e.icon):this.props.onFolderSelected(e.key,void 0,e.icon))},this.handleExpandButtonClick=(e,t)=>{t&&!this.state.tree.isParent(e)&&this.asyncFetchSubFoldersForItem(e)},this.renderLoadingMessage=()=>s.React$1.createElement("span",{className:"tree-view__loading-label"},r.intl.formatMessage({id:"9fef95",defaultMessage:"Loading your foldersâ€¦"}))}componentDidMount(){this.asyncFetchSubFoldersForItem(this.state.tree.rootItem)}UNSAFE_componentWillReceiveProps(e){e.isLoadingAdditionalData||e.isLoadingAdditionalData===this.props.isLoadingAdditionalData||this.setState({showLoadingScreen:!1})}componentWillUnmount(){var e;this._pendingAjaxRequest&&(null===(e=this._pendingAjaxRequestAbortController)||void 0===e||e.abort(),this._pendingAjaxRequest=null)}parseFolderList(e){return e.map(h)}render(){const e=this.props.isRootSelectable?t.RootStyle.HeaderItem:t.RootStyle.StaticHeader;return s.React$1.createElement(p,{ref:"treeView",tree:this.state.tree,rootStyle:e,onItemSelected:this.handleItemSelected,onItemExpanded:this.handleExpandButtonClick,resetSelectedItem:this.props.resetSelectedItem,defaultSelectedPath:this.props.defaultSelectedPath,useDIGExpandButton:this.props.useDIGExpandButton,disabled:this.props.disabled},this.state.showLoadingScreen?this.renderLoadingMessage():void 0)}}m.defaultProps={onFolderSelected:(e,t,s)=>{},handleError(e){i.Notify.error(r.intl.formatMessage({id:"dFFA0Z",defaultMessage:"An error occurred while trying to load your folder."}))}},m.displayName="AbstractFolderTreeView";class u extends m{}class I extends m{parseFolderList(e){let t=e;this.props.folderToHide&&(t=e.filter((e=>e.path!==this.props.folderToHide)));let s=-1;const r=t.map(((e,t)=>{const r=e.path;return this.props.pinnedFolder&&r===this.props.pinnedFolder&&(s=t),h(e)}));if(-1!==s){const e=r[s];r.splice(s,1),r.unshift(e)}return r}}function f(e,s,r){const i={folder:s};return t.WebRequestOref({url:"/browse_util/tree_view_folders",type:"POST",subject_user:e,data:i,dataType:"json",signal:r})}e.FolderTreeView=u,e.PinnedFolderTreeView=I,e.UserFolderTreeView=function(t){const r=t.mkAjaxRequest||((e,s)=>f(t.user.id,e,s)),i=t.forceRootSelectable||"edit"===t.user.user_root_permissions,o=t.is_paired?t.user.is_team?e.RootIcon.BRIEFCASE:e.RootIcon.HOUSE:e.RootIcon.DROPBOX,n=Object.assign(Object.assign({},t),{mkAjaxRequest:r,isRootSelectable:i,rootIcon:o});if(t.user.is_cdm_member){const e=t.user.cdm_tmf_path;return s.React$1.createElement(I,Object.assign({},n,{pinnedFolder:e}))}return s.React$1.createElement(u,Object.assign({},n))},e.browseGetFolder=f}));
//# sourceMappingURL=c_ui_tree_view.js-vflVJ1kRB.map
