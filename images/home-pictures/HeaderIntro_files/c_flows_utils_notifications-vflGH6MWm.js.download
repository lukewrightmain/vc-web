define(["exports","./e_edison","./c_core_i18n","./c_flows_utils_browse_logger","./c_tslib","./c_flows_lib_api","./c_flows_hooks_workflow_builder_hooks","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","./e_ui_page_files_router","metaserver/static/js/modules/constants/files_spa","./c_core_notify","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","./c_src_common_constants","./c_flows_logging_flows_loggers","./c_data_action_creators_index","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_history","./c_ux_analytics_dispatch_custom_event","./c_browse_crypto_subtle_digest","./c_flows_redux_selectors","./c_flows_constants","./c_flows_redux_reducer","./c_workflow_builder_workflow_actions_action_ui_config","./c_ui-icon_line_audio","./c_ui-icon_line_arrow-right","./c_ui-icon_line_zip","./c_truncate_index","./c_controls_index","./c_form_row_index","./c_ui-icon_line_image","./c_ui-icon_line_edit","./c_ui-icon_line_move","./c_ui_tree_view","./c_components_spacer_index","./c_ui-icon_line_add-folder","./c_ui-icon_line_cursor","./c_naming_conventions_utils","./c_ui-icon_line_tag","./c_tagging_components_tags_container","./c_components_item_truncation_container","./c_hooks_resize_observer","./c_resize-observer-polyfill_dist_ResizeObserver","./c_tagging_components_tags_search","./c_typeahead_index","./c_modal_filters_view_tidy_filters","./c_ui-icon_line_delete","./c_folder_dialog_folder_picker_dig","./c_table_columns_file_name_column","./c_src_table","./c_ui-icon_line_arrow-down","./c_ui-icon_line_arrow-up","./c_react-table_index","./c_src_icons_file_icon","./c_src_icons_file_icon_extensions","./c_combinations_index","./c_spectrum_icon_arrow_index","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_keymaster","./c_browse_interface","./c_breadcrumb_index","./c_ui-icon_line_more-horizontal","./c_flows_redux_actions","./c_flows_redux_store","./c_ui_hoc","./c_ui-icon_line_stamp","./c_plugin_utils_tilingFunc","./c_plugin_utils_getImageDefaultSizes"],(function(e,t,s,n,a,i,c,o,l,r,_,u,d,g,f,m,p,h,b,v,w,x,k,j,y,M,S,L,q,C,F,P,O,z,B,N,T,I,U,A,R,D,G,K,X,$,E,J,Q,V,Y,H,W,Z,ee,te,se,ne,ae,ie,ce,oe,le,re,_e,ue,de,ge,fe,me,pe,he,be,ve,we,xe,ke,je,ye,Me,Se,Le,qe,Ce,Fe,Pe,Oe,ze,Be,Ne,Te,Ie,Ue,Ae,Re,De,Ge){"use strict";function Ke({creates:e,moves:t}){return a.__awaiter(this,void 0,void 0,(function*(){const{closeLabel:a,undoProgressLabel:c,undoSuccessLabel:o,undoFailLabel:l}={closeLabel:s.intl.formatMessage({id:"xB3cXP",defaultMessage:"Close"}),undoProgressLabel:e=>s.intl.formatMessage({id:"CdBI55",defaultMessage:"Undoing {count, plural, one {# change} other {# changes}}..."},{count:e}),undoSuccessLabel:e=>s.intl.formatMessage({id:"k+8Dk9",defaultMessage:"{count, plural, one {# change} other {# changes}} undone."},{count:e}),undoFailLabel:s.intl.formatMessage({id:"026V5B",defaultMessage:"Couldn't undo some changes."})},r=e.length+t.length;n.updateSnackbar({variant:"sync",title:c(r)});try{for(let s=0;s<r;s+=32){const n=s+32,a=t.slice(s,n),c=e.slice(Math.max(0,s-t.length),Math.max(0,n-t.length));yield i.undoActions(c,a)}n.updateSnackbar({variant:"complete",title:o(r),closeButtonText:a})}catch(e){n.updateSnackbar({variant:"fail",title:l,closeButtonText:a})}}))}const Xe=e=>{var t,s;return null!==(s=null===(t=e.template)||void 0===t?void 0:t.join(","))&&void 0!==s?s:e.action_type},$e=e=>{var t;if("list_directory"===(null===(t=e.template)||void 0===t?void 0:t[0])&&e.seq_index>0){const[,...t]=e.template;return Object.assign(Object.assign({},e),{template:t,seq_index:e.seq_index-1})}return e};function Ee(e,t,s,a){const i=e.filter((e=>"start"===e.status)),c=e.filter((e=>"success"===e.status)),o=e.filter((e=>"fail"===e.status)),{undoLabel:l}=Qe(),r=t.notifications;if(!r)return;const _=()=>{if(!r.allowUndo)return{};const e=function(e){const t=e.filter((e=>!!e.created_fq_path)).map((e=>({created_fq_path:e.created_fq_path}))),s=e.filter((e=>!!e.input_fq_path&&!!e.moved_fq_path)).map((e=>({input_fq_path:e.input_fq_path,moved_fq_path:e.moved_fq_path})));return{creates:t,moves:s,length:t.length+s.length}}(c);return e.length>0?{actionButtonText:l,onActionClick:()=>{s(),Ke(e).then((()=>{if(a){const t=e.creates.map((e=>e.created_fq_path)).filter((e=>void 0!==e));a(t)}}))}}:{}};i.length?n.updateSnackbar({variant:"sync",title:r.inProgress(c.length,e.length)}):c.length===e.length?n.updateSnackbar(Object.assign({variant:"complete",title:r.success(c.length),onCloseClick:s},_())):o.length===e.length?n.updateSnackbar({variant:"fail",title:r.fail(o.length),onCloseClick:s}):n.updateSnackbar(Object.assign({variant:"complete",title:`${r.success(c.length)} ${r.fail(o.length)}`,onCloseClick:s},_()))}function Je(e,t){const s=Math.max(...e.filter((e=>"start"!==e.status)).map((e=>e.seq_index))),a=e[0].template.length,i=e.filter((e=>"start"===e.status)),c=e.filter((e=>"success"===e.status&&e.seq_index===s)),o=e.filter((e=>"fail"===e.status)),{genericInProgressLabel:l,genericSuccessLabel:r,genericPartialSuccessLabel:_,genericFailLabel:u,genericFailShortLabel:d}=Qe();if(i.length)return void n.updateSnackbar({variant:"sync",title:l});const g=[];c.length&&g.push(s===a-1?r(c.length):_(c.length,s)),o.length&&g.push(g.length?d(o.length):u(o.length)),n.updateSnackbar({variant:o.length===e.length?"fail":"complete",title:g.join(" "),onCloseClick:t})}function Qe(){return{undoLabel:s.intl.formatMessage({id:"T3e7p+",defaultMessage:"Undo"}),genericInProgressLabel:s.intl.formatMessage({id:"z9caOT",defaultMessage:"Running your workflow..."}),genericSuccessLabel:e=>s.intl.formatMessage({id:"GKRi8G",defaultMessage:"{numFiles, plural, one {# file} other {# files}} successfully processed through your workflow."},{numFiles:e}),genericPartialSuccessLabel:(e,t)=>s.intl.formatMessage({id:"5Xqmt+",defaultMessage:"{numFiles, plural, one {# file} other {# files}} processed through step {stepNumber} of your workflow."},{numFiles:e,stepNumber:t+1}),genericFailLabel:e=>s.intl.formatMessage({id:"qBnJKQ",defaultMessage:"{numFiles, plural, one {# file} other {# files}} failed to be processed through your workflow."},{numFiles:e}),genericFailShortLabel:e=>s.intl.formatMessage({id:"0aYwb/",defaultMessage:"{numFiles, plural, one {# file} other {# files}} failed."},{numFiles:e})}}e.handleMultiStepNotification=Je,e.handleSingleStepNotification=Ee,e.preprocessPayload=$e,e.useFlowsNotifications=function(e){const[s,n]=t.react.exports.useState([]),{uiConfig:a}=c.useActionUiConfig(),i=t.react.exports.useCallback((e=>{n((t=>[...t,$e(e)]))}),[]),o=t.react.exports.useCallback((()=>n([])),[]),l=t.react.exports.useCallback((t=>{const s=a.find((e=>e.type===t[0].action_type));(null==s?void 0:s.notifications)&&Ee(t,s,o,e)}),[a,o]),r=t.react.exports.useCallback((e=>{Je(e,o)}),[o]);return t.react.exports.useEffect((()=>{if(!s.length)return;const e=s[s.length-1],t=Xe(e),n=Object.values(s.filter((e=>Xe(e)===t)).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.revkey]:t})),{}));e.template&&e.template.length>1?r(n):l(n)}),[s,o,a,r,l]),{handlePayload:i,clearPayloads:o}}}));
//# sourceMappingURL=c_flows_utils_notifications.js-vfl2YqeGG.map
