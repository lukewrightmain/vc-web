define(["require","exports","./e_edison","./e_ui_page_files_router","./c_components_spacer_index","./c_form_row_index","./c_src_common_constants","./c_tslib","./c_flows_approval_approval_io_client","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_notify","./c_core_i18n","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","./c_typeahead_index","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments"],(function(e,t,o,a,n,s,i,r,c,l,d,u,g,v,_,m,f,p,S,w,h,E,N,L,x,y,C,j,I,M,b,V,F,P,R,k,A,$,T,U,O,B,D,G,H,Y,z){"use strict";const J=({utcTsInSeconds:e,lastModifiedAccountId:t,actorAccountId:n,chanegLog:s,lastModifiedDisplayName:i})=>{const{getChangeLogLastEditEmptyYou:r,getChangeLogLastEditEmpty:c,getChangeLogLastEditYou:l,getChangeLogLastEdit:d}=function(){const e=a.useIntl();return{getChangeLogLastEditEmptyYou:t=>e.formatMessage({id:"NE+Q9p",defaultMessage:"Deleted {time_ago} by you"},{time_ago:t}),getChangeLogLastEditEmpty:(t,o)=>e.formatMessage({id:"9Su1jP",defaultMessage:"Deleted {time_ago} by {name}"},{time_ago:t,name:o}),getChangeLogLastEditYou:t=>e.formatMessage({id:"di1Nt/",defaultMessage:"Updated {time_ago} by you"},{time_ago:t}),getChangeLogLastEdit:(t,o)=>e.formatMessage({id:"RvVNS+",defaultMessage:"Updated {time_ago} by {name}"},{time_ago:t,name:o})}}(),u=a.useIntl();return o.React$1.createElement(a.Text,{size:"small",color:"faint"},(()=>{const o=((e,t=!0)=>a.timeSince(u,e,{displayLocation:"label",displayContext:t?"standalone":"sentence-middle"}))(1e3*e,!1);return s?t==n?l(o):d(o,i):t==n?r(o):c(o,i)})())};J.displayName="ChangeLogLastEdit";a.injectInternalStyle("typescript/component_libraries/flows/src/components/change-log-section/index.module.out.css",(e=>"._version-change-log-section_1dn6j_1{display:flex;flex-direction:column;padding-top:20px}._version-change-log-section__text_1dn6j_7{overflow-wrap:break-word}._version-change-log-section__new-badge_1dn6j_11{margin-left:4px}"));const q="_version-change-log-section_1dn6j_1",Q="_version-change-log-section__text_1dn6j_7",Z="_version-change-log-section__new-badge_1dn6j_11",W=({changeLog:e,onSubmit:t,actorAccountId:r,onFocusEditor:c})=>{const{changeLogPlaceholder:l,title:d,textAreaArialLabel:u,newBadge:g}=function(){const e=a.useIntl();return{changeLogPlaceholder:e.formatMessage({id:"bdH2FW",defaultMessage:"Comment on changes to this version"}),title:e.formatMessage({id:"9wusT9",defaultMessage:"Version notes"}),textAreaArialLabel:e.formatMessage({id:"JJHGYJ",defaultMessage:"The input area of the version note"}),newBadge:e.formatMessage({id:"1wc7dy",defaultMessage:"New"})}}(),[v,_]=o.react.exports.useState(!1),[m,f]=o.react.exports.useState(null),p=o.react.exports.useRef(null);o.react.exports.useEffect((()=>{var t,o,a;if(v&&(null===(t=p.current)||void 0===t||t.focus(),null==e?void 0:e.text)){const t=null===(o=null==e?void 0:e.text)||void 0===o?void 0:o.length;null===(a=p.current)||void 0===a||a.setSelectionRange(t,t)}}),[v]);const S=()=>{c(),_(!0)};if(!e)return null;const{text:w,last_modified_user:h,last_modified_ts_in_seconds:E,last_modified_user_display_name:N}=e;return o.React$1.createElement("div",{className:q},o.React$1.createElement(a.Text,{isBold:!0,size:"small"},d,o.React$1.createElement(a.AccessoryBadge,{className:Z},g)),o.React$1.createElement(n.Spacer,null),v?o.React$1.createElement(o.React$1.Fragment,null,o.React$1.createElement(a.TextArea,{value:null!=m?m:null==e?void 0:e.text,rows:1,"aria-label":u,resizable:"auto",onChange:e=>{e.currentTarget.value.length<=i.CHANGE_LOG_SIZE_LIMIT&&f(e.currentTarget.value)},onBlur:()=>{null!=m&&m!=(null==e?void 0:e.text)&&(t(m),f(null)),_(!1)},ref:p}),o.React$1.createElement(s.FormHelperText,{alignRight:!0},null!==(C=null!==(x=null==m?void 0:m.length)&&void 0!==x?x:null===(y=null==e?void 0:e.text)||void 0===y?void 0:y.length)&&void 0!==C?C:0,"/",i.CHANGE_LOG_SIZE_LIMIT)):null!=w&&o.React$1.createElement(o.React$1.Fragment,null,(L=w,o.React$1.createElement(a.Text,{className:Q,size:"small",color:L?"standard":"faint",onClick:S},L||l)),o.React$1.createElement(n.Spacer,null),h&&E&&w&&o.React$1.createElement(J,{utcTsInSeconds:E,lastModifiedAccountId:h,actorAccountId:r,chanegLog:w,lastModifiedDisplayName:null!=N?N:""})));var L,x,y,C};W.displayName="ChangeLogSection";const K=(()=>{let t;return{getOrLoadPapEvents:()=>r.__awaiter(void 0,void 0,void 0,(function*(){return t||(t=yield new Promise((function(t,o){e(["./c_flows_logging_version_logging_events"],t,o)}))),t}))}})(),X="version_modal",ee="version_note_section",te="flows-version-control-snackbar",oe=({fileId:e,user:t,previewSurface:n})=>{const{versionNoteChanged:s,versionNoteCanNotSave:i}=function(){const e=a.useIntl();return{versionNoteChanged:e.formatMessage({id:"Buh8fs",defaultMessage:"File version notes changed."}),versionNoteCanNotSave:e.formatMessage({id:"4QU8UF",defaultMessage:"Couldn't save your change."})}}(),[l,d]=o.react.exports.useState();o.react.exports.useEffect((()=>{(function(e,t){const o={file_id:e};return(new a.UserApiV2Client).ns("flows").rpc("version/get",o,{subjectUserId:t})})(e,t.id).then((e=>{var t;d(null===(t=e.version)||void 0===t?void 0:t.change_log)}))}),[e]);const u={logSaveNewVersionClick:(e,t,o)=>r.__awaiter(void 0,void 0,void 0,(function*(){const n=yield K.getOrLoadPapEvents();a.logEvent(n.Select_SaveNewVersionButton({actionSurface:e,fileId:t,previewsSurface:o?c.getPreviewsSurfaceFromString(o):void 0}))})),logSaveNewVersionModalShown:(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){const o=yield K.getOrLoadPapEvents();a.logEvent(o.Shown_SaveNewVersionModal({actionSurface:X,fileId:e,previewsSurface:t?c.getPreviewsSurfaceFromString(t):void 0}))})),logSaveNewVersionNoteFill:(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){const o=yield K.getOrLoadPapEvents();a.logEvent(o.Fill_SaveNewVersionNoteInput({actionSurface:X,fileId:e,previewsSurface:t?c.getPreviewsSurfaceFromString(t):void 0}))})),logSaveNewVersionModalSaveClick:(e,t,o,n)=>r.__awaiter(void 0,void 0,void 0,(function*(){const s=yield K.getOrLoadPapEvents();a.logEvent(s.Select_SaveNewVersionModalSaveButton({actionSurface:X,fileId:e,previewsSurface:n?c.getPreviewsSurfaceFromString(n):void 0,versionNameChanged:t,versionNoteFilled:o}))})),logVersionNoteUpdateClick:(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){const o=yield K.getOrLoadPapEvents();a.logEvent(o.Select_UpdateVersionNote({actionSurface:ee,fileId:e,previewsSurface:t?c.getPreviewsSurfaceFromString(t):void 0}))})),logVersionNoteSectionClick:(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){const o=yield K.getOrLoadPapEvents();a.logEvent(o.Select_VersionNoteSection({actionSurface:ee,fileId:e,previewsSurface:t?c.getPreviewsSurfaceFromString(t):void 0}))})),logSaveNewVersionSucceed:(e,t,o,n)=>r.__awaiter(void 0,void 0,void 0,(function*(){const s=yield K.getOrLoadPapEvents();a.logEvent(s.Succeed_SaveNewVersion({actionSurface:X,fileId:e,previewsSurface:n?c.getPreviewsSurfaceFromString(n):void 0,versionNameChanged:t,versionNoteFilled:o}))})),logVersionNoteUpdateSucceed:(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){const o=yield K.getOrLoadPapEvents();a.logEvent(o.Succeed_UpdateVersionNote({actionSurface:ee,fileId:e,previewsSurface:t?c.getPreviewsSurfaceFromString(t):void 0}))})),logVersionFilenameChange:(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){const o=yield K.getOrLoadPapEvents();a.logEvent(o.Change_SaveNewVersionFilenameInput({actionSurface:X,fileId:e,previewsSurface:t?c.getPreviewsSurfaceFromString(t):void 0}))}))};return o.React$1.createElement(W,{actorAccountId:t.account_id,onSubmit:o=>{u.logVersionNoteUpdateClick(e,n),d({text:o,last_modified_user:t.account_id,last_modified_ts_in_seconds:(new Date).getTime()/1e3}),function(e,t,o){const n={file_id:e,change_log:t};return(new a.UserApiV2Client).ns("flows").rpc("version/update",n,{subjectUserId:o})}(e,o,t.id).then((t=>{var o;(null===(o=t.version)||void 0===o?void 0:o.change_log)&&d(t.version.change_log),u.logVersionNoteUpdateSucceed(e,n),a.Snackbar.complete(s,te)})).catch((()=>{a.Snackbar.fail(i,te)}))},changeLog:l,onFocusEditor:()=>{u.logVersionNoteSectionClick(e,n)}})};oe.displayName="ChangeLogSection",t.ChangeLogSection=oe}));
//# sourceMappingURL=c_flows_version_change_log_section.js-vflvEG8Ds.map
