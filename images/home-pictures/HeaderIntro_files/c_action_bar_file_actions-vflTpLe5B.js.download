define(["require","exports","./c_src_simple-action-bar_action_bar_types","./e_ui_page_files_router","./e_edison","./c_ui-icon_line_to-do","./c_sharing_gating_util","./c_unity_check_file_cache","./c_unity_features","./c_browse_file_actions_action_handlers","./c_action_bar_action_bar_strings","./c_ui-icon_line_automation","./c_flows_utils_async_modal_launchers","./c_flows_redux_store","./c_flows_redux_selectors","./c_ui-icon_line_comment","./c_core_i18n","./c_ui-icon_line_copy","./c_action_bar_action_bar_constants","./c_file_actions_portable_copy","./c_file_actions_portable_move","./c_browse_actions","./c_browse_tts","./c_ui-icon_line_delete","./c_ui-icon_line_download","./c_ui-icon_line_edit","./c_core_browser_detection","./c_ui-icon_line_convert-file","./c_flows_conversions_conversion_actions","./c_workflow_builder_workflow_actions_action_ui_config","./c_cloud_docs_gdd_migration_gdd_ui_blocking","./c_ui-icon_line_folder-show","./c_ui-icon_line_settings","./c_tslib","./c_files_view_file_actions_file_from_metadata","./c_history","./c_data_action_creators_index","./c_file_uploader_utils","./c_growth_ui_teams_web_actions_logger_events","./c_sharing_browse_exports","./c_core_uri","./c_core_notify","./c_sharing_wizard_async_wizard_modals","./c_sharing_async_share_modal_util","./c_lodash-es_lodash","./c_ui-icon_line_move","./c_file_store_utils","./c_extensions_extensions_menu_component_v2","./c_ui-icon_line_finder","metaserver/static/js/modules/constants/reel","./c_ui-icon_line_zip","./c_flows_conversions_convert","./c_ui-icon_line_file","./c_components_spacer_index","./c_ui-icon_line_delete-forever","./c_ui-icon_line_cursor","./c_ui-icon_line_file-request","./c_ui-icon_line_restore","./c_ui-icon_line_share-arrow","./c_files_view_files_view_logging","./c_components_approval-forms_approval_request_modal","./c_components_approval-forms_approval_checkbox_in_share","./c_components_approval-forms_gating_utils","./c_extensions_split_share_button","./c_ui-icon_line_link","./e_core_exception","./c_core_exception_info","./c_ui-icon_fill_star","./c_ui-icon_line_send","./c_ui-icon_line_signature","./c_integrations_data_selectors","./c_ui-icon_line_rewind","./c_ui-icon_line_lock","./c_ui-icon_line_add-folder","./c_ui-icon_line_highlight","./c_shallow_equal","./c_ui-icon_line_thumbs-up","./c_flows_approval_approval_request_modal","./c_flows_approval_approval_io_client","./c_ui-icon_line_add-to-collection","./c_components_saver_modal_index","./c_hive_schemas_web-modal-activity","./c_sync_everything_strings","./c_sync_everything_hive_logger","./c_conversions_actions_unzip","./c_src_utils_logging","./c_ui-icon_line_dropbox-replay","./c_photo-editor_plugin_show-edit-plugin"],(function(e,t,o,i,n,r,s,a,c,l,d,_,u,p,A,S,E,T,f,O,I,m,g,y,v,R,F,N,h,L,b,C,w,B,D,M,P,U,x,k,W,V,G,H,q,K,Y,j,Q,$,z,Z,X,J,ee,te,oe,ie,ne,re,se,ae,ce,le,de,_e,ue,pe,Ae,Se,Ee,Te,fe,Oe,Ie,me,ge,ye,ve,Re,Fe,Ne,he,Le,be,Ce,we,Be){"use strict";const De=e=>"folder"===e[".tag"],Me=e=>i.BACKUP_BROWSE_ROOT+e,Pe=(e,t)=>{const o=`${i.BACKUP_BROWSE_ROOT}/${i.getDisplayedFilename(e)}`;return t?o:`${o}/${e}`},Ue=(e,t)=>B.__awaiter(void 0,void 0,void 0,(function*(){const o=t.map((e=>e.file_id)),n=yield xe(e,o),r=[];n.forEach((e=>{De(e)&&r.push(e)}));const s=[];return r.forEach((e=>{var o;const n=t.find((t=>t.file_id===e.id));s.push({browsePath:Pe(e.name,!0),fqPath:null!==(o=n.fq_path)&&void 0!==o?o:"",deviceId:"",id:n.file_id,name:e.name,type:i.BackupType.ORPHAN_FOLDER,quotaExempt:!1,hasConflicts:!1,rootNsId:n.root_ns_id})})),s})),xe=(e,t)=>B.__awaiter(void 0,void 0,void 0,(function*(){const o=[],n=[];for(const o of t){const t=(new i.UserApiV2Client).ns("files").rpc("get_metadata_batch",{paths:[o],allow_unmounted_ns:!0,include_media_info:!1,include_deleted:!1,include_has_explicit_shared_members:!1,include_folder_overview_metadata:!1},{subjectUserId:e.id});n.push(t)}let r=0;const s=yield(a=n,Promise.all(a.map((e=>e.then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))))));var a;for(const e of s)"fulfilled"===e.status?(o.push(...e.value.entries),r++):_e.reportException({err:new Error(e.reason),tags:["js:sync_everything"]});return r!==t.length&&_e.reportException({err:new Error(`Expected ${t.length} backups, but only rendering ${r} backups`),tags:["js:sync_everything"]}),o})),ke=(e,t,o,n,r)=>B.__awaiter(void 0,void 0,void 0,(function*(){const s=[],a={},c=[],l=(e=>e.is_cdm_member&&e.cdm_tmf_path)(e)?e.cdm_tmf_path:"";t.forEach((e=>{var t;const o=i.isHiddenState(e.device_status[".tag"]);if(void 0!==e.root_ns_id){if(!r&&o)return;c.push(Ve(e))}else o&&"unlinked"!==(null===(t=e.backup_state)||void 0===t?void 0:t[".tag"])||(s.push(l+"/"+e.name),a[e.name]=e)})),o.forEach((e=>{var t,o;const r=i.isHiddenState(e.backup_state[".tag"]);if(void 0!==(null===(o=null===(t=e.backup_root_info)||void 0===t?void 0:t.namespace_info)||void 0===o?void 0:o.ns_id)){if(!n&&r)return;c.push(Ge(e))}else r?n&&c.push(Ge(e)):(s.push(e.anchor_fileid),a[e.anchor_fileid]=e)}));return(yield xe(e,s)).forEach((e=>{De(e)&&(a[e.name]?c.push(Ve(a[e.name],e)):a[e.id]&&c.push(Ge(a[e.id],e)))})),c.forEach((e=>{"broken"===e.backupState&&e.driveUuid&&(e.isDuplicate=c.some((t=>t.driveUuid===e.driveUuid&&"active"===t.backupState)))})),q.sortBy(c,(e=>e.name))})),We=e=>new Promise((t=>B.__awaiter(void 0,void 0,void 0,(function*(){const o=e.id,n=[],r=yield(new i.UserApiV2Client).ns("backups").rpc("list_third_party_backups",{},{subjectUserId:o});n.push(...r.backups);let s=r.next_cursor;for(;s;){const e=yield(new i.UserApiV2Client).ns("backups").rpc("list_third_party_backups/continue",{cursor:s},{subjectUserId:o});n.push(...e.backups),s=e.next_cursor}t(n)})))),Ve=(e,t)=>{var o,n;const r=void 0!==e.root_ns_id;let s,a="";a=r||void 0===(null==t?void 0:t.path_display)?Pe(e.name,!0):Me(t.path_display),s=r||void 0===(null==t?void 0:t.path_display)?`/${e.name}`:t.path_display;const c=null===(o=e.anchor_folders)||void 0===o?void 0:o.reduce(((e,t)=>{var o,i;return void 0!==t.anchor_path&&(null===(o=t.folder_third_party_providers)||void 0===o?void 0:o.length)&&(e[t.anchor_path]=null===(i=t.folder_third_party_providers)||void 0===i?void 0:i.map((e=>e[".tag"]))),e}),{});let l=e.device_status[".tag"];if(void 0!==e.backup_state){const t=e.backup_state[".tag"];("enabled"===e.device_status[".tag"]&&i.CBEnabledStatesWithExtraInfo.includes(t)||"disabled"===e.device_status[".tag"]&&i.CBDisabledStatesWithExtraInfo.includes(t))&&(l=t)}return{browsePath:a,fqPath:s,deviceId:e.device_id,id:e.root_fileid,name:e.name,displayName:null!==(n=e.display_name)&&void 0!==n?n:e.name,backupState:l,platform:e.device_backup_platform[".tag"],lastModified:e.last_timestamp_utc?new Date(e.last_timestamp_utc/1e3):void 0,type:i.BackupType.COMPUTER,quotaExempt:e.quota_exempt,hasConflicts:!1,usesAnchors:r,rootNsId:e.root_ns_id?e.root_ns_id:void 0,thirdPartyProviders:c,anchorFolders:e.anchor_folders}},Ge=(e,t)=>{var o,n,r,s,a,c,l;const d=!1===e.is_undeletable,_=d&&void 0!==e.drive_name?e.drive_name:i.filename(null!==(n=null!==(o=e.fq_path)&&void 0!==o?o:null==t?void 0:t.path_display)&&void 0!==n?n:""),u=i.getDisplayedFilename(_),p=!!(null===(s=null===(r=e.backup_root_info)||void 0===r?void 0:r.namespace_info)||void 0===s?void 0:s.ns_id);let A,S="";return p?S=Pe(_,d||void 0!==e.backup_conflict_info&&e.backup_conflict_info.length>0):(null==t?void 0:t.path_display)&&(S=Me(t.path_display)),A=p||void 0===(null==t?void 0:t.path_display)?d?`/${_}`:`/${u}/${_}`:t.path_display,{browsePath:S,fqPath:A,deviceId:e.device_id,driveUuid:e.drive_uuid,id:e.anchor_fileid,name:u,displayName:null!==(a=e.display_name)&&void 0!==a?a:u,lastModified:e.last_timestamp_utc?new Date(e.last_timestamp_utc/1e3):void 0,type:i.BackupType.EXTERNAL_DRIVE,backupState:e.backup_state[".tag"],rootNsId:(null===(c=e.backup_root_info)||void 0===c?void 0:c.namespace_info)?e.backup_root_info.namespace_info.ns_id:void 0,quotaExempt:!!e.quota_exempt,hasConflicts:!!(null===(l=e.backup_conflict_info)||void 0===l?void 0:l.length),backupConflictInfo:e.backup_conflict_info,isMigrating:e.is_migrating,isFission:p,isPurged:d}},He=e=>{var t;return{browsePath:Pe(e.namespace_info.fq_path.slice(1),!0),fqPath:e.namespace_info.fq_path,deviceId:e.backup_id,id:e.namespace_info.file_id,name:e.name,backupState:null===(t=e.status)||void 0===t?void 0:t[".tag"],lastModified:new Date(e.namespace_info.last_activity_utc_us/1e3),type:i.BackupType.THIRD_PARTY,rootNsId:e.namespace_info.ns_id,hasConflicts:!1,quotaExempt:!1}},qe=e=>B.__awaiter(void 0,void 0,void 0,(function*(){try{const t=(yield(new i.UserApiV2Client).ns("users").rpc("get_plan_info",{account_id:e.account_id},{subjectUserId:e.id})).serialized_sku_content.sku_type;if(t in i.ProductPlanType)return i.ProductPlanType[t]}catch(e){}return null})),Ke=e=>B.__awaiter(void 0,void 0,void 0,(function*(){try{const t=yield(new i.UserApiV2Client).ns("users").rpc("get_space_usage",void 0,{subjectUserId:e.id});if("individual"===t.allocation[".tag"]||"team"===t.allocation[".tag"])return{allocated:t.allocation.allocated,used:t.used}}catch(e){}return null})),Ye=(e,t)=>(new i.UserApiV2Client).ns("device_sync").rpc("set_quota_exempt",{device_id:t},{subjectUserId:e.id}),je=(e,t)=>(new i.UserApiV2Client).ns("external_drive_backup").rpc("clear_all_quota_exempt",void 0,{subjectUserId:e.id}).then((()=>(new i.UserApiV2Client).ns("external_drive_backup").rpc("set_quota_exempt",{anchor_fileid:t},{subjectUserId:e.id})));var Qe,$e=Object.freeze({__proto__:null,getBrowsePathNonFission:Me,getBrowsePathFission:Pe,fetchDanglingFoldersMetadata:Ue,fetchMetadata:ke,fetchSizes:(e,t)=>B.__awaiter(void 0,void 0,void 0,(function*(){const o=e=>e.hasConflicts&&e.rootNsId?"ns:"+e.rootNsId.toString()+"/"+e.name:e.id,n=t.filter((e=>e&&!i.isHiddenEDB(e)&&!i.isHiddenCB(e))),r=(yield(new i.UserApiV2Client).ns("folders_info").rpc("get_folder_sizes",{paths:n.map((e=>o(e))),allow_unmounted_ns:!0},{subjectUserId:e.id})).folder_sizes.reduce(((e,{path:t,size:o})=>Object.assign(Object.assign({},e),{[t]:o})),{});return t.map((e=>Object.assign(Object.assign({},e),{size:r[o(e)]})))})),fetchBackups:(e,t={})=>B.__awaiter(void 0,void 0,void 0,(function*(){const o=e.id,{includeThirdPartyBackups:n,includeDeletedEDB:r,includeDeletedCBoA:s,includeLastTs:a,useUnifiedApi:c}=t;let l,d,_,u;if(c){const e=yield(new i.UserApiV2Client).ns("external_drive_backup").rpc("list_all_backups",void 0,{subjectUserId:o});l=e.computer_backup,d=e.external_drives,_=e.third_party_backups.map((e=>({backup_id:e.backup_id,name:e.name,namespace_info:e.namespace_info,status:e.status}))),u=e.dangling_folders}else{const[t,r,s]=yield Promise.all([(new i.UserApiV2Client).ns("device_sync").rpc("list_backups",{include_last_ts:a},{subjectUserId:o}),(new i.UserApiV2Client).ns("external_drive_backup").rpc("list_backups",{include_last_ts:a,include_backup_conflicts:!0},{subjectUserId:o}),n?We(e):Promise.resolve([])]);l=t.backups_list,d=r.list,_=s,u=[]}const[p,A]=yield Promise.all([ke(e,l,d,r,s),u.length>0?Ue(e,u):Promise.resolve([])]);return n&&p.push(..._.map(He)),p.push(...A),p})),getDeletedBackup:e=>Object.assign(Object.assign({},e),{browsePath:e.hasConflicts?e.browsePath:"",lastModified:void 0,size:void 0,backupState:"deleted"}),getBrokenBackup:e=>{const t=e.browsePath||e.rootNsId?Pe(e.name,e.hasConflicts):Me(e.fqPath);return Object.assign(Object.assign({},e),{browsePath:t,backupState:"broken"})},fetchUserSKU:qe,fetchUserQuota:Ke,fetchBackupTimestamps:e=>B.__awaiter(void 0,void 0,void 0,(function*(){var t;try{return null!==(t=(yield(new i.UserApiV2Client).ns("device_sync").rpc("get_backup_subscription_timestamp",void 0,{subjectUserId:e.id})).timestamp)&&void 0!==t?t:""}catch(e){}return null})),setQuotaExemptCB:Ye,setQuotaExemptEDB:je,getBoltData:e=>B.__awaiter(void 0,void 0,void 0,(function*(){try{return yield(new i.UserApiV2Client).ns("backup_bolt").rpc("get_bolt_data",void 0,{subjectUserId:e.id})}catch(e){}return null})),publishToBolt:(e,t)=>B.__awaiter(void 0,void 0,void 0,(function*(){try{return yield(new i.UserApiV2Client).ns("backup_bolt").rpc("publish_to_bolt",{event:t},{subjectUserId:e.id})}catch(e){}return null})),fetchMonthlyPlanCostBySKU:(e,t)=>{const o=t===i.ProductPlanType.SYNC_EVERYTHING?i.BACKUP_PRICE_REQUEST_ARGS:i.PLUS_PRICE_REQUEST_ARGS;return(new i.UserApiV2Client).ns("trials").rpc("get_price_conversions_for_schedule",o,{subjectUserId:e.id}).then((e=>e.trial_price_conversions[o.schedule_ids[0]].advertised_monthly_price))},getLinkedHostsAndDevices:(e,t)=>B.__awaiter(void 0,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("security_settings").rpc("get_linked_hosts_and_devices",{device_id:t},{subjectUserId:e.id})})),unlinkDevices:(e,t)=>B.__awaiter(void 0,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("security_settings").rpc("unlink_devices",{desktop_hosts:t},{subjectUserId:e.id})})),forceDisableDevice:(e,t)=>B.__awaiter(void 0,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("device_sync").rpc("disable_device",{device_id:t},{subjectUserId:e.id})}))});function ze(e,t){let o=!1,i=null;function n(){const n=t.apply(null,arguments);return o&&(i===n||e(i,n))||(o=!0,i=n),i}var r,s;return r=t,s=n,Object.defineProperties(s,{length:{value:r.length}}),n}t.ActionBarSelectionType=void 0,(Qe=t.ActionBarSelectionType||(t.ActionBarSelectionType={}))[Qe.NONE=0]="NONE",Qe[Qe.VAULT=1]="VAULT",Qe[Qe.FOLDER=2]="FOLDER",Qe[Qe.FILE=3]="FILE",Qe[Qe.MULTIPLE=4]="MULTIPLE",Qe[Qe.BACKUP_CONTENT=5]="BACKUP_CONTENT",Qe[Qe.BACKUP_FOLDER=6]="BACKUP_FOLDER";const Ze=(e,t)=>t.isSearchMode,Xe=(e,t)=>t.actionSurface,Je=(e,t)=>t.userSelector(e),et=(e,t)=>t.selectedFilesSelector(e),tt=(e,t)=>t.contextSelector(e),ot=(e,t)=>t.currentFolderInfo(e),it=(e,t)=>i.selectViewType(e,{instanceId:t.isSearchMode?i.SEARCH_FILES_VIEW_ID:i.BROWSE_FILES_VIEW_ID}),nt=(e,t)=>t.overQuotaDataSelector(e),rt=(e,t)=>t.experimentSelector(e),st=(e,t)=>Boolean(t.isCreatingSharedLinkSelector),at=(e,t)=>t.isInsideBackupFolder(e),ct=(e,t)=>t.isSelectedBackupFolder(e),lt=(e,t,o)=>t.backupInfoByFile(e)(o),dt=(e,t)=>{const o=et(e,t),i=tt(e,t).currentFQPath;return o.isEmpty()?((e,t,o)=>t.backupInfoByPath(e)(o))(e,t,i):lt(e,t,o.first())},_t=i.createSelector(et,at,ct,((e,o,n)=>n?t.ActionBarSelectionType.BACKUP_FOLDER:o?t.ActionBarSelectionType.BACKUP_CONTENT:0===e.count()?t.ActionBarSelectionType.NONE:e.some((e=>e.type===i.FileTypes.VAULT_FOLDER))?t.ActionBarSelectionType.VAULT:1===e.count()?e.first().is_dir?t.ActionBarSelectionType.FOLDER:t.ActionBarSelectionType.FILE:t.ActionBarSelectionType.MULTIPLE)),ut=i.createSelector(Je,(e=>s.GoldenGate.hasContentManagerAndSuperAdmin(e.id))),pt=i.createSelector(Je,(e=>s.GoldenGate.hasNewOwnershipModel(e.id))),At=i.createSelector(et,(e=>{const t=e.first();return e.some((e=>e.is_unmounted||e.ns_id!==t.ns_id))})),St=i.createSelector(et,(e=>e.some((e=>i.File.isNoAccessSharedFolder(e))))),Et=i.createSelector(et,(e=>e.some((e=>e.type===i.FileTypes.SANDBOX)))),Tt=i.createSelector(et,(e=>e.some((e=>e.is_cloud_doc&&e instanceof i.FileSharedWithMe)))),ft=i.createSelector(et,(e=>e.some((e=>e.is_cloud_doc)))),Ot=i.createSelector(et,at,((e,t)=>t?!!e.count()&&e.every((e=>e.isDeleted)):e.every((e=>e.isDeleted||e.is_unmounted)))),It=i.createSelector(et,(e=>e.some((e=>e.type===i.FileTypes.FAMILY_SHARED_FOLDER)))),mt=i.createSelector(et,(e=>e.some((e=>e instanceof i.FileSharedWithMe)))),gt=i.createSelector(et,(e=>e.every((e=>!e.isDeleted&&!e.is_unmounted)))),yt=i.createSelector(et,(e=>0===e.count())),vt=i.createSelector(et,tt,((e,t)=>t.permanentDeletionDisabledStateByNSID[t.currentNSID]||!1)),Rt=i.createSelector(et,(e=>e.some((e=>{var t;return!!(null===(t=e.per_node_metadata)||void 0===t?void 0:t.link_node)})))),Ft=i.createSelector(et,(e=>e.some((e=>{var t;return!!(null===(t=e.per_node_metadata)||void 0===t?void 0:t.suppress_delete)})))),Nt=i.createSelector(et,(e=>e.some((e=>{var t;return!!(null===(t=e.per_node_metadata)||void 0===t?void 0:t.suppress_move)})))),ht=i.createSelector(et,(e=>e.some((e=>{var t,o;return!!(null===(t=e.per_node_metadata)||void 0===t?void 0:t.suppress_ns_partition)||!!(null===(o=e.per_node_metadata)||void 0===o?void 0:o.suppress_shared_link)})))),Lt=i.createSelector(et,(e=>e.some((e=>{var t,o;return!!(null===(t=null==e?void 0:e.per_node_metadata)||void 0===t?void 0:t.device_info)&&!!(null===(o=null==e?void 0:e.per_node_metadata)||void 0===o?void 0:o.suppress_delete)})))),bt=i.createSelector(et,tt,((e,t)=>e.some((e=>!i.File.canViewFileMembers(e,t))))),Ct=i.createSelector(et,(e=>e.every((e=>null==e.fetchFolderSizesStatus)))),wt=i.createSelector(et,(e=>e.every((e=>e.type===i.FileTypes.FILE)))),Bt=i.createSelector(et,(e=>e.every((e=>e.is_dir)))),Dt=i.createSelector(et,tt,((e,t)=>t.isCurrentPathWriteable())),Mt=i.createSelector(et,tt,((e,t)=>t.isCurrentPathWriteable()&&!e.some((e=>e.read_only)))),Pt=i.createSelector(et,(e=>1===e.count())),Ut=i.createSelector(et,(e=>1===e.count()&&!e.first().is_dir)),xt=i.createSelector(et,(e=>1===e.count()&&e.first().is_dir)),kt=i.createSelector(et,(e=>e.some((e=>e.type===i.FileTypes.TEAM_MEMBER_FOLDER)))),Wt=i.createSelector(et,(e=>e.some((e=>e.type===i.FileTypes.TEAM_SHARED_FOLDER)))),Vt=i.createSelector(et,(e=>e.some((e=>e.type===i.FileTypes.VAULT_FOLDER)))),Gt=(e,t,o)=>t.flowsUserAutomation(o)(e),Ht=(e,t)=>{const o=et(e,t).first(),i=ot(e,t);return o&&Gt(e,t,o.fq_path)||!o&&i&&Gt(e,t,i.fq_path)||void 0},qt=i.createSelector(Je,tt,((e,t)=>e.is_cdm_member&&"/"===t.currentFQPath)),Kt=i.createSelector(et,(e=>{const t=e.toArray().map((e=>e.fq_path));return i.inSameDirectory(t)})),Yt=i.createSelector(i.expSuggestedWorkflowsVariant,et,Ut,((e,t,o)=>o&&".pdf"===t.first().ext&&["V1","V2"].includes(e))),jt=(e,t)=>t.rightRailCollapsedState(e),Qt=i.createSelector(Je,et,it,Ze,Xe,((e,t)=>t.actionSource),tt,jt,ot,((e,t,o,i,n,r,s,a,c)=>({user:e,files:t,isSearchMode:i,viewType:o,actionSurface:n,actionSource:r,context:s,rightRailState:a?"collapsed":"opened",currentFolderInfo:c}))),$t=i.createSelector(_t,(e=>eo[e])),zt=(e,t,i=!1)=>{const n={};if(n.alwaysInOverflow=e.alwaysInOverflow,n.expSuggestedWorkflowsActions=e.expSuggestedWorkflowsActions,!t){const e=[];i?e.push(o.ActionBarActionTypes.SHARE_COPY_LINK,o.ActionBarActionTypes.SHARE_MODAL):e.push(o.ActionBarActionTypes.SHARE_MODAL,o.ActionBarActionTypes.SHARE_COPY_LINK,o.ActionBarActionTypes.ADD_TO_COLLECTION),n.alwaysAtTopLevel=e}return n},Zt=i.createSelector(_t,ct,((e,t)=>zt(eo[e],t,!1))),Xt=i.createSelector(_t,(e=>zt(eo[e],!0,!1))),Jt=i.createSelector(_t,(e=>to[e])),eo={[t.ActionBarSelectionType.NONE]:{},[t.ActionBarSelectionType.FILE]:{atTopLevelIfSpace:[o.ActionBarActionTypes.DOWNLOAD,o.ActionBarActionTypes.OPEN,o.ActionBarActionTypes.DELETE,o.ActionBarActionTypes.ADD_TO_COLLECTION,o.ActionBarActionTypes.RESTORE,o.ActionBarActionTypes.PERMANENT_DELETE,o.ActionBarActionTypes.VAULT_LOCK,o.ActionBarActionTypes.VAULT_UNLOCK,o.ActionBarActionTypes.CONVERT_TO_ARCHIVE],alwaysInOverflow:[[o.ActionBarActionTypes.SHARE,o.ActionBarActionTypes.SHARE_COPY_LINK,o.ActionBarActionTypes.MANAGE_PERMISSIONS,o.ActionBarActionTypes.DOWNLOAD,o.ActionBarActionTypes.OPEN_IN_REPLAY,o.ActionBarActionTypes.EDIT_IMAGE,o.ActionBarActionTypes.EDIT_PDF,o.ActionBarActionTypes.OPEN,o.ActionBarActionTypes.SEND_FOR_SIGNATURE,o.ActionBarActionTypes.REQUEST_APPROVAL,o.ActionBarActionTypes.SELF_SIGN_ACTION,o.ActionBarActionTypes.SAVE_AS],[o.ActionBarActionTypes.DELETE,o.ActionBarActionTypes.RESTORE,o.ActionBarActionTypes.PERMANENT_DELETE,o.ActionBarActionTypes.REMOVE,o.ActionBarActionTypes.RENAME,o.ActionBarActionTypes.MOVE,o.ActionBarActionTypes.COPY],[o.ActionBarActionTypes.ADD_TO_COLLECTION,o.ActionBarActionTypes.STAR,o.ActionBarActionTypes.UNSTAR,o.ActionBarActionTypes.PIN_TO,o.ActionBarActionTypes.PIN_TO_ROOT,o.ActionBarActionTypes.UNPIN],[o.ActionBarActionTypes.VERSION_HISTORY,o.ActionBarActionTypes.FILE_LOCK,o.ActionBarActionTypes.FILE_UNLOCK,o.ActionBarActionTypes.FILE_REQUEST_UNLOCK]]},[t.ActionBarSelectionType.FOLDER]:{atTopLevelIfSpace:[o.ActionBarActionTypes.DOWNLOAD,o.ActionBarActionTypes.OPEN,o.ActionBarActionTypes.DELETE,o.ActionBarActionTypes.RESTORE,o.ActionBarActionTypes.PERMANENT_DELETE,o.ActionBarActionTypes.CONVERT_TO_ARCHIVE],alwaysInOverflow:[[o.ActionBarActionTypes.SHARE,o.ActionBarActionTypes.SHARE_COPY_LINK,o.ActionBarActionTypes.MANAGE_PERMISSIONS,o.ActionBarActionTypes.OPEN,o.ActionBarActionTypes.DOWNLOAD,o.ActionBarActionTypes.EDIT_FOLDER_AUTOMATION,o.ActionBarActionTypes.ADD_FOLDER_AUTOMATION],[o.ActionBarActionTypes.DELETE,o.ActionBarActionTypes.RENAME,o.ActionBarActionTypes.MOVE,o.ActionBarActionTypes.COPY],[o.ActionBarActionTypes.STAR,o.ActionBarActionTypes.UNSTAR,o.ActionBarActionTypes.UNPIN,o.ActionBarActionTypes.PIN_TO,o.ActionBarActionTypes.PIN_TO_ROOT],[o.ActionBarActionTypes.SPACES_REDIRECT,o.ActionBarActionTypes.FOLLOW,o.ActionBarActionTypes.FOLLOWING,o.ActionBarActionTypes.TIDY_UP,o.ActionBarActionTypes.REQUEST_FILES,o.ActionBarActionTypes.REWIND]]},[t.ActionBarSelectionType.MULTIPLE]:{atTopLevelIfSpace:[o.ActionBarActionTypes.DOWNLOAD,o.ActionBarActionTypes.DELETE,o.ActionBarActionTypes.RESTORE,o.ActionBarActionTypes.ADD_TO_COLLECTION,o.ActionBarActionTypes.PERMANENT_DELETE,o.ActionBarActionTypes.CONVERT_TO_ARCHIVE],alwaysInOverflow:[[o.ActionBarActionTypes.SHARE,o.ActionBarActionTypes.DOWNLOAD,o.ActionBarActionTypes.ADD_TO_COLLECTION,o.ActionBarActionTypes.DELETE,o.ActionBarActionTypes.RESTORE,o.ActionBarActionTypes.PERMANENT_DELETE,o.ActionBarActionTypes.MOVE,o.ActionBarActionTypes.COPY,o.ActionBarActionTypes.SAVE_AS]]},[t.ActionBarSelectionType.VAULT]:{},[t.ActionBarSelectionType.BACKUP_CONTENT]:{alwaysAtTopLevel:[o.ActionBarActionTypes.DOWNLOAD],atTopLevelIfSpace:[o.ActionBarActionTypes.REWIND,o.ActionBarActionTypes.VERSION_HISTORY]},[t.ActionBarSelectionType.BACKUP_FOLDER]:{alwaysAtTopLevel:[o.ActionBarActionTypes.DOWNLOAD],atTopLevelIfSpace:[o.ActionBarActionTypes.REWIND,o.ActionBarActionTypes.DELETE]}},to={[t.ActionBarSelectionType.NONE]:{},[t.ActionBarSelectionType.FILE]:{atTopLevelIfSpace:[o.ActionBarActionTypes.SHARE_COPY_LINK,o.ActionBarActionTypes.SHARE]},[t.ActionBarSelectionType.FOLDER]:{atTopLevelIfSpace:[o.ActionBarActionTypes.SHARE_COPY_LINK,o.ActionBarActionTypes.SHARE]},[t.ActionBarSelectionType.MULTIPLE]:{atTopLevelIfSpace:[o.ActionBarActionTypes.SHARE]},[t.ActionBarSelectionType.VAULT]:{}},oo=i.createSelector(yt,i.unsortedFiles,i.getCurrentFolderInfo,((e,t,o)=>{if(e){const e=t,i=0===e.count(),n=e.every((e=>e.is_dir));return!i&&!n&&!!o}return!1})),io=i.createSelector(tt,ot,((e,t)=>({isCurrentFolderEligibleForAutomation:t&&e.isInFolderMode&&!e.isCurrentlyInRoot&&!e.isInsideTeamFolderRoot&&!e.isInsideVaultFolder&&t.type!==i.FileTypes.TEAM_MEMBER_FOLDER&&!i.File.isReadOnlySharedFolder(t),isSubfolderEligibleForAutomation:t&&!e.isInsideVaultFolder&&!i.File.isReadOnlySharedFolder(t)}))),no={actionType:o.ActionBarActionTypes.ARCHIVE,isEnabled:!0,text:d.ARCHIVE_ACTION_STRING,icon:r.ArchiveLine},ro=(e,t)=>ut(e,t)&&xt(e,t)&&gt(e,t)&&Wt(e,t),so=()=>{const e=n.react.exports.useRef(null),t=i.useIntl();n.react.exports.useEffect((()=>{p.getStoreForAutomations()}),[]);const r={nodeType:"action",actionType:o.ActionBarActionTypes.ADD_FOLDER_AUTOMATION};return n.React$1.createElement(n.React$1.Fragment,null,n.React$1.createElement(i.Menu.ActionItem,{value:r,ref:e,withLeftAccessory:n.React$1.createElement(i.UIIcon,{src:_.AutomationLine})},t.formatMessage(d.ADD_FOLDER_AUTOMATION_STRING)))};so.displayName="AddAutomationAction";const ao=(e,t)=>{const{expFlowsAutomatedFolderUI:o}=rt(e,t),n=et(e,t).first(),r=i.getCurrentFolderInfo(e),s=tt(e,t),a=!!o&&xt(e,t)&&!n.is_in_vault_folder&&!kt(e,t)&&!i.File.isReadOnlySharedFolder(n),c=!!o&&!n&&r&&s.isInFolderMode&&!s.isCurrentlyInRoot&&!s.isInsideTeamFolderRoot&&!s.isInsideVaultFolder&&r.type!==i.FileTypes.TEAM_MEMBER_FOLDER&&!i.File.isReadOnlySharedFolder(r);return a||c},co=e=>i.createSelector(ao,Ht,A.getAllowedWorkflowActions,((t,i,r)=>{if(t)return null!=i&&r.includes(i.actions[0].actionType)&&"edit"===e?{actionType:o.ActionBarActionTypes.EDIT_FOLDER_AUTOMATION,text:d.EDIT_FOLDER_AUTOMATION_STRING,icon:_.AutomationLine,isEnabled:!0}:i||"add"!==e?void 0:{actionType:o.ActionBarActionTypes.ADD_FOLDER_AUTOMATION,text:d.ADD_FOLDER_AUTOMATION_STRING,icon:_.AutomationLine,isEnabled:!0,overflowItem:n.React$1.createElement(so,null)}})),lo=(e,t)=>Ut(e,t)&&gt(e,t)&&!ft(e,t)&&!Rt(e,t),_o=(e,t)=>gt(e,t)&&!mt(e,t)&&!Wt(e,t)&&!kt(e,t)&&!Rt(e,t)&&!It(e,t)&&!Vt(e,t),uo=(e,t)=>{const o=tt(e,t);(function(e){const{expbackupWebCustomSubfolders:t}=i.browsePostTTIExperiments(e);return!!t})(e)&&function(e,t){const o=et(e,t);return null!==lt(e,t,o.first())}(e,t)?l.handleBackupDeleteDeviceFolder(Qt(e,t)):l.handleDelete(Qt(e,t),o)},po=(e,t)=>{const o=t.selectedFilesSelector(e);return 1===o.count()&&i.getLinkNodeAction(o.first().per_node_metadata)===i.PASSWORDS_POST_SETUP_ACTION},Ao=(e,t)=>!po(e,t)&&gt(e,t)&&!mt(e,t)&&!Wt(e,t)&&!kt(e,t)&&!Vt(e,t)&&(!Ft(e,t)||Eo(e,t))&&!So(e,t),So=(e,t)=>{const o=et(e,t),{expEnabledBackupWebCbOnAnchorsDelete:n,expEnabledBackupWebDoNotBackup:r}=i.browsePostTTIExperiments(e);return o&&o.count()>0?o.some((s=>{var a;const c=(i.isBackupBrowse()||s.is_in_backup_folder)&&(s.icon.startsWith("device_subfolder")||i.file_extension(null!==(a=s.fq_path)&&void 0!==a?a:"")===i.COMPUTER_BACKUP_ON_ANCHORS_EXT),l=lt(e,t,s);return!(!c||n||r||l)||("cb"===(null==l?void 0:l.type)&&0===l.nestLevel||!("cb"===(null==l?void 0:l.type)&&l.usesAnchors&&l.nestLevel>=2)&&!!(o.count()>1&&(Lt(e,t)||!n&&!r&&"cb"===(null==l?void 0:l.type)&&l.usesAnchors)))})):!!at(e,t)},Eo=(e,t)=>{const o=et(e,t),n=lt(e,t,o.first()),{expEnabledBackupWebCbOnAnchorsDelete:r}=i.browsePostTTIExperiments(e);return 1===o.count()&&!!n&&1===n.nestLevel&&"cb"===n.type&&(Lt(e,t)||!r&&!!n.usesAnchors)};const To=(e,t)=>gt(e,t)&&!Rt(e,t)&&(Pt(e,t)?!ft(e,t):!mt(e,t)&&!Tt(e,t)),fo=(e,t)=>{const o=Qt(e,t),{files:i,user:n}=o,r=i.first(),s=".pdf"===r.ext,a=r.href.includes("/s/")||r.href.includes("/scl/");return n&&Ut(e,t)&&s&&!F.is_mobile_or_tablet()&&!a},Oo=()=>i.createSelector(fo,Yt,((e,t)=>e?(e=>({actionType:o.ActionBarActionTypes.EDIT_PDF,isEnabled:!0,text:d.EDIT_PDF_ACTION_STRING,icon:R.EditLine,showNewBadge:!1,isSuggestedWorkflow:e,suggestedWorkflowsTooltipContents:e?{imageUrl:n.static_url("/static/metaserver/static/js/action_bar/assets/suggested_workflow_edit-vfl10TAhL.png"),label:d.EDIT_PDF_SUGGESTED_WORKFLOW_TOOLTIP_STRING}:void 0}))(t):void 0)),Io=(e,t)=>{const o=et(e,t).first();return Pt(e,t)&&gt(e,t)&&(o.type===i.FileTypes.SHARED_FOLDER||o.type===i.FileTypes.TEAM_SHARED_FOLDER)},mo=(e,t)=>gt(e,t)&&wt(e,t),go=(e,t)=>{const r=et(e,t).toArray(),{expFlowsManualVideoGifUi:s}=rt(e,t),a={expFlowsManualVideoGifUi:s};a.expGddMigrationFrontendActions=i.browsePostTTIExperiments(e).expGddMigrationFrontendActions||b.isGddMigrationDateWithinNumDays(i.getBrowseState(e).experiments.gddMigrationDates,30);const c=h.getConversionActionsForFiles(r,a),l=Math.max(...r.map((e=>e.bytes)))/1048576,d=new Map;for(const e of c){const t=e.actionGroup||h.ConversionActionGroup.DEFAULT;d.has(t)?d.get(t).push(e):d.set(t,[e])}return Array.from(d.entries()).sort(((e,t)=>e[0]-t[0])).map((([e,t])=>t.map((e=>{const t=L.getConversionFileSizeLimitMB(r.map((e=>e.ext.slice(1))),e.actionText);return{value:{type:o.ActionBarActionTypes.SAVE_AS,menuItem:e},description:e.actionText,icon:n.React$1.createElement(i.UIIcon,{src:e.actionIcon}),isEnabled:l<=t,disabledTooltip:E.intl.formatMessage({id:"A9pwq6",defaultMessage:"{numFiles, plural, one {File is larger than the {sizeLimitMB}MB limit} other {One or more of your files is larger than the {sizeLimitMB}MB limit}}"},{sizeLimitMB:t,numFiles:r.length})}}))))},yo=(e,t)=>{g.logBrowseTTS("go_to_folder"),l.handleShowInFolder(Qt(e,t))},vo={actionType:o.ActionBarActionTypes.GO_TO_FOLDER,isEnabled:!0,text:d.GO_TO_FOLDER_ACTION_STRING,icon:C.FolderShowLine},Ro=(e,t)=>gt(e,t)&&!mt(e,t)&&Kt(e,t);var Fo;!function(e){e[e.UploadFiles=1]="UploadFiles",e[e.UploadFolder=2]="UploadFolder",e[e.Upload=3]="Upload",e[e.Files=4]="Files",e[e.Folder=5]="Folder",e[e.NewPaperDoc=6]="NewPaperDoc",e[e.NewFolder=7]="NewFolder",e[e.RestoreFolder=8]="RestoreFolder",e[e.JoinFolderAgain=9]="JoinFolderAgain",e[e.ShowDeletedFiles=10]="ShowDeletedFiles",e[e.HideDeletedFiles=11]="HideDeletedFiles",e[e.NewSharedFolder=12]="NewSharedFolder",e[e.ShareFolder=13]="ShareFolder",e[e.ShareFolderAbbreviated=14]="ShareFolderAbbreviated",e[e.ManageAsAdmin=15]="ManageAsAdmin",e[e.NewTeamFolder=16]="NewTeamFolder",e[e.RequestFiles=17]="RequestFiles",e[e.FolderHistory=18]="FolderHistory",e[e.RewindFolder=19]="RewindFolder",e[e.RewindDropbox=20]="RewindDropbox"}(Fo||(Fo={}));const No={},ho=e=>(e in No||(No[e]=(e=>{switch(e){case Fo.UploadFiles:return E.intl.formatMessage({id:"Qayhb5",defaultMessage:"Upload files"});case Fo.UploadFolder:return E.intl.formatMessage({id:"53oUlv",defaultMessage:"Upload folder"});case Fo.Upload:return E.intl.formatMessage({id:"i98Ff5",defaultMessage:"Upload"});case Fo.FolderHistory:return E.intl.formatMessage({id:"BxyH89",defaultMessage:"Folder history"});case Fo.RewindFolder:return E.intl.formatMessage({id:"4Wq7Cq",defaultMessage:"Rewind this folder"});case Fo.RewindDropbox:return E.intl.formatMessage({id:"hiHRLr",defaultMessage:"Rewind Dropbox"});case Fo.Files:return E.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"});case Fo.Folder:return E.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"});case Fo.NewPaperDoc:return E.intl.formatMessage({id:"Jfm8Pe",defaultMessage:"New Paper Document"});case Fo.NewFolder:return E.intl.formatMessage({id:"pxGZm3",defaultMessage:"New folder"});case Fo.RestoreFolder:return E.intl.formatMessage({id:"gx89em",defaultMessage:"Restore folder"});case Fo.JoinFolderAgain:return E.intl.formatMessage({id:"0ca2O6",defaultMessage:"Join folder again"});case Fo.ShowDeletedFiles:return E.intl.formatMessage({id:"WR5EDI",defaultMessage:"Show deleted files"});case Fo.HideDeletedFiles:return E.intl.formatMessage({id:"j500HF",defaultMessage:"Hide deleted files"});case Fo.NewSharedFolder:return E.intl.formatMessage({id:"J9ZdWw",defaultMessage:"New shared folder"});case Fo.ShareFolder:return E.intl.formatMessage({id:"aHwEwV",defaultMessage:"Share folder"});case Fo.ShareFolderAbbreviated:return E.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"});case Fo.ManageAsAdmin:return E.intl.formatMessage({id:"SrWnn5",defaultMessage:"View in admin console"});case Fo.NewTeamFolder:return E.intl.formatMessage({id:"dYs+4Q",defaultMessage:"New team folder"});case Fo.RequestFiles:return E.intl.formatMessage({id:"QeqSyk",defaultMessage:"Request files"})}})(e)),No[e]),Lo=new Set([ho(Fo.UploadFiles),ho(Fo.UploadFolder),ho(Fo.NewFolder),ho(Fo.RequestFiles)]),bo="manage_folder_subscription";var Co,wo,Bo;t.RequestFlightStatus=void 0,(Co=t.RequestFlightStatus||(t.RequestFlightStatus={})).IDLE="idle",Co.READY="ready",Co.INFLIGHT="inflight",Co.ERROR="error",t.FolderSubscriptionState=void 0,(wo=t.FolderSubscriptionState||(t.FolderSubscriptionState={})).FOLLOWING="FOLLOWING",wo.FOLLOWING_PARENT="FOLLOWING_PARENT",wo.NOT_FOLLOWING="NOT_FOLLOWING",function(e){e.FETCHING_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/FETCHING_FOLDER_SUBSCRIPTION",e.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/OPTIMISTIC_SET_FOLDER_SUBSCRIPTION",e.CONFIRM_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/CONFIRM_FOLDER_SUBSCRIPTION",e.ERROR_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/ERROR_FOLDER_SUBSCRIPTION"}(Bo||(Bo={}));function Do(e,o){return B.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/get",{identifier:e},{subjectUserId:o}).then((n=e,({subscription:e})=>{if(!e)return{subscriptionState:t.FolderSubscriptionState.NOT_FOLLOWING};const o=e.fq_path;return o!==n?{subscriptionState:t.FolderSubscriptionState.FOLLOWING_PARENT,followingPath:o}:{subscriptionState:t.FolderSubscriptionState.FOLLOWING,followingPath:o,settings:e.settings}}));var n}))}function Mo(e,t){return B.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/delete",{identifier:e},{subjectUserId:t})}))}const Po={requests:i.immutable.exports.Map(),folderSubscriptions:i.immutable.exports.Map()};function Uo(e=Po,o){switch(o.type){case Bo.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION:return function(e,o){const{path:i,folderSubscription:n}=o.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(i,{status:t.RequestFlightStatus.INFLIGHT}),folderSubscriptions:e.folderSubscriptions.set(i,n)})}(e,o);case Bo.FETCHING_FOLDER_SUBSCRIPTION:return function(e,o){const{path:i}=o.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(i,{status:t.RequestFlightStatus.INFLIGHT})})}(e,o);case Bo.CONFIRM_FOLDER_SUBSCRIPTION:return function(e,o){const{path:i,folderSubscription:n,timestamp:r}=o.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(i,{status:t.RequestFlightStatus.READY,lastUpdated:r}),folderSubscriptions:e.folderSubscriptions.set(i,n)})}(e,o);case Bo.ERROR_FOLDER_SUBSCRIPTION:return function(e,o){const{path:i,folderSubscription:n}=o.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(i,{status:t.RequestFlightStatus.ERROR}),folderSubscriptions:n?e.folderSubscriptions.set(i,n):e.folderSubscriptions})}(e,o)}return e}const xo=e=>i.getStateAtNamespace(e,i.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY)||Po,ko=(e,o)=>xo(e).requests.get(o,{status:t.RequestFlightStatus.IDLE}),Wo=(e,t)=>{var o;return null===(o=Vo(e,t))||void 0===o?void 0:o.subscriptionState},Vo=(e,t)=>Go(e).get(t),Go=e=>xo(e).folderSubscriptions,Ho=E.intl.formatMessage({id:"JBINyn",defaultMessage:"Close"}),qo=E.intl.formatMessage({id:"Wzr+Eu",defaultMessage:"Unfollow"});function Ko({callToActionFn:e,isSuccess:t,message:o}){const r=t?"complete":"fail",s=t&&e?qo:void 0,a=t?e:void 0,c=t&&e?void 0:Ho,l=n.React$1.createElement(i.Snackbar,{title:o,variant:r,actionButtonText:s,onActionClick:a,closeButtonText:c,timeoutDelayMs:5e3,id:"browse-action"});i.Snackbar.show(l)}function Yo(e){Ko({isSuccess:!0,message:E.intl.formatMessage({id:"74emIA",defaultMessage:'Notification options for "{folderName}" have been set'},{folderName:i.filename(e)})})}function jo(e){Ko({isSuccess:!1,message:E.intl.formatMessage({id:"fwZe/f",defaultMessage:'Couldn\'t set options for "{folderName}"'},{folderName:i.filename(e)})})}function Qo(e){Ko({isSuccess:!0,message:E.intl.formatMessage({id:"nQncys",defaultMessage:'You’ll no longer get notifications about "{folderName}"'},{folderName:i.filename(e)})})}function $o(e){Ko({isSuccess:!1,message:E.intl.formatMessage({id:"/QEApB",defaultMessage:'Unable to unfollow "{folderName}"'},{folderName:i.filename(e)})})}const zo=(e,t,o)=>{e({type:Bo.CONFIRM_FOLDER_SUBSCRIPTION,payload:{folderSubscription:o,path:t,timestamp:new Date}})},Zo=(e,t,o)=>{e({type:Bo.ERROR_FOLDER_SUBSCRIPTION,payload:{folderSubscription:o,path:t}})},Xo=e=>(o,n)=>B.__awaiter(void 0,void 0,void 0,(function*(){const r=n(),s=i.user(r).id;ko(r,e).status!==t.RequestFlightStatus.INFLIGHT&&(((e,t)=>{e({type:Bo.FETCHING_FOLDER_SUBSCRIPTION,payload:{path:t}})})(o,e),Do(e,s).then((t=>zo(o,e,t)),(()=>Zo(o,e))))}));var Jo;t.FolderSubscriptionOrigin=void 0,(Jo=t.FolderSubscriptionOrigin||(t.FolderSubscriptionOrigin={})).Email="email",Jo.SideMenu="side_menu",Jo.Thumbnail="thumbnail";const ei=(e,t,o,n)=>{var r,s;const a=i.user(t).id,c=i.selectedFiles(t),{num_files_selected:l,num_folders_selected:d}=i.countFilesAndFolders(c),_=Vo(t,o),u=null===(r=null==_?void 0:_.settings)||void 0===r?void 0:r.activity_types;i.logBrowseAction({action:e,uid:a,num_files_selected:l,num_folders_selected:d,view_type:i.selectViewType(t,{instanceId:i.BROWSE_FILES_VIEW_ID}),extra:{ns_id:n.ns_id.toString(),origin:n.origin||null,frequency:(null===(s=null==_?void 0:_.settings)||void 0===s?void 0:s.frequency[".tag"])||null,file_add:u?u.file_added.toString():null,file_delete:u?u.file_deleted.toString():null}})},ti=({dispatch:e,getState:t,path:o,newValue:i,apiUpdate:n,onSuccess:r,onError:s})=>{const a=t(),c=Vo(a,o);return((e,t,o)=>{e({type:Bo.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION,payload:{folderSubscription:o,path:t}})})(e,o,i),n().then((t=>{zo(e,o,i),r(t)}),(()=>{Zo(e,o,c),e(Xo(o)),s()}))},oi=(e,o)=>(n,r)=>{const s=r(),a=i.user(s).id;if(Wo(s,e)===t.FolderSubscriptionState.FOLLOWING)return ti({dispatch:n,getState:r,path:e,newValue:{subscriptionState:t.FolderSubscriptionState.NOT_FOLLOWING},apiUpdate:()=>Mo(e,a),onSuccess:()=>{Qo(e),ei(i.WebUserActionLogEvent.UNFOLLOW_FOLDER,r(),e,o)},onError:()=>$o(e)})};let ii;const ni=()=>(ii||(ii=i.getStoreAndRegisterReducers({[i.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY]:Uo})),ii);const ri=(e,t,o,n,r,s,a=!1,c=!1)=>{const{currentFQPath:l}=t;D.logCreateFolder({uid:e.id,view_type:s,origin:i.CREATE_FOLDER_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL,source:r}),i.WebUserActionLog.log(e.id,i.WebUserActionLogEvent.NEW_FOLDER_CLICK,{}),g.logBrowseTTS("create_folder"),i.TeamsWebActionsLogger.log(x.TeamSpaceEmptyZoneCTALoggerEvents.CREATE_FOLDER_CLICKED,{empty_state_personalization:!0}),i.TeamsWebActionsLogger.log(x.TeamSpaceTsdAccessVisibilityEvents.CREATE_FOLDER_MODAL_OPEN,{parent_ns_id:t.currentNSID,folder_level:i.normalize(t.currentFQPath).split("/").length});let d=e.is_cdm_member&&"/"===l;const _=o=>{m.browseActions.handleNewFolderAutomationRedirect(o,e,t.currentNSID,"new_folder_creation")};if(o&&(d=t.isInsideTeamFolderTree&&!!e.is_team),d){o||W.assert(!!n,"All CDM Users should have an auto team group in their team");const r=e=>{V.Notify.error(e||E.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."})),m.browseActions.cancelCreateFolder()},s=({user:e,folderName:t,fqPath:o,shouldLaunchAutomationModal:i})=>{m.browseActions.createFolderComplete(),m.browseActions.selectFilesByFqPath({fqPathsToSelect:[o]}),i?_(o):m.browseActions.handleNewFolderRedirectOnSuccess(o)},c=({pathName:o,folderName:n,checkFSWs:r,shouldLaunchAutomationModal:s})=>{i.TeamsWebActionsLogger.log(x.TeamSpaceTsdAccessVisibilityEvents.CREATE_FOLDER_CLICK,{parent_ns_id:t.currentNSID,folder_level:i.normalize(t.currentFQPath).split("/").length}),m.browseActions.createFolder({pathName:o,folderName:n,user:e,checkFSWs:r,redirectOnSuccess:s?_:m.browseActions.handleNewFolderRedirectOnSuccess,origin:i.CREATE_FOLDER_ACTION_ORIGIN_TYPE.BROWSE_CDM_NEW_FOLDER_MODAL})};k.asyncShowAppropriateNewFolderModalForCdmUser({user:e,context:t,autoTeamGroupId:n,showFileSystemWarningsModal:void 0,shouldDisplayAutoFolderOption:a,onPending:m.browseActions.createFolderPending,onComplete:s,onCancel:r,autoTeamGroupDefaultAccessLevel:i.ACCESS_LEVEL.WRITER,setUrl:({path:e,qargs:t})=>i.getStoreForBrowse().dispatch(P.setUrl({path:e,qargs:t})),handleCreateFolder:c})}else{const o=({folderName:o,isConfidential:n,shouldLaunchAutomationModal:r})=>{m.browseActions.createFolderInNewFolderModal({folderName:o,isConfidential:n,user:e,context:t,redirectOnSuccess:r?_:m.browseActions.handleNewFolderRedirectOnSuccess,origin:i.CREATE_FOLDER_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL,shouldLaunchAutomationModal:r})};k.asyncShowCdmNewFolderModal({handleCreateFolder:o,user:e,context:t,shouldSyncDefault:!1,shouldDisplaySyncSettings:!1,shouldDisplayAudienceInput:!0,shouldDisplayAutoFolderOption:a,isConfidential:c})}},si=(e,t)=>{i.logBrowseAction({uid:e.id,action:i.WebUserActionLogEvent.REWIND_CLICK,num_files_selected:0,num_folders_selected:0,action_surface:(null==t?void 0:t.actionSurface)||i.ActionSurfaceLogValue.RIGHT_SIDEBAR,source:(null==t?void 0:t.actionSource)||i.BrowseLogEventSource.MAESTRO_RIGHT_SIDEBAR}),M.DBHistory.update_query_param(i.BrowseQueryArg.rewind,"true"),i.getStoreForBrowse().dispatch(P.showRewind())},ai=(e,t,o)=>{i.WebUserActionLog.log(e.id,i.WebUserActionLogEvent.NEW_SHARED_FOLDER_CLICK,{origin:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS}),t.isCurrentlyInRoot?G.asyncShowShareAFolderWizardModal(e):H.asyncShowShareModal(e,t,Object.assign(Object.assign({},o),{origin:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS}),(({path:e,qargs:t})=>i.getStoreForBrowse().dispatch(P.setUrl({path:e,qargs:t}))))},ci=(e,t)=>{i.WebUserActionLog.log(e.id,i.WebUserActionLogEvent.NEW_SHARED_FOLDER_CLICK,{origin:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS}),G.asyncShowShareAFolderWizardModal(e,void 0,!0,t,m.browseActions.handleNewFolderRedirectOnSuccess,m.browseActions.handleShowShareModal)},li=(e,t,o,n)=>{H.asyncShowShareModal(e,t,Object.assign(Object.assign({},n),{initialScreen:i.MANAGE_SCREEN,origin:o}),(({path:e,qargs:t})=>i.getStoreForBrowse().dispatch(P.setUrl({path:e,qargs:t}))))},di=(e,t,o,n,r)=>{const s=U.getUploadLocationMetadataToLog(e,n);i.WebUserActionLog.log(e.id,i.WebUserActionLogEvent.SHOW_DELETED_FILES_CLICK,s),i.logToggleDeletedFiles({uid:e.id,show_deleted_files:!o,view_type:t,action_surface:(null==r?void 0:r.actionSurface)||i.ActionSurfaceLogValue.ACTION_BAR,source:(null==r?void 0:r.actionSource)||i.ActionSurfaceLogValue.ACTION_BAR}),m.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!o})},_i=t=>{!function(t){B.__awaiter(this,void 0,void 0,(function*(){const{goToContentManagerForPath:o}=yield new Promise((function(t,o){e(["./c_sharing_content_manager"],t,o)}));o(t)}))}({containingFolder:t.currentFQPath})},ui=(e,t,o)=>{const n=U.getUploadLocationMetadataToLog(e,t.currentFQPath);i.WebUserActionLog.log(e.id,i.WebUserActionLogEvent.VIEW_IN_ADMIN_CONSOLE_CLICK,n),_i(t)},pi=(e,t,o)=>{const{currentNSID:n,currentNSPath:r}=t;i.logBrowseAction({uid:e.id,action:i.WebUserActionLogEvent.REQUEST_FILES_CLICK,num_files_selected:0,num_folders_selected:0,action_surface:(null==o?void 0:o.actionSurface)||i.ActionSurfaceLogValue.RIGHT_SIDEBAR,source:(null==o?void 0:o.actionSource)||i.BrowseLogEventSource.MAESTRO_RIGHT_SIDEBAR}),i.redirect(`/requests?ns_id=${n}&path=${r}&referrer=web_browse_global_action`)},Ai=(t,o,i)=>{new Promise((function(t,o){e(["./c_vault_lib_use_handle_add_files"],t,o)})).then((function(e){return e.use_handle_add_files_esnext})).then((({handleAddFiles:e})=>{e(t,o)(i)}))},Si=(e,t)=>{ni().dispatch(oi(e,{ns_id:t}))},Ei=(e,t)=>{const o=i.paths_are_equal(e,t)?"":i.filename(e);M.DBHistory.update_query_param(bo,o)},Ti=(e,t)=>{i.logBrowseAction({uid:e.id,action:i.WebUserActionLogEvent.ADD_FROM_GDRIVE,num_files_selected:0,num_folders_selected:0,action_surface:(null==t?void 0:t.actionSurface)||i.ActionSurfaceLogValue.ACTION_BAR,source:(null==t?void 0:t.actionSource)||i.BrowseLogEventSource.LEGACY_HEADER_ACTIONS}),i.getStoreForBrowse().dispatch(P.addFromGdrive())};var fi=Object.freeze({__proto__:null,handleCreateNewFolder:ri,handleRewindClick:si,handleSharedFolderClick:ai,handleCreateSharedFolderClick:ci,handleManagePermissionsClick:li,handleTrashCanClick:di,getVaultFilteredActions:e=>e.filter((e=>{const{action:t}=e;return!!q.isFunction(t)||!Lo.has(t.label)})),handleRedirectToContentManager:_i,handleViewInAdminConsoleClick:ui,handleRequestFiles:pi,handleAddContent:Ai,handleUnfollowFolder:Si,handleOpenFollowCustomizationModal:Ei,handleAddFromGdriveClick:Ti});const Oi=(e,t)=>{if(i.Viewer.get_viewer().is_assume_user_session)return!1;const o=tt(e,t);return yt(e,t)?ut(e,t)&&pt(e,t)&&o.isInsideTeamFolderTree||!Je(e,t).is_cdm_member&&ut(e,t)&&o.isCurrentlyInRoot:ut(e,t)&&pt(e,t)&&o.isInsideTeamFolderTree&&!mt(e,t)},Ii={actionType:o.ActionBarActionTypes.MANAGE_AS_ADMIN,isEnabled:!0,text:d.MANAGE_AS_ADMIN_ACTION_STRING,icon:w.SettingsLine},mi=(e,t)=>gt(e,t)&&!mt(e,t)&&!Wt(e,t)&&!kt(e,t)&&!Rt(e,t)&&!Nt(e,t)&&!Vt(e,t),gi=(e,t)=>{l.handleOpenInDesktop(Qt(e,t))},yi={actionType:o.ActionBarActionTypes.OPEN_MAC_DESKTOP,isEnabled:!0,text:d.OPEN_MAC_DESKTOP_ACTION_STRING,icon:Q.FinderLine},vi={actionType:o.ActionBarActionTypes.OPEN_WINDOWS_DESKTOP,isEnabled:!0,text:d.OPEN_WINDOWS_DESKTOP_ACTION_STRING,icon:Q.FileExplorerLine},Ri=(e,t)=>gt(e,t)&&!tt(e,t).isInsideVaultFolder&&((e,t)=>{const o=et(e,t).first();return Pt(e,t)&&!mt(e,t)&&c.UnityFeatures.isUnitySupported()&&(null===a.UnityCheckFileCache||void 0===a.UnityCheckFileCache?void 0:a.UnityCheckFileCache.is_cached_and_locally_available(o.ns_id,o.ns_path))})(e,t),Fi={surface:"action-bar"},Ni=(e,t)=>()=>{yo(e,t)},hi=i.createSelector(Qt,(e=>({openInNewTabActionHandler:()=>{l.handleOpenInNewTab(e)},openDesktopActionHandler:()=>{l.handleOpenInDesktop(e)},replayActionHandler:()=>{l.handleReplay(e)},previewActionHandler:()=>{l.handlePreview(e,i.ActionSourceValue.OVERFLOW_MENU)}}))),Li=(e,t)=>Pt(e,t)&&gt(e,t)&&!mt(e,t)&&!Wt(e,t)&&!kt(e,t)&&!Rt(e,t)&&!tt(e,t).isInsideVaultFolder,bi=[".3fr",".arw",".bmp",".cr2",".crw",".dcr",".dng",".erf",".gif",".jpeg",".jpg",".kdc",".mef",".mos",".mrw",".nef",".nrw",".orf",".pef",".png",".ppm",".raf",".rw2",".rwl",".sr2",".tif",".tiff",".webp",".x3f"],Ci=[".aac",".aif",".aiff",".flac",".m4a",".m4r",".mp3",".oga",".ogg",".wav",".wma"].concat([".3gp",".3gpp",".3gpp2",".asf",".avi",".dv",".flv",".m2t",".m2ts",".m4v",".mkv",".mov",".mp4",".mpeg",".mpg",".mts",".mxf",".oggtheora",".ogv",".rm",".ts",".vob",".webm",".wmv"]),wi=()=>i.createSelector(Je,et,Li,Ri,hi,Ni,Ro,Ze,io,((e,t,r,s,a,c,l,_,u)=>{const p=t.first(),A=r&&!p.is_dir?a.previewActionHandler:void 0,S="ON"===$.REEL_OPEN_WITH_ENABLED&&Ci.includes(p.ext)||"ON"===$.REEL_IMAGES_ENTRYPOINT_ENABLED&&bi.includes(p.ext),E=r&&S?a.replayActionHandler:void 0,T=r&&s?a.openDesktopActionHandler:void 0,f=r&&l&&_?c:void 0,O=r?a.openInNewTabActionHandler:void 0;return r?{actionType:o.ActionBarActionTypes.OPEN,isEnabled:!0,text:_?d.OPEN_ACTION_STRING:d.OPEN_IN_ACTION_STRING,icon:i.OpenLine,menu:{type:o.ActionBarMenuType.CUSTOM_DROPDOWN,menuContent:n.React$1.createElement(Bi,{user:e,file:p,telemetryContext:Fi,isInActionBar:!0,previewActionHandler:A,replayActionHandler:E,openInNewTabActionHandler:O,openDesktopActionHandler:T,goToFolderActionHandler:f})}}:void 0})),Bi=e=>Y.isBrowseFile(e.file)?n.React$1.createElement(j.WithUnity,{file:e.file,user:e.user,render:t=>n.React$1.createElement(j.ExtensionsPopoverContent,Object.assign({},e,{unityInfo:t}))}):n.React$1.createElement(j.ExtensionsPopoverContent,Object.assign({},e));Bi.displayName="OpenMenuContent";const Di="archive",Mi=(E.intl.formatMessage({id:"39qUu3",defaultMessage:"Make an archive"}),X.FileLine,(e,t,{shareToken:o,context:i,name:n})=>Z.convertFileAndShowSnackbar({file:e[0],user:t,shareToken:o,conversionType:Di,loggingFunctions:Z.getConversionLoggingFunctions(Di),getStrings:(t,o)=>Pi(t,e.length,e[0]),conversionFn:(t,o,r)=>B.__awaiter(void 0,void 0,void 0,(function*(){const t=yield Z.archive(o.id,e,n,i);return t?t.path:void 0}))})),Pi=(e,t,o)=>{const i=t>1?E.intl.formatMessage({id:"FtOEg9",defaultMessage:"Couldn't zip files"}):E.intl.formatMessage({id:"+GUWwR",defaultMessage:"Couldn't zip file"}),n=Z.getSuccessString(e,((e,o)=>t>1?E.intl.formatMessage({id:"8mHKZl",defaultMessage:"{numFiles} files zipped and saved as {fileName} in {dirName} folder"},{numFiles:t,fileName:e,dirName:o}):E.intl.formatMessage({id:"jZTSy9",defaultMessage:"{numFiles} file zipped and saved as {fileName} in {dirName} folder"},{numFiles:t,fileName:e,dirName:o})),(e=>t>1?E.intl.formatMessage({id:"oT9Ra2",defaultMessage:"{numFiles} files zipped and saved as {dirName} in your main Dropbox folder"},{numFiles:t,dirName:e}):E.intl.formatMessage({id:"hZllBo",defaultMessage:"{numFiles} file zipped and saved as {dirName} in your main Dropbox folder"},{numFiles:t,dirName:e})));return{saving:t>1?E.intl.formatMessage({id:"f8o64Y",defaultMessage:"Zipping files..."}):E.intl.formatMessage({id:"0pAwi/",defaultMessage:"Zipping file..."}),success:n,successAutomatedAdoption:n,failGeneric:i,failRetryable:i,failOverQuota:E.intl.formatMessage({id:"meIIGB",defaultMessage:"Couldn't zip because your Dropbox account is out of space"}),failTooLarge:t>1?E.intl.formatMessage({id:"JdMBky",defaultMessage:"Couldn't zip files. Can only handle files up to {fileSize} GB"},{fileSize:20}):E.intl.formatMessage({id:"Pi6R58",defaultMessage:"Couldn't zip file. Can only handle files up to {fileSize} GB"},{fileSize:20}),failCorrupt:E.intl.formatMessage({id:"FuOmGz",defaultMessage:"Couldn't zip because the file is damaged"}),failPassword:E.intl.formatMessage({id:"4tVWiT",defaultMessage:"Couldn't zip because the file is password protected"}),failPasswordLink:E.intl.formatMessage({id:"f77DNZ",defaultMessage:"Couldn't zip because the link is password-protected"})}},Ui=({action:e,files:t,user:o,context:r})=>{const[s,a]=n.react.exports.useState(!0),[c,l]=n.react.exports.useState(""),d=()=>{_()&&(Mi(t,o,{context:r,name:c}),a(!1))},_=()=>0!==c.length&&-1===c.indexOf("/")&&-1===c.indexOf("\\"),{defaultTitle:u,defaultSubtitle:p,primaryAction:A,secondaryAction:S,fileNameLabel:E,defaultFileNamePlaceholder:T}=xi(e);return n.React$1.createElement(i.Modal,{open:s,width:"small"},n.React$1.createElement(i.Modal.Header,{hasBottomSpacing:"title-standard"},n.React$1.createElement(i.Modal.Title,null,u)),n.React$1.createElement(i.Modal.Body,{hasVerticalSpacing:!1},n.React$1.createElement(i.Text,{id:"flows-create-file-name",variant:"paragraph"},p),n.React$1.createElement(J.Spacer,{multiplier:3}),n.React$1.createElement(i.Text,{variant:"paragraph",size:"small",isBold:!0},E),n.React$1.createElement(J.Spacer,{multiplier:1}),n.React$1.createElement(i.TextInput,{"aria-label":E,value:c,onChange:e=>{l(e.currentTarget.value)},onKeyPress:e=>{e.key===i.Key_enum.Key.Enter&&d()},placeholder:T})),n.React$1.createElement(i.Modal.Footer,null,n.React$1.createElement(i.Button,{variant:"opacity",onClick:()=>{a(!1)}},S),n.React$1.createElement(i.Button,{variant:"primary",onClick:d,disabled:!_()},A)))};Ui.displayName="CreateFileNameModal";const xi=e=>{const t=i.useIntl(),o={secondaryAction:t.formatMessage({id:"AcQYt9",defaultMessage:"Cancel"}),primaryAction:t.formatMessage({id:"iv8S9b",defaultMessage:"Save"}),fileNameLabel:t.formatMessage({id:"V4Y6/+",defaultMessage:"File name"}),defaultFileNamePlaceholder:t.formatMessage({id:"+KXywp",defaultMessage:"Archive folder"})};return Object.assign(Object.assign({},o),{defaultTitle:t.formatMessage({id:"5gN6rc",defaultMessage:"Zip files"}),defaultSubtitle:t.formatMessage({id:"kTxoco",defaultMessage:'The selected files will be saved as a single file with a "zip" extension.'})})};const ki=(e,t)=>{const{expFlowsManualArchive:o}=rt(e,t);return o&&gt(e,t)},Wi=(e,t)=>Ot(e,t)&&!At(e,t)&&!vt(e,t),Vi={actionType:o.ActionBarActionTypes.PERMANENT_DELETE,isEnabled:!0,text:d.PERMANENT_DELETE_ACTION_STRING,icon:ee.DeleteForeverLine},Gi=(e,t)=>Pt(e,t)&&gt(e,t)&&(Wt(e,t)?ut(e,t):!(Nt(e,t)||Rt(e,t)||Vt(e,t)||mt(e,t)));var Hi,qi;!function(e){e[e.FOLLOW=0]="FOLLOW",e[e.FOLLOWING=1]="FOLLOWING",e[e.REQUEST_FILES=2]="REQUEST_FILES",e[e.REWIND=3]="REWIND",e[e.VERSION_HISTORY=4]="VERSION_HISTORY",e[e.FILE_LOCK=5]="FILE_LOCK",e[e.FILE_UNLOCK=6]="FILE_UNLOCK",e[e.FILE_REQUEST_UNLOCK=7]="FILE_REQUEST_UNLOCK",e[e.ADD_FROM_GDRIVE=8]="ADD_FROM_GDRIVE"}(Hi||(Hi={})),function(e){e[e.FOLLOW=0]="FOLLOW",e[e.FOLLOWING=1]="FOLLOWING",e[e.REQUEST_FILES=2]="REQUEST_FILES",e[e.REWIND=3]="REWIND",e[e.VERSION_HISTORY=4]="VERSION_HISTORY",e[e.FILE_LOCK=5]="FILE_LOCK",e[e.FILE_UNLOCK=6]="FILE_UNLOCK",e[e.FILE_REQUEST_UNLOCK=7]="FILE_REQUEST_UNLOCK",e[e.ADD_FROM_GDRIVE=8]="ADD_FROM_GDRIVE"}(qi||(qi={}));const Ki=e=>{const{followMenuItem:t,followingMenuItem:o,requestFilesMenuItem:i,rewindMenuItem:n,versionHistoryMenuItem:r,fileLockMenuItem:s,fileUnlockMenuItem:a,fileRequestUnlockMenuItem:c,addFromGdriveActionMenuItem:l}=e;return{menuItems:[t,o,i,n,r,s,a,c,l].reduce(((e,t)=>t?[...e,t]:e),[])}};function Yi(e){const t=[];return t.push({menuItems:Ki(e).menuItems}),{type:o.ActionBarMenuType.DROPDOWN,menuSections:t}}const ji=(e,t)=>yt(e,t)?!qt(e,t)&&!tt(e,t).isInsideVaultFolder:xt(e,t)&&gt(e,t)&&!ht(e,t)&&!Rt(e,t)&&!Vt(e,t)&&!tt(e,t).isInsideVaultFolder&&!i.File.isReadOnlySharedFolder(et(e,t).first()),Qi=(e,t)=>tt(e,t).isCurrentPathWriteable(),$i=(e,t)=>ji(e,t)?{value:{type:o.ActionBarActionTypes.REQUEST_FILES,menuItem:qi.REQUEST_FILES},description:E.intl.formatMessage(d.REQUEST_FILES_ACTION_STRING),icon:oe.FileRequestLine,isEnabled:Qi(e,t)}:void 0,zi=(...t)=>new Promise((function(t,o){e(["./c_sync_everything_utils_restore_backup"],t,o)})).then((({restoreBackupContents:e})=>e(...t))),Zi=(e,t)=>{if(yt(e,t)||!Ot(e,t)||At(e,t)||Xi(e,t))return!1;const o=et(e,t).first().target_ns;return!(xt(e,t)&&o&&0!==o)||tt(e,t).currentNSAllowsNesting},Xi=(e,t)=>{const o=et(e,t),n=lt(e,t,o.first()),{expBackupImprovedRestorations:r}=i.browsePostTTIExperiments(e);if(i.isBackupBrowse()){if(!n)return!0;if(!i.isInsideEDB(o.first().fq_path)&&void 0===r)return!0}return!1};function Ji(e,t,o){let i=`${e}_${t}`;return o&&(i=`${e}_${o}_${t}`),i}function en(e,t,o){return B.__awaiter(this,void 0,void 0,(function*(){g.logBrowseTTS("share_file");const{user:n,isSearchMode:r}=t,s=e.action_surface||t.isSidebar?i.ActionSurfaceLogValue.RIGHT_SIDEBAR:i.ActionSurfaceLogValue.CENTER_PANE,a=t.files.first();e.skipLogging||re.logEventWithNumberOfFiles({file:a,user:n,isSearchMode:r,action:i.WebUserActionLogEvent.SHARE,action_source:e.action_source,action_surface:s,extra:e.extra}),i.UserSurvey.trackEvent("share_item","browse");const c=i.getStoreForBrowse(),{expFlowsApprovalFlowVariant:l,expFlowsApprovalInShareModal:d,expDocsendAnalyticsAddOn:_}=i.browsePostTTIExperiments(c.getState()),u=i.getStoreForSearch(),p=(()=>{const e=!(1!==t.files.count()||a.isDeleted||a.is_unmounted||a.is_dir||a.is_cloud_doc);if(r){const{flows_approval_flow:t,flows_approval_in_share_modal:o}=i.experiments$1(u.getState());return ce.isApprovalEnabled(t)&&o&&e}return ce.isApprovalEnabled(l)&&d&&e})();H.asyncShowShareModal(n,a,{browseContext:o,origin:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,showApproval:p,onCreateApprovalSuccess:()=>{if(r)return u.dispatch(i.setSelection({selection:i.createSelection([a.fq_path])})),void u.dispatch(i.setExpandedBlade("comments"));c.dispatch(P.setRightRailIsCollapsed(!1)),c.dispatch(P.selectFilesByFqPath({fqPathsToSelect:[a.fq_path]})),c.dispatch(P.expandBlade("comments"))},referrer:Ji(r?i.RetrievalSourceValue.SEARCH:i.RetrievalSourceValue.BROWSE,e.action_source,t.actionSurface),docsendAnalyticsAddOn:_},(({path:e,qargs:t})=>c.dispatch(P.setUrl({path:e,qargs:t}))))}))}const tn=(e,t)=>()=>{en({action_source:i.ActionSourceValue.SPLIT_SHARE,skipLogging:!0},e,t)},on=e=>(t,o)=>{const n=e.isSidebar?i.ActionSurfaceLogValue.RIGHT_SIDEBAR:i.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({args:e,action_type:i.WebUserActionLogEvent.SHARE,action_source:t,action_surface:n,extra:{splitshare_option:null!=o?o:null}}),i.UserSurvey.trackEvent("share_item","browse")},nn=e=>()=>{const t=e.isSidebar?i.ActionSurfaceLogValue.RIGHT_SIDEBAR:i.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({args:e,action_type:i.WebUserActionLogEvent.OPEN_SPLITSHARE,action_source:i.ActionSourceValue.SPLIT_SHARE,action_surface:t})};function rn(e,t){return()=>{i.logBrowseAction({uid:e.id,action:i.WebUserActionLogEvent.OPEN_SPLITSHARE,num_files_selected:0,num_folders_selected:0,action_surface:i.ActionSurfaceLogValue.RIGHT_SIDEBAR,action_source:i.ActionSourceValue.SPLIT_SHARE,right_sidebar_state:t?"collapsed":"opened"})}}function sn(e,t){return(o,n)=>{i.logBrowseAction({uid:e.id,action:i.WebUserActionLogEvent.SHARE,num_files_selected:0,num_folders_selected:0,action_surface:i.ActionSurfaceLogValue.RIGHT_SIDEBAR,action_source:o,right_sidebar_state:t?"collapsed":"opened",extra:{splitshare_option:null!=n?n:null}}),i.UserSurvey.trackEvent("share_item","browse")}}const an={surface:"action-bar"},cn=(e,t)=>dn(e,t),ln=(e,t)=>dn(e,t,!0),dn=(e,t,o=!1)=>{const i=tt(e,t),{expVaultEnableViewOnlySharing:n}=rt(e,t);return!at(e,t)&&(yt(e,t)?!(qt(e,t)||i.isCurrentlyInRoot||i.isInsideSandboxFolder||i.isInsideVaultFolder||i.isInFamilySharedFolder):(o||Pt(e,t))&&gt(e,t)&&!ht(e,t)&&!Rt(e,t)&&!Vt(e,t)&&!mt(e,t)&&(!i.isInsideVaultFolder||n)&&!kt(e,t)&&!Et(e,t))},_n=(e=!1)=>i.createSelector(ln,Je,et,tt,Qt,ot,jt,((t,r,s,a,c,l,_)=>{if(!t)return;if(0===s.count()&&!l)return;const u=0===s.count()?{files:l?[l]:[],logShareButtonClick:sn(r,_),onShowShare:()=>{ai(r,a)},onDropdownOpen:rn(r,_)}:{files:s.toArray(),onShowShare:tn(c,a),onDropdownOpen:nn(c),logShareButtonClick:on(c)},p={files:u.files,user:r,variant:"opacity",triggerType:i.TriggerType.SidebarPrimaryButton,onShowShare:u.onShowShare,onDropdownOpen:u.onDropdownOpen,logShareButtonClick:u.logShareButtonClick,context:an,shouldUsePortalPopover:!0,showLeftDigIcon:!0,retrievalSource:c.isSearchMode?i.RetrievalSourceValue.SEARCH:i.RetrievalSourceValue.BROWSE,actionSurface:c.actionSurface},A=e&&s.count()>1;return{actionType:o.ActionBarActionTypes.SHARE,isEnabled:0===s.count()||s.every((e=>i.File.canViewFileMembers(e,a))),text:A?d.SHARE_ALL_SELECTED_ACTION_STRING:d.SHARE_ACTION_STRING,icon:ne.ShareArrowLine,button:e?void 0:n.React$1.createElement(le.SplitShareButton,Object.assign({},p,{renderMenuOnly:!1,expActionBarRedesignEnabled:!0})),menu:e?{type:o.ActionBarMenuType.CUSTOM_DROPDOWN,menuContent:n.React$1.createElement(le.SplitShareButton,Object.assign({},p,{renderMenuOnly:!0}))}:void 0}})),un=(e,t)=>cn(e,t),pn=()=>i.createSelector(un,et,tt,st,rt,ot,i.browsePostTTIExperiments,((e,t,n,r,s,a,c)=>{var l;const _=(e=>{if(e){const t=e.split("/");return t[t.length-1]}})((null===(l=t.first())||void 0===l?void 0:l.fq_path)||(null==a?void 0:a.fq_path)),u="ON"===c.expCopyLinkInRightRail||"ON"===s.expCopyLinkInRightRail?E.intl.formatMessage(d.SHARE_COPY_LINK_ACTION_TOOLTIP_RIGHT_RAIL_EXPT,{currentContentName:_}):E.intl.formatMessage(d.SHARE_COPY_LINK_ACTION_TOOLTIP);return e?{actionType:o.ActionBarActionTypes.SHARE_COPY_LINK,isEnabled:!r&&t.every((e=>i.File.canViewFileMembers(e,n))),text:d.SHARE_COPY_LINK_ACTION_STRING,icon:de.LinkLine,tooltip:u}:void 0})),An=()=>i.createSelector(cn,et,tt,((e,t,n)=>e?{actionType:o.ActionBarActionTypes.SHARE_MODAL,isEnabled:t.every((e=>i.File.canViewFileMembers(e,n))),text:d.SHARE_ACTION_STRING,icon:ne.ShareArrowLine}:void 0)),Sn=(e,t)=>Pt(e,t)&&gt(e,t)&&!mt(e,t)&&!tt(e,t).isInsideVaultFolder&&!i.getIsStarred(e,et(e,t).first().file_id),En={actionType:o.ActionBarActionTypes.UNSTAR,isEnabled:!0,text:d.UNSTAR_ACTION_STRING,icon:pe.StarFill},Tn=(e,t)=>Pt(e,t)&&gt(e,t)&&!mt(e,t)&&!tt(e,t).isInsideVaultFolder&&i.getIsStarred(e,et(e,t).first().file_id),fn={actionType:o.ActionBarActionTypes.VERSION_HISTORY,isEnabled:!0,text:d.VERSION_HISTORY_ACTION_STRING,icon:i.ClockLine},On=(e,t)=>{const o=et(e,t).first(),n=dt(e,t);return!(i.isBackupBrowse()&&!n)&&(Ut(e,t)&&gt(e,t)&&!mt(e,t)&&(!ft(e,t)||!i.isPointerByExtension(o.ns_path))&&!Rt(e,t)&&"third_party"!==(null==n?void 0:n.type))},In=(e,t)=>On(e,t)?{value:{type:o.ActionBarActionTypes.VERSION_HISTORY,menuItem:qi.VERSION_HISTORY},description:E.intl.formatMessage(d.VERSION_HISTORY_ACTION_STRING),icon:i.ClockLine,isEnabled:!0}:void 0,mn=[".doc",".docx",".pdf",".ppsx",".ppt",".pptx",".jpg",".jpeg",".png",".xls",".xlsx",".txt",".html",".gif"],gn=(e,t)=>{const o=Qt(e,t),{files:i,user:n}=o,r=i.first(),s=mn.includes(r.ext);return n&&wt(e,t)&&s&&!F.is_supported_mobile_browser()&&Ee.isSendForSignatureEnabled(e)},yn=()=>i.createSelector(gn,Yt,((e,t)=>e?(e=>({actionType:o.ActionBarActionTypes.SELF_SIGN_ACTION,isEnabled:!0,text:d.SELF_SIGN_ACTION_STRING,icon:Se.SignatureLine,isSuggestedWorkflow:e,suggestedWorkflowsTooltipContents:e?{imageUrl:n.static_url("/static/metaserver/static/js/action_bar/assets/suggested_workflow_self_sign-vfll3A8ns.png"),label:d.SELF_SIGN_SUGGESTED_WORKFLOW_TOOLTIP_STRING}:void 0}))(t):void 0)),vn=(e,t)=>{const o=Qt(e,t),{files:i,user:n}=o,r=i.first(),s=mn.includes(r.ext);return n&&wt(e,t)&&s&&!F.is_supported_mobile_browser()&&Ee.isSendForSignatureEnabled(e)},Rn=()=>i.createSelector(vn,Yt,((e,t)=>e?(e=>({actionType:o.ActionBarActionTypes.SEND_FOR_SIGNATURE,isEnabled:!0,text:d.SEND_FOR_SIGNATURE_ACTION_STRING,icon:Ae.SendLine,isSuggestedWorkflow:e,suggestedWorkflowsTooltipContents:e?{imageUrl:n.static_url("/static/metaserver/static/js/action_bar/assets/suggested_workflow_send_for_signature-vfl0aSawI.png"),label:d.SEND_FOR_SIGNATURE_SUGGESTED_WORKFLOW_TOOLTIP_STRING}:void 0}))(t):void 0)),Fn=e=>e===t.FolderSubscriptionState.FOLLOWING||e===t.FolderSubscriptionState.FOLLOWING_PARENT,Nn=(e,t)=>{const o=ni().getState();if(yt(e,t)){const i=tt(e,t).currentFQPath;return Vo(o,i)}if(xt(e,t)){const i=et(e,t).first().fq_path;return Vo(o,i)}},hn=(e,t)=>{var o;return null===(o=Nn(e,t))||void 0===o?void 0:o.subscriptionState},Ln=(e,t)=>{if(tt(e,t).isInsideVaultFolder)return!1;let o;if(yt(e,t))o=i.getBrowseState(e).currentFolderInfo;else{if(!xt(e,t))return!1;o=et(e,t).first()}const n=null==o?void 0:o.type;if(n===i.FileTypes.SHARED_FOLDER||n===i.FileTypes.TEAM_SHARED_FOLDER||n===i.FileTypes.FAMILY_SHARED_FOLDER){const e=null==o?void 0:o._mount_access_perms;return(null==e?void 0:e.includes("can_view"))&&(null==e?void 0:e.includes("can_view_members"))}return n===i.FileTypes.FOLDER&&cn(e,t)};var bn;!function(e){e.OPTIONS="options",e.UNFOLLOW="unfollow"}(bn||(bn={}));const Cn=[{menuItems:[{value:{type:o.ActionBarActionTypes.FOLLOWING,menuItem:bn.OPTIONS},description:E.intl.formatMessage({id:"Us//SY",defaultMessage:"Manage options"})},{value:{type:o.ActionBarActionTypes.FOLLOWING,menuItem:bn.UNFOLLOW},description:E.intl.formatMessage({id:"j5oJ6S",defaultMessage:"Unfollow"})}]}],wn={type:o.ActionBarMenuType.SPLIT_BUTTON,menuSections:Cn},Bn=(e,t)=>{if(!hn(e,t))return!1;const o=tt(e,t);if(yt(e,t))return o.isInsideTeamFolderTree||o.isInsideSharedFolder||o.isInsideFamilySharedFolder;if(xt(e,t)){const n=et(e,t).first();return n.type===i.FileTypes.SHARED_FOLDER||n.type===i.FileTypes.TEAM_SHARED_FOLDER||n.type===i.FileTypes.FAMILY_SHARED_FOLDER||n.type===i.FileTypes.FOLDER&&o.isInsideSharedFolder}return!1},Dn=(e,t)=>{if(!Ln(e,t))return!1;const o=hn(e,t);return!o||!Fn(o)},Mn=(e,o)=>{var i;return!Bn(e,o)&&(null===(i=((e,t)=>{const o=ni().getState();if(yt(e,t)){const i=tt(e,t).currentFQPath;return ko(o,i)}if(xt(e,t)){const i=et(e,t).first().fq_path;return ko(o,i)}})(e,o))||void 0===i?void 0:i.status)===t.RequestFlightStatus.READY},Pn=E.intl.formatMessage({id:"x/e6Ro",defaultMessage:"Share this folder to be able to receive activity updates."}),Un=(e,t)=>Dn(e,t)?{value:{type:o.ActionBarActionTypes.FOLLOW,menuItem:qi.FOLLOW},description:E.intl.formatMessage(d.FOLLOW_ACTION_STRING),icon:r.FollowLine,isEnabled:Bn(e,t),disabledTooltip:Mn(e,t)?Pn:void 0}:void 0;const xn=(e,o)=>hn(e,o)===t.FolderSubscriptionState.FOLLOWING,kn=(e,t)=>{if(!Ln(e,t))return!1;const o=hn(e,t);return!!o&&Fn(o)},Wn=(e,t)=>{const o=Nn(e,t),n=null==o?void 0:o.followingPath;if(n)return i.filename(n)},Vn=(e,t)=>E.intl.formatMessage({id:"7mcdEU",defaultMessage:'To unfollow, visit "{folderName}".'},{folderName:Wn(e,t)}),Gn=(e,t)=>kn(e,t)?{value:{type:o.ActionBarActionTypes.FOLLOWING,menuItem:qi.FOLLOWING},description:E.intl.formatMessage(d.FOLLOWING_ACTION_STRING),icon:r.FollowLine,isEnabled:xn(e,t),disabledTooltip:xn(e,t)?void 0:Vn(e,t),submenuSections:xn(e,t)?Cn:void 0}:void 0;function Hn(e){return!e.paid&&!e.is_team}const qn=(e,t)=>(((e,t)=>yt(e,t)&&(i.experiments(e).folderHistoryRollbacks||Hn(Je(e,t))))(e,t)||((e,t)=>xt(e,t)&&gt(e,t)&&(i.experiments(e).folderHistoryRollbacks||Hn(Je(e,t))))(e,t))&&!Kn(e,t),Kn=(e,t)=>{const o=dt(e,t),n=yt(e,t),r=tt(e,t).currentFQPath,s=ot(e,t);return!(!i.isBackupBrowse()||o&&((e,t,o)=>{let n=null==t?void 0:t.nestLevel;if(!n){if(!o||"/"===o)return!0;n=i.depth(o)}return!(e&&0===n||"edb"===(null==t?void 0:t.type)&&e&&-1===n&&i.depth(o)<=2)})(n,o,r))||(!(o||!(null==s?void 0:s.is_in_backup_folder))||!!("cb"===(null==o?void 0:o.type)&&0===o.nestLevel||"third_party"===(null==o?void 0:o.type)||"edb"===(null==o?void 0:o.type)&&0===o.nestLevel||((e,t)=>"edb"===(null==e?void 0:e.type)&&-1===(null==e?void 0:e.nestLevel)&&i.depth(t)<=1)(o,r)))},Yn=(e,t)=>yt(e,t)?i.isRewindButtonEnabled$1(e):Mt(e,t),jn=(e,t)=>qn(e,t)?{value:{type:o.ActionBarActionTypes.REWIND,menuItem:qi.REWIND},description:E.intl.formatMessage(d.REWIND_ACTION_STRING),icon:Te.RewindLine,isEnabled:Yn(e,t)}:void 0,Qn=(e,t)=>{if(!Ut(e,t))return!1;const o=et(e,t).first(),n=o.ns_id!==Je(e,t).home_ns_id,r=o.is_locked||o.read_only||o.is_symlink||!n;return gt(e,t)&&i.browsePostTTIExperiments(e).expShowFileLocking&&!r},$n={actionType:o.ActionBarActionTypes.FILE_LOCK,isEnabled:!0,text:d.FILE_LOCK_ACTION_STRING,icon:fe.LockLine},zn=(e,t)=>Qn(e,t)?{value:{type:o.ActionBarActionTypes.FILE_LOCK,menuItem:qi.FILE_LOCK},description:E.intl.formatMessage(d.FILE_LOCK_ACTION_STRING),icon:fe.LockLine,isEnabled:!0}:void 0,Zn=(e,t)=>{const o=et(e,t).first();return Ut(e,t)&&gt(e,t)&&o.is_locked&&o.is_lockholder},Xn={actionType:o.ActionBarActionTypes.FILE_UNLOCK,isEnabled:!0,text:d.FILE_UNLOCK_ACTION_STRING,icon:r.LockOpenLine},Jn=(e,t)=>Zn(e,t)?{value:{type:o.ActionBarActionTypes.FILE_UNLOCK,menuItem:qi.FILE_UNLOCK},description:E.intl.formatMessage(d.FILE_UNLOCK_ACTION_STRING),icon:r.LockOpenLine,isEnabled:!0}:void 0,er=(e,t)=>{const o=et(e,t).first();return Ut(e,t)&&gt(e,t)&&o.is_locked&&!o.is_lockholder},tr={actionType:o.ActionBarActionTypes.FILE_REQUEST_UNLOCK,isEnabled:!0,text:d.FILE_REQUEST_UNLOCK_ACTION_STRING,icon:r.LockOpenLine},or=(e,t)=>er(e,t)?{value:{type:o.ActionBarActionTypes.FILE_REQUEST_UNLOCK,menuItem:qi.FILE_REQUEST_UNLOCK},description:E.intl.formatMessage(d.FILE_REQUEST_UNLOCK_ACTION_STRING),icon:r.LockOpenLine,isEnabled:!0}:void 0;function ir(e,t){return function(e){const t=i.experiments(e).fileImportsEntryPointsActivityMenu;return"V1"===t||"V2"===t}(e)}function nr(e,t){return Dt(e,t)}function rr(e,t){return ir(e)?{value:{type:o.ActionBarActionTypes.ADD_FROM_GDRIVE,menuItem:qi.ADD_FROM_GDRIVE},description:E.intl.formatMessage(d.ADD_FROM_GDRIVE_ACTION_STRING),icon:r.CloudUploadLine,isEnabled:nr(e,t)}:void 0}const sr=(e,t)=>Dn(e,t)||kn(e,t)||ji(e,t)||qn(e,t)||On(e,t)||Qn(e,t)||Zn(e,t)||er(e,t)||ir(e);function ar(e){return e?e*ar(e-1):1}var cr;let lr;function dr(e){const t=[{value:{type:o.ActionBarActionTypes.SPACES_DROPDOWN,menuItem:{value:cr.NEW_SPACES,index:0}},description:"Create a project",icon:n.React$1.createElement(i.UIIcon,{src:Oe.AddFolderLine})},{value:{type:o.ActionBarActionTypes.SPACES_DROPDOWN,menuItem:{value:cr.CLIENT_UPDATE,index:1}},description:"Client update",icon:n.React$1.createElement(i.UIIcon,{src:S.CommentLine})},{value:{type:o.ActionBarActionTypes.SPACES_DROPDOWN,menuItem:{value:cr.GET_FEECBACK,index:2}},description:"Share with client",icon:n.React$1.createElement(i.UIIcon,{src:Ie.HighlightLine})},{value:{type:o.ActionBarActionTypes.SPACES_DROPDOWN,menuItem:{value:cr.HANDOFF_WORK,index:3}},description:"Assign task",icon:n.React$1.createElement(i.UIIcon,{src:r.ToDoLine})}];lr||(lr=function(e){const t=[...e],o=t.length,i=[t.slice()],n=new Array(o).fill(0);let r,s,a=1;for(;a<o;)n[a]<a?(r=a%2&&n[a],s=t[a],t[a]=t[r],t[r]=s,++n[a],a=1,i.push(t.slice())):(n[a]=0,++a);return i}([0,1,2,3])[e%ar(t.length)]);const s=lr.map(((e,o)=>(t[e].value.menuItem.index=o,t[e])));return{type:o.ActionBarMenuType.DROPDOWN,menuSections:[{menuItems:s}]}}!function(e){e[e.NEW_SPACES=0]="NEW_SPACES",e[e.CLIENT_UPDATE=1]="CLIENT_UPDATE",e[e.GET_FEECBACK=2]="GET_FEECBACK",e[e.HANDOFF_WORK=3]="HANDOFF_WORK"}(cr||(cr={}));const _r=(e,t)=>{const o=tt(e,t),{expSpacesFssDropdown:i}=rt(e,t);return i&&yt(e,t)&&!qt(e,t)&&!o.isCurrentlyInRoot&&!o.isInsideSandboxFolder&&!o.isInsideVaultFolder&&!o.isInFamilySharedFolder},ur=(e,t)=>{const{expFlowsApprovalFlowVariant:o,expFlowsApprovalAndVersioningNewBadgeVariant:i,expFlowsApprovalCopyVariant:n}=rt(e,t),r=et(e,t).first();return{showRequestApprovalAction:ce.isApprovalEnabled(o)&&gt(e,t)&&Ut(e,t)&&!r.is_dir&&!r.is_cloud_doc,showNewBadge:"APPROVAL"===i,requestApprovalString:ce.approvalCopyExperimentString(n)}},pr={actionType:o.ActionBarActionTypes.ADD_TO_COLLECTION,isEnabled:!0,text:d.ADD_TO_COLLECTION_STRING,icon:Re.AddToCollectionLine},Ar=(e,t)=>wt(e,t)&&gt(e,t),Sr=(e,t)=>Ar(e,t)&&i.browsePostTTIExperiments(e).expCollectionsInBrowse,Er=(e,t)=>Ar(e,t)&&i.searchCollectionsFileAction(e),Tr=e=>i.getDisplayedFilename(i.filename(e.fq_path)),fr=(e,t,o)=>{const n=0===e.nestLevel;if(!t.length||n&&t.length>1)return;const r=i.mustGetActiveUser(),s=0===e.nestLevel&&e.displayName?e.displayName:Tr(t[0]),a=t.map((e=>Object.assign(Object.assign({},e),{fq_path:`/${Tr(e)}`}))),c=(i,r,s)=>Le.logEvent({event:i,page_source:o,extra:{id:e.id,backup_type:e.type,copy_type:n?"device":t.length>1?"multiple":t[0].is_dir?"folder":"file",reason:r,time_complete:s}});c("click_copy_to_fss"),I.showMoveDialog({onSuccess:()=>{},onCancel:()=>{},user:r,createNewFolderInMoveDialog:!0,useDigModal:!0,operation:i.Operation.COPY,modalName:Ne.ModalName.COPY,initialFolderSelection:"/",entries:a,apiClient:{getFolderContents:i.getFolderContentsAPIv2,moveToFolder:a=>{const l=()=>B.__awaiter(void 0,void 0,void 0,(function*(){var l;let d=a,_=[...t];const u=1===t.length?s:t.length,p="copy-backup-to-fss",A=he.COPY_TO_FSS.SNACKBAR(u,i.filename(d),i.fssUrlForFqPath(d));i.Snackbar.sync(A.PROGRESS,!0,p);const S=(()=>{const e=performance.now();return()=>(performance.now()-e)/1e3})();c("copy_to_fss_start");try{const[{folder_sizes:e},t,s]=yield Promise.all([(new i.UserApiV2Client).ns("folders_info").rpc("get_folder_sizes",{paths:_.filter((e=>void 0!==e.file_id&&e.is_dir)).map((e=>e.file_id)),allow_unmounted_ns:!0},{subjectUserId:r.id}),qe(r),Ke(r)]),a=e.reduce(((e,t)=>e+t.size),0),l=_.filter((e=>!e.is_dir)).reduce(((e,t)=>{var o;return e+(null!==(o=t.bytes)&&void 0!==o?o:0)}),0),E=a+l;if((null==s?void 0:s.allocated)&&(null==s?void 0:s.used)){if(s.allocated-s.used-E<0)return i.Snackbar.close(p),I.showUpgradeProductPlanModal({userSKU:t,destPath:i.filename(d),nameOrCount:u,isDevice:n,showOverQuotaSnackbar:()=>i.Snackbar.fail(A.FAIL_QUOTA,p),source:o}),void c("copy_to_fss_overquota",void 0,S())}}catch(e){c("copy_to_fss_skip_quota_check",void 0,S())}if(n)try{const[o,n]=yield Promise.all([i.createFolder(d,s,r,!0),i.loadPath2({userId:r.id,path:t[0].fq_path,sortType:{".tag":"files_by_name"},sortIsAscending:!0,includeDeleted:!1,rootNsId:null!==(l=e.rootNsId)&&void 0!==l?l:r.root_ns_id})]);if(o.isError)return i.Snackbar.fail(A.FAIL,p),void c("copy_to_fss_failure","createFolder",S());if(!n.items.length)return i.Snackbar.complete(A.SUCCESS,p),void c("copy_to_fss_success",void 0,S());d=`${d}/${s}`,_=n.items}catch(e){return i.Snackbar.fail(A.FAIL,p),void c("copy_to_fss_failure","loadPath2",S())}try{const e=yield i.copyFiles(_.map((e=>{var t,o;return{file_id:e.file_id,fq_path:null!==(t=e.fq_path)&&void 0!==t?t:"",is_dir:null!==(o=e.is_dir)&&void 0!==o&&o}})),d,r.id);e.isError?(i.Snackbar.fail(A.FAIL,p),c("copy_to_fss_failure","copyFiles",S())):(i.Snackbar.complete(A.SUCCESS,p),c("copy_to_fss_success",void 0,S()))}catch(e){i.Snackbar.fail(A.FAIL,p),c("copy_to_fss_failure","copyFiles - catch",S())}}));return B.__awaiter(void 0,void 0,void 0,(function*(){const e=()=>{c("copy_to_fss_close_before_finished")};try{addEventListener("beforeunload",e),yield l()}finally{removeEventListener("beforeunload",e)}})),Promise.resolve()}}})},Or=(e,t)=>{const o=et(e,t);if(o.count()){return{backup:lt(e,t,o.first()),files:o.toArray()}}const i=ot(e,t);if(i){return{backup:lt(e,t,i),files:[i]}}return null},Ir=(e,t)=>{const{expBackupCopyToFSS:o}=i.browsePostTTIExperiments(e),n=Or(e,t);return!(i.isBackupBrowse()&&!(null==n?void 0:n.backup))&&(!!o&&!!(null==n?void 0:n.backup)&&n.files.every((e=>!e.isDeleted))&&"third_party"!==(null==n?void 0:n.backup.type))},mr=(e,t)=>{const o=et(e,t).first();return Z.canConvertFile(o)&&be.UnzipAction.selector([o])};function gr(e,t){if(!yt(e,t)){const o=Je(e,t),n=et(e,t).first(),r=Xe(0,t),s=r===i.ActionSurfaceLogValue.INLINE_ACTION_BAR||r===i.ActionSurfaceLogValue.RIGHT_CLICK_MENU?i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS;Fr(Ce.TiburonEventName.ClickManagePermissionsAction,s,n,o),li(o,n,s)}}const yr=(e,t)=>{const o=tt(e,t),{expVaultEnableViewOnlySharing:n}=i.browsePostTTIExperiments(e);return Pt(e,t)&&gt(e,t)&&!ht(e,t)&&!Rt(e,t)&&!mt(e,t)&&!It(e,t)&&!(o.isInsideFamilySharedFolder&&Bt(e,t))&&!kt(e,t)&&!Et(e,t)&&!ct(e,t)&&!at(e,t)&&!Vt(e,t)&&!(o.isInsideVaultFolder&&!n)},vr=(e,t)=>!bt(e,t),Rr=()=>i.createSelector(yr,vr,((e,t)=>e?{actionType:o.ActionBarActionTypes.MANAGE_PERMISSIONS,isEnabled:t,text:d.MANAGE_PERMISSIONS_ACTION_STRING,icon:i.PersonMultipleLine}:void 0)),Fr=(e,t,o,n)=>i.ShareTibEventLogger.log(n.id,e,t,{file_id:o.file_id,fq_path:o.fq_path,ns_id:o.target_ns?o.target_ns:void 0}),Nr={actionType:o.ActionBarActionTypes.OPEN_IN_REPLAY,isEnabled:!0,text:d.OPEN_IN_REPLAY_STRING,icon:we.DropboxReplayLine,showNewBadge:!0},hr=(e,t)=>{const o=Qt(e,t),{files:n,user:r}=o,s=n.first(),a="VIDEO"===i.ExtensionCategories[Y.getExtension(s)]||"AUDIO"===i.ExtensionCategories[Y.getExtension(s)]||"IMAGE"===i.ExtensionCategories[Y.getExtension(s)];return r&&"ON"===t.experimentSelector(e).expReplayBrowseAction&&Ut(e,t)&&gt(e,t)&&a};let Lr=!1;const br={actionType:o.ActionBarActionTypes.EDIT_IMAGE,isEnabled:!0,text:d.EDIT_IMAGE_ACTION_STRING,icon:R.EditLine,showNewBadge:!1},Cr=(e,t)=>{const o=Qt(e,t),{files:n,user:r}=o,s=n.first(),a=s.ext.replace(".",""),c=s.href.includes("/s/")||s.href.includes("/scl/"),l=Be.VALID_PHOTO_FILE_EXTENSIONS.has(a)&&!c,d=t.experimentSelector(e).expImageEditEntryPoint,_=r&&Ut(e,t)&&l&&!F.is_mobile_or_tablet();return!_||"V1"!==d&&"CONTROL"!==d||Lr||(i.logExposure({feature:"core_attach_mpa_image_edit_entrypoint",variant:d}),Lr=!0),_&&"V1"===d},wr=()=>({[o.ActionBarActionTypes.RENAME]:i.createSelector(Gi,tt,et,((e,t,i)=>e?{actionType:o.ActionBarActionTypes.RENAME,isEnabled:t.isCurrentPathWriteable()&&!i.some((e=>e.read_only)),text:d.RENAME_ACTION_STRING,icon:te.CursorLine}:void 0)),[o.ActionBarActionTypes.DOWNLOAD]:i.createSelector(et,To,((e,t)=>t?{actionType:o.ActionBarActionTypes.DOWNLOAD,isEnabled:e.some((e=>!i.File.isNoAccessSharedFolder(e))),text:d.DOWNLOAD_ACTION_STRING,icon:v.DownloadLine}:void 0)),[o.ActionBarActionTypes.COMMENT]:i.createSelector(lo,(e=>e?{actionType:o.ActionBarActionTypes.COMMENT,isEnabled:!0,text:d.COMMENT_ACTION_STRING,icon:S.CommentLine}:void 0)),[o.ActionBarActionTypes.EVENTS]:i.createSelector(tt,et,Io,((e,t,n)=>n?{actionType:o.ActionBarActionTypes.EVENTS,isEnabled:t.every((t=>i.File.canViewFileMembers(t,e))),text:d.EVENTS_ACTION_STRING,icon:r.ActivityLine}:void 0)),[o.ActionBarActionTypes.VERSION_HISTORY]:i.createSelector(On,(e=>e?fn:void 0)),[o.ActionBarActionTypes.COPY]:i.createSelector(et,_o,((e,t)=>{const n=e.count(),r=f.MAX_NUM_FILES_SELECTED,s=n>r,a=e.some((e=>!i.File.isNoAccessSharedFolder(e))),c=a&&!s;let l;return a&&s&&(l=E.intl.formatMessage(d.TOO_MANY_SELECTED_ITEMS_STRING,{actionStr:"Copy",num:r})),t?{actionType:o.ActionBarActionTypes.COPY,isEnabled:c,disabledTooltip:l,text:d.COPY_ACTION_STRING,icon:T.CopyLine}:void 0})),[o.ActionBarActionTypes.MOVE]:i.createSelector(tt,et,mi,((e,t,i)=>{const n=t.count(),r=f.MAX_NUM_FILES_SELECTED,s=n>r,a=!e.isCurrentPathWriteable()||t.some((e=>e.read_only)),c=!a&&!s;let l;return!a&&s&&(l=E.intl.formatMessage(d.TOO_MANY_SELECTED_ITEMS_STRING,{actionStr:"Move",num:r})),i?{actionType:o.ActionBarActionTypes.MOVE,isEnabled:c,disabledTooltip:l,text:d.MOVE_ACTION_STRING,icon:K.MoveLine}:void 0})),[o.ActionBarActionTypes.DELETE]:i.createSelector(tt,et,Ao,((e,t,i)=>{const n=t.count(),r=f.MAX_NUM_FILES_SELECTED,s=n>r,a=!e.isCurrentPathWriteable()||t.some((e=>e.read_only)),c=!a&&!s;let l;return!a&&s&&(l=E.intl.formatMessage(d.TOO_MANY_SELECTED_ITEMS_STRING,{actionStr:"Delete",num:r})),i?{actionType:o.ActionBarActionTypes.DELETE,isEnabled:c,disabledTooltip:l,text:d.DELETE_ACTION_STRING,icon:y.DeleteLine}:void 0})),[o.ActionBarActionTypes.REMOVE]:i.createSelector(tt,et,po,((e,t,i)=>i?{actionType:o.ActionBarActionTypes.REMOVE,isEnabled:e.isCurrentPathWriteable()&&!t.some((e=>e.read_only)),text:d.REMOVE_ACTIION_STRING,icon:y.DeleteLine}:void 0)),[o.ActionBarActionTypes.RESTORE]:i.createSelector(Zi,tt,et,((e,t,i)=>e?{actionType:o.ActionBarActionTypes.RESTORE,isEnabled:t.isCurrentPathWriteable()&&!i.some((e=>e.read_only)),text:d.RESTORE_ACTION_STRING,icon:ie.RestoreLine}:void 0)),[o.ActionBarActionTypes.PERMANENT_DELETE]:i.createSelector(Wi,(e=>e?Vi:void 0)),[o.ActionBarActionTypes.STAR]:i.createSelector(Sn,et,((e,t)=>e?{actionType:o.ActionBarActionTypes.STAR,isEnabled:!i.File.isNoAccessSharedFolder(t.first()),text:d.STAR_ACTION_STRING,icon:i.StarLine}:void 0)),[o.ActionBarActionTypes.UNSTAR]:i.createSelector(Tn,(e=>e?En:void 0)),[o.ActionBarActionTypes.OPEN]:wi(),[o.ActionBarActionTypes.ARCHIVE]:i.createSelector(ro,(e=>e?no:void 0)),[o.ActionBarActionTypes.GO_TO_FOLDER]:i.createSelector(et,Ro,((e,t)=>t?vo:void 0)),[o.ActionBarActionTypes.MANAGE_AS_ADMIN]:i.createSelector(Oi,(e=>e?Ii:void 0)),[o.ActionBarActionTypes.REQUEST_FILES]:i.createSelector(ji,Qi,((e,t)=>e?{actionType:o.ActionBarActionTypes.REQUEST_FILES,isEnabled:t,text:d.REQUEST_FILES_ACTION_STRING,icon:oe.FileRequestLine}:void 0)),[o.ActionBarActionTypes.OPEN_MAC_DESKTOP]:i.createSelector(Ri,(e=>F.mac&&e?yi:void 0)),[o.ActionBarActionTypes.OPEN_WINDOWS_DESKTOP]:i.createSelector(Ri,(e=>!F.mac&&e?vi:void 0)),[o.ActionBarActionTypes.SAVE_AS]:i.createSelector(mo,go,((e,t)=>e&&t.length>0?{actionType:o.ActionBarActionTypes.SAVE_AS,text:d.FILE_CONVERSION_STRING,icon:N.ConvertFileLine,isEnabled:!0,menu:{type:o.ActionBarMenuType.DROPDOWN,menuSections:t.map((e=>({menuItems:e})))}}:void 0)),[o.ActionBarActionTypes.UNZIP]:i.createSelector(Ut,gt,Ze,mr,((e,t,i,n)=>e&&t&&!i&&n?{actionType:o.ActionBarActionTypes.UNZIP,text:d.UNZIP_ACTION_STRING,icon:be.UnzipAction.actionIcon,isEnabled:!0}:void 0)),[o.ActionBarActionTypes.EDIT_FOLDER_AUTOMATION]:co("edit"),[o.ActionBarActionTypes.ADD_FOLDER_AUTOMATION]:co("add"),[o.ActionBarActionTypes.CONVERT_TO_ARCHIVE]:i.createSelector(ki,(e=>e?{actionType:o.ActionBarActionTypes.CONVERT_TO_ARCHIVE,text:d.CONVERT_TO_ARCHIVE_ACTION_STRING,icon:z.ZipLine,isEnabled:!0}:void 0)),[o.ActionBarActionTypes.SHARE]:_n(!0),[o.ActionBarActionTypes.SHARE_COPY_LINK]:pn(),[o.ActionBarActionTypes.REQUEST_APPROVAL]:i.createSelector(ur,(e=>{const{showRequestApprovalAction:t,showNewBadge:i,requestApprovalString:n}=e;return t?{actionType:o.ActionBarActionTypes.REQUEST_APPROVAL,text:n,icon:ge.ThumbsUpLine,isEnabled:!0,tooltip:E.intl.formatMessage(d.REQUEST_APPROVAL_TOOLTIP),showNewBadge:i}:void 0})),[o.ActionBarActionTypes.SEND_FOR_SIGNATURE]:Rn(),[o.ActionBarActionTypes.SELF_SIGN_ACTION]:yn(),[o.ActionBarActionTypes.ACTIVITY]:i.createSelector(sr,Un,Gn,$i,jn,In,zn,Jn,or,rr,((e,t,i,n,s,a,c,l,_,u)=>e?{actionType:o.ActionBarActionTypes.ACTIVITY,isEnabled:!0,text:d.ACTIVITY_ACTION_STRING,icon:r.ActivityLine,menu:Yi({followMenuItem:t,followingMenuItem:i,requestFilesMenuItem:n,rewindMenuItem:s,versionHistoryMenuItem:a,fileLockMenuItem:c,fileUnlockMenuItem:l,fileRequestUnlockMenuItem:_,addFromGdriveActionMenuItem:u})}:void 0)),[o.ActionBarActionTypes.EDIT_PDF]:Oo(),[o.ActionBarActionTypes.BACKUP_COPY_TO_FSS]:i.createSelector(Ir,Or,((e,t)=>{var i,n;const s=0===(null===(i=null==t?void 0:t.backup)||void 0===i?void 0:i.nestLevel),a=(null!==(n=null==t?void 0:t.files.length)&&void 0!==n?n:0)>1;if(!e||!(null==t?void 0:t.backup)||s&&a)return;let c=d.BACKUP_COPY_TO_FSS.FILE;return a?c=d.BACKUP_COPY_TO_FSS.MULTIPLE:s?c=d.BACKUP_COPY_TO_FSS.DEVICE:t.files[0].is_dir&&(c=d.BACKUP_COPY_TO_FSS.FOLDER),{actionType:o.ActionBarActionTypes.BACKUP_COPY_TO_FSS,isEnabled:!0,text:c,icon:r.DuplicateLine}})),[o.ActionBarActionTypes.MANAGE_PERMISSIONS]:Rr(),[o.ActionBarActionTypes.OPEN_IN_REPLAY]:i.createSelector(hr,(e=>e?Nr:void 0)),[o.ActionBarActionTypes.EDIT_IMAGE]:i.createSelector(Cr,(e=>e?br:void 0))}),Br={[o.ActionBarActionTypes.RENAME]:(e,t)=>{g.logBrowseTTS("rename_file");et(e,t).first().type===i.FileTypes.TEAM_SHARED_FOLDER?l.handleRenameTeamFolder(Qt(e,t)):l.handleRename(Qt(e,t))},[o.ActionBarActionTypes.DOWNLOAD]:(e,t)=>{const o=tt(e,t);l.handleDownload(Qt(e,t),o)},[o.ActionBarActionTypes.COMMENT]:(e,t)=>{l.handleComment(Qt(e,t))},[o.ActionBarActionTypes.EVENTS]:(e,t)=>{l.handleEvents(Qt(e,t))},[o.ActionBarActionTypes.VERSION_HISTORY]:(e,t)=>{l.handleVersions(Qt(e,t))},[o.ActionBarActionTypes.COPY]:(e,t)=>{const o=tt(e,t),{isOverFreeQuota:n,hasExcludedNsIds:r}=nt(e,t);((e,t,o)=>{var n;const{isOverFreeQuota:r,hasExcludedNsIds:s}=o;if(r&&!s){const o=t.currentNSID,n=e.user.id;return void I.showOverquota("wb_oq_mv_cp",o,n,i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_COPY_ACTION)}const{user:a,files:c,source:d,isSearchMode:_,viewType:u}=e,p=c.toArray(),A=p.map((e=>({fq_path:e.fq_path,is_dir:e.is_dir,file_id:e.file_id}))),S=null===(n=c.first())||void 0===n?void 0:n.ns_id;l.logUserEventOnFile({args:e,action_type:i.WebUserActionLogEvent.OPEN_COPY_MODAL}),O.portableCopy({filesPath:A,user:a,source:_?"search":"browse",exceptions:{isOverFreeQuota:r,hasExcludedNsIds:s},currentFQPath:t.currentFQPath,createNewFolderInMoveDialog:!0,nsId:S},{onSuccess:()=>{const{num_files_selected:e,num_folders_selected:t}=i.countFilesAndFolders(c);i.logCopyFiles({uid:a.id,source:d,view_type:u,num_files_selected:e,num_folders_selected:t}),g.logBrowseTTS("copy_file")},onUndo:()=>{m.browseActions.selectRowsFromBoltClient(p)}})})(Qt(e,t),o,{isOverFreeQuota:n,hasExcludedNsIds:r})},[o.ActionBarActionTypes.MOVE]:(e,t)=>{const o=tt(e,t),{isOverFreeQuota:n,hasExcludedNsIds:r}=nt(e,t);((e,t,o)=>{var n;const{isOverFreeQuota:r,hasExcludedNsIds:s}=o;if(r&&!s){const o=t.currentNSID,n=e.user.id;return void I.showOverquota("wb_oq_mv_cp",o,n,i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_MOVE_ACTION)}const{user:a,files:c,source:d,isSearchMode:_,viewType:u}=e,p=c.toArray(),A=p.map((e=>({fq_path:e.fq_path,is_dir:e.is_dir,file_id:e.file_id}))),S=null===(n=c.first())||void 0===n?void 0:n.ns_id;l.logUserEventOnFile({args:e,action_type:i.WebUserActionLogEvent.OPEN_MOVE_MODAL}),I.portableMove({filesPath:A,user:a,source:_?"search":"browse",exceptions:{isOverFreeQuota:r,hasExcludedNsIds:s},currentFQPath:t.currentFQPath,createNewFolderInMoveDialog:!0,nsId:S},{onSuccess:e=>{if(_&&e){const t=i.getStoreForSearch();t.dispatch(i.updateResults({results:e})),t.dispatch(i.setSelection({selection:new i.Selection({selected:i.immutable.exports.OrderedSet(e.map((e=>e.fq_path))),anchor:null}),skipLogging:!0}))}else if(e){const t=i.getStoreForBrowse();let o=i.unsortedFiles(t.getState());e.forEach((e=>{const t=o.find((t=>t.file_id===e.file_id));t&&(o=o.remove(t.fq_path))})),t.dispatch(P.setUnsortedFiles({unsortedFiles:o}))}const{num_files_selected:t,num_folders_selected:o}=i.countFilesAndFolders(c);i.logMoveFiles({uid:a.id,source:d,view_type:u,num_files_selected:t,num_folders_selected:o}),g.logBrowseTTS("move_file")},onUndo:e=>{if(_&&e){const e=i.getStoreForSearch();e.dispatch(i.updateResults({results:p})),e.dispatch(i.setSelection({selection:new i.Selection({selected:i.immutable.exports.OrderedSet(p.map((e=>e.fq_path))),anchor:null}),skipLogging:!0}))}m.browseActions.selectRowsFromBoltClient(p)}})})(Qt(e,t),o,{isOverFreeQuota:n,hasExcludedNsIds:r})},[o.ActionBarActionTypes.DELETE]:uo,[o.ActionBarActionTypes.REMOVE]:uo,[o.ActionBarActionTypes.RESTORE]:(e,t)=>{const o=tt(e,t),n=et(e,t),r=lt(e,t,n.first());rt(e,t).expBackupImprovedRestorations&&(null==r?void 0:r.rootNsId)&&"cb"===(null==r?void 0:r.type)?zi(n.toArray(),i.BackupType.COMPUTER,r.rootNsId,"browse"):(null==r?void 0:r.rootNsId)&&"edb"===(null==r?void 0:r.type)&&n.every((e=>!e.is_dir))?zi(n.toArray(),i.BackupType.EXTERNAL_DRIVE,r.rootNsId,"browse"):l.handleRestore(Qt(e,t),o)},[o.ActionBarActionTypes.PERMANENT_DELETE]:(e,t)=>{const o=tt(e,t);l.handlePermanentDelete(Qt(e,t),o)},[o.ActionBarActionTypes.STAR]:(e,t)=>{g.logBrowseTTS("star"),l.handleStar(Qt(e,t))},[o.ActionBarActionTypes.UNSTAR]:(e,t)=>{g.logBrowseTTS("star"),l.handleUnstar(Qt(e,t))},[o.ActionBarActionTypes.OPEN]:(e,t,o)=>{const i=null==o?void 0:o.menuValue;l.handleExtensionClick(Qt(e,t),t.actionSurface,(null==i?void 0:i.actionName)||(null==i?void 0:i.userAction)),null==i||i.handler()},[o.ActionBarActionTypes.SHARE_MODAL]:(e,t)=>{const o=Qt(e,t),n=tt(e,t);yt(e,t)?ai(Je(e,t),n):en({action_source:t.actionSource||i.ActionSourceValue.SHARE,action_surface:t.actionSurface},o,n)},[o.ActionBarActionTypes.ARCHIVE]:(e,t)=>{l.handleArchive(Qt(e,t))},[o.ActionBarActionTypes.GO_TO_FOLDER]:yo,[o.ActionBarActionTypes.MANAGE_AS_ADMIN]:(e,t)=>{yt(e,t)?ui(Je(e,t),tt(e,t)):l.handleManageAsAdmin(Qt(e,t))},[o.ActionBarActionTypes.REQUEST_FILES]:(e,t)=>{0===et(e,t).count()?pi(Je(e,t),tt(e,t),Qt(e,t)):l.handleRequestFiles(Qt(e,t))},[o.ActionBarActionTypes.OPEN_MAC_DESKTOP]:gi,[o.ActionBarActionTypes.OPEN_WINDOWS_DESKTOP]:gi,[o.ActionBarActionTypes.SHARE_COPY_LINK]:(e,t,o)=>{(null==o?void 0:o.anchorRef)?l.handleShareCopyLink(Qt(e,t),null==o?void 0:o.anchorRef,null==o?void 0:o.onHoverLocked,null==o?void 0:o.onActionFlowComplete,t.experimentSelector(e).expUserLevelSharingSettings,t.experimentSelector(e).expCopyLinkInRightRail):_e.reportStack("Missing `anchorRef` in copy link action",{severity:ue.SEVERITY.NONCRITICAL,tags:["sharing"]})},[o.ActionBarActionTypes.SAVE_AS]:(e,t,o)=>{var n;g.logBrowseTTS("file_save_as");const r=Qt(e,t),{files:s,user:a}=r,c=null===(n=null==o?void 0:o.menuValue)||void 0===n?void 0:n.menuItem;l.logUserEventOnFile({args:r,action_type:i.WebUserActionLogEvent.FILE_CONVERT_CLICK,extra:{action:c.actionText}});const{isCurrentFolderEligibleForAutomation:d,isSubfolderEligibleForAutomation:_}=io(e,t);c.convert(s.toArray(),a,{isCurrentFolderEligibleForAutomation:d,isSubfolderEligibleForAutomation:_,source:"browse"})},[o.ActionBarActionTypes.UNZIP]:(e,t)=>{const o=Qt(e,t),{files:i,user:n}=o,{isCurrentFolderEligibleForAutomation:r,isSubfolderEligibleForAutomation:s}=io(e,t);be.UnzipAction.convert([i.first()],n,{isCurrentFolderEligibleForAutomation:r,isSubfolderEligibleForAutomation:s,source:"browse"})},[o.ActionBarActionTypes.EDIT_FOLDER_AUTOMATION]:(t,o)=>{const n=Qt(t,o),{context:r,files:s}=n,a=s.first(),c=xt(t,o)?null==a?void 0:a.fq_path:null==r?void 0:r.currentFQPath,d=Ze(0,o)?"search":"browse";r&&c&&(u.asyncLaunchWorkflowBuilder({operation:"edit",folderFqPath:c,surface:d}),l.logUserEventOnFile({args:n,action_type:i.WebUserActionLogEvent.MANAGE_FOLDER_RULES_CLICK}),new Promise((function(t,o){e(["./c_flows_logging_flows_loggers"],t,o)})).then((({PapLogger:e})=>{e.logSelectAutoFolderEditAutomationButton({actionSurface:d})})))},[o.ActionBarActionTypes.ADD_FOLDER_AUTOMATION]:(t,o)=>{const n=Qt(t,o),{context:r,files:s}=n,a=s.first(),c=xt(t,o)?null==a?void 0:a.fq_path:null==r?void 0:r.currentFQPath,d=Ze(0,o)?"search":"browse";r&&c&&(u.asyncLaunchWorkflowBuilder({operation:"add",folderFqPath:c,surface:d}),l.logUserEventOnFile({args:n,action_type:i.WebUserActionLogEvent.ADD_FOLDER_RULES_MODAL_CLICK}),new Promise((function(t,o){e(["./c_flows_logging_flows_loggers"],t,o)})).then((({PapLogger:e})=>{e.logSelectAutoFolderAddButton({actionSurface:d})})))},[o.ActionBarActionTypes.CONVERT_TO_ARCHIVE]:(e,t)=>{const o=Qt(e,t);l.logUserEventOnFile({args:o,action_type:i.WebUserActionLogEvent.CONVERT_TO_ARCHIVE_CLICK});const{files:r,user:s,context:a}=o;a&&function(e,t,o,r){i.Modal$1.showInstance(n.React$1.createElement(i.Provider,{store:i.getStoreForBrowse()},n.React$1.createElement(E.Provider,{value:E.intl},n.React$1.createElement(Ui,{action:e,files:t,user:o,context:r}))))}("archive",r.toArray(),s,a)},[o.ActionBarActionTypes.SEND_FOR_SIGNATURE]:(e,t)=>{l.handleSendForSignature(Qt(e,t))},[o.ActionBarActionTypes.REQUEST_APPROVAL]:(e,t)=>{const o=Qt(e,t),{files:n,user:r,actionSurface:s}=o,a=n.first();ye.launchApprovalRequestModal({file:a,user:r,onSuccess:()=>{const e=i.getStoreForBrowse();e.dispatch(P.setRightRailIsCollapsed(!1)),e.dispatch(P.selectFilesByFqPath({fqPathsToSelect:[a.fq_path]})),e.dispatch(P.expandBlade("comments"))}}),ve.PapLogger.logRequestApprovalClick(s||"unknown",a.file_id)},[o.ActionBarActionTypes.SELF_SIGN_ACTION]:(e,t)=>{const o=Qt(e,t);l.handleSendForSignature(o,!0)},[o.ActionBarActionTypes.ADD_TO_COLLECTION]:(e,t)=>{const o=Qt(e,t),n=et(e,t).toArray().map((e=>e.file_id));l.logUserEventOnFile({args:o,action_type:i.WebUserActionLogEvent.OPEN_ADD_TO_COLLECTION_MODAL});const r=Ze(0,t)?"search":"browse";Fe.showCollectionSaverModal({fileIds:n,surface:r})},[o.ActionBarActionTypes.EDIT_PDF]:(e,t)=>{const o=Qt(e,t),{files:n,user:r}=o,s=n.first();l.browseNavigateActions.openPreviewForBrowseFile({file:s,shouldFocusComment:!1,user:r,fileViewOrigin:i.FileViewOriginType.BROWSE,onFileViewerUnmount:()=>{},editActivationParams:{source:"browse_overflow_menu"}}),l.logUserEventOnFile({args:o,action_type:i.WebUserActionLogEvent.SELECT_EDIT_MODE,extra:{file_ext:s.ext}})},[o.ActionBarActionTypes.BACKUP_COPY_TO_FSS]:(e,t)=>{const o=Or(e,t);(null==o?void 0:o.backup)&&fr(o.backup,o.files,"browse")},[o.ActionBarActionTypes.MANAGE_PERMISSIONS]:gr,[o.ActionBarActionTypes.OPEN_IN_REPLAY]:(e,t)=>{const o=Qt(e,t),{files:n}=o,r=n.first();l.logUserEventOnFile({args:o,action_type:i.WebUserActionLogEvent.OPEN_IN_REPLAY,extra:{file_ext:r.ext}}),window.open(`https://replay.dropbox.com/project/creating/${r.file_id}?creationSource=dropbox_browse_action_bar`)},[o.ActionBarActionTypes.EDIT_IMAGE]:(e,t)=>{const o=Qt(e,t),{files:n,user:r,isSearchMode:s}=o,a=n.first(),c=s?i.FileViewOriginType.SEARCH:i.FileViewOriginType.BROWSE;l.browseNavigateActions.openPreviewForBrowseFile({file:a,shouldFocusComment:!1,user:r,fileViewOrigin:c,onFileViewerUnmount:()=>{},editActivationParams:{source:i.EditActivationParams.OVERFLOW_MENU}}),l.logUserEventOnFile({args:o,action_type:i.WebUserActionLogEvent.SELECT_IMAGE_EDIT_MODE,extra:{file_ext:a.ext}})}},Dr={[o.ActionBarActionTypes.OPEN]:(e,t,o)=>{o&&l.handleExtensionDropdownOpen(Qt(e,t),t.actionSurface)},[o.ActionBarActionTypes.SPACES_DROPDOWN]:(e,t,o)=>{o&&i.WebUserActionLog.log(i.user(e).id,i.WebUserActionLogEvent.EXPAND_SPACES_FOLDER_DROPDOWN,{})},[o.ActionBarActionTypes.ACTIVITY]:(e,t,o)=>{o&&l.handleExtensionDropdownOpen(Qt(e,t),t.actionSurface)}},Mr={[o.ActionBarActionEventSource.BUTTON]:i.ActionSourceValue.BUTTON,[o.ActionBarActionEventSource.BUTTON_MENU]:i.ActionSourceValue.BUTTON_MENU,[o.ActionBarActionEventSource.OVERFLOW_MENU]:i.ActionSourceValue.OVERFLOW_MENU},Pr=(e,t)=>{var o;return me.shallowEqualArray(e.alwaysAtTopLevel,t.alwaysAtTopLevel)&&me.shallowEqualArray(e.atTopLevelIfSpace,t.atTopLevelIfSpace)&&!!(null===(o=e.alwaysInOverflow)||void 0===o?void 0:o.every(((e,o)=>me.shallowEqualArray(e,t.alwaysInOverflow?t.alwaysInOverflow[o]:[]))))},Ur=(e,t,o,i)=>{const n=[];return i.forEach((i=>{const r=o[i],s=r&&r(e,t);s&&n.push(s)})),n};t.ActionMenuToggleHandlersMap=Dr,t.FOLLOW_MODAL_QUERY_PARAM=bo,t.FileActionsHandlersMap=Br,t.Frequencies={INSTANT:{".tag":"instant"},DAILY:{".tag":"daily"}},t.actionBarSelectionType=_t,t.actionHandler=(e,t,o,i)=>(n,r)=>{const s=o[e.type];if(s){s(r(),Object.assign(Object.assign({},t),{actionSource:Mr[e.source]}),{menuValue:e.menuItem,anchorRef:e.anchorRef,onHoverLocked:null==i?void 0:i.onHoverLocked,onActionFlowComplete:e.onActionFlowComplete})}},t.actionMenuToggleHandler=({type:e,isOpen:t},o,i)=>(n,r)=>{const s=i[e];if(s){s(r(),o,t)}},t.addFromGdriveActionHandler=function(e,t){yt(e,t)&&Ti(Je(e,t),Qt(e,t))},t.api_esnext=$e,t.browse_global_actions_handlers_esnext=fi,t.context=tt,t.copyActionBarActions=e=>{const{alwaysAtTopLevel:t,atTopLevelIfSpace:o,alwaysInOverflow:i,expSuggestedWorkflowsActions:n}=e,r={};return r.alwaysAtTopLevel=null==t?void 0:t.slice(),r.atTopLevelIfSpace=null==o?void 0:o.slice(),r.alwaysInOverflow=null==i?void 0:i.map((e=>e.slice())),n&&(r.expSuggestedWorkflowsActions={suggestedWorkflowActions:n.suggestedWorkflowActions.slice(),compactOverflowMenuActions:n.compactOverflowMenuActions.map((e=>e.slice()))}),r},t.createActionBarActionSelector=()=>ze(Pr,((e,t,o,i)=>{const n={},{alwaysAtTopLevel:r,atTopLevelIfSpace:s,alwaysInOverflow:a,expSuggestedWorkflowsActions:c}=i(e,t);return n.alwaysAtTopLevel=r?Ur(e,t,o,r):[],n.atTopLevelIfSpace=s?Ur(e,t,o,s):[],n.alwaysInOverflow=a?a.map((i=>Ur(e,t,o,i))):[[]],c&&(n.expSuggestedWorkflowsActions={suggestedWorkflowActions:Ur(e,t,o,c.suggestedWorkflowActions).filter((e=>e.isSuggestedWorkflow)),compactOverflowMenuActions:c.compactOverflowMenuActions.map((i=>Ur(e,t,o,i)))}),n})),t.createAddFromGdriveActionSelector=function(){return i.createSelector(nr,ir,((e,t)=>t?{actionType:o.ActionBarActionTypes.ADD_FROM_GDRIVE,isEnabled:e,text:d.ADD_FROM_GDRIVE_ACTION_STRING,icon:r.CloudUploadLine}:void 0))},t.createAddToCollectionActionSelector=()=>i.createSelector(Sr,(e=>e?pr:void 0)),t.createAddToCollectionSearchActionSelector=()=>i.createSelector(Er,(e=>e?pr:void 0)),t.createFileLockActionSelector=()=>i.createSelector(Qn,(e=>e?$n:void 0)),t.createFileRequestUnlockActionSelector=()=>i.createSelector(er,(e=>e?tr:void 0)),t.createFileUnlockActionSelector=()=>i.createSelector(Zn,(e=>e?Xn:void 0)),t.createFolderSubscription=(e,o,n)=>(r,s)=>{const a=s(),c=i.user(a).id;if(Wo(a,e)===t.FolderSubscriptionState.NOT_FOLLOWING)return ti({dispatch:r,getState:s,path:e,newValue:{subscriptionState:t.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:o},apiUpdate:()=>function(e,t,o){return B.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/create",{identifier:e,settings:t},{subjectUserId:o})}))}(e,o,c),onSuccess:()=>{Yo(e),ei(i.WebUserActionLogEvent.FOLLOW_FOLDER,s(),e,n)},onError:()=>jo(e)})},t.createFollowActionSelector=()=>i.createSelector(Bn,Dn,Mn,((e,t,i)=>t?{actionType:o.ActionBarActionTypes.FOLLOW,isEnabled:e,text:d.FOLLOW_ACTION_STRING,icon:r.FollowLine,disabledTooltip:i?Pn:void 0}:void 0)),t.createFollowingActionSelector=()=>i.createSelector(xn,kn,Vn,((e,t,i)=>t?{actionType:o.ActionBarActionTypes.FOLLOWING,isEnabled:e,text:d.FOLLOWING_ACTION_STRING,icon:r.FollowLine,disabledTooltip:e?void 0:i,menu:e?wn:void 0}:void 0)),t.createManagePermissionsActionSelector=Rr,t.createRewindActionSelector=()=>i.createSelector(Yn,qn,((e,t)=>t?{actionType:o.ActionBarActionTypes.REWIND,isEnabled:e,text:d.REWIND_ACTION_STRING,icon:Te.RewindLine}:void 0)),t.createSearchActionBarAccessibilityConfigSelector=()=>i.createSelector(et,(e=>{if(0!==e.size)return{primaryActionContext:void 0,secondaryActionsContext:{firstEntryAccessibilityHint:i.getFilename(e.first()),noOfEntries:e.size}}})),t.createShareCopyLinkActionSelector=pn,t.createShareModalActionSelector=An,t.createSpacesDropdownActionSelector=()=>i.createSelector(_r,Je,((e,t)=>{return e?(i=t.id,{actionType:o.ActionBarActionTypes.SPACES_DROPDOWN,isEnabled:!0,text:d.SPACES_PROJECTS_RENAME_DROPDOWN_ACTION_STRING,icon:r.DropboxSpacesLine,menu:dr(i)}):void 0;var i})),t.currentBackupInfo=dt,t.defaultOverQuotaData={isOverFreeQuota:!1,hasExcludedNsIds:!1},t.deleteFolderSubscription=oi,t.deleteFolderSubscriptionFromEmail=(e,o)=>(n,r)=>{const s=r(),a=i.user(s).id;return Mo(e,a).then((()=>{Qo(e),ei(i.WebUserActionLogEvent.UNFOLLOW_FOLDER,s,e,{ns_id:o,origin:t.FolderSubscriptionOrigin.Email})}),(()=>$o(e)))},t.editFolderSubscription=(e,o,n)=>(r,s)=>{const a=s(),c=i.user(a).id;if(Wo(a,e)===t.FolderSubscriptionState.FOLLOWING)return ti({dispatch:r,getState:s,path:e,newValue:{subscriptionState:t.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:o},apiUpdate:()=>function(e,t,o){return B.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/edit",{identifier:e,settings:t},{subjectUserId:o})}))}(e,o,c),onSuccess:()=>{Yo(e),ei(i.WebUserActionLogEvent.EDIT_FOLDER_FOLLOW_SETTINGS,s(),e,n)},onError:()=>jo(e)})},t.experiments=rt,t.fetchFolderSubscription=Xo,t.fileLockActionHandler=(e,t)=>{l.handleFileLock(Qt(e,t))},t.fileRequestUnlockActionHandler=(e,t)=>{l.handleFileRequestUnlock(Qt(e,t))},t.fileUnlockActionHandler=(e,t)=>{l.handleFileUnlock(Qt(e,t))},t.folderSubscription=Vo,t.followActionHandler=(e,t)=>{let o,n;if(yt(e,t)){const i=tt(e,t).currentFQPath;o=i,n=i}else{const r=et(e,t).first();o=r.fq_path,n=i.parent_dir(r.fq_path)}Ei(o,n)},t.followingActionHandler=function(e,t,o){const n=null==o?void 0:o.menuValue;if((null==n?void 0:n.menuItem)===bn.OPTIONS){const o=et(e,t),n=tt(e,t).currentFQPath;let r,s;if(yt(e,t))r=n,s=n;else{const e=o.first();r=e.fq_path,s=i.parent_dir(e.fq_path)}Ei(r,s)}else{const o=tt(e,t),i=et(e,t);if(yt(e,t))Si(o.currentFQPath,o.currentNSID);else if(xt(e,t)){const e=i.first();Si(e.fq_path,e.ns_id)}}},t.getActionHandlerArgs=Qt,t.getFileActionsSelectorsMap=wr,t.getFlowsUserAutomation=Ht,t.getInlineFileActionsSelectors=()=>Object.assign(Object.assign({},wr()),{[o.ActionBarActionTypes.SHARE_MODAL]:An(),[o.ActionBarActionTypes.SHARE_COPY_LINK]:pn()}),t.getInlineScenarioActions=zt,t.getMobileFileActionsSelectors=()=>Object.assign(Object.assign({},wr()),{[o.ActionBarActionTypes.SHARE_MODAL]:An()}),t.getRequestState=ko,t.getSearchInlineOverflowMenuActions=Xt,t.getSearchInlineScenarioActions=Zt,t.getSearchScenarioActions=$t,t.getSearchSidebarScenarioActions=Jt,t.getSidebarFileActionSelectors=()=>({[o.ActionBarActionTypes.SHARE]:_n(),[o.ActionBarActionTypes.SHARE_COPY_LINK]:pn()}),t.getStoreForFolderSubscriptions=ni,t.getTabletFileActionsSelectors=()=>Object.assign(Object.assign({},wr()),{[o.ActionBarActionTypes.SHARE_MODAL]:(e,t)=>{}}),t.getTabletSidebarFileActionSelectors=()=>({[o.ActionBarActionTypes.SHARE_MODAL]:An()}),t.handleAddContent=Ai,t.handleCreateNewFolder=ri,t.handleCreateSharedFolderClick=ci,t.handleRedirectToContentManager=_i,t.handleRequestFiles=pi,t.handleSharedFolderClick=ai,t.handleTrashCanClick=di,t.hasContentManagerAndSuperAdmin=ut,t.hasUnmountedOrMultipleNamespaces=At,t.isCdmRoot=qt,t.isCloudDocSelected=ft,t.isDeletedFilesOnly=Ot,t.isFileSharedWithMeSelected=mt,t.isFolderTidyable=oo,t.isInsideBackupFolder=at,t.isLiveFilesOnly=gt,t.isNoAccessSharedFolderSelected=St,t.isNothingSelected=yt,t.isPnmLinkNodeSelected=Rt,t.isPnmSuppressShareSelected=ht,t.isRestrictedPathSelected=bt,t.isSelectedBackupFolder=ct,t.isSelectionFetchFolderSizeStatusOnly=Ct,t.isSelectionFoldersOnly=Bt,t.isSingleSelectionFolder=xt,t.isTeamMemberFolderSelected=kt,t.logAction=ei,t.managePermissionsActionHandler=gr,t.rewindActionHandler=(e,t)=>{yt(e,t)?si(Je(e,t),Qt(e,t)):l.handleRewind(Qt(e,t))},t.selectedFiles=et,t.setQuotaExemptCB=Ye,t.setQuotaExemptEDB=je,t.shouldShowRewindsUpsell=Hn,t.showRestoreAction=Zi,t.spacesDropdownActionHandler=(e,t,o)=>{const n=null==o?void 0:o.menuValue;i.WebUserActionLog.log(i.user(e).id,i.WebUserActionLogEvent.CLICK_SPACES_FOLDER_ITEM,{value:n.menuItem.value,index:n.menuItem.index}),i.redirect(new W.URI({path:"/spaces",query:{_tk:"fss_hooks_add_to_space_"+n.menuItem.value}}))},t.user=Je,t.viewType=it}));
//# sourceMappingURL=c_action_bar_file_actions.js-vfl9iaXOy.map
