define(["require","exports","./c_tslib","./e_edison","./e_ui_page_files_router","./c_file_uploader_clean_actions","./c_file_uploader_types","./c_file_uploader_utils","./c_data_store","./c_data_slice","./c_core_browser_detection","./c_lodash-es_lodash","./c_core_i18n","./c_cloud_docs_create_api","./c_core_uri","./c_ui_fileops_actions","./e_core_exception","./c_core_notify","./c_core_exception_info","./c_ui-icon_line_link","./c_ui-icon_line_share-arrow","./c_ui-icon_line_video","./c_clipboard_v3","./c_browse_actions","metaserver/static/js/modules/constants/web_experience_constants","./c_file_actions_actions_share_copy_link","./c_sharing_async_share_modal_util","./c_sharing_ui_notifications_util","./c_views_copy_link_mini_modal","./c_share_modal_evolution_utils_logging","./c_src_utils_logging","./c_campaigns_campaign_events_api","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/payments","./c_dig-illustrations_spot_files-old-2","./c_pap-events_enums_file_type-utils","./c_spectrum_icon_inline_index","./c_icon_templates_status_index","./c_spectrum_icon_chooser_index","./c_ui-icon_line_upload-folder","./c_browse_interface","./c_ux_analytics_modal_tracking","./c_src_truncated-string_index","./c_file_uploader_clean_dropzone_outline","./c_file_uploader_actions_adapter","./c_hooks_use_stabilized_callback","./c_ui-icon_line_upload","./c_upload_kit_lib_selectors","metaserver/static/js/modules/constants/global_file_upload","./c_combinations_index","./c_src_icons_file_icon","./c_truncate_index","./c_ui-icon_line_syncing","./c_resize-observer-polyfill_dist_ResizeObserver","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","metaserver/static/js/modules/constants/request","./c_browser_cookies","./c_src_sink_index","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","metaserver/static/js/modules/constants/page_load","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/core/langpack","./c_pap-events_manual_upload_select_upload_folder","./c_hive_schemas_web-modal-activity","./c_file_uploader_result_type","./c_folder_dialog_async","./c_growth_ui_teams_web_actions_logger_events","./c_sharing_actions_cdm_new_folder_modal_actions","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_browse_exports","./c_sharing_default_permissions_web_uploads_exports","./c_sharing_default_permissions_web_uploads_utils","./c_base64","./c_upload_kit_lib_types","./c_src_file_extension_extension_constants","./c_gdd_migration_ui_utils","./c_file_imports_gdrive_file_picker","./c_data_action_creators_index","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_history","./c_ux_analytics_dispatch_custom_event","./c_browse_crypto_subtle_digest","./c_action_bar_file_actions_logging","./c_files_view_file_actions_snackbars","./c_sync_everything_hive_logger","./c_pap-events_previews_delete_file","./c_flows_utils_async_modal_launchers","./c_components_sharing_spinner","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_spectrum_tooltip","./c_spectrum_dimensions","./c_src_icons_file_icon_extensions"],(function(e,t,a,s,o,r,n,l,i,c,d,u,p,m,g,_,f,E,h,R,S,M,T,y,C,b,v,O,L,I,A,U,F,x,D,k,N,P,w,$,B,G,z,q,V,Q,j,H,W,K,Y,J,Z,X,ee,te,ae,se,oe,re,ne,le,ie,ce,de,ue,pe,me,ge,_e,fe,Ee,he,Re,Se,Me,Te,ye,Ce,be,ve,Oe,Le,Ie,Ae,Ue,Fe,xe,De,ke,Ne,Pe,we,$e,Be,Ge,ze,qe,Ve,Qe,je,He,We,Ke,Ye,Je,Ze,Xe,et,tt,at,st,ot,rt,nt){"use strict";function lt(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,s.get?s:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var it=lt(x);const ct=()=>{const e=s.react.exports.useRef(null),t=s.react.exports.useRef(0),a=s.react.exports.useRef(0),n=o.useSelector(c.getIsDraggingFiles),l=o.useDispatch(),i=s.react.exports.useCallback((()=>{t.current=0,e.current=null,a.current=0}),[t,e,a]);return s.react.exports.useEffect((()=>{n&&(l(c.uploadActionCreators.clearDraggedPersistentDropzone()),l(c.uploadActionCreators.clearDraggedOuterDropzone()))}),[n]),s.react.exports.useEffect((()=>{const s=[];return s.push([document,"dragover",e=>{e.preventDefault(),e.stopPropagation()}]),s.push([document,"dragenter",s=>{if(s.preventDefault(),s.stopPropagation(),s.target===e.current)return;e.current=s.target,t.current++;const o=s.dataTransfer,n=o.mozItemCount;let l=0;o.items&&(l=Object.keys(o.items).length);let i=1;n?i=n:l&&(i=l);const{types:c}=o,p=["Files","application/x-moz-file",d.INTERNAL_FILE_DATA_TRANSFER_TYPE,"text/x-moz-url","text/uri-list","Url"];if(c&&u.intersection(c,p).length||c instanceof DOMStringList&&(c.contains("Files")||c.contains("text/x-moz-url")||c.contains(d.INTERNAL_FILE_DATA_TRANSFER_TYPE)||d.msie&&(c.contains("Text")||c.contains("text/plain")))){if(i===a.current)return;a.current=i;const e=(e=>{let t;return t=e instanceof DOMStringList?e.contains("Text")||e.contains("text/plain"):e.includes(d.INTERNAL_FILE_DATA_TRANSFER_TYPE)||e.includes("text/plain"),t})(c);r.UploaderActions.setNumDraggingFiles({numDraggingFiles:i,isInternalTransfer:e})}}]),s.push([document,"dragleave",s=>{s.preventDefault(),s.stopPropagation(),e.current=null,t.current--,t.current<1&&(t.current=0,a.current=0,r.UploaderActions.setNumDraggingFiles({numDraggingFiles:0}))}]),s.forEach((([e,t,a])=>{e.addEventListener(t,a)})),()=>s.forEach((([e,t,a])=>{e.removeEventListener(t,a)}))}),[t,e]),i};const dt=({uploadConsumerInterface:t,uploaderPostTTIExperiments:i,isContentManager:p,resetDragRefs:R,createShortcutForGdssFile:S})=>{const M=o.useDispatch(),T=o.useSelector(c.getTargetSurface),y=o.useSelector(c.getPath),C=o.useSelector(c.getUser),b=o.useSelector(c.isMovingIntoVault),v=o.useSelector(c.hasPermissionToUploadToFolder),O=o.useSelector(c.getOverQuotaStatus),L=o.useSelector(o.path),I=o.useSelector(c.getCurrentlyActiveOuterDropzone),A=o.useSelector(c.getCurrentlyActivePersistentDropzone);s.react.exports.useEffect((()=>{const s=pt(),i=e=>{if(e.defaultPrevented)return;const{dataTransfer:t}=e;e.preventDefault(),e.stopPropagation(),R(),r.UploaderActions.setNumDraggingFiles({numDraggingFiles:0});const a=t&&t.getData(d.INTERNAL_FILE_DATA_TRANSFER_TYPE);let s;if(a&&(s=U(e,a),!s))return;if(M(c.uploadActionCreators.setLastFileUploadMethod("dnd")),o.Viewer.get_viewer().team_is_locked)return void M(c.uploadActionCreators.setUploadModalType({type:"OVER_QUOTA_MODAL",forceLocked:!0,context:r.UploaderOverQuotaModalContexts.LOCKED_TEAM_DRAG_AND_DROP}));if(!v&&!b)return;if(o.isBackupBrowse())return;if(O===l.OverQuotaStatusType.BASIC_OVER_QUOTA)return void M(c.uploadActionCreators.setUploadModalType({type:"OVER_QUOTA_MODAL",context:r.UploaderOverQuotaModalContexts.ALREADY_OQ_DRAG_AND_DROP}));const n=function(e){if(!e||!e.types)return null;if(((e,t)=>{for(const a of e)if(t===a)return!0;return!1})(e.types,"Files"))return null;let t,a=null;try{t=e.getData("text/x-moz-url")}catch(e){}if(null!=t){const e=t.split("\n");e.length>=1&&(a=e[0])}if(!a)try{a=e.getData("text/uri-list")}catch(e){}if(!a)try{a=e.getData("Url")}catch(e){}return a||(a=null),a}(t);n?m.createNewFile({user:C,path:y,documentType:o.PointerFileTypes.SIMPLE_POINTER,selection_mode:"unselected",empty_folder:!1,defaultUrl:n,source:o.NewFileMenuFromType.DRAG_DROP,createShortcutForGdssFile:S}):(ut(e,s),F(t))},U=(t,o)=>{g.assert(null!=C,"user is null");try{const{userId:r,fromPath:n,fileInfos:l}=JSON.parse(o);if(l.length&&n&&r){if(p)return;if(!v&&b)return void E.Notify.error(s.lockedVault);if(!v)return void E.Notify.error(s.notThisFolderError);if(r!==(null==C?void 0:C.id))return void E.Notify.error(s.notFromOtherDbxError);if(t.ctrlKey||t.altKey)_.copyFilesDeprecated({user:C,files:l,newPath:y,checkFSWs:!0});else if(n!==y){if(1===l.length&&l[0].is_dir&&l[0].fq_path===y)return void E.Notify.error(s.cantMoveFolderToItself);const t=(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const{handleMovedFolder:a}=yield new Promise((function(t,a){e(["./e_ui_page_files_router"],t,a)})).then((function(e){return e.action_creators_esnext}));a({fromPath:t,newPath:s})}));_.moveFiles({user:C,path:n,files:l,newPath:y,checkFSWs:!0,extra:{targetSurface:T},onSuccess:()=>a.__awaiter(void 0,void 0,void 0,(function*(){l.some((e=>e.is_dir))&&t(n,y)})),onUndo:()=>a.__awaiter(void 0,void 0,void 0,(function*(){l.some((e=>e.is_dir))&&t(y,n)}))})}return}}catch(e){return f.reportException({err:e,severity:h.SEVERITY.NONCRITICAL,tags:["web_uploader","drag_and_drop"]}),e}},F=e=>a.__awaiter(void 0,void 0,void 0,(function*(){const{items:a,errors:s}=yield t.handleDrop(e,y),i=l.generateTaskTrackingId();if(!a.length)return void l.showCannotUploadEmptyFolderSnackbar();const[c,d]=u.partition(a,(e=>e.isDir));d.forEach((e=>r.setMethodForFileUpload(e.id,n.UploadMethod.DRAG)));const p=c.length?d.length?l.ChooserType.FILE_FOLDER:l.ChooserType.FOLDER:l.ChooserType.FILE,m="folder_explorer"===I?"folder_explorer":"dedicated_dropzone"===A?"dedicated_dropzone":"browse_suggestions"===A?"browse_suggestions":L!==y?"browse_folder":"outer_dropzone"===I?"outer_dropzone":"catch_all";r.logUploadAction({user:C,action:o.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,chooser_type:p,upload_method:n.UploadMethod.DRAG,dropzoneArea:m}),o.TeamsWebActionsLogger.log("drag_and_drop_files",Object.assign({file_type:p},l.getUploadLocationMetadataToLog(C,y))),t.startUploading(),r.UploaderActions.logUploadAttempts({chooserType:p,items:d,upload_method:n.UploadMethod.DRAG,uploadPath:y,errors:s,actionElement:n.UploadElement.DRAG_AND_DROP,taskTrackingId:i})}));return document.addEventListener("drop",i),()=>document.removeEventListener("drop",i)}),[v,b,M,p,O,y,T,R,i,C,t,A,I])},ut=({dataTransfer:e},t)=>{const{items:a=null}=e||{};if(a&&a.length>0&&!a[0]){const{name:e,message:s}=t||{};f.reportException({err:new Error("Drag and drop DateTransfer item unexpectedly undefined"),severity:h.SEVERITY.NONCRITICAL,tags:["web_uploader","drag_and_drop"],exc_extra:{item_index:0,items_length:a.length,had_internal_transfer_error:!!t,internal_transfer_error_name:e,internal_transfer_error_message:s}})}},pt=()=>({notThisFolderError:p.intl.formatMessage({id:"sVwi15",defaultMessage:"You don’t have permission to add to this folder."}),notFromOtherDbxError:p.intl.formatMessage({id:"gsjvql",defaultMessage:"You can’t move or copy files here from another Dropbox."}),lockedVault:p.intl.formatMessage({id:"6ASmGo",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),cantMoveFolderToItself:p.intl.formatMessage({id:"ZGOZr9",defaultMessage:"You can’t move a folder into itself"})}),mt=(e,t,a=h.SEVERITY.NONCRITICAL)=>{f.reportException({err:new Error(e),severity:a,exc_extra:{err:t},tags:["rich_snackbar","product-growth"]})},gt="sharing-notification";const _t=()=>{o.Snackbar.close("inline-upload-snackbar")},ft=(e,t)=>{o.Snackbar.close(gt),T.copyToClipboard(t.url,(()=>Et(t)),(()=>ht(t.url,e)))},Et=e=>{const t=e?e.link_permissions.link_access_level:void 0;let a="viewer";t&&(a=t.hasOwnProperty(".tag")?t[".tag"]:t),O.showCopyLinkSuccessSnackbar(e.url,a)},ht=(e,t)=>{const{userId:a,ns_id:s,filePath:r}=t;mt("Failed to copy link to clipboard"),O.showCopyLinkErrorSnackbar(e),o.ShareTibEventLogger.log(a,A.TiburonEventName.CopySharedLinkFailure,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:s,fq_path:r,error:"failed_copy_to_clipboard"})};var Rt;!function(e){e.from_upload_snackbar="from_upload_snackbar",e.from_rename_snackbar="from_rename_snackbar"}(Rt||(Rt={}));const St=new Set(["3gp","3gpp","3gpp2","asf","avi","dv","flv","m2t","m2ts","m4v","mkv","mov","mp4","mpeg","mpg","mts","mxf","oggtheora","ogv","rm","ts","vob","webm","wmv"]),Mt={COPY_LINK:{name:"copy_link",icon:R.LinkLine,onClick:function(e){return a.__awaiter(this,void 0,void 0,(function*(){const t="copy_link";o.ProEventsLogger.log("rich_snackbar_click",{action:t});const{filePath:s,ns_id:r,userId:n,campaignImpressionContext:l}=e;l&&U.logCampaignClick(l,t),_t(),O.showCopyLinkProgressSupportedBrowserSnackbar();try{const t=yield((e,t="max")=>a.__awaiter(void 0,void 0,void 0,(function*(){const{userId:a,filePath:s,ns_id:r}=e,n=new o.FileShareApiClient({userId:a});try{const e=yield n.sharedLinkInfo({fileIdOrPath:s});if(e.length)return e[0];o.ShareTibEventLogger.log(a,A.TiburonEventName.AttemptCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{access:t,is_folder:!1,ns_id:r,fq_path:s});try{const e=yield n.createSharedLink({fileIdOrPath:s,settings:{access:t}});return o.ShareTibEventLogger.log(a,A.TiburonEventName.SucceedCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,Object.assign({is_folder:!1,ns_id:r,fq_path:s,access:t,http_status_code:200,response_status:"success"},I.buildExtraFromLinkMetadata(e))),e}catch(e){return o.ShareTibEventLogger.log(a,A.TiburonEventName.FailCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:r,fq_path:s,access:t,http_status_code:e.raw&&e.raw.status,error_tag:e.error&&e.error[".tag"]||"undefined_error",error_summary:e&&e.summary}),mt("Failed to create link",e),Promise.reject(e)}}catch(e){return mt("Failed to get shared link info",e),Promise.reject(e)}})))(e),l=t.url;o.ShareTibEventLogger.log(n,A.TiburonEventName.CopySharedLink,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,Object.assign(Object.assign({},I.buildExtraFromLinkMetadata(t)),{is_folder:!1,ns_id:r,fq_path:s})),b.isBrowserCopyEnabled()?T.copyToClipboard(l,(()=>Et(t)),(()=>ht(l,e))):O.showCopyLinkCTASnackbar(l,(()=>ft(e,t)),gt)}catch(e){e.error[".tag"]===L.CopyLinkException.ACCESS_DENIED||e.error[".tag"]===L.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===L.CopyLinkException.NOT_AUTHORIZED?O.showCopyLinkNoPermissionSnackbar():e.error[".tag"]===L.CopyLinkException.PATH&&e.error.path[".tag"]===L.CopyLinkException.NOT_FOUND?O.showCopyLinkNotFoundSnackbar():e.error[".tag"]===L.CopyLinkException.EMAIL_NOT_VERIFIED?O.showCopyLinkEmailNotVerifiedSnackbar():O.showCopyLinkCatchallSnackbar(),o.ShareTibEventLogger.log(n,A.TiburonEventName.CopySharedLinkFailure,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:r,fq_path:s,error_message:e.error[".tag"]}),mt("Failed to copy link",e)}}))},text:p.intl.formatMessage({id:"CgXNiX",defaultMessage:"Copy link"})},SHARE:{name:"share",icon:S.ShareArrowLine,onClick:function(e){const t="share";o.ProEventsLogger.log("rich_snackbar_click",{action:t});const{userId:a,filePath:s,campaignImpressionContext:r}=e;return r&&U.logCampaignClick(r,t),_t(),v.asyncShowShareModal(a,{fqPath:s,isFolder:!1},{origin:o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD})},text:p.intl.formatMessage({id:"8r1z6a",defaultMessage:"Share"})},OPEN_IN_REPLAY_WITH_UPLOAD:{name:"open_in_replay",icon:M.VideoLine,text:p.intl.formatMessage({id:"iI2jlD",defaultMessage:"Use Dropbox Replay"}),onClick:e=>a.__awaiter(void 0,void 0,void 0,(function*(){try{const t=yield(e=>a.__awaiter(void 0,void 0,void 0,(function*(){const{userId:t,filePath:a}=e,s=new o.UserApiV2Client;try{return(yield s.ns("files").rpc("get_metadata",{path:a},{subjectUserId:t})).id}catch(e){return mt("Failed to get file id",e,h.SEVERITY.CRITICAL),Promise.reject(e)}})))(e);o.redirect(`https://replay.dropbox.com/project/creating/${t}?creationSource=dropbox_web_snackbar`)}catch(e){f.reportException({err:e,severity:h.SEVERITY.CRITICAL}),o.redirect("https://replay.dropbox.com/?login=true")}}))}};function Tt(e,t,a,s,r){const{campaignId:n,campaignImpressionId:i,campaignVariantId:c}=(null==s?void 0:s["PG Share On Upload"])||{};let d;const u=e.filter((e=>e.status!==l.FileStatusType.CANCELLED)).last();if(!u)return;const p=u.userId,m=i?U.createMegaphoneCampaignImpressionContext(i,n,c):void 0,g=(e,t)=>({filePath:o.joinPathWithFileName({fqPath:e.dest,fileName:e.name}),userId:p,ns_id:e.ns_id,snackbar_origin:t||Rt.from_upload_snackbar,campaignImpressionContext:m}),_=g(u);i&&(null==s?void 0:s["PG Share On Upload"])&&"complete"===t&&1===e.count((e=>e.status!==l.FileStatusType.CANCELLED))&&(d={actions:[Mt.SHARE,Mt.COPY_LINK],clickHandlerArgs:_});const f=e.find((e=>e.status!==l.FileStatusType.CANCELLED&&St.has(o.file_extension(e.name))));if("complete"===t&&f&&(null==a?void 0:a.snackbarOpenWithReplay)&&(d=yt(Object.assign({},g(f)))),d){const{logView:e,logDismiss:t,logCloseClick:a,actionNames:s}=Ct(d,m);d.onShown=()=>{e(s)},d.onDismissed=()=>{t(s)},d.onCloseClick=()=>{a(s)}}return d}const yt=e=>({actions:[Mt.OPEN_IN_REPLAY_WITH_UPLOAD],helperText:p.intl.formatMessage({id:"EKLtAC",defaultMessage:"Share and request feedback on your video files."}),clickHandlerArgs:e}),Ct=(e,t)=>({logView:e=>{o.ProEventsLogger.log("rich_snackbar_view",{actions:e}),t&&U.logCampaignImpression(t)},logDismiss:e=>{o.ProEventsLogger.log("rich_snackbar_dismiss",{actions:e}),t&&U.logCampaignDismissed(t)},logCloseClick:e=>o.ProEventsLogger.log("rich_snackbar_close_click",{actions:e}),actionNames:e.actions.map((e=>e.name))});var bt;function vt(e){return e.some((e=>e.status===l.FileStatusType.SET_PERMISSIONS||e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING))?bt.UPLOADING:e.some((e=>e.status===l.FileStatusType.FAILED))?bt.ERROR:bt.COMPLETE}function Ot(e,t){return e.count((e=>e.status===t))}function Lt(e){return e.count((e=>e.status!==l.FileStatusType.CANCELLED))}function It(e){return l.isUploadTypeError(e)?function(e){switch(e){case l.UploadErrorType.OVER_QUOTA_ERROR:return p.intl.formatMessage({id:"uVZpJw",defaultMessage:"out of space"});case l.UploadErrorType.FILE_SIZE_ERROR:return p.intl.formatMessage({id:"tsdRAZ",defaultMessage:"file too large"});case l.UploadErrorType.CONNECTION_ERROR:return p.intl.formatMessage({id:"vfWhT4",defaultMessage:"lost connection"});case l.UploadErrorType.HTTP_ERROR:return p.intl.formatMessage({id:"b/nZwr",defaultMessage:"server error"});case l.UploadErrorType.EMPTY_OR_FOLDER:return p.intl.formatMessage({id:"Gi+irE",defaultMessage:"can’t upload folders or empty files"});case l.UploadErrorType.FOLDER_SAFARI:return p.intl.formatMessage({id:"Y5AhQP",defaultMessage:"try uploading files separately"});case l.UploadErrorType.PACKAGE_FILE:return p.intl.formatMessage({id:"HjCRjv",defaultMessage:"OSX package file"});case l.UploadErrorType.UPLOAD_PRECHECK_INVALID_CHAR_ERROR:case l.UploadErrorType.INVALID_FILE_NAME:return p.intl.formatMessage({id:"f98azI",defaultMessage:"filename contains invalid character"});case l.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR:case l.UploadErrorType.COMMIT_PERMISSIONS_ERROR:return p.intl.formatMessage({id:"K+VjRY",defaultMessage:"could not apply permissions"});case l.UploadErrorType.INVALID_EXTENSION:return p.intl.formatMessage({id:"1OLuBC",defaultMessage:"file extension is invalid"});case l.UploadErrorType.BLOCKS_MISSING_ERROR:case l.UploadErrorType.COMMIT_HTTP_ERROR:case l.UploadErrorType.UPLOAD_BLOCK_ERROR:case l.UploadErrorType.SERVER_RESPONSE_ERROR:case l.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR:case l.UploadErrorType.SERVER_TOKENS_MISSING_ERROR:case l.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case l.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case l.UploadErrorType.HASHES_NOT_EQUAL_ERROR:case l.UploadErrorType.UPLOAD_PRECHECK_ERROR:case l.UploadErrorType.START_UPLOAD_SESSION_ERROR:case l.UploadErrorType.GENERIC:case l.UploadErrorType.LOCKED_TEAM_ERROR:case l.UploadErrorType.COMMIT_TOO_MANY_WRITES_ERROR:case l.UploadErrorType.COMMIT_UPLOAD_SESSION_GENERIC_ERROR:case l.UploadErrorType.COMMIT_UPLOAD_SESSION_NOT_FOUND:return p.intl.formatMessage({id:"b/nZwr",defaultMessage:"server error"});case l.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case l.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case l.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case l.UploadErrorType.BLOCK_INDEX_ERROR:case l.UploadErrorType.BLOCK_EMPTY_ERROR:case l.UploadErrorType.BLOB_EMPTY_ERROR:case l.UploadErrorType.BLOB_MISSING_ERROR:case l.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case l.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:case l.UploadErrorType.COMMIT_READINESS_ERROR:case l.UploadErrorType.APPEND_BLOCK_MISSING_PARAMS:case l.UploadErrorType.COMMIT_INVALID_ARGS:case l.UploadErrorType.COMMIT_CONFLICT_ERROR:case l.UploadErrorType.IGNORED:return p.intl.formatMessage({id:"NpsjeY",defaultMessage:"upload processing error"})}}(e):p.intl.formatMessage({id:"m/cR6w",defaultMessage:"an unknown error occurred"})}function At(e,t){if(t)return;const a=Ot(e,l.FileStatusType.PENDING),s=p.intl.formatMessage({id:"MZCMJM",defaultMessage:"{count, plural, one{{count} file left} other{{count} files left}}"},{count:a});return a>0?s:p.intl.formatMessage({id:"ut04US",defaultMessage:"View details"})}function Ut(e,t){const a=vt(e),s=Lt(e);if(t)return p.intl.formatMessage({id:"UhMk+M",defaultMessage:"Uploading {filename}"},{filename:o.Emstring.em_snippet(t.name,20)});if(a===bt.UPLOADING)return p.intl.formatMessage({id:"sHyWgn",defaultMessage:"Starting upload..."});if(a===bt.COMPLETE){if(s>1)return p.intl.formatMessage({id:"1I2L6w",defaultMessage:"Uploaded {num_files} files"},{num_files:s});if(1===s){const t=function(e){return e.filter((e=>e.status!==l.FileStatusType.CANCELLED)).last()}(e);return p.intl.formatMessage({id:"JS4aqp",defaultMessage:"Uploaded {filename}"},{filename:o.Emstring.em_snippet(t.name,20)})}return p.intl.formatMessage({id:"5B2AGb",defaultMessage:"Upload canceled"})}return""}function Ft(e,t){const a=vt(e);return t||a!==bt.ERROR?Ut(e,t):function(e){const t=Lt(e),a=Ot(e,l.FileStatusType.FAILED);if(t>1){const s=Ot(e,l.FileStatusType.COMPLETE);return p.intl.formatMessage({id:"bfG+or",defaultMessage:"{count, plural, one{Uploaded {count} of {num_files} files} other{Uploaded {count} of {num_files} files}}"},{count:s,num_files:t})+" - "+p.intl.formatMessage({id:"lTOxVL",defaultMessage:"{count, plural, one{{count} error} other{{count} errors}}"},{count:a})}{const{errorType:t}=e.last();return t===l.UploadErrorType.GENERIC?p.intl.formatMessage({id:"KbJSNk",defaultMessage:"Unable to upload {filename}"},{filename:o.Emstring.em_snippet(e.last().name,20)}):t===l.UploadErrorType.LOCKED_TEAM_ERROR?p.intl.formatMessage({id:"tQ1bJN",defaultMessage:"Can’t upload. Your team no longer has full use of {trademark_business} features."},{trademark_business:F.TRADEMARK_BUSINESS}):p.intl.formatMessage({id:"XwpHsG",defaultMessage:"Unable to upload {filename}: {reason}"},{filename:o.Emstring.em_snippet(e.last().name,20),reason:It(t)})}}(e)}function xt({fileList:e,currentUpload:t,numSecondsLeft:a,onViewDetails:r,onShown:n,onClosed:i,allowParallelUpload:c,campaigns:d,snackbarOpenWithReplay:u}){const m=vt(e);let g;g=m===bt.UPLOADING?"sync":m===bt.ERROR?"fail":"complete";let _="";m===bt.UPLOADING&&a&&(_=" - "+o.format_time_remaining(a));let f=p.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"});m===bt.UPLOADING&&(f="");const h=c?e.find((e=>e.status===l.FileStatusType.UPLOADING)):t,R=Ft(e,h);let S;Lt(e),"complete"===g&&e.filter((e=>e.status!==l.FileStatusType.CANCELLED)).count()>0&&(S=Tt(e,g,{snackbarOpenWithReplay:u},d)),o.Snackbar.manager||"complete"!==g&&"fail"!==g||E.AccessibleAnnounce.polite(R);const M=function(e,t){const a=vt(e);return a===bt.UPLOADING&&t?t.percentUploaded:a===bt.COMPLETE||a===bt.ERROR?100:0}(e,h),T={closeButtonText:f,onCloseClick:()=>{},onTimeout:()=>{},actionButtonText:At(e,Boolean(S)),onActionClick:r,title:R+_,variant:g,timeoutDelayMsForCompleteVariant:15e3,externalProgress:M,onClosed:i,onShown:n,id:"inline-upload-snackbar",isLowPriority:!0,accessibleAnnouncement:R,richSnackbarProps:S};o.Snackbar.manager&&(T.timeoutDelayMsForCompleteVariant=void 0),o.Snackbar.update(s.React$1.createElement(o.Snackbar,Object.assign({},T)))}!function(e){e.UPLOADING="uploading",e.ERROR="error",e.COMPLETE="complete"}(bt||(bt={}));function Dt(e){var{user:t,overQuotaDetails:r,fileUploadMethod:n}=e,i=a.__rest(e,["user","overQuotaDetails","fileUploadMethod"]);const c=i.isTeamUser&&!i.isContentManager,[d,u]=s.React$1.useState(!0),m=()=>{var e;f(),u(!1),null===(e=i.onModalDismissed)||void 0===e||e.call(i)},_=`wb_oq_${n}`,f=()=>{o.NQOQLogger.logCloseModal(_,{modal_type:"billboard"});const{locationCode:e}=h();E(e,"close")};s.React$1.useEffect((()=>{(()=>{const e=l.getOQmodalOQALocationCode(i.pathname);E(e,"view")})(),o.NQOQLogger.logViewModal(_,{modal_type:"billboard"})}),[]);const E=(e,t)=>{if(["ho","fb"].includes(e)){let a;switch(i.overQuotaStatus){case l.OverQuotaStatusType.BASIC_NEAR_QUOTA:a="near";break;case l.OverQuotaStatusType.BASIC_OVER_QUOTA:a="over";break;case l.OverQuotaStatusType.NONE:a="under";break;default:a=void 0}const{trackingButtonLabel:s,buttonUrl:r}=h();o.GrowthEventsLogger.log(`${_}_${e}`,{action:t,button_text:s,destination_url:r.split("?")[0],location:"overlay",quota_status:"over",upsell_type:"modal",initial_quota_status:a})}},h=()=>{const e=l.getOQmodalOQALocationCode(i.pathname);let a=it.OUT_OF_SPACE_URL+`?oqa=${_}_${e}`,s=kt.getMoreSpaceButton,o="get more space";return[l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,l.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(i.overQuotaStatus)?(a=(()=>{let e;return t.is_cdm_member&&!t.is_team_admin&&r&&r.numTeamAdmins>0?r.promptAdminToUpgradeEmailTemplateUrl:(e=r&&1===r.numTeamAdmins?"/plans":"/team/upgrade",new g.URI({path:e,query:{_tk:"over_quota",_camp:"upload_modal",oqa:"upl_b"}}).toString())})(),t.is_cdm_member&&(!t.is_team_admin||r&&r.numTeamAdmins>0)&&(s=kt.askMoreSpaceButton,o="ask for more space")):i.isLockedTeam?(a="/team/decide",s=kt.seeNextStepsButton,o="see next steps"):c&&(a="/help/business/space-limit-full",s=kt.learnMoreButton,o="learn more about dropbox space"),{buttonUrl:a,buttonLabel:s,locationCode:e,trackingButtonLabel:o}},{buttonUrl:R,buttonLabel:S}=h();return s.React$1.createElement(o.Modal,{open:d,onRequestClose:m},s.React$1.createElement(o.Modal.Body,null,s.React$1.createElement("div",null,s.React$1.createElement("div",{style:{width:"60%",margin:"0 auto"}},s.React$1.createElement(D.FilesOld2Spot,null)),s.React$1.createElement(o.Title,null,(()=>{let e=kt.dbxFull;return i.isLockedTeam?e=kt.cantUpload:c&&(e=kt.cantUploadFile),e})()),s.React$1.createElement(o.Text,null,(()=>{let e=kt.dbxOutOfSpace;if(t.is_cdm_member&&[l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,l.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(i.overQuotaStatus)&&r){let a;if(i.overQuotaStatus===l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA)a=p.intl.formatMessage({id:"eVpI8G",defaultMessage:"Your member folder is full, so no new files can be added"});else{const{team_name:e}=o.Viewer.get_viewer();a=p.intl.formatMessage({id:"p8/jOi",defaultMessage:"The {team_name} shared workspace is full, so no new files can be added"},{team_name:e})}e=t.is_team_admin||!r.numTeamAdmins?p.intl.formatMessage({id:"GolcMz",defaultMessage:"{count, plural, one{{dropbox_full_message}. To get more space, upgrade your account.} other{{dropbox_full_message}. To get more space, upgrade to {trademark_business}.}}"},{count:r.numTeamMembers,dropbox_full_message:a,trademark_business:F.TRADEMARK_BUSINESS}):p.intl.formatMessage({id:"yLQ0gT",defaultMessage:"{count, plural, one{{dropbox_full_message}. To get more space, ask your Dropbox admin ({admin_email}).} other{{dropbox_full_message}. To get more space, ask your Dropbox admins ({admin_email} and {num_other_admins} others).}}"},{count:r.numTeamAdmins,dropbox_full_message:a,admin_email:r.teamAdminEmail,num_other_admins:r.numTeamAdmins-1})}if(i.oqFilename&&(e=p.intl.formatMessage({id:"tZnEbs",defaultMessage:"In order to finish uploading {filename}, you need to add more storage to your Dropbox."},{filename:i.oqFilename})),i.isLockedTeam){const t=o.Viewer.get_viewer().work_user;e=t&&t.is_team_admin?kt.teamAdminOutofSpace:kt.teamOutOfSpace}else c&&(e=p.intl.formatMessage({id:"HuFRIc",defaultMessage:"Your Dropbox account is full. To add this file, remove files or ask your admin for more space."}));return e})()))),s.React$1.createElement(o.Modal.Footer,null,s.React$1.createElement(o.Button,{variant:"opacity",onClick:m,"data-testid":"oq-upsell-close-button"},p.intl.formatMessage({id:"1Pqc4z",defaultMessage:"Close"})),s.React$1.createElement(o.Button,{href:R,variant:"primary",onClick:()=>{const{locationCode:e,trackingButtonLabel:t}=h();o.NQOQLogger.logAcceptModal(_,{modal_type:"billboard",cta_text:t}),E(e,"click")},"data-testid":"oq-upsell-confirm-button"},S)))}const kt={dbxOutOfSpace:p.intl.formatMessage({id:"Pw8npz",defaultMessage:"You can’t upload files because you’re out of storage space. Before you can upload to Dropbox, you need to get more space."}),dbxFull:p.intl.formatMessage({id:"8R3KaE",defaultMessage:"Your Dropbox is full"}),cantUpload:p.intl.formatMessage({id:"SeVOq4",defaultMessage:"Can’t upload to Dropbox"}),cantUploadFile:p.intl.formatMessage({id:"uFwg1z",defaultMessage:"Can’t upload file"}),teamAdminOutofSpace:p.intl.formatMessage({id:"lyIL9W",defaultMessage:"Your team no longer has full use of {trademark_business} features. Add your billing info now and you can pick up right where you left off."},{trademark_business:F.TRADEMARK_BUSINESS}),teamOutOfSpace:p.intl.formatMessage({id:"0Z3ZFO",defaultMessage:"Your team no longer has full use of {trademark_business} features. To keep using {trademark_business}, contact your admin."},{trademark_business:F.TRADEMARK_BUSINESS}),getMoreSpaceButton:p.intl.formatMessage({id:"eE3bQq",defaultMessage:"Get more space"}),askMoreSpaceButton:p.intl.formatMessage({id:"J1cfo9",defaultMessage:"Ask for more space"}),seeNextStepsButton:p.intl.formatMessage({id:"4LQCKL",defaultMessage:"See next steps"}),learnMoreButton:p.intl.formatMessage({id:"NWOHm8",defaultMessage:"Learn more about Dropbox space"})},Nt=(e,t)=>e&&t?`wb_nq_${e}_${"/h"===t?"ho":"fb"}`:"upl_nq",Pt=e=>{const t=e.oqa?`?oqa=${e.oqa}`:"";return s.React$1.createElement("div",{className:"nearquota-alt-action"},s.React$1.createElement(o.Banner,{type:"warning"},s.React$1.createElement(o.Banner.Message,null,p.intl.formatMessage({id:"6DbW2J",defaultMessage:"You’re almost out of storage space."})),s.React$1.createElement(o.Banner.Actions,null,s.React$1.createElement(o.Button,{variant:"transparent",key:"nq-link",href:`/low-space${t}`},p.intl.formatMessage({id:"aIkHtJ",defaultMessage:"Add storage"})))))};Pt.displayName="NearquotaUploadAltActionComponent";const wt=o.requireCssWithComponent(Pt,["/static/metaserver/static/css/nearquota_upload_alt_action-vflOyxyD8.css"]);class $t extends s.React$1.Component{render(){return s.React$1.createElement("div",{onKeyDown:e=>{27===e.keyCode&&e.isDefaultPrevented()&&e.stopPropagation()},style:{display:"inline-block"}},this.props.children)}}$t.Capture=e=>s.React$1.createElement("div",{onKeyDown:e=>{27===e.keyCode&&e.preventDefault()}},e.children),$t.displayName="EscapeKeyGuard";const Bt=e=>{const t=s.React$1.useRef(null),a=s.React$1.useRef(null),i=s.React$1.useRef(null),u=o.useSelector(c.getUser),m=o.useSelector(c.getPath),g=o.useSelector(c.getFileList),_=o.useSelector(c.getNumDraggingFiles),f=o.useSelector(c.getOverQuotaStatus),[E,h]=s.React$1.useState(!0),R=o.usePrevious(g);s.React$1.useEffect((()=>{if(R&&g.count()>R.count()){S();const e=a.current;let t;null!=e&&(e.querySelectorAll(".upload-file")&&(t=e.querySelectorAll(".upload-file")[R.count()]),t&&t.scrollIntoView({behavior:"smooth"}))}}),[g]);const S=()=>{var e;null===(e=i.current)||void 0===e||e.focus()},M=s.React$1.useMemo((()=>g.some((e=>e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING))),[g]),T=t=>{e.handleAddMoreFilesOrFolder(t),t?r.logUploadAction({user:u,action:o.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,chooser_type:l.ChooserType.FOLDER,upload_method:n.UploadMethod.CHOOSER}):r.logUploadAction({user:u,action:o.WebUserActionLogEvent.UPLOAD_FILES_CLICK,chooser_type:l.ChooserType.FILE,upload_method:n.UploadMethod.CHOOSER})},y=s.React$1.useCallback((t=>{V.ActionsAdapter.emit("fileCanceled",{uploadFiles:[t]});o.logEvent(r.PAP_Upload_File({eventState:"canceled",fileSize:t.size,fileType:(e=>k.getFileTypeFromString(o.file_extension(e.name)))(t),batchIdString:t.batchId,uploadId:t.uploadId})),e.handleCancelUpload(t)}),[e.handleCancelUpload]),C=()=>{h(!1),e.onModalDismissed&&e.onModalDismissed()},b=M?p.intl.formatMessage({id:"5fnw5C",defaultMessage:"Hide"}):p.intl.formatMessage({id:"VHlGpS",defaultMessage:"Done"}),v=Kt(u,e.isTeamOnboarding,f),O=d.is_input_webkitdirectory_supported()?s.React$1.createElement(Qt,{user:u,handleFileChoose:T}):s.React$1.createElement(o.Button,{ref:i,variant:"opacity",onClick:()=>{T(!1),r.logUploadAction({user:u,action:o.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})}},p.intl.formatMessage({id:"9LGAlt",defaultMessage:"Add more files"}));return s.React$1.createElement("div",{ref:t},s.React$1.createElement(G.UXAnalyticsModalTracking,{id:"uploader-modal"}),s.React$1.createElement(o.Modal,{className:"uploader-modal-root","aria-label":v,title:v,open:E,width:660,withCloseButton:"Close",shouldCloseOnOverlayClick:!0,onRequestClose:C,shouldFocusAfterRender:!0,onLoad:S},s.React$1.createElement("div",{"data-testid":"uploader-modal-root"}),s.React$1.createElement(Wt,{user:u,path:m,numDraggingFiles:_}),s.React$1.createElement(o.Modal.Header,{hasBottomSpacing:"title-standard"},s.React$1.createElement(o.Modal.Title,null,v)),s.React$1.createElement(o.Text,{variant:"paragraph",size:"standard",tagName:"h3",className:l.modalSubtitle},p.intl.formatMessage({id:"MlWtl7",defaultMessage:"Drag and drop here to add more"})),s.React$1.createElement(o.Modal.Body,{className:"uploader-modal-body",tabIndex:0,hasVerticalSpacing:!1},s.React$1.createElement("ol",{ref:a,id:"upload-files-list",className:"upload-files-list"},g.toArray().map((t=>s.React$1.createElement(Gt,{key:t.uploadId,file:t,getCMUriForFqPath:e.getCMUriForFqPath,handleFileCancel:y,isContentManager:e.isContentManager,isSomethingUploading:M,shouldShowDestinationLink:e.shouldShowDestinationLink,user:u,expUserLevelSharingSettings:e.expUserLevelSharingSettings})))),(()=>{if(g.some((e=>e.status===l.FileStatusType.COMPLETE))&&f===l.OverQuotaStatusType.BASIC_NEAR_QUOTA){const t=Nt(e.lastFileUploadMethod,o.get_uri().path);return s.React$1.createElement(wt,{oqa:t})}return null})()),s.React$1.createElement(o.Modal.Footer,{className:"uploader-modal-footer"},s.React$1.createElement(Ht,null),O,s.React$1.createElement(o.Button,{"data-testid":"uploader-modal-primary-action",variant:"primary",onClick:()=>{r.logUploadAction({user:u,action:o.WebUserActionLogEvent.CLOSE_MODAL_CLICK}),C()}},b))))};Bt.displayName="UploadStatusModal";const Gt=({file:e,getCMUriForFqPath:t,handleFileCancel:a,isContentManager:r,isSomethingUploading:n,shouldShowDestinationLink:i,user:c,expUserLevelSharingSettings:d})=>{let u;u=e.status===l.FileStatusType.UPLOADING?e.percentUploaded:e.status===l.FileStatusType.PENDING?0:100;const m={"upload-file":!0,complete:e.status===l.FileStatusType.COMPLETE,cancelled:e.status===l.FileStatusType.CANCELLED,error:e.status===l.FileStatusType.FAILED},g=o.classnames(m),_=o.Emstring.em_snippet(e.name,13),f=e.size?o.format_bytes(e.size):"",E=s.React$1.createRef(),h=null==e?void 0:e.numSecondsLeft,R=n&&h?o.format_time_remaining(h):"",S=p.intl.formatMessage({id:"n0GA/S",defaultMessage:"In queue"});return s.React$1.createElement("li",{className:g,key:e.uploadId,style:{backgroundSize:u+"% 4px"}},s.React$1.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},s.React$1.createElement(zt,{file:e,handleFileCancel:a}),s.React$1.createElement("div",{className:"filename-col"},s.React$1.createElement(o.FileIcon,{className:"brws-file-name-cell-icon",path:e.name,role:"presentation"}),s.React$1.createElement("span",{className:"filename"}," ",_," "),e.status===l.FileStatusType.COMPLETE&&s.React$1.createElement("span",{className:"size"}," ",f," ")),e.status===l.FileStatusType.COMPLETE&&i&&s.React$1.createElement(qt,{file:e,isContentManager:r,getCMUriForFqPath:t}),e.status===l.FileStatusType.FAILED&&s.React$1.createElement(Vt,{file:e,isContentManager:r,user:c}),e.status===l.FileStatusType.PENDING&&s.React$1.createElement("div",{className:"time-left"},S),e.status===l.FileStatusType.UPLOADING&&s.React$1.createElement("div",{className:"time-left"},R),e.status===l.FileStatusType.COMPLETE&&s.React$1.createElement(jt,{user:c,modalRef:E,file:e,expUserLevelSharingSettings:d}),s.React$1.createElement("div",{ref:E})))};Gt.displayName="UploadModalFileListRow";const zt=({file:e,handleFileCancel:t})=>{const a=a=>{a.preventDefault(),t(e)};if(e.status===l.FileStatusType.UPLOADING&&100===e.percentUploaded)return s.React$1.createElement("div",{className:"status-col"},s.React$1.createElement(P.IconStatus,{height:"16px",width:"16px","aria-label":p.intl.formatMessage({id:"dyc22F",defaultMessage:"Finishing upload"}),name:"sync"}));if(e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING)return s.React$1.createElement("div",{className:"status-col"},s.React$1.createElement(o.Button,{variant:"transparent",className:"upload-cancel-button","data-testid":"upload-cancel-button",onClick:a},s.React$1.createElement(w.IconChooser,{name:"search-cancel","aria-label":p.intl.formatMessage({id:"1B7zHK",defaultMessage:"Cancel"})})));let r,n="complete";switch(e.status){case l.FileStatusType.COMPLETE:n="complete",r=p.intl.formatMessage({id:"Pr70Iu",defaultMessage:"Completed"});break;case l.FileStatusType.CANCELLED:n="warn",r=p.intl.formatMessage({id:"4OM0H+",defaultMessage:"Upload canceled"});break;case l.FileStatusType.FAILED:n="fail",r=p.intl.formatMessage({id:"QFMGYv",defaultMessage:"Error"});break;default:return s.React$1.createElement("div",{className:"status-col"})}return s.React$1.createElement("div",{className:"status-col"},s.React$1.createElement(P.IconStatus,{height:"16px",width:"16px","aria-label":r,name:n}))};zt.displayName="FileListRowStatus";const qt=({file:e,isContentManager:t,getCMUriForFqPath:a})=>{if(e.status===l.FileStatusType.CANCELLED)return s.React$1.createElement("div",{className:"dest-col"},p.intl.formatMessage({id:"E9pip7",defaultMessage:"Canceled"}));let r,n;const i=o.Viewer.get_viewer().get_user_by_id(e.userId);return t?(r="",n=a(e.dest)):(r=B.get_browse_root_name(i),n=o.browse_uri_for_fq_path(i,e.dest).toString()),s.React$1.createElement("div",{className:"dest-col"},s.React$1.createElement("a",{href:n},s.React$1.createElement(z.TruncatedString,{text:`${r}${e.dest}`,variant:z.TruncatedStringVariant.TRUNCATED_STRING_START})))};qt.displayName="FileListRowDest";const Vt=({file:e,isContentManager:t,user:a})=>{let r,n;return r=e.errorMessage&&e.errorMessage.length>0?e.errorMessage:p.intl.formatMessage({id:"o6vFum",defaultMessage:"Something went wrong while uploading this file."}),n=e.errorType===l.UploadErrorType.FILE_SIZE_ERROR?p.intl.formatMessage({id:"TbtJyb",defaultMessage:"File too large"}):p.intl.formatMessage({id:"BG2rbV",defaultMessage:"Upload Error"}),g.assert(null!=a,"user is null"),a.is_team&&e.errorType===l.UploadErrorType.OVER_QUOTA_ERROR&&!t&&(r=p.intl.formatMessage({id:"1/Swud",defaultMessage:"Your Dropbox account is full. To add this file, remove files or ask your admin for more space."}),n=p.intl.formatMessage({id:"jmkpma",defaultMessage:"Can’t upload file"})),s.React$1.createElement("div",{className:"error-col"},s.React$1.createElement("span",{className:"error-msg"},n),s.React$1.createElement("span",{className:"error-details"},s.React$1.createElement(o.Tooltip,{placement:"right",title:r},s.React$1.createElement("div",{className:"error-details-tooltip-target",tabIndex:0},s.React$1.createElement(N.IconInline,{name:"info","aria-label":p.intl.formatMessage({id:"0JARub",defaultMessage:"More information"})})))))};Vt.displayName="FileListRowError";const Qt=({user:e,handleFileChoose:t})=>s.React$1.createElement($t,null,s.React$1.createElement(o.Menu.Wrapper,{onSelection:t,onToggle:({isOpen:t})=>{t&&r.logUploadAction({user:e,action:o.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})}},(({getContentProps:e,getTriggerProps:t})=>s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Button,Object.assign({},t(),{variant:"opacity"}),p.intl.formatMessage({id:"mChtPJ",defaultMessage:"Add more files"})),s.React$1.createElement(o.Menu.Content,Object.assign({},e(),{placement:"top"}),s.React$1.createElement(o.Menu.Segment,null,s.React$1.createElement($t.Capture,null,s.React$1.createElement(o.Menu.ActionItem,{key:"Files",value:!1,className:"action-upload-files",disabled:!1},s.React$1.createElement(o.UIIcon,{src:$.UploadFileLine,className:"popover-item-icon"}),p.intl.formatMessage({id:"v/OFBA",defaultMessage:"Files"})),s.React$1.createElement(o.Menu.ActionItem,{key:"Folder",value:!0,className:"action-upload-folder",disabled:!1},s.React$1.createElement(o.UIIcon,{src:$.UploadFolderLine,className:"popover-item-icon"}),p.intl.formatMessage({id:"kEZNl7",defaultMessage:"Folder"})))))))));Qt.displayName="AddMoreFilesMenu";const jt=({file:e,user:t,modalRef:a,expUserLevelSharingSettings:r})=>{const n=p.intl.formatMessage({id:"8QMEOE",defaultMessage:"Copy link"});return s.React$1.createElement(o.Button,{className:"copy-link-button",variant:"opacity",onClick:()=>((e,a)=>{if(t){const s=(e,t)=>{o.getStoreForBrowse().dispatch({type:o.ActionTypes$1.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:t,isCreatingSharedLink:e}})};L.CopyLinkMiniModal.show({user:t,filePath:e.dest+"/"+e.name,setIsCreatingSharedLink:s,anchorRef:a,zIndexOverride:1e4,userActionSource:o.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL,yOffsetDistance:20,isInUserLevelSharingSettings:"ON"===r},"copy-link-modal")}})(e,a)},n)};jt.displayName="CopyLinkButton";const Ht=()=>s.React$1.createElement("div",{className:"upload-modal-link"},p.intl.formatMessage({id:"V4uuab",defaultMessage:"Having problems? Please try again or see our Help center <a>here</a>."},{a:e=>s.React$1.createElement("a",{key:"modal-link",href:"/help/space/upload-limitations",rel:"noopener noreferrer",target:"_blank"},e)}));Ht.displayName="HelpLink";const Wt=({numDraggingFiles:e,path:t,user:a})=>{const r=p.intl.formatMessage({id:"KMQkGZ",defaultMessage:"{count, plural, one{Drop your file to {upload_action}} other{Drop your files to {upload_action}}}"},{count:e,upload_action:l.makeUploadSnippet(20,a,t)}),n={[l.modalDropzone]:!0,[l.dropzoneVisible]:e>0,[l.dropzoneContainer]:!0};return s.React$1.createElement(q.DropzoneOutline,{location:"upload_status_modal"},s.React$1.createElement("div",{className:o.classnames(n)},r))};Wt.displayName="Dropzone";const Kt=(e,t,a)=>{let s;return g.assert(null!=e,"user is null"),s=t?p.intl.formatMessage({id:"90d3KF",defaultMessage:"Which files would you like to add?"}):e.is_cdm_member&&a in[l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,l.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA]?p.intl.formatMessage({id:"Px//ha",defaultMessage:"More space needed"}):p.intl.formatMessage({id:"v0yMM4",defaultMessage:"Upload Details"}),s},Yt=e=>!!e.is_team&&o.Viewer.get_viewer().team_is_limited,Jt="d&d-upload-snackbar",Zt={notThisFolderError:p.intl.formatMessage({id:"sVwi15",defaultMessage:"You don’t have permission to add to this folder."}),teamNotLongerTrademark:p.intl.formatMessage({id:"aJ2o2T",defaultMessage:"Can’t upload. Your team no longer has full use of {trademark_business} features."},{trademark_business:F.TRADEMARK_BUSINESS}),lockedVault:p.intl.formatMessage({id:"6ASmGo",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),noDragOnBackups:{defaultMessage:"Files can’t be moved into backups.",description:"Error snackbar when trying to drag a file in backups"}};o.injectInternalStyle("typescript/component_libraries/files_components/src/bottom-drawer/index.module.out.css",(e=>"._bottom-drawer-header_q16fd_1{align-items:center;background-color:var(--color__opacity--1);border:1px solid var(--color__standard__border);box-sizing:content-box;cursor:pointer;display:flex;flex-direction:row;height:40px;justify-content:space-between;margin:0 -1px;padding:0 var(--spacing__unit--2)}._bottom-drawer-inner_q16fd_17{display:flex;flex-direction:column}._bottom-drawer-resize-handle_q16fd_22{background:transparent;cursor:row-resize;height:5px;position:absolute;top:0;width:100%}._bottom-drawer-container_q16fd_31{background-color:var(--color__elevated__background);bottom:0;box-shadow:var(--boxshadow__elevation1);position:fixed;width:440px}._bottom-drawer-body_q16fd_39{flex-grow:1;overflow-y:scroll}._bottom-drawer-footer_q16fd_44{align-items:center;border-top:1px solid var(--color__standard__border);display:flex;flex-direction:row;flex-shrink:0;height:60px;justify-content:right;padding:0 var(--spacing__unit--2)}"));const Xt="_bottom-drawer-header_q16fd_1",ea="_bottom-drawer-inner_q16fd_17",ta="_bottom-drawer-resize-handle_q16fd_22",aa="_bottom-drawer-container_q16fd_31",sa="_bottom-drawer-body_q16fd_39",oa="_bottom-drawer-footer_q16fd_44",ra=({children:e,title:t,initialExpandedHeight:a,maxHeight:r,minHeight:n,progressValue:l,headerRightElement:i,isExpanded:c,toggle:d,footer:u,distanceFromRight:p=8,onResize:m,scrollContainerRef:g,className:_,minDistanceFromTop:f})=>{const[E,h]=s.react.exports.useState(!1),[R,S]=s.react.exports.useState(a),M=s.React$1.useRef(null),T=s.react.exports.useCallback((e=>{var t;null===(t=M.current)||void 0===t||t.releasePointerCapture(e.pointerId),h(!1)}),[]),y=s.react.exports.useCallback((e=>{var t;e.preventDefault(),e.stopPropagation(),h(!0),null===(t=M.current)||void 0===t||t.setPointerCapture(e.pointerId),window.addEventListener("pointerup",T,{once:!0})}),[T]);s.react.exports.useEffect((()=>{const e=e=>{E&&S((t=>{const a=t-e.movementY,s=Math.max(Math.min(a,r),n);return m&&m(s),s}))};return window.addEventListener("pointermove",e),()=>{window.removeEventListener("pointermove",e)}}),[E,r,n,R,m]);const C=`calc(100vh - ${f+40}px)`;return s.React$1.createElement(o.Layer,null,s.React$1.createElement("div",{className:o.classnames(aa,_),role:"alert",style:{right:p},"data-testid":"bottom-drawer_container"},c&&s.React$1.createElement("div",{className:ta,onPointerDown:y,ref:M}),s.React$1.createElement("div",{onClick:d,className:Xt},s.React$1.createElement(o.Text,{"data-test-id":"bottom-drawer-title"},t),i),s.React$1.createElement("div",{style:c?{height:R,maxHeight:C,minHeight:"158px"}:{height:0},className:ea},s.React$1.createElement("div",{"data-testid":"bottom-drawer_body",ref:g,className:sa},e),u&&s.React$1.createElement("div",{className:oa},u)),!c&&void 0!==l&&s.React$1.createElement(o.ProgressBar,{in:!0,value:l})))};ra.displayName="BottomDrawer";o.injectInternalStyle("typescript/component_libraries/files_components/src/persistent-upload/index.module.out.css",(e=>"._upload-file-row-container_1p35g_1{border-bottom:1px solid var(--color__faint__border);height:58px}._upload-file-row_1p35g_1{align-items:center;display:flex;height:54px;justify-content:flex-start;padding:0 var(--spacing__unit--2)}._upload-file-icon--xsmall_1p35g_17{flex-shrink:0;height:24px;width:24px}._upload-status-icon_1p35g_23{flex-shrink:0}._upload-file-row-file-name_1p35g_27{flex-grow:2;padding:0 var(--spacing__unit--1)}"));const na="_upload-file-row-container_1p35g_1",la="_upload-file-row_1p35g_1",ia="_upload-status-icon_1p35g_23",ca="_upload-file-row-file-name_1p35g_27";var da;!function(e){e.COMPLETE="COMPLETE",e.PENDING="PENDING",e.ERROR="ERROR",e.UPLOADING="UPLOADING"}(da||(da={}));const ua=({file:e,status:t,button:a,statusDescription:r,percentUploaded:n,onActive:l,onBlur:i,intl:c})=>s.react.exports.createElement("div",{"data-testid":"persistent-upload-file-row",className:na,onFocus:l,onMouseOver:l,onMouseLeave:i,onBlur:i},s.react.exports.createElement("div",{className:la},s.react.exports.createElement(pa,{status:t,intl:c}),s.react.exports.createElement("div",{className:ca},s.react.exports.createElement(K.LabelGroup,{withText:s.react.exports.createElement(o.Text,{size:"small"},s.react.exports.createElement(J.Truncate,{location:.5,maxWidth:240,"data-testid":"fileRow-fileName"},e.title)),withSubtext:r,withLeftAccessory:s.react.exports.createElement(Y.FileIcon,{file:e,size:"xsmall"})})),a),t===da.UPLOADING&&s.react.exports.createElement(o.ProgressBar,{isStatic:!0,value:n}));ua.displayName="UploadFileRow";const pa=({status:e,intl:t})=>{let a,r,n;switch(e){case da.UPLOADING:a=Z.SyncingLine,r=t.formatMessage({id:"/irRX1",defaultMessage:"Uploading file"});break;case da.PENDING:a=o.ClockLine,r=t.formatMessage({id:"wm1jIe",defaultMessage:"Pending"});break;case da.ERROR:a=o.WarningLine,r=t.formatMessage({id:"OHDEc4",defaultMessage:"Warning icon"}),n="#9B0032";break;case da.COMPLETE:a=o.CheckmarkCircleLine,r=t.formatMessage({id:"r1iZmO",defaultMessage:"Upload Complete"}),n="#2D7A02"}return s.react.exports.createElement(o.UIIcon,{className:ia,src:a,"aria-label":r,role:"status",color:n})};pa.displayName="UploadStatusIcon";const ma=e=>{var{type:t,closeButtonLabel:r,message:n,buttonHref:l,buttonText:i,onRequestClose:c,buttonOnClick:d}=e,u=a.__rest(e,["type","closeButtonLabel","message","buttonHref","buttonText","onRequestClose","buttonOnClick"]);return s.React$1.createElement(o.Banner,Object.assign({type:t,withCloseButton:r,onRequestClose:c},u),s.React$1.createElement(o.Banner.Message,null,n),s.React$1.createElement(o.Banner.Actions,null,i&&s.React$1.createElement(o.Button,{variant:"transparent",key:"nq-link",href:l,onClick:d},i)))};ma.displayName="DrawerBanner";const ga=({scrollToErrorFiles:e,shouldShowScrollButton:t})=>{const r=o.useSelector(c.getFileList),n=o.useSelector(c.getOverQuotaStatus),i=o.useSelector(c.getLastFileUploadMethod),d=r.some((e=>e.status===l.FileStatusType.COMPLETE)),u=r.find((e=>e.status===l.FileStatusType.FAILED)),[p,m]=s.react.exports.useState(!1),[g,_]=s.react.exports.useState(!1);if((n===l.OverQuotaStatusType.BASIC_NEAR_QUOTA||n===l.OverQuotaStatusType.BASIC_OVER_QUOTA)&&d&&!p){const e=Nt(i,o.get_uri().path),t=e?`?oqa=${e}`:"";return s.React$1.createElement(ma,Object.assign({type:"warning",buttonHref:`/low-space${t}`,onRequestClose:()=>m(!0)},_a.nearQuota))}if(void 0!==u&&!g){const r=_a.error,{buttonText:n}=r,l=a.__rest(r,["buttonText"]);return s.React$1.createElement(ma,Object.assign({type:"alert",onRequestClose:()=>_(!0),buttonOnClick:e,buttonText:t?n:"",withLeftIcon:s.React$1.createElement(o.UIIcon,{src:o.WarningLine,role:"presentation"})},l))}return null};ga.displayName="DrawerBannerWrapper";const _a={nearQuota:{closeButtonLabel:p.intl.formatMessage({id:"5VPgNB",defaultMessage:"Dismiss warning"}),message:p.intl.formatMessage({id:"6DbW2J",defaultMessage:"You’re almost out of storage space."}),buttonText:p.intl.formatMessage({id:"aIkHtJ",defaultMessage:"Add storage"})},error:{closeButtonLabel:p.intl.formatMessage({id:"Fv/Ats",defaultMessage:"Dismiss error"}),message:p.intl.formatMessage({id:"KR7ECY",defaultMessage:"There was an error uploading a file."}),buttonText:p.intl.formatMessage({id:"k8tYQo",defaultMessage:"Show errors"})}};function fa(e,t,a){let s,o=[];return()=>{let r;a.key&&null!=a.debug&&a.debug()&&(r=Date.now());const n=e();if(!(n.length!==o.length||n.some(((e,t)=>o[t]!==e))))return s;let l;if(o=n,a.key&&null!=a.debug&&a.debug()&&(l=Date.now()),s=t(...n),null==a||null==a.onChange||a.onChange(s),a.key&&null!=a.debug&&a.debug()){const e=Math.round(100*(Date.now()-r))/100,t=Math.round(100*(Date.now()-l))/100,s=t/16,o=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${o(t,5)} /${o(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*s,120))}deg 100% 31%);`,null==a?void 0:a.key)}return s}}const Ea=e=>e,ha=e=>{const t=Math.max(e.startIndex-e.overscan,0),a=Math.min(e.endIndex+e.overscan,e.count-1),s=[];for(let e=t;e<=a;e++)s.push(e);return s},Ra=(e,t)=>{const a=new ResizeObserver((e=>{var a,s;t({width:null==(a=e[0])?void 0:a.contentRect.width,height:null==(s=e[0])?void 0:s.contentRect.height})}));if(e.scrollElement)return t(e.scrollElement.getBoundingClientRect()),a.observe(e.scrollElement),()=>{a.unobserve(e.scrollElement)}},Sa={element:["scrollLeft","scrollTop"],window:["scrollX","scrollY"]},Ma=(Ta="element",(e,t)=>{if(!e.scrollElement)return;const a=Sa[Ta][0],s=Sa[Ta][1];let o=e.scrollElement[a],r=e.scrollElement[s];const n=()=>{const o=e.scrollElement[e.options.horizontal?a:s];t(Math.max(0,o-e.options.scrollMargin))};n();const l=t=>{const l=t.currentTarget,i=l[a],c=l[s];(e.options.horizontal?o-i:r-c)&&n(),o=i,r=c};return e.scrollElement.addEventListener("scroll",l,{capture:!1,passive:!0}),()=>{e.scrollElement.removeEventListener("scroll",l)}});var Ta;const ya=(e,t)=>Math.round(e.getBoundingClientRect()[t.options.horizontal?"width":"height"]),Ca=(e,t,a)=>{var s;let{adjustments:o,behavior:r,sync:n}=t;const l=(n?e:e+a.options.scrollMargin)+(o??0);null==(s=a.scrollElement)||null==s.scrollTo||s.scrollTo({[a.options.horizontal?"left":"top"]:l,behavior:r})};class ba{constructor(e){var t=this;this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.measurementsCache=[],this.itemMeasurementsCache={},this.pendingMeasuredCacheIndexes=[],this.scrollAdjustments=0,this.measureElementCache={},this.pendingScrollToIndexCallback=null,this.getResizeObserver=(()=>{let e=null;return()=>e||("undefined"!=typeof ResizeObserver?e=new ResizeObserver((e=>{e.forEach((e=>{this._measureElement(e.target,!1)}))})):null)})(),this.range={startIndex:0,endIndex:0},this.setOptions=e=>{Object.entries(e).forEach((t=>{let[a,s]=t;void 0===s&&delete e[a]})),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Ea,rangeExtractor:ha,onChange:()=>{},measureElement:ya,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",...e}},this.notify=()=>{var e,t;null==(e=(t=this.options).onChange)||e.call(t,this)},this.cleanup=()=>{this.unsubs.filter(Boolean).forEach((e=>e())),this.unsubs=[],this.scrollElement=null},this._didMount=()=>{const e=this.getResizeObserver();return Object.values(this.measureElementCache).forEach((t=>null==e?void 0:e.observe(t))),()=>{null==e||e.disconnect(),this.cleanup()}},this._willUpdate=()=>{var e;null==(e=this.pendingScrollToIndexCallback)||e.call(this);const t=this.options.getScrollElement();this.scrollElement!==t?(this.cleanup(),this.scrollElement=t,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0,sync:!0}),this.unsubs.push(this.options.observeElementRect(this,(e=>{this.scrollRect=e,this.calculateRange()}))),this.unsubs.push(this.options.observeElementOffset(this,(e=>{null!==this.isScrollingTimeoutId&&(clearTimeout(this.isScrollingTimeoutId),this.isScrollingTimeoutId=null);const t=e=>{this.isScrolling!==e&&(this.isScrolling=e,this.notify())};this.scrollAdjustments=0,this.scrollOffset!==e&&(this.scrollOffset=e,t(!0)),this.calculateRange(),this.isScrollingTimeoutId=setTimeout((()=>{this.isScrollingTimeoutId=null,t(!1)}),this.options.scrollingDelay)})))):this.isScrolling||this.calculateRange()},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.getMeasurements=fa((()=>[this.options.count,this.options.paddingStart,this.options.getItemKey,this.itemMeasurementsCache]),((e,t,a,s)=>{const o=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const r=this.measurementsCache.slice(0,o);for(let n=o;n<e;n++){const e=a(n),o=s[e],l=r[n-1]?r[n-1].end:t,i="number"==typeof o?o:this.options.estimateSize(n),c=l+i;r[n]={index:n,start:l,size:i,end:c,key:e}}return this.measurementsCache=r,r}),{key:!1,debug:()=>this.options.debug}),this.calculateRange=fa((()=>[this.getMeasurements(),this.getSize(),this.scrollOffset]),((e,t,a)=>{const s=function(e){let{measurements:t,outerSize:a,scrollOffset:s}=e;const o=t.length-1,r=((e,t,a,s)=>{for(;e<=t;){const o=(e+t)/2|0,r=a(o);if(r<s)e=o+1;else{if(!(r>s))return o;t=o-1}}return e>0?e-1:0})(0,o,(e=>t[e].start),s);let n=r;for(;n<o&&t[n].end<s+a;)n++;return{startIndex:r,endIndex:n}}({measurements:e,outerSize:t,scrollOffset:a});return s.startIndex===this.range.startIndex&&s.endIndex===this.range.endIndex||(this.range=s,this.notify()),this.range}),{key:!1,debug:()=>this.options.debug}),this.getIndexes=fa((()=>[this.options.rangeExtractor,this.range,this.options.overscan,this.options.count]),((e,t,a,s)=>e({...t,overscan:a,count:s})),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,a=e.getAttribute(t);return a?parseInt(a,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{const a=this.indexFromElement(e),s=this.measurementsCache[a];if(!s)return;const o=this.measureElementCache[s.key],r=this.getResizeObserver();if(!e.isConnected)return void(o&&(null==r||r.unobserve(o),delete this.measureElementCache[s.key]));o&&o===e||(o&&(null==r||r.unobserve(o)),this.measureElementCache[s.key]=e,null==r||r.observe(e));const n=this.options.measureElement(e,this),l=n-(this.itemMeasurementsCache[s.key]??s.size);0!==l&&(s.start<this.scrollOffset&&this.isScrolling&&this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=l,behavior:void 0,sync:!1}),this.pendingMeasuredCacheIndexes.push(a),this.itemMeasurementsCache={...this.itemMeasurementsCache,[s.key]:n},this.notify())},this.measureElement=e=>{e&&this._measureElement(e,!0)},this.getVirtualItems=fa((()=>[this.getIndexes(),this.getMeasurements()]),((e,t)=>{const a=[];for(let s=0,o=e.length;s<o;s++){const o=t[e[s]];a.push(o)}return a}),{key:!1,debug:()=>this.options.debug}),this.scrollToOffset=function(e,a){let{align:s="start",behavior:o}=void 0===a?{}:a;const r=t.scrollOffset,n=t.getSize();"auto"===s&&(s=e<=r?"start":e>=r+n?"end":"start");const l={adjustments:void 0,behavior:o,sync:!1};"start"===s?t._scrollToOffset(e,l):"end"===s?t._scrollToOffset(e-n,l):"center"===s&&t._scrollToOffset(e-n/2,l)},this.scrollToIndex=function(e,a){let{align:s="auto",...o}=void 0===a?{}:a;t.pendingScrollToIndexCallback=null;const r=t.getMeasurements(),n=t.scrollOffset,l=t.getSize(),{count:i}=t.options,c=r[Math.max(0,Math.min(e,i-1))];if(!c)return;if("auto"===s)if(c.end>=n+l-t.options.scrollPaddingEnd)s="end";else{if(!(c.start<=n+t.options.scrollPaddingStart))return;s="start"}const d="end"===s?c.end+t.options.scrollPaddingEnd:c.start-t.options.scrollPaddingStart;t.scrollToOffset(d,{align:s,...o});if(Object.keys(t.measureElementCache).length>0){const a=()=>"number"==typeof t.itemMeasurementsCache[t.options.getItemKey(e)];a()||(t.pendingScrollToIndexCallback=()=>{a()&&(t.pendingScrollToIndexCallback=null,t.scrollToIndex(e,{align:s,...o}))})}},this.getTotalSize=()=>{var e;return((null==(e=this.getMeasurements()[this.options.count-1])?void 0:e.end)||this.options.paddingStart)+this.options.paddingEnd},this._scrollToOffset=(e,t)=>{let{adjustments:a,behavior:s,sync:o}=t;this.options.scrollToFn(e,{behavior:s,sync:o,adjustments:a},this)},this.measure=()=>{this.itemMeasurementsCache={},this.notify()},this.setOptions(e),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.calculateRange()}}const va="undefined"!=typeof window?s.react.exports.useLayoutEffect:s.react.exports.useEffect;function Oa(e){return function(e){const t=s.react.exports.useReducer((()=>({})),{})[1],a={...e,onChange:a=>{t(),null==e.onChange||e.onChange(a)}},[o]=s.react.exports.useState((()=>new ba(a)));return o.setOptions(a),s.react.exports.useEffect((()=>o._didMount()),[]),va((()=>o._willUpdate())),o}({observeElementRect:Ra,observeElementOffset:Ma,scrollToFn:Ca,...e})}const La="DBX_UPLOAD_DETAILS_DRAWER_OPEN_PREFERENCE";const Ia="DBX_UPLOAD_DETAILS_DRAWER_HEIGHT",Aa=({cancelUploads:e,retryUploads:t,handleAddMoreFilesOrFolder:a,isContentManager:n,getCMUriForFqPath:i,expUserLevelSharingSettings:d})=>{const m=o.useDispatch(),g=o.useSelector(c.getUiDismissed),_=o.useSelector(c.getUiExpanded),E=o.useSelector(c.isUploadInProgress),h=o.useSelector(c.getUser),R=o.useSelector(c.getFileList),S=s.react.exports.useRef(null),M=R.find((e=>e.status===l.FileStatusType.UPLOADING)),T=s.react.exports.useCallback((()=>{r.logUploadAction({user:h,action:_?o.WebUserActionLogEvent.UPLOAD_DRAWER_COLLAPSE:o.WebUserActionLogEvent.UPLOAD_DRAWER_EXPAND}),m(c.uploadActionCreators.setUiExpanded(!_)),function(e,t){try{o.UserLocalStorage.set(e,La,t)}catch(e){f.reportException({err:e,severity:"non-critical",tags:["web_upload"]})}}(h.id,!_)}),[_,h,m]);s.react.exports.useEffect((()=>{const e=function(e){try{return o.UserLocalStorage.get(e,La)}catch(e){return f.reportException({err:e,severity:"non-critical",tags:["web_upload"]}),!0}}(h.id);m(c.uploadActionCreators.setUiExpanded(null==e||e))}),[]),s.react.exports.useEffect((()=>{E&&m(c.uploadActionCreators.setUiDismissed(!1))}),[E]);const y=(()=>{const e=o.useSelector(c.getFileList),t=s.react.exports.useMemo((()=>e.count((({status:e})=>e===l.FileStatusType.COMPLETE))),[e]),a=s.react.exports.useMemo((()=>e.count((({status:e})=>e===l.FileStatusType.FAILED))),[e]),r=s.react.exports.useMemo((()=>e.count((({status:e})=>e===l.FileStatusType.CANCELLED))),[e]),n=e.count()-r,i=t+a,d=o.useSelector(c.getNumSecondsLeft);if(i!==n){const e=p.intl.formatMessage({id:"wp7Ipt",defaultMessage:"Uploading {uploadingFiles, number}{totalFiles, plural, one{ item} other{ of {totalFiles, number} items}}"},{uploadingFiles:t+1,totalFiles:n}),a=d?o.format_time_remaining(d):"",r=p.intl.formatMessage({id:"Boa4tb",defaultMessage:", "});return s.React$1.createElement(s.React$1.Fragment,null,e,a&&`${r}${a}`)}const u=p.intl.formatMessage({id:"sTSEFF",defaultMessage:", {failedFiles, plural, one{{failedFiles, number} upload} other{{failedFiles, number} uploads}} failed"},{failedFiles:a}),m=p.intl.formatMessage({id:"+ejiKL",defaultMessage:"{completeFiles, number} {completeOrFailed, plural, one{upload} other{ of {completeOrFailed, number} uploads}} complete"},{completeFiles:t,completeOrFailed:i});return s.React$1.createElement(s.React$1.Fragment,null,m,a>0&&u)})(),C=s.react.exports.useMemo(Ua,[E]),b=s.react.exports.useRef(C),v=(()=>{var e;const t=s.react.exports.useMemo((()=>document.getElementById("sidebar-portal")),[]),[a,o]=s.react.exports.useState(null!==(e=null==t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0),r=s.react.exports.useRef();return s.react.exports.useEffect((()=>{var e;return r.current=new X.index((e=>{const t=e[0];o(t.contentRect.width)})),t&&(null===(e=r.current)||void 0===e||e.observe(t)),()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.disconnect()}}),[]),null===t?0:a})(),O=(()=>{var e;const t=s.react.exports.useMemo((()=>document.getElementById("global-header-portal")),[]),[a,o]=s.react.exports.useState(null!==(e=null==t?void 0:t.getBoundingClientRect().bottom)&&void 0!==e?e:0);return s.react.exports.useEffect((()=>{const e=u.debounce((()=>{t&&o(t.getBoundingClientRect().bottom)}),32,{trailing:!0});return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),a})(),L=Oa({count:R.count(),getScrollElement:()=>S.current,estimateSize:()=>59,overscan:6}),I=s.react.exports.useCallback((e=>{localStorage.setItem(Ia,`${e}`),b.current=e}),[]),A=s.react.exports.useMemo((()=>R.reduce(((e,t)=>t.status===l.FileStatusType.FAILED||t.status===l.FileStatusType.CANCELLED?e:e+1),0)),[R]),U=59*A,F=(e=>{const[t,a]=s.react.exports.useState(0);return s.react.exports.useEffect((()=>{const t=u.debounce((()=>{var t;a(null!==(t=null==e?void 0:e.scrollTop)&&void 0!==t?t:0)}),50,{trailing:!0});return null==e||e.addEventListener("scroll",t),()=>null==e?void 0:e.removeEventListener("scroll",t)}),[e]),t})(S.current),x=F<=U-(b.current-118)||F>U,D=s.react.exports.useCallback((()=>{r.logUploadAction({user:h,action:o.WebUserActionLogEvent.UPLOAD_SCROLL_TO_ERRORS}),L.scrollToIndex(A,{align:"start"})}),[R]),k=o.useSelector(c.getUiCanShow)&&!g,N=!g&&!E;return k?s.React$1.createElement(o.LayerContext.Provider,{value:{zIndex:10}},s.React$1.createElement(ra,{className:l.drawer,isExpanded:_,toggle:T,initialExpandedHeight:C,maxHeight:640,minHeight:380,title:y,progressValue:null==M?void 0:M.percentUploaded,distanceFromRight:v+9,onResize:I,scrollContainerRef:S,minDistanceFromTop:O+8,headerRightElement:s.React$1.createElement("div",null,s.React$1.createElement(o.IconButton,{variant:"transparent",onClick:T,"aria-label":_?Ba.collapsedLabel:Ba.expandedLabel,className:l.drawerCloseButton,"data-testid":"persistent-upload-toggle-button"},s.React$1.createElement(o.UIIcon,{src:_?o.ChevronDownLine:o.ChevronUpLine})),N&&s.React$1.createElement(o.IconButton,{variant:"transparent",onClick:e=>{e.stopPropagation(),m(c.uploadActionCreators.setUiDismissed(!0))},"aria-label":Ba.dismissLabel,className:l.drawerCloseButton,"data-testid":"persistent-upload-dismiss-button"},s.React$1.createElement(o.UIIcon,{src:o.CloseLine}))),footer:s.React$1.createElement(ka,{cancelUploads:e,retryUploads:t,handleAddMoreFilesOrFolder:a,uploadInProgress:E})},s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Layer,{isPortaled:!1,className:l.drawerBannerContainer,"data-testid":"drawer-banner-container"},s.React$1.createElement(ga,{shouldShowScrollButton:x,scrollToErrorFiles:D})),s.React$1.createElement(Fa,{cancelUploads:e,retryUploads:t,isContentManager:n,getCMUriForFqPath:i,rowVirtualizer:L,expUserLevelSharingSettings:d})))):null},Ua=()=>{const e=localStorage.getItem(Ia);if(e){const t=parseInt(e,10);return isNaN(t)?380:t}return 380},Fa=({cancelUploads:e,retryUploads:t,isContentManager:a=!1,getCMUriForFqPath:r,rowVirtualizer:n,expUserLevelSharingSettings:l})=>{const i=o.useSelector(c.getSortedUploads),d=o.useSelector(c.getUser);return s.React$1.createElement("div",{style:{height:`${n.getTotalSize()}px`,width:"100%",position:"relative"}},n.getVirtualItems().map((o=>{const n=i[o.index];return s.React$1.createElement("div",{key:n.uploadId,"data-index":o.index,style:{width:"100%",position:"absolute",top:0,left:0,transform:`translateY(${o.start}px)`}},s.React$1.createElement(xa,{file:n,cancelUploads:e,retryUploads:t,isContentManager:a,getCMUriForFqPath:r,user:d,expUserLevelSharingSettings:l}))})))};Fa.displayName="DetailsDrawerItems";const xa=({cancelUploads:e,file:t,isContentManager:a,getCMUriForFqPath:n,user:i,expUserLevelSharingSettings:c,retryUploads:d})=>{const u={uniqueKey:t.uploadId,title:t.name,isFolder:!1},m=a?n(t.dest):o.browse_uri_for_fq_path(i,t.dest).toString(),g=$a(t.status,t.percentUploaded,t.numSecondsLeft,t.size);return s.React$1.createElement(ua,{intl:p.intl,key:t.uploadId,file:u,status:wa(t.status),statusDescription:t.status!==da.COMPLETE?g:s.React$1.createElement(Da,{destination:(_=t.dest,_||a?_||p.intl.formatMessage({id:"tWz/Xr",defaultMessage:"Files"}):B.get_browse_root_name(i)),url:m}),percentUploaded:t.percentUploaded,button:(t=>{if(t.status===l.FileStatusType.SET_PERMISSIONS||t.status===l.FileStatusType.PENDING||t.status===l.FileStatusType.UPLOADING){const a=t.status===l.FileStatusType.UPLOADING&&100===t.percentUploaded;return s.React$1.createElement(o.Button,{variant:"opacity",disabled:a,onClick:()=>{V.ActionsAdapter.emit("fileCanceled",{uploadFiles:[t]}),o.logEvent(r.PAP_Upload_File({eventState:"canceled",fileSize:t.size,fileType:l.getFileType(t),batchIdString:t.batchId,uploadId:t.uploadId})),e([t])}},s.React$1.createElement(o.Text,{isBold:!0,size:"small",color:a?"disabled":"standard"},Ba.cancelButton))}if(t.status===l.FileStatusType.FAILED||t.status===l.FileStatusType.CANCELLED||t.status===l.FileStatusType.CANCELLING){const e=t.status===l.FileStatusType.CANCELLING;return W.UPLOAD_MANUAL_RETRY?s.React$1.createElement(o.Button,{variant:"opacity",disabled:e,onClick:()=>{r.logUploadAction({user:i,action:o.WebUserActionLogEvent.RETRY_UPLOAD_CLICK,upload:t}),d([t])}},s.React$1.createElement(o.Text,{isBold:!0,size:"small",color:e?"disabled":"standard"},Ba.retryButton)):null}if(t.status===l.FileStatusType.COMPLETE)return s.React$1.createElement(Pa,{user:i,file:t,expUserLevelSharingSettings:c})})(t)});var _},Da=({destination:e,url:t})=>{let a=e;return e.includes("/")&&(a=e.split("/").slice(-1)[0]),s.React$1.createElement(o.Text,{size:"small",color:"faint",className:l.drawerDestinationLinkWrapper},s.React$1.createElement("span",{className:l.drawerDestinationPrefix},Ba.uploadedTo," "),s.React$1.createElement(o.LinkWrapper,{"data-testid":"persistent-upload-drawer-destination-link",href:t,className:l.drawerDestinationLink},s.React$1.createElement(J.Truncate,{maxWidth:150,location:.5},a)))};Da.displayName="UploadCompleteSubText";const ka=({cancelUploads:e,retryUploads:t,handleAddMoreFilesOrFolder:a,uploadInProgress:i})=>{const u=o.useSelector(c.getUser),p=o.useSelector(c.getFailedOrCanceledUploads),m=o.useSelector(c.getCancellingUploads),g=s.react.exports.useMemo((()=>p.size>0||m.size>0),[m.size,p.size]),_=s.react.exports.useMemo((()=>0===p.size&&m.size>0),[m.size,p.size]),f=e=>{a(e),e?r.logUploadAction({user:u,action:o.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,chooser_type:l.ChooserType.FOLDER,upload_method:n.UploadMethod.CHOOSER}):r.logUploadAction({user:u,action:o.WebUserActionLogEvent.UPLOAD_FILES_CLICK,chooser_type:l.ChooserType.FILE,upload_method:n.UploadMethod.CHOOSER})};return s.React$1.createElement(s.React$1.Fragment,null,W.UPLOAD_MANUAL_RETRY&&g&&s.React$1.createElement(o.Button,{variant:"opacity",className:l.drawerFooterButton,disabled:_,onClick:()=>t(p.toArray())},s.React$1.createElement(o.Text,{size:"small",isBold:!0,color:_?"disabled":"standard"},Ba.retryAllButton)),d.is_input_webkitdirectory_supported()?s.React$1.createElement(Na,{user:u,handleFileChoose:f}):s.React$1.createElement(o.Button,{variant:"primary",onClick:()=>{f(!1),r.logUploadAction({user:u,action:o.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})}},Ba.addMore))};ka.displayName="DetailsDrawerFooter";const Na=({user:e,handleFileChoose:t})=>s.React$1.createElement(o.Menu.Wrapper,{onSelection:t,onToggle:({isOpen:t})=>{t&&r.logUploadAction({user:e,action:o.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})}},(({getContentProps:e,getTriggerProps:t})=>s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Button,Object.assign({},t(),{variant:"primary",withDropdownIcon:!0}),Ba.addMore),s.React$1.createElement(o.Menu.Content,Object.assign({},e(),{placement:"top"}),s.React$1.createElement(o.Menu.Segment,null,s.React$1.createElement(o.Menu.ActionItem,{key:"Files",value:!1,className:"action-upload-files",disabled:!1},s.React$1.createElement(o.UIIcon,{src:$.UploadFileLine,className:"popover-item-icon"}),p.intl.formatMessage({id:"v/OFBA",defaultMessage:"Files"})),s.React$1.createElement(o.Menu.ActionItem,{key:"Folder",value:!0,className:"action-upload-folder",disabled:!1},s.React$1.createElement(o.UIIcon,{src:$.UploadFolderLine,className:"popover-item-icon"}),p.intl.formatMessage({id:"kEZNl7",defaultMessage:"Folder"})))))));Na.displayName="AddMoreFilesMenu";const Pa=({file:e,user:t,expUserLevelSharingSettings:a})=>{const r=s.react.exports.useRef(null),n=p.intl.formatMessage({id:"8QMEOE",defaultMessage:"Copy link"});return s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Button,{ref:r,className:o.classnames("copy-link-button",l.drawerRowButton),variant:"opacity",onClick:()=>((e,s)=>{if(t){const r=(e,t)=>{o.getStoreForBrowse().dispatch({type:o.ActionTypes$1.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:t,isCreatingSharedLink:e}})};L.CopyLinkMiniModal.show({user:t,filePath:e.dest+"/"+e.name,setIsCreatingSharedLink:r,anchorRef:s,zIndexOverride:1e4,userActionSource:o.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL,yOffsetDistance:20,placement:"bottom-start",isInUserLevelSharingSettings:"ON"===a},"copy-link-modal")}})(e,r)},s.React$1.createElement(o.Text,{isBold:!0,size:"small"},n)))};Pa.displayName="CopyLinkButton",Aa.displayName="UploadDetailsDrawer";const wa=e=>{let t=da.PENDING;switch(e){case l.FileStatusType.SET_PERMISSIONS:case l.FileStatusType.PENDING:t=da.PENDING;break;case l.FileStatusType.UPLOADING:t=da.UPLOADING;break;case l.FileStatusType.CANCELLING:case l.FileStatusType.CANCELLED:case l.FileStatusType.FAILED:t=da.ERROR;break;case l.FileStatusType.COMPLETE:t=da.COMPLETE}return t},$a=(e,t,a,r)=>{const n=1e6;let i=Ba.inQueue;const c=Math.round(t/100*r/n),d=Math.round(r/n),u=` ${c.toLocaleString()}mb / ${d.toLocaleString()}mb -`;switch(e){case l.FileStatusType.SET_PERMISSIONS:case l.FileStatusType.PENDING:i=Ba.inQueue;break;case l.FileStatusType.UPLOADING:i=100===t?Ba.finalizing:`${Ba.uploading}${a?`${W.DISPLAY_UPLOAD_BYTES_COMPLETED?u:""} ${o.format_time_remaining(a)}`:""}...`;break;case l.FileStatusType.CANCELLING:case l.FileStatusType.CANCELLED:i=Ba.canceled;break;case l.FileStatusType.FAILED:i=Ba.uploadError;break;case l.FileStatusType.COMPLETE:i="Uploaded"}return s.React$1.createElement(o.Text,{size:W.DISPLAY_UPLOAD_BYTES_COMPLETED?"xsmall":"small"},i)},Ba={expandedLabel:p.intl.formatMessage({id:"/CSzAZ",defaultMessage:"Expand upload details"}),collapsedLabel:p.intl.formatMessage({id:"B0aPu6",defaultMessage:"Collapse upload details"}),dismissLabel:p.intl.formatMessage({id:"LWeJac",defaultMessage:"Dismiss upload details"}),inQueue:p.intl.formatMessage({id:"FKZydJ",defaultMessage:"In queue..."}),finalizing:p.intl.formatMessage({id:"070Gwl",defaultMessage:"Finalizing..."}),canceled:p.intl.formatMessage({id:"sFCVfQ",defaultMessage:"Canceled"}),uploadError:p.intl.formatMessage({id:"4h/qiz",defaultMessage:"Upload Failed. Please Try Again"}),uploading:p.intl.formatMessage({id:"mQEN7c",defaultMessage:"Uploading"}),cancelButton:p.intl.formatMessage({id:"WrCo9+",defaultMessage:"Cancel"}),retryButton:p.intl.formatMessage({id:"mrNhj0",defaultMessage:"Retry"}),retryAllButton:p.intl.formatMessage({id:"D66NAx",defaultMessage:"Retry all"}),addMore:p.intl.formatMessage({id:"Cor7eb",defaultMessage:"Add more"}),stopUploads:p.intl.formatMessage({id:"+tXJyP",defaultMessage:"Stop uploads"}),uploadedTo:p.intl.formatMessage({id:"J7hC6w",defaultMessage:"Uploaded to"})},Ga=({ajaxInterceptor:e,autoTeamGroupId:t,chooseDestination:c,dragAndDropEnabled:p=!0,isContentManager:m=!1,getBrowseContext:g,rootNSIDForCM:_,handleClickNewFolder:f,uploadConsumerInterface:E,uploaderPostTTIExperiments:h,createShortcutForGdssFile:R,hideInlineSnackbar:S,getCMUriForFqPath:M})=>{const T=s.React$1.useMemo((()=>i.getStoreForUpload()),[]);s.React$1.useEffect((()=>{r.UploaderActions.hasInit||r.UploaderActions.init({chooseDestination:c,isContentManager:m,rootNSIDForCM:_,autoTeamGroupId:t,getBrowseContext:g,handleClickNewFolder:f,uploadConsumerInterface:E}),r.UploaderActions.setAjaxInterceptor(e),r.UploaderActions.setIsContentManager(m),r.UploaderActions.setUser({user:o.getActiveUser()})}),[]);const y=s.React$1.useCallback((e=>a.__awaiter(void 0,void 0,void 0,(function*(){yield r.UploaderActions.cancelUploads({files:e},E),u.uniqBy(e,(({batchId:e})=>e)).forEach((({batchId:e})=>r.reportBatchEndStateIfDone(e,T.getState)))}))),[E]),C=s.React$1.useCallback((e=>{r.UploaderActions.retryUploads({files:e},E)}),[E]),b=s.React$1.useCallback((e=>{const t=l.generateTaskTrackingId();e?r.UploaderActions.chooseFolder(E,n.UploadElement.UPLOAD_MODAL,t):r.UploaderActions.chooseFiles(E,n.UploadElement.UPLOAD_MODAL,t)}),[E]),v=!d.is_mobile_or_tablet(),O=s.React$1.useMemo((()=>"wakeLock"in navigator?navigator.wakeLock:void 0),[]);return s.React$1.createElement(o.Provider,{store:T},s.React$1.createElement(Qa,{isContentManager:m,uploadConsumerInterface:E,getCMUriForFqPath:M,uploaderPostTTIExperiments:h}),p&&s.React$1.createElement(za,{uploadConsumerInterface:E,isContentManager:m,uploaderPostTTIExperiments:h,createShortcutForGdssFile:R}),!S&&!v&&s.React$1.createElement(qa,{uploaderPostTTIExperiments:h,uploadConsumerInterface:E}),v&&s.React$1.createElement(ja,{uploaderPostTTIExperiments:h,cancelUploads:y,retryUploads:C,handleAddMoreFilesOrFolder:b,getCMUriForFqPath:M,isContentManager:m}),void 0!==O&&s.React$1.createElement(Va,{wakeLock:O}))};Ga.displayName="FileUploaderFC";const za=({uploadConsumerInterface:e,uploaderPostTTIExperiments:t,isContentManager:a=!1,createShortcutForGdssFile:r})=>{const n=ct();return dt({uploadConsumerInterface:e,uploaderPostTTIExperiments:t,isContentManager:a,resetDragRefs:n,createShortcutForGdssFile:r}),(()=>{const e=o.useSelector(c.isInternalTransfer),t=o.useSelector(c.getNumDraggingFiles),a=o.useSelector(c.hasPermissionToUploadToFolder),r=o.useSelector(c.isMovingIntoVault),n=o.useSelector(c.getUser),i=o.useSelector(c.getPath),d=o.useSelector(c.getUploadModalType),u=o.usePrevious(t);s.react.exports.useEffect((()=>{if(t>0&&!e){if(null===d)if(!a&&r)o.Snackbar.failSticky(Zt.lockedVault,Jt);else if(c.hasPermissionToUploadToFolder)if(o.Viewer.get_viewer().team_is_locked)o.Snackbar.failSticky(Zt.teamNotLongerTrademark,Jt);else if(o.isBackupBrowse())o.Snackbar.failSticky(Zt.noDragOnBackups,Jt);else{const e=p.intl.formatMessage({id:"WVIgaJ",defaultMessage:"Drop your files to "}),t=l.makeUploadSnippet(1e3,n,i),a=s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Text,{color:"inherit"},e),s.React$1.createElement(o.Text,{color:"inherit",isBold:!0},t)," ");o.Snackbar.show(s.React$1.createElement(o.Snackbar,{title:a,customIcon:j.UploadLine,id:Jt}))}else o.Snackbar.failSticky(Zt.notThisFolderError,Jt)}else u&&u>0&&0===t&&o.Snackbar.close(Jt)}),[a,e,r,d,t,u,i,n])})(),null};za.displayName="UploadDragAndDrop";const qa=({uploaderPostTTIExperiments:e,uploadConsumerInterface:t})=>((({uploaderPostTTIExperiments:e})=>{const t=o.useDispatch(),a=o.useSelector(c.getUser),n=o.useSelector(c.isUploadInProgress),i=o.useSelector(c.isPermissionsAtUploadModalOpen),d=o.useSelector(c.getNumSecondsLeft),u=o.useSelector(c.getFileList),p=o.useSelector(c.getUploadModalType),m=s.react.exports.useRef(!0);s.react.exports.useEffect((()=>{if(null!==p||i)o.Snackbar.close("inline-upload-snackbar");else{if(!n&&(0===u.toArray().filter((e=>e.status!==l.FileStatusType.CANCELLED)).length||m.current))return o.Snackbar.close("inline-upload-snackbar"),void(m.current=!1);xt({fileList:u,onViewDetails:()=>{t(c.uploadActionCreators.setUploadModalType({type:"UPLOAD_MODAL"})),r.logUploadAction({user:a,action:o.WebUserActionLogEvent.VIEW_DETAILS_CLICK})},numSecondsLeft:d,onShown:()=>{},onClosed:()=>{},allowParallelUpload:!0,campaigns:null==e?void 0:e.campaigns,snackbarOpenWithReplay:null==e?void 0:e.snackbarOpenWithReplay}),m.current=!1}}),[t,u,d,i,n,p,a,e])})({uploaderPostTTIExperiments:e}),(({uploadConsumerInterface:e})=>{const t=o.useDispatch(),a=s.react.exports.useRef(H.anyFileUploading(e.uploadItems)),r=s.react.exports.useRef(!1);s.react.exports.useEffect((()=>{const s=()=>{H.numUploadingFiles(e.uploadItems)>1&&(t(c.uploadActionCreators.setUploadModalType({type:"UPLOAD_MODAL"})),r.current=!0)},o=H.anyFileUploading(e.uploadItems);(o&&!a.current||o&&!r.current)&&s(),o!==a.current&&(o||(r.current=!1),a.current=o)}),[t,e.uploadItems])})({uploadConsumerInterface:t}),null);qa.displayName="UploadProgressSnackBar";const Va=({wakeLock:e})=>((e=>{const t=s.react.exports.useRef(null),r=o.useSelector(c.isUploadInProgress),n=s.react.exports.useCallback((()=>a.__awaiter(void 0,void 0,void 0,(function*(){if(!t.current||t.current.released){try{t.current=yield e.request("screen")}catch(e){return!1}document.addEventListener("visibilitychange",l)}return!0}))),[]),l=s.react.exports.useCallback((()=>{null!==t.current&&"visible"===document.visibilityState&&n()}),[]),i=s.react.exports.useCallback((()=>{var e;null===(e=null==t?void 0:t.current)||void 0===e||e.release(),t.current=null,document.removeEventListener("visibilitychange",l)}),[]);s.react.exports.useEffect((()=>(r?n():i(),i)),[n,l,r,i])})(e),null);Va.displayName="UploadPreventSleep";const Qa=({isContentManager:e=!1,uploadConsumerInterface:t,onAllFileUploadsComplete:a,getCMUriForFqPath:d,uploaderPostTTIExperiments:u})=>{(()=>{const e=o.useSelector(c.isUploadInProgress),t=o.useSelector(c.getPendingUploads),a=o.useSelector(c.getUser),n=i.getStoreForUpload();s.react.exports.useEffect((()=>{const s=s=>{if(!e)return;const o={};t.forEach((({batchId:e})=>{o[e]?o[e]++:o[e]=1})),Object.entries(o).forEach((([e,t])=>{r.reportBatchEndStateIfDone(e,n.getState,!0,o[e]),r.logUploadAction({action:r.WebUploadActionEvent.UPLOAD_ABANDONED,batchId:e,num_files_abandoned:t,user:a})}));const l=p.intl.formatMessage({id:"vrk/tc",defaultMessage:"Leaving this page will cancel your uploads."});return s.returnValue=l,l};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)}),[t,e,a])})(),(({isContentManager:e})=>{const t=o.useSelector(c.getUser),a=o.useSelector(c.getFileList),n=o.useSelector(c.getUploadModalType),i=o.useSelector(c.getOverQuotaStatus),d=o.useSelector(c.getOverQuotaDetails),u=o.useSelector(c.getLastFileUploadMethod),p=o.useDispatch(),m=s.react.exports.useCallback((({forceLocked:n=!1,context:m})=>{const g=a.toArray().filter((e=>e.status!==l.FileStatusType.COMPLETE&&(e.errorType===l.UploadErrorType.OVER_QUOTA_ERROR||e.errorType===l.UploadErrorType.GENERIC||e.errorType===l.UploadErrorType.LOCKED_TEAM_ERROR))),_=g&&g[g.length-1]?g[g.length-1].name:void 0,f=n||a.toArray().filter((e=>e.errorType===l.UploadErrorType.LOCKED_TEAM_ERROR)).length>0;_&&l.uploadFailureEmitEventIsOn()||o.mountModal(s.React$1.createElement(Dt,{oqFilename:_,isLockedTeam:f,isContentManager:e,isTeamUser:!!t.is_team,context:m||r.UploaderOverQuotaModalContexts.UNKNOWN,overQuotaStatus:i,onModalDismissed:()=>{p(c.uploadActionCreators.setUploadModalType(null)),o.unmountModal()},user:t,overQuotaDetails:d,fileUploadMethod:u}))}),[p,a,e,u,d,i,t]);s.react.exports.useEffect((()=>{if("OVER_QUOTA_MODAL"===(null==n?void 0:n.type)){const{forceLocked:e,context:t}=n;m({forceLocked:e,context:t})}}),[n,m])})({isContentManager:e}),(({isContentManager:e,uploadConsumerInterface:t,getCMUriForFqPath:a,uploaderPostTTIExperiments:d})=>{const u=o.useDispatch(),p=o.useSelector(c.getUploadModalType),m=Q.useStabilizedCallback((()=>{o.mountModal(s.React$1.createElement(o.Provider,{store:i.getStoreForUpload()},s.React$1.createElement(Bt,{dragAndDropEnabled:!0,isContentManager:e,isTeamOnboarding:!1,shouldShowDestinationLink:!0,onModalDismissed:()=>{u(c.uploadActionCreators.setUploadModalType(null)),o.unmountModal()},handleCancelUpload:e=>r.UploaderActions.cancelUploads({files:[e]},t),handleAddMoreFilesOrFolder:e=>{const a=l.generateTaskTrackingId();e?r.UploaderActions.chooseFolder(t,n.UploadElement.UPLOAD_MODAL,a):r.UploaderActions.chooseFiles(t,n.UploadElement.UPLOAD_MODAL,a)},getCMUriForFqPath:a,expUserLevelSharingSettings:null==d?void 0:d.expUserLevelSharingSettings})))}));s.React$1.useEffect((()=>{o.Modal.setAppElement(document.getElementById("embedded-app")||document.body)}),[]),s.react.exports.useEffect((()=>{"UPLOAD_MODAL"===(null==p?void 0:p.type)&&m()}),[p,m])})({isContentManager:e,uploadConsumerInterface:t,getCMUriForFqPath:d,uploaderPostTTIExperiments:u}),(({uploadConsumerInterface:e,onAllFileUploadsComplete:t})=>{const a=o.useDispatch(),r=o.useSelector(c.getFileList),n=o.useSelector(c.getUser),i=o.useSelector(c.isUploadInProgress),d=s.react.exports.useRef(!1),u=Q.useStabilizedCallback((()=>{const e=r.valueSeq().filter((e=>e.status===l.FileStatusType.COMPLETE)).map((e=>({name:e.name,path:e.dest}))).toArray();V.ActionsAdapter.emit("uploadComplete",{filesAdded:e})})),p=Q.useStabilizedCallback((()=>{r.find((e=>e.errorType===l.UploadErrorType.OVER_QUOTA_ERROR))&&!Yt(n)&&a(c.uploadActionCreators.setUploadModalType({type:"OVER_QUOTA_MODAL"})),null==t||t(r)}));s.react.exports.useEffect((()=>{i!==d.current&&(!i&&d.current&&(u(),p(),a(c.fetchQuotaUpsell())),d.current=i)}),[a,u,p,i,e.uploadItems])})({uploadConsumerInterface:t,onAllFileUploadsComplete:a});const m=o.useDispatch(),g=o.useSelector(c.getOverQuotaDetails);return s.React$1.useEffect((()=>{void 0===g&&m(c.fetchQuotaUpsell())}),[]),null};Qa.displayName="AlwaysPresentHooks";const ja=({uploaderPostTTIExperiments:e,cancelUploads:t,retryUploads:a,getCMUriForFqPath:r,isContentManager:n,handleAddMoreFilesOrFolder:i})=>((({uploaderPostTTIExperiments:e})=>{const t=o.useSelector(c.isUploadInProgress),a=o.useSelector(c.getFileList),r=s.react.exports.useRef(t);s.react.exports.useEffect((()=>{if(r.current!==t){if(!t&&r.current){a.count((e=>e.status!==l.FileStatusType.CANCELLED));const t=null==e?void 0:e.campaigns,r=null==e?void 0:e.snackbarOpenWithReplay,n=Object.assign({},t);delete n["PG Share On Upload"];const i=Tt(a,"complete",{snackbarOpenWithReplay:r},n);i&&o.Snackbar.update(s.React$1.createElement(o.Snackbar,{id:"inline-upload-snackbar",title:"",richSnackbarProps:i}))}r.current=t}}),[a,t,e])})({uploaderPostTTIExperiments:e}),s.React$1.createElement(Aa,{cancelUploads:t,retryUploads:a,handleAddMoreFilesOrFolder:i,getCMUriForFqPath:r,isContentManager:n,expUserLevelSharingSettings:null==e?void 0:e.expUserLevelSharingSettings}));t.FileUploaderFC=Ga}));
//# sourceMappingURL=c_file_uploader_clean_uploader_main.js-vfl__BA7X.map
