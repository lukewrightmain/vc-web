define(["exports","./c_tslib","./c_src_sink_index","./c_file_actions_strings","./e_ui_page_files_router","./c_core_i18n"],(function(e,r,t,o,n,a){"use strict";const i="web_file_actions";const s=({user:e,name:_,destination:u,checkFsw:f,origin:g,surface:m})=>r.__awaiter(void 0,void 0,void 0,(function*(){const p=t.getMetricsReporter$1(),b={surface:m},E={latency:p.createTimer({ns:i,name:"create-folder/latency_ms"},b),completed:p.createStats({ns:i,name:"create-folder/completed"},b)};l(g),n.Snackbar.sync(a.intl.formatMessage(o.createFolderSnackbarProgress),!1,"browse-action");const F=yield n.createFolder(u,_,e,f);if(F.isError&&"path"===F.error[".tag"]&&"file_system_warnings"===F.error.path[".tag"]){n.Snackbar.close("browse-action");return(yield function(e){return r.__awaiter(this,void 0,void 0,(function*(){return new Promise((r=>{n.showFileSystemWarningsModal({fsws:e,onFinalAccept:()=>{r(!0)},onAbortAction:()=>{r(!1)},confirmText:a.intl.formatMessage(o.createFolderFswConfirmText)})}))}))}(F.error.path.details))?yield s({user:e,name:_,destination:u,checkFsw:!1,origin:g,surface:m}):(c(g),{type:"cancel"})}return E.latency.record(),F.isError?("path"===F.error[".tag"]&&"malformed_path"===F.error.path[".tag"]?(n.Snackbar.fail(a.intl.formatMessage(o.createFolderErrorMalformedPath),"browse-action"),E.completed.record(1)):(n.Snackbar.fail(a.intl.formatMessage(o.createFolderErrorGeneric),"browse-action"),E.completed.record(0)),function(e,r,t){n.logWebUserAction({event_name:n.WebUserActionLogEvent.CREATE_FOLDER_ERROR,extra:{error_summary:e||null,error:r||null,origin:t||null}})}(F.error_summary,F.error[".tag"],g),{type:"error",summary:F.error_summary,error:F.error[".tag"]}):(n.Snackbar.complete(a.intl.formatMessage(o.createFolderSnackbarSuccess),"browse-action",void 0),d(g),E.completed.record(1),{type:"success",folder:F.result.metadata})}));function c(e){n.logWebUserAction({event_name:n.WebUserActionLogEvent.CREATE_FOLDER_CANCEL,extra:{origin:e||null}})}function l(e){n.logWebUserAction({event_name:n.WebUserActionLogEvent.CREATE_FOLDER_PENDING,extra:{origin:e||null}})}function d(e){n.logWebUserAction({event_name:n.WebUserActionLogEvent.CREATE_FOLDER_SUCCESS,extra:{origin:e||null}}),n.UserSurvey.trackEvent("create_item","browse")}e.FILE_ACTIONS_AMP_NAMESPACE=i,e.batchContentType=function(e){return e.every((e=>e.is_dir))?"folders":e.every((e=>!e.is_dir))?"files":"mixed"},e.bucketForBatchSize=function(e){return 1===e?"single":e<=10?"small":e<=100?"medium":e<=1e3?"large":"massive"},e.createFolder=s,e.fileFromMetadata=(e,r)=>{if("file"===r[".tag"]){const t=r,o=Object.assign(Object.assign({},e),{fq_path:t.path_display||e.fq_path,icon:t.icon+"_32",revision_id:t.rev,file_id:t.id});return new n.File(o)}return"folder"===r[".tag"]?new n.File(Object.assign(Object.assign({},e),{fq_path:r.path_display||e.fq_path})):e},e.folderFromFolderMetadata=e=>new n.File({file_id:e.id,fq_path:e.path_display||"",icon:e.icon,is_dir:!0}),e.logCreateFolder=function({uid:e,view_type:r,origin:t,source:o}){n.logWebUserAction({user_id:e,event_name:n.WebUserActionLogEvent.CREATE_FOLDER,view_type:r||null,extra:Object.assign({origin:t},o&&{source:o})})},e.logCreateFolderCancel=c,e.logCreateFolderPending=l,e.logCreateFolderSuccess=d,e.recordPathLookupErrors=function(e,r,o){const n={};e.forEach((e=>{if("path_lookup"===e.failure[".tag"]){const r=e.failure.path_lookup[".tag"];n[r]=(n[r]||0)+1}}));for(const e in n)n.hasOwnProperty(e)&&t.getMetricsReporter$1().createStats({ns:i,name:"common/failure/path_lookup"},Object.assign(Object.assign({},o),{lookupFailureType:e,operation:r})).record(n[e])}}));
//# sourceMappingURL=c_files_view_file_actions_file_from_metadata.js-vflRIlBKr.map
