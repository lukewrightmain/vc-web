define(["exports","./e_ui_page_files_router","./c_keymaster","./e_edison","./c_core_browser_detection","./c_lodash-es_lodash"],(function(e,t,s,i,n,c){"use strict";const l="SelectableList",o="SelectableTileGrid";let r="";var a,h,d;function S(t,s,i,n,l,o){switch(t){case e.SelectDirection.PREV:return Math.max(0,s-1);case e.SelectDirection.NEXT:return Math.min(i-1,s+1);case e.SelectDirection.PREV_ROW:case e.SelectDirection.NEXT_ROW:return function(t,s,i,n,l,o=!1){if(s<0||s>=i)return 0;l&&0!==l.length||(l=[0]);const r=c.sortedIndex(l,s),a=l[r]===s?r:r-1,h=l[a],d=(s-h)%n;switch(t){case e.SelectDirection.NEXT_ROW:{const e=l.length;if(a===e-1&&s+n>=i){const e=(i-h)%n;if((s-h)%n<e||0===e)return o?i-1:s}const t=a+1,c=t<l.length?l[t]:i;if(s+n-(n-((c-h)%n||n))<c){const e=c-1;return Math.min(s+n,e)}const r=t+1<e?l[t+1]-1:i-1;return Math.min(c+d,r)}case e.SelectDirection.PREV_ROW:{if(0===a&&s-n<0)return o?0:s;if(s-n>=h)return s-n;const e=l[a-1],t=h-1,i=h-e,c=e+i-(i%n||n);return Math.min(c+d,t)}}}(t,s,i,n,l,o)}}e.SelectableListActionSource=void 0,(a=e.SelectableListActionSource||(e.SelectableListActionSource={})).KEYBOARD="keyboard",a.DRAG_TO_SELECT="drag_to_select",e.SelectDirection=void 0,(h=e.SelectDirection||(e.SelectDirection={}))[h.PREV=0]="PREV",h[h.NEXT=1]="NEXT",h[h.PREV_ROW=2]="PREV_ROW",h[h.NEXT_ROW=3]="NEXT_ROW",e.SelectOptions=void 0,(d=e.SelectOptions||(e.SelectOptions={})).DEFAULT="DEFAULT",d.EXTEND="EXTEND",d.ONLY="ONLY";class u extends i.React$1.PureComponent{constructor(s){super(s),this.isFocused=!1,this.updateSelection=(e,s,i=!1)=>{const{selection:n}=this.props,c=i?e.length?e[0]:this.props.itemIds[0]:n.anchor,l=n.merge({selected:t.immutable.exports.OrderedSet(e),anchor:c});this.props.onSelectionChange(l,s)},this.handleSelectPrevious=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.PREV,e.SelectableListActionSource.KEYBOARD))},this.handleSelectPreviousRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.PREV_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToPrevious=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.PREV,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToPreviousRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.PREV_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleSelectNext=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.NEXT,e.SelectableListActionSource.KEYBOARD))},this.handleSelectNextRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.NEXT_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToNext=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.NEXT,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToNextRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.NEXT_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleKeyboardDeselectAll=t=>{const{selection:s}=this.props;t&&!this.isGlobalEvent(t)||!s.selected.size||this.handleDeselectAll(e.SelectableListActionSource.KEYBOARD)},this.handleDeselectAll=e=>{if(this.updateSelection([],e,!0),i.reactDom.exports.findDOMNode(this).contains(document.activeElement)){const e=document.activeElement;e.blur&&e.blur()}this.props.onDeselectAll&&this.props.onDeselectAll()},this.handleKeyboardSelectAll=t=>{const{itemIds:s,selection:i}=this.props;t&&!this.isGlobalEvent(t)||i.selected.size===s.length||this.handleSelectAll(e.SelectableListActionSource.KEYBOARD)},this.handleSelectAll=e=>{this.updateSelection(this.props.itemIds,e,!0)},this.handleDeselect=(e,t,s)=>{if(t)return this.extendOrShrinkSelectionByFile(e,s);this.updateSelectionById(e,"delete",s)},this.handleSelect=(t,s=e.SelectOptions.DEFAULT,i)=>{if(s===e.SelectOptions.EXTEND)return this.extendOrShrinkSelectionByFile(t);s===e.SelectOptions.ONLY?this.updateSelection([t],i,!0):this.updateSelectionById(t,"add",i)},this.handleFocusFile=e=>{this.setState({focusedFileId:e})},this.isSelectableListEvent=()=>this.isFocused,this.handleFocus=()=>{this.isFocused=!0},this.handleBlur=()=>{this.isFocused=!1},this.state={selection:s.selection,keyScope:s.keyScope}}UNSAFE_componentWillReceiveProps(e){this.props.keyScope!==e.keyScope&&(this.setState({keyScope:e.keyScope}),this.isFocused=!1)}componentDidMount(){this.setupKeyboardShortcuts(),this.setFocusedIdFromSelection(this.props.selection)}componentDidUpdate(e,t){e.selection&&this.props.selection&&e.selection.anchor!==this.props.selection.anchor&&this.setFocusedIdFromSelection(this.props.selection),this.state.keyScope!==t.keyScope&&this.setupKeyboardShortcuts(),e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():this.cleanupKeyboardShortcuts())}componentWillUnmount(){this.cleanupKeyboardShortcuts()}setupKeyboardShortcuts(){const{keyScope:e}=this.state;r=s.key.getScope(),r!==e&&s.key.setScope(e);const t=s.key.filter||(e=>{const t=e.target||e.srcElement;if(!(t instanceof Element))return!0;const s=t.tagName;return!("INPUT"===s||"SELECT"===s||"TEXTAREA"===s)});s.key.filter=e=>{const s=e.target||e.srcElement,i=s.tagName;return(!this.isSelectableListEvent()||"BUTTON"!==i)&&(s instanceof HTMLInputElement&&"checkbox"===s.type||t.call(this,e))},e===l?(s.key("up",e,this.handleSelectPrevious),s.key("shift+up",e,this.handleExtendSelectionToPrevious),s.key("down",e,this.handleSelectNext),s.key("shift+down",e,this.handleExtendSelectionToNext)):e===o&&(s.key("left",e,this.handleSelectPrevious),s.key("shift+left",e,this.handleExtendSelectionToPrevious),s.key("right",e,this.handleSelectNext),s.key("shift+right",e,this.handleExtendSelectionToNext),s.key("up",e,this.handleSelectPreviousRow),s.key("shift+up",e,this.handleExtendSelectionToPreviousRow),s.key("down",e,this.handleSelectNextRow),s.key("shift+down",e,this.handleExtendSelectionToNextRow)),s.key("escape",e,this.handleKeyboardDeselectAll),n.mac?s.key("command+a",e,this.handleKeyboardSelectAll):s.key("ctrl+a",e,this.handleKeyboardSelectAll)}cleanupKeyboardShortcuts(){s.key.clearScope(this.state.keyScope),r&&s.key.setScope(r),s.key.resetFilter()}setFocusedIdFromSelection(e){e.anchor&&0!==e.selected.size&&this.setState({focusedFileId:e.anchor})}selectNeighboringItem(e,t){const{itemIds:s,selection:i,tilesPerRow:n,sectionStartIndices:c}=this.props,l=s.indexOf(i.selected.last()),o=s[S(e,l,s.length,n,c)];this.setState({focusedFileId:o}),this.updateSelection([o],t,!0)}extendSelectionRange(t,s){const{itemIds:i,selection:n,tilesPerRow:c,sectionStartIndices:l}=this.props,o=n.anchor||i[0];if(!o)return;const r=i.indexOf(n.selected.last());let a=n.selected.toArray();const h=i.indexOf(o),{startIndex:d,endIndex:u}=this.getRangeOfSelectedBlock(o);a=function(t,s,i,n,c,l,o,r,a){switch(t){case e.SelectDirection.PREV:case e.SelectDirection.PREV_ROW:{if(0===s)return o;const e=S(t,s,r.length,i,a,!0),h=Math.min(s,n)-e,d=s-Math.max(e,n);for(let e=l;e>l-d;e--){const t=o.indexOf(r[e]);o.splice(t,1)}for(let e=c-1;e>=c-h;e--)o.push(r[e]);break}case e.SelectDirection.NEXT:case e.SelectDirection.NEXT_ROW:{if(s===r.length)return o;const e=S(t,s,r.length,i,a,!0),h=Math.min(e,n)-c,d=e-Math.max(s,n);for(let e=c;e<c+h;e++){const t=o.indexOf(r[e]);o.splice(t,1)}for(let e=l+1;e<=l+d;e++)o.push(r[e]);break}}return o}(t,r,c,h,d,u,a,i,l),this.setState({focusedFileId:a[a.length-1]}),this.updateSelection(a,s)}getRangeOfSelectedBlock(e){const{itemIds:t,selection:s}=this.props;let i=t.indexOf(e),n=0,c=0;for(;n=i,i--,!(i<0)&&s.selected.has(t[i]););for(i=n;;){const e=t[i];if(!e||!s.selected.has(e))break;c=i,i++}return{startIndex:n,endIndex:c}}extendOrShrinkSelectionByFile(e,t){const{itemIds:s,selection:i}=this.props,n=i.anchor||s[0];if(!n)return;const c=s.indexOf(n),l=s.indexOf(e),{startIndex:o,endIndex:r}=this.getRangeOfSelectedBlock(n),a=[],h=[];s.forEach(((e,t)=>{o<=t&&t<=r&&a.push(e),(l<=t&&t<=c||c<=t&&t<=l)&&h.push(e)})),l<c&&h.reverse();const d=i.update("selected",(e=>e.subtract(a).union(h)));this.setState({focusedFileId:e}),this.props.onSelectionChange(d,t)}updateSelectionById(e,t,s){const{selection:i}=this.props,n="add"===t?e:i.anchor,c=i.selected[t](e),l=i.merge({selected:c,anchor:n||null});this.props.onSelectionChange(l,s)}isGlobalEvent(e){const t=e.target instanceof HTMLInputElement,s=e.target instanceof HTMLElement,n=t&&"checkbox"===e.target.type,c=s&&(e.target.classList.contains("mc-popover-selectable-item")||e.target.classList.contains("mc-popover-content-item")||e.target.classList.contains("mc-popover-trigger"));return!document.activeElement||document.activeElement===document.body||e.target instanceof Element&&(i.reactDom.exports.findDOMNode(this).contains(e.target)&&(!t||n)&&!c)}render(){const{children:e}=this.props,{focusedFileId:t}=this.state;if(!e)return null;let s=e;return"function"==typeof e&&(s=e({focusedFileId:t,updateSelection:this.updateSelection,handleDeselect:this.handleDeselect,handleDeselectAll:this.handleDeselectAll,handleFocusFile:this.handleFocusFile,handleSelect:this.handleSelect,handleSelectAll:this.handleSelectAll,isSelectableListEvent:this.isSelectableListEvent})),i.React$1.createElement("div",{className:"selectable-list",onBlur:this.handleBlur,onFocus:this.handleFocus},s)}}u.defaultProps={isActive:!0},u.displayName="SelectableList",e.SELECTABLE_LIST_KEY_SCOPE=l,e.SELECTABLE_TILE_GRID_KEY_SCOPE=o,e.SelectableList=u}));
//# sourceMappingURL=c_ui_selectable_list.js-vflbwPvQX.map
