define(["exports","./e_edison","./c_core_i18n","./e_ui_page_files_router","./c_ui-icon_line_download","./c_ui-icon_line_dropbox","./c_src_file_viewer_components","./c_action_bar_action_bar_strings","./c_file_viewer_sdk_file_viewer_file_viewer","./c_extensions_data_selectors","./c_sdk_file_viewer_action_plugins_utils","./c_file_store_utils","./c_admin_registration_source_constants","./c_core_logging_constants","./c_tslib","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/files_spa","./c_core_notify","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","./c_api_v2_redux_files","./c_resize-observer-polyfill_dist_ResizeObserver","./c_ui-icon_line_collapse-right","./c_ui-icon_line_expand-left","./c_truncate_index","./c_core_types_preview_type","./c_src_file_extension_extension_constants","./c_src_logging_performance","./c_core_utils_redesign2023","./c_ui-icon_line_sidebar-show","./c_src_simple-action-bar_action_bar_types","./c_src_toolbar","./c_ui-icon_line_more-horizontal","./c_ui-icon_line_zoom-out","./c_breadcrumb_index","./c_portable_delete_snackbars","./c_portable_delete_strings","./c_files_view_file_actions_snackbars","./c_file_actions_strings","./c_ui-icon_line_move","./c_ui-icon_line_copy","./c_ui-icon_line_cursor","./c_ui-icon_line_delete","./c_auth_login_or_register_types","./c_downloads","./c_file_viewer_utils","./c_loggers_device_type","./c_form_row_index","./c_ui_tree_view","./c_sharing_ui_notifications_util","./c_src_utils_logging","./c_share_download_ui_api","./c_account_email","./c_account_email_verify_reasons","./c_ui_modal_dig","./c_ui_input_dig","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","./c_dig-illustrations_spot_file-folders","./c_previews_util","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_history","./c_ux_analytics_dispatch_custom_event","./c_core_logging_video","./c_pap-events_previews_delete_file","./c_pap-events_enums_file_type-utils","./c_pap-events_previews_create_folder","./c_photo-editor_plugin_show-edit-plugin","./c_keymaster","./c_bug_reporting_routing","./c_clipboard_v3","./c_ui-icon_line_rocket","metaserver/static/js/modules/constants/publish","./c_file_viewer_data_store","./c_previews_data_actions","./c_src_mobile_web","./c_integrations_data_selectors","./c_capture_redux_selectors","./c_flows_flows_client","./c_docsend_src_utils","./c_src_common_filepath","./c_flows_approval_approval_io_client","./c_typeahead_index","./c_src_preview-photo-editor_types","./c_ui-icon_line_edit","./c_ui-icon_line_share-arrow","./c_src_common_format_bytes","./c_info_blade_content_metadata_image_metadata","./c_ui-icon_line_closed-captions","./c_src_simple-action-bar_inline_action_bar","./c_assets_pictogram_lightbulb","./c_src_highlighted-truncated-string_em-string","./c_size_class_constants","./c_extensions_split_share_button","./c_ui-icon_line_link","./c_share_modal_evolution_utils_logging","./c_team_discovery_data_utils","./c_growth_ui_teams_web_actions_logger_events","./c_teams_let_members_invite_non_admin_invite_modal","./c_loggers_join_flow_logger","./c_contacts_tokenizer_v2","./c_ui-icon_line_import-contacts","./c_integrations_notify","./c_spectrum_tooltip","./c_src_text","./c_spectrum_colorized_icon","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_src_instrumentation_common_context","./c_src_instrumentation_constants","./c_src_instrumentation_function_wrapper","./c_spectrum_facepile_facepile_members","./c_spectrum_avatar_avatar_initials","./c_spectrum_avatar_avatar_color_util","./c_src_components_action-bar-strings","./c_ui-icon_line_crop","./c_ui-icon_line_cut","./c_ui-icon_line_shape-rotate-right","./c_ui-icon_line_flip-vertical","./c_ui-icon_line_slider","./c_ui_hoc","./c_capture_api"],(function(e,t,i,o,s,n,_,c,a,r,l,d,u,m,p,v,g,f,w,b,h,E,S,A,D,x,I,y,R,O,P,j,k,T,N,L,C,$,U,F,M,B,W,K,H,z,V,G,q,Y,Z,Q,J,X,ee,te,ie,oe,se,ne,_e,ce,ae,re,le,de,ue,me,pe,ve,ge,fe,we,be,he,Ee,Se,Ae,De,xe,Ie,ye,Re,Oe,Pe,je,ke,Te,Ne,Le,Ce,$e,Ue,Fe,Me,Be,We,Ke,He,ze,Ve,Ge,qe,Ye,Ze,Qe,Je,Xe,et,tt,it,ot,st,nt,_t,ct,at,rt,lt,dt,ut,mt,pt,vt,gt,ft,wt,bt,ht,Et,St,At,Dt,xt,It,yt,Rt,Ot,Pt,jt,kt,Tt,Nt,Lt,Ct,$t,Ut,Ft,Mt,Bt,Wt,Kt,Ht,zt,Vt,Gt,qt,Yt){"use strict";const Zt=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.SEARCH,a.SDKPreviewSurface.STANDALONE_PREVIEW],Qt=(e,t)=>{t&&Zt.includes(t)&&o.UserSurvey.trackEvent("download_item","previews"),a.isVideoPreview(e)&&o.UserSurvey.trackEvent("video_preview_download","previews")},Jt=({downloadAction:e,saveACopyToDropboxAction:_,shareToken:r,downloadAllowed:l,user:d})=>{var u,m;const p=t.React$1.createElement(o.UIIcon,{src:s.DownloadLine}),v=i.intl.formatMessage(c.DOWNLOAD_ACTION_STRING),g=e=>{e.menuItem.handler()},f=t=>{t.preventDefault(),t.stopPropagation(),e()},w=t=>{"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),e())},b=i.intl.formatMessage({id:"3IQVpL",defaultMessage:"You do not have permission to download this file"}),h=i.intl.formatMessage({id:"A9yx17",defaultMessage:"You do not have permission to save a copy of this file"}),E=a.makePluginActionDefinition({icon:p,label:v,action:e,id:a.DOWNLOAD_ACTION_PLUGIN_ID,disabled:l?{disabled:!1}:{disabled:!0,tooltipMessage:b}});let S=null;r&&(S=a.makePluginActionDefinition({icon:t.React$1.createElement(o.UIIcon,{src:n.DropboxLine}),label:i.intl.formatMessage({id:"WiS7tZ",defaultMessage:"Save a copy to Dropbox"}),action:()=>{_()},id:"SHARECOPY_ACTION",disabled:l?{disabled:!1}:{disabled:!0,tooltipMessage:h},overflowItemTooltipDataAttribute:"action-bar-download-split-button-menu-save-a-copy-overflow-item"}));const A=(e,i)=>e?t.React$1.createElement(o.Tooltip,{title:i},t.React$1.createElement("div",null,e)):null;if(!d)return[{id:E.id,renderButton:e=>{var i;const o=null===(i=E.renderButton)||void 0===i?void 0:i.call(E,e);return t.React$1.createElement(t.React$1.Fragment,null,l?o:A(o,b))},overflowItem:l?E.overflowItem:null!==(u=A(E.overflowItem,b))&&void 0!==u?u:void 0},...S?[{id:S.id,renderButton:e=>{var i;const o=null===(i=null==S?void 0:S.renderButton)||void 0===i?void 0:i.call(S,e);return t.React$1.createElement(t.React$1.Fragment,null,l?o:A(o,h))},overflowItem:l?S.overflowItem:null!==(m=A(S.overflowItem,h))&&void 0!==m?m:void 0}]:[]];const D=t.React$1.createElement(t.React$1.Fragment,null,E.overflowItem,null==S?void 0:S.overflowItem),x=({buttonProps:e})=>t.React$1.createElement(o.Menu.Wrapper,{onSelection:g},(({getTriggerProps:i,getContentProps:s})=>t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(o.Button,Object.assign({"aria-label":"Show options"},e,i(),{disabled:!l,"data-tooltip":"action-bar-download-split-button-menu","data-testid":"action-bar-download-split-button-menu"})),t.React$1.createElement(o.Menu.Content,Object.assign({},s(),{placement:"bottom-end"}),t.React$1.createElement(o.Menu.Segment,null,D))))),I=t.React$1.createElement(o.Menu.Submenu,{disabled:!l,withTriggerContent:v,withLeftAccessory:p},t.React$1.createElement(o.Menu.Segment,null,D));return[{renderButton:e=>{const i=t.React$1.createElement(o.SplitButton,{onClick:f,onKeyPress:w,variant:"opacity",renderMenu:x,disabled:!l},!e&&p,v);return l?i:A(i,b)},overflowItem:l?I:A(I,b)}]};e.makeDownloadActionLoader=(e,n,p,v,g,f,w,b,h,E)=>{const S=(e,t)=>{const i=[a.SDKPreviewSurface.BROWSE,a.SDKPreviewSurface.SHARED_LINK,a.SDKPreviewSurface.STANDALONE_PREVIEW];return v&&-1===d.getFilename(e).indexOf("~")&&a.showEditPlugin(e,t)&&p&&i.includes(p)},A=a.makePluginActionDefinition({label:i.intl.formatMessage(c.DOWNLOAD_ACTION_STRING),icon:t.React$1.createElement(o.UIIcon,{src:s.DownloadLine}),id:a.DOWNLOAD_ACTION_PLUGIN_ID,action:()=>{const{file:t,sharePermission:i}=e();Qt(t,p),S(t,i)&&o.publishEvent(o.CampaignEvents.DOWNLOAD_BUTTON_CLICKED,{context:{file_name:d.getFilename(t),file_extension:d.getExtension(t)}});const s={onAttempt:()=>n.logUserAction(m.UserAction.DownloadStart),onSuccess:()=>{n.logUserAction(m.UserAction.DownloadSuccess,"title_bar_open_split_button"),_.setHubEntryPoint(_.HubEntryPointType.Download)},onError:()=>n.logUserAction(m.UserAction.DownloadFailed)},{rootNSID:c,blockHash:a}=o.getBrowseState(o.getStoreForBrowse().getState()).context;v&&c&&o.isUnmountedBackupBrowse(v,c)?a&&d.isBrowseFile(t)&&r.downloadSingleFileAsZip({fqPath:t.fq_path,rootNsId:c,source:"PREVIEWS",blockHash:a,user:v},s):r.downloadSingleFile({href:t.href,source:"PREVIEWS",isFswm:d.isSharedFile(t)},s)}}),[D,x]=Jt({downloadAllowed:!!f&&a.isDownloadAllowed(f),downloadAction:()=>{n.logUserAction("download","title_bar_download_split_button");const{file:t,sharePermission:i}=e();Qt(t,p),S(t,i)&&o.publishEvent(o.CampaignEvents.DOWNLOAD_BUTTON_CLICKED,{context:{file_name:d.getFilename(t),file_extension:d.getExtension(t)}}),a.downloadActiveFile(t,v,w,b,n.logUserAction,g,h)},saveACopyToDropboxAction:()=>{const{file:t}=e();a.saveToDropbox(t,(e=>n.logUserAction(e,"title_bar_download_split_button")),v,g,w,u.RegistrationSource.SHMODEL_SAVE_TO_REGISTER,E)},getActiveFile:e,user:v,shareToken:g,encryptionOptions:w});return{actionDefinitions:()=>{const{file:t}=e();if(!l.isLiveFile(t)||l.isPnmLinkNodeSelected(t)||l.isCloudDoc(t))return{};let i;return i=d.isSharedFile(t)?v||!x?[D]:[D,x]:[A],{atTopLevelIfSpace:i,alwaysInOverflow:[i]}}}}}));
//# sourceMappingURL=c_action_plugins_download_action_legacy_plugin.js-vfl3g-rwj.map
