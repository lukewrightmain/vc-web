define(["exports","./e_ui_page_files_router","./e_edison","./c_icon_file_folder_icon","./c_icon_file_icon","./c_core_uri"],(function(e,t,i,s,n,r){"use strict";const l=i.React$1.createContext({});class a{constructor(e,i){this.isTTI=!1,this.postTTISuccesses=[],this.postTTIErrors=[],this.postTTIRequests=[],this.wrapHandlers=e=>({onSuccess:t=>{this.isTTI?e.onSuccess(t):this.bufferCallbacks(this.postTTISuccesses,e,t)},onRequest:t=>{e.onRequest&&(this.isTTI?e.onRequest(t):this.bufferCallbacks(this.postTTIRequests,e,t))},onError:()=>{e.onError&&(this.isTTI?e.onError():this.bufferErrorCallback(e))}}),this.innerStore=new t.GenericThumbStore(e,i),t.waitForTTI().then((()=>{this.isTTI=!0,this.postTTIRequests.forEach((e=>{const{onRequest:t}=e[0];t&&t(e[1])})),this.postTTIErrors.forEach((e=>e.onError&&e.onError())),this.postTTISuccesses.forEach((e=>e[0].onSuccess(e[1]))),this.postTTIRequests=[],this.postTTIErrors=[],this.postTTISuccesses=[]}))}get_thumb(e){return this.isTTI?this.innerStore.get_thumb(e):null}is_batching(){return this.innerStore.is_batching()}bind_url(e,t){const i=this.isTTI?t:this.wrapHandlers(t);return this.innerStore.bind_url(e,i)}bufferCallbacks(e,t,i){r.assert(!this.isTTI,"Should not buffer callback after TTI"),e.push([t,i])}bufferErrorCallback(e){r.assert(!this.isTTI,"Should not buffer error callback after TTI"),this.postTTIErrors.push(e)}unbind_url(e){this.innerStore.unbind_url(e)}}const o=({shouldPrewarm:e,path:n,children:r,items:l})=>{const o=(()=>{const[e,s]=i.React$1.useState(!!t.time_to_interactive);return i.React$1.useEffect((()=>{const e=t.makeCancelable(t.waitForTTI().then((()=>{s(!0)})));return()=>e.cancel()}),[]),e})(),h=i.React$1.useMemo((()=>o?new t.GenericThumbStore:new a),[n]);return i.React$1.useEffect((()=>{if(!e)return;const i=[];return null==l||l.slice(0,100).forEach((e=>{if(e instanceof t.File||e instanceof t.FileSharedWithMe){const n=s.getThumbnailUrlForItem(e.thumbnail_url_tmpl,t.ViewTypeThumbnailSizes[t.ViewType.Grid]);if(n){const e=h.bind_url(n,{onSuccess:()=>{}});e&&i.push(e)}}})),()=>i.forEach((e=>h.unbind_url(e)))}),[n,l,h,e]),i.React$1.createElement(u.Provider,{value:h},r)};o.displayName="ThumbStoreProvider";const u=i.React$1.createContext(new t.GenericThumbStore),h=e=>t=>i.React$1.createElement(u.Consumer,null,(s=>i.React$1.createElement(e,Object.assign({},t,{thumbStore:s})))),c=e=>t.IMAGE_THUMBNAIL_EXTENSIONS.includes(e);class b extends i.React$1.PureComponent{constructor(e){super(e),this._thumbRequestId=null,this.getThumbnailSize=()=>{var e,i;return null!==(i=null!==(e=this.props.thumbnailSize)&&void 0!==e?e:this.props.iconSize)&&void 0!==i?i:t.ViewTypeThumbnailSizes[t.ViewType.List]},this.getThumbnailSrcSet=()=>{const e=this.getThumbnailSize();return`${s.getThumbnailUrlForItem(this.props.file.thumbnail_url_tmpl,e)} 1x, ${s.getThumbnailUrlForItem(this.props.file.thumbnail_url_tmpl,2*e)} 2x`},this.isExtensionThumbnailable=e=>this.props.isExtensionThumbnailableFnOverride?this.props.isExtensionThumbnailableFnOverride(e):c(e),this.handleThumbnailError=()=>{this.setState({thumbnailSrc:null})};const{thumbStore:i,file:{thumbnail_url_tmpl:n}}=e;this.state={thumbnailSrc:n?i.get_thumb(n):null}}componentDidMount(){this.fetchThumbnail(this.props)}UNSAFE_componentWillReceiveProps(e){e.file.thumbnail_url_tmpl!==this.props.file.thumbnail_url_tmpl&&(this.unbindThumbnailIfNeeded(),this.fetchThumbnail(e))}componentWillUnmount(){this.unbindThumbnailIfNeeded()}fetchThumbnail({file:e,thumbStore:i}){const n=e.fq_path||e.filename||"",r=t.getExtension(n);if(!r||!this.isExtensionThumbnailable(r))return;const l=s.getThumbnailUrlForItem(e.thumbnail_url_tmpl,this.getThumbnailSize());l&&(this._thumbRequestId=i.bind_url(l,{onSuccess:()=>{this.setState({thumbnailSrc:i.get_thumb(l)})},onError:()=>{this.handleThumbnailError()}}))}unbindThumbnailIfNeeded(){const{thumbStore:e}=this.props;this._thumbRequestId&&(e.unbind_url(this._thumbRequestId),this._thumbRequestId=null),this.setState({thumbnailSrc:null})}render(){const{file:e,showCDMUserEducationEffects:s,iconSize:r,isRetinaThumbnailEnabled:l}=this.props,{thumbnailSrc:a}=this.state,o=e.fq_path||e.filename,u=l?this.getThumbnailSrcSet():void 0;return a?i.React$1.createElement(n.LockBadge,{file:this.props.file,variant:"preview-small"},i.React$1.createElement("img",{alt:o,draggable:!1,className:t.classnames("brws-file-name-cell-icon","brws-file-name-cell-thumb"),src:a,srcSet:u,onError:this.handleThumbnailError,"data-testid":"generated-file-thumbnail"})):i.React$1.createElement(T,{file:e,showCDMUserEducationEffects:s,iconSize:r})}}b.displayName="FileThumbnailComponent";const m=h((e=>{const t=i.React$1.useContext(l),s=Object.assign(Object.assign({},e),{isExtensionThumbnailableFnOverride:e.isExtensionThumbnailableFnOverride?e.isExtensionThumbnailableFnOverride:t.isExtensionThumbnailableFn,isRetinaThumbnailEnabled:t.isRetinaThumbnailEnabled});return i.React$1.createElement(b,Object.assign({},s))})),T=({file:e,showCDMUserEducationEffects:n,iconSize:r})=>{const l=r?{height:r.toString(),width:r.toString()}:{},a=r&&r>=t.LISTVIEW_LARGE_ICON_SIZE_PX?"large":void 0,o=i.React$1.createElement(s.FileOrFolderIcon,Object.assign({className:"brws-file-name-cell-icon",file:e,showPreview:!1,"data-testid":"fallback-file-thumbnail",variant:a},l));return n?i.React$1.createElement(t.UserEducationEffect,{containerName:"FileItemRow",name:"TMFIcon",useSpan:!0},o):o};T.displayName="FileThumbnailFallback",e.FileThumbnail=m,e.FilesViewOverrideContext=l,e.ThumbStoreProvider=o,e.isExtensionThumbnailableByDefault=c,e.withThumbStore=h}));
//# sourceMappingURL=c_files_view_file_thumbnail.js-vfl0uEoz_.map
