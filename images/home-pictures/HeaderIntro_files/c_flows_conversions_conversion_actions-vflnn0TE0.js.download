define(["require","exports","./c_tslib","./c_flows_conversions_convert","./c_core_i18n","./c_flows_utils_browse_logger","./c_flows_lib_api","./c_flows_logging_flows_loggers","./c_flows_redux_store","./c_flows_redux_actions","./e_edison","./c_ui-icon_line_file","./c_flows_constants","./c_ui-icon_line_image","./c_ui-icon_line_audio","./c_ui-icon_line_video","./e_ui_page_files_router","./c_spectrum_icon_partners_index","./c_gdd_migration_ui_utils","./c_api_v2_noauth_client","./c_controls_index","./c_icon_shortcuts_icon"],(function(e,o,t,i,s,n,a,r,l,c,u,d,_,g,f,m,p,S,E,v,F,O){"use strict";const h="browse_save_as";function M({files:e,template:o,conversionType:u,source:d}){return t.__awaiter(this,void 0,void 0,(function*(){const{initLabel:t,failLabel:_}={initLabel:e=>s.intl.formatMessage({id:"YdruIN",defaultMessage:"Your {numFiles, plural, one {file} other {files}} will be saved shortly..."},{numFiles:e}),failLabel:e=>s.intl.formatMessage({id:"j4UjMR",defaultMessage:"There was a problem saving your {numFiles, plural, one {file} other {files}}"},{numFiles:e})};n.updateSnackbar({variant:"sync",title:t(e.length)});const g=i.getConversionLoggingFunctions(u);l.getStoreForAutomations().dispatch(c.setShouldSubscribeToBolt(!0));try{yield a.submitFileWorkflow(o,e.map((e=>e.file_id))),r.PapLogger.logSucceedSubmitManualWorkflow(h,o,e.length),g.logConvert(d,e.length)}catch(t){n.updateSnackbar({variant:"fail",title:_(e.length)}),r.PapLogger.logFailSubmitManualWorkflow(h,o,e.length,t)}}))}const T="pdf",I={actionText:"PDF",actionIcon:d.FileLine,selector:i.singleFileWithExtensionSelector(_.SUPPORTED_PDF_EXTENSIONS),convert:(e,o,s)=>{const{source:n}=s;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},s),{file:e[0],user:o,conversionType:T,folderRuleAction:"pdf_conversion",loggingFunctions:i.getConversionLoggingFunctions(T),getStrings:(e,t)=>i.getDefaultConversionStrings("PDF",e,o,t),conversionFn:(e,o,s)=>t.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.convertToPdf(o.id,i.getFileIdentifier(e,s))).path})),getAdoptionSnackbarProps:t=>i.getAdoptionSnackbarProps({user:o,conversionType:T,folderRuleAction:"pdf_conversion",fileType:"PDF",resultPath:t,source:n,nsId:e[0].ns_id}),template:{sequence:[{workflow_action:{".tag":"pdf_conversion"}}]},outputExt:"PDF"}))}},C={actionText:"PDF",actionIcon:d.FileLine,selector:i.strictMultiFileWithExtensionSelector(_.SUPPORTED_PDF_EXTENSIONS),convert:(e,o,{source:t})=>M({files:e,template:{sequence:[{workflow_action:{".tag":"pdf_conversion"}}]},conversionType:T,source:t})},L={jpg:_.SUPPORTED_IMAGE_INPUT_EXTENSIONS.filter((e=>"jpg"!==e&&"jpeg"!==e)),png:_.SUPPORTED_IMAGE_INPUT_EXTENSIONS.filter((e=>"png"!==e))},D="image-format",R=Object.entries(L).map((([e,o])=>({actionText:e.toUpperCase(),actionIcon:g.ImageLine,selector:i.singleFileWithExtensionSelector(o),convert:(o,s,n)=>{const{source:a}=n;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},n),{file:o[0],user:s,conversionType:D,folderRuleAction:"image_conversion",loggingFunctions:i.getConversionLoggingFunctions(D),getStrings:(o,t)=>i.getDefaultConversionStrings(e.toUpperCase(),o,s,t),conversionFn:(o,s,n)=>t.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.convertImageFormat(s.id,i.getFileIdentifier(o,n),e)).path})),getAdoptionSnackbarProps:t=>i.getAdoptionSnackbarProps({user:s,conversionType:D,folderRuleAction:"image_conversion",fileType:e,resultPath:t,source:a,nsId:o[0].ns_id}),outputExt:e}))}}))),b="doc-to-image",A=_.SUPPORTED_IMAGE_OUTPUT_EXTENSIONS.map((e=>({actionText:e.toUpperCase(),actionIcon:g.ImageLine,selector:i.singleFileWithExtensionSelector(_.SUPPORTED_DOC_INPUT_EXTENSIONS),convert:(o,s,n)=>{const{source:a}=n;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},n),{file:o[0],user:s,conversionType:b,folderRuleAction:"image_conversion",loggingFunctions:i.getConversionLoggingFunctions(b),getStrings:(o,t)=>i.getDefaultConversionStrings(e.toUpperCase(),o,s,t),conversionFn:(o,s,n)=>t.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.convertDocToImage(s.id,i.getFileIdentifier(o,n),e)).path})),getAdoptionSnackbarProps:t=>i.getAdoptionSnackbarProps({user:s,conversionType:b,folderRuleAction:"image_conversion",fileType:e,resultPath:t,source:a,nsId:o[0].ns_id}),outputExt:e}))}}))),y="media-remux",P=(e,o,n)=>(a,r,l)=>{const{source:c}=l;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},l),{file:a[0],user:r,conversionType:y,folderRuleAction:o,loggingFunctions:i.getConversionLoggingFunctions(y),getStrings:(o,t)=>function(e,o,t,n){const a=i.getDefaultConversionStrings(e,o,t,n);return Object.assign(Object.assign({},a),{failTooLarge:s.intl.formatMessage({id:"D67i/e",defaultMessage:"Couldn't save as {fileType} because the file is too large. The maximum file size is {maxSize} MB."},{fileType:e,maxSize:_.MEDIA_REMUX_FILE_SIZE_LIMIT})})}(e.toUpperCase(),o,r,t),conversionFn:(o,s,n)=>t.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.mediaRemux(s.id,i.getFileIdentifier(o,n),e)).path})),getAdoptionSnackbarProps:o?t=>i.getAdoptionSnackbarProps({user:r,conversionType:y,folderRuleAction:o,fileType:e,resultPath:t,source:c,nsId:a[0].ns_id}):void 0,template:n,outputExt:e}))},k=[..._.SUPPORTED_VIDEO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:m.VideoLine,selector:i.singleFileWithExtensionSelector(_.SUPPORTED_VIDEO_INPUT_EXTENSIONS.filter((o=>o!==e))),convert:P(e,"video_conversion",{sequence:[{workflow_action:{".tag":"video_conversion",format:e}}]})}))),..._.SUPPORTED_AUDIO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:f.AudioLine,selector:i.singleFileWithExtensionSelector([..._.SUPPORTED_AUDIO_INPUT_EXTENSIONS,..._.SUPPORTED_VIDEO_INPUT_EXTENSIONS].filter((o=>o!==e))),convert:P(e,"audio_conversion",{sequence:[{workflow_action:{".tag":"audio_conversion",format:e}}]})})))],N=[..._.SUPPORTED_VIDEO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:m.VideoLine,selector:i.strictMultiFileWithExtensionSelector(_.SUPPORTED_VIDEO_INPUT_EXTENSIONS.filter((o=>o!==e))),convert:(o,t,{source:i})=>M({files:o,template:{sequence:[{workflow_action:{".tag":"video_conversion",format:e}}]},conversionType:y,source:i})}))),..._.SUPPORTED_AUDIO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:f.AudioLine,selector:i.strictMultiFileWithExtensionSelector([..._.SUPPORTED_AUDIO_INPUT_EXTENSIONS,..._.SUPPORTED_VIDEO_INPUT_EXTENSIONS].filter((o=>o!==e))),convert:(o,t,{source:i})=>M({files:o,template:{sequence:[{workflow_action:{".tag":"audio_conversion",format:e}}]},conversionType:y,source:i})})))];const U=["mov","mp4","avi","mkv","mpeg"],w={actionText:"GIF",actionIcon:m.VideoLine,selector:(e,o)=>{const t=i.singleFileWithExtensionSelector(U),s=!!o&&o.expFlowsManualVideoGifUi;return t(e)&&s},convert:function(o,t,{shareToken:i}){return function(o,t,i){new Promise((function(o,t){e(["./c_components_modals_video_to_gif_settings_modal"],o,t)})).then((({StatefulVideoToGifSettingsModal:e})=>{p.Modal$1.showInstance(u.React$1.createElement(p.Provider,{store:p.getStoreForBrowse()},u.React$1.createElement(s.Provider,{value:s.intl},u.React$1.createElement(e,{file:o,user:t,shareToken:i}))))}))}(o[0],t,i),Promise.resolve()}},G=_.SUPPORTED_DOC_INPUT_EXTENSIONS.concat(_.SUPPORTED_IMAGE_INPUT_EXTENSIONS),x={jpg:G.filter((e=>"jpg"!==e&&"jpeg"!==e)),png:G.filter((e=>"png"!==e))},W=Object.entries(x).map((([e,o])=>({actionText:e.toUpperCase(),actionIcon:g.ImageLine,selector:i.strictMultiFileWithExtensionSelector(o),convert:(o,t,{source:i})=>M({files:o,conversionType:"image-batch",template:{sequence:[{workflow_action:{".tag":"image_conversion",format:e}}]},source:i})})));var j,$;o.ConversionActionGroup=void 0,(j=o.ConversionActionGroup||(o.ConversionActionGroup={}))[j.DEFAULT=0]="DEFAULT",j[j.CLOUD_DOCS=1]="CLOUD_DOCS",function(e){e.GOOGLE_DRIVE="web_shortcut",e.MICROSOFT_FILE="ms_file"}($||($={}));const B=(e,o,t,i,s)=>{p.logEvent({class:"cloud_docs",action:"select",object:"cloud_docs_manual_conversion_modal",properties:{accountRole:e,numFiles:o,cloudDocsManualConversionType:t,cloudDocsManualConversionModalButton:i,dontAskAgainChecked:s}})},V=(e,o)=>{p.logEvent({class:"cloud_docs",action:"open",object:"cloud_docs_manual_conversion_folder_picker",properties:{accountRole:e,eventState:o}})},H=(e,o,t,i,s,n,a,r)=>{p.logEvent({class:"cloud_docs",action:"initiate",object:"cloud_docs_manual_conversion",properties:{accountRole:e,numFiles:o,cloudDocsManualConversionType:t,modalWasShown:i,copyFilePermissions:s,useDefaultFolder:n,cloudDocsManualConversionError:a,eventState:r}})},X=(e,o)=>{switch(o){case $.GOOGLE_DRIVE:return(e=>{const o=new Set;for(const t of e){const e=p.getGoogleFileTypeByPath(t);if(e){o.add(e);continue}const i=p.getMicrosoftFileTypeByPath(t);i&&o.add(p.MicrosoftToGoogleFileTypes[i])}if(1===o.size)for(const e of o)return p.GoogleFileLabels[e];return s.intl.formatMessage({id:"ZYjkCp",defaultMessage:"Google"})})(e);case $.MICROSOFT_FILE:return(e=>{const o=new Set;for(const t of e){const e=p.getMicrosoftFileTypeByPath(t);if(e){o.add(e);continue}const i=p.getGoogleFileTypeByPath(t);i&&o.add(p.GoogleToMicrosoftFileTypes[i])}if(1===o.size)for(const e of o)return p.MicrosoftFileLabels[e];return s.intl.formatMessage({id:"WbLFdE",defaultMessage:"Microsoft"})})(e)}},K=({srcFileNames:e,targetDest:o,folderName:t=E.Strings.MIGRATION_FOLDER,onChangeDriveFolder:i,onLearnMore:n})=>{const a=X(e,o);switch(o){case $.GOOGLE_DRIVE:return s.intl.formatMessage({id:"pU1fIE",defaultMessage:"{numFiles, plural, one{The new {fileTypeLabel} shortcut (to be saved in <folderPickerButton>{folderName}</folderPickerButton>) will inherit the same sharing permissions as the original file. Save as will replace the original file.} other{The new {fileTypeLabel} shortcuts (to be saved in <folderPickerButton>{folderName}</folderPickerButton>) will inherit the same sharing permissions as the original files. Save as will replace the original files.}} <button>Learn more</button>"},{fileTypeLabel:a,numFiles:e.length,folderName:t,bold:e=>u.React$1.createElement(p.Text,{isBold:!0},e),button:e=>u.React$1.createElement(p.Button,{variant:"transparent",onClick:n},e),folderPickerButton:e=>u.React$1.createElement(p.Button,{onClick:i,variant:"transparent",withIconLeft:u.React$1.createElement(p.UIIcon,{src:p.FolderLine,role:"presentation"})},e)});case $.MICROSOFT_FILE:return s.intl.formatMessage({id:"gctOhH",defaultMessage:"{numFiles, plural, one{The new {fileTypeLabel} file will inherit the same sharing permissions as the original file. Save as will replace the original file.} other{The new {fileTypeLabel} files will inherit the same sharing permissions as the original files. Save as will replace the original files.}} <button>Learn more</button>"},{fileTypeLabel:a,numFiles:e.length,bold:e=>u.React$1.createElement(p.Text,{isBold:!0},e),button:e=>u.React$1.createElement(p.Button,{variant:"transparent",onClick:()=>{}},e)})}};var q;!function(e){e.LINK_TO_INCOMPATIBLE_GOOGLE_ACCOUNT=s.intl.formatMessage({id:"u9TFTP",defaultMessage:"Please link to the Google account of the same email as your Dropbox account."}),e.FAIL_TO_LINK_GOOGLE_ACCOUNT=s.intl.formatMessage({id:"4L5zkJ",defaultMessage:"Failed to link Google account."}),e.pendingSaveShortcuts=function(e){return s.intl.formatMessage({id:"EXRMbA",defaultMessage:"Saving as {numFiles, plural, one{shortcut} other{shortcuts}} in Google Drive..."},{numFiles:e})},e.pendingSaveMsFiles=function(e){return s.intl.formatMessage({id:"xNu9kx",defaultMessage:"Saving as Microsoft {numFiles, plural, one{file} other{files}}..."},{numFiles:e})},e.successMessageMultipleShortcuts=function(e){return s.intl.formatMessage({id:"EcF4mj",defaultMessage:"{numFiles} files saved as Google file shortcuts."},{numFiles:e})},e.successMessageMultipleMsFiles=function(e){return s.intl.formatMessage({id:"ZXYeoK",defaultMessage:"{numFiles} files saved as Microsoft files."},{numFiles:e})},e.successMessageOneShortcut=function(e){return s.intl.formatMessage({id:"osYTsQ",defaultMessage:"{filename} saved to Google Drive."},{filename:e})},e.successMessageOneMsFile=function(e){return s.intl.formatMessage({id:"0kS6qL",defaultMessage:"{filename} saved."},{filename:e})},e.SERVER_ERROR=s.intl.formatMessage({id:"+rrsxb",defaultMessage:"Server error"}),e.srcFilesNotFound=function(e){return s.intl.formatMessage({id:"eRab3W",defaultMessage:"Source {numFiles, plural, one{file} other{files}} not found"},{numFiles:e})},e.srcFilesWrongType=function(e){return s.intl.formatMessage({id:"V0eQ4f",defaultMessage:"Source {numFiles, plural, one{file} other{files}} of the wrong type"},{numFiles:e})},e.GOOGLE_ACCOUNT_NOT_LINKED=s.intl.formatMessage({id:"Qs6YhO",defaultMessage:"Google account not linked"}),e.FOLDER_CREATION_FAILED=s.intl.formatMessage({id:"gBED0D",defaultMessage:"Folder creation failed"}),e.FIND_UNUSED_FILENAME_FAILED=s.intl.formatMessage({id:"UgrtDM",defaultMessage:"Find unused filename failed"}),e.UPLOAD_FAILED=s.intl.formatMessage({id:"MQocdR",defaultMessage:"Upload failed"}),e.GRANT_PERMISSIONS_FAILED=s.intl.formatMessage({id:"OltuRn",defaultMessage:"Grant permissions failed"}),e.CREATE_FILE_FAILED=s.intl.formatMessage({id:"8eZdXo",defaultMessage:"Create file failed"}),e.DELETE_FILE_FAILED=s.intl.formatMessage({id:"QoVCWl",defaultMessage:"Delete file failed"}),e.FIND_FOLDER_FAILED=s.intl.formatMessage({id:"6phdrE",defaultMessage:"Find folder failed"}),e.INVALID_DEST_FOLDER_MIME_TYPE=s.intl.formatMessage({id:"+DHCWS",defaultMessage:"Destination folder invalid"}),e.GOOGLE_SERVER_ERROR=s.intl.formatMessage({id:"gTHqcG",defaultMessage:"Google server error"}),e.NO_WRITE_PERMISSION=s.intl.formatMessage({id:"EYJIs6",defaultMessage:"User has no write access"}),e.singleFileFailSaveShortcut=function({filename:e,rootCause:o}){return e?s.intl.formatMessage({id:"LsI80W",defaultMessage:"{filename} couldn’t be saved to Google Drive ({rootCause})."},{filename:e,rootCause:o}):s.intl.formatMessage({id:"IYz0cM",defaultMessage:"File couldn’t be saved to Google Drive ({rootCause})."},{rootCause:o})},e.singleFileFailSaveMsFile=function({filename:e,rootCause:o}){return e?s.intl.formatMessage({id:"fvHSWo",defaultMessage:"{filename} couldn’t be saved ({rootCause})."},{filename:e,rootCause:o}):s.intl.formatMessage({id:"nARyLu",defaultMessage:"File couldn’t be saved ({rootCause})."},{rootCause:o})},e.multipleFilesPartialFailureShortcuts=function(e){return s.intl.formatMessage({id:"4UgBQ9",defaultMessage:"Some files couldn’t be saved as shortcuts ({rootCause})."},{rootCause:e})},e.multipleFilesFullFailureShortcuts=function(e){return s.intl.formatMessage({id:"Q9gfPh",defaultMessage:"Files couldn’t be saved as shortcuts ({rootCause})."},{rootCause:e})},e.multipleFilesFullFailureMsFile=function(e){return s.intl.formatMessage({id:"O1bxfj",defaultMessage:"Files couldn’t be saved as Microsoft files ({rootCause})."},{rootCause:e})},e.FAILED_TO_GET_GOOGLE_SHORTCUT_SETTINGS=s.intl.formatMessage({id:"AoDCl3",defaultMessage:"Failed to get Google shortcut settings. Please try again."})}(q||(q={}));const z=e=>"ns_path"in e?p.filename(e.ns_path):void 0,Y=e=>t.__awaiter(void 0,void 0,void 0,(function*(){try{const o=new p.UserApiV2Client;return yield o.ns("cloud_docs").rpc("google_shortcut_settings/get",void 0,{subjectUserId:e.id})}catch(e){return p.Snackbar.failSticky(q.FAILED_TO_GET_GOOGLE_SHORTCUT_SETTINGS),null}})),Q=({user:e,dontAskMeAgain:o,copyFilePermissions:i})=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=(({dontAskMeAgain:e,copyFilePermissions:o})=>e?o?{".tag":"always"}:{".tag":"never"}:{".tag":"ask_each_time"})({dontAskMeAgain:o,copyFilePermissions:i}),s=new p.UserApiV2Client;try{yield s.ns("cloud_docs").rpc("google_shortcut_settings/set",{copy_permissions_to_google_shortcut:t},{subjectUserId:e.id})}catch(e){}})),J=({user:e,srcFileNames:o,targetDest:i,onUpdateCopyPermissionsSetting:n,onSubmit:a})=>{const[r,l]=u.react.exports.useState(!1),[{folderName:c,folderId:d},_]=u.react.exports.useState({folderName:E.Strings.MIGRATION_FOLDER});u.react.exports.useEffect((()=>{var t,s,n;t=e.role,s=o.length,n=i,p.logEvent({class:"cloud_docs",action:"shown",object:"cloud_docs_manual_conversion_modal",properties:{accountRole:t,numFiles:s,cloudDocsManualConversionType:n}})}),[e.role,o.length,i]);const g=()=>t.__awaiter(void 0,void 0,void 0,(function*(){V(e.role,"start");try{if((yield E.ensureUserHasGddMigrationCompatibleLink(e))!==E.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK)return void V(e.role,"canceled")}catch(e){const o=E.parseLinkAccountError(e);return void(o&&p.Snackbar.failSticky(o))}try{const o=yield E.chooseGdriveFolder(e.id);o?(V(e.role,"success"),_(o)):V(e.role,"canceled")}catch(o){V(e.role,"failed")}})),f=()=>{p.open_tab(E.HELP_CENTER_ARTICLE_URL)},m=u.react.exports.useMemo((()=>(({srcFileNames:e,targetDest:o,dontAskMeAgain:t,folderName:i,onChangeDriveFolder:n,onSetDontAskMeAgain:a,onConvertAndCopy:r,onConvertButDontCopy:l,onLearnMore:c})=>({title:s.intl.formatMessage({id:"taJUkh",defaultMessage:"Save with sharing permissions?"}),bodyText:u.React$1.createElement(u.React$1.Fragment,null,K({srcFileNames:e,targetDest:o,folderName:i,onChangeDriveFolder:n,onLearnMore:c})),actions:u.React$1.createElement(u.React$1.Fragment,null,u.React$1.createElement(F.Checkbox,{id:"toggleDontAskMeAgain",checked:t,onChange:e=>a(e.currentTarget.checked),"aria-label":s.intl.formatMessage({id:"PJIYJF",defaultMessage:"Toggle don’t ask me again"})}),u.React$1.createElement(p.Label,{htmlFor:"toggleDontAskMeAgain"},u.React$1.createElement(p.Text,null,s.intl.formatMessage({id:"rI2pNz",defaultMessage:"Don’t ask me again"})))),tertiaryActions:u.React$1.createElement(u.React$1.Fragment,null,u.React$1.createElement(p.Button,{variant:"opacity",onClick:l},s.intl.formatMessage({id:"QzQNL5",defaultMessage:"Save without permissions"})),u.React$1.createElement(p.Button,{variant:"primary",onClick:r},E.Strings.SAVE)),width:"standard",withCloseButton:E.Strings.CLOSE}))({srcFileNames:o,targetDest:i,dontAskMeAgain:r,folderName:c,onChangeDriveFolder:g,onSetDontAskMeAgain:e=>l(e),onConvertAndCopy:()=>{p.Modal$1.close(),n({dontAskMeAgain:r,copyFilePermissions:!0}),B(e.role,o.length,i,"save_with_permissions",r),a({modalWasShown:!0,copyFilePermissions:!0,folderId:d})},onConvertButDontCopy:()=>{p.Modal$1.close(),n({dontAskMeAgain:r,copyFilePermissions:!1}),B(e.role,o.length,i,"save_without_permissions",r),a({modalWasShown:!0,copyFilePermissions:!1,folderId:d})},onLearnMore:f})),[o,i,n,a,r,d,c,l]);return u.React$1.createElement(E.ModalTemplate,Object.assign({open:!0},m,{onRequestClose:()=>{var t,s,n;p.Modal$1.close(),t=e.role,s=o.length,n=i,p.logEvent({class:"cloud_docs",action:"dismiss",object:"cloud_docs_manual_conversion_modal",properties:{accountRole:t,numFiles:s,cloudDocsManualConversionType:n}})}}))};J.displayName="ManualConversionComponent";const Z=({user:e,srcFileNames:o,targetDest:t,copyPermissionsSetting:i,onUpdateCopyPermissionsSetting:s,onSubmit:n})=>{switch(i[".tag"]){case"always":return void n({modalWasShown:!1,copyFilePermissions:!0});case"never":return void n({modalWasShown:!1,copyFilePermissions:!1})}p.Modal$1.showInstance(u.React$1.createElement(J,{user:e,srcFileNames:o,targetDest:t,onUpdateCopyPermissionsSetting:s,onSubmit:n}))},ee=({files:e,user:o,modalWasShown:i,copyFilePermissions:s,folderId:n})=>t.__awaiter(void 0,void 0,void 0,(function*(){const t="web_shortcut",a=!n,r="none";H(o.role,e.length,t,i,s,a,r,"start");try{const e=yield E.ensureUserHasGddMigrationCompatibleLink(o);switch(e){case E.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK:break;case E.GddMigrationCompatibleLinkStatus.HAS_INCOMPATIBLE_LINK:return void p.Snackbar.failSticky(q.LINK_TO_INCOMPATIBLE_GOOGLE_ACCOUNT);case E.GddMigrationCompatibleLinkStatus.NOT_LINKED:return void p.Snackbar.failSticky(q.FAIL_TO_LINK_GOOGLE_ACCOUNT);default:p.Snackbar.failSticky(q.FAIL_TO_LINK_GOOGLE_ACCOUNT),p.enforceExhaustive(e)}}catch(e){const o=E.parseLinkAccountError(e);return void(o&&p.Snackbar.failSticky(o))}p.Snackbar.sync(q.pendingSaveShortcuts(e.length));const l=[];for(let o=0;o<e.length;o+=4){const t=e.slice(o,o+4);l.push({dest_service:{".tag":"gdrive"},src_files:t.map((e=>e.file_id)),keep_original_file:!1,preserve_existing_shortcut:!0,copy_permissions:s,dest_folder_id:n})}try{const n=new p.UserApiV2Client,c=yield Promise.all(l.map((e=>n.ns("cloud_docs").rpc("convert_to_web_shortcut",e,{subjectUserId:o.id}))));H(o.role,e.length,t,i,s,a,r,"success"),((e,o)=>{e.length>1?p.Snackbar.completeSticky(q.successMessageMultipleShortcuts(e.length)):p.Snackbar.completeSticky(q.successMessageOneShortcut(p.filename(o)))})(e,c[0].shortcuts[0].file_path)}catch(n){const r=((e,o)=>{let t=!1,i="server_error",s=q.SERVER_ERROR;if(o instanceof v.AppError){const n=o.error;switch(n[".tag"]){case"src_file_not_found":i="src_file_not_found",s=q.srcFilesNotFound(e.length);break;case"src_file_wrong_type":i="src_file_wrong_type",s=q.srcFilesWrongType(e.length);break;case"missing_linked_service":i="google_account_not_linked",s=q.GOOGLE_ACCOUNT_NOT_LINKED;break;case"no_write_permission":s=q.NO_WRITE_PERMISSION;break;case"external_api_error":switch(t=n.is_partial_failure,n.error_sub_type[".tag"]){case"create_folder":i="folder_creation_failed",s=q.FOLDER_CREATION_FAILED;break;case"find_unused_filename":i="find_unused_filename_failed",s=q.FIND_UNUSED_FILENAME_FAILED;break;case"upload":i="upload_failed",s=q.UPLOAD_FAILED;break;case"grant_role":i="grant_permissions_failed",s=q.GRANT_PERMISSIONS_FAILED;break;case"create_file":i="create_file_failed",s=q.CREATE_FILE_FAILED;break;case"delete_file":i="delete_file_failed",s=q.DELETE_FILE_FAILED;break;case"find_file_or_folder":i="find_folder_failed",s=q.FIND_FOLDER_FAILED;break;case"other":i="google_server_error",s=q.GOOGLE_SERVER_ERROR;break;default:p.enforceExhaustive(n.error_sub_type)}break;case"invalid_dest_folder_mime_type":i="invalid_dest_folder_mime_type",s=q.INVALID_DEST_FOLDER_MIME_TYPE}}if(1===e.length){const o=z(e[0]);p.Snackbar.failSticky(q.singleFileFailSaveShortcut({filename:o,rootCause:s}))}else t?p.Snackbar.failSticky(q.multipleFilesPartialFailureShortcuts(s)):p.Snackbar.failSticky(q.multipleFilesFullFailureShortcuts(s));return i})(e,n);H(o.role,e.length,t,i,s,a,r,"success")}})),oe=({files:e,user:o,modalWasShown:i,copyFilePermissions:s})=>t.__awaiter(void 0,void 0,void 0,(function*(){const t="ms_file",n=void 0,a="none";H(o.role,e.length,t,i,s,n,a,"start");const r=[];for(let o=0;o<e.length;o+=4){const t=e.slice(o,o+4);r.push({src_files:t.map((e=>e.file_id)),keep_original_file:!1,preserve_existing_ms_file:!0,copy_permissions:s})}p.Snackbar.sync(q.pendingSaveMsFiles(e.length));const l=new p.UserApiV2Client;try{const c=yield Promise.all(r.map((e=>l.ns("cloud_docs").rpc("convert_gdd_to_ms_office_file",e,{subjectUserId:o.id}))));H(o.role,e.length,t,i,s,n,a,"success"),((e,o)=>{e.length>1?p.Snackbar.completeSticky(q.successMessageMultipleMsFiles(e.length)):p.Snackbar.completeSticky(q.successMessageOneMsFile(p.filename(o)))})(e,c[0].converted_files[0].dest_file_path)}catch(a){const r=((e,o)=>{let t="server_error",i=q.SERVER_ERROR;if(o instanceof v.AppError)switch(o.error[".tag"]){case"src_file_not_found":t="src_file_not_found",i=q.srcFilesNotFound(e.length);break;case"src_file_wrong_type":t="src_file_wrong_type",i=q.srcFilesWrongType(e.length);break;case"no_write_permission":i=q.NO_WRITE_PERMISSION;break;case"other":t="server_error"}if(1===e.length){const o=z(e[0]);p.Snackbar.failSticky(q.singleFileFailSaveMsFile({filename:o,rootCause:i}))}else p.Snackbar.failSticky(q.multipleFilesFullFailureMsFile(i));return t})(e,a);H(o.role,e.length,t,i,s,n,r,"failed")}})),te=["gdoc","gslides","gsheet"],ie=e=>(o,t)=>!!(null==t?void 0:t.expGddMigrationFrontendActions)&&e(o,t),se=(e,o)=>(t,i)=>!o.some((e=>e(t,i)))&&e(t,i),ne=ie(i.multiFileWithExtensionSelector(["gdoc"])),ae=ie(i.multiFileWithExtensionSelector(["gslides"])),re=ie(i.multiFileWithExtensionSelector(["gsheet"])),le=se(ie(i.multiFileWithExtensionSelector(te)),[ne,ae,re]),ce=ie(i.multiFileWithExtensionSelector(["gdoc","doc","docx"])),ue=ie(i.multiFileWithExtensionSelector(["gslides","ppt","pptx"])),de=ie(i.multiFileWithExtensionSelector(["gsheet","xls","xlsx"])),_e=se(ie(i.multiFileWithExtensionSelector(te.concat(["doc","docx","ppt","pptx","xls","xlsx"]))),[ce,ue,de]);var ge;!function(e){e.GOOGLE_DOC_SHORTCUT=s.intl.formatMessage({id:"CKb8d4",defaultMessage:"Google Doc shortcut"}),e.GOOGLE_SLIDES_SHORTCUT=s.intl.formatMessage({id:"f6BDMy",defaultMessage:"Google Slides shortcut"}),e.GOOGLE_SHEET_SHORTCUT=s.intl.formatMessage({id:"4dVxeR",defaultMessage:"Google Sheet shortcut"}),e.GOOGLE_FILE_SHORTCUT=s.intl.formatMessage({id:"c4laUx",defaultMessage:"Google file shortcut"}),e.MICROSOFT_DOC=s.intl.formatMessage({id:"yUBw4G",defaultMessage:"Microsoft Word"}),e.MICROSOFT_SLIDES=s.intl.formatMessage({id:"F/PKmQ",defaultMessage:"Microsoft Powerpoint"}),e.MICROSOFT_SHEET=s.intl.formatMessage({id:"wxiHoJ",defaultMessage:"Microsoft Excel"}),e.MICROSOFT_FILE=s.intl.formatMessage({id:"zNrz5l",defaultMessage:"Microsoft file"})}(ge||(ge={}));const fe=(e,o)=>t.__awaiter(void 0,void 0,void 0,(function*(){yield((e,o)=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=yield Y(o);t&&Z({user:o,srcFileNames:e.map((e=>{var o;return null!==(o=z(e))&&void 0!==o?o:""})),targetDest:$.GOOGLE_DRIVE,copyPermissionsSetting:t.copy_permissions_to_google_shortcut,onUpdateCopyPermissionsSetting:({dontAskMeAgain:e,copyFilePermissions:t})=>{Q({user:o,dontAskMeAgain:e,copyFilePermissions:t})},onSubmit:({modalWasShown:t,copyFilePermissions:i,folderId:s})=>{ee({files:e,user:o,modalWasShown:t,copyFilePermissions:i,folderId:s})}})})))(e,o)})),me=(e,o)=>t.__awaiter(void 0,void 0,void 0,(function*(){yield((e,o)=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=yield Y(o);t&&Z({user:o,srcFileNames:e.map((e=>{var o;return null!==(o=z(e))&&void 0!==o?o:""})),targetDest:$.MICROSOFT_FILE,copyPermissionsSetting:t.copy_permissions_to_google_shortcut,onUpdateCopyPermissionsSetting:({dontAskMeAgain:e,copyFilePermissions:t})=>{Q({user:o,dontAskMeAgain:e,copyFilePermissions:t})},onSubmit:({modalWasShown:t,copyFilePermissions:i})=>{oe({files:e,user:o,modalWasShown:t,copyFilePermissions:i})}})})))(e,o)})),pe=e=>{var{shortcutUrl:o}=e,i=t.__rest(e,["shortcutUrl"]);const s=O.urlToShortcutIconAsset(o,"small");return u.React$1.createElement("img",Object.assign({},i,{src:s,alt:""}))};pe.displayName="ShortcutsIcon";const Se=[I,C,...R,...A,...W,...k,...N,w,...[...[{actionText:ge.GOOGLE_DOC_SHORTCUT,actionIcon:e=>u.React$1.createElement(pe,Object.assign({},e,{shortcutUrl:"docs.google.com/document"})),selector:ce,convert:fe,actionGroup:o.ConversionActionGroup.CLOUD_DOCS},{actionText:ge.GOOGLE_SLIDES_SHORTCUT,actionIcon:e=>u.React$1.createElement(pe,Object.assign({},e,{shortcutUrl:"docs.google.com/presentation"})),selector:ue,convert:fe,actionGroup:o.ConversionActionGroup.CLOUD_DOCS},{actionText:ge.GOOGLE_SHEET_SHORTCUT,actionIcon:e=>u.React$1.createElement(pe,Object.assign({},e,{shortcutUrl:"docs.google.com/spreadsheets"})),selector:de,convert:fe,actionGroup:o.ConversionActionGroup.CLOUD_DOCS},{actionText:ge.GOOGLE_FILE_SHORTCUT,actionIcon:e=>u.React$1.createElement(pe,Object.assign({},e,{shortcutUrl:"www.google.com"})),selector:_e,convert:fe,actionGroup:o.ConversionActionGroup.CLOUD_DOCS}],...[{actionText:ge.MICROSOFT_DOC,actionIcon:e=>u.React$1.createElement(S.IconPartners,Object.assign({},e,{width:14,height:14,name:"microsoft_docx"})),selector:ne,convert:me,actionGroup:o.ConversionActionGroup.CLOUD_DOCS},{actionText:ge.MICROSOFT_SLIDES,actionIcon:e=>u.React$1.createElement(S.IconPartners,Object.assign({},e,{width:14,height:14,name:"microsoft_pptx"})),selector:ae,convert:me,actionGroup:o.ConversionActionGroup.CLOUD_DOCS},{actionText:ge.MICROSOFT_SHEET,actionIcon:e=>u.React$1.createElement(S.IconPartners,Object.assign({},e,{width:14,height:14,name:"microsoft_xlsx"})),selector:re,convert:me,actionGroup:o.ConversionActionGroup.CLOUD_DOCS},{actionText:ge.MICROSOFT_FILE,actionIcon:d.FileLine,selector:le,convert:me,actionGroup:o.ConversionActionGroup.CLOUD_DOCS}]]];o.getConversionActionsForFiles=(e,o)=>Se.filter((t=>t.selector(e,o)))}));
//# sourceMappingURL=c_flows_conversions_conversion_actions.js-vflU_hJ0f.map
