define(["exports","./c_core_uri","./e_core_exception","./c_apex-metrics_src_types","./e_ui_page_files_router"],(function(e,t,n,r,s){"use strict";var i;!function(e){e[e.NULL_VALUE=0]="NULL_VALUE"}(i||(i={})),r.proto3.util.setEnumType(i,"google.protobuf.NullValue",[{no:0,name:"NULL_VALUE"}]);class o extends r.Message{constructor(e){super(),this.fields={},r.proto3.util.initPartial(e,this)}toJson(e){const t={};for(const[n,r]of Object.entries(this.fields))t[n]=r.toJson(e);return t}fromJson(e,t){if("object"!=typeof e||null==e||Array.isArray(e))throw new Error("cannot decode google.protobuf.Struct from JSON "+r.proto3.json.debug(e));for(const[t,n]of Object.entries(e))this.fields[t]=a.fromJson(n);return this}static fromBinary(e,t){return(new o).fromBinary(e,t)}static fromJson(e,t){return(new o).fromJson(e,t)}static fromJsonString(e,t){return(new o).fromJsonString(e,t)}static equals(e,t){return r.proto3.util.equals(o,e,t)}}o.runtime=r.proto3,o.typeName="google.protobuf.Struct",o.fields=r.proto3.util.newFieldList((()=>[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:a}}]));class a extends r.Message{constructor(e){super(),this.kind={case:void 0},r.proto3.util.initPartial(e,this)}toJson(e){switch(this.kind.case){case"nullValue":return null;case"boolValue":case"numberValue":case"stringValue":return this.kind.value;case"structValue":case"listValue":return this.kind.value.toJson(Object.assign(Object.assign({},e),{emitDefaultValues:!0}))}throw new Error("google.protobuf.Value must have a value")}fromJson(e,t){switch(typeof e){case"number":this.kind={case:"numberValue",value:e};break;case"string":this.kind={case:"stringValue",value:e};break;case"boolean":this.kind={case:"boolValue",value:e};break;case"object":null===e?this.kind={case:"nullValue",value:i.NULL_VALUE}:Array.isArray(e)?this.kind={case:"listValue",value:u.fromJson(e)}:this.kind={case:"structValue",value:o.fromJson(e)};break;default:throw new Error("cannot decode google.protobuf.Value from JSON "+r.proto3.json.debug(e))}return this}static fromBinary(e,t){return(new a).fromBinary(e,t)}static fromJson(e,t){return(new a).fromJson(e,t)}static fromJsonString(e,t){return(new a).fromJsonString(e,t)}static equals(e,t){return r.proto3.util.equals(a,e,t)}}a.runtime=r.proto3,a.typeName="google.protobuf.Value",a.fields=r.proto3.util.newFieldList((()=>[{no:1,name:"null_value",kind:"enum",T:r.proto3.getEnumType(i),oneof:"kind"},{no:2,name:"number_value",kind:"scalar",T:1,oneof:"kind"},{no:3,name:"string_value",kind:"scalar",T:9,oneof:"kind"},{no:4,name:"bool_value",kind:"scalar",T:8,oneof:"kind"},{no:5,name:"struct_value",kind:"message",T:o,oneof:"kind"},{no:6,name:"list_value",kind:"message",T:u,oneof:"kind"}]));class u extends r.Message{constructor(e){super(),this.values=[],r.proto3.util.initPartial(e,this)}toJson(e){return this.values.map((e=>e.toJson()))}fromJson(e,t){if(!Array.isArray(e))throw new Error("cannot decode google.protobuf.ListValue from JSON "+r.proto3.json.debug(e));for(let t of e)this.values.push(a.fromJson(t));return this}static fromBinary(e,t){return(new u).fromBinary(e,t)}static fromJson(e,t){return(new u).fromJson(e,t)}static fromJsonString(e,t){return(new u).fromJsonString(e,t)}static equals(e,t){return r.proto3.util.equals(u,e,t)}}u.runtime=r.proto3,u.typeName="google.protobuf.ListValue",u.fields=r.proto3.util.newFieldList((()=>[{no:1,name:"values",kind:"message",T:a,repeated:!0}]));class l extends r.Message{constructor(e){super(),this.tealiumEnabled=!1,this.tealiumEnv="",this.tealiumProfile="",this.privacyConsentEnabled=!1,r.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new l).fromBinary(e,t)}static fromJson(e,t){return(new l).fromJson(e,t)}static fromJsonString(e,t){return(new l).fromJsonString(e,t)}static equals(e,t){return r.proto3.util.equals(l,e,t)}}l.runtime=r.proto3,l.typeName="marketing_tracker.Config",l.fields=r.proto3.util.newFieldList((()=>[{no:3,name:"tealium_enabled",kind:"scalar",T:8},{no:4,name:"tealium_env",kind:"scalar",T:9},{no:5,name:"tealium_profile",kind:"scalar",T:9},{no:6,name:"default_marketing_data",kind:"message",T:o},{no:7,name:"privacy_consent_enabled",kind:"scalar",T:8}]));class c extends r.Message{constructor(e){super(),this.src="",r.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new c).fromBinary(e,t)}static fromJson(e,t){return(new c).fromJson(e,t)}static fromJsonString(e,t){return(new c).fromJsonString(e,t)}static equals(e,t){return r.proto3.util.equals(c,e,t)}}c.runtime=r.proto3,c.typeName="marketing_tracker.MarketingTrackerData",c.fields=r.proto3.util.newFieldList((()=>[{no:1,name:"src",kind:"scalar",T:9},{no:2,name:"config",kind:"message",T:l},{no:3,name:"data_layer",kind:"message",T:o}]));var m;e.EventTypeEnum=void 0,(m=e.EventTypeEnum||(e.EventTypeEnum={})).Link="link",m.View="view";class d{constructor(n){if(this.el=null,this.ready=!1,this.readyTimeout=null,this.resetForTesting=()=>{this.el=null,this.ready=!1,this.readyTimeout=null},this.push=({src:n,dataLayer:r,config:i,eventType:o})=>{const a=Object.assign(Object.assign({},r),{_config:i||{},_eventType:o||e.EventTypeEnum.Link});t.assert(!!n,"MarketingTracker.push requires src"),this.ready?this.el&&this.el.contentWindow&&this.el.contentWindow.postMessage(a,this.args.marketingUri):(this.el||(this.el=this.load(n),this.src=n,i&&(this.config=i),this.readyTimeout=setTimeout((()=>{this.args.onException({err:new Error("Timed-out while waiting for marketing_tracker iframe load event"),severity:"non-critical"})}),3e4)),this.el.addEventListener("load",(()=>{null!==this.readyTimeout&&(clearTimeout(this.readyTimeout),this.readyTimeout=null),this.el&&this.el.contentWindow?(this.ready=!0,this.el.contentWindow.postMessage(a,this.args.marketingUri),s.registerLogToMarketingTrackerFunction((t=>{this.pushWithDefaults(t,e.EventTypeEnum.Link)}),this.args.inclusionMethod)):this.args.onException({err:new Error("Could not find contentWindow on marketing_tracker iframe element"),severity:"non-critical"})})))},this.load=e=>{const t=document.createElement("iframe");return t.style.display="none",t.hidden=!0,t.src=e,t.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(t),t},this.pushWithDefaults=(e,t)=>{const{config:n,src:r}=this;if(n){const s={config:n,dataLayer:Object.assign(Object.assign({},this.config.default_marketing_data),e),src:r,eventType:t};this.push(s)}else this.args.onReportStack("MarketingTracker.pushWithDefaults requires config, which is undefined. This probably           means there is no MarketingTracker instance on the page.")},this.pushEvent=(e,t,n)=>{const r=Object.assign({event:e,tealium_event:e},n);this.pushWithDefaults(r,t)},this.tryPushEvent=(t,n,r)=>{const{config:s,src:i}=this,o={event:t,tealium_event:t};if(r=r||{},s){const t={config:s,dataLayer:Object.assign(Object.assign(Object.assign({},this.config.default_marketing_data),o),r),src:i,eventType:n||e.EventTypeEnum.Link};this.push(t)}},d.instance)return d.instance;this.args=n,d.instance=this}}const g=new d({marketingUri:"https://marketing.dropbox.com",onException:n.reportException,onReportStack:n.reportStack,inclusionMethod:s.InclusionMethod.BASE});e.MARKETING_LOGIN_EVENT="user_login",e.MARKETING_REGISTER_EVENT="user_register",e.MarketingTracker=g,e.getGAEventData=function(e,t,n,r){const s={ga_eventaction:t,ga_eventCategory:e};return n&&(s.ga_eventLabel=n),r&&(s.ga_eventValue=r),s},e.getGAViewData=function(e,n,r){const s={};return t.assert(!r||r.startsWith("/virtual"),"virtual pageview page should start with virtual"),e&&(s.title=e),n&&(s.ga_pageview_location=n),r&&(s.ga_pageview_page=r),s}}));
//# sourceMappingURL=c_marketing_tracker.js-vflmzkB8O.map
