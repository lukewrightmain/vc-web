define(["exports","./e_edison","./e_ui_page_files_router","./c_history","./c_browse","./c_delorean_components_panel_open_listener","./c_action_bar_file_actions","./c_core_i18n","./c_spectrum_tertiary_link_tertiary_list","./c_core_uri","./c_assets_spot_restore","./c_lodash-es_lodash","./c_tslib","./c_dig-illustrations_spot_files-old-2","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_notify","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/core/langpack","./c_ux_analytics_dispatch_custom_event","./c_bug_reporting_routing","./c_pagelet_logger","./c_pagination_manager","./c_browse_actions","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_data_action_creators_index","./c_browse_crypto_subtle_digest","./c_action_bar_file_actions_logging","./c_files_view_file_actions_snackbars","./c_sync_everything_hive_logger","./c_pap-events_previews_delete_file","./c_sharing_async_share_modal_util","./c_flows_utils_async_modal_launchers","./c_browse_file_actions_action_handlers","./c_views_copy_link_mini_modal","./c_share_modal_evolution_utils_logging","./c_src_utils_logging","./c_components_sharing_spinner","./c_ui-icon_line_link","./c_truncate_index","./c_clipboard_v3","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_downloads","./c_extensions_data_selectors","./c_share_download_ui_api","./c_integrations_data_selectors","./c_browse_interface","./c_file_actions_portable_go_to_folder","./c_file_viewer_async_controller","./c_src_logging_performance","./c_cloud_docs_gdd_migration_gdd_ui_blocking","./c_plusplus_file_actions","./c_vault_constants","./c_src_file_extension_extension_constants","./c_gdd_migration_ui_utils","./c_file_imports_gdrive_file_picker","./c_components_modals_show_modal","./c_spectrum_modal_utility_modal","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_exenv_index","./c_ux_analytics_modal_tracking","./c_file_transfers_async_browse_entry_point_onboarding_modal_async","./c_starred_actions","./c_starred_constants","./c_starred_star","./c_ui-icon_fill_star","./c_common_uuid","./c_files_view_files_view_logging","./c_sharing_browse_exports","./c_unity_features","metaserver/static/js/modules/constants/unity","./c_file_store_utils","./c_file_transfers_lib_urls","./c_src_common_constants2","./c_browse_tts","./c_file_uploader_upload_kit_provider","./c_file_uploader_utils","./c_pap-events_enums_file_type-utils","metaserver/static/js/modules/constants/global_file_upload","./c_base64","./c_upload_kit_lib_types","./c_file_uploader_result_type","./c_file_uploader_actions_adapter","./c_data_store","./c_data_slice","./c_upload_kit_scheduler_types","./c_upload_kit_uploader_context","./c_upload_kit_uploader_upload_abort_controller","./c_resize-observer-polyfill_dist_ResizeObserver","./c_ui-icon_line_repeat","./c_ui-icon_line_upload-folder","./c_src_simple-action-bar_inline_action_bar","./c_src_simple-action-bar_action_bar_types","./c_assets_pictogram_lightbulb","./c_ui-icon_line_more-horizontal","./c_src_highlighted-truncated-string_em-string","./c_ui-icon_line_add","./c_ui-icon_line_move","./c_components_add-content-menu_index","./c_action_bar_action_bar_strings","./c_ui-icon_line_send","./c_cloud_docs_create_api","./c_hive_schemas_web-modal-activity","./c_folder_dialog_async","./c_pap-events_manual_upload_select_upload","./c_ui-icon_line_add-folder","./c_ui-icon_line_automation","./c_ui-icon_line_team","./c_spectrum_icon_partners_index","./c_flows_redux_store","./c_flows_redux_reducer","./c_flows_lib_api","./c_flows_logging_flows_loggers","./c_src_common_constants","./c_flows_constants","./c_ui-icon_line_record-screen-camera","./c_capture_sdk_helpers","./c_capture_redux_selectors","./c_capture_async_recorder","./c_ui-icon_line_upload","./c_file_uploader_types","./c_flows_utils_exposure_logger","./c_ui-icon_line_hide","./c_ui-icon_line_restore","./c_ui-icon_line_show","./c_ui-icon_line_zip","./c_ui-icon_line_cursor","./c_ui-icon_line_to-do","./c_file_actions_portable_move","./c_ui_fileops_actions","./c_naming_conventions_utils","./c_flows_redux_selectors","./c_modal_filters_view_tidy_filters","./c_controls_index","./c_components_item_truncation_container","./c_hooks_resize_observer","./c_ui-icon_line_delete","./c_form_row_index","./c_folder_dialog_folder_picker_dig","./c_table_columns_file_name_column","./c_src_table","./c_ui-icon_line_arrow-down","./c_ui-icon_line_arrow-up","./c_react-table_index","./c_src_icons_file_icon","./c_src_icons_file_icon_extensions","./c_combinations_index","./c_spectrum_icon_arrow_index","./c_keymaster","./c_breadcrumb_index","./c_flows_redux_actions","./c_components_loading_indicator","./c_sharing_actions_share_modal","./c_previews_util","./c_file_viewer_utils","./c_core_logging_constants","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_core_types_preview_type","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_confirmation_modals_reset_access_modal","./c_ui_flag","./c_components_form_validation_message","./c_hooks_lib_index","./c_ui-icon_line_calendar","./c_components_icons_icon_dropdown_selected","./c_components_sharing_modal_banner","./c_ui-icon_line_settings","./c_es_src_dropbox","./c_ui-icon_line_edit","./c_typeahead_index","./c_sharing_ui_notifications_util","./c_ui-icon_line_video","./c_integrations_hellosign_deep_integration_launcher","./c_ui-icon_line_signature","./c_src_instrumentation_function_wrapper","./c_src_instrumentation_constants","./c_table_index","./c_src_text","./c_dropins_sdk_refactor_src_v2_entry","./c_stormcrow_stormcrow_exposure_logger","./c_account_email_verify_reasons","./c_docsend_analytics_add_on_data_apiUtils","./c_docsend_src_utils","./c_sharing_upsells_util","./c_flux_store_listener","./c_tabs_index","./c_sharing_content_manager","./c_spectrum_colorized_icon","./c_ui_bubble_dropdown_v2","./c_ui_overlay","./c_raf_throttle","./c_components_auto-folder-setup-checkbox_index","./c_icon_file_icon","./c_ui_title_bubble","./c_avatar_initials_avatar","./c_avatar_size","./c_spectrum_avatar_avatar_initials","./c_spectrum_avatar_avatar_color_util","./c_prop-types_index","./c_spectrum_tooltip","./c_spectrum_dropdown_button","./c_integrations_profile_card_popover","./c_integrations_notify","./c_src_instrumentation_common_context","./c_spectrum_facepile_facepile_members","./c_spectrum_culled_list","./c_spectrum_util_raf_throttle","./c_components_approval-forms_approval_checkbox_in_share","./c_sharing_member_avatars","./c_ui_tooltip","./c_sharing_share_modal_util","./c_account_email","./c_ui_modal_dig","./c_ui_input_dig","./c_flows_approval_approval_io_client","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","./c_icon_templates_actionable_index","./c_collections_utils_file","./c_onboarding_checklist_async_share_button_tooltip","./c_ui-icon_line_lock","./c_jquery","./c_Key","./c_growth_ui_send_app_link_form","./c_auth_authenticator","./c_security_crypto","./c_error_boundary","./c_react-error-boundary","./c_file_info_utils","./c_browse_selection_indicator","./c_capture_api","./c_browse_element_width","./c_spectrum_media_table_skeleton","./c_spectrum_media_table_media_cell","./c_spectrum_dimensions","./c_spectrum_vertically_fixed","./c_spectrum_overflow_button","./c_campaigns_campaigns_element_id_enum","./c_files_view_keyboard_shortcuts","./c_action_bar_action_bar_constants","./c_ui_selectable_list","./c_filename_highlights","./c_src_highlighted-truncated-string_index","./c_files_view_file_thumbnail","./c_icon_file_folder_icon","./c_icon_shortcuts_icon","./c_tagging_components_tags_container","./c_sync_everything_utils_deep_link_utils","./c_core_custom_protocol","./c_web_util_errors","./c_extensions_split_share_button","./c_aspect_ratio_index","./c_src_common_file","./c_ui-icon_line_more-vertical","./c_content_suggestions_models_suggested_item","./c_ui_section_header_tooltip","./c_ui-icon_line_info-small","./c_ui_section_section_header","./c_content_suggestions_api","./c_ui_section_section_empty_text","./c_api_v2_team_client","./c_react_query_api_helpers_helpers","./c_api_v2_redux_files","./c_ui-icon_line_collapse-right","./c_ui-icon_line_expand-left","./c_ui-icon_line_folder-history","./c_ui-icon_line_rewind","./c_right_rail_file_activity_file_activity_blade","./c_info_blade_content_metadata_image_metadata","./c_src_common_filepath","./c_comments_component_pane","./c_ui-icon_line_emoji-smile","./c_comments_data_store","./c_ui-icon_line_comment","./c_src_right-rail_hooks","./c_components_approval-forms_approval_request_modal","./c_components_spacer_index","./c_components_approval-forms_gating_utils","./c_ui-icon_line_mention","./c_components_utils_throttle-debounce","./c_spectrum_popover_popover_content","./c_components_section_tags_section_preview","./c_tagging_components_tags_search","./c_components_flows-icon-button_index","./c_workflow_builder_workflow_actions_action_ui_config","./c_ui-icon_line_audio","./c_ui-icon_line_arrow-right","./c_ui-icon_line_image","./c_ui_tree_view","./c_ui-icon_line_tag","./c_ui_hoc","./c_ui-icon_line_stamp","./c_plugin_utils_tilingFunc","./c_plugin_utils_getImageDefaultSizes","./c_flows_version_change_log_section","./c_file_activity_component_file_activity_blade","./c_ui-icon_line_file-history","./c_file_activity_data_store","./c_trash_constants","./c_proto_edison_redirect_messages_pb","./c_hooks_use_stabilized_callback","./c_maestro_layout_search","./c_spectrum_match","./c_edison_ui_spa_chrome","./c_activation_data_store","./c_onboarding_checklist_constants","./c_security_csrf_hmac","./c_sync_everything_strings","./c_ui-icon_external-logo_windows","./c_ui-icon_line_computer","./c_ui-icon_line_convert-file","./c_campaigns_campaign_enums","./c_unity_check_file_cache","./c_ui-icon_line_copy","./c_file_actions_portable_copy","./c_ui-icon_line_download","./c_flows_conversions_conversion_actions","./c_flows_conversions_convert","./c_flows_utils_browse_logger","./c_flows_flows_client","./c_ui-icon_line_file","./c_ui-icon_line_folder-show","./c_growth_ui_teams_web_actions_logger_events","./c_sharing_wizard_async_wizard_modals","./c_extensions_extensions_menu_component_v2","./c_ui-icon_line_dropbox-replay","./c_ui-icon_line_dropbox","./c_ui-icon_line_finder","./c_ui-icon_line_globe","./c_extensions_extensions_utils","metaserver/static/js/modules/constants/payments","./c_ui-icon_fill_fail","metaserver/static/js/modules/constants/reel","./c_ui-icon_line_delete-forever","./c_ui-icon_line_file-request","./c_ui-icon_line_share-arrow","./c_ui-icon_line_highlight","./c_shallow_equal","./c_ui-icon_line_thumbs-up","./c_flows_approval_approval_request_modal","./c_ui-icon_line_add-to-collection","./c_components_saver_modal_index","./c_collections_utils_file_identifier","./c_ui-icon_line_collection","./c_ui-icon_line_sort-type","./c_collections_utils_thumbnails","./c_collections_lib_survey","./c_conversions_actions_unzip","./c_photo-editor_plugin_show-edit-plugin"],(function(e,t,s,i,a,o,r,n,c,l,d,_,p,h,u,g,m,v,f,w,y,R,x,b,P,k,E,M,N,D,I,C,$,T,S,L,F,H,B,A,G,O,W,U,V,q,j,z,X,J,Y,Q,K,Z,ee,te,se,ie,ae,oe,re,ne,ce,le,de,_e,pe,he,ue,ge,me,ve,fe,we,ye,Re,xe,be,Pe,ke,Ee,Me,Ne,De,Ie,Ce,$e,Te,Se,Le,Fe,He,Be,Ae,Ge,Oe,We,Ue,Ve,qe,je,ze,Xe,Je,Ye,Qe,Ke,Ze,et,tt,st,it,at,ot,rt,nt,ct,lt,dt,_t,pt,ht,ut,gt,mt,vt,ft,wt,yt,Rt,xt,bt,Pt,kt,Et,Mt,Nt,Dt,It,Ct,$t,Tt,St,Lt,Ft,Ht,Bt,At,Gt,Ot,Wt,Ut,Vt,qt,jt,zt,Xt,Jt,Yt,Qt,Kt,Zt,es,ts,ss,is,as,os,rs,ns,cs,ls,ds,_s,ps,hs,us,gs,ms,vs,fs,ws,ys,Rs,xs,bs,Ps,ks,Es,Ms,Ns,Ds,Is,Cs,$s,Ts,Ss,Ls,Fs,Hs,Bs,As,Gs,Os,Ws,Us,Vs,qs,js,zs,Xs,Js,Ys,Qs,Ks,Zs,ei,ti,si,ii,ai,oi,ri,ni,ci,li,di,_i,pi,hi,ui,gi,mi,vi,fi,wi,yi,Ri,xi,bi,Pi,ki,Ei,Mi,Ni,Di,Ii,Ci,$i,Ti,Si,Li,Fi,Hi,Bi,Ai,Gi,Oi,Wi,Ui,Vi,qi,ji,zi,Xi,Ji,Yi,Qi,Ki,Zi,ea,ta,sa,ia,aa,oa,ra,na,ca,la,da,_a,pa,ha,ua,ga,ma,va,fa,wa,ya,Ra,xa,ba,Pa,ka,Ea,Ma,Na,Da,Ia,Ca,$a,Ta,Sa,La,Fa,Ha,Ba,Aa,Ga,Oa,Wa,Ua,Va,qa,ja,za,Xa,Ja,Ya,Qa,Ka,Za,eo,to,so,io,ao,oo,ro,no,co,lo,_o,po,ho,uo,go,mo,vo,fo,wo,yo,Ro,xo,bo,Po,ko,Eo,Mo,No,Do,Io,Co,$o,To,So,Lo,Fo,Ho,Bo,Ao,Go,Oo,Wo,Uo,Vo,qo,jo,zo,Xo,Jo,Yo,Qo,Ko,Zo,er,tr,sr,ir,ar,or,rr,nr){"use strict";const cr=e=>{const{icon:i,text:a,link:o}=e;return t.React$1.createElement("div",{className:"restorations-education__other-option"},t.React$1.createElement(s.Link,{href:o,hasNoUnderline:!0,className:"restorations-education__link"},t.React$1.createElement("div",{className:"restorations-education__other-option__icon"},t.React$1.createElement(c.IconAction,{name:i})),t.React$1.createElement("div",null,a)))},lr=e=>{const{olderFileVersion:i,olderFolderVersion:a,deletedFile:o,user:c}=e;let d;if(r.shouldShowRewindsUpsell(c)){d=new l.URI({path:s.get_browse_root(c),query:{rewind:"true"}}).toString()}else d="https://help.dropbox.com/security/rewind";return t.React$1.createElement("div",{className:"restorations-education__other-options-container"},t.React$1.createElement("div",{className:"restorations-education__smaller-title"},t.React$1.createElement(s.Text,{isBold:!0},n.intl.formatMessage({id:"fVbjZ+",defaultMessage:"Don't want to rewind everything?"}))),t.React$1.createElement("div",{className:"restorations-education__other-options"},a&&t.React$1.createElement(cr,{link:d,icon:"revert-folder",text:n.intl.formatMessage({id:"BpZmUk",defaultMessage:"Find an earlier version of a folder"})}),i&&t.React$1.createElement(cr,{link:"/help/security/version-history-overview",icon:"view-version-history",text:n.intl.formatMessage({id:"vb45xv",defaultMessage:"Find an earlier version of a file"})}),o&&t.React$1.createElement(cr,{link:"/deleted_files",icon:"delete",text:n.intl.formatMessage({id:"eLe6+W",defaultMessage:"Recover a deleted file"})})))},dr=e=>{const{daysOfVersionHistory:i}=e;let a;return a=null==i?n.intl.formatMessage({id:"2xi5y3",defaultMessage:"Get your deleted files back, or delete them forever"}):n.intl.formatMessage({id:"Q4wsJE",defaultMessage:"{count, plural, one{Restore any file deleted in the last {count} day} other{Restore any file deleted in the last {count} days}}"},{count:i}),t.React$1.createElement("div",{className:"restorations-education__explanation-container"},t.React$1.createElement("div",{className:"restorations-education__title"},a),t.React$1.createElement("div",{className:"restorations-education__help"},t.React$1.createElement(s.Link,{href:"https://help.dropbox.com/security/recover-deleted-files-folders",hasNoUnderline:!0,className:"restorations-education__link"},n.intl.formatMessage({id:"9u9nEt",defaultMessage:"How to recover deleted files"})),t.React$1.createElement("div",{className:"restorations-education__df-help__image"},t.React$1.createElement(s.SpotIcon,{src:d.RestoreSpot}))))},_r=e=>{const{daysOfVersionHistory:i}=e;let a;return a=null==i?n.intl.formatMessage({id:"+d7V/q",defaultMessage:"Restore an older version of this file"}):n.intl.formatMessage({id:"YnH6gd",defaultMessage:"{count, plural, one{Restore any version from the past {count} day} other{Restore any version from the past {count} days}}"},{count:i}),t.React$1.createElement("div",{className:"restorations-education__explanation-container"},t.React$1.createElement("div",{className:"restorations-education__title"},a),t.React$1.createElement("div",{className:"restorations-education__help"},t.React$1.createElement(s.Link,{href:"https://help.dropbox.com/security/version-history-overview",hasNoUnderline:!0,className:"restorations-education__link"},n.intl.formatMessage({id:"rCUwSi",defaultMessage:"How version history works"})),t.React$1.createElement("div",{className:"restorations-education__help__image"},t.React$1.createElement(s.SpotIcon,{src:d.RestoreSpot}))))};s.requireCssWithComponent((e=>{const{daysOfVersionHistory:s,user:i}=e;return t.React$1.createElement("div",{className:"restorations-education",key:"restorations-education"},t.React$1.createElement(dr,{daysOfVersionHistory:s}),t.React$1.createElement(lr,{olderFolderVersion:!0,olderFileVersion:!0,user:i}))}),["/static/metaserver/static/css/restorations-education-vflOmkIv9.css","/static/metaserver/static/css/dig-illustrations/index.web-vflzrHQEU.css"]);s.requireCssWithComponent((e=>{const{daysOfVersionHistory:s,user:i}=e;return t.React$1.createElement("div",{className:"restorations-education",key:"restorations-education"},t.React$1.createElement(_r,{daysOfVersionHistory:s}),t.React$1.createElement(lr,{olderFolderVersion:!0,deletedFile:!0,user:i}))}),["/static/metaserver/static/css/restorations-education-vflOmkIv9.css"]);const pr=s.requireCssWithComponent(lr,["/static/metaserver/static/css/restorations-education-vflOmkIv9.css"]);class hr extends t.React$1.Component{constructor(){super(...arguments),this.logGoToHelpCenter=()=>{const{user:e,restoreId:t}=this.props;a.clickNUXHelp({user:e,restoreId:t})},this.onDismiss=()=>{const{user:e,restoreId:t}=this.props;a.clickNUXNext({user:e,restoreId:t}),this.props.dispatch(a.dismissNUXAction())}}render(){let e;const i=e=>t.React$1.createElement(s.Button,{className:"rewind-nux__help-center-button",variant:"transparent",onClick:this.logGoToHelpCenter,href:"https://help.dropbox.com/security/rewind"},e);if(this.props.versionHistoryLength){const t=Math.floor(this.props.versionHistoryLength/365);e=t>=1?n.intl.formatMessage({id:"8cC94q",defaultMessage:"Rewind your folder back to any time in the last {version_history_length, plural, one {# year} other {# years}}. <a>How Rewind works</a>"},{version_history_length:t,a:i}):n.intl.formatMessage({id:"KImBqp",defaultMessage:"Rewind your folder back to any time in the last {version_history_length} days. <a>How Rewind works</a>"},{version_history_length:this.props.versionHistoryLength,a:i})}else e=n.intl.formatMessage({id:"IBa7RM",defaultMessage:"Rewind your folder back to an earlier point in time. <a>How Rewind works</a>"},{a:i});return t.React$1.createElement("div",{className:"rewind-nux"},t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement("div",{className:"rewind-text__image"},t.React$1.createElement("img",{alt:"",src:t.static_url("/static/metaserver/static/images/delorean/illo-folders@2x-vflmf44mp.png")})),t.React$1.createElement("div",{className:"rewind-text__title rewind-nux__title"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},n.intl.formatMessage({id:"OdrdGa",defaultMessage:"Turn back the clock"}))),t.React$1.createElement("div",null,t.React$1.createElement(s.Text,{color:"faint"},e)),t.React$1.createElement(s.Button,{variant:"primary",className:"rewind-text__button",onClick:this.onDismiss},n.intl.formatMessage({id:"5LRbzr",defaultMessage:"Try Rewind"}))),t.React$1.createElement(pr,{deletedFile:!0,olderFileVersion:!0,user:this.props.user}))}}hr.displayName="RewindNUX";class ur{constructor(e){this.disposed=!1,this.shapes=[],this.animationTick=0,this.addLine=e=>(this.shapes.push(e),e),this.addSpline=e=>(this.shapes.push(e),e),this.addGradient=e=>(this.shapes.push(e),e),this.renderCanvas=()=>{if(window.requestAnimationFrame(this.renderCanvas),!this.invisible){this.context.save(),this.animationTick++,this.context.clearRect(0,0,this.width,this.height);for(const e of this.shapes)if(!e.invisible){if(this.context.save(),e.clip){const{topLeft:t,size:s}=e.clip;this.context.beginPath(),this.context.rect(t.x,t.y,s.x,s.y),this.context.clip()}this.renderShape(e),this.context.restore()}this.context.restore()}},this.renderShape=e=>"line"===e.type?this.renderLine(e):"spline"===e.type?this.renderSpline(e):"gradient"===e.type?this.renderGradient(e):a.assertNever(e),this.getColorValue=e=>"solid"===e.type?e.value:"pulse"===e.type?function(e,t,s){const i=parseInt(e.replace(/#/g,""),16),a=parseInt(t.replace(/#/g,""),16),o=i>>16,r=i>>8&255,n=255&i;return"#"+((1<<24)+(o+s*((a>>16)-o)<<16)+(r+s*((a>>8&255)-r)<<8)+(n+s*((255&a)-n))|0).toString(16).slice(1)}(e.start,e.end,(Math.sin(this.animationTick/20)+1)/2):a.assertNever(e),this.renderLine=e=>{if(this.context.beginPath(),this.context.strokeStyle=this.getColorValue(e.color),this.context.lineWidth=a.DEFAULT_GRAPH_LINE_WIDTH,e.dashed)if("pulsing"===e.dashed){const e=(Math.sin(this.animationTick/20)+1)/2*5;this.context.lineDashOffset=e,this.context.setLineDash([10-e,e])}else"solid"===e.dashed?this.context.setLineDash([4,4]):a.assertNever(e.dashed);this.context.moveTo(e.start.x,e.start.y),this.context.lineTo(e.end.x,e.end.y),this.context.stroke()},this.renderSpline=e=>{const t=a.DEFAULT_GRAPH_LINE_WIDTH;this.context.beginPath(),this.addGraphPathToContext(e.points,t),this.context.strokeStyle=this.getColorValue(e.color),this.context.lineWidth=t,this.context.stroke()},this.renderGradient=e=>{const t=a.DEFAULT_GRAPH_LINE_WIDTH;this.context.beginPath(),this.context.moveTo(0,this.height),this.addGraphPathToContext(e.points,t),this.context.lineTo(this.width,this.height),this.context.closePath(),this.context.clip();const s=this.context.createLinearGradient(0,0,0,this.height);!!window.MSInputMethodContext&&!!document.documentMode||(s.addColorStop(0,this.getColorValue(e.startColor)),s.addColorStop(1,this.getColorValue(e.endColor)),this.context.fillStyle=s,this.context.fillRect(0,0,this.width,this.height))},this.dispose=()=>{this.disposed=!0,this.shapes=[]};const{width:t,height:s,canvas:i,invisible:o}=e;this.canvas=i,this.context=i.getContext("2d"),this.width=t,this.height=s,this.invisible=o,this.context&&(this.context.translate(.5,.5),i.style.width=t+"px",i.style.height=s+"px",i.width=t*window.devicePixelRatio,i.height=s*window.devicePixelRatio,this.context.scale(window.devicePixelRatio,window.devicePixelRatio),window.requestAnimationFrame(this.renderCanvas))}addGraphPathToContext(e,t){const s=.5,i=[];e=[e[0],e[0],...e,e[e.length-1]];const a=_.maxBy(e,(e=>e.y)).y,o=_.minBy(e,(e=>e.y)).y+t;for(let t=2;t<e.length-2;t++)for(let r=0;r<=16;r++){const n=(e[t+1].x-e[t-1].x)*s,c=(e[t+2].x-e[t].x)*s,l=(e[t+1].y-e[t-1].y)*s,d=(e[t+2].y-e[t].y)*s,_=r/16,p=2*Math.pow(_,3)-3*Math.pow(_,2)+1,h=-2*Math.pow(_,3)+3*Math.pow(_,2),u=Math.pow(_,3)-2*Math.pow(_,2)+_,g=Math.pow(_,3)-Math.pow(_,2),m=p*e[t].x+h*e[t+1].x+u*n+g*c;let v=p*e[t].y+h*e[t+1].y+u*l+g*d;v>a&&(v=a),v<o&&(v=o),i.push({x:m,y:v})}for(let e=1;e<i.length;e++)this.context.lineTo(i[e].x,i[e].y)}}const gr=e=>{const{canNavigate:i,daysForward:o,loading:r,onNavigateOneWeekForward:c,disabled:l}=e;return i?t.React$1.createElement(s.Button,{"aria-label":n.intl.formatMessage({id:"rJUytN",defaultMessage:"Go forward one week"}),className:"rewind-graph-nav__btn",variant:"transparent",hasNoUnderline:!0,disabled:l,onClick:l?void 0:c},r&&t.React$1.createElement(s.Spinner,{size:"xsmall","aria-valuetext":"Loading"})," ",a.formatWithShortDateName(s.increment_date(new Date,0,0,1-o))," ›"):t.React$1.createElement(s.Button,{disabled:!0,variant:"transparent",hasNoUnderline:!0},n.intl.formatMessage({id:"JDRaFD",defaultMessage:"Today"}))},mr=e=>{const{canNavigate:i,daysBackward:o,loading:r,onNavigateOneWeekBack:c,disabled:l}=e;return i?t.React$1.createElement(s.Button,{"aria-label":n.intl.formatMessage({id:"r409m+",defaultMessage:"Go back one week"}),className:"rewind-graph-nav__btn",variant:"transparent",hasNoUnderline:!0,disabled:l,onClick:l?void 0:c},"‹ ",a.formatWithShortDateName(s.increment_date(new Date,0,0,-o))," ",r&&t.React$1.createElement(s.Spinner,{size:"xsmall","aria-valuetext":"Loading"})):t.React$1.createElement("span",null," ")},vr=e=>{const i=[n.intl.formatMessage({id:"J5qhzs",defaultMessage:"Most activity"}),n.intl.formatMessage({id:"OJDO+R",defaultMessage:"Second most activity"}),n.intl.formatMessage({id:"PBtB8Z",defaultMessage:"Third most activity"}),n.intl.formatMessage({id:"v2wC3C",defaultMessage:"Fourth most activity"}),n.intl.formatMessage({id:"YwaMN9",defaultMessage:"Fifth most activity"}),n.intl.formatMessage({id:"NoSBXU",defaultMessage:"Sixth most activity"}),n.intl.formatMessage({id:"dTRuPR",defaultMessage:"Seventh most activity"})],a=e.data.slice().sort(((e,t)=>t.count-e.count)),o=[];let r=0;for(let e=0;e<a.length;e++)0!==e&&a[e].count!==a[e-1].count&&r++,0!==a[e].count?o.push({event:a[e],description:i[r]}):o.push({event:a[e],description:n.intl.formatMessage({id:"Kjxyo5",defaultMessage:"No activity"})});return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement("div",null,n.intl.formatMessage({id:"JWIyED",defaultMessage:"Most active days this week"})),o.map((({event:i,description:a},o)=>t.React$1.createElement(s.Button,{key:`accessible-button-${o}`,variant:"transparent",className:"rewind-graph-nav__btn",onClick:()=>{e.onSelectDate(i.dateTsInMs,i.dateString)}},i.dateString,": ",a))))},fr="#1C3DA3",wr="rgba(0, 0, 0, 0.15)",yr="rgba(178, 205, 255, 0.5)",Rr="rgba(237, 244, 255, 0.5)",xr={start:"#eeeeee",end:"#B2CDFF",type:"pulse"},br=e=>"before graph"!==e&&"after graph"!==e&&void 0!==e;class Pr extends t.React$1.PureComponent{constructor(e){super(e),this.dateLines=[],this.createGraph=()=>{this.graph&&this.graph.dispose(),this.graph=new ur({width:this.props.width,height:this.props.height,canvas:this.canvasRef,invisible:!this.props.hasData}),this.graph.addLine({type:"line",start:{x:0,y:this.props.height},end:{x:this.props.width,y:this.props.height},color:{value:wr,type:"solid"}}),this.graph.addLine({type:"line",start:{x:0,y:0},end:{x:this.props.width,y:0},color:{value:wr,type:"solid"}});const e=this.getNormalizedPoints(this.props.data);this.blueGradient=this.graph.addGradient({type:"gradient",points:e,startColor:{value:yr,type:"solid"},endColor:{value:Rr,type:"solid"}}),this.grayGradient=this.graph.addGradient({type:"gradient",points:e,startColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"},endColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"}}),this.dateLines=e.map((({x:e})=>this.graph.addLine({type:"line",start:{x:e,y:0},end:{x:e,y:this.props.height},color:{value:wr,type:"solid"},dashed:"solid"}))),this.blueSpline=this.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:fr}}),this.graySpline=this.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:wr}}),this.selectedLine=this.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:this.props.height},color:{type:"solid",value:fr},invisible:!0}),this.hoveredLine=this.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:this.props.height},color:{type:"solid",value:fr},dashed:"pulsing",invisible:!0})},this.createEmptyGraph=()=>{this.emptyGraph&&this.emptyGraph.dispose(),this.emptyGraph=new ur({width:this.props.width,height:this.props.height,canvas:this.canvasRef,invisible:this.props.hasData}),this.emptyGraph.addLine({type:"line",start:{x:0,y:this.props.height},end:{x:this.props.width,y:this.props.height},color:{value:wr,type:"solid"}}),this.emptyGraph.addLine({type:"line",start:{x:0,y:0},end:{x:this.props.width,y:0},color:{value:wr,type:"solid"}})},this.updateGraph=()=>{const e=this.getSelectedPoint();if(!this.graph||!this.emptyGraph)return;if(this.graph.invisible=!this.props.hasData,this.emptyGraph.invisible=this.props.hasData,!this.props.hasData)return;const t=!this.state.isHovered&&void 0!==e&&"before graph"!==e&&"after graph"!==e;for(const s of this.dateLines)this.state.isHovered||void 0!==e?s.color={type:"solid",value:wr}:s.color=xr,s.invisible=t;const s=this.getSelectedPoint()||this.state.hoveredPoint;let i;i="after graph"===s?this.props.width:void 0===s||"before graph"===s?0:s.x;const a={topLeft:{x:0,y:0},size:{x:i,y:this.props.height}},o={topLeft:{x:i,y:0},size:{x:this.props.width,y:this.props.height}};this.blueGradient.clip=a,this.blueSpline.clip=a,this.grayGradient.clip=o,this.graySpline.clip=o;const r=this.state.hoveredPoint;this.hoveredLine.invisible=!r,r&&(this.hoveredLine.start.x=r.x,this.hoveredLine.end.x=r.x),this.selectedLine.invisible=!br(e),e&&br(e)&&(this.selectedLine.start.x=e.x,this.selectedLine.end.x=e.x)},this.updateRef=e=>{e&&(this.canvasRef=e,this.createGraph(),this.createEmptyGraph())},this.onMouseMove=e=>{const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left,i=_.minBy(this.getNormalizedPoints(this.props.data),(e=>Math.abs(e.x-s)));this.setState({hoveredPoint:i})},this.setDateRef=e=>{this.dateRef=e},this.onClick=()=>{this.state.hoveredPoint&&this.props.onSelectDate(this.state.hoveredPoint.event.dateTsInMs,this.state.hoveredPoint.event.dateString)},this.onMouseOver=()=>{this.setState({isHovered:!0}),this.props.onHover(!0)},this.onMouseOut=e=>{this.setState({isHovered:!1,hoveredPoint:void 0}),this.props.onHover(!1)},this.navigateOneWeekBack=()=>{this.props.onNavigateOneWeekBack()},this.navigateOneWeekForward=()=>{this.props.onNavigateOneWeekForward()},this.state={hoveredPoint:void 0,isHovered:!1}}UNSAFE_componentWillUpdate(e){const t=this.getNormalizedPoints(e.data);this.blueSpline.points=t,this.graySpline.points=t,this.blueGradient.points=t,this.grayGradient.points=t}getSelectedPoint(){const e=this.getNormalizedPoints(this.props.data);if(void 0===this.props.selectedPointMs)return;const t=this.getNormalizedPoints(this.props.data).find((e=>e.event.dateTsInMs===this.props.selectedPointMs));return t||(this.props.selectedPointMs<e[0].event.dateTsInMs?"before graph":this.props.selectedPointMs>e[e.length-1].event.dateTsInMs?"after graph":void 0)}getNormalizedPoints(e){const t=e.map(((e,t)=>({eventCount:e,x:t,y:e.count}))),s=_.minBy(t,(e=>e.x)).x;let i=_.maxBy(t,(e=>e.x)).x;const o=_.minBy(t,(e=>e.y)).y;let r=_.maxBy(t,(e=>e.y)).y;return 0===i&&(i=1),0===r&&(r=1),t.map((({x:e,y:t,eventCount:n})=>{const c=(t-o)/r;return{x:(e-s)/i*this.props.width,y:this.props.height-Math.max(a.GRAPH_BOTTOM_PADDING,c*this.props.height),event:n}}))}render(){const e=this.state.hoveredPoint?this.state.hoveredPoint.event.dateString:"";this.updateGraph();let i=0;return this.state.hoveredPoint&&(i=this.state.hoveredPoint.x-a.DATE_LABEL_WIDTH/2,i<0&&(i=0),i>this.props.width-a.DATE_LABEL_WIDTH&&(i=this.props.width-a.DATE_LABEL_WIDTH)),t.React$1.createElement("div",null,t.React$1.createElement("div",{style:{paddingLeft:`${i}px`}},this.props.hasData?t.React$1.createElement("div",{ref:this.setDateRef,className:"rewind-graph-date-label"},e):t.React$1.createElement("div",{className:"rewind-graph-date-label-spacer"})),t.React$1.createElement("canvas",{width:this.props.width,height:this.props.height,className:s.classnames({"rewind-graph-canvas":!0,"no-data":!this.props.hasData}),ref:this.updateRef,onMouseMove:this.props.hasData?this.onMouseMove:void 0,onClick:this.props.hasData?this.onClick:void 0,onMouseOver:this.props.hasData?this.onMouseOver:void 0,onMouseOut:this.props.hasData?this.onMouseOut:void 0},t.React$1.createElement(vr,{data:this.props.data,onSelectDate:this.props.onSelectDate})),t.React$1.createElement("div",{className:"rewind-graph-nav"},t.React$1.createElement(mr,{daysBackward:this.props.graphStartOffset,canNavigate:this.props.canNavigateBackward,onNavigateOneWeekBack:this.navigateOneWeekBack,loading:this.props.loadingPreviousWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek}),t.React$1.createElement(gr,{daysForward:this.props.graphEndOffset,canNavigate:this.props.canNavigateForward,onNavigateOneWeekForward:this.navigateOneWeekForward,loading:this.props.loadingNextWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek})))}}Pr.displayName="RewindGraphComponent";class kr extends t.React$1.PureComponent{constructor(e){super(e),this.isContinueWidgetVisible=()=>"loaded"===this.props.page.contents.type&&void 0!==this.props.page.contents.selectedDateTsInMs,this.onSelectDate=(e,t)=>{const{user:s,restoreId:i}=this.props;this.props.dispatch({type:a.DeloreanActionType.setRewindPanelSelectedDate,selectedDateString:t,selectedDateTsInMs:e}),a.clickDayGraphDate({user:s,restoreId:i,selectedDateTsInMs:e})},this.onContinue=()=>{const{user:e,restoreId:t}=this.props,s=this.props.page;if("loaded"===s.contents.type&&s.contents.selectedDateString&&s.contents.selectedDateTsInMs){const{selectedDateString:i,selectedDateTsInMs:o}=s.contents;a.clickDayGraphNext({user:e,restoreId:t,selectedDateTsInMs:o}),this.props.dispatch({type:a.DeloreanActionType.changeRewindPageToActivityListPage,selectedDateTsInMs:o,selectedDateString:i})}},this.navigateOneWeekBack=()=>{this.props.dispatch(a.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset+a.REWIND_GRAPH_DAY_STEP,endDaysBack:this.props.page.graphEndOffset+a.REWIND_GRAPH_DAY_STEP,graphPositionChange:"backward",rootNsId:this.props.rootNsId}))},this.navigateOneWeekForward=()=>{this.props.dispatch(a.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset-a.REWIND_GRAPH_DAY_STEP,endDaysBack:this.props.page.graphEndOffset-a.REWIND_GRAPH_DAY_STEP,graphPositionChange:"forward",rootNsId:this.props.rootNsId}))},this.onHover=e=>{this.setState({isHovering:e})},this.startedLoadingTimestamp=Date.now(),this.state={isHovering:!1}}componentDidMount(){this.props.dispatch(a.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset,endDaysBack:this.props.page.graphEndOffset,graphPositionChange:"none",rootNsId:this.props.rootNsId}))}componentDidUpdate(e){const{user:t,restoreId:s}=this.props,i=this.startedLoadingTimestamp;if("loaded"!==e.page.contents.type&&"loaded"===this.props.page.contents.type){const e=this.props.page.contents.namespaceCount;a.loadDayGraph({user:t,restoreId:s,startedLoadingTimestamp:i,namespaceCount:e})}"error"!==e.page.contents.type&&"error"===this.props.page.contents.type&&a.loadDayGraph({user:t,restoreId:s,startedLoadingTimestamp:i,namespaceCount:0,errorString:this.props.page.contents.errorString})}renderGraphSection(){if("initial-load"===this.props.page.contents.type)return t.React$1.createElement("div",{className:"rewind-graph-panel-container"},t.React$1.createElement("div",{className:"rewind-graph-panel-container__spinner"},t.React$1.createElement(s.Spinner,{size:"large","aria-valuetext":"Loading"})));if("error"===this.props.page.contents.type)return t.React$1.createElement("div",{className:"rewind-graph-panel-container"},t.React$1.createElement("div",{className:"folder-history-event-list__empty-text"},t.React$1.createElement(s.Text,{color:"faint"},this.props.page.contents.errorString," "),t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:a.onContactSupport},n.intl.formatMessage({id:"K2WP/Z",defaultMessage:"Contact support"}))));if("loaded"===this.props.page.contents.type){const{contents:{data:e},graphStartOffset:i,graphEndOffset:o}=this.props.page,r=e.slice(e.length-i,e.length-o),c=this.props.page.contents.data.length-1-(this.props.page.graphStartOffset-1),l=this.props.page.contents.data[c]&&!this.props.page.contents.data[c].outsideHistoryCutoff,d=this.props.page.graphEndOffset>0,_=this.props.page.contents.hasDataThisWeek;return t.React$1.createElement("div",{className:"rewind-graph-panel-container"},_?t.React$1.createElement("span",null):t.React$1.createElement("div",{className:"rewind-graph-no-activity"},t.React$1.createElement("div",{className:"rewind-graph-no-activity__text"},t.React$1.createElement(s.Text,{color:"faint"},n.intl.formatMessage({id:"/AeFJk",defaultMessage:"No activity for the selected week"})))),t.React$1.createElement("div",{className:s.classnames({"rewind-graph-canvas-and-button":!0,"no-data":!_})},t.React$1.createElement(Pr,{onSelectDate:this.onSelectDate,selectedPointMs:this.props.page.contents.selectedDateTsInMs,data:r,hasData:_,width:a.GRAPH_WIDTH,height:a.GRAPH_HEIGHT,onNavigateOneWeekBack:this.navigateOneWeekBack,onNavigateOneWeekForward:this.navigateOneWeekForward,canNavigateForward:d,canNavigateBackward:l,graphStartOffset:this.props.page.graphStartOffset,graphEndOffset:this.props.page.graphEndOffset,loadingNextWeek:this.props.page.contents.loadingNextWeek,loadingPreviousWeek:this.props.page.contents.loadingPreviousWeek,onHover:this.onHover})))}return a.assertNever(this.props.page.contents)}getGraphTitle(){if("loaded"===this.props.page.contents.type&&!this.props.page.contents.selectedDateTsInMs&&this.state.isHovering)return n.intl.formatMessage({id:"E6+0Aw",defaultMessage:"Right before a spike is a good place to start"});{const e=Math.floor(this.props.page.graphEndOffset/7);return 0===e?n.intl.formatMessage({id:"Ek+UwA",defaultMessage:"Activity: this week"}):1===e?n.intl.formatMessage({id:"UpWoGT",defaultMessage:"Activity: last week"}):n.intl.formatMessage({id:"b9LPyG",defaultMessage:"{count, plural, one{Activity: {count} weeks ago} other{Activity: {count} weeks ago}}"},{count:e})}}render(){return t.React$1.createElement("div",{className:"folder-history-ie11fix"},t.React$1.createElement("div",{className:"rewind-graph-panel"},t.React$1.createElement(a.RewindStepHeader,{currentStep:1,maxStep:a.NUM_REWIND_STEPS,instructions:n.intl.formatMessage({id:"eD6onG",defaultMessage:"Pick a day to get started"}),onGoBack:a.noop}),t.React$1.createElement("div",{className:"rewind-graph-desc"},t.React$1.createElement(s.Text,null,this.getGraphTitle())),this.renderGraphSection(),t.React$1.createElement(a.RewindContinueWidget,{onContinue:this.onContinue,visible:this.isContinueWidgetVisible(),text:n.intl.formatMessage({id:"pwmhyJ",defaultMessage:"Now, let’s zoom in"})})))}}kr.displayName="RewindGraphPage";const Er=({name:e,displayDate:i,previousVersion:a})=>t.React$1.createElement("div",{className:s.classnames({"rewind-folder-and-date":!0,"rewind-folder-and-date--previous-version":a})},t.React$1.createElement("div",{className:"rewind-folder-and-date__folder"},t.React$1.createElement(s.UIIcon,{src:s.FolderLine,size:"large"})),t.React$1.createElement("div",null,t.React$1.createElement("div",{className:"rewind-folder-and-date__name"},t.React$1.createElement(s.Text,{variant:"label",size:"small",isBold:!0},e)),t.React$1.createElement("div",{className:"rewind-folder-and-date__date"},t.React$1.createElement(s.Text,{variant:"label",size:"small",color:"faint"},i))));class Mr extends t.React$1.Component{constructor(e){super(e),this.clickCancel=()=>{const{user:e,restoreId:t}=this.props;a.clickPreviewCancel({user:e,restoreId:t}),this.props.dispatch({type:a.DeloreanActionType.changeRewindPageFromConfirmationPageToGraphPage,previousPage:this.props.page})},this.clickSendBack=()=>p.__awaiter(this,void 0,void 0,(function*(){const{user:e,restoreId:i}=this.props;let o;a.clickPreviewId({user:e,restoreId:i});try{o=yield a.beginRewind({path:this.props.fqpath,targetTsMicroseconds:1e3*this.props.eventToRewindTo.timestamp,user:this.props.user,restorationsLoggingId:this.props.restoreId,rootNsId:this.props.rootNsId})}catch(e){const i=e&&e.error&&e.error[".tag"];if(i)if("insufficient_permissions"===i)s.Snackbar.show(t.React$1.createElement(s.Snackbar,{closeButtonText:n.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),title:n.intl.formatMessage({id:"MKEpc0",defaultMessage:"You do not have permissions to rewind this folder."}),variant:"fail"}));else{if("invalid_arguments"!==i&&"feature_not_allowed"!==i)throw e;s.Snackbar.show(t.React$1.createElement(s.Snackbar,{closeButtonText:n.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),title:n.intl.formatMessage({id:"6IKSeQ",defaultMessage:"We can’t rewind that. Try again, or contact support."}),variant:"fail"}))}return}this.props.dispatch({type:a.DeloreanActionType.changeRewindPageToRewindStarted,event:this.props.eventToRewindTo,rewindId:o.rewind.id})})),this.onGoBack=()=>{const{user:e,restoreId:t}=this.props;a.clickPreviewBack({user:e,restoreId:t}),this.props.dispatch({type:a.DeloreanActionType.goBackFromConfirmationPage})},this.goToHelp=()=>{const{user:e,restoreId:t}=this.props;a.clickPreviewHelp({user:e,restoreId:t}),s.unsafe_open_tab("http://www.dropbox.com/help/security/rewind")},this.getThirdPartyProvidersMessage=()=>{var e;const i=null===(e=this.props.thirdPartyProviders)||void 0===e?void 0:e.map((e=>n.intl.formatMessage(s.PROVIDER_MAP[e])));return i?t.React$1.createElement("div",{className:"rewind-confirmation-explanation"},1===i.length?t.React$1.createElement(s.Text,null,n.intl.formatMessage({id:"n4Mx31",defaultMessage:"If your {folderName} folder is backing up to {provider}, rewinding it in Dropbox will also change it in {provider}."},{folderName:s.getDisplayedFilename(this.props.folderName),provider:i[0]})):t.React$1.createElement(s.Text,null,n.intl.formatMessage({id:"UJ4blv",defaultMessage:"If your {folderName} folder is backing up to {providersPartOne} and {providersPartTwo}, rewinding it in Dropbox will also change it in {providersPartOne} and {providersPartTwo}."},{folderName:s.getDisplayedFilename(this.props.folderName),providersPartOne:i.slice(0,i.length-1).join(", "),providersPartTwo:i.slice(i.length-1).join("")}))):null},this.state={eventCountHigh:null}}componentDidMount(){a.loadConfirmationPage({eventToRewindTo:this.props.eventToRewindTo,eventCounts:this.props.eventCounts,graphPage:this.props.graphPage,user:this.props.user,restoreId:this.props.restoreId})}render(){return t.React$1.createElement("div",null,t.React$1.createElement(a.RewindStepHeader,{currentStep:3,maxStep:a.NUM_REWIND_STEPS,instructions:n.intl.formatMessage({id:"ZTkEWF",defaultMessage:"Start rewinding?"}),onGoBack:this.onGoBack}),t.React$1.createElement(Er,{name:s.getDisplayedFilename(this.props.folderName),displayDate:n.intl.formatMessage({id:"VciIXA",defaultMessage:"Now"}),previousVersion:!0}),t.React$1.createElement("div",{className:"rewind-confirmation-change-count"},t.React$1.createElement("div",{className:"rewind-confirmation-change-count__arrow"},t.React$1.createElement("div",{className:"rewind-confirmation-change-count__arrow__vertical-line"}),t.React$1.createElement("div",{className:"rewind-confirmation-change-count__arrow__head"}))),t.React$1.createElement(Er,{name:s.getDisplayedFilename(this.props.folderName),displayDate:this.props.eventToRewindTo.confirmationCardDate,previousVersion:!1}),t.React$1.createElement("div",{className:"rewind-confirmation-explanation"},t.React$1.createElement(s.Text,null,n.intl.formatMessage({id:"74EU+T",defaultMessage:"Your files and folders will look like they did before {date} at {time}."},{date:this.props.eventToRewindTo.formattedDate,time:this.props.eventToRewindTo.timeAgo})," "),t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:this.goToHelp},n.intl.formatMessage({id:"qLPTw+",defaultMessage:"How Rewind works"})," ")),this.getThirdPartyProvidersMessage(),t.React$1.createElement("div",{className:"rewind-confirmation-buttons"},t.React$1.createElement(s.Button,{variant:"primary",className:"rewind-confirmation-buttons__button",onClick:this.clickSendBack},n.intl.formatMessage({id:"rF8YNu",defaultMessage:"Rewind"})),t.React$1.createElement(s.Button,{variant:"transparent",onClick:this.clickCancel,className:"cancel"},n.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))))}}Mr.displayName="RewindConfirmationPage";class Nr extends t.React$1.Component{constructor(){super(...arguments),this.clickContactSupport=()=>{s.open_tab("https://www.dropbox.com/support")},this.navigateToHelp=e=>{const{user:t,restoreId:i}=this.props;a.clickHelp({user:t,restoreId:i,helpStep:e}),s.unsafe_open_tab("https://help.dropbox.com/security/rewind#after")},this.goToHelpProgressPage=()=>{this.navigateToHelp(a.DeloreanPage.progress)},this.goToHelpCompletionPage=()=>{this.navigateToHelp(a.DeloreanPage.completion)}}showSuccess(e){const{user:t,restoreId:s}=this.props;this.props.dispatch({type:a.DeloreanActionType.setRewindComplete}),a.loadCompletionSuccess({user:t,restoreId:s,startTs:e})}showFailure(e){const{user:i,restoreId:o}=this.props;a.loadCompletionFailure({user:i,restoreId:o,startTs:e}),s.Snackbar.show(t.React$1.createElement(s.Snackbar,{closeButtonText:n.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:n.intl.formatMessage({id:"SDLkWB",defaultMessage:"Contact us"}),onActionClick:this.clickContactSupport,title:n.intl.formatMessage({id:"EKgeAS",defaultMessage:"Couldn’t rewind this folder. Try again or let us help"}),variant:"fail"})),this.props.closePanel({closedByClick:!1})}componentDidMount(){const{user:e,restoreId:t}=this.props,s=Date.now();this.props.dispatch({type:a.DeloreanActionType.setRewindInProgress}),a.loadProgress({user:e,restoreId:t});const i=setInterval((()=>p.__awaiter(this,void 0,void 0,(function*(){const e=yield a.getRewindStatus({id:this.props.page.rewindId,user:this.props.user});"successful"===e.status[".tag"]&&(clearInterval(i),this.showSuccess(s)),"failed"===e.status[".tag"]&&(clearInterval(i),this.showFailure(s))}))),a.LOADING_PAGE_POLLING_LENGTH_MS)}render(){return this.props.rewindState===a.RewindState.Done?t.React$1.createElement(Ir,{page:this.props.page,goToHelpCompletionPage:this.goToHelpCompletionPage}):this.props.rewindState===a.RewindState.InProgress?t.React$1.createElement(Dr,{page:this.props.page,goToHelpProgressPage:this.goToHelpProgressPage,folderName:this.props.folderName}):a.assertNever(this.props.rewindState)}}Nr.displayName="RewindStarted";const Dr=e=>t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement("div",{className:"rewind-interstitial-holder"},t.React$1.createElement(s.Interstitial,{onComplete:()=>{},in:!0,isIndeterminate:!0})),t.React$1.createElement("div",{className:"rewind-confirmation-header"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},n.intl.formatMessage({id:"on0Nju",defaultMessage:"Rewinding to an earlier time…"},{folder_name:e.folderName}))),t.React$1.createElement("div",{className:"rewind-confirmation-text"},t.React$1.createElement("div",null,t.React$1.createElement(s.Text,{color:"faint"},n.intl.formatMessage({id:"bDOcv2",defaultMessage:"Everything will soon be like it was before {date} at {time}. Don’t make any changes here until it’s done."},{date:e.page.selectedEvent.formattedDate,time:e.page.selectedEvent.timeAgo}))),t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:e.goToHelpProgressPage},n.intl.formatMessage({id:"sGoZLi",defaultMessage:"What to do after rewinding"})))),Ir=e=>t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement(s.Image,{className:"rewind-finished-img",src:t.static_url("/static/metaserver/static/images/delorean/illo-rewind-complete@1x-vflVS_j1t.png"),alt:""}),t.React$1.createElement("div",{className:"rewind-confirmation-header"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},n.intl.formatMessage({id:"zJta6Y",defaultMessage:"Welcome back to {date} at {time}"},{date:e.page.selectedEvent.formattedDate,time:e.page.selectedEvent.timeAgo}))),t.React$1.createElement("div",{className:"rewind-confirmation-text"},t.React$1.createElement(s.Text,{color:"faint"},n.intl.formatMessage({id:"vXeDf5",defaultMessage:"You can use dropbox.com now, but wait for your devices to finish syncing. If anything doesn’t look like you expected, <options>learn more about your options</options>"},{div:e=>t.React$1.createElement("div",null,e),options:i=>t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:e.goToHelpCompletionPage},i)}))));class Cr extends t.React$1.PureComponent{constructor(){super(...arguments),this.onClick=()=>{a.clickUpsell({user:this.props.user,restoreId:this.props.restoreId}),s.open_tab("https://www.dropbox.com/plus?_tk=rewind_panel_upgrade")},this.goToHelpCenter=()=>{a.clickUpsellHelp({user:this.props.user,restoreId:this.props.restoreId}),s.open_tab("https://help.dropbox.com/security/rewind")}}render(){return t.React$1.createElement("div",{className:"rewind-upsell"},t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement("div",{className:"rewind-upsell__image"},t.React$1.createElement(h.FilesOld2Spot,null)),t.React$1.createElement("div",{className:"rewind-text__title rewind-upsell__title"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},n.intl.formatMessage({id:"UjNP9a",defaultMessage:"Rewind to a previous time"}))),t.React$1.createElement("div",null,t.React$1.createElement(s.Text,{color:"faint"},n.intl.formatMessage({id:"W3Vpv5",defaultMessage:"When a lot goes wrong, Dropbox Rewind can help you undo it all. That way you can get back to the way things were."}))),t.React$1.createElement(s.Button,{variant:"primary",className:"rewind-upsell__button",onClick:this.onClick},n.intl.formatMessage({id:"PJ4sk8",defaultMessage:"Get Rewind"})),t.React$1.createElement(s.Button,{variant:"transparent",onClick:this.goToHelpCenter},n.intl.formatMessage({id:"ySR8HJ",defaultMessage:"How Rewind works"}))))}}Cr.displayName="RewindUpsellPage";const $r=e=>{const i=s.useSelector(s.currentBackup);switch(e.data.page){case a.RewindFlowPage.notVisible:return null;case a.RewindFlowPage.NUXPage:return t.React$1.createElement(hr,{versionHistoryLength:e.userVersionHistoryLength,user:e.user,restoreId:e.restorationsLoggingId,dispatch:e.dispatch});case a.RewindFlowPage.confirmationPage:return(s=>{var a,o;if(s.eventAboveDivider){const{browseContext:r,graphPage:n}=e;let c,l;return(null==r?void 0:r.currentMountPoint)&&(l=null===(a=null==i?void 0:i.thirdPartyProviders)||void 0===a?void 0:a[r.currentMountPoint]),c="loaded"===n.contents.type?n.contents.data:[],t.React$1.createElement(Mr,{user:e.user,fqpath:e.fqpath,eventToRewindTo:s.eventAboveDivider,folderName:e.folderName,dispatch:e.dispatch,page:s,graphPage:e.graphPage,restoreId:e.restorationsLoggingId,eventCounts:c,rootNsId:null!==(o=e.browseContext.rootNSID)&&void 0!==o?o:void 0,thirdPartyProviders:l})}return null})(e.data);case a.RewindFlowPage.graphPage:return o=e.data,t.React$1.createElement(kr,{user:e.user,fqpath:e.fqpath,page:o,dispatch:e.dispatch,events:e.events,restoreId:e.restorationsLoggingId,rootNsId:null!==(r=e.browseContext.rootNSID)&&void 0!==r?r:void 0});case a.RewindFlowPage.activityListPage:return(s=>{var i;return t.React$1.createElement(a.RewindActivityListPage,{dispatch:e.dispatch,user:e.user,fqpath:e.fqpath,events:e.events,selectedDateTsInMs:s.selectedDateTsInMs,restoreId:e.restorationsLoggingId,isForRewindFlow:!0,isInitialLoad:e.isInitialLoad,rootNsId:null!==(i=e.browseContext.rootNSID)&&void 0!==i?i:void 0})})(e.data);case a.RewindFlowPage.startedPage:return(s=>t.React$1.createElement(Nr,{user:e.user,folderName:e.folderName,page:s,dispatch:e.dispatch,rewindState:s.rewindState,restoreId:e.restorationsLoggingId,closePanel:e.closePanel}))(e.data);case a.RewindFlowPage.upsellPage:return e.data,t.React$1.createElement(Cr,{user:e.user,restoreId:e.restorationsLoggingId})}var o,r};$r.displayName="Rewind";class Tr extends t.React$1.Component{constructor(e){super(e),this.closeDrawer=({closedByClick:e=!1})=>{const{activePage:t,allPageData:s,user:o}=this.props,{restoreId:r}=this.state;this.props.closePanel(),e&&!this.haveLoggedCloseReason&&(a.exitDrawer({reason:a.DeloreanCloseReason.click_close,activePage:t,allPageData:s,restoreId:r,user:o}),this.haveLoggedCloseReason=!0),i.DBHistory.remove_query_param(a.REWIND_QUERY_PARAM)},this.onOpenPanel=()=>{const{user:e,browseContext:t,clickBrowseButtonTimestampMs:s,fromDesktopClient:i}=this.props,{restoreId:o}=this.state;this.initialize(),s&&(this.props.expFolderHistoryRollbacks?a.loadNUX({browseContext:t,user:e,restoreId:o,clickBrowseButtonTimestampMs:s,fromDesktopClient:i}):r.shouldShowRewindsUpsell(e)&&a.loadUpsell({browseContext:t,user:e,restoreId:o,clickBrowseButtonTimestampMs:s,fromDesktopClient:i}))},this.onClosePanel=()=>{const{activePage:e,allPageData:t,user:o}=this.props,{restoreId:r}=this.state;this.haveLoggedCloseReason||(a.exitDrawer({reason:i.DBHistory.get_url().startsWith("/home")?a.DeloreanCloseReason.browse_folder:a.DeloreanCloseReason.page_exit,activePage:e,allPageData:t,restoreId:r,user:o}),this.haveLoggedCloseReason=!0),this.setState({restoreId:s.RestorationStepsLogger.generate_restore_id(o.id)})},this.initialize=()=>{const{user:e,expFolderHistoryRollbacks:t}=this.props,s=t;this.haveLoggedCloseReason=!1,this.props.dispatch(a.initializeDeloreanAction({fqPath:this.props.browseContext.currentFQPath,user:this.props.user,openToRewind:s})),a.openActivityList({user:e,restoreId:this.state.restoreId}),this.props.dispatch(a.fetchEventsAction({user:this.props.user,fqpath:this.props.browseContext.currentFQPath,direction:a.PaginationDirection.past,timestampInSeconds:0,onlyRewindableEvents:!1,opTypeFilters:[],clearEventList:!1})),r.shouldShowRewindsUpsell(e)&&!this.props.expFolderHistoryRollbacks&&this.props.dispatch({type:a.DeloreanActionType.changeRewindPageToUpsell})},this.onClickOnEvent=()=>{const{user:e}=this.props,{restoreId:t}=this.state;a.clickOnActivityList({user:e,restoreId:t})},this.showMoreFuture=e=>{this.props.dispatch(a.showMoreAction({user:this.props.user,fqpath:this.props.browseContext.currentFQPath,futureCursor:e,direction:a.PaginationDirection.future,isForRewindFlow:!1,rootNsId:this.props.browseContext.rootNSID||void 0}))},this.showMorePast=e=>{this.props.dispatch(a.showMoreAction({user:this.props.user,fqpath:this.props.browseContext.currentFQPath,pastCursor:e,direction:a.PaginationDirection.past,isForRewindFlow:!1,rootNsId:this.props.browseContext.rootNSID||void 0}))},this.updateActiveTabId=e=>{"View"===e?this.props.dispatch({type:a.DeloreanActionType.changeRewindPageToNone}):this.props.dispatch({type:a.DeloreanActionType.changeRewindPageToNUXOrDayResolution})},this.state={restoreId:s.RestorationStepsLogger.generate_restore_id(e.user.id)},this.haveLoggedCloseReason=!0}componentDidMount(){window.addEventListener("beforeunload",(e=>{const{activePage:t,allPageData:s,user:i}=this.props,{restoreId:o}=this.state;this.props.isVisible&&!this.haveLoggedCloseReason&&(a.exitDrawer({reason:a.DeloreanCloseReason.page_exit,activePage:t,allPageData:s,restoreId:o,user:i}),this.haveLoggedCloseReason=!0)}))}renderContent(){return this.props.activePage===a.RewindFlowPage.notVisible||!r.shouldShowRewindsUpsell(this.props.user)&&!this.props.expFolderHistoryRollbacks?t.React$1.createElement(a.FolderHistory,{onClickEvent:this.onClickOnEvent,events:this.props.events,isForARewind:!1,isInitialLoad:this.props.isInitialLoad,onShowMoreFuture:this.showMoreFuture,onShowMorePast:this.showMorePast,selectedDateTsInMs:void 0}):this.props.activePage===a.RewindFlowPage.graphPage||this.props.activePage===a.RewindFlowPage.NUXPage||this.props.activePage===a.RewindFlowPage.activityListPage||this.props.activePage===a.RewindFlowPage.confirmationPage?t.React$1.createElement($r,{events:this.props.events,isInitialLoad:this.props.isInitialLoad,fqpath:this.props.fqpath,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,data:this.props.allPageData[this.props.activePage],graphPage:this.props.allPageData.graphPage,browseContext:this.props.browseContext,restorationsLoggingId:this.state.restoreId,closePanel:this.closeDrawer,userVersionHistoryLength:this.props.userVersionHistoryLength}):this.props.activePage===a.RewindFlowPage.startedPage?t.React$1.createElement(Nr,{page:this.props.allPageData.startedPage,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,rewindState:this.props.allPageData.startedPage.rewindState,restoreId:this.state.restoreId,closePanel:this.closeDrawer}):this.props.activePage===a.RewindFlowPage.upsellPage?t.React$1.createElement(Cr,{user:this.props.user,restoreId:this.state.restoreId}):a.assertNever(this.props.activePage)}render(){const e=s.classnames({delorean:!0,"delorean--visible":this.props.isVisible,"delorean--hidden":!this.props.isVisible});return t.React$1.createElement("div",{"aria-hidden":this.props.isVisible?"false":"true",className:e},t.React$1.createElement("div",{className:"rewind-header-wrapper"},t.React$1.createElement(o.RewindTitle,{folderDisplayName:s.getDisplayedFilename(this.props.folderDisplayName),expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,closePanel:this.closeDrawer,context:this.props.browseContext})),this.props.isVisible&&this.renderContent(),t.React$1.createElement(o.PanelOpenListener,{onOpenPanel:this.onOpenPanel,onClosePanel:this.onClosePanel,isVisible:this.props.isVisible,currentFQPath:this.props.fqpath,nextFQPath:this.props.browseContext.currentFQPath}))}}Tr.displayName="DeloreanInnerUnconnected";const Sr=s.connect((function(e){return{hasDismissedNUX:a.getHasDismissedNUX(e),isInitialLoad:a.getIsInitialLoad(e),events:a.getEvents(e),folderDisplayName:a.getFolderDisplayName(e),activePage:a.getActivePage(e),allPageData:a.getAllPageData(e),fqpath:a.getFQPath(e)}}))(Tr),Lr=s.requireCssWithComponent(Sr,["/static/metaserver/static/css/delorean/delorean-vflhckSBA.css"]),Fr=a.getDeloreanStore();class Hr extends t.React$1.Component{render(){return t.React$1.createElement(s.Provider,{store:Fr},t.React$1.createElement(Lr,{fromDesktopClient:this.props.fromDesktopClient,userVersionHistoryLength:this.props.userVersionHistoryLength,user:this.props.user,closePanel:this.props.close,browseContext:this.props.browseContext,isVisible:this.props.isVisible,expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,clickBrowseButtonTimestampMs:this.props.clickBrowseButtonTimestampMs}))}}Hr.displayName="RewindPanel",e.DeloreanInnerUnconnected=Tr,e.RewindPanel=Hr,e.RewindPanelInnerWithCss=Lr}));
//# sourceMappingURL=c_delorean.js-vflDAaWgE.map
