define(["exports","./c_tslib","./e_ui_page_files_router","./e_core_exception","metaserver/static/js/modules/constants/contacts","./c_react_query_api_helpers_helpers","./c_core_exception_info"],(function(e,t,r,o,s,n,a){"use strict";function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var c=i(s);const u=n.createCustomRequestQuery({requestMethod:"contacts:get",queryFn:({apiArg:e})=>({signal:o})=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=yield(new r.UserApiV2Client).ns("contacts").rpc("get",e,{subjectUserId:r.mustGetActiveUserId(),signal:o}),s=((null==t?void 0:t.uncompressed_server_contacts)||[]).filter((e=>!e.group_id&&!!e.account_id)).map(r.convertBasicContactResultToContact),n=new r.Bloodhound({datumTokenizer:r.ContactCommon.get_index_tokens,queryTokenizer:r.Bloodhound.tokenizers.whitespace,identify:r.ContactCommon.get_key,sorter:r.ContactCommon.sorter,local:[]});return n.add(s),n})),optionsFn:e=>Object.assign(Object.assign({},e),{cacheTime:1/0,staleTime:1/0})}),l=n.createCustomRequestQuery({requestMethod:"team:search_contacts",queryFn:({apiArg:e})=>()=>e.query?r.WebRequest({url:"/team/search_contacts",data:{query:JSON.stringify(e.query)},subject_user:r.mustGetActiveUserId()}).then((e=>JSON.parse(e).map((e=>new r.Contact(e))))):[],optionsFn:e=>Object.assign(Object.assign({},e),{cacheTime:1/0,staleTime:1/0})}),d={start_merge:!1,uncompressed:!0,use_bolt:!1,version:11},g=()=>!!c.MERGE_SEARCH_ALLOWED[r.mustGetActiveUserId()];e.formatPeopleSuggestionsForSuggestionsDropdown=(e,t)=>e.slice(0,3).map((e=>r.convertContactToPeopleSuggestion(e,t))),e.formatPeopleSuggestionsLoadingState=({isError:e,isLoading:t,isSuccess:o})=>e?r.PeopleSuggestionsLoadingState.FAILED:t?r.PeopleSuggestionsLoadingState.LOADING:o?r.PeopleSuggestionsLoadingState.LOADED:void 0,e.formatSuggestedPeopleForQuery=e=>e.slice(0,r.PEOPLE_FILTER_SEARCH_CAPACITY).map((e=>r.convertFilteredContactToSuggestedUser(e))),e.formatSuggestedUser=e=>e?r.convertFilteredContactToSuggestedUser(e):void 0,e.useContactsQueryBy=(e,s,n)=>{const i=g(),c=l.useQuery({apiArg:{query:e}},{enabled:s&&i},{perUseQueryFnWrapper:(e,s)=>t.__awaiter(void 0,void 0,void 0,(function*(){try{const t=yield e();return r.logPeopleFilterResponse(t.length),t}catch(e){const t=e.raw?new Error(e.raw.responseBody):e;throw o.reportException({err:t,tags:["js:search","search_bar","search_bar_people_suggestions","search_react_query"],severity:a.SEVERITY.NON_CRITICAL}),r.logPeopleFilterResponseFailed(),new Error(e)}}))}),p=u.useQuery({apiArg:d},{enabled:s&&!i},{perUseQueryFnWrapper:(e,s)=>t.__awaiter(void 0,void 0,void 0,(function*(){try{const t=yield e();return r.logPeopleFilterResponse(t.all().length),t}catch(e){const t=e.raw?new Error(e.raw.responseBody):e;throw o.reportException({err:t,tags:["js:search","search_bar","search_bar_people_suggestions","search_react_query"],severity:a.SEVERITY.NON_CRITICAL}),r.logPeopleFilterResponseFailed(),new Error(e)}}))});if(!s)return[p,[]];let _=[];if(i){const e=c.data;(null==e?void 0:e.length)&&(_=[...e]);return[c,_.slice(0,null!=n?n:3)]}{const t=p.data;e&&t&&t.search(e,(e=>{_=[...e]}));return[p,_.slice(0,null!=n?n:3)]}},e.useFilteredContactQuery=(e,t)=>{const r=g(),o=u.useQuery({apiArg:d},{enabled:t&&!r});if(!t||!e||r)return[o,void 0];let s;const n=o.data;if(n){s=n.all().find((t=>t.dbx_account_id===e))}return[o,s]}}));
//# sourceMappingURL=c_react_query_api_helpers_queries_contacts.js-vflPjx2vU.map
