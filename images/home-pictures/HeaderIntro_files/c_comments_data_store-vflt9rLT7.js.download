define(["exports","./e_edison","./e_ui_page_files_router","./c_ui-icon_line_comment","./c_api_v2_redux_files","./c_src_right-rail_hooks","./c_ui-icon_line_more-horizontal","./c_components_approval-forms_approval_request_modal","./c_components_approval-forms_approval_checkbox_in_share","./c_components_approval-forms_gating_utils","./c_core_i18n","./c_lodash-es_lodash","./c_tslib"],(function(e,t,n,a,o,s,i,r,c,d,l,m,u){"use strict";function p(t){return{type:e.Action$1.UpdateAnnotationMode,payload:{updatedAnnotationMode:t}}}e.Action$1=void 0,function(e){e.ActivateThread="@@comments/activateThread",e.ActivateInitialThread="@@comments/activateInitialThread",e.DeactivateAllThreads="@@comments/deactivateThread",e.FocusThread="@@comments/focusThread",e.HoverThread="@@comments/hoverThread",e.BoltSubscribe="@@comments/bolt/subscribe",e.BoltUnsubscribe="@@comments/bolt/unsubscribe",e.UpdateDraftAnnotation="@@comments/updateDraftAnnotation",e.ClearDraftAnnotation="@@comments/clearDraftAnnotation",e.FocusEditor="@@comments/focusEditor",e.EditorDidFocus="@@comments/editorDidFocus",e.ResolveNavigationToActiveThreadAnnotation="@@comments/resolveNavigationToActiveThreadAnnotation",e.UpdateShowResolvedComments="@@comments/updateShowResolvedComments",e.UpdateAnnotationMode="@@comments/UpdateCurrentAnnotationMode",e.StartAnnotating="@@comments/startAnnotating",e.ConfirmDraftAnnotation="@@comments/confirmDraftAnnotation",e.CancelAnnotating="@@comments/cancelAnnotating",e.AddAndCommitComment="@@comments/addAndCommitComment",e.EditAndCommitComment="@@comments/editAndCommitComment",e.DeleteAndCommitComment="@@comments/deleteAndCommitComment",e.DeleteAndCommitThread="@@comments/deleteAndCommitThread",e.SortComments="@@comments/sortComments",e.LogApprovalAction="@@comments.logApprovalAction",e.LogStartComment="@@comments.logStartComment",e.LogCancelComment="@@comments.logCancelComment"}(e.Action$1||(e.Action$1={}));const g=(e,t)=>t||e;var _,b;e.SectionAnnotationMode=void 0,(_=e.SectionAnnotationMode||(e.SectionAnnotationMode={})).continuous="continuous",_.single="single",function(e){e.ADD_COMMENT="add_comment",e.DELETE_COMMENT="delete_comment",e.REPLY_COMMENT="reply_comment",e.EDIT_COMMENT="edit_comment",e.RESOLVE_COMMENT="resolve_comment",e.UNRESOLVE_COMMENT="unresolve_comment",e.SUBSCRIBE_COMMENTS="subscribe_comments",e.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",e.DISABLE_COMMENTS="disable_comments",e.ENABLE_COMMENTS="enable_comments",e.SHOW_RESOLVED_COMMENTS="show_resolved_comments",e.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",e.SORT_COMMENTS="sort_comments",e.REQUEST_APPROVAL="request_approval",e.ENABLE_CONTINUOUS_ANNOTATIONS="enable_continuous_annotations",e.DISABLE_CONTINUOUS_ANNOTATIONS="disable_continuous_annotations",e.ADD_COMMENT_START="add_comment_start",e.ADD_COMMENT_CANCEL="add_comment_cancel",e.REPLY_COMMENT_START="reply_comment_start",e.REPLY_COMMENT_CANCEL="reply_comment_cancel",e.MARK_THREAD_READ="mark_thread_read",e.MARK_THREAD_UNREAD="mark_thread_unread"}(b||(b={}));const f=(e,t)=>{var n;const a=e.permissions[t],o=e.enableCommentStatus[t];return Boolean(null!==(n=null==o?void 0:o.commentsEnabled)&&void 0!==n?n:null==a?void 0:a.can_see_comment_editor)},v=t=>t.annotationSettings.mode===e.SectionAnnotationMode.single,h=(()=>{let e,t;const n=[];for(e=0,t=e;e<=255;e++,t=e)n.push((t+256).toString(16).substr(1));return n})();function A(e){return e.map((e=>h[e])).join("")}function C(){const e=function(){const e=new Uint8Array(16);return window.crypto&&window.crypto.getRandomValues(e),e}();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(A).join("-")}function y({content:e,threadId:t,author:n}){const a=new Date;return{id:C(),timestamp:a,threadId:t,author:n,content:e,userPermissions:{canDelete:!1,canEdit:!1},revisionInfo:{isCurrent:!0,timestamp:a}}}function O(e){return{type:{".tag":"file"},identifier:{".tag":"file_path_or_id",file_path_or_id:e}}}function R(e,t){return t?function(e){return{type:{".tag":"file"},identifier:{".tag":"shared_link_details",url:e}}}(t):O(e)}const I={AddComment:"@@apiv2_redux/comments2/add_comment",AddCommentResult:"@@apiv2_redux/comments2/add_comment_result",CheckOnboardingStatus:"@@apiv2_redux/comments2/check_onboarding_status",CheckOnboardingStatusResult:"@@apiv2_redux/comments2/check_onboarding_status_result",DeleteComment:"@@apiv2_redux/comments2/delete_comment",DeleteCommentResult:"@@apiv2_redux/comments2/delete_comment_result",DisableCommenting:"@@apiv2_redux/comments2/disable_commenting",DisableCommentingResult:"@@apiv2_redux/comments2/disable_commenting_result",EditComment:"@@apiv2_redux/comments2/edit_comment",EditCommentResult:"@@apiv2_redux/comments2/edit_comment_result",EnableCommenting:"@@apiv2_redux/comments2/enable_commenting",EnableCommentingResult:"@@apiv2_redux/comments2/enable_commenting_result",GetFolderLiveUpdatingInfo:"@@apiv2_redux/comments2/get_folder_live_updating_info",GetFolderLiveUpdatingInfoResult:"@@apiv2_redux/comments2/get_folder_live_updating_info_result",ListComments:"@@apiv2_redux/comments2/list_comments",ListCommentsResult:"@@apiv2_redux/comments2/list_comments_result",ListCommentsBatch:"@@apiv2_redux/comments2/list_comments_batch",ListCommentsBatchResult:"@@apiv2_redux/comments2/list_comments_batch_result",ListThreadsBatchPaginated:"@@apiv2_redux/comments2/list_threads_batch_paginated",ListThreadsBatchPaginatedResult:"@@apiv2_redux/comments2/list_threads_batch_paginated_result",ListThreadsPaginated:"@@apiv2_redux/comments2/list_threads_paginated",ListThreadsPaginatedResult:"@@apiv2_redux/comments2/list_threads_paginated_result",LogEvent:"@@apiv2_redux/comments2/log_event",LogEventResult:"@@apiv2_redux/comments2/log_event_result",LogPerfEvent:"@@apiv2_redux/comments2/log_perf_event",LogPerfEventResult:"@@apiv2_redux/comments2/log_perf_event_result",LoggedOutAddComment:"@@apiv2_redux/comments2/logged_out/add_comment",LoggedOutAddCommentResult:"@@apiv2_redux/comments2/logged_out/add_comment_result",LoggedOutListComments:"@@apiv2_redux/comments2/logged_out/list_comments",LoggedOutListCommentsResult:"@@apiv2_redux/comments2/logged_out/list_comments_result",MarkHasOnboarded:"@@apiv2_redux/comments2/mark_has_onboarded",MarkHasOnboardedResult:"@@apiv2_redux/comments2/mark_has_onboarded_result",MarkThreadRead:"@@apiv2_redux/comments2/mark_thread_read",MarkThreadReadResult:"@@apiv2_redux/comments2/mark_thread_read_result",MarkThreadUnread:"@@apiv2_redux/comments2/mark_thread_unread",MarkThreadUnreadResult:"@@apiv2_redux/comments2/mark_thread_unread_result",ResolveThread:"@@apiv2_redux/comments2/resolve_thread",ResolveThreadResult:"@@apiv2_redux/comments2/resolve_thread_result",Subscribe:"@@apiv2_redux/comments2/subscribe",SubscribeResult:"@@apiv2_redux/comments2/subscribe_result",UnresolveThread:"@@apiv2_redux/comments2/unresolve_thread",UnresolveThreadResult:"@@apiv2_redux/comments2/unresolve_thread_result",Unsubscribe:"@@apiv2_redux/comments2/unsubscribe",UnsubscribeResult:"@@apiv2_redux/comments2/unsubscribe_result"},T=o._createAction(I.AddComment),E=o._createAction(I.AddCommentResult),M=o._createAction(I.CheckOnboardingStatusResult),j=o._createAction(I.DeleteComment),S=o._createAction(I.DeleteCommentResult),L=o._createAction(I.DisableCommenting),k=o._createAction(I.DisableCommentingResult),w=o._createAction(I.EditComment),x=o._createAction(I.EditCommentResult),D=o._createAction(I.EnableCommenting),U=o._createAction(I.EnableCommentingResult),N=o._createAction(I.GetFolderLiveUpdatingInfoResult),$=o._createAction(I.ListComments),B=o._createAction(I.ListCommentsResult),V=o._createAction(I.ListCommentsBatchResult),F=o._createAction(I.ListThreadsBatchPaginatedResult),q=o._createAction(I.ListThreadsPaginatedResult),P=o._createAction(I.LogEvent),H=o._createAction(I.LogEventResult),W=o._createAction(I.LogPerfEventResult),Y=o._createAction(I.LoggedOutAddCommentResult),K=o._createAction(I.LoggedOutListComments),z=o._createAction(I.LoggedOutListCommentsResult),G=o._createAction(I.MarkHasOnboardedResult),Q=o._createAction(I.MarkThreadRead),X=o._createAction(I.MarkThreadReadResult),J=o._createAction(I.MarkThreadUnread),Z=o._createAction(I.MarkThreadUnreadResult),ee=o._createAction(I.ResolveThread),te=o._createAction(I.ResolveThreadResult),ne=o._createAction(I.Subscribe),ae=o._createAction(I.SubscribeResult),oe=o._createAction(I.UnresolveThread),se=o._createAction(I.UnresolveThreadResult),ie=o._createAction(I.Unsubscribe),re=o._createAction(I.UnsubscribeResult),ce={[I.AddComment]:{endpoint:"add_comment",action:E},[I.CheckOnboardingStatus]:{endpoint:"check_onboarding_status",action:M},[I.DeleteComment]:{endpoint:"delete_comment",action:S},[I.DisableCommenting]:{endpoint:"disable_commenting",action:k},[I.EditComment]:{endpoint:"edit_comment",action:x},[I.EnableCommenting]:{endpoint:"enable_commenting",action:U},[I.GetFolderLiveUpdatingInfo]:{endpoint:"get_folder_live_updating_info",action:N},[I.ListComments]:{endpoint:"list_comments",action:B},[I.ListCommentsBatch]:{endpoint:"list_comments_batch",action:V},[I.ListThreadsBatchPaginated]:{endpoint:"list_threads_batch_paginated",action:F},[I.ListThreadsPaginated]:{endpoint:"list_threads_paginated",action:q},[I.LogEvent]:{endpoint:"log_event",action:H},[I.LogPerfEvent]:{endpoint:"log_perf_event",action:W},[I.LoggedOutAddComment]:{endpoint:"logged_out/add_comment",action:Y},[I.LoggedOutListComments]:{endpoint:"logged_out/list_comments",action:z},[I.MarkHasOnboarded]:{endpoint:"mark_has_onboarded",action:G},[I.MarkThreadRead]:{endpoint:"mark_thread_read",action:X},[I.MarkThreadUnread]:{endpoint:"mark_thread_unread",action:Z},[I.ResolveThread]:{endpoint:"resolve_thread",action:te},[I.Subscribe]:{endpoint:"subscribe",action:ae},[I.UnresolveThread]:{endpoint:"unresolve_thread",action:se},[I.Unsubscribe]:{endpoint:"unsubscribe",action:re}},de=o._createMiddleware(ce),le="has_seen_continuous_annotation_feature";function me(){const[e,n]=t.React$1.useState((()=>null!==localStorage.getItem(le)));return[e,t.react.exports.useCallback((()=>{n(!0),window.localStorage.setItem(le,"true")}),[])]}const ue=n.defineMessage({id:"U75RtN",defaultMessage:"Hide resolved comments"}),pe=n.defineMessage({id:"fKXJUR",defaultMessage:"Show resolved comments"}),ge=n.defineMessage({id:"w904jy",defaultMessage:"Unsubscribe"}),_e=n.defineMessage({id:"cnLKs9",defaultMessage:"Subscribe"}),be=n.defineMessage({id:"/XlCxM",defaultMessage:"Disable comments"}),fe=n.defineMessage({id:"bppWf8",defaultMessage:"Enable comments"}),ve=n.defineMessage({id:"0GnzQS",defaultMessage:"Enable continuous commenting"}),he=n.defineMessage({id:"oCFihF",defaultMessage:"Disable continuous commenting"}),Ae=t.React$1.memo((({className:a,fileId:o,sharedLinkURL:s,size:c,approvalIOClient:l})=>{const m=n.useDispatch(),u=n.useIntl(),_=R(o,s),b=g(o,s),h=n.useSelector((e=>e.showResolvedComments)),A=n.useSelector((e=>{var t;return null===(t=e.permissions[b])||void 0===t?void 0:t.can_enable_commenting})),C=n.useSelector((e=>f(e,b))),y=n.useSelector((e=>{var t;return null===(t=e.permissions[b])||void 0===t?void 0:t.can_subscribe})),O=n.useSelector((e=>((e,t)=>{var n;const a=e.permissions[t],o=e.subscriptionStatus[t];return Boolean(null!==(n=null==o?void 0:o.isSubscribed)&&void 0!==n?n:null==a?void 0:a.is_subscribed)})(e,b))),I=n.useSelector((e=>v(e))),[T,E]=t.React$1.useState({showResolvedComments:h,inSingleAnnotatingMode:I}),M=t.react.exports.useCallback((()=>{m(function(t){return{type:e.Action$1.UpdateShowResolvedComments,payload:{showResolvedComments:t}}}(!h))}),[h]),j=t.react.exports.useCallback((()=>m(ne({arg:{stream:_}}))),[_]),S=t.react.exports.useCallback((()=>m(ie({arg:{stream:_}}))),[_]),k=t.react.exports.useCallback((()=>m(D({arg:{stream:_}}))),[_]),w=t.react.exports.useCallback((()=>m(L({arg:{stream:_}}))),[_]),x=t.react.exports.useCallback((()=>{var t,n;l&&l.logger.logRequestApprovalClick("comments_meatball_menu",o),m(r.setApprovalForm({[b]:{activeForm:"request",threadId:void 0}})),m((t="request_approval",n="comments_meatball",{type:e.Action$1.LogApprovalAction,payload:{action:t,context:n}}))}),[b,l]),[U,N]=me(),$=t.react.exports.useCallback((()=>{I?(m(p(e.SectionAnnotationMode.continuous)),U||N()):m(p(e.SectionAnnotationMode.single))}),[m,I]),B=t.React$1.useCallback((({isOpen:e})=>{e&&E({inSingleAnnotatingMode:I,showResolvedComments:h})}),[I,h]);if(!C&&!A)return null;const V=null==l?void 0:l.getUserExperiments(),F=V?V.flows_approval_flow_variant:"OFF",q=V?V.flows_approval_copy_experiment_variant:"OFF";return t.React$1.createElement(n.Menu.Wrapper,{className:a,onToggle:B},(({getContentProps:e,getTriggerProps:a})=>t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(n.IconButton,Object.assign({variant:"transparent"},a(),{size:c,"aria-label":u.formatMessage({id:"OD3YF0",defaultMessage:"Other actions"})}),t.React$1.createElement(n.UIIcon,{src:i.MoreHorizontalLine,size:c})),t.React$1.createElement(n.Menu.Content,Object.assign({},e()),t.React$1.createElement(n.Menu.Segment,null,t.React$1.createElement(n.Menu.ActionItem,{value:T.showResolvedComments?"hide-resolve-comments":"show-resolve-comments",onClick:M,disabled:!C},T.showResolvedComments?u.formatMessage(ue):u.formatMessage(pe)),y?t.React$1.createElement(n.Menu.ActionItem,{value:O?"unsubscribe":"subscribe",onClick:O?S:j,disabled:!C},O?u.formatMessage(ge):u.formatMessage(_e)):null,A?t.React$1.createElement(n.Menu.ActionItem,{value:O?"enableComments":"disableComments",onClick:C?w:k},C?u.formatMessage(be):u.formatMessage(fe)):null,d.isApprovalEnabled(F)&&t.React$1.createElement(n.Menu.ActionItem,{value:"requestApproval",onClick:x,withTitle:t.React$1.createElement(t.React$1.Fragment,null,u.formatMessage(d.approvalCopyExperimentString(q)),t.React$1.createElement(n.AccessoryBadge,{style:{marginLeft:4}},u.formatMessage({id:"VgsgAq",defaultMessage:"New"})))}),t.React$1.createElement(n.Menu.ActionItem,{onClick:$,disabled:!C},T.inSingleAnnotatingMode?u.formatMessage(ve):u.formatMessage(he)))))))}));Ae.displayName="CommentsMeatball";n.injectInternalStyle("typescript/component_libraries/files_components/src/blades/comments/component/index.module.out.css",(e=>"._base-comments-pane-blade_1gy19_1{height:100%}._base-comments-pane-blade_1gy19_1 ._sc-comment-stream_1gy19_5{width:100%}._base-comments-pane-blade_1gy19_1 ._sc-comment-stream-editor_1gy19_9{margin:4px 0 0}._base-comments-pane-blade_1gy19_1 ._sc-thread_1gy19_14{margin-left:0;margin-right:0}._base-comments-pane-blade_1gy19_1 ._sc-thread_1gy19_14._sc-thread_1gy19_14._sc-thread-editor-is-focused_1gy19_19{box-shadow:inset 0 0 0 3px var(--color__utility__focusring)}._comment-stream-meatball-icon_1gy19_23{align-self:center;padding:var(--spacing__unit--2) var(--spacing__unit--1) 0 0}._comments-blade-header-accessory-wrapper_1gy19_28{align-items:center;display:flex;flex-grow:1}._comments-blade-header-menu_1gy19_34{margin-left:auto}._comments-blade-loading-spinner-container_1gy19_38{align-items:center;display:flex;height:100%;justify-content:center}"));const Ce={baseCommentsPaneBlade:"_base-comments-pane-blade_1gy19_1",scCommentStream:"_sc-comment-stream_1gy19_5",scCommentStreamEditor:"_sc-comment-stream-editor_1gy19_9",scThread:"_sc-thread_1gy19_14",scThreadEditorIsFocused:"_sc-thread-editor-is-focused_1gy19_19",commentStreamMeatballIcon:"_comment-stream-meatball-icon_1gy19_23",commentsBladeHeaderAccessoryWrapper:"_comments-blade-header-accessory-wrapper_1gy19_28",commentsBladeHeaderMenu:"_comments-blade-header-menu_1gy19_34",commentsBladeLoadingSpinnerContainer:"_comments-blade-loading-spinner-container_1gy19_38"},ye=n.defineMessage({id:"5PJLxb",defaultMessage:"{unreadCount} unread"}),Oe=n.defineMessage({id:"ZKwnCD",defaultMessage:"An error occurred."}),Re=e=>n.useSelector((t=>e?((e,t)=>{const n=e.threads[t];return n?Object.values(n).filter((e=>!e.read&&e.comments.some((e=>!e.deleted)))).length:0})(t,e):0));class Ie extends t.react.exports.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){const{intl:e}=this.props;return this.state.hasError?t.react.exports.createElement(n.Text,null,e.formatMessage(Oe)):this.props.children}}Ie.displayName="CommentsBladeErrorBoundary";const Te=({fileId:e,sharedLinkURL:a,showOverflowMenu:o,approvalIOClient:s})=>{const i=Re(g(e,a)),r=n.useIntl();return t.react.exports.createElement("div",{className:Ce.commentsBladeHeaderAccessoryWrapper},i>0?t.react.exports.createElement("div",{className:"comments-blade-header-badge"},t.react.exports.createElement(n.NotificationBadge,{status:"attention"},r.formatMessage(ye,{unreadCount:i}))):null,o&&t.react.exports.createElement("div",{className:Ce.commentsBladeHeaderMenu},t.react.exports.createElement(Ae,{fileId:e,sharedLinkURL:a,size:"small",approvalIOClient:s})))};Te.displayName="CommentsBladeRightAccessory";const Ee=({id:e,intl:i,children:r,fileId:c,sharedLinkURL:d,approvalIOClient:m})=>{const u=s.useIsExpanded(e);return t.react.exports.createElement(l.Provider,{value:i},t.react.exports.createElement(o.RightRail.Blade,{withTitle:i.formatMessage({id:"TxGYML",defaultMessage:"Comments"}),withIcon:t.react.exports.createElement(n.UIIcon,{src:a.CommentLine}),id:e,withTitleRightAccessory:t.react.exports.createElement(Te,{fileId:c,sharedLinkURL:d,showOverflowMenu:u,approvalIOClient:m}),headerTooltipDataAttribute:"right-rail-comments-blade-header"},t.react.exports.createElement(Ie,{intl:i},r)))};Ee.displayName="CommentsBlade";const Me=({id:e,intl:s,fileId:i,sharedLinkURL:r})=>{const c=Re(i?g(i,r):void 0);return t.react.exports.createElement(o.RightRail.CollapsedBladeIcon,{id:e,withIcon:t.react.exports.createElement(n.UIIcon,{src:a.CommentLine,"aria-label":s.formatMessage({id:"JrjHYo",defaultMessage:"Open comments panel"})}),tooltip:s.formatMessage({id:"GSZlCi",defaultMessage:"Comments"}),withNotificationBadge:c,buttonTooltipDataAttribute:"right-rail-comments-blade-collapsed"})};Me.displayName="CollapsedCommentsBladeButton";const je=e=>{for(const t of e)if("approval"===t.type)return t},Se=e=>!!je(e.comments[e.comments.length-1].content.metadata),Le=e=>{const t=je(e.comments[e.comments.length-1].content.metadata),n=null==t?void 0:t.approvers,a=null==t?void 0:t.requires_all;let o=0;if(!n)return 0;for(const e of n)if("approved"!==e.overall_status)o++;else if(!a)return 0;return a?o:1},ke="@@apiv2_redux/stickers/get_stickers",we="@@apiv2_redux/stickers/get_stickers_result",xe=o._createAction(ke),De={[ke]:{endpoint:"get_stickers",action:o._createAction(we)}},Ue=o._createMiddleware(De);var Ne;function $e(e){return({dispatch:t})=>n=>a=>{let o=n(a);if(a.type===Ne.SearchContacts){const n=e();try{n.search(a.payload,(e=>{var n;t((n={query:a.payload,result:e[a.payload]},{type:Ne.SearchContactsResult,payload:n}))}))}catch(e){}}else a.type===Ne.WarmContacts&&e();return o}}function Be(e,t){return e[".tag"]===t}function Ve(e){if(Be(e,"video"))return{type:"video",time:e.time||0,timeSec:e.time_sec||0};if(Be(e,"audio"))return{type:"audio",time:e.time};if(Be(e,"document"))return{type:"document",regionType:e.region_type[".tag"],label:e.label,regions:e.regions};if(Be(e,"image"))return{type:"image",region:e.region,label:e.label};throw new Error("Attempted to convert an annotation type that does not yet exist.")}function Fe(e){return"video"===e.type?{".tag":"video",time:e.time,time_sec:e.timeSec}:"audio"===e.type?{".tag":"audio",time:e.time}:"document"===e.type?{".tag":"document",regions:e.regions,region_type:{".tag":e.regionType}}:{".tag":"image",region:Object.assign(Object.assign({},e.region),{page:1})}}function qe(e,t){return e.type===t}function Pe(e){return qe(e,"mention")}function He(e){return qe(e,"style")}function We(e){return qe(e,"sticker")}function Ye(e){return qe(e,"guest")}function Ke(e){return qe(e,"reel")}function ze(e){return qe(e,"hyperlink")}function Ge(e){const t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function Qe(e){const t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');const n={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:n}}function Xe(e){if(e.url&&e.location)return{location:e.location,type:"hyperlink",url:e.url}}function Je(e){const t=[...e.formatting.map(Ge),...e.mentions.map(Qe)];if(e.sticker){const n=function(e){if(e.url&&e.name&&e.description)return{type:"sticker",id:e.id,url:e.url,name:e.name,description:e.description}}(e.sticker);n&&t.push(n)}if(e.guest){const n=function(e){if(e.first_name||e.last_name)return{type:"guest",first_name:e.first_name,last_name:e.last_name}}(e.guest);n&&t.push(n)}if(e.reel){const n=function(e){if(e.annotation_data)return{type:"reel",annotation_data:e.annotation_data}}(e.reel);n&&t.push(n)}if(e.approval){const n=function(e){var t,n,a;if(e.status&&e.approvers&&e.requester_email)return{type:"approval",status:e.status[".tag"],requester_email:e.requester_email,approval_type:null===(t=e.approval_type)||void 0===t?void 0:t[".tag"],actor:null===(n=e.actor)||void 0===n?void 0:n[".tag"],approvers:null===(a=e.approvers)||void 0===a?void 0:a.map((e=>{var t;return{email:e.email,display_name:e.display_name,overall_status:null===(t=e.overall_status)||void 0===t?void 0:t[".tag"]}})),requires_all:e.requires_all}}(e.approval);n&&t.push(n)}if(e.hyperlinks){const n=e.hyperlinks.map(Xe);for(let e of n)e&&ze(e)&&t.push(e)}return t}function Ze(e){const t=e.filter(He).map((e=>({format:{".tag":e.style},location:e.location}))),n=e.filter(Pe).map((e=>({user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}))),a=e.find(We),o=a?{id:a.id}:void 0,s=e.find(Ye),i=s?{first_name:s.first_name,last_name:s.last_name}:void 0,r=e.find(Ke);return{formatting:t,mentions:n,sticker:o,guest:i,reel:r?{annotation_data:r.annotation_data}:void 0,hyperlinks:e.filter(ze).map((e=>({url:e.url,location:e.location})))}}function et(e,t){const n=t.timestamp?new Date(t.timestamp):void 0;return{isCurrent:e.ns_id===t.ns_id&&e.sjid===t.sjid,revision:{nsId:t.ns_id,sjId:t.sjid},timestamp:n}}function tt(e){return e&&"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function nt(e,t){if("resolved_no_details"===e[".tag"])return{type:"no_details"};if(function(e){return"resolved_with_details"===e[".tag"]}(e))return{type:"with_details",resolver:t[e.resolver_id],resolvedTimestamp:new Date(e.resolved_timestamp)};throw new Error("Not a valid type for ResolvedInfo.")}function at(e,t,n){const a=e.comments.map((a=>function(e,t,n,a){return{author:n[e.author_id],content:{metadata:Je(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),revisionInfo:a&&e.revision?et(a,e.revision):{isCurrent:!0},userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}(a,e.id,t,n))),o=e.resolved_info?{resolved:!0,resolvedInfo:nt(e.resolved_info,t)}:{resolved:!1};return Object.assign(Object.assign({annotation:e.annotation_data?Ve(e.annotation_data):void 0,comments:a,id:e.id,read:e.read,readonly:e.readonly,isThirdParty:e.is_third_party},o),{timestamp:a[0].timestamp})}function ot(e,t,n){const a=e.map((e=>at(e,t,n)));return m.keyBy(a,"id")}function st(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}function it(e){const t=e.map(st);return m.keyBy(t,"id")}!function(e){e.WarmContacts="@@contacts/warm",e.SearchContacts="@@contacts/search",e.SearchContactsResult="@@contacts/searchResult"}(Ne||(Ne={}));const rt="@@apiv2_redux/media_addon/get_features",ct="@@apiv2_redux/media_addon/get_features_result",dt=o._createAction(ct),lt={[rt]:{endpoint:"get_features",action:dt}},mt=o._createMiddleware(lt);var ut;e.Status=void 0,(ut=e.Status||(e.Status={}))[ut.Disabled=0]="Disabled",ut[ut.ReadOnly=1]="ReadOnly",ut[ut.FullyEnabled=2]="FullyEnabled";const pt={},gt={fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},_t={},bt={},ft={currentQuery:"",result:[]},vt={},ht={},At={},Ct={},yt={},Ot={},Rt={},It={},Tt=!1,Et={state:null,mode:e.SectionAnnotationMode.single},Mt=null,jt=e=>{const{payload:{arg:{stream:t}}}=e;return St(t)};function St(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function Lt(e){const{stream:t,id:n}=e.payload.arg;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:n}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:n}:{}}function kt(e){var t;const{payload:{arg:{id:n,stream:{identifier:a}}}}=e,o=null===(t=e.meta)||void 0===t?void 0:t.threadId;return"file_path_or_id"===a[".tag"]?{fileIdOrUrl:a.file_path_or_id,commentId:n,threadId:o}:"shared_link_details"===a[".tag"]?{fileIdOrUrl:a.url,commentId:n,threadId:o}:{}}function wt(e,t,n,a){return Object.assign(Object.assign({},e),{[t]:n,pending:{action:a,originalValue:e[t],pendingValue:n}})}function xt(e,t,n,a,o){const{comments:s}=e,i=s.findIndex((e=>e.id===t)),r=s[i];if(!r)return e;const c=Object.assign(Object.assign({},r),{[n]:a}),d=[...s];return d.splice(i,1,c),wt(e,"comments",d,o)}function Dt(e,t,n){return Object.assign(Object.assign({},e),{[t]:n?e.pending.originalValue:e[t],pending:void 0})}const Ut={boltInfo:(e=gt,t)=>{if(t.type===I.ListCommentsResult){const{payload:{arg:n,result:a}}=t,o=St(n.stream);if(o&&a)return{fileIdentifierToBoltMap:Object.assign(Object.assign({},e.fileIdentifierToBoltMap),{[o]:a.bolt_info}),boltUniqueIdToStream:Object.assign(Object.assign({},e.boltUniqueIdToStream),{[a.bolt_info.unique_id]:n.stream})}}return e},threads:(t=pt,n)=>{const a=!!n.error;switch(n.type){case I.AddComment:return Nt(t,n);case I.AddCommentResult:return $t(t,n,a);case I.MarkThreadRead:case I.MarkThreadUnread:return Bt(t,n);case I.MarkThreadReadResult:case I.MarkThreadUnreadResult:return Vt(t,n,a);case I.ResolveThread:case I.UnresolveThread:return Ft(t,n);case I.ResolveThreadResult:case I.UnresolveThreadResult:return qt(t,n,a);case I.EditComment:return Pt(t,n);case I.EditCommentResult:return Ht(t,n,a);case I.DeleteComment:return Wt(t,n);case I.DeleteCommentResult:return Yt(t,n,a);case I.ListCommentsResult:case I.LoggedOutListCommentsResult:return Kt(t,n);case e.Action$1.AddAndCommitComment:return Jt(t,n);case e.Action$1.EditAndCommitComment:return Xt(t,n);case e.Action$1.DeleteAndCommitComment:return Zt(t,n);case e.Action$1.DeleteAndCommitThread:return en(t,n);default:return t}},supportedEnhancements:(e={},t)=>{var n;if(t.type===I.ListCommentsResult){const{payload:{arg:a,result:o}}=t,s=St(a.stream);if(null!=s&&null!=o)return Object.assign(Object.assign({},e),{[s]:null!==(n=o.supported_enhancements)&&void 0!==n?n:{}})}return e},activeThreadID:(t=_t,n)=>{switch(n.type){case e.Action$1.ActivateThread:case e.Action$1.ActivateInitialThread:return Object.assign(Object.assign({},t),{[n.payload.fileViewerId]:n.payload.threadId});case e.Action$1.DeactivateAllThreads:return Object.assign(Object.assign({},t),{[n.payload.fileViewerId]:""});case I.AddComment:if(n.meta&&n.meta.tempThreadId)return Object.assign(Object.assign({},t),{[n.meta.fileViewerId]:n.meta.tempThreadId});break;case I.AddCommentResult:const{meta:a,payload:{result:o}}=n;if(o&&a&&a.tempThreadId===t[a.fileViewerId])return Object.assign(Object.assign({},t),{[a.fileViewerId]:o.id})}return t},focusedThreadID:(t=bt,{type:n,payload:a})=>{if(n===e.Action$1.FocusThread){const e=Object.assign({},t);return null==a.threadId?delete e[a.fileViewerId]:e[a.fileViewerId]=a.threadId,e}return t},hoverThreadID:(t=bt,{type:n,payload:a})=>{if(n===e.Action$1.HoverThread){const e=Object.assign({},t);return null==a.threadId?delete e[a.fileViewerId]:e[a.fileViewerId]=a.threadId,e}return t},mentionsSearchResult:(e=ft,t)=>{switch(t.type){case Ne.SearchContacts:return Object.assign(Object.assign({},e),{currentQuery:t.payload});case Ne.SearchContactsResult:if(t.payload.query===e.currentQuery)return Object.assign(Object.assign({},e),{result:t.payload.result})}return e},permissions:(e=ht,t)=>{if(t.type!==I.ListCommentsResult&&t.type!==I.LoggedOutListCommentsResult)return e;const{payload:{arg:n,result:a}}=t,o=St(n.stream);if(!o||!a)return e;const s=a.permissions;return Object.assign(Object.assign({},e),{[o]:s})},draftAnnotation:(t=vt,n)=>{switch(n.type){case e.Action$1.UpdateDraftAnnotation:{const{fileViewerId:e,annotation:a}=n.payload;return a===t[e]?t:Object.assign(Object.assign({},t),{[e]:a})}case e.Action$1.CancelAnnotating:case e.Action$1.ClearDraftAnnotation:{const{fileViewerId:e}=n.payload;if(!(e in t))return t;const a=Object.assign({},t);return delete a[e],a}case I.AddComment:if(null!=n.meta){const{fileViewerId:e}=n.meta;if(!(e in t))return t;const a=Object.assign({},t);return delete a[e],a}}return t},annotationSettings:(t=Et,n)=>{var a;switch(n.type){case e.Action$1.CancelAnnotating:case I.DisableCommentingResult:return Object.assign(Object.assign({},t),{state:null});case I.AddComment:return t.mode===e.SectionAnnotationMode.single?Object.assign(Object.assign({},t),{state:null}):Object.assign(Object.assign({},t),{state:"annotating"});case e.Action$1.ActivateThread:case e.Action$1.ActivateInitialThread:return null===t.state?Object.assign(Object.assign({},t),{state:"viewing"}):"viewing"!==t.state?Object.assign(Object.assign({},t),{state:null}):t;case e.Action$1.DeactivateAllThreads:return"viewing"===t.state?Object.assign(Object.assign({},t),{state:null}):t;case e.Action$1.StartAnnotating:return n.payload.accessible?Object.assign(Object.assign({},t),{state:"annotating-ax"}):Object.assign(Object.assign({},t),{state:"annotating"});case e.Action$1.UpdateAnnotationMode:return"continuous"===n.payload.updatedAnnotationMode?{mode:n.payload.updatedAnnotationMode,state:null!==(a=t.state)&&void 0!==a?a:"annotating"}:{mode:n.payload.updatedAnnotationMode,state:null};case e.Action$1.ConfirmDraftAnnotation:return Object.assign(Object.assign({},t),{state:"commenting"})}return t},editorFocusRequest:(t=At,{type:n,payload:a})=>{if(n===e.Action$1.ConfirmDraftAnnotation&&!t[a.fileViewerId])return Object.assign(Object.assign({},t),{[a.fileViewerId]:!0});if(n===e.Action$1.FocusEditor&&!t[a.fileViewerId])return Object.assign(Object.assign({},t),{[a.fileViewerId]:!0});if(n===e.Action$1.EditorDidFocus&&t[a.fileViewerId]){const e=Object.assign({},t);return delete e[a.fileViewerId],e}return t},pendingNavigationToActiveThreadAnnotation:(t=Ct,{type:n,payload:a})=>{if(n===e.Action$1.ActivateThread||n===e.Action$1.ActivateInitialThread)return Object.assign({[a.fileViewerId]:!0},t);if(n===e.Action$1.ResolveNavigationToActiveThreadAnnotation){const e=Object.assign({},t);return delete e[a.fileViewerId],e}return t},status:(t=yt,n)=>{if(n.type===I.ListCommentsResult){const{payload:{arg:a,result:o}}=n,s=St(a.stream);if(s&&o)switch(o.status[".tag"]){case"disabled":return Object.assign(Object.assign({},t),{[s]:e.Status.Disabled});case"enabled":return Object.assign(Object.assign({},t),{[s]:e.Status.FullyEnabled});case"readonly":return Object.assign(Object.assign({},t),{[s]:e.Status.ReadOnly})}}if(n.type===I.LoggedOutListCommentsResult){const{payload:{arg:a}}=n,o=St(a.stream);if(o)return Object.assign(Object.assign({},t),{[o]:e.Status.FullyEnabled})}return t},thirdPartySource:(e=Ot,t)=>{if(t.type!==I.ListCommentsResult)return e;const{payload:{arg:n,result:a}}=t,o=St(n.stream);if(!o||!a)return e;const s=a.supported_enhancements&&a.supported_enhancements.third_party_source;return Object.assign(Object.assign({},e),{[o]:s?(i=s,i[".tag"]):void 0});var i},mediaAddonFeatures:(e=null,t)=>{var n;return t.type===ct?null!==(n=t.payload.result)&&void 0!==n?n:null:e},subscriptionStatus:(e=Rt,t)=>{if(t.type!==I.SubscribeResult&&t.type!==I.UnsubscribeResult)return e;const n=jt(t);if(void 0===n)return e;switch(t.type){case I.SubscribeResult:return Object.assign(Object.assign({},e),{[n]:{isSubscribed:!0,canSubscribe:!0}});case I.UnsubscribeResult:return Object.assign(Object.assign({},e),{[n]:{isSubscribed:!1,canSubscribe:!0}});default:return e}},enableCommentStatus:(e=It,t)=>{var n;if(t.type!==I.EnableCommentingResult&&t.type!==I.DisableCommentingResult&&t.type!==I.ListCommentsResult&&t.type!==I.LoggedOutListCommentsResult)return e;const a=jt(t);if(void 0===a)return e;switch(t.type){case I.EnableCommentingResult:return Object.assign(Object.assign({},e),{[a]:{commentsEnabled:!0,canEnableCommenting:!0}});case I.DisableCommentingResult:return Object.assign(Object.assign({},e),{[a]:{commentsEnabled:!1,canEnableCommenting:!0}});case I.ListCommentsResult:case I.LoggedOutListCommentsResult:const o=t.payload.result;return o?Object.assign(Object.assign({},e),{[a]:{commentsEnabled:!("disabled"===o.status[".tag"]),canEnableCommenting:!!(null===(n=o.permissions)||void 0===n?void 0:n.can_enable_commenting)}}):e;default:return e}},showResolvedComments:(t=Tt,n)=>n.type===e.Action$1.UpdateShowResolvedComments?n.payload.showResolvedComments:t,approvalFormStatus:r.approvalReducer,stickerPacks:(e=Mt,t)=>{var n,a,o;return t.type===we?null!==(o=null===(a=null===(n=t.payload.result)||void 0===n?void 0:n.sticker_sets)||void 0===a?void 0:a.map((e=>Object.assign(Object.assign({},e),{id:e.set_id}))))&&void 0!==o?o:null:e}},Nt=(e,t)=>{const{payload:{arg:{thread_id:n,stream:a}}}=t,o=St(a);if(!o||!t.meta)return e;const s=e[o],{content:i,author:r,annotation:c}=t.meta;if(n){const a=s[n],{comments:d}=a,l=Object.assign(Object.assign({},a),{comments:[...d,y({content:i,threadId:n,author:r})],annotation:c||a.annotation});return Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},s),{[n]:Object.assign(Object.assign({},l),{pending:{action:t.type,originalValue:a,newValue:l}})})})}const{tempThreadId:d}=t.meta;if(d){const n=y({threadId:d,author:r,content:i}),a={id:d,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[n],annotation:c,isThirdParty:!1},l=Object.assign(Object.assign({},a),{pending:{action:t.type,originalValue:void 0,pendingValue:a}});return Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},s),{[d]:l})})}return e},$t=(e,t,n)=>{const{payload:{arg:{thread_id:a,stream:o}}}=t,s=St(o);if(!s||!t.meta)return e;const i=e[s];if(a){const t=Object.assign({},i[a]),{originalValue:o}=t.pending;return t.pending=void 0,Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},i),{[a]:n?o:t})})}const{tempThreadId:r}=t.meta;let c=i;if(!n&&r in i&&t.payload.result){c=Object.assign({},i),delete c[r];const e=i[r],{id:n}=t.payload.result;e.readonly=!1,e.id=n,c[n]=Object.assign(Object.assign({},e),{pending:void 0})}return Object.assign(Object.assign({},e),{[s]:c})},Bt=(e,t)=>{const{fileIdOrUrl:n,threadId:a}=Lt(t);if(!n||!a)return e;const o=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},o),{[a]:wt(o[a],"read",t.type===I.MarkThreadRead,t.type)})})},Vt=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o}=Lt(t);if(!a||!o)return e;const s=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[o]:Dt(s[o],"read",n)})})},Ft=(e,t)=>{const{fileIdOrUrl:n,threadId:a}=Lt(t);if(!n||!a)return e;const o=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},o),{[a]:wt(o[a],"resolved",t.type===I.ResolveThread,t.type)})})},qt=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o}=Lt(t);if(!a||!o)return e;const s=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[o]:Dt(s[o],"resolved",n)})})},Pt=(e,t)=>{const{fileIdOrUrl:n,threadId:a,commentId:o}=kt(t);if(!(n&&a&&o&&t.meta))return e;const s=e[n],{content:i}=t.meta;return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},s),{[a]:xt(s[a],o,"content",i,t.type)})})},Ht=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o,commentId:s}=kt(t);if(!a||!o||!s)return e;const i=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},i),{[o]:Dt(i[o],"comments",n)})})},Wt=(e,t)=>{const{fileIdOrUrl:n,threadId:a,commentId:o}=kt(t);if(!n||!a||!o)return e;const s=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},s),{[a]:xt(s[a],o,"deleted",!0,t.type)})})},Yt=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o,commentId:s}=kt(t);if(!a||!o||!s)return e;const i=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},i),{[o]:Dt(i[o],"comments",n)})})},Kt=(e,t)=>{const{payload:{arg:n,result:a}}=t,o=St(n.stream);return o&&a?Object.assign(Object.assign({},e),{[o]:ot(a.threads,it(a.users))}):e},zt=n.combineReducers(Ut);function Gt(e,t,n){return Object.assign(Object.assign({},e),{[t]:n})}function Qt(e,t,n,a){const{comments:o}=e,s=o.findIndex((e=>e.id===t)),i=o[s];if(!i)return e;const r=Object.assign(Object.assign({},i),{[n]:a}),c=[...o];return c.splice(s,1,r),Gt(e,"comments",c)}const Xt=(e,t)=>{const{payload:{content:n,threadId:a,fileIdentifier:o,commentId:s}}=t,i=e[o],r=i[a];return r?Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},i),{[a]:Qt(r,s,"content",n)})}):e},Jt=(e,t)=>{const{payload:{author:n,content:a,threadId:o,fileIdentifier:s}}=t,i=e[s];if(o){const t=i[o];if(!t)return e;const{comments:r}=t,c=Object.assign(Object.assign({},t),{comments:[...r,y({content:a,threadId:o,author:n})]});return Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},i),{[o]:Object.assign({},c)})})}{const t=C(),o=y({threadId:t,author:n,content:a}),r={id:t,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[o],isThirdParty:!1};return Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},i),{[t]:r})})}},Zt=(e,t)=>{const{payload:{threadId:n,fileIdentifier:a,commentId:o}}=t;if(!a||!n||!o)return e;const s=e[a],i=s[n];return i?Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[n]:Qt(i,o,"deleted",!0)})}):e},en=(e,t)=>{const{payload:{threadId:n,fileIdentifier:a}}=t;if(!a||!n)return e;const o=e[a],s=o[n];return s?Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},o),{[n]:Gt(s,"comments",s.comments.map((e=>Object.assign(Object.assign({},e),{deleted:!0}))))})}):e};const tn=e=>{if(!e)return!1;if("document"===e.type&&"rectangle"===e.regionType&&1===e.regions.length){const t=e.regions[0];if(0===t.x&&0===t.y&&1===t.height&&1===t.width)return!1}return!0};e.Action=I,e.CollapsedCommentsBladeButton=Me,e.CommentsBlade=Ee,e.CommentsMeatball=Ae,e.activateInitialThread=function(t){return{type:e.Action$1.ActivateInitialThread,payload:t}},e.activateThread=function(t){return{type:e.Action$1.ActivateThread,payload:t}},e.addAndCommitComment=function(t,n,a,o){return{type:e.Action$1.AddAndCommitComment,payload:{author:t,content:a,fileIdentifier:n,threadId:o}}},e.addCommentAction=T,e.areCommentsEnabled=f,e.boltSubscribe=function(t){return{type:e.Action$1.BoltSubscribe,payload:t}},e.boltUnsubscribe=function(t){return{type:e.Action$1.BoltUnsubscribe,payload:t}},e.canRespondToApproval=e=>{const t=je(e.content.metadata);return"request"===(null==t?void 0:t.approval_type)&&"approver"===(null==t?void 0:t.actor)&&!e.userPermissions.canEdit&&!e.userPermissions.canDelete},e.cancelAnnotating=function(t){return{type:e.Action$1.CancelAnnotating,payload:{fileViewerId:t}}},e.classes=Ce,e.clearDraftAnnotation=function(t){return{type:e.Action$1.ClearDraftAnnotation,payload:{fileViewerId:t}}},e.confirmDraftAnnotation=function(t){return{type:e.Action$1.ConfirmDraftAnnotation,payload:{fileViewerId:t}}},e.createCommentFileIdentifier=g,e.createStreamFromFileId=O,e.createStreamFromFileOrSharedLink=R,e.deactivateAllThreads=function(t){return{type:e.Action$1.DeactivateAllThreads,payload:t}},e.deleteAndCommitComment=function(t,n,a,o){return{type:e.Action$1.DeleteAndCommitComment,payload:{author:t,fileIdentifier:n,threadId:a,commentId:o}}},e.deleteAndCommitThread=function(t,n,a){return{type:e.Action$1.DeleteAndCommitThread,payload:{author:t,fileIdentifier:n,threadId:a}}},e.deleteCommentAction=j,e.disableCommentingAction=L,e.editAndCommitComment=function(t,n,a,o,s){return{type:e.Action$1.EditAndCommitComment,payload:{author:t,content:s,fileIdentifier:n,threadId:a,commentId:o}}},e.editCommentAction=w,e.editorDidFocus=function(t){return{type:e.Action$1.EditorDidFocus,payload:{fileViewerId:t}}},e.enableCommentingAction=D,e.findActionableApprovalCommentId=e=>{const t=e.comments.filter((e=>!e.deleted)),n=je(t[0].content.metadata),a=null==n?void 0:n.actor;if("requester"===a){const e=t[t.length-1],n=je(e.content.metadata);if("request"===(null==n?void 0:n.approval_type))return e.id;for(let e=t.length-1;e>=0;e--){const n=t[e],a=je(n.content.metadata);if("request"===(null==a?void 0:a.approval_type))return;if("response"===(null==a?void 0:a.approval_type)&&"rejected"===(null==a?void 0:a.status))return n.id}}if("approver"===a)for(let e=t.length-1;e>=0;e--){const n=t[e],a=je(n.content.metadata),o=t[e].userPermissions.canEdit;if("request"===(null==a?void 0:a.approval_type))return n.id;if("response"===(null==a?void 0:a.approval_type)&&o)return n.id}},e.findCommentThread=function(e,t){for(const n of e){const e=n.comments;for(const a of e)if(a.id===t)return{comment:a,thread:n}}return null},e.focusEditor=function(t){return{type:e.Action$1.FocusEditor,payload:{fileViewerId:t}}},e.focusThread=function(t,n){return{type:e.Action$1.FocusThread,payload:{fileViewerId:t,threadId:n}}},e.getAnnotationType=(e,t)=>{var n;const a=e.threads[t],o=a?Object.values(a).find((e=>void 0!==e.annotation)):void 0;return null===(n=null==o?void 0:o.annotation)||void 0===n?void 0:n.type},e.getApprovalMetadata=je,e.getApprovalRequestCounts=e=>{let t=0,n=0;for(const a of e){const e=Le(a);0!==e&&(t+=e),Se(a)&&n++}return[t,n]},e.getApprovalRequestsSubtext=(e,t)=>t.formatMessage({id:"sj45d1",defaultMessage:"{openRequestsCount} {openRequestsCount, plural, one {approval request} other {approval requests}} open"},{openRequestsCount:e}),e.getApprovers=e=>{const t=je(e.comments[e.comments.length-1].content.metadata);return null==t?void 0:t.approvers},e.getFeaturesResultAction=dt,e.getStickersAction=xe,e.hoverThread=function(t,n){return{type:e.Action$1.HoverThread,payload:{fileViewerId:t,threadId:n}}},e.iCommentContentToUserSubmittedComment=function({annotation:e,content:t,stream:n}){return{annotation_data:e?Fe(e):void 0,content:t.text,metadata:Ze(t.metadata),revision:tt(n)}},e.isApprovalRequester=e=>{const t=je(e.comments[e.comments.length-1].content.metadata);return"requester"===(null==t?void 0:t.actor)},e.isApprovalThread=Se,e.isSingularlyAnnotating=v,e.listCommentsAction=$,e.logCancelComment=function(){return{type:e.Action$1.LogCancelComment,payload:{}}},e.logEventAction=P,e.logStartComment=function(){return{type:e.Action$1.LogStartComment,payload:{}}},e.loggedOutListCommentsAction=K,e.makeStore=function({apiv2ClientBase:t,boltIOClient:a,mentionsIOClient:s,logger:i},r){const c=[o.middleware(t.ns("files")),de(t.ns("comments2")),mt(t.ns("media_addon")),Ue(t.ns("stickers")),(d=a,({dispatch:t,getState:n})=>(d.onSignal((e=>{e.updatedChannels.filter((e=>"comments2"===e.channelId.appId)).map((e=>{const a=n().boltInfo.boltUniqueIdToStream[e.channelId.uniqueId];a&&t($({arg:{include_permissions:!0,stream:a}}))}))})),t=>n=>{switch(n.type){case e.Action$1.BoltSubscribe:d.subscribe(n.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))));break;case e.Action$1.BoltUnsubscribe:d.unsubscribe(n.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))))}return t(n)})),({dispatch:t,getState:n})=>a=>o=>u.__awaiter(void 0,void 0,void 0,(function*(){const s=a(o);if(o.type===e.Action$1.ActivateThread||o.type===e.Action$1.ActivateInitialThread){const{threadId:e,fileId:a,sharedLinkURL:i}=o.payload,r=n().threads[g(a,i)];if(null==r)return s;const c=r[e];if(c&&!c.read&&!c.readonly){const e=R(a,i);t(Q({arg:{id:c.id,stream:e}}))}}return s}))];var d;s&&c.push($e(s)),i&&c.push((t=>({getState:n})=>a=>o=>{var s,i;switch(o.type){case I.AddCommentResult:const a=Boolean(o.payload.arg.thread_id);t({event:a?b.REPLY_COMMENT:b.ADD_COMMENT,extra:{hasAnnotation:String(tn(null===(s=o.meta)||void 0===s?void 0:s.annotation)),annotationMode:n().annotationSettings.mode,isSticker:(!!(null===(i=o.payload.arg.comment.metadata)||void 0===i?void 0:i.sticker)).toString()}});break;case I.DeleteCommentResult:t({event:b.DELETE_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case I.EditCommentResult:t({event:b.EDIT_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case I.UnsubscribeResult:t({event:b.UNSUBSCRIBE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case I.SubscribeResult:t({event:b.SUBSCRIBE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case I.DisableCommentingResult:t({event:b.DISABLE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case I.EnableCommentingResult:t({event:b.ENABLE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case I.ResolveThreadResult:t({event:b.RESOLVE_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case I.UnresolveThreadResult:t({event:b.UNRESOLVE_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case e.Action$1.UpdateShowResolvedComments:t({event:o.payload.showResolvedComments?b.SHOW_RESOLVED_COMMENTS:b.HIDE_RESOLVED_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case e.Action$1.SortComments:t({event:b.SORT_COMMENTS,extra:{annotationMode:n().annotationSettings.mode,sortType:o.payload.sortType}});break;case e.Action$1.LogApprovalAction:"request_approval"===o.payload.action&&t({event:b.REQUEST_APPROVAL,extra:{context:o.payload.context,annotationMode:n().annotationSettings.mode}});break;case e.Action$1.UpdateAnnotationMode:t({event:o.payload.updatedAnnotationMode===e.SectionAnnotationMode.continuous?b.ENABLE_CONTINUOUS_ANNOTATIONS:b.DISABLE_CONTINUOUS_ANNOTATIONS});break;case e.Action$1.LogStartComment:t({event:b.ADD_COMMENT_START});break;case e.Action$1.LogCancelComment:t({event:b.ADD_COMMENT_CANCEL});break;case e.Action$1.FocusThread:o.payload.threadId?t({event:b.REPLY_COMMENT_START}):t({event:b.REPLY_COMMENT_CANCEL});break;case I.MarkThreadRead:t({event:b.MARK_THREAD_READ});break;case I.MarkThreadUnread:t({event:b.MARK_THREAD_UNREAD})}return a(o)})(i)),r&&c.push(...r);const l=n.applyMiddleware(...c),m=window.__REDUX_DEVTOOLS_EXTENSION__,p=null==m?l:n.compose(l,m({name:"FVSDK Comments2 Plugin"}));return n.createStore(zt,p)},e.markThreadReadAction=Q,e.markThreadUnreadAction=J,e.resolveNavigationToActiveThreadAnnotation=function(t){return{type:e.Action$1.ResolveNavigationToActiveThreadAnnotation,payload:{fileViewerId:t}}},e.resolveThreadAction=ee,e.searchContacts=function(e){return{type:Ne.SearchContacts,payload:e}},e.sortComments=function(t){return{type:e.Action$1.SortComments,payload:{sortType:t}}},e.startAnnotating=function(t,n){return{type:e.Action$1.StartAnnotating,payload:{fileViewerId:t,accessible:n}}},e.subscribeAction=ne,e.unresolveThreadAction=oe,e.unsubscribeAction=ie,e.updateAnnotationMode=p,e.updateDraftAnnotation=function(t,n){return{type:e.Action$1.UpdateDraftAnnotation,payload:{fileViewerId:t,annotation:n}}},e.useContinuousAnnotation=me,e.useUnreadCount=Re,e.v4=C,e.warmContacts=function(e){return{type:Ne.WarmContacts,payload:e}}}));
//# sourceMappingURL=c_comments_data_store.js-vfldep-TC.map
