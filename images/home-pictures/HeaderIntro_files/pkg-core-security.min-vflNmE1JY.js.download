define("typescript/dropbox/proto/js_init_data/login_form/login_form_pb",["require","exports","@bufbuild/protobuf"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionOptions=void 0;class n extends r.Message{constructor(e){super(),this.key="",this.version=r.protoInt64.zero,this.type="",this.plaintextFallback=!1,this.timestamp=0,r.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new n).fromBinary(e,t)}static fromJson(e,t){return(new n).fromJson(e,t)}static fromJsonString(e,t){return(new n).fromJsonString(e,t)}static equals(e,t){return r.proto3.util.equals(n,e,t)}}t.EncryptionOptions=n,n.runtime=r.proto3,n.typeName="login_form.EncryptionOptions",n.fields=r.proto3.util.newFieldList(()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:3},{no:3,name:"type",kind:"scalar",T:9},{no:4,name:"plaintext_fallback",kind:"scalar",T:8},{no:5,name:"timestamp",kind:"scalar",T:2}])})),define("metaserver/static/js/security/crypto",["require","exports","tslib","metaserver/static/js/core/browser_detection","metaserver/static/js/security/util"],(function(e,t,r,n,o){"use strict";function i(){return r.__awaiter(this,void 0,void 0,(function*(){const t=n.edge&&!n.edgeChromium();if(void 0!==window.crypto.subtle&&!t&&!n.checkBrowserVersion(n.chrome,40,!1))return window.crypto;if(t){const{legacyEdgeWrapper:t}=yield new Promise((t,r)=>{e(["metaserver/static/js/security/legacy_edge_shim"],t,r)}).then(r.__importStar),n=t();if(void 0!==n)return n}throw(function(e){const t=new Error(e);return t.isBrowserNotSupported=!0,t})("WebCrypto not supported")}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomValues=t.verifyMessageHmac=t.hashSHA256=t.hmacMessage=t.encryptWithPublicKey=void 0,n=r.__importStar(n),t.encryptWithPublicKey=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){return i().then(i=>r.__awaiter(this,void 0,void 0,(function*(){const r=i.getRandomValues(new Uint8Array(12)),s=yield i.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]),a=yield i.subtle.encrypt({name:"AES-GCM",iv:r},s,t),c=yield i.subtle.exportKey("raw",s),u=yield i.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),p=yield i.subtle.encrypt({name:"RSA-OAEP"},u,c),d=new ArrayBuffer(2);return new DataView(d).setInt16(0,n),(0,o.concatenateArrayBuffers)(d,p,r,a)})))}))},t.hmacMessage=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield i(),n=yield r.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!0,["sign"]),o=yield r.subtle.sign({name:"HMAC"},n,t);return new Uint8Array(o)}))},t.hashSHA256=function(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=yield i(),r=yield t.subtle.digest("SHA-256",e);return new Uint8Array(r)}))},t.verifyMessageHmac=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield i(),o=yield r.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!0,["verify"]);return yield r.subtle.verify({name:"HMAC"},o,n,t)}))},t.getRandomValues=function(e){return r.__awaiter(this,void 0,void 0,(function*(){return(yield i()).getRandomValues(e),e}))}})),define("metaserver/static/js/security/encryption_options",["require","exports","js/proto_utils/unpack"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertProtoEncryptionOptionsToProp=void 0;t.convertProtoEncryptionOptionsToProp=e=>{if(e)return{key:e.key,version:(0,r.toNumber)(e.version),type:e.type,timestamp:e.timestamp,plaintextFallback:e.plaintextFallback}}})),define("metaserver/static/js/security/encryption_options_context",["require","exports","react","metaserver/static/js/security/encryption_options","metaserver/static/js/security/passwords"],(function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useEncryptPassword=t.EncryptionOptionsContext=void 0,t.EncryptionOptionsContext=(0,r.createContext)(void 0);t.useEncryptPassword=()=>{const e=(0,r.useContext)(t.EncryptionOptionsContext),i=(0,n.convertProtoEncryptionOptionsToProp)(e);if(null==i)throw new Error("EncryptionOptions missing: check to ensure that the current context includes EncryptionOptions.Provider");return e=>(0,o.wrapPassword)(e,i)}})),define("metaserver/static/js/security/passwords",["require","exports","tslib","metaserver/static/js/security/util","metaserver/static/js/security/crypto","metaserver/static/js/core/exception"],(function(e,t,r,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapPassword=void 0,n=r.__importStar(n),t.wrapPassword=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(""===e)return"";const r=encodeURIComponent(e);try{const e="wrapped_password_"+t.type+"_";if("RSA-OAEP"===t.type){const i=void 0!==window.performance?window.performance.now()/1e3:0,s=t.timestamp+i,a=n.b64urldecode(t.key),c=yield(0,o.encryptWithPublicKey)(a,n.stringToBytes(JSON.stringify({timestamp:s,password:r})),t.version);return e+n.b64urlencode(c)}throw new Error("Unsupported algorithm")}catch(e){if(!0===t.plaintextFallback)return(0,i.reportException)({err:e,severity:"non-critical",tags:["password-crypto-fallback-error"]}),"wrapped_password_PLAINTEXT_"+r;{let t;throw t=e.isBrowserNotSupported?"user-error":"critical",(0,i.reportException)({err:e,severity:t,tags:["password-crypto-error"]}),e}}}))}})),define("metaserver/static/js/security/util",["require","exports"],(function(e,t){"use strict";function r(e){return btoa(e).replace(/\//g,"_").replace(/\+/g,"-")}function n(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function o(e){return new Uint8Array(Array.prototype.map.call(e,e=>e.charCodeAt(0)))}Object.defineProperty(t,"__esModule",{value:!0}),t.asNumber=t.concatenateArrayBuffers=t.dec2hex=t.stringToBytes=t.bytesToString=t.b64urldecode=t.b64urlencodeString=t.b64urlencode=void 0,t.b64urlencode=function(e){return r(n(e))},t.b64urlencodeString=r,t.b64urldecode=function(e){return o(atob(e.replace(/_/g,"/").replace(/-/g,"+")))},t.bytesToString=n,t.stringToBytes=o;t.dec2hex=e=>("0"+e.toString(16)).substr(-2),t.concatenateArrayBuffers=function(...e){let t=0;for(const r of e)t+=r.byteLength;const r=new Uint8Array(t);let n=0;for(const t of e){const e=new Uint8Array(t);r.set(e,n),n+=t.byteLength}return r},t.asNumber=function(e){return"number"==typeof e?e:"bigint"==typeof e||"string"==typeof e?Number(e):e.toNumber()}}));
//# sourceMappingURL=pkg-core-security.min.js-vflOz9FfC.map