define(["exports","./c_core_uri","./c_ux_analytics_dispatch_custom_event","./e_ui_page_files_router","./c_lodash-es_lodash"],(function(t,e,s,a,i){"use strict";let n=null;const r={initUrl(t){n=t},dispatchHistoryChange(t){e.assert(null!==n,"spaChangesToUxa needs an initial URL");const a=n;n=t;const i={detail:{previousUrl:a,url:n}};s.dispatchCustomEvent("historyChange",i)},reset(){n=null}},o=function(){const t=function(){return a.getUrl()},s=(t,s)=>(null==s&&(s=void 0),String(e.URI.parse(t).setQuery(s))),n=function(e=t()){return a.deconstructUrl(e)},c={},l={};let _=t(),u=null,h="";const p=function(t){return h+"/"+t.substring(h.length).split("/")[1]},d=function(t){const e=n(_),s=p(e.path);if(s in t){const a=e.path.substr(s.length+1);t[s].map((t=>t(a,e.qargs)))}},f=()=>d(c),g=()=>d(l),y=function(t,e,s){if(s[t]){const a=s[t].indexOf(e);s[t].splice(a,1)}},m=function(t,e){p(t)!==p(e)&&g()},b=function(){const e=t();e!==_&&(m(_,e),_=e,f(),x())};function x(){const t=window.location.origin+o.get_url();r.dispatchHistoryChange(t)}return r.initUrl(a.get_href()),{init(){u||(_=t(),u=setInterval(b,50))},_add_callback(t,s,a){this.init(),e.assert("string"==typeof t,"DBHistory prefix is not a string"),e.assert(0===t.indexOf("/"),"DBHistory prefix must be absolute"),e.assert(-1===t.substring(h.length).indexOf("/",1),"multi-component prefixes arent supported"),a[t]||(a[t]=[]),a[t].push(s)},add_callback(t,e,s=!1){this._add_callback(t,e,c),s||f()},remove_callback(t,e){y(t,e,c)},remove_exit_callback(t,e){y(t,e,l)},add_exit_callback(t,e){this._add_callback(t,e,l)},fire_callbacks(){f()},fire_exit_callbacks(){g()},_build_url_for_state_change:(t,a)=>(e.assert("string"==typeof t,"DBHistory path is not a string"),e.assert(0===t.indexOf("/"),"DBHistory path must be relative"),e.assert(-1===t.indexOf("//"),"DBHistory path contains //"),s(t,a)),_pre_state_change:t=>t!==_&&(m(_,t),!0),_post_state_change(e=!0){_=t(),e&&f()},replace_state(t,e,s){void 0===s&&(s={}),s=i.defaults(s,{immediatelyRestoreState:!0});const n=this._build_url_for_state_change(t,e);if(this._pre_state_change(n)){if(a.shouldUseReactRouter())a.CompatNavigate.navigateReplace(n);else{if(!window.history.replaceState)return;a.startNavigation(),window.history.replaceState(null,null,n)}this._post_state_change(s.immediatelyRestoreState),x()}},push_state(t,s,n){null==n&&(n={}),n=i.defaults(n,{immediatelyRestoreState:!0}),e.assert(-1===t.indexOf("?"),"DBHistory path contains ?"),e.assert(-1===t.indexOf("#"),"DBHistory path contains #");const r=this._build_url_for_state_change(t,s);this._pre_state_change(r)&&(a.shouldUseReactRouter()?a.CompatNavigate.navigate(r):(a.startNavigation(),window.history.pushState(null,null,r)),this._post_state_change(n.immediatelyRestoreState),x())},update_query_param(t,e){const s=this.deconstruct_url();s.qargs[t]=e,this.replace_state(s.path,s.qargs)},remove_query_param(t){const e=this.deconstruct_url();delete e.qargs[t],this.replace_state(e.path,e.qargs)},reset(){[c,l].forEach((t=>{Object.keys(t).forEach((e=>{t[e].forEach((s=>{y(e,s,t)}))}))})),_=t(),u=null,h=""},get_url:t,get_uri:function(){const s=e.URI.parse(t());return s.setPath(e.URI.encode_parts(s.getPath())),s},construct_url:s,deconstruct_url:n,set_base_prefix:t=>{h=t}}}();t.DBHistory=o}));
//# sourceMappingURL=c_history.js-vflcBYVYH.map
