define(["require","exports","./c_tslib","./e_edison","./e_ui_page_files_router","./c_api_v2_redux_files","./c_core_types_preview_type","./c_src_file_extension_extension_constants","./c_core_logging_constants","./c_lodash-es_lodash","./c_src_logging_performance","./c_core_utils_redesign2023","./c_ui-icon_line_sidebar-show","./c_src_simple-action-bar_action_bar_types","./c_src_toolbar","./c_ui-icon_line_more-horizontal","./c_ui-icon_line_zoom-out","./c_truncate_index","./c_breadcrumb_index","./c_core_i18n"],(function(e,t,i,r,n,a,o,s,l,c,d,u,p,v,g,_,f,w,m,y){"use strict";const b=/\.\w+$/;function h(e){if(!e)return"";const t=e.toLowerCase().match(b);return t?t[0]:""}const x=1048576,P=30*x,E=32*x,S=40*x,I=48*x,O=100*x,T=160*x,F=200*x,C=256*x,R=288*x,j=512*x,k=1024*x,V={other_size_limits:{".3fr":F,".ai":C,".arw":F,".azw4":P,".binder":F,".bmp":F,".cr2":F,".cr3":F,".crw":F,".csv":S,".dcr":F,".dcs":F,".djvu":P,".dng":F,".doc":T,".docm":T,".docx":T,".dot":T,".dotx":T,".dwg":O,".eps":C,".epub":P,".erf":F,".gdoc":T,".gif":F,".glsides":R,".gsheet":S,".heic":O,".jpeg":F,".jpg":F,".kdc":F,".key":k,".kth":k,".mef":F,".mobi":P,".mos":F,".mrw":F,".nef":F,".nrw":F,".numbers":k,".odg":T,".odp":T,".ods":S,".odt":T,".orf":F,".otf":E,".pages":k,".paper":F,".papert":F,".pdf":524288e3,".pef":F,".png":F,".ppm":F,".pps":R,".ppsm":R,".ppsx":R,".ppt":R,".pptm":R,".pptx":R,".ps":C,".psd":k,".r3d":F,".raf":F,".rtf":T,".rw2":F,".rwl":F,".sketch":k,".sr2":F,".svg":I,".svgz":I,".tif":F,".tiff":F,".ttf":E,".vtt":O,".webp":F,".wpd":T,".x3f":F,".xd":k},archive_size_limit:j,text_size_limit:8388608,linkfile_size_limit:10485760,excel_size_limit:S,annotations:!1,enable_excel_headers:!0,enable_fullscreen:!1,excel_support:{support:"unsupported",embed_support:"unsupported"},file_flipping:!1,force_no_toolbar:!1,img_size_optimization:!1,keyboard_shortcuts:!0,preview_content_only:!1,show_cloud_doc_preview:!0,show_titlebar:!0,titlebar_logo_config:{show_logo:!1,base_url:""},mobile_web:!1,transparent_background:!1,log_views_to_pass:!0,preview_types:{[o.PreviewType.SsrDoc]:{scaleToFit:"width_and_height"}},partial_prewarm_allowed:!1,fvsdk_excel_ms_embed_phase:"OFF",tags_section_variant:"OFF",enable_assigned_tasks_plugin:!1,initial_video_bandwidth:null,fvsdk_slow_connection_banner:!1,enable_video_editing:!1,replay_previews_permanent_entrypoint:"OFF",campaigns_download_sisu:!1,google_one_tap_variant:"OFF",publish_previews_permanent_entrypoint:"OFF",capture_sdk_integration_voice_overs:!1,capture_sdk_integration_voice_overs_variant:"OFF",capture_sdk_integration_voice_overs_view_button:"OFF",previews_exp_video_buffer_length:null,previews_exp_video_buffer_more_before_play:!1,previews_exp_video_edit_flip:!1,video_edit_async:!1,previews_exp_multi_audio_track:"OFF",previews_exp_ui_redesign:"OFF",previews_exp_enable_vhs_buffer_based_abr:!1,previews_exp_video_edit_trim_optimization:!1,previews_activation_hub:"OFF",previews_disable_campaigns_toolkit:!1,enable_multi_video_editor:!1,publish_share_dropdown_entrypoint:"OFF",shaq_code_yellow_no_banner:"OFF"},D={download_button:void 0,cloud_open_with_buttons:[],enable_print:!1,enable_open_button:!1,enable_restore_button:!1,enable_view_on_dropbox_button:!1,canEdit:!1};function A(e,t,i){const r=h(e),n=i.other_size_limits[r];if(n)return n;switch(t){case o.PreviewType.Archive:return i.archive_size_limit;case o.PreviewType.HTML:case o.PreviewType.Text:return i.text_size_limit;case o.PreviewType.Linkfile:return i.linkfile_size_limit;case o.PreviewType.Excel:return i.excel_size_limit}return 0}var M,N,L,U;t.DrawerTypes=void 0,(M=t.DrawerTypes||(t.DrawerTypes={})).Comments="comments",M.Copy="copy",M.Main="main",M.Rename="rename",M.Search="search",M.Transfer="transfer",M.Workflows="workflows",t.HubEntryPointType=void 0,(N=t.HubEntryPointType||(t.HubEntryPointType={})).Download="download",N.Generic="generic",N.Search="search",N.Rename="rename",t.GuidedTours=void 0,(L=t.GuidedTours||(t.GuidedTours={})).Search="search",L.Rename="rename",L.Workflows="workflows",t.TooltipTourUpdateType=void 0,(U=t.TooltipTourUpdateType||(t.TooltipTourUpdateType={})).Increment="Increment",U.Reset="Reset";var K;t.ActivationHubTriggerSource=void 0,(K=t.ActivationHubTriggerSource||(t.ActivationHubTriggerSource={})).HelpIcon="help_icon",K.CardClick="card_click",K.GenericEntryPoint="generic_entry_point",K.RenameEntryPoint="rename_entry_point",K.SearchEntryPoint="search_entry_point",K.WorkflowsEntryPoint="workflows_entry_point";var z;t.HCEvents=void 0,(z=t.HCEvents||(t.HCEvents={})).ACTIVATE_GUIDED_TOUR="activate_guided_tour",z.LOG_TOUR_STEP="log_tour_step",z.OPEN_DRAWER="open_drawer",z.SELECT_DRAWER="select_drawer",z.STATE_CHANGE="state_change",z.SET_ENTRY_POINT="set_entry_point",z.UPDATE_TOUR_STEP="update_tour_step";const $=new class{constructor(){this._listeners=[]}hasEventListener(e,t){return this._listeners.some((i=>i.type===e&&i.listener===t))}addEventListener(e,t){return this.hasEventListener(e,t)||this._listeners.push({type:e,listener:t}),this}removeEventListener(e,t){const i=this._listeners.findIndex((i=>i.type===e&&i.listener===t));return i>=0&&this._listeners.splice(i,1),this}removeEventListeners(){return this._listeners=[],this}dispatch(e,t){return this._listeners.filter((t=>t.type===e)).forEach((e=>{const{listener:i}=e;i.call(this,t)})),this}on(e,t){const i=t;return this.addEventListener(e,i),()=>{this.removeEventListener(e,i)}}},B=(e,i,r)=>{$.dispatch(t.HCEvents.UPDATE_TOUR_STEP,{updateType:e,selectedTour:i,distinctStep:r})},W=(e,i,r)=>{$.dispatch(t.HCEvents.LOG_TOUR_STEP,{selectedTour:e,distinctStep:i,totalSteps:r})},H="info_blade",G="transcript_blade",q="pdf_edit_plugin",Z="comments",X=s.PHOTO_EXTS.concat([".xd"]),Q=s.PDF_EXTS.concat(s.DOCUMENT_EXTS,s.PRESENTATION_EXTS,s.WORDPROC_EXTS),Y=new Set(s.LOGGING_ALLOWED_EXTS);function J(e){return e=e.toLowerCase(),s.MSOFFICE_EXCEL_EXTS.includes(e)?o.PreviewType.Excel:Q.includes(e)?o.PreviewType.SsrDoc:X.includes(e)?o.PreviewType.Image:s.TRANSCODE_VIDEO_EXTS.includes(e)?o.PreviewType.Video:s.AUDIO_EXTS.includes(e)?o.PreviewType.Audio:s.LINK_FILE_EXTS.includes(e)?o.PreviewType.Linkfile:s.HTMLIFIED_PREVIEW_EXTS.includes(e)?o.PreviewType.HTML:s.CLOUD_DOC_EXTS.includes(e)?o.PreviewType.CloudDoc:s.ARCHIVE_EXTS.includes(e)?o.PreviewType.Archive:o.PreviewType.Other}function ee(e){return Y.has(e)?e:s.LOGGING_UNALLOWED_EXT_PLACEHOLDER}function te(e,t){if(!e||!e.content)return t?J(h(t)):o.PreviewType.Error;switch(e.content[".tag"]){case"archive":return o.PreviewType.Archive;case"audio":return o.PreviewType.Audio;case"cloud_doc":return o.PreviewType.CloudDoc;case"excel":return o.PreviewType.Excel;case"html":return o.PreviewType.HTML;case"image":return o.PreviewType.Image;case"linkfile":return o.PreviewType.Linkfile;case"raw_html":return o.PreviewType.RawHTML;case"restricted":return o.PreviewType.Restricted;case"ssr_doc":return o.PreviewType.SsrDoc;case"video":return o.PreviewType.Video;default:return o.PreviewType.Other}}const ie=r.React$1.createContext(null);ie.displayName="FileViewerContext";const re=()=>r.React$1.useContext(ie),ne=ie.Provider,ae=[o.PreviewType.CloudDoc,o.PreviewType.Image,o.PreviewType.SsrDoc,o.PreviewType.Video,o.PreviewType.Audio,o.PreviewType.Archive,o.PreviewType.Excel,o.PreviewType.HTML,o.PreviewType.RawHTML,o.PreviewType.Linkfile];function oe(e){return!!e&&"rightRailUI"in e}function se(e){return e&&function(e){return!!e&&"commentUI"in e}(e)?e:void 0}function le(e){return"actionDefinitions"in e}function ce(e){return!!e&&"fullscreenLayer"in e}function de(e){return"isSnackbarVisible"in e}function ue(e){return e&&function(e){return"sidebarUI"in e}(e)?e:void 0}function pe(e,t){return new Promise(((i,r)=>{const n=Date.now(),a=new Image;a.onload=()=>{i({started:n,completed:Date.now()})},a.onerror=()=>{r({started:n,failed:Date.now()})},t&&(t.srcset&&(a.srcset=t.srcset),t.sizes&&(a.sizes=t.sizes)),a.src=e}))}const ve={top:20,bottom:120,bottomNoToolbar:20,horizontal:72};function ge(e,t,i,r=1){const n=e.width*r,a=e.height*r;let o=0,s=0;return n<t.width&&(o=(t.width-n)/2),a<t.height&&(s=(t.height-a-i.bottom+i.top)/2),{width:n,height:a,translateX:o,translateY:s}}function _e(e){return e/window.innerWidth*100/window.devicePixelRatio}function fe(e,t){const i=function(e,t,i){return Math.min((t.width-i.horizontal)/e.width,(t.height-i.top-i.bottom)/e.height)}(e,t,ve),{width:r,height:n,translateX:a,translateY:o}=ge(e,t,ve,i);return{width:r,height:n,translateX:a,translateY:o,sizeScale:_e(r)}}const we=e=>({actionType:v.ActionBarActionTypes.CUSTOM_ACTION,id:e.id,text:n.defineMessage({id:"C2s323",defaultMessage:"Blank"}),icon:r.React$1.createElement("div",null),isEnabled:!0,renderButton:e.renderButton,overflowItem:e.overflowItem,placement:e.placement}),me=(e,t)=>{const{alwaysAtTopLevel:i,atTopLevelIfSpace:r,alwaysInOverflow:n}=t,a=(e=[],t=[])=>[...e,...t];return{alwaysAtTopLevel:a(e.alwaysAtTopLevel,null==i?void 0:i.map(we)),atTopLevelIfSpace:a(e.atTopLevelIfSpace,null==r?void 0:r.map(we)),alwaysInOverflow:((e=[],t=[])=>{var i,r;const n=[];for(let a=0;a<e.length||a<t.length;a++)n[a]=[...null!==(i=e[a])&&void 0!==i?i:[],...null!==(r=t[a])&&void 0!==r?r:[]];return n})(e.alwaysInOverflow,null==n?void 0:n.map((e=>e.map(we))))}},ye=(e,t)=>Object.assign(Object.assign({},e),{[t.identifier]:t.toolbarUI}),be={workflows:n.defineMessage({id:"6BWuNX",defaultMessage:"Workflows"})},he={workflows:p.MemberTransferLine},xe=({category:e,children:t,hideIcons:i})=>{const a=n.useIntl(),o=be[e],s=he[e],l=r.react.exports.useCallback((e=>{null==e||e.handler()}),[]);return r.React$1.createElement(n.Menu.Wrapper,{onSelection:l},(({getTriggerProps:l,getContentProps:c})=>r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(n.Button,Object.assign({},l(),{variant:"opacity",withIconLeft:i?null:r.React$1.createElement(n.UIIcon,{src:s}),withDropdownIcon:!0,className:e+"-menu-button","data-testid":e+"-menu-button"}),a.formatMessage(o)),r.React$1.createElement(n.Menu.Content,Object.assign({},c()),r.React$1.createElement(n.Menu.Segment,null,t)))))};xe.displayName="CategoryButton";const Pe=({category:e,children:t})=>{const i=n.useIntl(),a=be[e],o=he[e];return r.React$1.createElement(n.Menu.Submenu,{withTriggerContent:i.formatMessage(a),withLeftAccessory:r.React$1.createElement(n.UIIcon,{src:o})},r.React$1.createElement(n.Menu.Segment,null,t))};Pe.displayName="CategorySubmenu";const Ee=(e,t,i)=>{var n,a,o,s;const l=[];if(e.workflows&&e.workflows.length>0){const t=((e,t)=>{const i=t.map((e=>e.overflowItem?r.React$1.createElement(r.React$1.Fragment,{key:e.id},e.overflowItem):null)).filter((e=>null!==e));if(0===i.length)return;const n=r.React$1.createElement(Pe,{category:e},i);return we({id:"GENERIC_CATEGORY_PLUGIN_ID",renderButton:t=>r.React$1.createElement(xe,{category:e,hideIcons:t},i),overflowItem:n})})("workflows",e.workflows);void 0!==t&&l.push(t)}const c=t.map(we),d=null!==(n=i.atTopLevelIfSpace)&&void 0!==n?n:[],u=new Set(d.map((e=>e.actionType===v.ActionBarActionTypes.CUSTOM_ACTION&&e.id?e.id:void 0)).filter(Boolean)),p=null!==(s=null===(o=null!==(a=i.alwaysInOverflow)&&void 0!==a?a:[])||void 0===o?void 0:o[0])&&void 0!==s?s:[],g=p.filter((e=>e.actionType===v.ActionBarActionTypes.CUSTOM_ACTION&&u.has(e.id))),_=p.filter((e=>e.actionType!==v.ActionBarActionTypes.CUSTOM_ACTION||!u.has(e.id))),f=[...g,...c,...l,..._],w=[],m=[],y=[...i.atTopLevelIfSpace||[],...c];for(const e of y)"RightOfCategoryButtons"===e.placement?w.push(e):m.push(e);const b=[...m,...l,...w];return Object.assign(Object.assign({},i),{atTopLevelIfSpace:b,alwaysInOverflow:[f]})};function Se(e,t){const i=te(e),r=e.content;if(!r)return Promise.resolve();if(i===o.PreviewType.Image&&"image"===r[".tag"]){if(!r.default_src)return Promise.resolve();if(r.src_set&&e.dimensions&&t){const{sizeScale:i}=fe(e.dimensions,t);return pe(r.default_src,{srcset:r.src_set,sizes:`${i}vw`})}return pe(r.default_src,{srcset:r.src_set})}return Promise.resolve()}const Ie=e=>{var t,i;const r=null==e?void 0:e.previewType;if((r===o.PreviewType.SsrDoc||r===o.PreviewType.CloudDoc)&&"cloud_doc"===(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t[".tag"])&&(null===(i=null==e?void 0:e.content)||void 0===i?void 0:i.exit_url))return e.content.exit_url};var Oe;function Te(e){return{payload:e,type:Oe.Rename}}function Fe(e){return{payload:e,type:Oe.SetToolbarRenameActive}}function Ce(e){return{payload:e,type:Oe.SetDeleteFileModalOpen}}function Re(e){return{payload:e,type:Oe.FetchPageDataWithMetadata}}function je(e){return{type:Oe.FetchPageDataWithMetadataResult,payload:e}}function ke(e){return{type:Oe.UpdateDocCurrentPageIndex,payload:e}}function Ve(e){return{type:Oe.PageNavigation,payload:e}}function De(e){return{type:Oe.ZoomIn,payload:e}}function Ae(e){return{type:Oe.ZoomOut,payload:e}}function Me(e){return{type:Oe.ZoomToggleOriginalOrFit,payload:e}}function Ne(e){return{type:Oe.InitializeFilePreviewSession,payload:e}}function Le(e){return{type:Oe.OpenDocSidebar,payload:e}}function Ue(e){return{type:Oe.CloseDocSidebar,payload:e}}function Ke(e){return{type:Oe.Print,payload:e}}function ze(e){return{type:Oe.EnterFullScreen,payload:e}}function $e(e){return{type:Oe.ExitFullScreen,payload:e}}function Be(e){return{type:Oe.OpenRightRail,payload:e}}function We(e){return{type:Oe.CloseRightRail,payload:e}}function He(e){return{type:Oe.OpenUrl,payload:e}}function Ge(e){return{type:Oe.FlipToNextFile,payload:e}}function qe(e){return{type:Oe.FlipToPreviousFile,payload:e}}function Ze(e){return{type:Oe.SetPreviewMetadata,payload:e}}function Xe(e){return{type:Oe.SetRivieraData,payload:e}}function Qe(e){return{type:Oe.CloseViewer,payload:e}}function Ye(e){return{type:Oe.SetActiveRightRailPlugin,payload:e}}function Je(e){return{type:Oe.SetActiveEditPlugin,payload:e}}function et(e){return{type:Oe.SetLeftSidebarPlugin,payload:e}}function tt(e){return{type:Oe.SetRightSidebarPlugin,payload:e}}function it(e){return{payload:e,type:Oe.UpdateArchiveFileCurrentPath}}function rt(e){return{type:Oe.OverrideFloatingToolbar,payload:e}}function nt(e){return{type:Oe.SetVolume,payload:e}}function at(e){return{type:Oe.SetMuted,payload:e}}function ot(e){return{type:Oe.ReportException,payload:e}}function st(e){return{type:Oe.SetPreviewLoadingAction,payload:e}}function lt(e){return{type:Oe.SetFileViewerError,payload:e}}!function(e){e.CloseDocSidebar="@@previews/fileViewerUi/closeDocSidebar",e.CopyToDropbox="@@previews/fileSystem/copyToDropbox",e.DownloadFile="@@previews/fileSystem/downloadFile",e.FetchPageDataWithMetadata="@@previews/fetchPageDataWithMetadata",e.FetchPageDataWithMetadataResult="@@previews/fetchPageDataWithMetadataResult",e.FlipToNextFile="@@previews/navigation/flipToNextFile",e.FlipToPreviousFile="@@previews/navigation/flipToPreviousFile",e.InitializeFilePreview="@@previews/initializeFilePreview",e.InitializeNestedArchiveFilePreview="@@previews/initializeNestedArchiveFilePreview",e.OpenDocSidebar="@@previews/fileViewerUi/openDocSidebar",e.PageDown="@@previews/pageDown",e.PageUp="@@previews/pageUp",e.Print="@@previews/print",e.RefreshBlob="@@previews/refreshBlob",e.RefreshBlobSuccess="@@previews/refreshBlobSuccess",e.SetRootFilePreview="@@previews/setRootFilePreview",e.UpdateDocCurrentPageIndex="@@previews/updateDocCurrentPageIndex",e.PageNavigation="@@previews/pageNavigation",e.ResolvePageNavigation="@@previews/resolvePageNavigation",e.UpdateFitScaleFactor="@@previews/updateFitScaleFactor",e.ZoomIn="@@previews/zoomIn",e.ZoomToggleOriginalOrFit="@@previews/zoomToggleOriginalOrFit",e.ZoomOut="@@previews/zoomOut",e.UpdateDimensions="@@previews/updateDimensions",e.OpenRightRail="@@previews/openRightRail",e.CloseRightRail="@@previews/closeRightRail",e.Restore="@@previews/restore",e.Share="@@previews/share",e.OpenWith="@@previews/openWith",e.OpenWebPreview="@@previews/openWebPreview",e.OpenVersionHistory="@@previews/openVersionHistory",e.OpenUrl="@@previews/openUrl",e.FetchNativeApps="@@previews/fetchNativeApps",e.InitializeFilePreviewSession="@@previews/initializeFilePreviewSession",e.InitializeFileViewer="@@previews/initializeFileViewer",e.SetFileMetadata="@@previews/setFileMetadata",e.SetPreviewMetadata="@@previews/setPreviewMetadata",e.SetRivieraData="@@previews/setRivieraData",e.SetArchiveFiles="@@previews/setArchiveFiles",e.CloseViewer="@@previews/closeViewer",e.OpenFullscreenPreview="@@previews/openFullscreenPreview",e.SetBootstrappedFile="@@previews/setBootstrappedFile",e.SetErroredFile="@@previews/setErroredFile",e.SetActiveRightRailPlugin="@@previews/plugins/setActiveRightRailPlugin",e.SetActiveEditPlugin="@@previews/plugins/setActiveEditPlugin",e.HideContentPane="@@previews/plugins/hideContentPane",e.SetLeftSidebarPlugin="@@previews/plugins/setLeftSidebarPlugin",e.SetRightSidebarPlugin="@@previews/plugins/setRightSidebarPlugin",e.FetchExcelSheetLayoutData="@@previews/fetchExcelSheetLayoutData",e.FetchExcelSheetLayoutDataResult="@@previews/fetchExcelSheetLayoutDataResult",e.SwitchWorkbookTab="@@previews/switchWorkbookTab",e.SetSharedLinkInfo="@@previews/setSharedLinkInfo",e.ExcelSheetRenderFailed="@@previews/excelSheetRenderFailed",e.ExcelSheetRenderSucceeded="@@previews/excelSheetRenderSucceeded",e.EnterFullScreen="@@previews/enterFullscreen",e.ExitFullScreen="@@previews/exitFullscreen",e.ClickDropboxLogo="@@previews/clickDropboxLogo",e.UpdateArchiveFileCurrentPath="@@previews/updateArchiveFileCurrentPath",e.UpdateAudioVideoPlaybackState="@@previews/updateAudioVideoPlaybackState",e.UpdateFiles="@@previews/updateFiles",e.RequestVideoSeek="@@previews/requestVideoSeek",e.RequestVideoSeekRelative="@@previews/requestVideoSeekRelative",e.RequestVideoPause="@@previews/requestVideoPause",e.ClearVideoRequests="@@previews/clearVideoRequests",e.ToggleVideoFrameSteppers="@@previews/toggleVideoFrameSteppers",e.SetupGetPlayDurationSeconds="@@previews/setupGetPlayDurationSeconds",e.ShowAuthModal="@@previews/showAuthModal",e.OpenFileURL="@@previews/openFileURL",e.Redirect="@@previews/redirect",e.FetchTranscriptData="@@previews/fetchTranscriptData",e.FetchTranscriptDataResult="@@previews/fetchTranscriptDataResult",e.StartTranscriptGenerating="@@previews/startTranscriptGenerating",e.SetOptInToVideoTranscript="@@previews/setOptInToVideoTranscript",e.SetTranscriptError="@@previews/setTranscriptError",e.OverrideFloatingToolbar="@@previews/overrideFloatingToolbar",e.TriggerDynamicRoutingModalCheck="@@previews/triggerDynamicRoutingModalCheck",e.SetVolume="@@previews/setVolume",e.SetMuted="@@previews/setMuted",e.ReportException="@@previews/reportException",e.SetPreviewLoadingAction="@@previews/setPreviewLoadedAction",e.SetBrandingInfo="@@previews/setBrandingInfo",e.Rename="@@previews/rename",e.Delete="@@previews/delete",e.SetFileViewerError="@@previews/setFileViewerError",e.SetDeleteFileModalOpen="@@previews/setDeleteFileModalOpen",e.EditVideo="@@previews/editVideo",e.CancelEditingVideo="@@previews/cancelEditingVideo",e.SaveVideoEdit="@@previews/saveVideoEdit",e.SetToolbarRenameActive="@@previews/toolbarRenameActive",e.SubscribePresence="@@presence/subscribe",e.UnsubscribePresence="@@presence/unsubscribe",e.SetIsClosedCaptionShowing="@@previews/setIsClosedCaptionShowing",e.SetIsTranscriptShowing="@@previews/setIsTranscriptShowing",e.SetIsDefaultAudioTrackSelected="@@previews/fileViewerUi/setIsDefaultAudioTrackSelected"}(Oe||(Oe={}));const ct="@@apiv2_redux/previews/get_archive_files",dt="@@apiv2_redux/previews/get_archive_files_result",ut="@@apiv2_redux/previews/get_preview_data_batch",pt="@@apiv2_redux/previews/get_preview_data_batch_result",vt="@@apiv2_redux/previews/get_preview_data_by_file_ids_batch",gt="@@apiv2_redux/previews/get_preview_data_by_file_ids_batch_result",_t="@@apiv2_redux/previews/get_preview_data_by_specs_batch",ft="@@apiv2_redux/previews/get_preview_data_by_specs_batch_result",wt="@@apiv2_redux/previews/logged_out/get_archive_files",mt="@@apiv2_redux/previews/logged_out/get_archive_files_result",yt=a._createAction(ct),bt=a._createAction(dt),ht=a._createAction(ut),xt=a._createAction(pt),Pt=a._createAction(gt),Et=a._createAction(ft),St=a._createAction(wt),It={[ct]:{endpoint:"get_archive_files",action:bt},[ut]:{endpoint:"get_preview_data_batch",action:xt},[vt]:{endpoint:"get_preview_data_by_file_ids_batch",action:Pt},[_t]:{endpoint:"get_preview_data_by_specs_batch",action:Et},[wt]:{endpoint:"logged_out/get_archive_files",action:a._createAction(mt)}},Ot=a._createMiddleware(It),Tt="@@apiv2_redux/cloud_docs/add_image_preview_to_shortcut",Ft="@@apiv2_redux/cloud_docs/add_image_preview_to_shortcut_result",Ct="@@apiv2_redux/cloud_docs/admin_settings/get",Rt="@@apiv2_redux/cloud_docs/admin_settings/get_result",jt="@@apiv2_redux/cloud_docs/admin_settings/set",kt="@@apiv2_redux/cloud_docs/admin_settings/set_result",Vt="@@apiv2_redux/cloud_docs/alpha/dropin_move",Dt="@@apiv2_redux/cloud_docs/alpha/dropin_move_result",At="@@apiv2_redux/cloud_docs/authorize",Mt="@@apiv2_redux/cloud_docs/authorize_result",Nt="@@apiv2_redux/cloud_docs/convert_gdd_to_ms_office_file",Lt="@@apiv2_redux/cloud_docs/convert_gdd_to_ms_office_file_result",Ut="@@apiv2_redux/cloud_docs/convert_to_web_shortcut",Kt="@@apiv2_redux/cloud_docs/convert_to_web_shortcut_result",zt="@@apiv2_redux/cloud_docs/create",$t="@@apiv2_redux/cloud_docs/create_result",Bt="@@apiv2_redux/cloud_docs/create_shortcut",Wt="@@apiv2_redux/cloud_docs/create_shortcut_result",Ht="@@apiv2_redux/cloud_docs/create_web_shortcut_to_external_file",Gt="@@apiv2_redux/cloud_docs/create_web_shortcut_to_external_file_result",qt="@@apiv2_redux/cloud_docs/get_cloud_editor_url",Zt="@@apiv2_redux/cloud_docs/get_cloud_editor_url_result",Xt="@@apiv2_redux/cloud_docs/get_default_folder_id",Qt="@@apiv2_redux/cloud_docs/get_default_folder_id_result",Yt="@@apiv2_redux/cloud_docs/get_doc_state_and_actions",Jt="@@apiv2_redux/cloud_docs/get_doc_state_and_actions_result",ei="@@apiv2_redux/cloud_docs/get_doc_state_and_actions_logged_out",ti="@@apiv2_redux/cloud_docs/get_doc_state_and_actions_logged_out_result",ii="@@apiv2_redux/cloud_docs/get_file_details",ri="@@apiv2_redux/cloud_docs/get_file_details_result",ni="@@apiv2_redux/cloud_docs/get_file_id",ai="@@apiv2_redux/cloud_docs/get_file_id_result",oi="@@apiv2_redux/cloud_docs/get_file_metadata",si="@@apiv2_redux/cloud_docs/get_file_metadata_result",li="@@apiv2_redux/cloud_docs/get_gdd_migration_details",ci="@@apiv2_redux/cloud_docs/get_gdd_migration_details_result",di="@@apiv2_redux/cloud_docs/get_gdd_migration_settings",ui="@@apiv2_redux/cloud_docs/get_gdd_migration_settings_result",pi="@@apiv2_redux/cloud_docs/get_integrations",vi="@@apiv2_redux/cloud_docs/get_integrations_result",gi="@@apiv2_redux/cloud_docs/get_lock_provider",_i="@@apiv2_redux/cloud_docs/get_lock_provider_result",fi="@@apiv2_redux/cloud_docs/get_metadata",wi="@@apiv2_redux/cloud_docs/get_metadata_result",mi="@@apiv2_redux/cloud_docs/get_migration_folder_url_in_gdrive",yi="@@apiv2_redux/cloud_docs/get_migration_folder_url_in_gdrive_result",bi="@@apiv2_redux/cloud_docs/get_navigation_properties",hi="@@apiv2_redux/cloud_docs/get_navigation_properties_result",xi="@@apiv2_redux/cloud_docs/get_pointer_url",Pi="@@apiv2_redux/cloud_docs/get_pointer_url_result",Ei="@@apiv2_redux/cloud_docs/get_preferred_editor_url",Si="@@apiv2_redux/cloud_docs/get_preferred_editor_url_result",Ii="@@apiv2_redux/cloud_docs/get_token",Oi="@@apiv2_redux/cloud_docs/get_token_result",Ti="@@apiv2_redux/cloud_docs/google_shortcut_settings/get",Fi="@@apiv2_redux/cloud_docs/google_shortcut_settings/get_result",Ci="@@apiv2_redux/cloud_docs/google_shortcut_settings/set",Ri="@@apiv2_redux/cloud_docs/google_shortcut_settings/set_result",ji="@@apiv2_redux/cloud_docs/lock",ki="@@apiv2_redux/cloud_docs/lock_result",Vi="@@apiv2_redux/cloud_docs/log_client_event",Di="@@apiv2_redux/cloud_docs/log_client_event_result",Ai="@@apiv2_redux/cloud_docs/log_new_partner_users",Mi="@@apiv2_redux/cloud_docs/log_new_partner_users_result",Ni="@@apiv2_redux/cloud_docs/log_token_in_use",Li="@@apiv2_redux/cloud_docs/log_token_in_use_result",Ui="@@apiv2_redux/cloud_docs/log_user_action",Ki="@@apiv2_redux/cloud_docs/log_user_action_result",zi="@@apiv2_redux/cloud_docs/logged_out/encrypt_email",$i="@@apiv2_redux/cloud_docs/logged_out/encrypt_email_result",Bi="@@apiv2_redux/cloud_docs/logged_out/get_pointer_url",Wi="@@apiv2_redux/cloud_docs/logged_out/get_pointer_url_result",Hi="@@apiv2_redux/cloud_docs/logged_out/log_user_action",Gi="@@apiv2_redux/cloud_docs/logged_out/log_user_action_result",qi="@@apiv2_redux/cloud_docs/pass_snackbar/get",Zi="@@apiv2_redux/cloud_docs/pass_snackbar/get_result",Xi="@@apiv2_redux/cloud_docs/pass_snackbar/set",Qi="@@apiv2_redux/cloud_docs/pass_snackbar/set_result",Yi="@@apiv2_redux/cloud_docs/preferred_editor/get",Ji="@@apiv2_redux/cloud_docs/preferred_editor/get_result",er="@@apiv2_redux/cloud_docs/preferred_editor/set",tr="@@apiv2_redux/cloud_docs/preferred_editor/set_result",ir="@@apiv2_redux/cloud_docs/preferred_editor_prompt/disable",rr="@@apiv2_redux/cloud_docs/preferred_editor_prompt/disable_result",nr="@@apiv2_redux/cloud_docs/rename",ar="@@apiv2_redux/cloud_docs/rename_result",or="@@apiv2_redux/cloud_docs/set_gdd_migration_settings",sr="@@apiv2_redux/cloud_docs/set_gdd_migration_settings_result",lr="@@apiv2_redux/cloud_docs/signin_snackbar/get",cr="@@apiv2_redux/cloud_docs/signin_snackbar/get_result",dr="@@apiv2_redux/cloud_docs/signin_snackbar/set",ur="@@apiv2_redux/cloud_docs/signin_snackbar/set_result",pr="@@apiv2_redux/cloud_docs/start_gdd_migration",vr="@@apiv2_redux/cloud_docs/start_gdd_migration_result",gr="@@apiv2_redux/cloud_docs/team_settings/get",_r="@@apiv2_redux/cloud_docs/team_settings/get_result",fr="@@apiv2_redux/cloud_docs/team_settings/set",wr="@@apiv2_redux/cloud_docs/team_settings/set_result",mr="@@apiv2_redux/cloud_docs/unlock",yr="@@apiv2_redux/cloud_docs/unlock_result",br="@@apiv2_redux/cloud_docs/user_education_snackbar/get",hr="@@apiv2_redux/cloud_docs/user_education_snackbar/get_result",xr="@@apiv2_redux/cloud_docs/user_education_snackbar/set",Pr="@@apiv2_redux/cloud_docs/user_education_snackbar/set_result",Er=a._createAction(Ft),Sr=a._createAction(Rt),Ir=a._createAction(kt),Or=a._createAction(Dt),Tr=a._createAction(Mt),Fr=a._createAction(Lt),Cr=a._createAction(Kt),Rr=a._createAction($t),jr=a._createAction(Wt),kr=a._createAction(Gt),Vr=a._createAction(qt),Dr={[Tt]:{endpoint:"add_image_preview_to_shortcut",action:Er},[Ct]:{endpoint:"admin_settings/get",action:Sr},[jt]:{endpoint:"admin_settings/set",action:Ir},[Vt]:{endpoint:"alpha/dropin_move",action:Or},[At]:{endpoint:"authorize",action:Tr},[Nt]:{endpoint:"convert_gdd_to_ms_office_file",action:Fr},[Ut]:{endpoint:"convert_to_web_shortcut",action:Cr},[zt]:{endpoint:"create",action:Rr},[Bt]:{endpoint:"create_shortcut",action:jr},[Ht]:{endpoint:"create_web_shortcut_to_external_file",action:kr},[qt]:{endpoint:"get_cloud_editor_url",action:a._createAction(Zt)},[Xt]:{endpoint:"get_default_folder_id",action:a._createAction(Qt)},[Yt]:{endpoint:"get_doc_state_and_actions",action:a._createAction(Jt)},[ei]:{endpoint:"get_doc_state_and_actions_logged_out",action:a._createAction(ti)},[ii]:{endpoint:"get_file_details",action:a._createAction(ri)},[ni]:{endpoint:"get_file_id",action:a._createAction(ai)},[oi]:{endpoint:"get_file_metadata",action:a._createAction(si)},[li]:{endpoint:"get_gdd_migration_details",action:a._createAction(ci)},[di]:{endpoint:"get_gdd_migration_settings",action:a._createAction(ui)},[pi]:{endpoint:"get_integrations",action:a._createAction(vi)},[gi]:{endpoint:"get_lock_provider",action:a._createAction(_i)},[fi]:{endpoint:"get_metadata",action:a._createAction(wi)},[mi]:{endpoint:"get_migration_folder_url_in_gdrive",action:a._createAction(yi)},[bi]:{endpoint:"get_navigation_properties",action:a._createAction(hi)},[xi]:{endpoint:"get_pointer_url",action:a._createAction(Pi)},[Ei]:{endpoint:"get_preferred_editor_url",action:a._createAction(Si)},[Ii]:{endpoint:"get_token",action:a._createAction(Oi)},[Ti]:{endpoint:"google_shortcut_settings/get",action:a._createAction(Fi)},[Ci]:{endpoint:"google_shortcut_settings/set",action:a._createAction(Ri)},[ji]:{endpoint:"lock",action:a._createAction(ki)},[Vi]:{endpoint:"log_client_event",action:a._createAction(Di)},[Ai]:{endpoint:"log_new_partner_users",action:a._createAction(Mi)},[Ni]:{endpoint:"log_token_in_use",action:a._createAction(Li)},[Ui]:{endpoint:"log_user_action",action:a._createAction(Ki)},[zi]:{endpoint:"logged_out/encrypt_email",action:a._createAction($i)},[Bi]:{endpoint:"logged_out/get_pointer_url",action:a._createAction(Wi)},[Hi]:{endpoint:"logged_out/log_user_action",action:a._createAction(Gi)},[qi]:{endpoint:"pass_snackbar/get",action:a._createAction(Zi)},[Xi]:{endpoint:"pass_snackbar/set",action:a._createAction(Qi)},[Yi]:{endpoint:"preferred_editor/get",action:a._createAction(Ji)},[er]:{endpoint:"preferred_editor/set",action:a._createAction(tr)},[ir]:{endpoint:"preferred_editor_prompt/disable",action:a._createAction(rr)},[nr]:{endpoint:"rename",action:a._createAction(ar)},[or]:{endpoint:"set_gdd_migration_settings",action:a._createAction(sr)},[lr]:{endpoint:"signin_snackbar/get",action:a._createAction(cr)},[dr]:{endpoint:"signin_snackbar/set",action:a._createAction(ur)},[pr]:{endpoint:"start_gdd_migration",action:a._createAction(vr)},[gr]:{endpoint:"team_settings/get",action:a._createAction(_r)},[fr]:{endpoint:"team_settings/set",action:a._createAction(wr)},[mr]:{endpoint:"unlock",action:a._createAction(yr)},[br]:{endpoint:"user_education_snackbar/get",action:a._createAction(hr)},[xr]:{endpoint:"user_education_snackbar/set",action:a._createAction(Pr)}},Ar=a._createMiddleware(Dr),Mr=(()=>{let e,t;const i=[];for(e=0,t=e;e<=255;e++,t=e)i.push((t+256).toString(16).substr(1));return i})();function Nr(e){return e.map((e=>Mr[e])).join("")}function Lr(){const e=function(){const e=new Uint8Array(16);return window.crypto.getRandomValues(e),e}();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(Nr).join("-")}var Ur,Kr;t.FVErrorCode=void 0,(Ur=t.FVErrorCode||(t.FVErrorCode={}))[Ur.PreviewsDataApiFailure=0]="PreviewsDataApiFailure",Ur[Ur.MalformedPreviewsDataApiResponse=1]="MalformedPreviewsDataApiResponse",Ur[Ur.RivieraDataFetchFailure=2]="RivieraDataFetchFailure",Ur[Ur.MalformedRivieraData=3]="MalformedRivieraData",Ur[Ur.FileTooLarge=4]="FileTooLarge",Ur[Ur.UnsupportedPreviewType=5]="UnsupportedPreviewType",Ur[Ur.NoExtension=6]="NoExtension",Ur[Ur.PasswordProtected=7]="PasswordProtected",Ur[Ur.FileUploading=8]="FileUploading",Ur[Ur.Unknown=9]="Unknown",Ur[Ur.FileSwitched=10]="FileSwitched",Ur[Ur.InvalidFileInfo=11]="InvalidFileInfo",Ur[Ur.InvalidLoggingOrder=12]="InvalidLoggingOrder",Ur[Ur.InvalidLoggingSession=13]="InvalidLoggingSession",Ur[Ur.UserOffline=14]="UserOffline",Ur[Ur.MissingContentMetadata=15]="MissingContentMetadata",Ur[Ur.NestedFiletypeNotSupported=16]="NestedFiletypeNotSupported",Ur[Ur.PasswordProtectedArchivesNotSupported=17]="PasswordProtectedArchivesNotSupported";class zr extends Error{constructor(e,t){super(t),Object.setPrototypeOf(this,zr.prototype),this.type=e}}function $r(e,i=t.FVErrorCode.Unknown,r){if(!e){let e;throw e=new zr(i,void 0===r?"An error occurred for unknown reason":r),e.framesToPop=1,e}return e}function Br(e){const{file_viewer_session_id:t=Lr(),file_preview_session_id:i=Lr(),file_id:r="",sj_id:n,ns_id:a,file_extension:o=ee(""),device_type:s=l.DeviceType.desktop,extra:c={}}=e||{};return{file_viewer_session_id:t,file_preview_session_id:i,file_id:r,sj_id:n,ns_id:a,file_extension:o,device_type:s,extra:Object.assign(Object.assign({},c),{source_action:c.source_action||l.SourceAction.Visit,source_context:c.source_context||l.SourceContext.FileViewer,was_flipped:c.was_flipped||!1,redesign2023Variant:c.redesign2023Variant||"OFF",file_preview_timeline:{}})}}function Wr(e){return{type:Kr.LogSessionEvent,payload:e}}function Hr(e){return{type:Kr.Log,payload:e}}function Gr(e){return{type:Kr.LogUserAction,payload:e}}function qr(e){return{type:Kr.UpdateSession,payload:e}}function Zr(e){return{type:Kr.LogDuration,payload:e}}function Xr(e){const t="NestedArchiveFile"===e.type?e:null;return Boolean(t)}function Qr(e,t,i,r){return{type:"File",_fileId:e,_nsId:t,_sjId:i,_url:r,serialized:(e?`fileId:[${e}]`:"")+(t?`nsId:[${t}]`:"")+(i?`sjId:[${i}]`:"")+(r?`url:[${r}]`:"")}}function Yr(e,t){return{type:"NestedArchiveFile",rootFileId:e,subpath:t,serialized:`rootFileId:[${e}]subpath:[${t}]`}}function Jr(e){let t="";return e.length&&(t+=`/${e.join("/")}`),`${t}`}function en(e){return null!=e&&"sheets"in e}function tn(e){return null!=e&&"entries"in e?e:void 0}function rn(e){return null!=e&&"metadata"in e&&"pages"in e?e:void 0}function nn(e){return e&&"isTruncated"in e?e:void 0}function an(e){return e&&"sheets"in e?e:void 0}function on(e){return e&&"uri"in e?e:void 0}function sn(e){return void 0!==e&&"excel"===e[".tag"]}function ln(e){return e&&"currentPageIndex"in e?e:void 0}function cn(e){return e&&"currentTimestamp"in e?e:void 0}function dn(e){return e&&"fitScaleFactor"in e?e:void 0}!function(e){e.UpdateSession="@@previews/updateSession",e.Log="@@previews/log",e.LogDuration="@@previews/logDuration",e.LogUserAction="@@previews/LogUserAction",e.LogBackgroundEvent="@@previews/LogBackgroundEvent",e.LogSessionEvent="@@previews/logSessionEvent",e.LogTTI="@@previews/logTTI",e.LogVideoEvent="@@previews/logVideoEvent",e.LogVideoEventQuantity="@@previews/logVideoEventQuantity",e.LogVideoEventDuration="@@previews/logVideoEventDuration",e.UpdateFitScaleFactor="UpdateFitScaleFactor"}(Kr||(Kr={}));const un=e=>({state:"errored",error:e}),pn=e=>({state:"loaded",data:e}),vn=()=>({state:"pending"});function gn({page:e=0,imageUrlTmpl:t},i){const r=new URL(t);return r.searchParams.set("page",e.toString()),i&&"scalePercent"in i&&i.scalePercent&&r.searchParams.set("scale_percent",i.scalePercent.toString()),i&&"width"in i&&null!=i.width&&r.searchParams.set("width",i.width.toString()),r.toString()}function _n(e,t,i){return i&&i[0]?gn({imageUrlTmpl:e,page:t},{width:i[0]}):gn({imageUrlTmpl:e,page:t})}function fn(e,t=[],i,r,n,a){const o=function(e,t=[],i,r,n){const a=t.reduce(((e,[t,i,r])=>{for(let n=0;n<r;n++)e.push([t,i]);return e}),[]);return[...Array(i)].map(((t,i)=>({pageIndex:i,dimension:a[i],thumbnailUrl:_n(e,i,n),imgUrls:{"1x":gn({imageUrlTmpl:e,page:i},{scalePercent:100}),"4x":gn({imageUrlTmpl:e,page:i},{scalePercent:400}),imageUrlTmpl:e},textboxes:r?r[i].textboxes:[],links:[]})))}(e,t,i,n,a),s=function(e){const{text:t}=e;if(!t||!t.pages)return[];const{links:i,pages:r}=t,n=(t.fonts||[]).reduce(((e,t)=>(e[t.f]=function(e){const t=e.n.lastIndexOf(",");return{fontFamily:`"${t>-1?e.n.substr(0,t):e.n}", ${1&e.f?"monospace":"serif"}`,isBold:(262144&e.f)>0,isItalic:(64&e.f)>0}}(t),e)),{});return Object.keys(r).map((e=>({pageIndex:+e,textboxes:(r[e]||[]).map((e=>Object.assign(Object.assign({},e),{font:n[e.f]}))),links:i&&i[e]||[]})))}(r);return s.forEach((e=>{const{pageIndex:t}=e;t<o.length&&(o[t]=Object.assign(Object.assign({},o[t]),e))})),o}function wn(e){return pn({name:e.workbook_name,sheetOverview:e.sheets.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.idx]:{hidden:t.hidden,name:t.name}})),{})})}const mn=(e,t="")=>{var i,r,n,a;const o="/"===e.name?"":e.name,s="/"===e.name?"":`${t}/${e.name}`,l=null!==(r=null===(i=e.children)||void 0===i?void 0:i.reduce(((e,t)=>Object.assign(Object.assign({},e),mn(t,s))),{}))&&void 0!==r?r:void 0,c=e.isDir?{isDir:!0,children:null!==(a=null===(n=e.children)||void 0===n?void 0:n.map((e=>e.name)))&&void 0!==a?a:[],name:o,size:void 0}:{isDir:!1,size:e.size?Number(e.size):0,name:o,children:void 0};return Object.assign(Object.assign({},l),{[s]:c})};function yn(e){return e instanceof zr}function bn(e){switch(e[".tag"]){case"unsupported_file_error":return t.FVErrorCode.UnsupportedPreviewType;case"content_not_uploaded":return t.FVErrorCode.FileUploading;default:return t.FVErrorCode.PreviewsDataApiFailure}}const hn={},xn={},Pn={},En={},Sn={},In={},On={},Tn={},Fn={},Cn={},Rn={},jn={},kn=[],Vn={volume:1,muted:!1},Dn={},An={},Mn={currentPath:void 0},Nn=Object.assign(Object.assign({},Mn),{fitScaleFactor:0}),Ln=Object.assign(Object.assign({},Mn),{currentPageIndex:0,fitScaleFactor:0}),Un=Object.assign(Object.assign({},Mn),{currentTabIndex:0,fitScaleFactor:0}),Kn=Object.assign(Object.assign({},Mn),{currentTimestamp:0,isPlaying:!1,isTranscriptShowing:!1,isClosedCaptionShowing:!1,isDefaultAudioTrackSelected:!0}),zn={isDocSidebarOpen:!1,showVideoFrameSteppers:!1,isFullScreen:!1,hasBeenFlipped:!1,isRightRailOpen:!1,isEditingVideo:!1,isPreviewLoading:!1,isDeleteFileModalOpen:!1,isToolbarRenameActive:!1,isRenameInitiatedFromOverflow:!1,toolbar:{override:void 0,overridePluginId:void 0}},$n=[".gdoc",".gslides",".paper",".papert",".binder"],Bn={max:16,min:.01,multiplier:1.25,delta:.05},Wn={max:10,min:.1,multiplier:1.1},Hn=(e,t,i)=>Math.abs(e-t)<Math.abs(e-i)?e:t,Gn=(e,t,i)=>{const{delta:r,multiplier:n}=i;let a=e*(t?n:1/n);return r&&(a=Math.round(a/r)*r,Math.abs(a-e)<r&&(a+=t?r:-r)),((e,{min:t,max:i})=>Math.min(Math.max(e,t),i))(a,i)},qn=({scaleFactor:e,ascend:t,previewType:i,fitScaleFactor:r})=>{if(!e)return 1;const n=(e=>e===o.PreviewType.SsrDoc?Wn:Bn)(i),a=Gn(e,t,n),s=Gn(a,t,n);for(const i of((e,t)=>{const i=[1];return t&&Math.abs(1-t)>.02&&i.push(t),((e,t)=>e?e.sort(((e,i)=>t?e-i:i-e)):[])(i,e)})(t,r))if(t){if(e<i&&s>=i)return Hn(i,a,s)}else if(e>i&&s<=i)return Hn(i,a,s);return a},Zn=(e,t)=>{switch(e){case o.PreviewType.Image:return Nn;case o.PreviewType.SsrDoc:return Ln;case o.PreviewType.Excel:return Un;case o.PreviewType.Audio:case o.PreviewType.Video:return Kn;case o.PreviewType.CloudDoc:return t&&$n.includes(t)?Ln:Mn;default:return Mn}},Xn={previewData:(e=hn,t)=>{var i;let r;switch(t.type){case Oe.SetPreviewMetadata:if(!Xr(t.payload.previewKey))return r=t.payload.previewKey.serialized,Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({previewType:te(t.payload)},e[r]),t.payload)});break;case pt:{if(!t.payload||!t.payload.result)return e;const i=t.payload.result.results,r=t.meta.previewKey;return Object.assign(Object.assign({},e),i.reduce(((e,i)=>{var n;if(null==i.file.file_id){if(!(null===(n=t.payload.arg)||void 0===n?void 0:n.files)||1!==t.payload.arg.files.length)throw Error("Invalid response: file_id must be present in FileInfo for get_preview_data_batch");i.file.file_id=t.payload.arg.files[0].file_id}return i.preview&&(e[r.serialized]=Object.assign(Object.assign({},i.preview),{previewType:te(i.preview)})),null!=i.err&&(e[r.serialized]=Object.assign(Object.assign({},e[r.serialized]),{previewType:o.PreviewType.Error,error:new zr(bn(i.err),`Got error from preview api: ${i.err[".tag"]}`)})),e}),{}))}case Oe.RefreshBlobSuccess:{if(!t.payload)return e;const{previewKey:r,preview:n}=t.payload;if(Xr(r))return e;const a=r.serialized,o=null===(i=e[a])||void 0===i?void 0:i.content;return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({previewType:te(e[a])},e[a]),{content:Object.assign(Object.assign({".tag":"ssr_doc"},o),n)})})}}return e},archiveFiles:(e=xn,t)=>{var i;switch(t.type){case dt:case mt:{const i=t.meta.rootFileId,r=c.cloneDeep(e);if(null==r[i]&&(r[i]={}),!t.payload||!t.payload.result)return r;for(const e of t.payload.result.archive_files)r[i]=Object.assign(Object.assign({},r[i]),{[e.subpath]:Object.assign(Object.assign({},e.preview),{previewType:te(e.preview,e.filename)})});return r}case Oe.SetArchiveFiles:{const{rootFileId:i,files:r}=t.payload;return Object.assign(Object.assign({},e),{[i]:r})}case Oe.SetPreviewMetadata:if(Xr(t.payload.previewKey)){const{rootFileId:r,subpath:n}=t.payload.previewKey;return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},e[r]),{[n]:Object.assign(Object.assign({previewType:te(t.payload)},null===(i=e[r])||void 0===i?void 0:i[n]),t.payload)})})}}return e},fileMetadata:(e=Pn,t)=>{const{payload:i}=t;if(!i)return e;if(t.type===Oe.InitializeFilePreview){const i=t.payload.fileInfo.file_id,r=t.payload.fileInfo.previewKey.serialized;return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},e[r]),{file_id:i,file_name:t.payload.fileName,size:t.payload.fileInfo.size,timeRange:t.payload.timeRange})})}if(t.type===Oe.SetFileMetadata){const i=t.payload.previewKey.serialized;return Object.assign(Object.assign({},e),{[i]:t.payload})}return e},rivieraData:(e=En,t)=>{var i;const{payload:r}=t;if(!r)return e;switch(t.type){case Oe.SetRivieraData:{const{previewKey:i,data:r}=t.payload;if(r)return Object.assign(Object.assign({},e),{[i.serialized]:r});break}case Oe.FetchPageDataWithMetadataResult:{const r=t.payload.previewKey.serialized,n=rn(e[r]),a=null!==(i=null==n?void 0:n.pages)&&void 0!==i?i:[],o=null==n?void 0:n.isPasswordProtected,{metadata:s,pages:l,isPasswordProtected:c,needsPassword:d}=t.payload.data;if(!s)return e;let u=a||new Array(s.page_count);return Array.isArray(l)&&l.length&&(u=[...u],l.forEach((e=>u[e.pageIndex]=Object.assign(Object.assign({},u[e.pageIndex]),e)))),Object.assign(Object.assign({},e),{[r]:{isPasswordProtected:o||c,needsPassword:d,metadata:s,pages:u}})}case Oe.FetchExcelSheetLayoutData:{const i=t.payload.previewKey.serialized,r=e[i];if(null!=r&&"workbook"in r){if(!en(r))break;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{sheets:Object.assign(Object.assign({},r.sheets),{[t.payload.sheetIndex]:{state:"pending"}})})})}return Object.assign(Object.assign({},e),{[i]:{sheets:{[t.payload.sheetIndex]:{state:"pending"}},workbook:{state:"pending"}}})}case Oe.FetchExcelSheetLayoutDataResult:{const i=t.payload.previewKey.serialized,{sheetIndex:r,data:n}=t.payload,a=e[i],o=en(a)?a.sheets:{};if(n)return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},a),{sheets:Object.assign(Object.assign({},o),{[r]:pn(n.sheets[r])}),workbook:wn(n)})});if(t.error){const n=en(a)&&"loaded"===a.workbook.state?a.workbook:un(t.error);return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},a),{sheets:Object.assign(Object.assign({},o),{[r]:un(t.error)}),workbook:n})})}break}case Oe.FetchTranscriptData:{const i=t.payload.previewKey.serialized,r=nn(e[i]);if(r)return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{transcript:{state:"pending"}})});break}case Oe.FetchTranscriptDataResult:{const i=t.payload.previewKey.serialized,r=e[i],n=t.payload.transcript;if(!r)return e;if(t.error)return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{transcript:un(t.error)})});if(n)return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{transcript:pn(n)})});break}case Oe.StartTranscriptGenerating:{const i=t.payload.previewKey.serialized,r=e[i];if(r)return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{transcript:{state:"pending"}})});break}case Oe.SetTranscriptError:{const i=t.payload.previewKey.serialized,r=e[i],n=t.error;if(n&&r)return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{transcript:un(n)})});break}}return e},cloudDocsData:(e=Sn,t)=>{const{payload:i,type:r,error:n}=t;if(r===Zt){if(n)return Object.assign(Object.assign({},e),{[t.payload.arg.file_id]:un(n)});if(null==i?void 0:i.result)return Object.assign(Object.assign({},e),{[t.payload.arg.file_id]:pn(i.result)})}return e},filePreviewUi:(e=In,t)=>{var i,r,n,a,o,s,l;if(!t.payload)return e;if(t.type===Oe.InitializeFileViewer)return Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:{}});let d;if(t.type===Oe.InitializeFilePreview)d=t.payload.fileInfo.previewKey.serialized;else{if(!t.payload.previewKey)return e;d=t.payload.previewKey.serialized}const u=t.payload.fileViewerId,p=e[u]||{},v=p[d]||{},g=dn(v);switch(t.type){case Oe.InitializeFilePreview:{const{previewType:i,fileExtension:r}=t.payload,n=Zn(i,r);return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},n),v)})})}case Oe.InitializeNestedArchiveFilePreview:{const{previewType:i,currentPath:r}=t.payload,n=Zn(i);return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign(Object.assign({},n),{currentPath:r}),v)})})}case Oe.PageNavigation:{const{sourceContext:i,pageIndex:r,centerOnYOffset:n}=t.payload;return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{pageNavigation:{sourceContext:i,pageIndex:r,centerOnYOffset:n}})})})}case Oe.ResolvePageNavigation:return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{pageNavigation:void 0})})});case Oe.UpdateDocCurrentPageIndex:const{pageCount:_}=t.payload;let{pageIndex:f}=t.payload;return f<0?f=0:_&&f>=_-1&&(f=_-1),Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{currentPageIndex:f})})});case Oe.PageUp:{const t=null!==(r=null===(i=ln(v))||void 0===i?void 0:i.currentPageIndex)&&void 0!==r?r:null;if(t)return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{currentPageIndex:Math.max(t-1,0)})})});break}case Oe.PageDown:{const i=null!==(a=null===(n=ln(v))||void 0===n?void 0:n.currentPageIndex)&&void 0!==a?a:null;if(i)return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{currentPageIndex:Math.min(i+1,t.payload.pageCount||1)})})});break}case Oe.ZoomIn:{if(null==g)return e;const i=null!==(o=g.zoomScaleFactor)&&void 0!==o?o:g.fitScaleFactor;return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{zoomScaleFactor:qn({scaleFactor:i,ascend:!0,previewType:t.payload.previewType,fitScaleFactor:g.fitScaleFactor})})})})}case Oe.ZoomOut:{if(null==g)return e;const i=null!==(s=g.zoomScaleFactor)&&void 0!==s?s:g.fitScaleFactor;return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{zoomScaleFactor:qn({scaleFactor:i,ascend:!1,previewType:t.payload.previewType,fitScaleFactor:g.fitScaleFactor})})})})}case Oe.ZoomToggleOriginalOrFit:{if(null==g)return e;const i=null!==(l=g.zoomScaleFactor)&&void 0!==l?l:g.fitScaleFactor,r=i===g.fitScaleFactor?1:void 0,n=(null==g?void 0:g.storedFitScaleFactor)&&1===i?null==g?void 0:g.storedFitScaleFactor:void 0,a=t.payload.fitOnly?void 0:n||r;return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{zoomScaleFactor:a})})})}case Oe.UpdateFitScaleFactor:{if(null==g)return e;const{fitScaleFactor:i}=g;return i===t.payload.fitScaleFactor?e:Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{storedFitScaleFactor:t.payload.storedFitScaleFactor,fitScaleFactor:t.payload.fitScaleFactor})})})}case Oe.UpdateDimensions:return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{dimensions:t.payload.dimensions})})});case Oe.SwitchWorkbookTab:return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{currentTabIndex:t.payload.tabIndex})})});case Oe.UpdateArchiveFileCurrentPath:return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{currentPath:t.payload.currentPath})})});case Oe.UpdateAudioVideoPlaybackState:const w=c.pick(t.payload,"currentTimestamp","isPlaying");return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),w)})});case Oe.SetIsClosedCaptionShowing:return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{isClosedCaptionShowing:t.payload.showing})})});case Oe.SetIsTranscriptShowing:return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{isTranscriptShowing:t.payload.showing})})});case Oe.SetIsDefaultAudioTrackSelected:return Object.assign(Object.assign({},e),{[u]:Object.assign(Object.assign({},p),{[d]:Object.assign(Object.assign({},v),{isDefaultAudioTrackSelected:t.payload.isDefaultAudioTrackSelected})})})}return e},fileViewerUi:(e=On,t)=>{if(!t.payload)return e;const{fileViewerId:i}=t.payload;if(t.type===Oe.InitializeFileViewer)return Object.assign(Object.assign({},e),{[i]:zn});const r=e[i];if(!r)return e;switch(t.type){case Oe.OpenRightRail:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isRightRailOpen:!0})});case Oe.CloseRightRail:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isRightRailOpen:!1})});case Oe.OpenDocSidebar:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isDocSidebarOpen:!0})});case Oe.CloseDocSidebar:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isDocSidebarOpen:!1})});case Oe.EnterFullScreen:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isFullScreen:!0})});case Oe.ExitFullScreen:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isFullScreen:!1})});case Oe.ToggleVideoFrameSteppers:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{showVideoFrameSteppers:t.payload.enabled})});case Oe.FlipToNextFile:case Oe.FlipToPreviousFile:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{hasBeenFlipped:!0})});case Oe.EditVideo:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isEditingVideo:!0})});case Oe.CancelEditingVideo:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isEditingVideo:!1})});case Oe.SetPreviewLoadingAction:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isPreviewLoading:t.payload.isPreviewLoading})});case Oe.SetDeleteFileModalOpen:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isDeleteFileModalOpen:t.payload.isOpen})});case Oe.SetToolbarRenameActive:return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{isToolbarRenameActive:t.payload.isActive,isRenameInitiatedFromOverflow:t.payload.isRenameInitiatedFromOverflow})});case Oe.OverrideFloatingToolbar:{const{state:n,internal:a,pluginId:o}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{toolbar:Object.assign(Object.assign({},r.toolbar),{override:n,overridePluginId:a?"fvsdk":o})})})}default:return e}},loggingSession:(e=Fn,t)=>{if(t.type===Oe.InitializeFilePreviewSession){const{fileViewerId:i,sourceSession:r}=t.payload;return Object.assign(Object.assign({},e),{[i]:Br({file_viewer_session_id:t.payload.fileViewerId,file_preview_session_id:Lr(),file_id:t.payload.fileId,sj_id:t.payload.sjId,ns_id:t.payload.nsId,device_type:t.payload.deviceType,file_extension:ee(t.payload.fileExtension),extra:r})})}if(t.type===Kr.UpdateSession)return Object.assign(Object.assign({},e),{[t.payload.file_viewer_session_id]:t.payload});if(t.type===Oe.InitializeFilePreview){const{payload:{fileViewerId:i,fileInfo:r,previewType:n}}=t,a=e[i];return a?Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},a),{file_id:r.file_id,ns_id:r.ns_id,extra:Object.assign(Object.assign({},a.extra),{preview_type:n})})}):e}return e},rootFileInfo:(e=Tn,t)=>{var i;switch(t.type){case Oe.SetRootFilePreview:const{previewKey:r,fileInfo:n}=t.payload,a=null!==(i=n.file_id)&&void 0!==i?i:"fakeFileId";return Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:Object.assign(Object.assign({fileId:a,previewKey:r},t.payload.fileInfo),{bootstrap:{state:"initializing"}})});case pt:if(t.payload.result){const i={},r=t.meta.previewKey;for(const n of Object.keys(e)){const a=e[n];for(const e of t.payload.result.results)if((null==a?void 0:a.previewKey)===r){const t=e.file;i[n]=Object.assign(Object.assign({},t),{bootstrap:{state:"initializing"},previewKey:r})}}if(Object.keys(i).length>0)return Object.assign(Object.assign({},e),i)}return e;case Oe.SetBootstrappedFile:{const i=e[t.payload.fileViewerId];if((null==i?void 0:i.previewKey.serialized)===t.payload.previewKey.serialized)return Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:Object.assign(Object.assign({},i),{bootstrap:{state:"ready"}})});break}case Oe.SetErroredFile:{const i=e[t.payload.fileViewerId];if((null==i?void 0:i.previewKey.serialized)===t.payload.previewKey.serialized)return Object.assign(Object.assign({},e),{[t.payload.fileViewerId]:Object.assign(Object.assign({},i),{bootstrap:{state:"errored",error:t.payload.error}})});break}}return e},fileContentMetadata:(e=Cn,t)=>{if(t.type===a.Action.GetFileContentMetadataResult&&t.payload.result){const i=(e=>{if(!e.meta)throw new Error(`missing meta argument to action ${e.type}`);return e.meta})(t).previewKey;return Object.assign(Object.assign({},e),{[i.serialized]:t.payload.result})}return e},plugins:(e=Rn,t)=>{var i,r,n;if(t.type===Oe.InitializeFileViewer){const{fileViewerId:i,pluginParams:r}=t.payload,{activeEditPlugin:n,editActivationParams:a}=r;return Object.assign(Object.assign({},e),{[i]:{activeRightRailPluginId:void 0,activeEditPluginId:n,hideContentPanePluginId:void 0,editPluginActivationParams:a,rightRailPluginActivationParams:void 0}})}if(t.type===Oe.SetErroredFile){const{fileViewerId:i}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{activeEditPluginId:void 0})})}if(t.type===Oe.SetActiveRightRailPlugin){const{fileViewerId:i,pluginId:r,pluginActivationParams:n}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{activeRightRailPluginId:r,rightRailPluginActivationParams:n})})}if(t.type===Oe.FlipToNextFile||t.type===Oe.FlipToPreviousFile){const{fileViewerId:r}=t.payload;if((null===(i=e[r])||void 0===i?void 0:i.activeRightRailPluginId)===G)return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},e[r]),{activeRightRailPluginId:H})})}if(t.type===Oe.SetActiveEditPlugin){const{fileViewerId:i,pluginId:r,pluginActivationParams:n}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{activeEditPluginId:r,editPluginActivationParams:n})})}if(t.type===Oe.HideContentPane){const{fileViewerId:i,pluginId:r}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{hideContentPanePluginId:r})})}if(t.type===Oe.SetLeftSidebarPlugin){const{fileViewerId:i,pluginId:n}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{sidebarPlugins:Object.assign(Object.assign({},null===(r=e[i])||void 0===r?void 0:r.sidebarPlugins),{left:n})})})}if(t.type===Oe.SetRightSidebarPlugin){const{fileViewerId:i,pluginId:r}=t.payload;return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},e[i]),{sidebarPlugins:Object.assign(Object.assign({},null===(n=e[i])||void 0===n?void 0:n.sidebarPlugins),{right:r})})})}return e},sharedLinkInfo:(e=jn,t)=>{const{payload:i,type:r}=t;if(r===Oe.SetSharedLinkInfo){const t=i.previewKey.serialized;return Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign({},e[t]),i)})}return e},videoRequests:(e=kn,t)=>{switch(t.type){case Oe.RequestVideoSeek:return[...e,{videoRequestType:"seek",time:t.payload.time}];case Oe.RequestVideoSeekRelative:return[...e,{videoRequestType:"seekRelative",delta:t.payload.delta}];case Oe.RequestVideoPause:return[...e,{videoRequestType:"pause"}];case Oe.ClearVideoRequests:return[];default:return e}},volume:(e=Vn,t)=>{switch(t.type){case Oe.SetVolume:return Object.assign(Object.assign({},e),{volume:t.payload.volume});case Oe.SetMuted:return Object.assign(Object.assign({},e),{muted:t.payload.muted});default:return e}},brandingInfo:(e=Dn,t)=>{const{payload:i,type:r}=t;if(r===Oe.SetBrandingInfo){const t=i.previewKey.serialized;return Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign({},e),i)})}return e},fileViewerState:(e=An,t)=>{const{payload:i,type:r}=t;if(r===Oe.SetFileViewerError){const{error:t,fileViewerId:r}=i;return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},e[r]),{error:t})})}return e}};var Qn;t.RivieraStatus=void 0,(Qn=t.RivieraStatus||(t.RivieraStatus={}))[Qn.Unknown=0]="Unknown",Qn[Qn.OK=1]="OK",Qn[Qn.ConversionFailure=2]="ConversionFailure",Qn[Qn.TemporaryFailure=3]="TemporaryFailure",Qn[Qn.InternalFailure=4]="InternalFailure",Qn[Qn.UnsupportedFormat=5]="UnsupportedFormat",Qn[Qn.Timeout=6]="Timeout",Qn[Qn.TooBig=7]="TooBig",Qn[Qn.InvalidMetadata=8]="InvalidMetadata",Qn[Qn.SourceCorrupt=9]="SourceCorrupt",Qn[Qn.TimeBudgetExceeded=10]="TimeBudgetExceeded",Qn[Qn.NotFound=11]="NotFound",Qn[Qn.PasswordProtected=12]="PasswordProtected",Qn[Qn.InvalidRequest=13]="InvalidRequest",Qn[Qn.VirusDetected=14]="VirusDetected",Qn[Qn.BlockMissing=15]="BlockMissing",Qn[Qn.FeatureDisabled=16]="FeatureDisabled";class Yn extends Error{constructor(e,i=t.RivieraStatus.Unknown){super(e),this.statusCode=i}}class Jn extends Yn{constructor(e="error_unknown",i=t.RivieraStatus.Unknown){super(e),this.statusCode=i,this.transcriptError=e}}function ea(e,i,r){return 401===e&&r?new Yn("Password required",t.RivieraStatus.PasswordProtected):new Yn("Load Error",i.rivieraStatusCode)}const ta=e=>i.__awaiter(void 0,void 0,void 0,(function*(){return null==e?void 0:e.json()})),ia=(...e)=>i.__awaiter(void 0,void 0,void 0,(function*(){return ra(ta,e)})),ra=(e,t)=>i.__awaiter(void 0,void 0,void 0,(function*(){var i,r,n,a;let o;try{o=yield fetch(...t)}catch(e){o=void 0}const s=null!==(i=null==o?void 0:o.ok)&&void 0!==i&&i,l=null!==(r=null==o?void 0:o.status)&&void 0!==r?r:400,c=(e=>{let t={};try{e&&(t=JSON.parse(e))}catch(e){}return t})(null!==(n=null==o?void 0:o.headers.get("x-dropbox-metadata"))&&void 0!==n?n:void 0),d=null!==(a=null==o?void 0:o.headers.get("x-dropbox-pdf-password-needed"))&&void 0!==a?a:void 0;let u;try{u=yield e(o)}catch(e){u=void 0}if(s&&u)return{data:u};return{error:ea(l,c,"1"===d)}})),na={refreshDocBlob:(e,t)=>ia(e,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({password:t||""}),credentials:"include",method:"POST"}),fetchDocMetadata:(e,t=!1,i=0,r=50,n=!1)=>ia(function(e,t,i=0,r=50,n=!1){const a=new URL(e);return t&&a.searchParams.set("metadata","1"),void 0!==i&&(a.searchParams.set("text","1"),a.searchParams.set("page_start",i.toString()),a.searchParams.set("page_end",r.toString())),n&&a.searchParams.set("canned_file_name","spdf/audi.pdf.json"),a.toString()}(e,t,i,r,n),{headers:{"content-type":"application/json"},credentials:"include"}),fetchExcelWorkbookLayoutData:(e,t)=>ia(function(e,t){if(void 0===t)return e;{const i=new URL(e);return i.searchParams.set("sheet",t+""),i.toString()}}(e,t),{headers:{"content-type":"application/json"},credentials:"include",method:"POST"}),fetchMediaMetadata:e=>ia(e,{credentials:"include"}),fetchWaveformData:e=>ia(e,{credentials:"include"}),fetchTranscriptData(e,r){var n,a;return i.__awaiter(this,void 0,void 0,(function*(){const i=yield ia(e,{credentials:"include",cache:"no-cache"});let o=i.error;return(null==o?void 0:o.statusCode)===t.RivieraStatus.NotFound?r&&"ineligible"!==(null==r?void 0:r[".tag"])||(o=new Jn("insufficient_permissions",t.RivieraStatus.Unknown)):o||0!==(null===(a=null===(n=i.data)||void 0===n?void 0:n.segments)||void 0===a?void 0:a.length)||(o=new Jn("no_speech",t.RivieraStatus.Unknown)),o?{error:o}:i}))},fetchLinkfileData:(e,t)=>ia(e,{credentials:t?"include":"omit",headers:{"content-type":"application/json"},method:"POST"}),fetchArchiveTopLevelData:e=>ia(e,{headers:{"content-type":"application/json"},credentials:"include",method:"POST"}),fetchPageDataWithMetadata(e,r,n,a){return i.__awaiter(this,void 0,void 0,(function*(){const{textUrlTmpl:i,imageUrlTmpl:o,supportedWidths:s}=e,{metadata:l,pages:c}=a&&"metadata"in a&&!a.isPasswordProtected?a:{metadata:void 0,pages:void 0},d=yield na.fetchDocMetadata(i,!l,r,n);if(d.error&&d.error.statusCode===t.RivieraStatus.PasswordProtected)return{data:{isPasswordProtected:!0,needsPassword:!0,pages:[],metadata:{page_count:0,dimensions:[]}}};if(d.error)return d;const u=null!=l?l:d.data.metadata;if(!u)return{error:new Yn("Response from riviera ssr_doc has no metadata and we also have no existing metadata",t.RivieraStatus.InvalidRequest)};const p=u.page_count;return{data:{metadata:u,pages:fn(o,u.dimensions,p,d.data,c,s),isPasswordProtected:!1,needsPassword:!1}}}))},fetchDocImage:({imageUrlTmpl:e,width:i,scalePercent:r,page:n})=>{const a=gn({page:n,imageUrlTmpl:e},r?{scalePercent:r}:{width:i});return new Promise(((e,i)=>{const r=new Image;r.onload=()=>{e({data:a})},r.onerror=()=>{i(new Yn(`Failed to load image ${a}`,t.RivieraStatus.Unknown))},r.src=a}))}};function aa(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}const oa=50;function sa(e,t=!1){let i,r;if(!t||e>35){i=Math.floor(e/oa)*oa;i+oa-e<15&&(i+=oa),r=i+oa}else e<=3?(i=0,r=10):(i=10,r=oa);return[i,r]}function la(e,t){return e.rootFileInfo[t]}const ca=n.createSelector(la,(function(e,t){const i=la(e,t);return i&&ya(e,t,i.previewKey)}),fa,((e,t,i)=>{var r;const n=tn(i);if(!(null==e?void 0:e.file_id)||!n||!(null==t?void 0:t.currentPath)||0===t.currentPath.length)return null==e?void 0:e.previewKey;const a=Jr(t.currentPath);return(null===(r=n.entries[a])||void 0===r?void 0:r.isDir)?e.previewKey:Yr(e.file_id,a)})),da=(e,t)=>{const i=ca(e,t),r=la(e,t);return i&&Xr(i)?void 0:r};function ua(e,t){var i;return null===(i=la(e,t))||void 0===i?void 0:i.previewKey}function pa(e,t){return t?Xr(t)?ga(e.archiveFiles,t):e.previewData[t.serialized]:void 0}function va(e,t){var i,r;return null!==(r=null===(i=pa(e,t))||void 0===i?void 0:i.previewType)&&void 0!==r?r:o.PreviewType.Error}function ga(e,t){const i=e[t.rootFileId];if(i)return i[t.subpath]}function _a(e,t){return t&&e.rivieraData[t.serialized]}function fa(e,t){const i=ua(e,t);return i&&e.rivieraData[i.serialized]}function wa(e,t){return t&&e.fileMetadata[t.serialized]}function ma(e,t){const i=la(e,t);return wa(e,null==i?void 0:i.previewKey)}function ya(e,t,i){var r;return i&&(null===(r=e.filePreviewUi[t])||void 0===r?void 0:r[i.serialized])}function ba(e,t){return ya(e,t,ca(e,t))}function ha(e,t){var i,r;const n=ua(e,t),a=wa(e,n),o=ca(e,t);if(!o||!Xr(o))return a;const s=null===(i=tn(_a(e,n)))||void 0===i?void 0:i.entries[o.subpath];return a&&s&&!s.isDir?{file_name:s.name,file_collection_context:a.file_collection_context,size:null!==(r=s.size)&&void 0!==r?r:0}:a}function xa(e,t){return e.fileViewerUi[t]}function Pa(e){return e.zoomScaleFactor||e.fitScaleFactor}function Ea(e,t){const i=ba(e,t);if(!i)return!1;const r=dn(i);if(null==r)return!1;const{zoomScaleFactor:n,fitScaleFactor:a}=r;return!!n&&n>a}function Sa(e,t){var i;return null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.isRightRailOpen}function Ia(e,t){var i;const r=xa(e,t);return null!==(i=null==r?void 0:r.isFullScreen)&&void 0!==i&&i}function Oa(e,t){var i;const r=xa(e,t);return null!==(i=null==r?void 0:r.hasBeenFlipped)&&void 0!==i&&i}function Ta(e,t){return t&&e.fileContentMetadata[t.serialized]}function Fa(e,t){var i;return null===(i=nn(e.rivieraData[t.serialized]))||void 0===i?void 0:i.transcript}function Ca(e,t){var i;return t?null===(i=e.loggingSession[t])||void 0===i?void 0:i.file_preview_session_id:void 0}function Ra(e,t){return e.loggingSession[t]}function ja(e,t){const i=xa(e,t);return!!(null==i?void 0:i.isEditingVideo)}function ka(e,t){const i=ua(e,t);return i&&e.sharedLinkInfo[i.serialized]}function Va(e,t){var i;return!!(null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.isPreviewLoading)}function Da(e,t){var i;return!!(null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.isDeleteFileModalOpen)}const Aa=e=>"video"===(null==e?void 0:e[".tag"])?e.transcript_permission:{".tag":"ineligible"},Ma=(e,t)=>"opted_in"===(null==e?void 0:e[".tag"])&&(e=>!!e&&"pending"!==e.state&&"loaded"!==e.state&&!Na(e))(t),Na=e=>"errored"===(null==e?void 0:e.state)&&e.error.statusCode!==t.RivieraStatus.NotFound,La=e=>{var t;return e&&"loaded"===e.state&&(null===(t=e.data)||void 0===t?void 0:t.segments)&&e.data.segments.length>0},Ua=({getState:e,dispatch:r})=>n=>a=>i.__awaiter(void 0,void 0,void 0,(function*(){var i,s,l,c,d,u;const p=e();switch(a.type){case Oe.FetchPageDataWithMetadata:{const{textUrlTmpl:e,startPage:r,endPage:s,previewKey:l,fileViewerId:c}=a.payload,d=null===(i=pa(p,l))||void 0===i?void 0:i.content,u=_a(p,l);if(!d||!("image_url_tmpl"in d)||!d.image_url_tmpl)return n(a);const v=yield na.fetchPageDataWithMetadata({supportedWidths:"supported_widths"in d?d.supported_widths:void 0,imageUrlTmpl:d.image_url_tmpl,textUrlTmpl:e},r,s,u);return v.error?n(Ze({previewKey:l,previewType:o.PreviewType.Error,error:new zr(t.FVErrorCode.RivieraDataFetchFailure,v.error.message)})):n(je({fileViewerId:c,previewKey:l,data:v.data}))}case Oe.FetchTranscriptData:{const e=a.payload.previewKey;if(Xr(e))return n(a);$r(!!p.previewData[e.serialized],t.FVErrorCode.InvalidFileInfo,`Preview Data for ${e.serialized} should have been available`);const i=pa(p,e),r=Aa(null==i?void 0:i.content),o=yield na.fetchTranscriptData(a.payload.url,r),c=Object.assign({segments:null!==(l=null===(s=o.data)||void 0===s?void 0:s.segments)&&void 0!==l?l:[]},o.data);return n((v={transcript:c,previewKey:e},g=o.error,{type:Oe.FetchTranscriptDataResult,payload:v,error:g}))}case Oe.RefreshBlob:{const{previewKey:e,fileViewerId:i}=a.payload,s=pa(p,e),l=yield na.refreshDocBlob(a.payload.refreshUrl,a.payload.password);if((null===(c=l.error)||void 0===c?void 0:c.statusCode)===t.RivieraStatus.PasswordProtected)return n(je({fileViewerId:i,previewKey:e,data:{pages:[],metadata:{page_count:0,dimensions:[]},isPasswordProtected:!0,needsPassword:!0}}));if(l.error)return n(Ze({previewKey:e,previewType:o.PreviewType.Error,error:new zr(t.FVErrorCode.RivieraDataFetchFailure,l.error.message)}));const v=l.data;if(n(function(e){return{payload:e,type:Oe.RefreshBlobSuccess}}({previewKey:e,preview:{text_url_tmpl:v.text,image_url_tmpl:v.image,refresh_url:v.refresh}})),!s)return n(Ze({previewKey:e,previewType:o.PreviewType.Error,error:new zr(t.FVErrorCode.InvalidFileInfo,`Preview Data for ${e.serialized} should have been available`)}));if(a.payload.password)return r(Re({fileViewerId:i,previewKey:e,textUrlTmpl:v.text}));const g=sa(null!==(u=null===(d=ln(ya(p,a.payload.fileViewerId,e)))||void 0===d?void 0:d.currentPageIndex)&&void 0!==u?u:0);return r(Re({fileViewerId:i,previewKey:e,textUrlTmpl:v.text,startPage:g[0],endPage:g[1]}))}case Oe.FetchExcelSheetLayoutData:{n(a);const{sheetIndex:e,workbookDataUrlTmpl:t,previewKey:i,fileViewerId:o}=a.payload,s=yield na.fetchExcelWorkbookLayoutData(t,e);return r(function(e,t){return{type:Oe.FetchExcelSheetLayoutDataResult,payload:e,error:t}}({fileViewerId:o,previewKey:i,sheetIndex:e,data:s.data},s.error))}}var v,g;return n(a)}));function Ka(e){return Object.keys(e).reduce(((t,i)=>{const r=e[i];return"string"==typeof r||"number"==typeof r?t[i]=String(r):"boolean"==typeof r?t[i]=String(+r):"object"==typeof r&&r&&(t[i]=JSON.stringify(r)),t}),{})}function za(e){return Object.assign(Object.assign({},e),{file_extension:ee(e.file_extension||""),extra:Ka(e.extra)})}const $a=(e,t,i)=>{const{fileViewerId:r,previewSessionId:n,videoFormat:a,videoDuration:o,videoTruncated:s,extra:l}=e;return{file_viewer_session_id:r,file_preview_session_id:n,video_format:a,video_duration_seconds:o,video_truncated:s,source_context:t.extra.source_context,ns_id:t.ns_id,sj_id:t.sj_id,device_type:t.device_type,preview_type:i,redesign2023Variant:t.extra.redesign2023Variant,extra:l}},Ba={[Oe.ZoomIn]:l.UserAction.ZoomIn,[Oe.ZoomOut]:l.UserAction.ZoomOut,[Oe.CloseDocSidebar]:l.UserAction.CloseDocSidebar,[Oe.OpenDocSidebar]:l.UserAction.OpenDocSidebar,[Oe.ZoomToggleOriginalOrFit]:l.UserAction.ZoomToggleOriginalOrFit,[Oe.UpdateDocCurrentPageIndex]:l.UserAction.PageJump,[Oe.PageDown]:l.UserAction.PageDown,[Oe.PageUp]:l.UserAction.PageUp,[Oe.Share]:l.UserAction.Share,[Oe.Restore]:l.UserAction.Restore,[Oe.OpenWith]:l.UserAction.OpenWith,[Oe.OpenWebPreview]:l.UserAction.OpenWebPreview,[Oe.FlipToNextFile]:l.UserAction.FlipNext,[Oe.FlipToPreviousFile]:l.UserAction.FlipPrevious,[Oe.CloseViewer]:l.UserAction.CloseViewer,[Oe.OpenFullscreenPreview]:l.UserAction.OpenFullscreenPreview,[Oe.OpenVersionHistory]:l.UserAction.OpenVersionHistory,[Oe.OpenRightRail]:l.UserAction.ToggleSidebarOn,[Oe.CloseRightRail]:l.UserAction.ToggleSidebarOff,[Oe.SetLeftSidebarPlugin]:l.UserAction.ToggleSidebarOn,[Oe.SetRightSidebarPlugin]:l.UserAction.ToggleSidebarOn,[Oe.HideContentPane]:l.UserAction.ToggleSidebarOff,[Oe.SwitchWorkbookTab]:l.UserAction.SwitchWorkbookTab,[Oe.CopyToDropbox]:l.UserAction.SaveToDropbox,[Oe.DownloadFile]:l.UserAction.DownloadSuccess,[Oe.Print]:l.UserAction.Print,[Oe.EnterFullScreen]:l.UserAction.ToggleFullscreenOn,[Oe.ExitFullScreen]:l.UserAction.ToggleFullscreenOff,[Oe.ClickDropboxLogo]:l.UserAction.ClickDropboxLogo,[Oe.SetActiveRightRailPlugin]:l.UserAction.SidebarPaneSelected,[Oe.SetMuted]:l.UserAction.SetMuted},Wa=c.lodash(Ba);let Ha;const Ga=(e,i,r)=>{const{payload:{event:n,fileViewerId:a,previewSessionId:o,extra:s}}=r;let c=i.loggingSession[a];if(!c)return r;return o!==c.file_preview_session_id&&o||(c=function(e,i,r){const{extra:{last_event:n}}=e;switch($r(n!==i,t.FVErrorCode.InvalidLoggingOrder,`Cannot log duplicate event ${i}`),i){case l.SessionEventType.FilePreviewSupportConfirmed:case l.SessionEventType.FilePreviewSupportDenied:$r(n===l.SessionEventType.FilePreviewAttemptStarted,t.FVErrorCode.InvalidLoggingOrder,`Event ${i} out of order, expect \`last_event\` to be '${l.SessionEventType.FilePreviewAttemptStarted}' but was '${n}'`);break;case l.SessionEventType.FilePreviewDownloadAttempted:$r(n===l.SessionEventType.FilePreviewSupportConfirmed,t.FVErrorCode.InvalidLoggingOrder,`Event ${i} out of order, expect \`last_event\` to be '${l.SessionEventType.FilePreviewSupportConfirmed}' but was '${n}'`);break;case l.SessionEventType.FilePreviewDownloadFailed:case l.SessionEventType.FilePreviewDownloadSucceeded:$r(n===l.SessionEventType.FilePreviewDownloadAttempted,t.FVErrorCode.InvalidLoggingOrder,`Event ${i} out of order, expect \`last_event\` to be '${l.SessionEventType.FilePreviewDownloadAttempted}' but was '${n}'`);break;case l.SessionEventType.FilePreviewRenderSucceeded:case l.SessionEventType.FilePreviewRenderFailed:$r(n===l.SessionEventType.FilePreviewDownloadSucceeded||n===l.SessionEventType.FilePreviewDownloadAttempted,t.FVErrorCode.InvalidLoggingOrder,`Event ${i} out of order, expect \`last_event\` to be '${l.SessionEventType.FilePreviewDownloadSucceeded}' but was '${n}'`)}return Object.assign(Object.assign({},e),{extra:Object.assign(Object.assign(Object.assign({},e.extra),{file_preview_timeline:Object.assign(Object.assign({},e.extra.file_preview_timeline),{[i]:Date.now()})}),r||{})})}(c,n,s),e.log(n,za(c)),c=function(e,t){return Object.assign(Object.assign({},e),{extra:Object.assign(Object.assign({},e.extra),{last_event:t})})}(c,n)),qr(c)},qa=(e,i,r)=>{let n=i.loggingSession[r.payload];return n?(n=function(e){const i=Object.assign({},e.extra);if(i.time_to_primary_mark)return e;switch(i.primary_mark_ts||(i.primary_mark_ts=Date.now()),i.source_action){case l.SourceAction.Visit:$r(!!i.page_start_ts,t.FVErrorCode.InvalidLoggingSession,"Cannot calculate 1st page TTI without page_start_ts"),i.time_to_primary_mark=i.primary_mark_ts-i.page_start_ts;break;case l.SourceAction.Click:$r(i.file_preview_timeline&&!!i.file_preview_timeline.preview_attempted,t.FVErrorCode.InvalidLoggingSession,"Cannot calculate subsequent page TTI without preview_attempted timestamp"),i.time_to_primary_mark=i.primary_mark_ts-i.file_preview_timeline.preview_attempted}return Object.assign(Object.assign({},e),{extra:i})}(n),e.logTTI(),qr(n)):r};function Za(e){return({getState:i,dispatch:r})=>n=>a=>{var s,c;try{switch(a.type){case Kr.LogSessionEvent:return n(Ga(e,i(),a));case Kr.Log:return n(((e,t,i)=>{const{payload:r}=i,{event:n,fileViewerId:a}=r,o=t.loggingSession[a];return o?(e.log(n,za(Object.assign(Object.assign({},o),{extra:Object.assign(Object.assign({},(null==o?void 0:o.extra.source_context)&&{source_context:o.extra.source_context}),r.extra)}))),qr(o)):i})(e,i(),a));case Kr.LogVideoEvent:return void 0!==e.logVideoEvent?n(((e,i,r)=>{const{payload:n}=r,{eventName:a,fileViewerId:s,previewSessionId:l}=n,c=i.loggingSession[s];if(!c)return r;const d=c.file_preview_session_id,u=c.extra.preview_type;if(u!==o.PreviewType.Video&&u!==o.PreviewType.Audio)throw new zr(t.FVErrorCode.InvalidLoggingSession,"Can't log video events for non-audio/video previews.");return void 0!==e.logVideoEvent&&l===d&&e.logVideoEvent(a,$a(n,c,u)),qr(c)})(e,i(),a)):n(a);case Kr.LogVideoEventQuantity:return void 0!==e.logVideoEventQuantity?n(((e,i,r)=>{const{payload:n}=r,{eventName:a,fileViewerId:s,previewSessionId:l}=n,c=i.loggingSession[s];if(!c)return r;const d=c.file_preview_session_id,u=c.extra.preview_type;if(u!==o.PreviewType.Video&&u!==o.PreviewType.Audio)throw new zr(t.FVErrorCode.InvalidLoggingSession,"Can't log video events for non-audio/video previews.");return void 0!==e.logVideoEventQuantity&&l===d&&e.logVideoEventQuantity(a,n.quantity,$a(n,c,u)),qr(c)})(e,i(),a)):n(a);case Kr.LogVideoEventDuration:return void 0!==e.logVideoEventDuration?n(((e,i,r)=>{const{payload:n}=r,{eventName:a,fileViewerId:s,previewSessionId:l}=n,c=i.loggingSession[s];if(!c)return r;const d=c.file_preview_session_id,u=c.extra.preview_type;if(u!==o.PreviewType.Video&&u!==o.PreviewType.Audio)throw new zr(t.FVErrorCode.InvalidLoggingSession,"Can't log video events for non-audio/video previews.");return void 0!==e.logVideoEventDuration&&l===d&&e.logVideoEventDuration(a,n.durationInMs,$a(n,c,u)),qr(c)})(e,i(),a)):n(a);case Kr.LogUserAction:return n(((e,t,i)=>{const{payload:r}=i,{userAction:n,actionContext:a,fileViewerId:o}=r,s=t.loggingSession[o];return n in Wa?console.warn(`WARNING: ${n} is automatically logged when it's in USER_ACTION_MAP. No need to call logUserAction for it.`):s&&e.log(l.EventType.UserAction,za(Object.assign(Object.assign({},s),{extra:Object.assign(Object.assign(Object.assign({},(null==s?void 0:s.extra.source_context)&&{source_context:s.extra.source_context}),r.extra),{action:n,context:a})}))),i})(e,i(),a));case Kr.LogBackgroundEvent:return n(((e,t,i)=>{const{payload:r}=i,{event:n,fileViewerId:a}=r,o=t.loggingSession[a];return o&&e.log(l.EventType.Background,za(Object.assign(Object.assign({},o),{extra:Object.assign(Object.assign(Object.assign({},(null==o?void 0:o.extra.source_context)&&{source_context:o.extra.source_context}),r.extra),{event:n})}))),i})(e,i(),a));case Kr.LogTTI:return n(qa(e,i(),a));case Oe.ExcelSheetRenderFailed:case Oe.ExcelSheetRenderSucceeded:case Oe.FetchExcelSheetLayoutData:case Oe.FetchExcelSheetLayoutDataResult:return n(((e,t,i)=>{const{fileViewerId:r,sheetIndex:n}=i.payload,a=t.loggingSession[r];if(!a)return i;const o=za(Object.assign(Object.assign({},a),{extra:Ka({tab_index:n,ts:Date.now()})}));switch(i.type){case Oe.FetchExcelSheetLayoutData:e.log(l.EventType.ExcelSheetDownloadAttempted,o);break;case Oe.FetchExcelSheetLayoutDataResult:null!=i.error?e.log(l.EventType.ExcelSheetDownloadFailed,o):e.log(l.EventType.ExcelSheetDownloadSucceeded,o);break;case Oe.ExcelSheetRenderFailed:e.log(l.EventType.ExcelSheetRenderFailed,o);break;case Oe.ExcelSheetRenderSucceeded:e.log(l.EventType.ExcelSheetRenderSucceeded,o)}return i})(e,i(),a));case Oe.UpdateArchiveFileCurrentPath:return n(((e,t,i)=>{const{fileViewerId:r,currentPath:n,isDir:a}=i.payload,o=t.loggingSession[r];if(void 0!==a&&o){const t=za(Object.assign(Object.assign({},o),{extra:Ka({action:l.UserAction.ArchiveNavigation,context:l.UserActionContext.PreviewContentMain,isDir:String(a),extension:a?"":ee(h(n[n.length-1]))})}));e.log(l.EventType.UserAction,t)}return i})(e,i(),a));case Kr.LogDuration:return n(((e,t,i)=>{var r;const{eventName:n,duration:a,fileViewerId:o,tags:s,shouldLogToHive:l}=i.payload,c=t.loggingSession[o];return c&&(null===(r=e.logDuration)||void 0===r||r.call(e,{eventName:n,durationInMs:a,session:c?za(c):void 0,tags:s,shouldLogToHive:l})),i})(e,i(),a));case Oe.SetupGetPlayDurationSeconds:return void(Ha=a.payload.getPlayDurationSeconds)}if(a.type in Ba&&!a.payload.skipLogging)return n(((e,t,i)=>{var r,n,a,o;const{fileViewerId:s,sourceContext:c}=i.payload,{loggingSession:d}=t,u=d[s],p=Sa(t,s);let v={context:c,action:Ba[i.type],right_sidebar_state:p?"opened":"collapsed"};if(i.type===Oe.SwitchWorkbookTab)v.tab_index=i.payload.tabIndex;else if(i.type===Oe.SetActiveRightRailPlugin)v.selected_pane=i.payload.pluginId,performance.mark(l.PreviewsTimer.SidebarContentsMount);else if(i.type===Oe.SetRightSidebarPlugin)i.payload.pluginId?v.selected_pane=i.payload.pluginId:v.previous_selected_pane=null===(n=null===(r=t.plugins[s])||void 0===r?void 0:r.sidebarPlugins)||void 0===n?void 0:n.right;else if(i.type===Oe.OpenRightRail)v.selected_pane=null===(a=t.plugins[s])||void 0===a?void 0:a.activeRightRailPluginId;else if(i.type===Oe.CloseViewer){const e=ba(t,s);if(e&&cn(e)&&Ha){const e=Ha();v=Object.assign(Object.assign({},v),e)}const i=nn(fa(t,s));"loaded"===(null===(o=null==i?void 0:i.transcript)||void 0===o?void 0:o.state)&&(v.transcript_locale=i.transcript.data.transcriptLocale)}return e.log(l.EventType.UserAction,za(Object.assign(Object.assign({},u),{extra:Ka(v)}))),i.type!==Oe.OpenRightRail&&i.type!==Oe.SetLeftSidebarPlugin&&i.type!==Oe.SetRightSidebarPlugin||performance.mark(l.PreviewsTimer.SidebarContentsMount),i})(e,i(),a))}catch(e){if(e instanceof Error){const n=("object"==typeof a.payload&&"fileViewerId"in a.payload?null===(s=i().loggingSession[a.payload.fileViewerId])||void 0===s?void 0:s.extra.preview_type:"other")||"other";r(ot({error:e,fileType:n,isCritical:(c=e,!yn(c)||c.type!==t.FVErrorCode.InvalidLoggingOrder&&c.type!==t.FVErrorCode.InvalidLoggingSession)})),console.warn(e.message)}}return n(a)}}const Xa=({getState:e})=>t=>i=>{var r;const n=e(),{filePreviewUi:a,rivieraData:s}=n,{previewKey:l,fileViewerId:c}=i.payload;if(!l)return t(i);const d=pa(n,l),u=s[l.serialized];if(!a[c]||!d||!d.content)return t(i);if(!(null===(r=a[c])||void 0===r?void 0:r[l.serialized]))return t(i);switch(i.type){case Oe.ZoomIn:return t(De(Object.assign(Object.assign({},i.payload),{previewType:"ssr_doc"===d.content[".tag"]?o.PreviewType.SsrDoc:o.PreviewType.Image})));case Oe.ZoomOut:return t(Ae(Object.assign(Object.assign({},i.payload),{previewType:"ssr_doc"===d.content[".tag"]?o.PreviewType.SsrDoc:o.PreviewType.Image})));case Oe.UpdateDocCurrentPageIndex:{const e=rn(u);if((d.content[".tag"]===o.PreviewType.SsrDoc||d.content[".tag"]===o.PreviewType.CloudDoc)&&(null==e?void 0:e.metadata))return t(ke(Object.assign(Object.assign({},i.payload),{pageCount:e.metadata.page_count})));break}case Oe.PageDown:{const e=rn(u);if((d.content[".tag"]===o.PreviewType.SsrDoc||d.content[".tag"]===o.PreviewType.CloudDoc)&&(null==e?void 0:e.metadata))return t((p=Object.assign(Object.assign({},i.payload),{pageCount:e.metadata.page_count}),{type:Oe.PageDown,payload:p}));break}}var p;return t(i)};function Qa(e){return({dispatch:t})=>i=>r=>(r.type===Oe.DownloadFile?e.downloadFile():r.type===Oe.CopyToDropbox&&e.copyToDropbox({role:r.payload.role,logModalConfirm:()=>{t(Gr({userAction:l.UserAction.SaveToDropboxApprove,fileViewerId:r.payload.fileViewerId,actionContext:l.UserActionContext.RightRail}))},logModalCancel:()=>{t(Gr({userAction:l.UserAction.SaveToDropboxCancel,fileViewerId:r.payload.fileViewerId,actionContext:l.UserActionContext.RightRail}))}}),i(r))}function Ya(e){return({dispatch:t})=>r=>n=>i.__awaiter(this,void 0,void 0,(function*(){const i=r(n);if(n.type===Oe.Rename&&e.rename){const{newFilename:i,isRenameFromOverflowMenu:r}=n.payload,a=()=>{t(Gr({userAction:l.UserAction.RenameSuccess,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.sourceContext}))},o=()=>{t(Gr({userAction:l.UserAction.RenameFailed,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.sourceContext}))};e.rename({newFilename:i,isRenameFromOverflowMenu:r,onRenameSuccess:a,onRenameFailed:o})}else if(n.type===Oe.Delete&&e.delete){const i=()=>{t(Gr({userAction:l.UserAction.Delete,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.sourceContext,extra:{key:n.payload.key}}))},r=()=>{t(Gr({userAction:l.UserAction.DeleteSuccess,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.sourceContext}))},a=()=>{t(Gr({userAction:l.UserAction.DeleteFailed,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.sourceContext}))},o=()=>{t(Gr({userAction:l.UserAction.DeleteFailedNoPermission,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.sourceContext}))},s=()=>{t(Gr({userAction:l.UserAction.DeleteCancel,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.sourceContext}))},c=e=>{t(Ce({isOpen:e,fileViewerId:n.payload.fileViewerId}))};e.delete({onDelete:i,onDeleteSuccess:r,onDeleteFailed:a,onDeleteFailedNoPermission:o,onDeleteCancel:s,setDeleteFileModalOpen:c})}return i}))}function Ja(e){return({dispatch:t})=>r=>n=>i.__awaiter(this,void 0,void 0,(function*(){const i=r(n);if(n.type===Oe.EnterFullScreen){const{fileViewerId:i,previewKey:r}=n.payload,a=()=>{t($e(Object.assign(Object.assign({},n.payload),{skipAction:!0})))};e.enterFullScreen(a,!!n.payload.skipAction),t(Me({fileViewerId:i,previewKey:r,sourceContext:l.UserActionContext.Toolbar,fitOnly:!0,skipLogging:!0}))}else n.type===Oe.ExitFullScreen&&e.exitFullScreen(!!n.payload.skipAction);return i}))}function eo(e){return({getState:t})=>i=>r=>{var n,a,o,s,l,c;switch(r.type){case Oe.Share:return null===(n=e.openShareModal)||void 0===n||n.call(e),i(r);case Oe.OpenWith:return null===(a=e.openDefaultNativeApp)||void 0===a||a.call(e),i(r);case Oe.OpenWebPreview:return null===(o=e.openWebPreview)||void 0===o||o.call(e),i(r);case Oe.OpenVersionHistory:return e.openVersionHistory(),i(r);case Oe.Restore:return e.restorePreviousVersion(),i(r);case Oe.OpenFullscreenPreview:return e.openFullScreenPreview&&e.openFullScreenPreview(),i(r);case Oe.OpenUrl:const{url:d,fallbackUrl:u}=r.payload;return e.openUrl&&e.openUrl(d,u),i(r);case Oe.CloseViewer:const p=ba(t(),r.payload.fileViewerId),v=r.payload.previewKey;if(v&&(null===(s=null==p?void 0:p.currentPath)||void 0===s?void 0:s.length)){const e=p.currentPath.slice(0,-1);return i(it(Object.assign(Object.assign({},r.payload),{previewKey:v,currentPath:e,fromUrlChanged:!1,isDir:!0})))}return e.closeViewer&&e.closeViewer(),i(r);case Oe.ShowAuthModal:const{encryptionOptions:g,sharedLinkUrl:_,kind:f,mode:w,loggingExtra:m}=r.payload;return e.showAuthModal&&e.showAuthModal({encryptionOptions:g,sharedLinkUrl:_,kind:f,mode:w,loggingExtra:m}),i(r);case Oe.FlipToNextFile:return null===(l=e.flipToNextFile)||void 0===l||l.call(e),i(r);case Oe.FlipToPreviousFile:return null===(c=e.flipToPreviousFile)||void 0===c||c.call(e),i(r);case Oe.UpdateFiles:return e.updateFiles&&e.updateFiles(),i(r);default:return i(r)}}}function to(e){return({getState:t})=>r=>n=>i.__awaiter(this,void 0,void 0,(function*(){const i=r(n);if(n.type===Oe.Print){const{fileViewerId:i,previewType:r}=n.payload,a=function(e,t){var i,r;const n=ua(e,t),a=n&&pa(e,n);if(!a)return"";const{content:o}=a;return"image"===(null==o?void 0:o[".tag"])?null!==(i=null==o?void 0:o.full_size_src)&&void 0!==i?i:"":"ssr_doc"===(null==o?void 0:o[".tag"])&&null!==(r=null==o?void 0:o.autoprint_url)&&void 0!==r?r:""}(t(),i);e.print(a,r)}return i}))}const io="unfurl",ro="file_subpath";function no(e){return()=>t=>i=>{switch(i.type){case Oe.UpdateArchiveFileCurrentPath:i.payload.fromUrlChanged||e.setQueryStringParameter(ro,0===(r=i.payload.currentPath).length?null:`/${r.join("/")}`);break;case Oe.OpenFileURL:e.openFile(i.payload.fqPath);break;case Oe.CloseViewer:e.setQueryStringParameter(ro,null);break;case Oe.Redirect:e.redirect(i.payload.href,i.payload.newTab);break;case Oe.InitializeFileViewer:null!==e.getQueryStringParameter(io)&&e.setQueryStringParameter(io,null)}var r;return t(i)}}function ao(e){return()=>t=>i=>(i.type===Oe.TriggerDynamicRoutingModalCheck&&e.triggerDynamicRoutingModalCheck(),t(i))}function oo(e,t){var i;e.dispatch((i={fileId:t},{type:Oe.SubscribePresence,payload:i}))}function so(e,t){var i;e.dispatch((i=t,{type:Oe.UnsubscribePresence,payload:i}))}const lo=function(e=navigator.userAgent){const t=function(e){const t=e.toLowerCase(),i=/(ipad)/.exec(t)||/(edge)[ \/]([\w.]+)/.exec(t)||/(edg)[ \/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||/(trident).*? rv:([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],r=t.match(/version\/([\d.]+)/i);let n=null!=r?i[1]:null;return"webkit"===n&&(n=null!=r?r[1]:null),{browser:i[1]||"",version:n||i[2]||"0",userAgent:e}}(e);return"trident"===t.browser&&(t.browser="msie"),t}(),co=Boolean(/(ipod)/.exec(navigator.userAgent.toLowerCase())),uo="ipad"===lo.browser||void 0,po=!("webkit"!==lo.browser&&!Boolean(uo))||void 0;"edge"===lo.browser||lo.browser,lo.browser;const vo=Boolean(/(iphone)/.exec(navigator.userAgent.toLowerCase()));function go(e=navigator.userAgent){const t=(e||"").toLowerCase();return co||vo||-1!==t.indexOf("tizen")||-1!==t.indexOf("android")&&-1!==t.indexOf("mobile")||-1!==t.indexOf("bb10")||-1!==t.indexOf("netfront")||/windows phone|opera mini|blackberry|nokia/.test(t)||-1!==t.indexOf("firefox")&&-1!==t.indexOf("mobile")||-1!==t.indexOf("googlebot-mobile")||-1!==t.indexOf("iemobile")||-1!==t.indexOf("opera mobi")||/ucweb|ucbrowser/.test(t)||-1!==t.indexOf("microsoft office mobile")}function _o(e=navigator.userAgent){const t=(e||"").toLowerCase();return-1!==t.indexOf("android")||-1!==t.indexOf("silk")}function fo(e=navigator.userAgent){return go(e)||function(e=navigator.userAgent){return uo||_o(e)&&!go(e)}(e)}/win(16|nt|dows)/.test(navigator.userAgent.toLowerCase());const wo=Boolean(/(macintosh)/.exec(navigator.userAgent.toLowerCase())),mo=e=>Object.assign(Object.assign({},e),{contentMetadata:null}),yo=(e,t)=>{const i=la(e,t);if(null!=i)return i.previewKey};function bo(e,t){const{fileViewerId:i,navigation:r}=t,n=la(e,i),a=n?e.previewData[n.previewKey.serialized]:void 0,s={navigation:r,sharedLinkInfo:ka(e,i),previewData:a},l=((e,t)=>{const{rootFileInfo:i,fileMetadata:r}=e,n=i[t];if(null==n)return null;const{file_id:a,ns_id:o,sj_id:s,url:l}=n;if(null==a||null==o||null==s)return null;const c=r[n.previewKey.serialized];if(null==c)return null;const{file_name:d,file_path:u,file_last_modified_date:p,size:v}=c;return{fileId:a,lastModifiedDate:p,name:d,nsId:o,fqPath:u,sjId:s,url:l,size:v,previewKey:n.previewKey}})(e,i);if(!l)return Object.assign({previewType:o.PreviewType.Loading,file:null},s);const c=(e=>Object.assign(Object.assign({},e),{contentMetadata:null}))(l);if("errored"===(null==n?void 0:n.bootstrap.state))return Object.assign({previewType:o.PreviewType.Error,file:c},s);if(!a)return Object.assign({previewType:o.PreviewType.Loading,file:c},s);const d=a.previewType;switch(d){case o.PreviewType.Image:const t=((e,t,i)=>{var r;const n=e.previewData[t.previewKey.serialized],a=null===(r=Ta(e,t.previewKey))||void 0===r?void 0:r.metadata,o="image"===(null==a?void 0:a[".tag"])?a:null,s=(l=ya(e,i,t.previewKey))&&"dimensions"in l&&l.dimensions?l:null;var l;return Object.assign(Object.assign({},t),{dimensions:(null==n?void 0:n.dimensions)||(null==s?void 0:s.dimensions),contentMetadata:o})})(e,l,i);if(t)return Object.assign({previewType:d,file:t},s);break;case o.PreviewType.SsrDoc:case o.PreviewType.CloudDoc:const r=((e,t)=>{var i;const r=rn(_a(e,t.previewKey));if(null==r||0===Object.getOwnPropertyNames(r).length)return null;const n=null===(i=Ta(e,t.previewKey))||void 0===i?void 0:i.metadata,a="ms_office"===(null==n?void 0:n[".tag"])||"pdf"===(null==n?void 0:n[".tag"])?n:null;return Object.assign(Object.assign({},t),{pages:r.pages.map((({dimension:[e,t],pageIndex:i})=>({pageIndex:i,dimensions:{width:e,height:t}}))),contentMetadata:a,isPasswordProtected:r.isPasswordProtected})})(e,l);if(r)return Object.assign({previewType:d,file:r},s);break;case o.PreviewType.Audio:case o.PreviewType.Video:const n=((e,t)=>{var i;const r=null===(i=Ta(e,t.previewKey))||void 0===i?void 0:i.metadata,n="audio"===(null==r?void 0:r[".tag"])||"video"===(null==r?void 0:r[".tag"])?r:null,a=Fa(e,t.previewKey);return Object.assign(Object.assign({},t),{contentMetadata:n,transcript:a})})(e,l);if(n)return Object.assign({previewType:d,file:n},s);break;case o.PreviewType.Archive:const a=((e,t)=>Object.assign(Object.assign({},t),{contentMetadata:null}))(0,l);if(a)return Object.assign({previewType:d,file:a},s);break;case o.PreviewType.HTML:return Object.assign({previewType:d,file:mo(l)},s);case o.PreviewType.Error:case o.PreviewType.Loading:default:return Object.assign({previewType:d,file:c},s)}return Object.assign({previewType:o.PreviewType.Other,file:c},s)}function ho(e,t){const i=e.plugins[t];if(null==i)return;const{activeRightRailPluginId:r}=i;return r}function xo(e,t){return e.plugins[t]||null}function Po(e,t){return!!function(e,t){const i=e.plugins[t];if(null==i)return;const{activeEditPluginId:r}=i;return r}(e,t)}function Eo(e,t){const i=e.plugins[t];if(null==i)return;const{hideContentPanePluginId:r}=i;return r}function So(e,t){var i;const r=null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.toolbar;if(null==r?void 0:r.override){if("fvsdk"===r.overridePluginId)return r.override;const i=ho(e,t);if(r.overridePluginId===i)return r.override}}function Io(e,t){var i;return!!(null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.isToolbarRenameActive)}const Oo=({store:e,fileViewerId:t,reinitializeFileViewer:r,exitPluginEditMode:n,hideContentPane:a,updatePreviewMetadata:o,showAuthModal:s,canCloseViewer:c,sdkBatteries:d})=>({fileFlipping:{flipToNextFile(i){const r=yo(e.getState(),t);null!=r&&e.dispatch(Ge({fileViewerId:t,previewKey:r,sourceContext:i}))},flipToPreviousFile(i){const r=yo(e.getState(),t);null!=r&&e.dispatch(Ge({fileViewerId:t,previewKey:r,sourceContext:i}))}},navigateToPage(i,r){const n=yo(e.getState(),t);null!=n&&(e.dispatch(ke({fileViewerId:t,previewKey:n,pageIndex:i,sourceContext:r})),e.dispatch(Ve({fileViewerId:t,previewKey:n,sourceContext:l.UserActionContext.RightRail,pageIndex:i})))},closeRightRail(i){e.dispatch(We({fileViewerId:t,sourceContext:i}))},openRightRail(i){e.dispatch(Be({fileViewerId:t,sourceContext:i}))},getActiveRightRailPluginId:()=>ho(e.getState(),t),getIsRightRailOpen:()=>Sa(e.getState(),t),openUrl({url:t,fallbackUrl:i}){e.dispatch(He({url:t,fallbackUrl:i}))},reinitializeFileViewer(e){r(e)},exitEditMode(){n()},setActiveEditPlugin(i,r,n){e.dispatch(Je({fileViewerId:t,pluginId:i,sourceContext:r,pluginActivationParams:n}))},hideContentPane(e){a(e)},updatePreviewMetadata(e,t){o(e,t)},startToolbarRename(i=!1){e.dispatch(Fe({isActive:!0,isRenameInitiatedFromOverflow:i,fileViewerId:t}))},setDeleteFileModalOpen(i){e.dispatch(Ce({isOpen:i,fileViewerId:t}))},seek(t){var i;e.dispatch((i={time:t},{type:Oe.RequestVideoSeek,payload:i}))},seekRelative(t){var i;e.dispatch((i={delta:t},{type:Oe.RequestVideoSeekRelative,payload:i}))},pause(){e.dispatch({type:Oe.RequestVideoPause,payload:{}})},generateTranscript(i){const r=yo(e.getState(),t);if(!r)return!1;const n=pa(e.getState(),r),a=Aa(null==n?void 0:n.content),o=Fa(e.getState(),r);if(!Ma(a,o))return!1;const s=d.optionalIOClients.flowsClient;if(!s)return!1;var l;e.dispatch((l={previewKey:r},{type:Oe.StartTranscriptGenerating,payload:l}));const c=ka(e.getState(),t);return s.submitFileWorkflow({template:{sequence:[{workflow_action:{".tag":"transcribe_media"}}]},file_ids:[i],shared_link_url:null==c?void 0:c.url},900).then((t=>{var i;if("success"===t.status){const t=pa(e.getState(),r);"video"===(null===(i=null==t?void 0:t.content)||void 0===i?void 0:i[".tag"])&&t.content.transcript_url&&e.dispatch(function(e){return{payload:e,type:Oe.FetchTranscriptData}}({url:t.content.transcript_url,previewKey:r}))}else if("error"===t.status){const i=new Jn(t.errorReason||"error_unknown");e.dispatch(function(e,t){return{type:Oe.SetTranscriptError,payload:e,error:t}}({previewKey:r},i))}return!0})),!0},setOptInToVideoTranscript(){return i.__awaiter(this,void 0,void 0,(function*(){var i;e.dispatch((i={fileViewerId:t,onSuccess:r},{type:Oe.SetOptInToVideoTranscript,payload:i}))}))},openVideoEditor(){var i;e.dispatch((i={fileViewerId:t,sourceContext:l.UserActionContext.TitleBarMain},{type:Oe.EditVideo,payload:i}))},toggleVideoFrameSteppers(i){var r;e.dispatch((r={fileViewerId:t,enabled:i},{type:Oe.ToggleVideoFrameSteppers,payload:r}))},overrideFloatingToolbar(i,r){e.dispatch(rt({fileViewerId:t,state:r,pluginId:i}))},navigateToPath(t){e.dispatch({payload:{fqPath:t},type:Oe.OpenFileURL})},showAuthModal:s,canCloseViewer:c,openRightRailPlugin(i,r){null!=yo(e.getState(),t)&&(e.dispatch(Be({fileViewerId:t,sourceContext:i})),e.dispatch(Ye({fileViewerId:t,sourceContext:i,pluginId:r})))},setIsTranscriptShowing(i){const r=yo(e.getState(),t);var n;r&&e.dispatch((n={fileViewerId:t,previewKey:r,showing:i},{type:Oe.SetIsTranscriptShowing,payload:n}))},openLeftSidebarPlugin(i,r){yo(e.getState(),t)&&e.dispatch(et({fileViewerId:t,sourceContext:r,pluginId:i}))},openRightSidebarPlugin(i,r){yo(e.getState(),t)&&e.dispatch(tt({fileViewerId:t,sourceContext:r,pluginId:i}))},closeSidebarPlugin(i,r){yo(e.getState(),t)&&(function(e,t){var i,r;return null===(r=null===(i=e.plugins[t])||void 0===i?void 0:i.sidebarPlugins)||void 0===r?void 0:r.left}(e.getState(),t)===i?e.dispatch(et({fileViewerId:t,sourceContext:r,pluginId:void 0})):function(e,t){var i,r;return null===(r=null===(i=e.plugins[t])||void 0===i?void 0:i.sidebarPlugins)||void 0===r?void 0:r.right}(e.getState(),t)===i&&e.dispatch(tt({fileViewerId:t,sourceContext:r,pluginId:void 0})))}});class To{constructor(e,t,r,n,a,s){this.instances={},this.rightRailInstances={},this.loadPlugins=()=>i.__awaiter(this,void 0,void 0,(function*(){const e={},t={};this.instances=e,this.rightRailInstances=t;const i=yield Promise.all(this.wrappedPluginLoaders.map((e=>e.load())));i.forEach((i=>{if(i){const[r,n]=i;e[r]=n,oe(n)&&(t[r]=n)}}))})),this.wrapPluginLoader=e=>{const t=e.pluginId,{intl:r}=this.platformProps,n={intl:r,apiv2ClientBase:this.apiv2ClientBase};let a=null,o=null;const s=()=>i.__awaiter(this,void 0,void 0,(function*(){if(a)return[t,a];const i=performance.now();return a=yield e.load(n,this.context),this.store.dispatch(Zr({eventName:"plugin_load_ms",duration:performance.now()-i,fileViewerId:this.fileViewerId,tags:{pluginName:t}})),[t,a]}));return{load:()=>e.isEnabled&&!e.isEnabled(this.context)?Promise.resolve(null):(o||(o=s()),o)}},this.exitPluginEditMode=e=>i.__awaiter(this,void 0,void 0,(function*(){this.store.dispatch(Je({fileViewerId:this.fileViewerId,sourceContext:e||l.UserActionContext.Editor,pluginId:void 0}))})),this.hideContentPane=e=>{var t;this.store.dispatch((t={fileViewerId:this.fileViewerId,sourceContext:l.UserActionContext.Toolbar,pluginId:e},{type:Oe.HideContentPane,payload:t}))},this.updatePreviewMetadata=(e,t)=>{const i=e.file_id,r=e.sj_id,n=Qr(i,e.ns_id,r,e.url);t&&n&&this.store.dispatch(Ze(Object.assign(Object.assign({},t),{previewKey:n})))},this.reinitializeFileViewer=e=>i.__awaiter(this,void 0,void 0,(function*(){this.reinitialize(e)})),this.getPluginInstances=()=>({pluginInstances:this.instances,rightRailPluginInstances:this.rightRailInstances}),this.doTeardown=()=>i.__awaiter(this,void 0,void 0,(function*(){var e,t,i;const r=null===(e=this.store.getState().loggingSession[this.fileViewerId])||void 0===e?void 0:e.file_preview_session_id;try{yield this.triggerPluginsPreviewWillTeardown()}catch(e){e instanceof Error&&(null===(i=null===(t=this.sdkBatteries.optionalIOClients.reportExceptionClient)||void 0===t?void 0:t.reportException)||void 0===i||i.call(t,e,o.PreviewType.Other,!0)),r&&this.store.dispatch(Wr({event:l.SessionEventType.LifecycleFailure,fileViewerId:this.fileViewerId,previewSessionId:r,extra:{e:e}}))}})),this.fileViewerId=n,this.platformProps=e,this.apiv2ClientBase=t,this.reinitialize=a,this.sdkBatteries=s;const{store:c,config:d,showAuthModal:u,canCloseViewer:p}=e;this.store=c,this.navigation=Oo({store:c,fileViewerId:n,reinitializeFileViewer:this.reinitializeFileViewer,exitPluginEditMode:this.exitPluginEditMode,hideContentPane:this.hideContentPane,updatePreviewMetadata:this.updatePreviewMetadata,showAuthModal:u,canCloseViewer:p,sdkBatteries:s}),this.context=function({store:e,sdkConfig:t,fileViewerId:i,navigation:r}){return{fileViewerId:i,getFilePreviewSessionId:()=>Ca(e.getState(),i),getFileViewerSessionId:()=>{var t;return null===(t=e.getState().loggingSession[i])||void 0===t?void 0:t.file_viewer_session_id},logUserAction:(t,r,n)=>{e.dispatch(Hr({event:l.EventType.UserAction,fileViewerId:i,extra:Object.assign(Object.assign({action:t},r?{context:r}:{}),n||{})}))},sdkConfig:t,getPluginData:()=>bo(e.getState(),{fileViewerId:i,navigation:r})}}({store:this.store,sdkConfig:d,fileViewerId:this.fileViewerId,navigation:this.navigation}),this.wrappedPluginLoaders=r.map(this.wrapPluginLoader)}triggerPluginsPreviewDidInitialize(e){var t,i;for(const r of Object.values(this.instances))null===(i=null===(t=r.lifecycle)||void 0===t?void 0:t.previewDidInitialize)||void 0===i||i.call(t,e)}triggerPluginsPreviewWillTeardown(){var e,t;for(const i of Object.values(this.instances))null===(t=null===(e=i.lifecycle)||void 0===e?void 0:e.previewWillTeardown)||void 0===t||t.call(e)}}class Fo{constructor(e,r,n=[],s){this.mounted=!1,this.sessionActive=!1,this.initializeOpts=void 0,this.loadContentMetadata=e=>i.__awaiter(this,void 0,void 0,(function*(){const e=this.store,t=this.fileViewerId,i=la(e.getState(),t);if(!i)return;const{file_id:r,url:n,previewKey:o}=i;e.dispatch(a.getFileContentMetadataAction({arg:{file_path_or_id:r,url:n}},{previewKey:o}))})),this.resolveFilePreview=(e,r,n)=>i.__awaiter(this,void 0,void 0,(function*(){var i;let a;$r(!(!e.url&&!e.file_id),t.FVErrorCode.InvalidFileInfo,"You have to either provide a file ID or shared link url to fetch the preview data");const o=null!==(i=e.url)&&void 0!==i?i:n;a=o?{url:o,file_id:e.file_id}:e.ns_id&&e.sj_id?{ns_id:e.ns_id,sj_id:e.sj_id}:{file_id:e.file_id},yield this.store.dispatch(ht({arg:{files:[a],include_dimensions:!0},params:{}},{previewKey:r}))})),this.hasFileFlipped=e=>{const t=la(this.store.getState(),this.fileViewerId);return(null==t?void 0:t.previewKey.serialized)!==e.serialized},this.reinitialize=e=>i.__awaiter(this,void 0,void 0,(function*(){if(!this.initializeOpts)throw new Error("Reinitialize called before initialization");var t;let i;this.store.dispatch((t={},{type:Oe.UpdateFiles,payload:t})),i=(null==e?void 0:e.fileInfo)?e.fileInfo:this.initializeOpts.fileInfo.file_id?{file_id:this.initializeOpts.fileInfo.file_id}:this.initializeOpts.fileInfo;const r=Object.assign(Object.assign(Object.assign({},this.initializeOpts),e),{fileInfo:i,forceReloadPreviewMetadata:!0});return this.initialize(r)})),this.initialize=e=>i.__awaiter(this,void 0,void 0,(function*(){var i,r,n,a;const{fileMetadata:s,fileSize:c,fileInfo:p,previewMetadata:v,sourceSession:g,pluginParams:_={},supportedPreviewTypes:f=ae,sharedLinkInfo:w,brandingInfo:m,timeRange:y,forceReloadPreviewMetadata:b}=e,x=!this.initializeOpts;this.initializeOpts=e,d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_INITIALIZE_START);const{file_name:P}=s,E=p.file_id,S=p.sj_id,I=p.ns_id,O=Qr(E,I,S,p.url),{store:T,config:F,deviceType:C,accountId:R,callbacks:j}=this.platformProps,k=this.fileViewerId,V=h(P);var D;la(T.getState(),k)&&this.mounted&&(yield this.doTeardown(),g.was_flipped=!0),x&&T.dispatch((D={fileViewerId:k,deviceType:C,pluginParams:_},{type:Oe.InitializeFileViewer,payload:D})),this.store.dispatch(function(e){return{type:Oe.SetRootFilePreview,payload:e}}({fileViewerId:this.fileViewerId,fileInfo:p,previewKey:O})),T.dispatch(function(e){return{type:Oe.SetFileMetadata,payload:e}}(Object.assign(Object.assign({},s),{size:c,previewKey:O,timeRange:y}))),v&&T.dispatch(Ze(Object.assign(Object.assign({},v),{previewKey:O}))),this.sessionActive=!0,T.dispatch(Ne({fileViewerId:k,fileId:E,sjId:S,nsId:I,deviceType:C,fileExtension:V,sourceSession:Object.assign(Object.assign({},g),{redesign2023Variant:u.getRedesign2023Variant(F)})})),T.dispatch(st({isPreviewLoading:!0,fileViewerId:k}));const M=null===(i=T.getState().loggingSession[this.fileViewerId])||void 0===i?void 0:i.file_preview_session_id;if(!M)return;j&&j.onPreviewSessionInitialized&&j.onPreviewSessionInitialized(M),T.dispatch(Wr({event:l.SessionEventType.FilePreviewAttemptStarted,fileViewerId:k,previewSessionId:M}));const N=performance.now();try{$r(!!V,t.FVErrorCode.NoExtension,"Missing file extension"),$r(!!p.url||!!p.file_id,t.FVErrorCode.InvalidFileInfo,"You have to either provide a file ID or shared link url to fetch the preview data");try{const e=pa(T.getState(),O);if(!b&&e&&p.file_id||(yield this.resolveFilePreview(p,O,null==w?void 0:w.url)),!navigator.onLine)throw new zr(t.FVErrorCode.UserOffline,"There is a network connectivity issue")}catch(e){throw yn(e)?e:new zr(t.FVErrorCode.PreviewsDataApiFailure,e.message)}if(this.hasFileFlipped(O))return;const e=la(T.getState(),k);if(!e)return;const{file_id:i,ns_id:a,sj_id:s}=e;w&&T.dispatch(function(e){return{type:Oe.SetSharedLinkInfo,payload:e}}(Object.assign(Object.assign({},w),{previewKey:O}))),m&&T.dispatch(function(e){return{type:Oe.SetBrandingInfo,payload:e}}(Object.assign(Object.assign({},m),{previewKey:O})));const u=performance.now();T.dispatch(Zr({eventName:"fetch_preview_data_ms",duration:u-N,fileViewerId:k})),d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_GET_PREVIEW_METADATA),$r(!!i,t.FVErrorCode.MalformedPreviewsDataApiResponse,"Missing `file_id` in `file_info`");const v=pa(T.getState(),O);if(!v)throw new Error("PreviewMetadata must be defined during initialization.");const g=v.previewType;if(T.dispatch(function(e){return{type:Oe.InitializeFilePreview,payload:e}}({fileViewerId:k,fileInfo:{file_id:i,size:c,ns_id:a,sj_id:s,previewKey:O},fileExtension:V,fileName:P,previewType:g,timeRange:y})),null==v?void 0:v.error)throw v.error;if($r(g!==o.PreviewType.Error,t.FVErrorCode.MalformedPreviewsDataApiResponse,"Preview Type got resolved to PreviewType.Error, possibly because of missing `content`"),$r(f.includes(g),t.FVErrorCode.UnsupportedPreviewType,"Unsupported preview type"),$r(function(e,t,i,r){if(!isFinite(t))return!0;const n=A(e,i,r);return!n||t<=n}(P,c,g,F),t.FVErrorCode.FileTooLarge,"Unsupported file size"),T.dispatch(Wr({event:l.SessionEventType.FilePreviewSupportConfirmed,fileViewerId:k,previewSessionId:M,extra:{preview_type:g}})),yield this.loadContentMetadata(p).catch((e=>{throw yn(e)?e:new zr(t.FVErrorCode.RivieraDataFetchFailure,e.message)})),this.hasFileFlipped(O))return;if(T.dispatch(function(e){return{type:Oe.SetBootstrappedFile,payload:e}}({fileViewerId:k,previewKey:O})),F.log_views_to_pass){const e={file_views:[{file_info:{file_identifier:i,shared_link_details:w?{url:w.url}:void 0},platform_type:{".tag":_o()&&go()?"mobile_android":vo?"mobile_ios":"web"}}]};R?this.apiv2ClientBase.ns("seen_state").rpc("log_file_view",e,{}):this.apiv2ClientBase.ns("seen_state").rpc("logged_out/log_file_view",e,{})}try{oo(T,i),yield this.pluginManager.loadPlugins(),d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_PLUGINS_INITIALIZED)}catch(e){e instanceof Error&&(null===(n=null===(r=this.sdkBatteries.optionalIOClients.reportExceptionClient)||void 0===r?void 0:r.reportException)||void 0===n||n.call(r,e,g,!0)),T.dispatch(Wr({event:l.SessionEventType.LifecycleFailure,fileViewerId:this.fileViewerId,previewSessionId:M,extra:{e:e}}))}}catch(e){switch(yn(e)||(e=new zr(t.FVErrorCode.Unknown)),e.type){case t.FVErrorCode.PreviewsDataApiFailure:case t.FVErrorCode.NoExtension:case t.FVErrorCode.InvalidFileInfo:case t.FVErrorCode.UnsupportedPreviewType:case t.FVErrorCode.MalformedPreviewsDataApiResponse:case t.FVErrorCode.FileTooLarge:T.dispatch(Wr({event:l.SessionEventType.FilePreviewSupportDenied,fileViewerId:this.fileViewerId,previewSessionId:M,extra:{error_code:t.FVErrorCode[e.type]}}))}const i=null===(a=la(T.getState(),k))||void 0===a?void 0:a.previewKey;if(!i)return;T.dispatch(function(e){return{type:Oe.SetErroredFile,payload:e}}({fileViewerId:k,previewKey:i,error:e})),T.dispatch(st({isPreviewLoading:!1,fileViewerId:k})),yield this.pluginManager.loadPlugins()}this.pluginManager.triggerPluginsPreviewDidInitialize(_),d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_INITIALIZE_COMPLETE)})),this.getStaticProps=e=>{const{store:t,intl:i,config:r,platformConfig:n,callbacks:a,canCloseViewer:o}=this.platformProps,s=this.pluginManager.navigation,l=this.pluginManager.context,c=this.handleAppDestroy,d=this.handleAppMount,u=this.sdkBatteries,{fileConfig:p,isLoggedIn:v,defaultRightRailPlugin:g}=e;return{store:t,intl:i,id:this.fileViewerId,callbacks:a,config:r,canCloseViewer:o,pluginNavigation:s,pluginContext:l,onDestroy:c,onMount:d,batteries:u,platformConfig:n,fileConfig:Object.assign(Object.assign({},D),p),isLoggedIn:v,defaultRightRailPlugin:g}},this.getAppProps=()=>{if(!this.initializeOpts)throw new Error("File Viewer not initialized");const{pluginInstances:e,rightRailPluginInstances:t}=this.pluginManager.getPluginInstances();return{pluginInstances:e,rightRailPluginInstances:t}},this.doTeardown=()=>i.__awaiter(this,void 0,void 0,(function*(){this.endSession(),yield this.pluginManager.doTeardown()})),this.endSession=()=>{var e;if(this.sessionActive){this.sessionActive=!1;const{store:t}=this.platformProps,i=null===(e=t.getState().loggingSession[this.fileViewerId])||void 0===e?void 0:e.file_preview_session_id,r=la(t.getState(),this.fileViewerId),n=d.PreviewsEventLogger.getEventTimelineWithStartTime();i&&t.dispatch(Wr({event:l.SessionEventType.FilePreviewSessionEnded,fileViewerId:this.fileViewerId,previewSessionId:i,extra:Object.keys(n).length?{timeline:JSON.stringify(n)}:void 0})),(null==r?void 0:r.file_id)&&so(t,r.file_id)}d.PreviewsEventLogger.endCurrentSession()},this.handleAppDestroy=()=>i.__awaiter(this,void 0,void 0,(function*(){this.mounted=!1,yield this.doTeardown()})),this.handleAppMount=()=>{this.mounted=!0},this.cleanup=()=>{window.removeEventListener("beforeunload",this.endSession)};const c=Lr();this.fileViewerId=c,this.platformProps=e,this.apiv2ClientBase=r,this.sdkBatteries=s;const{store:p}=e;this.store=p,this.pluginManager=new To(e,r,n,c,this.reinitialize,s),this.pluginManager.loadPlugins(),window.addEventListener("beforeunload",this.endSession,{once:!0}),d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_CONSTRUCTOR)}}const Co={osModifierKey:"ctrlKey"};function Ro(e){return({})=>t=>r=>i.__awaiter(this,void 0,void 0,(function*(){const i=t(r);return r.type===Oe.SubscribePresence?e.subscribe(r.payload.fileId):r.type===Oe.UnsubscribePresence&&e.unsubscribe(r.payload),i}))}const jo=({dispatch:e,getState:t})=>i=>r=>{if(i(r),r.type!==Oe.SwitchWorkbookTab)return;const{previewKey:n,fileViewerId:a,tabIndex:o}=r.payload;if(Xr(n))return;const s=t(),l=pa(s,n),c=_a(s,n);if(null==l||!sn(l.content))return;if(null==c||!en(c))return;const{workbook_data_url_tmpl:d}=l.content;if(null!=c.sheets){const t=c.sheets[o];null!=t&&"errored"!==t.state||e((u={previewKey:n,fileViewerId:a,sheetIndex:o,workbookDataUrlTmpl:d},{type:Oe.FetchExcelSheetLayoutData,payload:u}))}var u};function ko(e){return({dispatch:t})=>r=>n=>i.__awaiter(this,void 0,void 0,(function*(){var i,a,o,s,c,d,u,p,v,g;switch(n.type){case Oe.InitializeFileViewer:{r(n);const i=!!n.payload.pluginParams.shouldFocusApproval,a={fileViewerId:n.payload.fileViewerId,sourceContext:l.UserActionContext.Initialization,previewKey:void 0};if(e.rightRail&&!i){const i=e.rightRail.getCollapsedState(),r=e.rightRail.getBladeState();r&&r!==G&&t(Ye(Object.assign(Object.assign({},a),{pluginId:r,skipLogging:!0}))),t(i?We(Object.assign(Object.assign({},a),{skipLogging:!0})):Be(Object.assign(Object.assign({},a),{skipLogging:!0})))}else t(Be(Object.assign(Object.assign({},a),{skipLogging:!0})));if(e.docSidebar){const i=e.docSidebar.getCollapsedState();t((i?Ue:Le)(Object.assign(Object.assign({},a),{skipLogging:!0})))}else t(Ue(Object.assign(Object.assign({},a),{skipLogging:!0})));if(e.video&&(t(nt(Object.assign(Object.assign({},a),{volume:e.video.getVolumeState(),skipLogging:!0}))),t(at(Object.assign(Object.assign({},a),{muted:e.video.getMutedState(),skipLogging:!0})))),e.sidebar){const i=e.sidebar.getSidebarState();if(i){const{left:e,right:r}=i;t(et(Object.assign(Object.assign({},a),{pluginId:e}))),t(tt(Object.assign(Object.assign({},a),{pluginId:r})))}}return}case Oe.OpenRightRail:null===(i=e.rightRail)||void 0===i||i.setCollapsedState({isCollapsed:!1});break;case Oe.CloseRightRail:null===(a=e.rightRail)||void 0===a||a.setCollapsedState({isCollapsed:!0});break;case Oe.SetActiveRightRailPlugin:n.payload.pluginId&&n.payload.sourceContext===l.UserActionContext.RightRail&&(null===(o=e.rightRail)||void 0===o||o.setBladeState({bladeId:n.payload.pluginId}));break;case Oe.OpenDocSidebar:null===(s=e.docSidebar)||void 0===s||s.setCollapsedState({isCollapsed:!1});break;case Oe.CloseDocSidebar:null===(c=e.docSidebar)||void 0===c||c.setCollapsedState({isCollapsed:!0});break;case Oe.SetVolume:null===(d=e.video)||void 0===d||d.setVolumeState(n.payload.volume);break;case Oe.SetMuted:null===(u=e.video)||void 0===u||u.setMuteState(n.payload.muted);break;case Oe.SetOptInToVideoTranscript:try{yield null===(p=e.accountPageUserRelatedPreference)||void 0===p?void 0:p.setOptInToVideoTranscript(),n.payload.onSuccess()}catch(e){}break;case Oe.SetLeftSidebarPlugin:null===(v=e.sidebar)||void 0===v||v.setLeftSidebarState(n.payload.pluginId);break;case Oe.SetRightSidebarPlugin:null===(g=e.sidebar)||void 0===g||g.setRightSidebarState(n.payload.pluginId)}return r(n)}))}function Vo(e){return()=>t=>r=>i.__awaiter(this,void 0,void 0,(function*(){if(r.type===Oe.ReportException){const t=r.payload.fileType||"unknown";e.reportException(r.payload.error,t,r.payload.isCritical)}return t(r)}))}function Do(e){var t,i;const{batteries:r,callbacks:o,featureConfig:s,initData:c,platformConfig:d,pluginLoaders:u}=e,{accountId:p,deviceType:v}=c||{},{optionalIOClients:g,coreIOClients:_,logger:f,intl:w}=r,{apiv2ClientBase:m}=_,{fileSystemClient:y,fileActionsClient:b,fullScreenClient:h,navigationClient:x,presenceBeaconIOClient:P,printClient:E,urlClient:S,preferencesClient:I,cloudDocsClient:O,reportExceptionClient:T}=g,F=function(e){const t="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?n.compose(n.applyMiddleware(...e),window.__REDUX_DEVTOOLS_EXTENSION__({name:"File Viewer SDK"})):n.applyMiddleware(...e);return n.createStore(n.combineReducers(Xn),{},t)}([...x?[eo(x)]:[],Ua,Ot(m.ns("previews")),a.middleware(m.ns("files")),Xa,...S?[no(S)]:[],...P?[Ro(P)]:[],...(null==s?void 0:s.excel_support)?[jo]:[],...y?[Qa(y)]:[],...b?[Ya(b)]:[],...h?[Ja(h)]:[],...E?[to(E)]:[],...I?[ko(I)]:[],...O?[ao(O)]:[],..."ms_view_embed"===(null===(t=null==s?void 0:s.excel_support)||void 0===t?void 0:t.embed_support)?[Ar(m.ns("cloud_docs"))]:[],...T?[Vo(T)]:[],...f?[Za(f)]:[]]);let C=V;s&&(C=Object.assign(Object.assign({},C),s));const R={callbacks:o,intl:w,store:F,accountId:p,showAuthModal:r.optionalIOClients.showAuthModal,canCloseViewer:!!(null===(i=r.optionalIOClients.navigationClient)||void 0===i?void 0:i.closeViewer),deviceType:v||l.DeviceType.desktop,config:C,platformConfig:Object.assign(Object.assign({},Co),d)},j=null==u?void 0:u.filter((e=>null!=e));return{createFileViewer:()=>new Fo(R,m,j,r)}}n.injectInternalStyle("typescript/libraries/file-viewer/src/app.module.out.css",(e=>"._container_8zxup_1{align-items:stretch;background:var(--color__faint__background);display:flex;flex:1;font-family:AtlasGrotesk,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:var(--type__body__standard--fontsize);justify-content:flex-end;min-height:0;position:relative;width:100%}._container_8zxup_1 *,._container_8zxup_1 :after,._container_8zxup_1 :before{box-sizing:border-box}._container_8zxup_1 aside{background:var(--color__standard__background)}._containerV2_8zxup_26{flex-direction:column;justify-content:flex-start}._contentContainer_8zxup_31{display:flex;flex:1}@media (max-width:600px){._container_8zxup_1{width:100%!important}}._editPluginFullscreenContainer_8zxup_41{background:var(--color__standard__background);height:100%}._transparentBackground_8zxup_46{background:transparent}._file-viewer-area_8zxup_50{display:flex;flex-direction:column;height:100%;width:100%}._renderer-row_8zxup_57{display:flex;flex:1;flex-direction:row;min-height:0;width:100%}._footer-row_8zxup_65{width:100%}._center-section_8zxup_69{display:flex;flex-direction:column;height:100%;width:100%}"));const Ao=e=>No(la,e),Mo=e=>Lo(wa,e);function No(e,t){return n.useSelector((i=>e(i,t)))}function Lo(e,t){return n.useSelector((i=>e(i,t)))}function Uo(e,...t){return n.useSelector((i=>e(i,...t)))}function Ko(e,t,i){const r=No(ha,e),n=No(ba,e),a=Lo(pa,t),o=No(xa,e),s=No(da,e),l=n&&i(n);if(l&&o)return{fileViewerUiData:o,fileMetadata:r,filePreviewUiData:l,previewMetadata:a,fileInfo:s}}const zo=(e,t)=>{const n=r.React$1.lazy((()=>i.__awaiter(void 0,void 0,void 0,(function*(){return{default:(yield t())[e]}})))),a=e=>r.React$1.createElement(r.React$1.Suspense,{fallback:null},r.React$1.createElement(n,Object.assign({},e)));return a.displayName=`Async${e}`,a},$o=e=>({data:e}),Bo=e=>({error:e}),Wo=(e,a,s,c)=>{var u;const p=n.useDispatch(),[v,g]=r.React$1.useState(!1),_=s(Lo(_a,a)),f=Lo(pa,a),w=null===(u=No(Ra,e))||void 0===u?void 0:u.file_preview_session_id;return r.React$1.useEffect((()=>{if(f){const r=f.content,n={fileViewerId:e,previewSessionId:w,extra:{preview_type:f.previewType}};i.__awaiter(void 0,void 0,void 0,(function*(){p(Wr(Object.assign({event:l.SessionEventType.FilePreviewDownloadAttempted},n))),d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA_START_START);const i=_?$o(_):yield c(r,f.preview_url);if(d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA),i.error){const r=yn(i.error)?i.error:new zr(t.FVErrorCode.RivieraDataFetchFailure,i.error.message);p(Wr({event:l.SessionEventType.FilePreviewDownloadFailed,fileViewerId:e,previewSessionId:w,extra:{error_code:t.FVErrorCode[r.type]}})),p(Ze({previewKey:a,previewType:o.PreviewType.Error,error:r}))}else p(Wr(Object.assign({event:l.SessionEventType.FilePreviewDownloadSucceeded},n))),p(Xe({previewKey:a,data:i.data}));g(!0)}))}}),[a,null==f?void 0:f.content,null==f?void 0:f.preview_url]),v?_:void 0},Ho=(e,r)=>Wo(e,r,tn,((e,n)=>i.__awaiter(void 0,void 0,void 0,(function*(){if(Xr(r))return Bo(new zr(t.FVErrorCode.NestedFiletypeNotSupported));if(!n)return Bo(new zr(t.FVErrorCode.MissingContentMetadata,"Content metadata is not present"));const e=yield na.fetchArchiveTopLevelData(n);return e.error?e:$o((i=e.data,{entries:mn(i),isPasswordProtected:!!i.isEncrypted}));var i})))),Go=e=>r=>i.__awaiter(void 0,void 0,void 0,(function*(){return Xr(e)?Bo(new zr(t.FVErrorCode.NestedFiletypeNotSupported)):"video"===(null==r?void 0:r[".tag"])&&r.metadata_url?(a=r.metadata_url,o=r.transcript_url,s=Aa(r),i.__awaiter(void 0,void 0,void 0,(function*(){var e;const[t,i]=yield Promise.all([na.fetchMediaMetadata(a),o?na.fetchTranscriptData(o,s):void 0]);return t.error?t:$o({isTruncated:t.data.is_truncated,transcript:(null==i?void 0:i.data)?pn(Object.assign({segments:null!==(e=i.data.segments)&&void 0!==e?e:[]},i.data)):(null==i?void 0:i.error)?un(i.error):void 0,waveformData:void 0})}))):"audio"===(null==r?void 0:r[".tag"])&&r.waveform_url?(n=r.waveform_url,i.__awaiter(void 0,void 0,void 0,(function*(){const e=yield na.fetchWaveformData(n);return e.error?e:$o({waveformData:e.data.waveformHeights,isTruncated:void 0,transcript:void 0})}))):Bo(new zr(t.FVErrorCode.MissingContentMetadata,"Content metadata is not present"));var n,a,o,s})),qo=(e,t)=>{var i;const a=n.useDispatch(),o=Lo(pa,t),s=null===(i=No(Ra,e))||void 0===i?void 0:i.file_preview_session_id,[c,u]=r.React$1.useState(!1);return r.React$1.useEffect((()=>{if(o){d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA_START_START);const t={fileViewerId:e,previewSessionId:s,extra:{preview_type:o.previewType}};a(Wr(Object.assign({event:l.SessionEventType.FilePreviewDownloadAttempted},t))),a(Wr(Object.assign({event:l.SessionEventType.FilePreviewDownloadSucceeded},t))),d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA),u(!0)}}),[o,e,a,s]),c?{}:void 0},Zo=zo("PreviewDoc",(()=>new Promise((function(t,i){e(["./c_src_preview_doc"],t,i)})))),Xo=e=>{const{fileViewerId:n,previewKey:a}=e,o=((e,r,n)=>Wo(e,r,rn,(e=>i.__awaiter(void 0,void 0,void 0,(function*(){if(!e||"cloud_doc"!==e[".tag"]&&"ssr_doc"!==e[".tag"]||!e.image_url_tmpl||!e.text_url_tmpl)return Bo(new zr(t.FVErrorCode.MissingContentMetadata,"Content metadata is not present"));const[i,r]=sa(0,n.partial_prewarm_allowed);return yield na.fetchPageDataWithMetadata({textUrlTmpl:e.text_url_tmpl,imageUrlTmpl:e.image_url_tmpl,supportedWidths:"supported_widths"in e?e.supported_widths:void 0},i,r,void 0)})))))(n,a,e.config);return r.React$1.createElement(Zo,Object.assign({},e,{rivieraData:o}))};Xo.displayName="AsyncPreviewDocWithRiviera";const Qo=zo("PreviewImage",(()=>new Promise((function(t,i){e(["./c_src_preview_image"],t,i)})))),Yo=e=>{const{fileViewerId:t,previewKey:i}=e,n=qo(t,i);return r.React$1.createElement(Qo,Object.assign({},e,{rivieraData:n}))},Jo=zo("PreviewAudioVideo",(()=>new Promise((function(t,i){e(["./c_src_preview_audio_video_preview_video"],t,i)})).then((function(e){return e.preview_video_esnext})))),es=e=>{const{fileViewerId:a,previewKey:s}=e,l=(e=>{var a;const s=n.useDispatch(),l=null===(a=Lo(pa,e))||void 0===a?void 0:a.content,c=nn(Lo(_a,e));return r.React$1.useEffect((()=>{i.__awaiter(void 0,void 0,void 0,(function*(){const i=c?{data:c}:yield Go(e)(l);i.data?s(Xe({previewKey:e,data:i.data})):Ze({previewKey:e,previewType:o.PreviewType.Error,error:yn(i.error)?i.error:new zr(t.FVErrorCode.RivieraDataFetchFailure,i.error.message)})}))}),[e,l,s,c]),c})(s),c=qo(a,s);return r.React$1.createElement(Jo,Object.assign({},e,{rivieraData:c?l:void 0}))};es.displayName="AsyncPreviewAudioVideoWithRivieraFetch";const ts=zo("PreviewLinkfile",(()=>new Promise((function(t,i){e(["./c_src_preview_linkfile"],t,i)})))),is=e=>{const{fileViewerId:t,previewKey:n}=e,a=((e,t)=>Wo(e,t,on,(e=>i.__awaiter(void 0,void 0,void 0,(function*(){if("linkfile"!==(null==e?void 0:e[".tag"])||!e.url)return $o({uri:void 0});const{url:t,authenticated:i}=e,r=yield na.fetchLinkfileData(t,!!i);return r.error?r:$o({uri:r.data.uri})})))))(t,n);return r.React$1.createElement(ts,Object.assign({},e,{rivieraData:a}))};is.displayName="AsyncPreviewLinkfileWithRivieraFetch";const rs=zo("PreviewArchive",(()=>new Promise((function(t,i){e(["./c_src_preview_archive"],t,i)})))),ns=e=>{const{fileViewerId:t,previewKey:i}=e,n=Ho(t,i);return r.React$1.createElement(rs,Object.assign({},e,{rivieraData:n}))};ns.displayName="AsyncPreviewArchiveWithRivieraFetch";const as=zo("PreviewExcel",(()=>new Promise((function(t,i){e(["./c_src_preview_excel_renderer"],t,i)})))),os=e=>{const{fileViewerId:n,previewKey:a}=e,o=((e,r)=>Wo(e,r,an,(e=>i.__awaiter(void 0,void 0,void 0,(function*(){if("excel"!==(null==e?void 0:e[".tag"])||!e.workbook_data_url_tmpl)return Bo(new zr(t.FVErrorCode.MissingContentMetadata,"Content metadata is not present"));const i=yield na.fetchExcelWorkbookLayoutData(e.workbook_data_url_tmpl,0);return i.error?i:$o({sheets:{0:pn(i.data.sheets[0])},workbook:wn(i.data)})})))))(n,a);return r.React$1.createElement(as,Object.assign({},e,{rivieraData:o}))};os.displayName="AsyncPreviewExcelWithRivieraFetch";const ss=zo("PreviewExcelViewOnlyEmbed",(()=>new Promise((function(t,i){e(["./c_preview_excel_ms_embed_view_only_embed"],t,i)})))),ls=zo("PreviewHTML",(()=>new Promise((function(t,i){e(["./c_src_preview_html"],t,i)})))),cs=e=>{const{fileViewerId:t,previewKey:i}=e,n=qo(t,i);return r.React$1.createElement(ls,Object.assign({},e,{rivieraData:n}))};cs.displayName="AsyncPreviewHTMLWithRivieraFetch";const ds=zo("PreviewCloudDoc",(()=>new Promise((function(t,i){e(["./c_src_preview_cloud_doc"],t,i)})))),us=e=>{const{fileViewerId:t,previewKey:i}=e,n=qo(t,i);return r.React$1.createElement(ds,Object.assign({},e,{rivieraData:n}))};us.displayName="AsyncPreviewCloudDocWithRivieraFetch";const ps=zo("PreviewRenderError",(()=>Promise.resolve().then((function(){return Xc})))),vs=e=>{const{children:t,className:i}=e,[a,o]=(()=>{const[e,t]=r.React$1.useState(null),[i,a]=r.React$1.useState();return r.React$1.useEffect((()=>{if(!e)return;const t=new n.ResizeObserver((e=>a(e[0].contentRect)));return t.observe(e),a(e.getBoundingClientRect()),()=>t.disconnect()}),[e]),[t,i]})();return r.react.exports.createElement("div",{className:n.classnames("_container_8zxup_1",i),ref:a,id:"fvsdk-container"},o&&(null==t?void 0:t(o)))};vs.displayName="Preview";const gs=e=>{var i;const{pluginProps:n,previewKey:a}=e,s=Lo(wa,a),l=Lo(pa,a),c=null==l?void 0:l.previewType;switch(c){case o.PreviewType.Image:return r.react.exports.createElement(Yo,Object.assign({},e,{pluginProps:n,key:a.serialized}));case o.PreviewType.SsrDoc:case o.PreviewType.CloudDoc:return Ie(l)?r.react.exports.createElement(us,Object.assign({},e,{pluginProps:n,key:a.serialized})):(null===(i=null==s?void 0:s.file_name)||void 0===i?void 0:i.endsWith(".gsheet"))?r.react.exports.createElement(cs,Object.assign({},e,{pluginProps:n,isRawHtml:!0,key:a.serialized})):r.react.exports.createElement(Xo,Object.assign({},e,{pluginProps:n,key:a.serialized}));case o.PreviewType.Video:case o.PreviewType.Audio:return r.react.exports.createElement(es,Object.assign({},e,{isAudio:c===o.PreviewType.Audio,pluginProps:n,key:a.serialized}));case o.PreviewType.Excel:if("ms_view_embed"===e.config.excel_support.embed_support)return r.react.exports.createElement(ss,Object.assign({},e,{pluginProps:n,key:a.serialized}));if("excel1"===e.config.excel_support.support)return r.react.exports.createElement(cs,Object.assign({},e,{pluginProps:n,isRawHtml:!1,key:a.serialized}));if("excel2"===e.config.excel_support.support)return r.react.exports.createElement(os,Object.assign({},e,{pluginProps:n,key:a.serialized}));break;case o.PreviewType.HTML:case o.PreviewType.RawHTML:return r.react.exports.createElement(cs,Object.assign({},e,{pluginProps:n,isRawHtml:c===o.PreviewType.RawHTML,key:a.serialized}));case o.PreviewType.Archive:return r.react.exports.createElement(ns,Object.assign({},e,{pluginProps:n,key:a.serialized}));case o.PreviewType.Linkfile:return r.react.exports.createElement(is,Object.assign({},e,{pluginProps:n,key:a.serialized}));case o.PreviewType.Error:return r.react.exports.createElement(ps,Object.assign({error:(null==l?void 0:l.error)||new zr(t.FVErrorCode.Unknown)},e))}return r.react.exports.createElement(ps,Object.assign({error:new zr(t.FVErrorCode.UnsupportedPreviewType)},e))};function _s(e,t){var i,r;const n=null===(i=function(e,t){return la(e,t)||null}(e,t))||void 0===i?void 0:i.previewKey;return e.filePreviewUi[t]&&n?null===(r=e.filePreviewUi[t])||void 0===r?void 0:r[n.serialized]:void 0}function fs(e,t){return{isRightRailVisible:!!Sa(e,t)}}function ws(e,t){const i=_s(e,t);if(null==i)return null;const r=dn(i);if(null==r)return null;return{scaleFactor:Pa(r)}}function ms(e,t){var i,r;const n=fs(e,t);if(null==n)return null;const a=ws(e,t);if(null==a)return null;const o=_s(e,t);if(null==o)return null;const s=null!==(r=null===(i=ln(o))||void 0===i?void 0:i.currentPageIndex)&&void 0!==r?r:null;if(null==s)return null;const l=e.fileViewerUi[t],c=!!l&&l.isDocSidebarOpen;return Object.assign(Object.assign(Object.assign({},n),a),{currentPageIndex:s,isNavBarVisible:c})}function ys(e,t){const i=fs(e,t);if(null==i)return null;const r=ws(e,t);return null==r?null:Object.assign(Object.assign({},i),r)}function bs(e,t){return{isRightRailVisible:!!Sa(e,t)}}function hs(e,t,i){const r=function(e,t){const i=fs(e,t);if(null==i)return null;const r=_s(e,t);if(null==r)return null;const n=cn(r);if(null==n)return null;const{currentTimestamp:a,isPlaying:o,isDefaultAudioTrackSelected:s}=n;return Object.assign(Object.assign({},i),{currentTimestamp:a,isPlaying:o,isDefaultAudioTrackSelected:s})}(t,e);return null!=i.file&&null!=r?Object.assign(Object.assign({},i),{file:i.file,ui:r}):null}function xs(e,t,i){const r=function(e,t){return fs(e,t)}(t,e);return null!=i.file&&null!=r?Object.assign(Object.assign({},i),{file:i.file,ui:r}):null}function Ps(e,t,i){if(!i)return null;switch(i.previewType){case o.PreviewType.CloudDoc:case o.PreviewType.SsrDoc:return function(e,t,i){const r=ms(t,e);return null!=i.file&&null!=r?Object.assign(Object.assign({},i),{file:i.file,ui:r}):null}(t,e,i);case o.PreviewType.Image:return function(e,t,i){const r=ys(t,e);return null!=i.file&&null!=r?Object.assign(Object.assign({},i),{file:i.file,ui:r}):null}(t,e,i);case o.PreviewType.Audio:case o.PreviewType.Video:return hs(t,e,i);case o.PreviewType.Archive:return xs(t,e,i);default:return function(e,t,i){const r=fs(t,e);return null!=i.file?Object.assign(Object.assign({},i),{file:i.file,ui:r}):null}(t,e,i)}}function Es(e,t,i){if(!i)return;const r=function(e,t,i){switch(i){case o.PreviewType.SsrDoc:case o.PreviewType.CloudDoc:{const i=ms(e,t);return null!=i?i:bs(e,t)}case o.PreviewType.Image:{const i=ys(e,t);return null!=i?i:bs(e,t)}default:{const i=fs(e,t);return null!=i?i:bs(e,t)}}}(e,t,i.previewType);return Object.assign(Object.assign({},i),{ui:r})}gs.displayName="PreviewRenderer",gs.displayName="PreviewRenderer";n.injectInternalStyle("typescript/libraries/file-viewer/src/right_rail/right_rail.module.out.css",(e=>"._rightRailContainer_4jer5_1{border-left:1px solid var(--color__standard__border);box-sizing:unset}._skeletonCollapsed_4jer5_7,._skeletonExpanded_4jer5_8{background-color:var(--color__standard__background);border-left:1px solid var(--color__standard__border);box-sizing:border-box;height:100%}._skeletonCollapsed_4jer5_7{width:56px}._skeletonExpanded_4jer5_8{width:328px}._previewRightRailWrapper_4jer5_23{height:100%;position:relative}._editPluginContainer_4jer5_28{background-color:var(--color__inverse__standard__background);height:100%;width:328px}@media (max-width:833px){._previewRightRailWrapper_4jer5_23 ._rightRailContainer_4jer5_1{display:none}}._overlay_4jer5_41{height:100%;left:0;pointer-events:all;position:absolute;top:0;width:100%;z-index:999}._overlay_4jer5_41._transparent_4jer5_51{pointer-events:none}"));const Ss="_previewRightRailWrapper_4jer5_23";n.injectInternalStyle("typescript/libraries/file-viewer/src/ui/ui.module.out.css",(e=>":root{--abovePreviewZIndex:10;--overlay_start:transparent;--overlay:var(--color__utility__overlay)}._close_5e2zk_11{position:absolute;right:0;top:0;z-index:var(--abovePreviewZIndex)}._overlay_5e2zk_18{background-color:var(--overlay_start);transition:background-color var(--duration__333) var(--easing__linear)}._overlay_5e2zk_18._active_5e2zk_23{background-color:var(--overlay)}@media (prefers-reduced-motion:reduce){._overlay_5e2zk_18,._slideTransition_5e2zk_28{transition:none}}._snackbar_5e2zk_34{bottom:10px;display:flex;justify-content:center;min-width:600px;position:fixed;z-index:500}"));const Is=({active:e,className:t,style:i,children:a})=>r.React$1.createElement("div",{className:n.classnames(t,"_overlay_5e2zk_18",{_active_5e2zk_23:e}),style:i},a);Is.displayName="OverlayTransition";const Os=({active:e,children:t,className:i,direction:a,start:o=0,end:s,offScreenElement:l=!0})=>{const c=r.React$1.useMemo((()=>({transitions:[{property:a,value:s},{property:"opacity",value:l?1:0}],duration:333,easing:l?"enter":"leave"})),[a,s,l]),d=r.React$1.useMemo((()=>({transitions:[{property:a,value:o},{property:"opacity",value:l?0:1}],duration:333,easing:l?"leave":"enter"})),[a,o,l]);return r.React$1.createElement(n.Motion,{in:e,transitionIn:c,transitionOut:d},(({style:e})=>r.React$1.createElement("div",{style:e,className:n.classnames("_slideTransition_5e2zk_28",i)},t)))};Os.displayName="SlideTransition";const Ts=()=>{},Fs=r.React$1.memo((({fileViewerId:e,fileName:t,pluginInstances:i,pluginNavigation:o,defaultRightRailPlugin:s})=>{const c=n.useDispatch();d.useMarkTimingEventOnMount(d.PreviewsTimingEvents.FVSDK_RIGHT_RAIL_MOUNT);const u=No(Sa,e),p=n.useSelector((t=>o&&bo(t,{fileViewerId:e,navigation:o}))),v=n.useSelector((t=>Ps(t,e,p))),g=n.useSelector((t=>Es(t,e,p))),_=No(ja,e),f=n.useSelector((t=>{var r;if(!i)return;const n=ho(t,e);if(Object.entries(i).find((e=>e[0]===n)))return n;const a=Object.entries(i).find((e=>e[0]===s))||(null===(r=Object.entries(i))||void 0===r?void 0:r[0]);return a?(c(Ye({fileViewerId:e,sourceContext:l.UserActionContext.Default,pluginId:a[0]})),a[0]):void 0})),w=r.React$1.useCallback((t=>{t===f&&u||(t!==f&&c(Ye({pluginId:t,fileViewerId:e,sourceContext:l.UserActionContext.RightRail})),c(Be({fileViewerId:e,sourceContext:l.UserActionContext.RightRail})))}),[c,e,f,u]),m=r.React$1.useCallback((()=>{const t={fileViewerId:e,sourceContext:l.UserActionContext.RightRail};c(Be(t))}),[c,e]),y=r.react.exports.useCallback((()=>{c(We({fileViewerId:e,sourceContext:l.UserActionContext.RightRail}))}),[c,e]),b=r.React$1.useCallback((e=>{w(e),m()}),[w,m]);if(void 0===u)return null;if(void 0===i||null===v||void 0===g||void 0===f)return r.React$1.createElement("div",{className:Ss},r.React$1.createElement("div",{className:u?"_skeletonExpanded_4jer5_8":"_skeletonCollapsed_4jer5_7"}));const h=Object.entries(i).map((([e,{rightRailUI:{Sidebar:t}}])=>r.React$1.createElement(t,Object.assign({},v,{key:`plugin-sidebar-${e}`})))),x=Object.entries(i).map((([e,{rightRailUI:{Control:t}}])=>r.React$1.createElement(t,Object.assign({},g,{isSelectedPlugin:e===f,onClick:Ts,key:`plugin-control-${e}`}))));return r.React$1.createElement("div",{className:Ss,"data-testid":"fv-sdk-right-rail"},r.React$1.createElement(a.RightRail.RightRailWrapper,{isExpanded:u,withTitle:t,onCollapse:y,expandedBlade:f,className:"_rightRailContainer_4jer5_1",onExpandBlade:u?w:b,onExpand:m,expandedChildren:h,collapsedChildren:x}),r.React$1.createElement(Is,{active:_,className:n.classnames("_overlay_4jer5_41",{_transparent_4jer5_51:!_})}))}));Fs.displayName="PreviewRightRail",Fs.displayName="PreviewRightRail";n.injectInternalStyle("typescript/libraries/file-viewer/src/preview_core.module.out.css",(e=>"._app_bn661_5{align-items:flex-end;display:flex;flex-grow:1;height:100%;justify-content:center;position:relative;width:100%}._app_bn661_5 ._toolbar_bn661_16{bottom:16px;opacity:0;position:absolute;transition:opacity .3s,.3s;z-index:-1}._app_bn661_5 ._toolbar_bn661_16:focus-within,._app_bn661_5:hover ._toolbar_bn661_16{opacity:1;transition:opacity .3s .01s;z-index:1}._is-full-screen_bn661_35{background-color:var(--color__inverse__faint__background)}@media (max-width:600px){._app_bn661_5{width:100%!important}}"));const Cs="_is-full-screen_bn661_35";n.injectInternalStyle("typescript/libraries/file-viewer/src/preview_content/preview_content.module.out.css",(e=>"._loadingContent_9oi8y_1{align-items:center;display:flex;flex:1;justify-content:center}._previewContent_9oi8y_8{align-items:stretch;display:flex;flex:1;flex-direction:column;max-height:100%;max-width:100%;position:relative;width:100%}._editMode_9oi8y_19{background-color:var(--color__inverse__standard__background)}._previewContentWrapper_9oi8y_23{display:flex;height:100%;position:relative;width:100%}._hidden_9oi8y_30{display:none}@media (max-width:600px){._loadingContent_9oi8y_1{width:100%!important}}"));const Rs="_hidden_9oi8y_30",js={docSidebar:!1,fileFlipping:!1,fullscreen:!1,pageNavigation:!1,print:!1,zooming:!1,findInDocument:!1},ks=e=>{switch(e){case o.PreviewType.SsrDoc:case o.PreviewType.CloudDoc:return{docSidebar:!0,fullscreen:!1,pageNavigation:!0,print:!1,zooming:!0,fileFlipping:!1,findInDocument:!1};case o.PreviewType.Image:return{docSidebar:!1,fullscreen:!1,pageNavigation:!1,print:!1,zooming:!0,fileFlipping:!1,findInDocument:!1};default:return{docSidebar:!1,fullscreen:!1,pageNavigation:!1,print:!1,zooming:!1,fileFlipping:!1,findInDocument:!1}}},Vs=(e,t,i)=>{const r=((e,t)=>({docSidebar:!e.preview_content_only,fileFlipping:e.file_flipping,fullscreen:e.enable_fullscreen,print:t.enable_print||!1}))(t,i),n=(e=>{switch(e){case o.PreviewType.SsrDoc:return{docSidebar:!0,fullscreen:!0,pageNavigation:!0,print:!0,zooming:!0,findInDocument:!0};case o.PreviewType.CloudDoc:return{docSidebar:!0,fullscreen:!0,pageNavigation:!0,print:!0,zooming:!0,findInDocument:!1};case o.PreviewType.Image:return{docSidebar:!1,fullscreen:!0,pageNavigation:!1,print:!0,zooming:!0,findInDocument:!1};case o.PreviewType.HTML:return{docSidebar:!1,fullscreen:!0,print:!0,findInDocument:!1};case o.PreviewType.RawHTML:return{docSidebar:!1,fullscreen:!0,print:!1,findInDocument:!1};case o.PreviewType.Excel:return{docSidebar:!1,fullscreen:!0,print:!0,zooming:!0,pageNavigation:!1,findInDocument:!1};default:return{docSidebar:!1,fullscreen:!1,pageNavigation:!1,print:!1,findInDocument:!1}}})(e);let a=js;for(const e in js){const t=e;t in r&&t in n?a=Object.assign(Object.assign({},a),{[t]:r[t]&&n[t]}):t in r&&!(t in n)?a=Object.assign(Object.assign({},a),{[t]:r[t]}):t in n&&!(t in r)&&(a=Object.assign(Object.assign({},a),{[t]:n[t]}))}return a},Ds=(e,t)=>e===v.ResponsiveSize.MOBILE||t.mobile_web||t.force_no_toolbar,As=e=>{const t=r.react.exports.useRef(e);t.current=e;return r.react.exports.useRef(((...e)=>(0,t.current)(...e))).current},Ms=(e,t)=>!e||t===o.PreviewType.Excel;function Ns(){const{fileViewerId:e,featureConfig:t}=re(),i=No(ca,e),r=Lo(va,i),n=No(Ia,e),a=u.isRedesign2023Enabled(t);return{fileViewerId:e,previewKey:i,previewType:r,showInverse:a?n:Ms(n,r),isFullScreen:n,isRedesignEnabled:a}}const Ls=e=>void 0!==e&&e.parent_files_count>=0?e:void 0,Us=({isShown:e,fileCollectionContext:t,flipperCallbacks:i})=>{const a=n.useDispatch(),o=n.useIntl(),{fileViewerId:s,previewKey:c,showInverse:d}=Ns(),u={fileViewerId:s,previewKey:c,sourceContext:l.UserActionContext.Toolbar},p=As((()=>{a(Ge(u))})),v=As((()=>{a(qe(u))})),_=o.formatMessage({id:"5h/4QP",defaultMessage:"Next"}),f=o.formatMessage({id:"XlDsZ8",defaultMessage:"Previous"}),w=Ls(t);if(void 0===w)return null;const m=0===w.file_index,y=w.file_index===w.parent_files_count-1;return r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(Ks,{tooltip:f,onClick:v,className:n.classnames(g.toolbarFlipperLeft,{[g.hidden]:!e,[g.isFullScreen]:!d}),icon:n.ChevronLeftLine,isDisabled:m,showInverse:!d,isShown:e,flipperCallbacks:i}),r.React$1.createElement(Ks,{tooltip:_,onClick:p,className:n.classnames(g.toolbarFlipperRight,{[g.hidden]:!e,[g.isFullScreen]:!d,[g.windowsScrollBar]:window.navigator.platform.match(/win/gi)}),icon:n.ChevronRightLine,isDisabled:y,showInverse:!d,isShown:e,flipperCallbacks:i}))};Us.displayName="FlipButtons",Us.displayName="FlipButtons";const Ks=({className:e,tooltip:t,onClick:i,icon:a,isDisabled:o,showInverse:s,isShown:l,flipperCallbacks:c})=>r.React$1.createElement("div",{className:n.classnames(g.toolbarFlipper,e,{[g.hidden]:!l})},r.React$1.createElement(n.Tooltip,{title:t,openDelay:500,shouldCloseOnClick:!0,inverse:!s},r.React$1.createElement(n.IconButton,Object.assign({variant:"filled",size:"large",onClick:i,"aria-label":t,disabled:o},c),r.React$1.createElement(n.UIIcon,{src:a}))));Ks.displayName="FlipButton",Ks.displayName="FlipButton";const zs=r.React$1.createContext({setFindInDocCallback:()=>{},setPrintCallback:()=>{},setSelectVideoQualityCallback:()=>{},setVideoPlayer:()=>{},setGetPageForSelection:()=>{}});function $s(e){return t=>e((()=>t))}const Bs=e=>{const[t,i]=r.react.exports.useState(void 0),[n,a]=r.react.exports.useState(void 0),[o,s]=r.react.exports.useState(void 0),[l,c]=r.react.exports.useState(void 0),[d,u]=r.react.exports.useState(void 0),p=r.React$1.useMemo((()=>({videoPlayer:t,onFindInDoc:n,onPrint:o,onSelectVideoQuality:l,getPageForSelection:d,setFindInDocCallback:$s(a),setPrintCallback:$s(s),setSelectVideoQualityCallback:$s(c),setVideoPlayer:i,setGetPageForSelection:$s(u)})),[t,n,o,l,d]);return r.React$1.createElement(zs.Provider,{value:p},e.children)};Bs.displayName="PreviewControlProvider";const Ws=e=>{const{onFindInDoc:t,onPrint:i,onSelectVideoQuality:n,videoPlayer:a,getPageForSelection:o}=e,{setFindInDocCallback:s,setPrintCallback:l,setSelectVideoQualityCallback:c,setVideoPlayer:d,setGetPageForSelection:u}=r.react.exports.useContext(zs);return r.React$1.useEffect((()=>(t&&s(t),i&&l(i),n&&c(n),a&&d(a),o&&u(o),()=>{t&&(null==s||s(void 0)),i&&(null==l||l(void 0)),n&&(null==c||c(void 0)),a&&(null==d||d(void 0)),o&&u(void 0)})),[t,i,n,a]),r.React$1.createElement(r.React$1.Fragment,null,e.children)};Ws.displayName="PreviewControlWrapper";const Hs=()=>r.react.exports.useContext(zs),Gs=({tooltipText:e,onClick:t,icon:i,disabled:a,closeTooltipOnClick:o=!1})=>{const{showInverse:s}=Ns(),l=r.react.exports.createElement(n.IconButton,{variant:"transparent","aria-label":e,disabled:a,onClick:t,style:a?{pointerEvents:"all"}:{},inverse:s},r.react.exports.createElement(n.UIIcon,{src:i}));return e?r.react.exports.createElement(n.Tooltip,{placement:"top",title:e,inverse:!s,shouldCloseOnClick:o},l):l};Gs.displayName="ToolbarButton",Gs.displayName="ToolbarButton";const qs=({scaleFactor:e})=>{const t=n.useDispatch(),i=n.useIntl(),{fileViewerId:a,previewKey:o}=Ns(),s=r.react.exports.useCallback((()=>t(Ae({fileViewerId:a,previewKey:o,sourceContext:l.UserActionContext.Toolbar}))),[a,o,t]);return r.react.exports.createElement(Gs,{tooltipText:i.formatMessage({id:"QCtVKy",defaultMessage:"Zoom out"}),disabled:e<=.1,onClick:s,icon:f.ZoomOutLine})};qs.displayName="ZoomOutButton",qs.displayName="ZoomOutButton";const Zs=({scaleFactor:e})=>{const t=n.useDispatch(),i=n.useIntl(),{fileViewerId:a,previewKey:o}=Ns(),s=As((()=>{t(De({fileViewerId:a,previewKey:o,sourceContext:l.UserActionContext.Toolbar}))}));return r.react.exports.createElement(Gs,{tooltipText:i.formatMessage({id:"sMy5PN",defaultMessage:"Zoom in"}),disabled:e>=10,onClick:s,icon:f.ZoomInLine})};Zs.displayName="ZoomInButton",Zs.displayName="ZoomInButton";const Xs=({scaleFactor:e,fittedScaleFactor:t})=>{const i=n.useDispatch(),a=n.useIntl(),{fileViewerId:o,previewKey:s,showInverse:c}=Ns(),d=As((()=>{i(Me({fileViewerId:o,previewKey:s,sourceContext:l.UserActionContext.Toolbar}))})),u=t&&e===t?a.formatMessage({id:"0AbCS6",defaultMessage:"View actual size"}):a.formatMessage({id:"OgNBqT",defaultMessage:"Zoom to fit"});return r.react.exports.createElement(n.Tooltip,{placement:"top",title:u,inverse:!c},r.react.exports.createElement(n.Button,{variant:"transparent","aria-label":u,className:g.toolbarZoomToFit,onClick:d,hasNoUnderline:!0,inverse:c},r.react.exports.createElement(n.Text,{color:c?"faint":"standard",inverse:c},e?a.formatNumber(e,{style:"percent",maximumFractionDigits:0}):"")))};Xs.displayName="ZoomToFitButton",Xs.displayName="ZoomToFitButton";const Qs=()=>{const e=n.useDispatch(),t=n.useIntl(),{fileViewerId:i,previewKey:a,isFullScreen:o}=Ns(),s=As((()=>{const t={fileViewerId:i,previewKey:a,sourceContext:l.UserActionContext.Toolbar};e(o?$e(t):ze(t))}));return r.react.exports.createElement(Gs,{tooltipText:o?t.formatMessage({id:"1pq/ot",defaultMessage:"Exit fullscreen"}):t.formatMessage({id:"lQfB6H",defaultMessage:"Fullscreen"}),closeTooltipOnClick:!0,onClick:s,icon:o?p.FullscreenExitLine:p.FullscreenLine,disabled:!1})};Qs.displayName="FullScreenButton",Qs.displayName="FullScreenButton";const Ys=({fileRivieraData:e,filePreviewUi:t})=>{var i,a,o,s;const c=n.useDispatch(),d=n.useIntl(),{fileViewerId:u,previewKey:p,showInverse:v}=Ns(),_={fileViewerId:u,previewKey:p,sourceContext:l.UserActionContext.Toolbar},f=null!==(a=null===(i=ln(t))||void 0===i?void 0:i.currentPageIndex)&&void 0!==a?a:0,w=As((()=>{c(Ve(Object.assign({pageIndex:f-1},_)))})),m=As((()=>{c(Ve(Object.assign({pageIndex:f+1},_)))})),y=null===(s=null===(o=rn(e))||void 0===o?void 0:o.metadata)||void 0===s?void 0:s.page_count;if(null==f||null==y)return null;const b=f+1,h="".padEnd((""+y).length-(""+b).length,"0");return r.react.exports.createElement(r.react.exports.Fragment,null,r.react.exports.createElement(Gs,{disabled:f<1,onClick:w,tooltipText:d.formatMessage({id:"sago3n",defaultMessage:"Page up"}),icon:n.ChevronUpLine}),r.react.exports.createElement(n.Text,{color:v?"faint":"standard",className:g.pageDisplay,inverse:v},r.react.exports.createElement("span",{className:g.pageDisplayPadding},h),d.formatMessage({id:"t6aTtx",defaultMessage:"{currentPage, number} of {totalPages, number}"},{currentPage:b,totalPages:y})),r.react.exports.createElement(Gs,{disabled:f>=y-1,onClick:m,tooltipText:d.formatMessage({id:"5Nekbe",defaultMessage:"Page down"}),icon:n.ChevronDownLine}))};Ys.displayName="PageNavigationControls",Ys.displayName="PageNavigationControls";const Js=({isSidebarOpen:e,disabled:t,isInMenu:i})=>{const a=n.useDispatch(),o=n.useIntl(),{fileViewerId:s}=Ns(),c=As((()=>{a(e?Ue({fileViewerId:s,sourceContext:l.UserActionContext.Toolbar}):Le({fileViewerId:s,sourceContext:l.UserActionContext.Toolbar}))})),d=e?o.formatMessage({id:"ttmV3r",defaultMessage:"Hide sidebar"}):o.formatMessage({id:"NIm51y",defaultMessage:"Show sidebar"}),u=e?p.SidebarHideLine:p.SidebarShowLine;return i?r.react.exports.createElement(n.Menu.ActionItem,{onClick:c,disabled:t,preferComposition:!0},r.react.exports.createElement(n.Menu.RowAccessory,null,r.react.exports.createElement(n.UIIcon,{src:u})),r.react.exports.createElement(n.Menu.RowTitle,null,d)):r.react.exports.createElement(Gs,{key:`sidebar-${e}`,tooltipText:d,onClick:c,icon:u,disabled:t})};Js.displayName="SidebarToggleButton",Js.displayName="SidebarToggleButton";const el=({isMenuItem:e})=>{const t=n.useDispatch(),i=n.useIntl(),{fileViewerId:a,previewKey:o,previewType:s}=Ns(),{onPrint:c}=Hs(),d=As((()=>{null==c||c(),t(Ke({fileViewerId:a,previewKey:o,previewType:s,sourceContext:l.UserActionContext.Toolbar}))})),u=i.formatMessage({id:"tBZioS",defaultMessage:"Print"});return e?r.react.exports.createElement(n.Menu.ActionItem,{onClick:d,preferComposition:!0},r.react.exports.createElement(n.Menu.RowAccessory,null,r.react.exports.createElement(n.UIIcon,{src:p.PrintLine})),r.react.exports.createElement(n.Menu.RowTitle,null,u)):r.react.exports.createElement(Gs,{tooltipText:u,onClick:d,disabled:!1,icon:p.PrintLine})};el.displayName="PrintButton",el.displayName="PrintButton";const tl=({isMenuItem:e})=>{const t=n.useIntl(),{onFindInDoc:i}=Hs(),a=As((()=>{null==i||i()})),o=t.formatMessage({id:"M/F/hG",defaultMessage:"Find in document"});return e?r.react.exports.createElement(n.Menu.ActionItem,{onClick:a,preferComposition:!0},r.react.exports.createElement(n.Menu.RowAccessory,null,r.react.exports.createElement(n.UIIcon,{src:n.SearchLine})),r.react.exports.createElement(n.Menu.RowTitle,null,o)):r.react.exports.createElement("div",{"data-tooltip":"toolbar-search-button"},r.react.exports.createElement(Gs,{tooltipText:o,onClick:a,disabled:!1,icon:n.SearchLine,closeTooltipOnClick:!0}))};tl.displayName="FindInDocumentButton",tl.displayName="FindInDocument";const il=({intl:e,children:t})=>r.react.exports.createElement(n.Menu.Wrapper,{closeOnSelection:!1},(({getContentProps:i,getTriggerProps:a})=>{const o=e.formatMessage({id:"En+hlM",defaultMessage:"More actions"});return r.react.exports.createElement("div",null,r.react.exports.createElement(n.Tooltip,{placement:"top",title:o},r.react.exports.createElement("span",null,r.react.exports.createElement(n.IconButton,Object.assign({variant:"transparent"},a(),{inverse:!0}),r.react.exports.createElement(n.UIIcon,{src:_.MoreHorizontalLine})))),r.react.exports.createElement(n.Menu.Content,Object.assign({},i()),r.react.exports.createElement(n.Menu.Segment,null,t)))}));il.displayName="OverflowMenu";const rl=n.defineMessage({id:"nomoau",defaultMessage:"{file_number} of {file_count}"}),nl=n.defineMessage({id:"LI56s4",defaultMessage:"{file_number} of many"}),al=({fileCollectionContext:e})=>{const t=n.useIntl(),i=Ls(e);if(void 0===i||i.parent_files_count>99999)return null;const a=i.file_index+1,o=i.parent_files_count,s=i.parent_files_count<1e3?t.formatMessage(rl,{file_number:a,file_count:o}):t.formatMessage(nl,{file_number:a});return r.react.exports.createElement("span",null,s)};al.displayName="ToolbarFileCounter";n.injectInternalStyle("typescript/libraries/file-viewer/src/preview_doc/preview_doc.module.out.css",(e=>":root{--page-margin:16px;--page-margin-top:24px;--page-margin-left:24px;--page-ppt-margin-bottom:100px}._textbox_1titd_17{fill:transparent;cursor:text;opacity:.4;pointer-events:auto;-webkit-user-select:text;user-select:text}._textLayer_1titd_22{left:0;mix-blend-mode:multiply;pointer-events:none;position:absolute;top:0;transform-origin:top left}._textLayer_1titd_22 ::selection{background:var(--color__inverse__attention__background)}._textLayer_1titd_22 text::selection{color:transparent}._linksLayer_1titd_42{bottom:0;height:0;left:0;position:absolute;transform-origin:top left;width:0}._linksLayer_1titd_42 ._internalLink_1titd_52,._linksLayer_1titd_42 a{cursor:pointer;display:block}._linksLayer_1titd_42 ._internalLink_1titd_52:focus,._linksLayer_1titd_42 a:focus,._textbox_1titd_17 a:focus{outline:auto}._imgLayer_1titd_63{height:100%;overflow:hidden;position:relative;width:100%}._imgLayer_1titd_63>img{background:#fff;display:block;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;image-rendering:optimizeQuality;max-width:100%;pointer-events:auto;-webkit-user-select:none;user-select:none}.sc-annotation-conductor-layer ._imgLayer_1titd_63>img{pointer-events:auto}._snackbar_1titd_90{bottom:0;left:0;margin:auto;position:absolute;right:0;width:100%;z-index:1}._page_1titd_100{margin:var(--page-margin)}._pdfViewport_1titd_104 ._page_1titd_100{margin:0;position:absolute;top:0}._pptViewport_1titd_110 ._page_1titd_100{background-color:#fff;box-sizing:border-box;flex-shrink:0;margin:auto;position:relative}._pptViewport_1titd_110{-ms-overflow-style:-ms-autohiding-scrollbar;height:100%;overflow:auto;position:relative}._pptSizer_1titd_128,._pptViewport_1titd_110{display:flex;width:100%}._pptSizer_1titd_128{height:calc(100% - var(--page-ppt-margin-bottom))}._pptFullSizer_1titd_134{height:100%}._pdfViewport_1titd_104{height:100%;overflow:auto;width:100%}._container_1titd_144{align-items:stretch;display:flex;height:100%;justify-content:flex-start;overflow:hidden;width:100%}._container_1titd_144 ol{list-style:none}._pdfViewport_1titd_104 ol,._pptViewport_1titd_110 ol{padding:0}._pdfViewport_1titd_104 li{margin:var(--spacing__unit--2) 0;position:absolute;top:0}._pdfViewport_1titd_104 ol{align-items:center;display:flex;flex-direction:column;overflow:hidden;position:relative}._close_1titd_176{right:16px}"));n.injectInternalStyle("typescript/libraries/file-viewer/src/preview_doc/renderer/doc_sidebar.module.out.css",(e=>":root{--thumbnailWidth:112px;--imgZIndex:1;--sidebar-width:168px}._container_4llxd_13{flex-shrink:0;font-size:var(--type__body__standard--fontsize);height:100%;outline:none;overflow:auto;transition:width 40ms;width:0;will-change:width}._container_4llxd_13._open_4llxd_24{width:var(--sidebar-width)}._container_4llxd_13._open_4llxd_24._containerBorder_4llxd_28{border-right:1px solid var(--color__standard__border)}._container_4llxd_13 ol{border:none;box-sizing:border-box;height:100%;list-style:none;margin:0;overflow:hidden;padding:var(--spacing__unit--3) 0 0 0;position:relative}._container_4llxd_13 li{position:absolute;top:0;transform:translateX(-50%)}._container_4llxd_13 li a:any-link{align-items:flex-start;box-sizing:border-box;color:var(--color__standard__text);display:flex;flex-direction:column;justify-content:flex-start;margin-bottom:16px;outline:none;padding:0 0 0 28px;position:relative;text-decoration:none}._container_4llxd_13._isEditMode_4llxd_70 li a:any-link{color:var(--color__inverse__standard__text)}._thumbnail_4llxd_74{border:4px solid transparent;font-size:0;line-height:0;margin:0 0 4px -4px;position:relative;width:var(--thumbnailWidth)}._thumbnail_4llxd_74 img{position:absolute;width:100%;z-index:var(--imgZIndex)}._thumbnail_4llxd_74 ._loader_4llxd_91{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}._thumbnail_4llxd_74._selected_4llxd_100{border-color:var(--color__standard__border)}._container_4llxd_13._focused_4llxd_104 ._thumbnail_4llxd_74._selected_4llxd_100{border-color:var(--color__core__accent)}._thumbnail_4llxd_74._isUnfocusedInEditMode_4llxd_108._selected_4llxd_100{border-color:var(--color__inverse__standard__border)}"));const ol="112px",sl="168px",ll="_container_4llxd_13",cl="_open_4llxd_24",dl="_containerBorder_4llxd_28",ul="_isEditMode_4llxd_70",pl="_focused_4llxd_104";var vl=Object.freeze({__proto__:null,thumbnailWidth:ol,sidebarWidth:sl,border:"4px",container:ll,open:cl,containerBorder:dl,isEditMode:ul,thumbnail:"_thumbnail_4llxd_74",loader:"_loader_4llxd_91",selected:"_selected_4llxd_100",focused:pl,isUnfocusedInEditMode:"_isUnfocusedInEditMode_4llxd_108",default:{thumbnailWidth:"112px",sidebarWidth:"168px",border:"4px",container:"_container_4llxd_13",open:"_open_4llxd_24",containerBorder:"_containerBorder_4llxd_28",isEditMode:"_isEditMode_4llxd_70",thumbnail:"_thumbnail_4llxd_74",loader:"_loader_4llxd_91",selected:"_selected_4llxd_100",focused:"_focused_4llxd_104",isUnfocusedInEditMode:"_isUnfocusedInEditMode_4llxd_108"}});const gl=parseInt("16px",10),_l=parseInt("24px",10),fl=parseInt("100px",10),wl=parseInt("24px",10),ml=parseInt(sl,10),yl=ml+600,bl=[...s.PDF_EXTS,...s.WORDPROC_EXTS];function hl(e){return s.PRESENTATION_EXTS.includes(h(e))}function xl(e,t){return e>=yl&&(t===o.PreviewType.SsrDoc||t===o.PreviewType.CloudDoc)}function Pl(e){const{width:t,height:i,dimensions:r,isDocSidebarVisible:n,scaleToFit:a,toolbarShown:o,fileName:s,maxWidth:l}=e;if(0===r.length)return 1;const c=Math.max(0,t-gl-wl-(n?ml:0)-30),d=hl(s)&&!o?Math.max(0,i-_l-fl):Math.max(0,i-_l),u=null!=l?Math.min(c,l):c,p=d,v=bl.includes(h(s)),g="width_and_height"===a&&!v,_=r.reduce(((e,[t,i])=>Math.min(e,u/t,g?p/i:Number.POSITIVE_INFINITY)),Number.POSITIVE_INFINITY);return Math.min(_,g?Number.POSITIVE_INFINITY:1.75)}const El=r.react.exports.createContext(null);El.displayName="FileViewerRenderContext";const Sl=()=>r.react.exports.useContext(El),Il=El.Provider;n.injectInternalStyle("typescript/libraries/file-viewer/src/preview_archive/preview_archive.module.out.css",(e=>"._emptyFolder_1xop8_1{align-items:center;display:flex;flex-direction:column;height:100%;justify-content:center}._folderTable_1xop8_9{background:var(--color__standard__background);overflow-y:auto;padding-bottom:calc(var(--toolbar-vertical-padding) + var(--toolbar-row-height) + var(--toolbar-vertical-padding))}._archiveFileBreadcrumb_1xop8_20{flex-grow:1;height:100%;justify-content:center}._extractAllButtonBar_1xop8_26{margin:20px}._titlebarV2Breadcrumbs_1xop8_30 ._archiveFileBreadcrumb_1xop8_20 ._breadCrumbText_1xop8_30{font-family:var(--type__body__standard--fontfamily);font-size:14px}._titlebarV2Breadcrumbs_1xop8_30 ._archiveFileBreadcrumb_1xop8_20 ._breadCrumbText_1xop8_30._inverse_1xop8_35{color:var(--color__inverse__faint__text)}._titlebarV2Breadcrumbs_1xop8_30 ._archiveFileBreadcrumb_1xop8_20 ._breadCrumbText_1xop8_30._normal_1xop8_39{color:var(--color__standard__text)}._titlebarV2Breadcrumbs_1xop8_30{min-width:0}._truncateText_1xop8_48{overflow:hidden;text-decoration:none;text-overflow:ellipsis;white-space:nowrap}"));function Ol(e,t,i,r){return()=>{i&&r(it({currentPath:e,fileViewerId:t,previewKey:i,isDir:!0}))}}const Tl=r.react.exports.memo((e=>{const{archiveName:t,currentPath:i,fileViewerId:a,previewKey:o,dispatch:s,isMobile:l,showInverse:c=!1}=e,d=r.react.exports.useCallback(Ol([],a,o,s),[a,null==o?void 0:o.serialized]),u=n.classnames("_truncateText_1xop8_48",{_breadCrumbText_1xop8_30:!l,_normal_1xop8_39:!c,_inverse_1xop8_35:c});return r.react.exports.createElement(m.Breadcrumb,{isRootOverflow:!1,alwaysShowRoot:!0,size:l?"small":"standard",className:"_archiveFileBreadcrumb_1xop8_20"},r.react.exports.createElement(m.Breadcrumb.Link,{href:d,isCurrentPath:0===i.length},r.react.exports.createElement("div",{className:u},t)),i.map(((e,t)=>{const n=Ol(i.slice(0,t+1),a,o,s);return r.react.exports.createElement(m.Breadcrumb.Link,{href:n,isCurrentPath:t===i.length-1,key:`${t}-${e}`},r.react.exports.createElement("div",{className:u},e))})))}));Tl.displayName="ArchiveFileBreadcrumbs";const Fl=({intl:e,allowRename:i,fileViewerId:a,previewKey:o,filename:s,rootArchiveFileInformation:c,currentPath:d,showInverse:u,isEditingFilename:p})=>{const v=n.useDispatch(),_=r.React$1.useRef(null),[f,m]=r.React$1.useState(null!=s?s:"");r.React$1.useEffect((()=>{window.requestAnimationFrame((()=>{if(!_.current)return;_.current.focus();const e=null!=s?s:"";let t=e.lastIndexOf(".");t<0&&(t=e.length),_.current.setSelectionRange(0,t)}))}),[s,p]),r.React$1.useEffect((()=>()=>{v(Fe({isActive:!1,isRenameInitiatedFromOverflow:!1,fileViewerId:a}))}),[v,a]);const y=n.useSelector((e=>function(e,t){var i;return!!(null===(i=e.fileViewerUi[t])||void 0===i?void 0:i.isRenameInitiatedFromOverflow)}(e,a))),b=e=>{s!==(null!=e?e:f)?v(Te({fileViewerId:a,previewKey:o,sourceContext:l.UserActionContext.Toolbar,isRenameFromOverflowMenu:y,newFilename:null!=e?e:f})):m(null!=s?s:""),v(Fe({isActive:!1,isRenameInitiatedFromOverflow:!1,fileViewerId:a}))},h=r.React$1.useRef(null),[x,P]=r.React$1.useState();return s?c&&Array.isArray(d)?r.React$1.createElement("div",{className:"_titlebarV2Breadcrumbs_1xop8_30"},r.React$1.createElement(n.Text,{color:u?"standard":"faint",isBold:!0,inverse:u},r.React$1.createElement(Tl,{archiveName:s,currentPath:d,fileViewerId:a,previewKey:c.previewKey,dispatch:v,showInverse:u}))):p?r.React$1.createElement(n.ClickOutside,{isClickThroughPortaled:!1,shouldPropagateMouseEvents:!0,isActive:!0,onClickOutside:()=>{var e;return b(null===(e=null==_?void 0:_.current)||void 0===e?void 0:e.value)}},r.React$1.createElement("div",{style:x,"data-tooltip":"file-name-rename-active"},r.React$1.createElement(n.TextInput,{className:g.toolbarFilename,ref:_,"aria-label":e.formatMessage({id:"XlFxo+",defaultMessage:"filename"}),isTransparent:!0,value:f,onChange:e=>m(e.currentTarget.value),inverse:u,onKeyDown:e=>{e.key===n.Key_enum.Key.Enter?(e.stopPropagation(),b()):e.key===n.Key_enum.Key.Escape&&(e.stopPropagation(),m(s),v(Fe({isActive:!1,isRenameInitiatedFromOverflow:!1,fileViewerId:a})))}}))):r.React$1.createElement("div",{ref:h,className:g.toolbarFilenameSectionTitle,"data-tooltip":"file-name-display"},r.React$1.createElement(w.Truncate,{className:n.classnames("fvsdk__toolbar-filename",g.toolbarFilename),location:po?1:.5,tooltipControlProps:{placement:"top"},onDoubleClick:i?()=>{h.current&&P({minWidth:h.current.offsetWidth}),m(s),v(Fe({isActive:!0,isRenameInitiatedFromOverflow:!1,fileViewerId:a})),v(Gr({userAction:l.UserAction.Rename,fileViewerId:a,actionContext:l.UserActionContext.Toolbar})),B(t.TooltipTourUpdateType.Increment,t.GuidedTours.Rename),W(t.GuidedTours.Rename,1,2)}:void 0,title:s},s)):r.React$1.createElement(r.React$1.Fragment,null)};Fl.displayName="FileNameDisplay";const Cl=r.React$1.lazy((()=>i.__awaiter(void 0,void 0,void 0,(function*(){const{VideoControlToolbar:t}=yield new Promise((function(t,i){e(["./c_src_video_controls_video_controls_toolbar"],t,i)})).then((function(e){return e.video_controls_toolbar_esnext}));return{default:t}})))),Rl=e=>r.React$1.createElement(r.React$1.Suspense,{fallback:r.React$1.createElement(kl,null)},r.React$1.createElement(Cl,Object.assign({},e)));Rl.displayName="VideoControlRow";const jl=({className:e,children:t})=>r.React$1.createElement("div",{className:n.classnames(g.toolbarSection,e)},t);jl.displayName="ToolbarSection";const kl=({className:e,children:t})=>r.React$1.createElement("div",{className:n.classnames(g.toolbarRow,e)},t);kl.displayName="ToolbarRow";const Vl=({intl:e,allowRename:t,rootArchiveFileInformation:i,fileMetadata:a,filePreviewUi:o,showInverse:s,fileViewerId:l,previewKey:c,hasFileCounter:d,plugins:u,isEditingFilename:p})=>{let v=null;const _=null==u?void 0:u.star;v=r.React$1.createElement(Fl,{intl:e,allowRename:t,fileViewerId:l,previewKey:c,filename:(null==i?void 0:i.fileName)||(null==a?void 0:a.file_name),rootArchiveFileInformation:i,currentPath:null==o?void 0:o.currentPath,showInverse:s,isEditingFilename:p});const f=r.React$1.createElement(r.React$1.Fragment,null,v,_&&r.React$1.createElement(_,{className:g.toolbarStar}));return r.React$1.createElement(kl,{className:g.toolbarFilenameRow},d?r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(jl,{className:n.classnames(g.toolbarFilenameSection,{[g.toolbarFilenameSectionTitle]:!p})},f),r.React$1.createElement(jl,{className:g.toolbarCounterSection},r.React$1.createElement(al,{fileCollectionContext:null==a?void 0:a.file_collection_context}))):f)};Vl.displayName="FileInfoRow";const Dl=({intl:e,toolbarConfig:t,filePreviewUi:i,fileRivieraData:n,scaleFactor:a,rendererWidth:o,previewType:s,useOverflowMenu:l,isDocSidebarOpen:c,plugins:d,fittedScaleFactor:u,isSidebarEnable:p,fileViewerId:v})=>{const g=t.zooming,_=t.fullscreen,f=t.pageNavigation,w=t.findInDocument,m=t.print,y=!!o&&!xl(o,s),b=No(Va,v),h=null==d?void 0:d.imageCropRotate,x=p?r.React$1.createElement(Js,{isSidebarOpen:c,disabled:y,isInMenu:l}):null,P=r.React$1.createElement(r.React$1.Fragment,null,w&&r.React$1.createElement(tl,{isMenuItem:l}),m&&r.React$1.createElement(el,{isMenuItem:l}));return b?r.React$1.createElement(kl,null):r.React$1.createElement(kl,null,r.React$1.createElement(jl,null,g&&null!=a&&r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(qs,{scaleFactor:a}),r.React$1.createElement(Xs,{scaleFactor:a,fittedScaleFactor:u}),r.React$1.createElement(Zs,{scaleFactor:a})),_&&r.React$1.createElement(Qs,null)),h&&r.React$1.createElement(jl,null,r.React$1.createElement(h,null)),r.React$1.createElement(jl,null,f&&r.React$1.createElement(Ys,{filePreviewUi:i,fileRivieraData:n}),l?r.React$1.createElement(il,{intl:e},x,P):x),!l&&r.React$1.createElement(jl,null,P))};Dl.displayName="ControlsRow";const Al=({previewType:e,fileRivieraData:t,filePreviewUi:i,fileViewerUi:a,fileConfig:s,rootArchiveFileInformation:l,showDocSidebar:d,activeCommentPlugin:u,plugins:p,snackbarManagerPluginInstance:v,forceHideControlRow:_=!1})=>{var f,w,m,y;const b=n.useIntl(),{featureConfig:h,fileViewerId:x}=re(),{rendererWidth:P}=Sl(),E=null===(f=Ao(x))||void 0===f?void 0:f.previewKey,S=Mo(E),{videoPlayer:I}=Hs(),{isShown:O,elementProps:T}=function(e){const[t,i]=r.react.exports.useState(!1),[n,a]=r.react.exports.useState(!0),o=r.react.exports.useRef(),s=As((e=>{const t=e.currentTarget.getBoundingClientRect();0===t.left&&0===t.top||i(!0)})),l=As((()=>{i(!1)})),d=As((()=>{t?u():(o.current=void 0,a(!1))})),u=As((()=>{o.current&&window.clearTimeout(o.current),o.current=window.setTimeout(d,3e3)}));return r.react.exports.useEffect((()=>{const e=c.throttle((()=>{a(!0),u()}),1e3,{leading:!0,trailing:!1});return u(),window.addEventListener("mousemove",e),window.addEventListener("focusin",e),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("focusin",e)}}),[u]),r.react.exports.useEffect((()=>{a(!0),u()}),[e]),r.react.exports.useEffect((()=>()=>{o.current&&(window.clearTimeout(o.current),o.current=void 0)}),[]),{elementProps:{onMouseEnter:s,onMouseLeave:l,onFocus:s,onBlur:l},isShown:n}}(E),F=No(Po,x),C=(e=>{const[t,i]=r.react.exports.useState(e);return r.react.exports.useEffect((()=>{const e=()=>{i(!0)},t=()=>{i(!1)};return document.addEventListener("snackbar_shown",e),document.addEventListener("snackbar_hidden",t),()=>{document.removeEventListener("snackbar_shown",e),document.removeEventListener("snackbar_hidden",t)}}),[]),t})(!!(null==v?void 0:v.isSnackbarVisible())),R=No(Io,x),j=No(So,x),k=No(Va,x),V=e===o.PreviewType.Video||e===o.PreviewType.Audio,D=!!(null==a?void 0:a.isFullScreen),A="hidden"===j,M=(O||"shown"===j||R||V&&!D)&&!C,N=!!(null==a?void 0:a.isDocSidebarOpen),L=i&&((null===(w=dn(i))||void 0===w?void 0:w.zoomScaleFactor)||(null===(m=dn(i))||void 0===m?void 0:m.fitScaleFactor))||void 0,U=i&&(null===(y=dn(i))||void 0===y?void 0:y.fitScaleFactor)||void 0,K=F?ks(e):Vs(e,h,s),z=!D&&K.docSidebar,$=z||K.fullscreen||K.pageNavigation||K.print||K.zooming&&null!=L,B=P<=450&&z&&K.fullscreen&&K.pageNavigation&&K.print&&K.zooming&&null!=L,W=Ms(D,e),H=N&&z&&!!d,G=($||k)&&!_;return r.React$1.createElement(r.React$1.Fragment,null,K.fileFlipping&&r.React$1.createElement(Us,{isShown:!A&&O,fileCollectionContext:null==S?void 0:S.file_collection_context,flipperCallbacks:T}),r.React$1.createElement("div",{className:n.classnames(g.toolbarHolder,{[g.withSidebar]:H}),"data-testid":"fvsdk_floating_toolbar"},r.React$1.createElement(Os,{active:A,direction:"down",end:150,offScreenElement:!1},r.React$1.createElement("div",Object.assign({className:n.classnames(g.toolbar,{[g.hidden]:!M,[g.toolbarAudioVideo]:V,[g.normal]:!W}),role:"toolbar","aria-hidden":A},T),r.React$1.createElement(Vl,{intl:b,allowRename:!!(null==S?void 0:S.file_path),rootArchiveFileInformation:l,fileMetadata:S,filePreviewUi:i,showInverse:W,fileViewerId:x,previewKey:E,hasFileCounter:K.fileFlipping,plugins:p,isEditingFilename:R}),V&&I?r.React$1.createElement(Rl,{player:I,isVideo:e===o.PreviewType.Video,fileViewerId:x,previewKey:E,fileRivieraData:t,activeCommentPlugin:u,showInverse:W,featureConfig:h}):G&&r.React$1.createElement(Dl,{filePreviewUi:i,previewType:e,isDocSidebarOpen:N,fileRivieraData:t,toolbarConfig:K,scaleFactor:L,fittedScaleFactor:U,plugins:p,useOverflowMenu:B,rendererWidth:P,isFullScreen:D,isSidebarEnable:z,intl:b,fileViewerId:x})))))};Al.displayName="ConfigurableToolbar";const Ml=({url:e,width:t,height:i,onImgLoad:n,sizeScale:a})=>r.React$1.createElement("div",{className:"skeleton-page-container",style:{margin:"auto",width:`${t}px`,height:`${i}px`}},r.React$1.createElement("img",{className:"skeleton-image",src:e,style:{width:`${t}px`,height:`${i}px`,opacity:"60%"},alt:"",onLoad:n,sizes:a?`${a}vw`:void 0}));Ml.displayName="SkeletonPage";const Nl=({viewportWidth:e,viewportHeight:t,docSidebarCollapsed:n,docContent:a,docMetadata:s,fileName:l,metricsReporter:c,partialPrewarmAllowed:d})=>{const[u,p]=r.React$1.useState(0),[v,g]=r.React$1.useState(0),[_,f]=r.React$1.useState(0),w=!n&&xl(e,o.PreviewType.SsrDoc)?ml:0,m=hl(l);r.React$1.useEffect((()=>{const i=i=>{const r=Pl({width:e,height:t,dimensions:i.dimensions,isDocSidebarVisible:!n,fileName:l,scaleToFit:"width_and_height",toolbarShown:!0}),a=i.dimensions[0][0],o=i.dimensions[0][1],s=100*(a*r)/window.innerWidth/window.devicePixelRatio;p(a*r),g(o*r),f(2*s)};if(0!==(null==s?void 0:s.page_count))if(null==s?void 0:s.dimensions.length)i(s);else if(null==a?void 0:a.text_url_tmpl){const[e,t]=sa(0,d);na.fetchDocMetadata(a.text_url_tmpl,!0,e,t).then((({data:e})=>{const t=null==e?void 0:e.metadata;if(!t)return;i(t);const r=document.getElementById("fvsdk-container");null==c||c.createStats({ns:"web_previews",name:"skeleton_doc_fetch_success"}).record(r?0:1)}))}}),[l,a,s,n,t,e,c,d]);const[y,b]=r.React$1.useState();return r.react.exports.useEffect((()=>{var e;(e=a,i.__awaiter(void 0,void 0,void 0,(function*(){return e.image_url_tmpl?na.fetchDocImage({imageUrlTmpl:e.image_url_tmpl}):Promise.resolve({data:void 0})}))).then((({data:e})=>b(e)))}),[a]),r.React$1.createElement("div",{className:"skeleton-doc-viewport-wrapper",style:{width:`${e}px`,height:"100%",display:"flex",overflow:"hidden"}},w>0&&r.React$1.createElement("div",{className:"skeleton-doc-sidebar",style:{width:`${w}px`,height:"100%",boxSizing:"border-box",borderRight:"1px solid rgba(166,158,146,0.6)",flexShrink:0}}),y&&r.React$1.createElement("div",{className:"skeleton-doc-viewport",style:{display:"flex",width:"100%"}},m?r.React$1.createElement("div",{className:"skeleton-ppt-viewport",style:{width:"100%"}},r.React$1.createElement("div",{className:"skeleton-ppt-sizer",style:{height:`calc(100% - ${fl}px)`,width:"100%",display:"flex"}},r.React$1.createElement(Ml,{width:u,height:v,url:y,sizeScale:_}))):r.React$1.createElement("ol",{style:{width:e-w+"px",height:`${v}px`,padding:0,listStyle:"none",display:"flex",flexDirection:"column",alignItems:"center",overflow:"hidden"}},r.React$1.createElement("li",{style:{transform:"translateY(16px)",margin:"16px 0"}},r.React$1.createElement(Ml,{width:u,height:v,url:y,sizeScale:_})))))};Nl.displayName="SkeletonViewportDoc";const Ll=({viewport:e,imageContent:t,dimensions:i})=>{const{thumbnailUrl:n,srcSet:a}={thumbnailUrl:(o=t).default_src,srcSet:o.src_set};var o;const[s,l]=r.React$1.useState(),[c,d]=r.React$1.useState(!!i),u=r.React$1.useMemo((()=>{const t=(null==i?void 0:i.width)||(null==s?void 0:s.width)||0,r=(null==i?void 0:i.height)||(null==s?void 0:s.height)||0;return t&&r&&d(!0),t>e.width||r>e.height}),[null==i?void 0:i.height,null==i?void 0:i.width,null==s?void 0:s.height,null==s?void 0:s.width,e.height,e.width]),p=r.React$1.useCallback((({currentTarget:{naturalWidth:e,naturalHeight:t}})=>{e&&t&&l({height:t,width:e})}),[]);return r.React$1.createElement("div",{style:c?{height:"100%",width:"100%"}:{height:0,width:0,overflow:"hidden"}},r.React$1.createElement("img",{src:n,srcSet:a,onLoad:p,style:{height:"100%",width:"100%",boxSizing:"border-box",objectFit:u?"contain":"scale-down",paddingTop:ve.top,paddingBottom:ve.bottom,paddingLeft:ve.horizontal/2,paddingRight:ve.horizontal/2},alt:""}))};Ll.displayName="SkeletonViewportImage";const Ul=({width:e,height:t,fileContent:i,docSidebarCollapsed:n,docMetadata:a,fileName:s,metricsReporter:l,partialPrewarmAllowed:c})=>{const d=null==i?void 0:i.content,u=null==d?void 0:d[".tag"],p={width:e,height:t};return r.React$1.createElement("div",{className:"skeleton-viewport",style:p},u===o.PreviewType.Image&&r.React$1.createElement(Ll,{viewport:p,imageContent:d,dimensions:null==i?void 0:i.dimensions}),u===o.PreviewType.SsrDoc&&r.React$1.createElement(Nl,{viewportWidth:e,viewportHeight:t,docSidebarCollapsed:n,docContent:d,docMetadata:a,fileName:s,metricsReporter:l,partialPrewarmAllowed:c}),u===o.PreviewType.CloudDoc&&r.React$1.createElement(Nl,{viewportWidth:e,viewportHeight:t,docSidebarCollapsed:n,docContent:d,docMetadata:a,fileName:s,metricsReporter:l,partialPrewarmAllowed:c}))};Ul.displayName="SkeletonViewportComponent";const Kl=r.React$1.memo(Ul);Kl.displayName="SkeletonViewport";const zl=(e,t,i)=>{var r,n;const a=null!==(r=null==e?void 0:e.previewType)&&void 0!==r?r:o.PreviewType.Error;switch(a){case o.PreviewType.SsrDoc:case o.PreviewType.CloudDoc:return(null===(n=null==i?void 0:i.file_name)||void 0===n?void 0:n.endsWith(".gsheet"))?o.PreviewType.RawHTML:a;case o.PreviewType.Excel:return"excel1"===t.excel_support.support?o.PreviewType.HTML:"ms_view_embed"===t.excel_support.embed_support?o.PreviewType.RawHTML:a;default:return a}},$l=()=>document.documentElement.clientWidth,Bl=()=>{const[e,t]=r.React$1.useState($l());return r.React$1.useEffect((()=>{const e=c.lodash.throttle((()=>t($l())),50);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),(e=>fo()?e>1026?v.ResponsiveSize.DESKTOP:e<=736?v.ResponsiveSize.MOBILE:v.ResponsiveSize.TABLET:e>736?v.ResponsiveSize.DESKTOP:e<=428?v.ResponsiveSize.MOBILE:v.ResponsiveSize.TABLET)(e)},Wl=({activeCommentPlugin:e,plugins:t,snackbarManagerPluginInstance:i,archiveFiles:a,fileConfig:s,fullFilePreviewUi:c,fullRivieraData:d,activeEditOverlayPlugin:u,children:p,width:v})=>{var g;const _=n.useIntl(),f=Bl(),{rendererWidth:w,rendererHeight:m}=Sl(),{fileViewerId:y,featureConfig:b}=re(),h=No(xa,y),x=No(Ia,y),P=No(Oa,y),E=No(Va,y),S=No(la,y),I=null==S?void 0:S.previewKey,O=Lo(pa,I),T=n.useSelector((e=>ya(e,y,I))),F=Lo(wa,I),C=Lo(_a,I),R=null!==(g=null==F?void 0:F.file_name)&&void 0!==g?g:"",j=zl(O,b,F),k=function(e,t,i,r,n,a){if(e!==o.PreviewType.Archive||!t)return{};const s=Yr(t.file_id,Jr((null==i?void 0:i.currentPath)||[])),l=ga(r,s),c=null==l?void 0:l.previewType,d=n[s.serialized],u=a[s.serialized];return l&&l.content&&d?{previewType:c,previewMetadata:l,filePreviewUi:d,fileRivieraData:u}:{}}(j,S,T,a,c,d),V=!!n.useSelector((e=>Eo(e,y))),D=n.useSelector((e=>function(e,t){return e.fileViewerState[t]}(e,y))),A=b.preview_content_only,M=!!u,N=j===o.PreviewType.Audio||j===o.PreviewType.Video,L=!!(null==D?void 0:D.error),U=j===o.PreviewType.Archive,K=!!Ie(O),z=j===o.PreviewType.Linkfile,$=!M&&!go()&&function(e){if(!e)return!1;const t=e[".tag"];return t===o.PreviewType.Image||t===o.PreviewType.SsrDoc||t===o.PreviewType.CloudDoc}(null==O?void 0:O.content)&&!P,B=!(A&&N||Ds(f,b)),W=K||z||L,H=xl(v,j)&&(null==h?void 0:h.isDocSidebarOpen),G=j===o.PreviewType.SsrDoc||j===o.PreviewType.CloudDoc,q=r.React$1.createElement(n.Spinner,{"aria-label":_.formatMessage({id:"zqXonC",defaultMessage:"Your preview is loading"}),inverse:x||M}),Z=$&&C&&r.React$1.createElement(Kl,{width:w,height:m,fileContent:O,docSidebarCollapsed:!H,docMetadata:G?C.metadata:void 0,fileName:R}),{handleTouchStart:X,handleTouchEnd:Q}=((e,t)=>{const i=n.useDispatch(),a=r.react.exports.useRef(0),o=r.react.exports.useRef(0),s=r.react.exports.useRef(0),c=r.react.exports.useRef(!1);return{handleTouchStart:r.react.exports.useCallback((e=>{const t=e.changedTouches[0];a.current=Date.now(),o.current=t.pageX,s.current=t.pageY,e.touches.length>1&&(c.current=!0)}),[a,o,s,c]),handleTouchEnd:r.react.exports.useCallback((r=>{const n=r.changedTouches[0];if(c.current)return void(0===r.touches.length&&(c.current=!1));if(Math.abs(n.pageY-s.current)>200)return;if(Date.now()-a.current>500)return;const d=n.pageX-o.current;d<=-100?i(Ge({fileViewerId:e,previewKey:t,sourceContext:l.UserActionContext.SurfaceGesture})):d>=100&&i(qe({fileViewerId:e,previewKey:t,sourceContext:l.UserActionContext.SurfaceGesture}))}),[e,t,a,o,s,c,i])}})(y,I);return r.React$1.createElement("div",{className:n.classnames("_previewContentWrapper_9oi8y_23",{_editMode_9oi8y_19:M}),onTouchStart:X,onTouchEnd:Q},r.React$1.createElement("div",{className:n.classnames("_loadingContent_9oi8y_1",{[Rs]:!E&&!V,[Cs]:x})},E?$?Z:q:null),r.React$1.createElement("div",{className:n.classnames("_previewContent_9oi8y_8",{[Rs]:E||V})},p),r.React$1.createElement("div",{className:n.classnames({[Rs]:V})},B&&r.React$1.createElement(Al,Object.assign({previewType:j,fileRivieraData:C,filePreviewUi:T,fileViewerUi:h,rootArchiveFileInformation:U&&I?{fileName:R,previewKey:I}:void 0,activeCommentPlugin:e,previewMetadata:O,plugins:t,snackbarManagerPluginInstance:i,forceHideControlRow:W,fileConfig:s},k))))};Wl.displayName="PreviewContent";const Hl=({Sidebar:e,fileViewerId:t,pluginNavigation:i})=>{const a=n.useSelector((e=>bo(e,{fileViewerId:t,navigation:i}))),o=n.useSelector((e=>Ps(e,t,a)));return o?r.React$1.createElement("div",{className:"_editPluginContainer_4jer5_28"},r.React$1.createElement(e,Object.assign({},o))):null};Hl.displayName="EditPluginSidebar";class Gl extends r.React$1.PureComponent{componentDidCatch(e){this.props.onError(e)}render(){return this.props.children}}Gl.displayName="UnconnectedErrorBoundary";const ql=({previewKey:e,children:i})=>{var a;const s=Lo(pa,e),l=null===(a=re().batteries.optionalIOClients.reportExceptionClient)||void 0===a?void 0:a.reportException,c=n.useDispatch(),d=As((i=>{var r;null==l||l(i,(null===(r=null==s?void 0:s.content)||void 0===r?void 0:r[".tag"])||"other",!0),e&&c(Ze({previewKey:e,previewType:o.PreviewType.Error,error:yn(i)?i:new zr(t.FVErrorCode.Unknown,i.message)}))}));return r.React$1.createElement(Gl,{onError:d},i)};ql.displayName="ErrorBoundary";const Zl=(e,t)=>Je({fileViewerId:e,pluginId:t,sourceContext:l.UserActionContext.Toolbar}),Xl=r.React$1.memo((({icon:e,label:t,pluginId:i,fileViewerId:a,callback:o})=>{const s=n.useDispatch(),l=r.react.exports.useCallback((()=>{s(Zl(a,i)),null==o||o()}),[a,i,s]);return r.React$1.createElement(n.Menu.ActionItem,{value:{nodeType:"dropdown",actionType:v.ActionBarActionTypes.CUSTOM_ACTION,id:i,menuItem:{handler:l}},withLeftAccessory:e,disabled:!1},t)}));Xl.displayName="EditFullscreenOverflowItem";const Ql=r.React$1.memo((({icon:e,label:t,pluginId:i,fileViewerId:a,hideIcons:o,callback:s})=>{const l=n.useDispatch(),c=r.react.exports.useCallback((()=>{l(Zl(a,i)),null==s||s()}),[a,i,l]);return r.React$1.createElement(n.Button,{variant:"opacity",onClick:c,withIconLeft:o?null:e,disabled:!1,"data-campaigns-element-id":"action-bar-edit-button","data-tooltip":"action-bar-edit-button","data-testid":"edit-document-button"},t)}));Ql.displayName="EditFullscreenRenderButton";const Yl=n.defaultMemoize(((e,t)=>(({editFullscreenPlugins:e,fileViewerId:t})=>Object.entries(e).map((([e,i])=>{const a=r.React$1.createElement(n.UIIcon,{src:i.buttonIcon});return{overflowItem:r.React$1.createElement(Xl,{icon:a,label:i.buttonText,pluginId:e,fileViewerId:t,callback:i.onActivate}),renderButton:n=>r.React$1.createElement(Ql,{hideIcons:n,icon:a,label:i.buttonText,pluginId:e,fileViewerId:t,callback:i.onActivate}),id:"FULLSCREEN_ACTION"}})))({editFullscreenPlugins:Object.entries(e).reduce(((e,[t,i])=>t===q?e:ce(i)?Object.assign(Object.assign({},e),{[t]:i}):e),{}),fileViewerId:t}))),Jl=new Set([d.PreviewsTimingEvents.CONTAINER_MOUNT,d.PreviewsTimingEvents.COLLECTION_VIEWER_MOUNT,d.PreviewsTimingEvents.SDK_FILE_VIEWER_CODE_START,d.PreviewsTimingEvents.FVSDK_CONSTRUCTOR,d.PreviewsTimingEvents.FVSDK_INITIALIZE_START,d.PreviewsTimingEvents.FVSDK_PLUGINS_INITIALIZED,d.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA_START_START,d.PreviewsTimingEvents.FVSDK_GET_PREVIEW_METADATA,d.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA,d.PreviewsTimingEvents.FVSDK_INITIALIZE_COMPLETE,d.PreviewsTimingEvents.FVSDK_TITLE_BAR_MOUNT,d.PreviewsTimingEvents.FVSDK_APP_MOUNT,d.PreviewsTimingEvents.FVSDK_MARK_TTVC,d.PreviewsTimingEvents.FVSDK_IMAGE_CONTAINER_MOUNT,d.PreviewsTimingEvents.FVSDK_IMAGE_ON_LOAD,d.PreviewsTimingEvents.FVSDK_VIDEO_CONTAINER_MOUNT,d.PreviewsTimingEvents.FVSDK_VIDEO_PLAYER_READY,d.PreviewsTimingEvents.FVSDK_DOC_CONTAINER_MOUNT,d.PreviewsTimingEvents.FVSDK_FIRST_DOC_PAGE_ON_LOAD]),ec=new Set([...Jl,d.PreviewsTimingEvents.FVSDK_MARK_TTI]),tc=(e,t,i)=>{const a=n.useSelector((t=>t.loggingSession[e])),{batteries:o}=re(),s=r.React$1.useRef(!1);return{onLogTimeline:r.React$1.useCallback((()=>{var e,r;const n=d.PreviewsEventLogger.getStartEntry();if(n&&!s.current){const l=d.PreviewsEventLogger.getEventTimeline();Object.entries(l).forEach((([e,r])=>{var n,s;i.has(e)&&(null===(s=null===(n=null==o?void 0:o.logger)||void 0===n?void 0:n.logDuration)||void 0===s||s.call(n,{eventName:t,durationInMs:r,tags:{event:e},session:a?za(a):void 0}))})),null===(r=null===(e=null==o?void 0:o.logger)||void 0===e?void 0:e.logDuration)||void 0===r||r.call(e,{eventName:t,durationInMs:n.startTime,tags:{event:"session_start_since_load"},session:a?za(a):void 0}),s.current=!0}}),[null==o?void 0:o.logger,t,a,i])}},ic=(e,t)=>{const i=n.useDispatch(),a=n.useSelector((t=>t.loggingSession[e])),{batteries:o}=re(),{onLogTimeline:s}=tc(e,"preview_timeline",ec),{onLogTimeline:l}=tc(e,`preview_timeline_ttvc_${t}`,Jl),c=r.React$1.useCallback((()=>{var t;d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_MARK_TTI),i((t=e,{type:Kr.LogTTI,payload:t})),s()}),[e,i,s]),u=r.React$1.useCallback((e=>{var t,i,r;(null===(t=e.detail)||void 0===t?void 0:t.value)&&(null===(r=null===(i=null==o?void 0:o.logger)||void 0===i?void 0:i.logDuration)||void 0===r||r.call(i,{eventName:"TTI",durationInMs:e.detail.value,shouldLogToHive:!0,tags:{navigation_type:e.detail.isAjax?"ajax":"page_load"},session:a?za(a):void 0}))}),[o,a]),p=r.React$1.useCallback((e=>{var t,i,r,n;d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_MARK_TTVC),(null===(t=e.detail)||void 0===t?void 0:t.value)&&(null===(r=null===(i=null==o?void 0:o.logger)||void 0===i?void 0:i.logDuration)||void 0===r||r.call(i,{eventName:"visually_complete",durationInMs:e.detail.value,tags:{navigation_type:null!==(n=e.detail.navigation_type)&&void 0!==n?n:"unknown",file_flip:String(!!(null==a?void 0:a.extra.was_flipped))},shouldLogToHive:!0,session:a?za(a):void 0})),l()}),[null==o?void 0:o.logger,l,a]),v=r.React$1.useCallback((e=>{var t,i,r;d.PreviewsEventLogger.mark(d.PreviewsTimingEvents.FVSDK_MARK_LCP),(null===(t=e.detail)||void 0===t?void 0:t.value)&&(null===(r=null===(i=null==o?void 0:o.logger)||void 0===i?void 0:i.logDuration)||void 0===r||r.call(i,{eventName:"largest_contentful_paint",durationInMs:e.detail.value,shouldLogToHive:!0,session:a?za(a):void 0}))}),[o,a]);return r.React$1.useEffect((()=>(window.addEventListener("time_to_interactive",u),window.addEventListener("visually_complete",p),window.addEventListener("largest_contentful_paint",v),()=>{window.removeEventListener("time_to_interactive",u),window.removeEventListener("visually_complete",p),window.removeEventListener("largest_contentful_paint",v)})),[u,p,v]),{onLogTTI:c}};function rc(e){return null!=e&&null!=e.preventDefault}function nc(e){return function(t){e(),rc(t)&&t.preventDefault()}}function ac({dispatch:e,fileViewerId:t,previewKey:i,requireCommandKey:r,fileIndex:a}){if(0===a)return[];const o=nc((()=>{e(qe({fileViewerId:t,previewKey:i,sourceContext:l.UserActionContext.Keyboard}))})),s={keyboardEventCriteria:{key:n.Key_enum.Key.ArrowLeft,osModifierKey:!0},callback:o};return r?[s]:[{keyboardEventCriteria:{key:n.Key_enum.Key.ArrowLeft},callback:o},s]}function oc({dispatch:e,fileViewerId:t,previewKey:i,requireCommandKey:r,fileIndex:a,collectionFileCount:o}){if(a===o-1)return[];const s=nc((()=>{e(Ge({fileViewerId:t,previewKey:i,sourceContext:l.UserActionContext.Keyboard}))})),c={keyboardEventCriteria:{key:n.Key_enum.Key.ArrowRight,osModifierKey:!0},callback:s};return r?[c]:[{keyboardEventCriteria:{key:n.Key_enum.Key.ArrowRight},callback:s},c]}function sc(e){return{keyboardEventCriteria:{key:n.Key_enum.Key.PageDown},callback:nc(e)}}function lc(e){return{keyboardEventCriteria:{key:n.Key_enum.Key.ArrowDown},callback:nc(e)}}function cc(e){return[{keyboardEventCriteria:{key:"-",osModifierKey:!0},callback:nc(e)}]}function dc(e){return{keyboardEventCriteria:{key:n.Key_enum.Key.End},callback:nc(e)}}function uc({key:e,callback:t,shift:i,osModifierKey:r}){return{keyboardEventCriteria:{key:e,shiftKey:i||!1,osModifierKey:r||!1},callback:t}}const pc=()=>{},vc=r.react.exports.createContext({registerKeyBindings:pc,unregisterKeyBindings:pc});vc.displayName="KeyboardBindingContext";const gc=e=>{const{keyboardBindings:t,name:i,scope:n}=e,a=r.react.exports.useRef(i),o=r.react.exports.useRef(n||!1),s=r.react.exports.useContext(vc);return r.react.exports.useEffect((()=>(s.registerKeyBindings(t,a.current,o.current),()=>{s.unregisterKeyBindings(a.current,o.current)})),[t]),null};gc.displayName="KeyboardBindingConnector";const _c={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:n.Key_enum.Key.Unidentified},fc=Object.keys(_c);function wc(e){return fc.map((t=>`${t}:${e[t]}`)).join("")}function mc(e,t){return function(e,t){return e.reduce(((e,{keyboardEventCriteria:i,callback:r})=>(e[t(i)]=r,e)),{})}(e,(e=>function(e,t){const i=function(e,t){return{altKey:!0===e.altKey,shiftKey:!0===e.shiftKey,key:e.key,ctrlKey:!1,metaKey:!1,[t]:!0===e.osModifierKey}}(e,t);return wc(i)}(e,t)))}class yc{constructor(e,t){this.bindingDict={},this.bindingDict=mc(e,t)}getCallbackForEvent(e){const t=function(e){return{altKey:!0===e.altKey,ctrlKey:!0===e.ctrlKey,metaKey:!0===e.metaKey,shiftKey:!0===e.shiftKey,key:e.key}}(e);return this.bindingDict[wc(t)]}}const bc="default",hc=e=>{const{disableBindings:t,children:i,osModifierKey:n}=e,a=r.react.exports.useRef({}),o=r.react.exports.useRef(bc),s=r.react.exports.useRef(null),l=r.react.exports.useCallback(((e,t,i)=>{if(a.current[i]||(a.current[i]={}),e){if(a.current[i][t])throw new Error(`Keybindings for name ${t} registered twice`);a.current[i][t]=e}else delete a.current[i][t];const r=a.current[o.current];s.current=new yc((e=>c.flatten(Object.values(e)))(r),n)}),[]),d=r.react.exports.useCallback(((e,t,i)=>{i&&t!==o.current&&(o.current=t),l(e,t,i?t:bc)}),[]),u=r.react.exports.useCallback(((e,t)=>{t&&o.current===e&&(o.current=bc),l(void 0,e,t?e:bc)}),[]),p=r.react.exports.useCallback((e=>{var t;if(!function(e){const t=e.target||e.srcElement;if(!t)return!0;const i=t.tagName,r="INPUT"===i||"SELECT"===i||"TEXTAREA"===i,n=t instanceof HTMLInputElement&&("submit"===t.type||"button"==t.type);return!(t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase())&&(!r||n)}(e))return;const i=null===(t=s.current)||void 0===t?void 0:t.getCallbackForEvent(e);i&&i(e)}),[]);r.react.exports.useEffect((()=>{if(!0!==t){const e=c.throttle(p,0);return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}}),[p]);const v=r.react.exports.useMemo((()=>({registerKeyBindings:d,unregisterKeyBindings:u,updateKeyBindings:l})),[]);return r.react.exports.createElement(vc.Provider,{value:v},i)};hc.displayName="KeyboardBindingProvider";n.injectInternalStyle("typescript/libraries/file-viewer/src/preview_error/preview_error.module.out.css",(e=>"._container_9t5i9_1{align-items:center;display:flex;flex-direction:column;height:100%;justify-content:center;margin:0 auto;max-width:650px;text-align:center}._img_9t5i9_12{max-height:300px}._header_9t5i9_16{margin:14px 0 8px}._header_9t5i9_16 h1{font-size:var(--type__title__standard--fontsize)}._message_9t5i9_24{font-size:var(--type__body__standard--fontsize);line-height:var(--type__body__standard--lineheight)}._ctaSecondary_9t5i9_29{margin-bottom:8px;margin-top:8px}._ctaLink_9t5i9_34{margin-top:var(--spacing__unit--1)}._illustrationContainer_9t5i9_38{height:25vh;max-height:300px;max-width:300px;width:25vh}@media (max-height:400px){._illustrationContainer_9t5i9_38{display:none}}"));n.injectInternalStyle("typescript/libraries/file-viewer/src/ui/header.module.out.css",(e=>"._headerContainer_1uudo_1{align-items:center;display:flex;flex:1;flex-direction:column;height:100%;min-width:0}._floatingHeader_1uudo_10{background-color:var(--color__standard__background);box-shadow:var(--boxshadow__elevation1);margin-top:16px;position:absolute;z-index:10}._authButtons_1uudo_22{display:flex;justify-content:space-around;width:170px}"));const xc="_headerContainer_1uudo_1",Pc=({previewKey:e,fileViewerId:t,className:i="",sourceContext:a=l.UserActionContext.RightRail})=>{const o=n.useIntl(),s=n.useDispatch();if(!e)return null;const c=r.react.exports.createElement(n.UIIcon,{src:n.OpenLine});return r.react.exports.createElement(n.Button,{size:"standard",onClick:()=>{return s((i={fileViewerId:t,previewKey:e,sourceContext:a},{type:Oe.OpenWith,payload:i}));var i},variant:"outline",className:n.classnames(i),withIconLeft:c},o.formatMessage({id:"tB7wey",defaultMessage:"Open"}))};Pc.displayName="UnconnectedOpenWithButton";const Ec=n.connect((function(e,t){const{fileViewerId:i}=t;return{previewKey:ua(e,i)}}))(Pc),Sc=({fileViewerId:e,previewKey:t,canDownload:i,copyTargets:a})=>{var o,s;const c=n.useIntl(),d=n.useDispatch(),u=()=>{var i;d((i={previewKey:t,fileViewerId:e,sourceContext:l.UserActionContext.RightRail},{type:Oe.DownloadFile,payload:i}))},p=i=>()=>{var r;d((r={previewKey:t,fileViewerId:e,sourceContext:l.UserActionContext.RightRail,role:i},{type:Oe.CopyToDropbox,payload:r}))},v=c.formatMessage({id:"Mran8D",defaultMessage:"Download"}),g=[i?{text:v,value:u,disabled:!1,key:"download"}:void 0,...a.map((({text:e,isDisabled:t,role:i})=>({text:e,value:p(i),disabled:t,key:e})))].filter(Boolean);if(1===g.length)return r.react.exports.createElement(n.Button,{onClick:null===(o=g[0])||void 0===o?void 0:o.value,variant:"outline"},null===(s=g[0])||void 0===s?void 0:s.text);const _=g.map((e=>e?r.react.exports.createElement(n.Menu.ActionItem,{id:"download-menu-item",key:e.key,value:e.value,disabled:e.disabled},e.text):null));return r.react.exports.createElement(n.SplitButton,{disabled:!i,variant:"outline",renderMenu:Ic(_,c.formatMessage({id:"zeKy1a",defaultMessage:"More download options"})),onClick:u},v)};Sc.displayName="DownloadDropdown";const Ic=(e,t)=>({buttonProps:i})=>r.react.exports.createElement(n.Menu.Wrapper,{key:"download-dropdown-menu",onSelection:e=>{e()}},(({getContentProps:a,getTriggerProps:o})=>r.react.exports.createElement(r.react.exports.Fragment,null,r.react.exports.createElement(n.Button,Object.assign({},o(),i,{"aria-label":t})),r.react.exports.createElement(n.Menu.Content,Object.assign({},a()),r.react.exports.createElement(n.Menu.Segment,null,e)))));Sc.displayName="DownloadDropdown";const Oc=r.react.exports.memo((({pluginProps:e,activeCommentPlugin:t,header:i})=>{var a;const[o,s]=r.react.exports.useState(!1),{featureConfig:l,fileViewerId:c}=re(),d="errored"===(null===(a=n.useSelector((e=>la(e,c))))||void 0===a?void 0:a.bootstrap.state);if(l.preview_content_only)return null;if(!d&&t){const i=t.commentUI.Header;return o||s(!0),r.react.exports.createElement(i,Object.assign({},e))}if(i&&!o){const e=i;return r.react.exports.createElement(e,{onHide:()=>s(!0)})}return null}));Oc.displayName="PluginHeader";const Tc=(e,t)=>{const n=r.react.exports.lazy((()=>i.__awaiter(void 0,void 0,void 0,(function*(){const{[t]:i}=yield e();return{default:i}})))),a=()=>r.react.exports.createElement(r.react.exports.Suspense,{fallback:null},r.react.exports.createElement(n,null));return a.displayName=`Async${t}`,a},Fc=Tc((()=>new Promise((function(t,i){e(["./c_dig-illustrations_spot_look-view"],t,i)}))),"LookViewSpot"),Cc=Tc((()=>new Promise((function(t,i){e(["./c_dig-illustrations_spot_traffic-duck-crossing"],t,i)}))),"TrafficDuckCrossingSpot"),Rc=Tc((()=>new Promise((function(t,i){e(["./c_dig-illustrations_spot_team-ants"],t,i)}))),"TeamAntsSpot"),jc=Tc((()=>new Promise((function(t,i){e(["./c_dig-illustrations_spot_passcode-lock"],t,i)}))),"PasscodeLockSpot"),kc=n.defineMessage({id:"f0donV",defaultMessage:"Couldn't preview this file"}),Vc=e=>{var{title:t,message:a,illustration:o,children:s}=e,l=i.__rest(e,["title","message","illustration","children"]);return r.react.exports.createElement("article",{className:"_container_9t5i9_1"},r.react.exports.createElement("div",{className:"_illustrationContainer_9t5i9_38"},o),r.react.exports.createElement("header",{className:"_header_9t5i9_16"},r.react.exports.createElement(n.Title,{tagName:"h1"},t)),a?r.react.exports.createElement("p",{className:"_message_9t5i9_24"},a):null,l.enableDownloadButton&&r.react.exports.createElement(Dc,Object.assign({},l)),s)};Vc.displayName="ErrorContent",Vc.displayName="ErrorContent";const Dc=({fileConfig:e,fileViewerId:t,previewKey:i})=>{var n,a,o,s,l,c,d;const u=null===(n=Uo(ya,t,i))||void 0===n?void 0:n.currentPath;return u&&u.length>0?null:(null===(a=e.download_button)||void 0===a?void 0:a.enable_download_button)&&i?r.react.exports.createElement(Sc,{fileViewerId:t,previewKey:i,copyTargets:null!==(s=null===(o=e.download_button)||void 0===o?void 0:o.copy_targets)&&void 0!==s?s:[],canDownload:null!==(c=null===(l=e.download_button)||void 0===l?void 0:l.can_download)&&void 0!==c&&c}):(null===(d=e.download_button)||void 0===d?void 0:d.enable_open_with_button)&&i?r.react.exports.createElement(Ec,{fileViewerId:t,className:"_ctaSecondary_9t5i9_29"}):null};Dc.displayName="DownloadOrOpenWithButton",Dc.displayName="DownloadOrOpenWithButton";const Ac=e=>{const{fileViewerId:t,fileMetadata:i,previewKey:a,fileConfig:o}=e,s=n.useIntl(),c=n.useDispatch();return r.react.exports.createElement(Vc,Object.assign({illustration:r.react.exports.createElement(Fc,null),title:s.formatMessage({id:"73IpwD",defaultMessage:"{extension} files can’t currently be previewed."},{extension:h(i?i.file_name:"")})},e),o.enable_view_on_dropbox_button&&a?r.react.exports.createElement("div",{className:"_ctaLink_9t5i9_34"},r.react.exports.createElement(n.Button,{variant:"transparent",onClick:()=>{return c((e={fileViewerId:t,previewKey:a,sourceContext:l.UserActionContext.PreviewError},{type:Oe.OpenWebPreview,payload:e}));var e}},s.formatMessage({id:"qLPMn5",defaultMessage:"View on dropbox.com"}))):null)};Ac.displayName="FiletypeNotSupported",Ac.displayName="FiletypeNotSupported";const Mc=({fileMetadata:e})=>{const t=n.useIntl(),{file_name:i,size:a}=null!=e?e:{},o=i&&h(i),s=o?t.formatMessage({id:"x+ecOm",defaultMessage:"{extension} files can’t be previewed from an archive file."},{extension:o}):t.formatMessage({id:"SQjtty",defaultMessage:"This file cannot be previewed. Please check to see if your file extension is correct."});return r.react.exports.createElement(Vc,{illustration:r.react.exports.createElement(Fc,null),title:s,message:i&&a?t.formatMessage({id:"WF66bN",defaultMessage:"{filename} · {filesize}"},{filename:i,filesize:n.format_bytes$1(t,a)}):void 0})};Mc.displayName="ArchiveNestedFiletypeNotSupported",Mc.displayName="ArchiveNestedFiletypeNotSupported";const Nc=e=>{var{fileName:t}=e,a=i.__rest(e,["fileName"]);const o=n.useIntl();return r.react.exports.createElement(Vc,Object.assign({illustration:r.react.exports.createElement(jc,null),title:o.formatMessage({id:"tzyBCT",defaultMessage:"This {extension} file is password-protected"},{extension:h(t)})},a))};Nc.displayName="PasswordProtected",Nc.displayName="PasswordProtected";const Lc=({fileViewerId:e})=>{var t,i;const a=null!==(i=null===(t=No(ma,e))||void 0===t?void 0:t.file_name)&&void 0!==i?i:"",o=n.useIntl();return r.react.exports.createElement(Vc,{illustration:r.react.exports.createElement(jc,null),title:o.formatMessage({id:"eO6mPw",defaultMessage:"Can't preview items inside password protected {extension} files."},{extension:h(a)})})};Lc.displayName="ArchiveFilePasswordProtected",Lc.displayName="ArchiveFilePasswordProtected";const Uc=e=>{const t=n.useIntl().formatMessage(kc);return r.react.exports.createElement(Vc,Object.assign({illustration:r.react.exports.createElement(Fc,null),title:t},e))};Uc.displayName="Unavailable",Uc.displayName="Unavailable";const Kc=e=>{const t=n.useIntl(),{fileMetadata:i}=e,a=i?t.formatMessage({id:"ejp+g5",defaultMessage:"{extension} files are supported but something went wrong."},{extension:h(i.file_name)}):t.formatMessage({id:"0ljH1z",defaultMessage:"This file cannot be previewed"});return r.react.exports.createElement(Vc,Object.assign({illustration:r.react.exports.createElement(Fc,null),title:a},e))};Kc.displayName="DataFetchFailure",Kc.displayName="DataFetchFailure";const zc=e=>{const t=n.useIntl();return r.react.exports.createElement(Vc,Object.assign({illustration:r.react.exports.createElement(Fc,null),title:t.formatMessage({id:"vbytsy",defaultMessage:"Files without extensions cannot be previewed"})},e))};zc.displayName="NoExtension",zc.displayName="NoExtension";const $c=e=>{const t=n.useIntl(),{fileMetadata:i,previewMetadata:a,config:o}=e;return r.react.exports.createElement(Vc,Object.assign({illustration:r.react.exports.createElement(Rc,null),title:t.formatMessage({id:"Jap7oN",defaultMessage:"This file is too big to preview"}),message:t.formatMessage({id:"CaboZW",defaultMessage:"The maximum size for {extension} files is {size}"},{extension:i?h(i.file_name):"",size:n.format_bytes$1(t,A(i?i.file_name:"",null==a?void 0:a.previewType,o))})},e))};$c.displayName="FileTooLarge",$c.displayName="FileTooLarge";const Bc=()=>{const e=n.useIntl();return r.react.exports.createElement(Vc,{illustration:r.react.exports.createElement(Cc,null),title:e.formatMessage({id:"fz7GLr",defaultMessage:"File is uploading"})})};Bc.displayName="FileUploading",Bc.displayName="FileUploading";const Wc=()=>{const e=n.useIntl();return r.react.exports.createElement(Vc,{illustration:r.react.exports.createElement(Fc,null),title:e.formatMessage({id:"jZUA7r",defaultMessage:"This file cannot be previewed because you are offline"})})};Wc.displayName="UserOffline",Wc.displayName="UserOffline";const Hc=e=>{const i={enableDownloadButton:!0,fileConfig:e.fileConfig,previewKey:e.previewKey,fileViewerId:e.fileViewerId};switch(e.error.type){case t.FVErrorCode.UnsupportedPreviewType:return r.react.exports.createElement(Ac,Object.assign({},i,{fileMetadata:e.fileMetadata}));case t.FVErrorCode.NoExtension:return r.react.exports.createElement(zc,Object.assign({},i));case t.FVErrorCode.FileTooLarge:return r.react.exports.createElement($c,Object.assign({},i,{fileMetadata:e.fileMetadata,config:e.config,previewMetadata:e.previewMetadata}));case t.FVErrorCode.PasswordProtected:return r.react.exports.createElement(Nc,Object.assign({fileName:e.fileMetadata?e.fileMetadata.file_name:""},i));case t.FVErrorCode.FileUploading:return r.react.exports.createElement(Bc,null);case t.FVErrorCode.UserOffline:return r.react.exports.createElement(Wc,null);case t.FVErrorCode.RivieraDataFetchFailure:case t.FVErrorCode.PreviewsDataApiFailure:case t.FVErrorCode.MalformedPreviewsDataApiResponse:case t.FVErrorCode.MalformedRivieraData:return r.react.exports.createElement(Kc,Object.assign({},i,{fileMetadata:e.fileMetadata}));case t.FVErrorCode.NestedFiletypeNotSupported:return r.react.exports.createElement(Mc,{fileMetadata:e.fileMetadata});case t.FVErrorCode.PasswordProtectedArchivesNotSupported:return r.react.exports.createElement(Lc,{fileViewerId:e.fileViewerId});case t.FVErrorCode.Unknown:case t.FVErrorCode.FileSwitched:case t.FVErrorCode.InvalidFileInfo:case t.FVErrorCode.InvalidLoggingOrder:case t.FVErrorCode.InvalidLoggingSession:case t.FVErrorCode.MissingContentMetadata:return r.react.exports.createElement(Uc,Object.assign({},i))}};Hc.displayName="ErrorPage",Hc.displayName="ErrorPage";const Gc=e=>{var t;const{previewKey:i,fileViewerId:a,pluginProps:o,activeCommentPlugin:s,header:l,onComponentRendered:c,onInteractive:d,error:u}=e,p=n.useDispatch(),{fileMetadata:v,previewMetadata:g}=null!==(t=Ko(a,i,(e=>e)))&&void 0!==t?t:{};return r.react.exports.useEffect((()=>{c(),d()}),[]),r.react.exports.useEffect((()=>(u&&p(lt({fileViewerId:a,error:u})),()=>{u&&p(lt({fileViewerId:a,error:void 0}))})),[]),r.react.exports.createElement("div",{className:xc},o&&r.react.exports.createElement(Oc,{pluginProps:o,activeCommentPlugin:s,header:l}),r.react.exports.createElement(Hc,Object.assign({},e,{fileMetadata:v,previewMetadata:g})))};Gc.displayName="PreviewErrorBase";const qc=e=>r.react.exports.createElement(Gc,Object.assign({onComponentRendered:e.onRenderFailed},e));qc.displayName="PreviewRenderError";const Zc=e=>r.react.exports.createElement(Gc,Object.assign({onComponentRendered:e.onSetPreviewLoaded},e));Zc.displayName="PreviewBootstrapError",qc.displayName="PreviewRenderError",Zc.displayName="PreviewBootstrapError",Gc.displayName="PreviewErrorBase";var Xc=Object.freeze({__proto__:null,ErrorContent:Vc,FiletypeNotSupported:Ac,PasswordProtected:Nc,ArchiveFilePasswordProtected:Lc,Unavailable:Uc,DataFetchFailure:Kc,NoExtension:zc,FileTooLarge:$c,FileUploading:Bc,UserOffline:Wc,TestOnlyErrorPage:Hc,PreviewErrorBase:Gc,PreviewRenderError:qc,PreviewBootstrapError:Zc});const Qc=(e,t,i)=>{const a=n.useDispatch(),{batteries:s}=re(),c=As((e=>{var t;e instanceof Error&&(null===(t=s.optionalIOClients.reportExceptionClient)||void 0===t||t.reportException(e,o.PreviewType.Other,!0))}));r.react.exports.useEffect((()=>{var r,n;if(t){try{null===(n=null===(r=t.lifecycle)||void 0===r?void 0:r.pluginDidActivate)||void 0===n||n.call(r,i)}catch(t){c(t),a(Wr({event:l.SessionEventType.LifecycleFailure,fileViewerId:e,extra:{e:t}}))}return()=>{var i,r;try{null===(r=null===(i=t.lifecycle)||void 0===i?void 0:i.pluginDidDeactivate)||void 0===r||r.call(i)}catch(t){c(t),a(Wr({event:l.SessionEventType.LifecycleFailure,fileViewerId:e,extra:{e:t}}))}}}}),[t])},Yc=()=>{},Jc=r.react.exports.createContext({add:Yc,update:Yc,remove:Yc,shouldOpen:!1}),ed={numberOfDrawers:0},td=(e,t)=>{const{numberOfDrawers:i,drawer:r}=e;switch(t.kind){case"add":if(i>0)throw new Error("Drawer Wrapper already contains a Drawer, and will not function accurately. Have you considered using multiple Drawer Wrappers?");return{numberOfDrawers:i+1,drawer:r};case"update":const{drawer:e}=t;return{numberOfDrawers:i,drawer:Object.assign({},e)};case"remove":return{numberOfDrawers:i-1,drawer:r}}return e};n.injectInternalStyle("typescript/component_libraries/files_components/src/inline-drawer/wrapper.module.out.css",(e=>"._inlineDrawer-wrapper_g41bj_9{height:100%;overflow:hidden;position:relative}._inlineDrawer-wrapper-body_g41bj_15{height:100%}._inlineDrawer-wrapper-body--shouldAnimate_g41bj_23{transition-duration:var(--duration__surface);transition-property:margin,height;transition-timing-function:var(--easing__leave)}._inlineDrawer-wrapper-body--shouldAnimate_g41bj_23._inlineDrawer-wrapper-body--isOpen_g41bj_29{transition-timing-function:var(--easing__enter)}"));const id="_inlineDrawer-wrapper_g41bj_9",rd="_inlineDrawer-wrapper-body_g41bj_15",nd="_inlineDrawer-wrapper-body--shouldAnimate_g41bj_23",ad="_inlineDrawer-wrapper-body--isOpen_g41bj_29",od=e=>{var{children:t,className:a,drawer:o}=e,s=i.__rest(e,["children","className","drawer"]);const{state:l,add:c,update:d,remove:u}=(()=>{const[e,t]=r.react.exports.useReducer(td,ed);return{state:e,update:r.react.exports.useCallback((e=>{t({kind:"update",drawer:e})}),[t]),add:r.react.exports.useCallback((()=>{t({kind:"add"})}),[t]),remove:r.react.exports.useCallback((()=>{t({kind:"remove"})}),[t])}})(),{drawer:p}=l,v=(e=>{if(!e||e&&!e.isOpen)return null;const{alignment:t,dimension:i}=e;let r="";switch(t){case"bottom":r="marginBottom";break;case"left":r="marginLeft";break;case"right":r="marginRight"}if(!r||!i)return null;const n={[r]:`${i}px`};return"bottom"===t&&(n.height=`calc(100% - ${i}px)`),n})(p),g=!!p&&p.isOpen;return r.React$1.createElement(Jc.Provider,{value:{add:c,update:d,remove:u,shouldOpen:g}},r.React$1.createElement("div",Object.assign({className:n.classnames(id,a)},s),r.React$1.createElement("div",{className:n.classnames(rd,{[nd]:null!==p,[ad]:g}),style:v||{}},t),o))};od.displayName="InlineDrawerWrapper",od.displayName="InlineDrawerWrapper";n.injectInternalStyle("typescript/component_libraries/files_components/src/inline-drawer/inline_drawer.module.out.css",(e=>"._drawer_1l8q0_1{background-color:var(--dig-color__background__base);border:0 solid var(--dig-color__border__subtle);display:flex;flex-direction:column;position:absolute}._drawer--shouldAnimate_1l8q0_11{transition:transform var(--duration__surface) var(--easing__leave)}._drawer--horizontal_1l8q0_15{bottom:0;max-width:100%;top:0}._drawer--vertical_1l8q0_21{left:0;max-height:100%;right:0}._drawer--leftAlign_1l8q0_27{border-right-width:1px;left:0;transform:translateX(-100%)}._drawer--rightAlign_1l8q0_33{border-left-width:1px;right:0;transform:translateX(100%)}._drawer--bottomAlign_1l8q0_39{border-top-width:1px;bottom:0;transform:translateY(100%)}._drawer--isOpen_1l8q0_45{transform:translate(0)}._drawer--isOpen_1l8q0_45._drawer--shouldAnimate_1l8q0_11{transition-timing-function:var(--easing__enter)}"));const sd="_drawer_1l8q0_1",ld="_drawer--shouldAnimate_1l8q0_11",cd="_drawer--horizontal_1l8q0_15",dd="_drawer--vertical_1l8q0_21",ud="_drawer--leftAlign_1l8q0_27",pd="_drawer--rightAlign_1l8q0_33",vd="_drawer--bottomAlign_1l8q0_39",gd="_drawer--isOpen_1l8q0_45",_d=e=>{var{alignment:t,isOpen:a,className:o,children:s,onWillOpen:l,onDidOpen:c,onWillClose:d,onDidClose:u}=e,p=i.__rest(e,["alignment","isOpen","className","children","onWillOpen","onDidOpen","onWillClose","onDidClose"]);const{add:v,update:g,remove:_,shouldOpen:f}=r.react.exports.useContext(Jc),[w,m]=r.react.exports.useState(f===a),[y,b]=r.react.exports.useState(0);r.react.exports.useEffect((()=>{w||f!==a||m(!0)}),[w,f,a]);const h=r.react.exports.useRef(null);return r.react.exports.useEffect((()=>{g({isOpen:a,alignment:t,dimension:y}),h.current&&b("bottom"===t?h.current.clientHeight:h.current.clientWidth)}),[g,t,y,a]),r.react.exports.useEffect((()=>{if(a!==f)return;let e=l,t=c;f&&(e=d,t=u),e&&e(),setTimeout((()=>{t&&t()}),333)}),[a,f,d,l,u,c]),r.react.exports.useEffect((()=>(v(),()=>{_()})),[v,_]),r.React$1.createElement("div",Object.assign({className:n.classnames(sd,o,{[cd]:"left"===t||"right"===t,[dd]:"bottom"===t,[gd]:f,[ld]:w,[ud]:"left"===t,[pd]:"right"===t,[vd]:"bottom"===t})},p,{ref:h}),s)};_d.displayName="InlineDrawer",_d.displayName="InlineDrawer";const fd=Object.assign(_d,{Wrapper:od});n.injectInternalStyle("typescript/libraries/file-viewer/src/drawer_wrapper.module.out.css",(e=>"._drawer-wrapper_l6zsn_1{flex:1;min-width:0}._inline-drawer_l6zsn_6{box-sizing:border-box;width:329px}"));const wd="_drawer-wrapper_l6zsn_1",md="_inline-drawer_l6zsn_6";function yd(e){const t=r.react.exports.useRef();return r.react.exports.useEffect((()=>{t.current=e}),[e]),t.current}const bd=({leftSidebarContent:e,rightSidebarContent:t,shouldShowSidebars:i,children:n})=>{const a=yd(e),o=yd(t);return r.React$1.createElement(fd.Wrapper,{drawer:r.React$1.createElement(fd,{alignment:"left",isOpen:i&&!!e,className:md},null!=e?e:a),className:wd},r.React$1.createElement(fd.Wrapper,{drawer:r.React$1.createElement(fd,{alignment:"right",isOpen:i&&!!t,className:md},null!=t?t:o)},n))};bd.displayName="DrawerWrapper";const hd=(e,t,i,r)=>{const n=r&&xo(e,t);if(!n)return{activeOverlayEditPlugin:void 0,activeFullscreenEditPlugin:void 0,activeRightRailPlugin:void 0,activeCommentPlugin:void 0,editPluginActivationParams:void 0,rightRailPluginActivationParams:void 0,activeLeftSidebarPlugin:void 0,activeRightSidebarPlugin:void 0,activeLeftSidebarPluginId:void 0,activeRightSidebarPluginId:void 0};const{activeEditPluginId:a,activeRightRailPluginId:o,editPluginActivationParams:s,rightRailPluginActivationParams:l,sidebarPlugins:c}=n,d=o?(u=null==r?void 0:r[o])&&oe(u)?u:void 0:void 0;var u;const p=se(i?null==r?void 0:r.comments:d),v=a?function(e){return e&&function(e){return!!e&&"editUI"in e}(e)?e:void 0}(null==r?void 0:r[a]):void 0,g=a?function(e){return e&&ce(e)?e:void 0}(null==r?void 0:r[a]):void 0,_=null==c?void 0:c.left,f=null==c?void 0:c.right;return{activeOverlayEditPlugin:v,activeFullscreenEditPlugin:g,activeRightRailPlugin:d,activeCommentPlugin:p,editPluginActivationParams:s,rightRailPluginActivationParams:l,activeLeftSidebarPlugin:_?ue(null==r?void 0:r[_]):void 0,activeRightSidebarPlugin:f?ue(null==r?void 0:r[f]):void 0,activeLeftSidebarPluginId:_,activeRightSidebarPluginId:f}},xd=r.react.exports.memo((e=>{const{id:t,previewKey:i,isDeleteEnabled:a,isFileFlippingEnabled:o,isPreviewZoomed:s,enableFullscreen:c,dispatch:d,fileIndex:u,collectionFileCount:p}=e,v=No(Da,t),g=No(Po,t),_=c&&!g?uc({callback:()=>d(ze({previewKey:i,fileViewerId:t,sourceContext:l.UserActionContext.Keyboard})),key:"f"}):null,f=uc({key:n.Key_enum.Key.Escape,callback:()=>{d(Qe({previewKey:i,fileViewerId:t,sourceContext:l.UserActionContext.Keyboard}))}}),w=i&&function(e){const t=uc({key:n.Key_enum.Key.Delete,callback:()=>{e(n.Key_enum.Key.Delete)}}),i=uc({key:n.Key_enum.Key.Backspace,callback:()=>{e(n.Key_enum.Key.Backspace)}});return wo?[t,i]:[t]}((e=>{d({payload:{previewKey:i,fileViewerId:t,sourceContext:l.UserActionContext.Keyboard,key:e===n.Key_enum.Key.Delete?"delete":"backspace"},type:Oe.Delete})})),m=[...oc(y={dispatch:d,previewKey:i,fileViewerId:t,requireCommandKey:s,fileIndex:u,collectionFileCount:p}),...ac(y)];var y;const b=[];return _&&b.push(_),o&&!v&&(b.push(...m),b.push(f)),a&&!v&&w&&b.push(...w),r.react.exports.createElement(gc,{name:"app",keyboardBindings:b})}));xd.displayName="AppKeyboardBindings";const Pd=e=>{var t,i,a,o,s,c;const{activeRightRailPlugin:u,activeCommentPlugin:p,activeOverlayEditPlugin:v,activeFullscreenEditPlugin:g,editPluginActivationParams:_,rightRailPluginActivationParams:f,activeLeftSidebarPlugin:w,activeRightSidebarPlugin:m,activeLeftSidebarPluginId:y,activeRightSidebarPluginId:b,config:h,dispatch:x,fileInfo:P,fileMetadata:E,fileConfig:S,id:I,previewType:O,shouldShowRightRail:T,shouldShowTitlebar:F,pluginProps:C,rightRailPluginInstances:R,pluginNavigation:j,archiveFiles:k,fullFilePreviewUi:V,fullRivieraData:D,isFullScreen:A,isPreviewZoomed:M,pluginInstances:N,onMount:L,onDestroy:U,callbacks:K,enabledEditPluginFullscreenActionDefinitions:z,components:$,isEditingVideo:B,defaultRightRailPlugin:W}=e,H=No(Ca,I),G=!!n.useSelector((e=>Eo(e,I))),Z=r.react.exports.useCallback((()=>x(st({isPreviewLoading:!1,fileViewerId:I}))),[x,I]),X=((e,t,i=[])=>{const n=r.react.exports.useRef(null),a=()=>{n.current&&(window.clearTimeout(n.current),n.current=null)};return r.react.exports.useEffect((()=>a),[...i,t]),()=>{a(),n.current=window.setTimeout(e,t)}})((()=>{x(Hr({event:l.EventType.UserEngaged3SecondsAfterRenderSucceeded,fileViewerId:I}))}),3e3,[I,H]),Q=As((()=>{H&&(x(Wr({event:l.SessionEventType.FilePreviewRenderSucceeded,fileViewerId:I,previewSessionId:H})),X()),Z(),(null==K?void 0:K.onRenderSucceeded)&&K.onRenderSucceeded()})),Y=As((()=>{H&&x(Wr({event:l.SessionEventType.FilePreviewRenderFailed,fileViewerId:I,previewSessionId:H})),Z()})),{onLogTTI:J}=ic(I,O);d.useMarkTimingEventOnMount(d.PreviewsTimingEvents.FVSDK_APP_MOUNT),r.react.exports.useEffect((()=>{L&&L();const e=document.getSelection();return e&&e.removeAllRanges(),()=>{U&&U()}}),[U,L]);const ee=Bl(),te=r.react.exports.useCallback((()=>{j.setActiveEditPlugin(q,l.UserActionContext.PostDownloadEditModal)}),[j]);r.react.exports.useEffect((()=>{const e=()=>{"#edit"===window.location.hash&&te()};return window.addEventListener("hashchange",e,!1),()=>{window.removeEventListener("hashchange",e)}}),[te]);const ie=A||B,ne=h.mobile_web,ae=null!==(t=null==E?void 0:E.file_name)&&void 0!==t?t:"",oe=h.transparent_background,se=h.preview_content_only,{toolbarPlugins:ce,actionDefinitions:ue,snackbarManagerPluginInstance:pe}=r.react.exports.useMemo((()=>{const e=N&&Object.values(N),t=e&&function(e){return e.filter((e=>"toolbarUI"in e)).reduce(ye,{})}(e),i=e&&function(e){return e.find(de)}(e),r=e&&function(e){return e.filter((e=>le(e))).map((e=>e.actionDefinitions()))}(e),n=r&&function(e,t){const i=e.reduce(me,{}),r=e.reduce(((e,t)=>((e,t)=>{var i,r;const n=e;let a;for(a in t){const o=null!==(i=e[a])&&void 0!==i?i:[],s=null!==(r=t[a])&&void 0!==r?r:[];n[a]=[...o,...s]}return n})(e,t.categories||{})),{});return Ee(r,t,i)}(r,z);return{toolbarPlugins:t,snackbarManagerPluginInstance:i,actionDefinitions:n}}),[null==P?void 0:P.previewKey,N,z]);Qc(I,v,_),Qc(I,u,f),Qc(I,g,_),Qc(I,w,_),Qc(I,u,_);const ve=null!==(i=null==$?void 0:$.activationHub)&&void 0!==i?i:null,{titleBarActionSetters:ge,titleBarActionGetters:_e}=function(){const e=n.useDispatch(),{fileViewerId:t}=re(),i=r.react.exports.useCallback((()=>{e(Je({sourceContext:l.UserActionContext.TitleBarMain,fileViewerId:t,pluginId:void 0}))}),[e,t]),a=n.useSelector((e=>Po(e,t))),[o,s]=r.react.exports.useState(!1),[c,d]=r.react.exports.useState(!1),[u,p]=r.react.exports.useState(),[v,g]=r.react.exports.useState(),[_,f]=r.react.exports.useState((()=>i)),w=r.react.exports.useCallback((()=>{s(!1),d(!1),p(void 0),g(void 0),f((()=>i))}),[i]);return r.react.exports.useEffect((()=>{a||w()}),[a,w]),{titleBarActionSetters:{setIsEditorReady:s,setHasEditorChanges:d,setOnCancel:f,setOnSaveReplace:p,setOnSaveCopy:g},titleBarActionGetters:{isEditorReady:o,hasEditorChanges:c,onCancel:_,onSaveReplace:u,onSaveCopy:v}}}(),fe=null==$?void 0:$.previewOverlay,we=null!==(a=null==$?void 0:$.banner)&&void 0!==a?a:null,be=_e.isEditorReady||null==$?void 0:$.toolbar;if(g){if(C){const e=g.fullscreenLayer;return r.react.exports.createElement("div",{className:"_editPluginFullscreenContainer_8zxup_41"},r.react.exports.createElement(e,Object.assign({},C,{titleBarActionSetters:ge})))}return null}const he=null===(o=null==$?void 0:$.titlebar)||void 0===o?void 0:o.component,xe=F&&(ne?null==$?void 0:$.mobileHeader:he&&r.react.exports.createElement(he,Object.assign({actions:ue},null==$?void 0:$.titlebar,{titleBarActionGetters:_e}))),Pe=null===(s=null==v?void 0:v.editUI)||void 0===s?void 0:s.Sidebar;let Se,Ie,Oe;const Te=null===(c=null==$?void 0:$.sidebarContent)||void 0===c?void 0:c.component,Fe=!v;return T&&(Se=Pe?r.react.exports.createElement(Hl,{fileViewerId:I,pluginNavigation:j,Sidebar:Pe}):Te?void 0:r.react.exports.createElement(Fs,{fileName:ae,fileViewerId:I,pluginInstances:R,pluginNavigation:j,defaultRightRailPlugin:W}),Te&&C&&(Ie=y&&w&&r.react.exports.createElement(Te,{sidebarPluginId:y,sidebarPlugin:w,navigation:j,pluginProps:C}),Oe=b&&m&&r.react.exports.createElement(Te,{sidebarPluginId:b,sidebarPlugin:m,navigation:j,pluginProps:C}))),r.react.exports.createElement("div",{className:"_file-viewer-area_8zxup_50"},r.react.exports.createElement("div",{style:A?{display:"none"}:{}},xe),r.react.exports.createElement("div",{className:"_renderer-row_8zxup_57"},r.react.exports.createElement(bd,{leftSidebarContent:Ie,rightSidebarContent:Oe,shouldShowSidebars:Fe},r.react.exports.createElement("div",{className:"_center-section_8zxup_69"},be?r.react.exports.createElement(be,null):void 0,!A&&we,r.react.exports.createElement(vs,{className:n.classnames("_containerV2_8zxup_26",{_transparentBackground_8zxup_46:oe})},(({width:e,height:t})=>{var i,n;const a={fileViewerId:I,width:e,height:t,onRenderSucceeded:Q,onRenderFailed:Y,onInteractive:J,config:h,activeRightRailPlugin:u,activeCommentPlugin:p,activeOverlayEditPlugin:v,pluginProps:C,fileConfig:S,responsiveSize:ee,header:null==$?void 0:$.header,fileSaver:null==$?void 0:$.fileSaver,onSetPreviewLoaded:Z,titleBarActionSetters:ge,pluginActivationParams:_},o=(()=>{switch(null==P?void 0:P.bootstrap.state){default:return null;case"ready":return r.react.exports.createElement(gs,Object.assign({},a,{previewKey:P.previewKey}));case"errored":return r.react.exports.createElement(Zc,Object.assign({error:P.bootstrap.error},a,{previewKey:P.previewKey}))}})();return r.react.exports.createElement(Il,{value:{rendererWidth:e,rendererHeight:t}},r.react.exports.createElement(Wl,{width:e,activeCommentPlugin:p,plugins:ce,snackbarManagerPluginInstance:pe,archiveFiles:k,fullFilePreviewUi:V,fullRivieraData:D,fileConfig:S,activeEditOverlayPlugin:v},r.react.exports.createElement(ql,{previewKey:null==P?void 0:P.previewKey},o)),r.react.exports.createElement(xd,{id:I,previewKey:null==P?void 0:P.previewKey,enableFullscreen:h.enable_fullscreen,isDeleteEnabled:!v&&!G,isFileFlippingEnabled:null!=E&&!!E.file_collection_context&&!v&&!G,isPreviewZoomed:M,dispatch:x,fileIndex:(null===(i=null==E?void 0:E.file_collection_context)||void 0===i?void 0:i.file_index)||0,collectionFileCount:(null===(n=null==E?void 0:E.file_collection_context)||void 0===n?void 0:n.parent_files_count)||0}),null!=fe?fe:null)})))),ve,r.react.exports.createElement("div",{style:ie?{display:"none"}:{}},Se)),r.react.exports.createElement("div",{className:"_footer-row_8zxup_65",style:A?{display:"none"}:{}},!se&&ne?null==$?void 0:$.mobileFooter:null))};Pd.displayName="App";const Ed=n.connect((function(e,t){const{config:i,id:r,pluginNavigation:n}=t,a=la(e,r),o=null==a?void 0:a.previewKey,s=va(e,o),l=Ps(e,r,bo(e,{fileViewerId:r,navigation:n})),{activeRightRailPlugin:c,activeCommentPlugin:d,activeFullscreenEditPlugin:p,activeOverlayEditPlugin:v,editPluginActivationParams:g,rightRailPluginActivationParams:_,activeLeftSidebarPlugin:f,activeRightSidebarPlugin:w,activeLeftSidebarPluginId:m,activeRightSidebarPluginId:y}=hd(e,r,u.isRedesign2023Enabled(i),t.pluginInstances),b=Ia(e,r),h=ja(e,r),x=!i.preview_content_only&&!i.mobile_web,P=i.show_titlebar&&(!v||!!(null==v?void 0:v.allowTitleBar))&&!i.preview_content_only,E=t.pluginInstances?Yl(t.pluginInstances,r):[];return{activeRightRailPlugin:c,activeCommentPlugin:d,activeFullscreenEditPlugin:p,activeOverlayEditPlugin:v,editPluginActivationParams:g,rightRailPluginActivationParams:_,activeLeftSidebarPlugin:f,activeRightSidebarPlugin:w,activeLeftSidebarPluginId:m,activeRightSidebarPluginId:y,fileViewerUiData:e.fileViewerUi[r],fileInfo:a,fileMetadata:wa(e,o),isPreviewZoomed:Ea(e,r),pluginProps:l,previewType:s,shouldShowRightRail:x,shouldShowTitlebar:P,archiveFiles:e.archiveFiles,fullFilePreviewUi:e.filePreviewUi[r]||{},fullRivieraData:e.rivieraData||{},isFullScreen:b,enabledEditPluginFullscreenActionDefinitions:E,isEditingVideo:h}}),(function(e){return{dispatch:e}}))(Pd),Sd=e=>{const{store:t,intl:a,batteries:o,platformConfig:s,pluginContext:l,isLoggedIn:c}=e,d=i.__rest(e,["store","intl","batteries","platformConfig","pluginContext","isLoggedIn"]),{id:u,config:p,canCloseViewer:v,pluginNavigation:g}=e,_=r.react.exports.useMemo((()=>({batteries:o,fileViewerId:u,featureConfig:p,platformConfig:s,pluginContext:l,canCloseViewer:v,pluginNavigation:g,isLoggedIn:c})),[o,u,p,s,l,v,g,c]);return r.react.exports.createElement(n.Provider,{store:t},r.react.exports.createElement(y.Provider,{value:a},r.react.exports.createElement(ne,{value:_},r.react.exports.createElement(Bs,null,r.react.exports.createElement(hc,{disableBindings:!p.keyboard_shortcuts||p.preview_content_only,osModifierKey:s.osModifierKey},r.react.exports.createElement(n.LayerContext.Provider,{value:{zIndex:501}},r.react.exports.createElement(Ed,Object.assign({intl:a},d))))))))};Sd.displayName="AppWithProvider";n.injectInternalStyle("typescript/libraries/file-viewer/src/file_viewer/components.module.out.css",(e=>"._fvsdk-mount-point_5pmvv_1{flex:1;overflow:hidden}"));const Id=e=>{na.fetchDocImage({imageUrlTmpl:e}).catch()},Od=r.react.exports.createContext(null),Td=e=>{const{initData:t,featureConfig:i,children:n}=e,a=null==t?void 0:t.accountId,o=r.react.exports.useMemo((()=>Do(e)),[i,a]);return r.react.exports.createElement(Od.Provider,{value:o},n)};Td.displayName="FileViewerSDKContextProvider";const Fd=e=>{const{initializeOpts:t,className:a,id:o,viewport:s,components:l}=e,c=r.react.exports.useContext(Od);if(!c)throw new Error("File Viewer SDK Context must be provided");var d;d=null==t?void 0:t.previewMetadata,r.React$1.useMemo((()=>{var e;"ssr_doc"===(null===(e=null==d?void 0:d.content)||void 0===e?void 0:e[".tag"])&&Id(d.content.image_url_tmpl)}),[d]);const u=r.react.exports.useMemo((()=>c.createFileViewer()),[c]);r.react.exports.useEffect((()=>()=>{u.cleanup()}),[u]);const[p,v]=r.react.exports.useState(),g=r.react.exports.useRef(null),_=r.react.exports.useMemo((()=>u.getStaticProps(t)),[t]);return r.react.exports.useEffect((()=>{i.__awaiter(void 0,void 0,void 0,(function*(){yield u.initialize(t),v(u.getAppProps())}))}),[t]),r.react.exports.createElement("div",{className:n.classnames(a||"_fvsdk-mount-point_5pmvv_1"),id:o||"fvsdk-mount-point",ref:g},r.react.exports.createElement(Sd,Object.assign({},_,p,{components:l,viewport:s})))};Fd.displayName="FileViewerInstance",Fd.displayName="FileViewerInstance";const Cd=e=>{const{initializeOpts:t,className:n,id:a,viewport:o,components:s}=e,l=i.__rest(e,["initializeOpts","className","id","viewport","components"]),c={initializeOpts:t,className:n,id:a,viewport:o,components:s};return r.react.exports.createElement(Td,Object.assign({},l),r.react.exports.createElement(Fd,Object.assign({},c)))};Cd.displayName="FileViewer",Cd.displayName="FileViewer";var Rd=Object.freeze({__proto__:null,FileViewerSDKContext:Od,FileViewerSDKContextProvider:Td,FileViewerInstance:Fd,FileViewer:Cd});t.ArchiveFileBreadcrumbs=Tl,t.COMMENTS_PLUGIN_ID=Z,t.DEFAULT_CONFIG=V,t.DEFAULT_EXCEL_SCALE_FACTOR=.5,t.DEFAULT_FILE_CONFIG=D,t.DEFAULT_SUPPORTED_PREVIEW_TYPES=ae,t.DOC_LI_MARGIN=16,t.DOC_PAGE_MARGIN=gl,t.DOC_PAGE_MARGIN_LEFT=wl,t.DOC_SIDEBAR_WIDTH=ml,t.FILE_ACTIVITY_PLUGIN_ID="file_activity",t.FVError=zr,t.FileViewer=Cd,t.FileViewerInstance=Fd,t.FileViewerSDKContextProvider=Td,t.FullScreenButton=Qs,t.IMAGE_PADDING=ve,t.INFO_BLADE_PLUGIN_ID=H,t.KeyboardBindingConnector=gc,t.OverlayTransition=Is,t.PDF_BASE_WIDTH=1024,t.PDF_EDITOR_PLUGIN_ID=q,t.PluginHeader=Oc,t.PreviewControlWrapper=Ws,t.PreviewRenderError=qc,t.PreviewRenderer=gs,t.SlideTransition=Os,t.TEXT_FIRST_BATCH_SIZE=10,t.TRANSCRIPT_BLADE_PLUGIN_ID=G,t.ToolbarButton=Gs,t.VIDEO_EDITING_SIZE_LIMIT=536870912,t.activationHubM1FileTypes=["pdf","ppt","pptx","doc","docx"],t.app="_app_bn661_5",t.archiveSubpathQueryParam=ro,t.border="4px",t.calcContentHeight=function(e,t){return e-(t?64:0)},t.calcContentWidth=function(e,t,i=!0,r=!1){return!i||r||e<=833?e:e-(t?329:57)},t.calculateDocumentScaleFactor=Pl,t.calculateFitBox=function(e,t,i){const r=e/t;return isNaN(i)||isNaN(r)||!isFinite(r)||!isFinite(i)?[0,0]:r>i?[t*i,t]:[e,e/i]},t.calculateImageSizerDimensions=ge,t.calculatePageRange=sa,t.canPreviewInPreviewDoc=function(e){return!!e&&[o.PreviewType.CloudDoc,o.PreviewType.SsrDoc].includes(null==e?void 0:e.previewType)},t.cancelEditingVideo=function(e){return{type:Oe.CancelEditingVideo,payload:e}},t.clearVideoRequests=function(){return{type:Oe.ClearVideoRequests,payload:{}}},t.clickDropboxLogo=function(e){return{type:Oe.ClickDropboxLogo,payload:e}},t.close="_close_1titd_176",t.close$1="_close_5e2zk_11",t.closeDocSidebar=Ue,t.closeViewer=Qe,t.components_esnext=Rd,t.container=ll,t.container$1="_container_1titd_144",t.containerBorder=dl,t.css=vl,t.emptyFolder="_emptyFolder_1xop8_1",t.enterFullScreen=ze,t.excelSheetRenderFailed=function(e){return{payload:e,type:Oe.ExcelSheetRenderFailed}},t.excelSheetRenderSucceeded=function(e){return{payload:e,type:Oe.ExcelSheetRenderSucceeded}},t.exitFullScreen=$e,t.fetchPageDataWithMetadata=Re,t.filterAudioVideoFilePreviewUiState=cn,t.filterAudioVideoRivieraData=nn,t.filterDocFilePreviewUiState=ln,t.filterDocPreviewRivieraData=rn,t.filterExcelPreviewUiState=function(e){return e&&"currentTabIndex"in e?e:void 0},t.filterZoomableFilePreviewUi=dn,t.findInDocHighlightPrimary="var(--color__accent__lime)",t.findInDocHighlightSecondary="var(--color__accent__banana)",t.findInDocTriggered=()=>{B(t.TooltipTourUpdateType.Increment,t.GuidedTours.Search,0),W(t.GuidedTours.Search,1,3)},t.floatingHeader="_floatingHeader_1uudo_10",t.focused=pl,t.folderTable="_folderTable_1xop8_9",t.getArchiveEntryAtPath=function(e,t){const i=e[Jr(t)],r=t.length>0?t.slice(0,t.length-1):void 0;return{entry:i,parent:r&&e[Jr(r)]}},t.getArchiveFilesAction=yt,t.getArchiveFilesFetchedPreviewMetadata=function(e,t){return!!e[t]},t.getArchiveFilesPreviewMetadata=ga,t.getBrandingInfo=function(e,t){const i=ua(e,t);return i&&e.brandingInfo[i.serialized]},t.getBrowserFindBinding=function(e){return{keyboardEventCriteria:{key:"f",osModifierKey:!0},callback:e}},t.getClosestSubpath=(e,t)=>{for(let i=t.length;i>=0;i--){const r=t.slice(0,i);if(e[Jr(r)])return r}return[]},t.getCloudDocEditorUrl=function(e,t){return e.cloudDocsData[t]},t.getCloudDocExitUrl=Ie,t.getCloudEditorUrlAction=Vr,t.getCurrentFilePreviewUI=ba,t.getCurrentPreviewData=function(e,t){return pa(e,ca(e,t))},t.getCurrentPreviewKey=ca,t.getEscapeBinding=function(e){return{keyboardEventCriteria:{key:n.Key_enum.Key.Escape},callback:nc(e)}},t.getFileContentMetadata=Ta,t.getFileExtension=h,t.getFileMetadata=wa,t.getFilePreviewSession=Ra,t.getFilePreviewSessionId=Ca,t.getFilePreviewUi=ya,t.getFilePreviewUiData=function(e,t,i){var r;return i&&(null===(r=e.filePreviewUi[t])||void 0===r?void 0:r[i.serialized])},t.getFileViewerUi=xa,t.getFilenameFromPath=function(e){return e.split("/").pop()},t.getFindInDocBinding=function(e){return{keyboardEventCriteria:{key:"f",osModifierKey:!0},callback:nc(e)}},t.getHomeEndBindings=function({home:e,end:t}){return[(i=e,{keyboardEventCriteria:{key:n.Key_enum.Key.Home},callback:nc(i)}),dc(t)];var i},t.getImageSizeScale=_e,t.getIsEditingVideo=ja,t.getIsPreviewLoading=Va,t.getIsTranscriptNonempty=e=>{var t;return"loaded"===(null==e?void 0:e.state)&&!!(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.segments)&&e.data.segments.length>0},t.getKeyboardBinding=uc,t.getPageUpDownBindings=function({pageUp:e,pageDown:t}){return[(i=e,{keyboardEventCriteria:{key:n.Key_enum.Key.PageUp},callback:nc(i)}),sc(t)];var i},t.getParentFolderFromPath=function(e){if(!e)return null;const t=e.split("/");return t.length<2?null:t[t.length-2]},t.getPluginsState=xo,t.getPreviewKeyForNestedArchiveFile=Yr,t.getPreviewMetadata=pa,t.getPreviewType=va,t.getRivieraData=_a,t.getRootFile=la,t.getScaleFactorFromFilePreviewUi=Pa,t.getSharedLinkInfo=ka,t.getSubpath=Jr,t.getToolbarConfigByPreviewType=Vs,t.getToolbarConfigForEditMode=ks,t.getTranscriptPermission=Aa,t.getUpDownBindings=function({up:e,down:t}){return[(i=e,{keyboardEventCriteria:{key:n.Key_enum.Key.ArrowUp},callback:nc(i)}),lc(t)];var i},t.getVideoDimensions=function(e,t){const i=Ta(e,t);if(i&&"video"==i.metadata[".tag"]){const e=i.metadata;if(e.resolution_height&&e.resolution_width)return{width:e.resolution_width,height:e.resolution_height}}return null},t.getVideoRequests=function(e){return e.videoRequests},t.getVolumeState=function(e){return e.volume},t.getWhitelistedFileExtension=ee,t.getXlsImgUrl=function(e,t,i){const r=new URL(e,"https://www.dropbox.com");if("/previews_asset/"===r.pathname){return(r.pathname+r.search).replace(/SHEET_PLACEHOLDER/,t.toString()).replace(/TILE_PLACEHOLDER/,i.toString())}return r.searchParams.set("sheet",t.toString()),r.searchParams.set("tile",i.toString()),r.toString()},t.getZoomInOutBindings=function({zoomIn:e,zoomOut:t}){return[...(i=e,[{keyboardEventCriteria:{key:"=",osModifierKey:!0},callback:nc(i)},{keyboardEventCriteria:{key:"+",osModifierKey:!0},callback:nc(i)}]),...cc(t)];var i},t.headerContainer=xc,t.helpCenterEmitter=$,t.imgLayer="_imgLayer_1titd_63",t.initialState={drawers:[],engagements:[],experimentVariant:"OFF",hubEntryPoint:null,isTooltipTourActive:!1,tooltipTourActiveStep:0,fileExtension:""},t.initializeFilePreviewSession=Ne,t.initializeNestedArchiveFilePreview=function(e){return{type:Oe.InitializeNestedArchiveFilePreview,payload:e}},t.internalLink="_internalLink_1titd_52",t.invariant=$r,t.isActionBarPlugin=le,t.isEditMode=ul,t.isExcelApiV2MetadataContent=sn,t.isExcelPreviewRivieraData=en,t.isFullScreen=Cs,t.isKeyboardEvent=rc,t.isNestedArchiveFilePreviewKey=Xr,t.isPluginEditMode=Po,t.isPpt=hl,t.isTranscriptAvailable=La,t.is_mobile_or_tablet=fo,t.linksLayer="_linksLayer_1titd_42",t.logBackgroundEvent=function(e){return{type:Kr.LogBackgroundEvent,payload:e}},t.logPreviewEvent=Hr,t.logSessionEvent=Wr,t.logUserActionEvent=Gr,t.logVideoEvent=function(e){return{type:Kr.LogVideoEvent,payload:e}},t.logVideoEventDuration=function(e){return{type:Kr.LogVideoEventDuration,payload:e}},t.logVideoEventQuantity=function(e){return{type:Kr.LogVideoEventQuantity,payload:e}},t.loggedOutGetArchiveFilesAction=St,t.mac=wo,t.makePendingLoadableData=vn,t.mapMetadataToFile=function(e,t=!1){if(e)return{uniqueKey:e.file_id,title:e.file_name,isFolder:t,extension:h(e.file_name).replace(/\./,"")}},t.maybePreloadFile=Se,t.maybePreloadFiles=function(e,t,i){const r=[];if(0===e.length)return Promise.all(r);const n=[];return[1,2,3,4,5,6,-1,-2].forEach((function(i){const r=(t+i+e.length)%e.length;-1===n.indexOf(r)&&n.push(r)})),n.forEach((function(t){if(e.length>t&&t>0){const n=e[t];n&&r.push(Se(n,i))}})),Promise.all(r)},t.noToolbarShown=Ds,t.open=cl,t.openDocSidebar=Le,t.openUrl=He,t.overrideFloatingToolbar=rt,t.page="_page_1titd_100",t.pageNavigation=Ve,t.pdfViewport="_pdfViewport_1titd_104",t.pptFullSizer="_pptFullSizer_1titd_134",t.pptSizer="_pptSizer_1titd_128",t.pptViewport="_pptViewport_1titd_110",t.preloadImage=pe,t.print=Ke,t.redirect=function(e){return{payload:e,type:Oe.Redirect}},t.refreshBlobAction=function(e){return{payload:e,type:Oe.RefreshBlob}},t.removeFragmentFromURL=e=>{const t=window.location.href.replace(e,"");window.history.replaceState(null,"",t)},t.renameFile=Te,t.reportException=ot,t.resolvePageNavigation=function(e){return{type:Oe.ResolvePageNavigation,payload:e}},t.resolvePreviewType=te,t.resolvePreviewTypeFromExtension=J,t.resolveToolbarPreviewType=zl,t.rivieraClient=na,t.safari=po,t.selectDrawer=(e,i)=>{$.dispatch(t.HCEvents.SELECT_DRAWER,{drawer:e,source:i})},t.setActiveEditPlugin=Je,t.setArchiveFiles=function(e){return{type:Oe.SetArchiveFiles,payload:e}},t.setHubEntryPoint=e=>{$.dispatch(t.HCEvents.SET_ENTRY_POINT,{entryPoint:e})},t.setIsClosedCaptionShowing=function(e){return{type:Oe.SetIsClosedCaptionShowing,payload:e}},t.setIsDefaultAudioTrackSelected=function(e){return{payload:e,type:Oe.SetIsDefaultAudioTrackSelected}},t.setMuted=at,t.setVolume=nt,t.setupGetPlayDurationSeconds=function(e){return{type:Oe.SetupGetPlayDurationSeconds,payload:e}},t.shallowEqual=function(e,t){if(aa(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let r=0;r<i.length;r++)if(!Object.prototype.hasOwnProperty.call(t,i[r])||!aa(e[i[r]],t[i[r]]))return!1;return!0},t.shouldEnableClosedCaptionsButton=(e,t)=>{var i,r;return!!e&&(!!t&&(!Na(t)&&("loaded"!==t.state||0!==(null===(r=null===(i=t.data)||void 0===i?void 0:i.segments)||void 0===r?void 0:r.length))))},t.shouldGenerateTranscript=Ma,t.shouldShowDocSidebar=xl,t.shouldShowTranscriptUi=function(e,t){var i,r;return!!t&&(!!("loaded"===(null==e?void 0:e.state)&&(null==e?void 0:e.data)&&(null===(r=null===(i=e.data)||void 0===i?void 0:i.segments)||void 0===r?void 0:r.length)>0)||!("ineligible"===t[".tag"]&&!e))},t.sidebarWidth=sl,t.snackbar="_snackbar_5e2zk_34",t.switchWorkbookTab=function(e){return{type:Oe.SwitchWorkbookTab,payload:e}},t.textLayer="_textLayer_1titd_22",t.textbox="_textbox_1titd_17",t.thumbnailWidth=ol,t.triggerDynamicRoutingModalCheck=function(){return{type:Oe.TriggerDynamicRoutingModalCheck,payload:{}}},t.updateArchiveFileCurrentPath=it,t.updateAudioVideoPlaybackState=function(e){return{payload:e,type:Oe.UpdateAudioVideoPlaybackState}},t.updateDimensions=function(e){return{type:Oe.UpdateDimensions,payload:e}},t.updateDocCurrentPageIndex=ke,t.updateFitScaleFactor=function(e){return{type:Oe.UpdateFitScaleFactor,payload:e}},t.updateTooltipTourStep=B,t.useFileMetadata=Mo,t.useFileViewerContext=re,t.useFileViewerSelector=No,t.useMountTransition=()=>{const[e,t]=r.React$1.useState(!1),[i,n]=r.React$1.useState(!1);return r.React$1.useEffect((()=>{e?n(!0):(t(!0),n(!1))}),[e]),i},t.useOnce=e=>{const t=As(e);return r.react.exports.useMemo((()=>c.once(t)),[t])},t.useParameterizedSelector=Uo,t.usePreviewControls=Hs,t.usePreviewKeySelector=Lo,t.usePreviewState=Ko,t.useRecordPreviewsTimerOnMount=(e,t,i,a=!0)=>{const o=n.useSelector((t=>t.loggingSession[e])),{batteries:s}=re();r.React$1.useEffect((()=>{var e,r;const n=performance.getEntriesByName(t,"mark");if(n.length>0&&a){performance.clearMarks(t);const a=n[0],l=performance.now()-a.startTime;null===(r=null===(e=null==s?void 0:s.logger)||void 0===e?void 0:e.logDuration)||void 0===r||r.call(e,{eventName:t,durationInMs:l,session:o?za(o):void 0,tags:i})}else;}),[null==s?void 0:s.logger,a,o,i,t])},t.useResponsiveSize=Bl,t.useRootFileInfo=Ao,t.useRootPreviewKey=e=>{var t;return null===(t=No(la,e))||void 0===t?void 0:t.previewKey},t.useStabilizedCallback=As,t.useToolbarControlsConfig=Ns,t.useUponTranscriptGeneration=(e,i)=>{const n=r.react.exports.useRef(!1),a=!(e=>!(!e||"pending"===e.state||"errored"===(null==e?void 0:e.state)&&e.error.statusCode===t.RivieraStatus.NotFound))(e);a&&(n.current=!0),r.react.exports.useEffect((()=>{n.current&&La(e)&&(i(),n.current=!1)}),[i,e])},t.v4=Lr,t.writeTranscriptToClipboard=(e,t=!1)=>{if(!e||0===e.length)return;const i=c.flatten(e.map((({text:e,startTime:i})=>t?[i,e]:[e]))).join("\r\n");navigator.clipboard.writeText(i)},t.zoomIn=De,t.zoomOut=Ae}));
//# sourceMappingURL=c_src_file_viewer_components.js-vflALjRHM.map
