define(["exports","./c_tslib","./c_src_sink_index","./c_apex-metrics_src_types","./c_files_view_file_actions_file_from_metadata","./c_hive_schemas_web-modal-activity","./c_file_actions_portable_move","./c_ui_fileops_actions","./e_ui_page_files_router","./c_action_bar_file_actions_logging"],(function(e,t,o,i,a,n,r,c,s,l){"use strict";function _(e){return{class:"previews",action:"copy",object:"file",properties:e}}e.portableCopy=({currentFQPath:e,exceptions:d,filesPath:u,source:g,user:v,createNewFolderInMoveDialog:m,nsId:S,extraForLogging:p},I={})=>t.__awaiter(void 0,void 0,void 0,(function*(){if(d.isOverFreeQuota&&!d.hasExcludedNsIds)return void r.showOverquota("wb_oq_mv_cp",S,v.id,s.SHARE_ACTION_ORIGIN_TYPE.BROWSE_COPY_ACTION);const t=u.reduce(((e,t)=>e+(t.is_dir?0:1)),0),C=u.reduce(((e,t)=>e+(t.is_dir?1:0)),0),F=o.getMetricsReporter$1(),f={surface:g,batchSizeBucket:a.bucketForBatchSize(u.length),contentType:a.batchContentType(u)},L={totalLatency:F.createStats({ns:a.FILE_ACTIONS_AMP_NAMESPACE,name:"copy/batch/latency_total_ms"},f),averageLatency:F.createStats({ns:a.FILE_ACTIONS_AMP_NAMESPACE,name:"copy/batch/latency_average_ms"},f),completed:F.createStats({ns:a.FILE_ACTIONS_AMP_NAMESPACE,name:"copy/batch/completed"},f)};let E;const h=(e,t)=>{var o;if(E){const e=E.success(t);L.totalLatency.recordDuration(e,i.TimeUnit.MILLISECONDS),L.averageLatency.recordDuration(e/u.length,i.TimeUnit.MILLISECONDS),L.completed.record(1)}null===(o=I.onSuccess)||void 0===o||o.call(I,e)},y=e=>{var t;if(E){const t=E.failed(e);L.totalLatency.recordDuration(t,i.TimeUnit.MILLISECONDS),L.averageLatency.recordDuration(t/u.length,i.TimeUnit.MILLISECONDS),L.completed.record(0)}null===(t=I.onError)||void 0===t||t.call(I)},N=()=>{var e;return null===(e=I.onUndo)||void 0===e?void 0:e.call(I)};r.showMoveDialog({operation:s.Operation.COPY,modalName:n.ModalName.COPY,user:v,apiClient:{moveToFolder:(e,o,i)=>(E=l.startFileActionLogging(_,Object.assign({actionSurface:g,numFiles:t,numFolders:C},p)),c.copyFiles_v2({user:v,files:u,onSuccess:h,onUndo:N,onError:y,newPath:e,isLockedVaultFolder:i,actionId:E.actionId}),Promise.resolve()),getFolderContents:s.Viewer.get_viewer().is_team_assume_user_session?s.getFolderContents:s.getFolderContentsAPIv2,getFolderSuggestion:s.getFolderSuggestion},entries:u,initialFolderSelection:e,onSuccess:()=>{},onCancel:()=>{},showFolderSuggestion:!0,createNewFolderInMoveDialog:m})}))}));
//# sourceMappingURL=c_file_actions_portable_copy.js-vflxfxZKG.map
