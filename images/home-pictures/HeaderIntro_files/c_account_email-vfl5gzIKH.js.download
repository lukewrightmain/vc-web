define(["exports","./e_edison","./e_ui_page_files_router","./c_account_email_verify_reasons","./c_ui_modal_dig","./c_core_i18n","./c_core_notify","./c_ui_input_dig","./e_core_exception","./c_core_uri","./c_core_exception_info","./c_tslib","./c_lodash-es_lodash","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","metaserver/static/js/modules/constants/request","./c_browser_cookies","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","metaserver/static/js/modules/constants/page_load","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/core/langpack"],(function(e,t,s,a,i,r,o,n,l,m,c,d,u,h,g,f,p,_,v,y,E,M,R,w,b,k,C,$,D,x,S,V,I,N,A,T,L,P,F,O){"use strict";class U extends t.React$1.Component{constructor(e){super(e),this.state={sent:!1,submitting:!1}}resetResponseSuccess(e){"OK"===e.status?(o.Notify.success(r.intl.formatMessage({id:"SSwbgo",defaultMessage:"Sent an email to {email}"},{email:this.props.email})),this.setState({sent:!0,submitting:this.state.submitting})):this.resetEmailError()}resetEmailError(){o.Notify.error(r.intl.formatMessage({id:"fUWqZP",defaultMessage:"Could not send email. Please try again"}))}sendResetEmail(e){e.preventDefault(),this.setState({sent:this.state.sent,submitting:!0}),s.FormWebRequest({url:"/ajax_reset_start",data:{email:this.props.email},success:e=>this.resetResponseSuccess(JSON.parse(e)),error:()=>this.resetEmailError(),complete:()=>{this.setState({sent:this.state.sent,submitting:!1})}})}userConfirmSetPassword(){this.props.onUserConfirm?this.props.onUserConfirm():s.unmountModal()}static showInstance(e){s.mountModal(t.React$1.createElement(U,Object.assign({},e)))}render(){const e=r.intl.formatMessage({id:"W/iS2m",defaultMessage:"Dropbox will send an email to {email} with further instructions. You may need to check your spam folder or unblock no-reply@dropbox.com."},{email:this.props.email}),s=this.state.sent?r.intl.formatMessage({id:"Vep7Pr",defaultMessage:"Resend email"}):r.intl.formatMessage({id:"YZqQHq",defaultMessage:"Send email"}),a=r.intl.formatMessage({id:"WLFHmg",defaultMessage:"I’ve set a password"}),o=this.sendResetEmail.bind(this),n=this.userConfirmSetPassword.bind(this),l=t.React$1.createElement(i.ModalButtons,null,t.React$1.createElement(i.ModalButton,{variant:"primary",disabled:!this.state.sent,onClick:n},a),t.React$1.createElement(i.ModalButton,{variant:"opacity",onClick:o},s));return t.React$1.createElement(i.ModalWithCSS,{title:r.intl.formatMessage({id:"6EcMoR",defaultMessage:"Set Password"}),onAccept:()=>this.userConfirmSetPassword(),buttonComponent:l},t.React$1.createElement("p",null,this.props.reason),t.React$1.createElement("p",null,e))}}U.displayName="SetPasswordModal";const B=n.text,j=n.password,Y=[a.EmailVerificationReasons.ADD_COMMENT,a.EmailVerificationReasons.SUBSCRIBE_TO_COMMENTS,a.EmailVerificationReasons.SHARE_FILEVIEWER],W=s.styled.div`
  .change-email-input {
    width: 100%;
  }
`;class q extends t.React$1.Component{constructor(){super(...arguments),this.getSSOWarning=()=>{const{is_paired:e}=s.Viewer.get_viewer(),a=e&&"work"===this.props.user.role,i=this.props.user.sso_required;return a&&i?t.React$1.createElement("div",{className:"db-modal-message"},r.intl.formatMessage({id:"E+nkeD",defaultMessage:"Your {team} Dropbox uses single sign-on. If you change your email address you may not be able to sign in."},{team:s.Viewer.get_viewer().team_name})):null},this.getInboxWarning=()=>{const{is_paired:e}=s.Viewer.get_viewer();if(0===this.props.inboxCount)return null;let a=r.intl.formatMessage({id:"TwUPS4",defaultMessage:"{count, plural, one{Your {count} existing shared folder invitation will be removed if you change your email address.} other{Your {count} existing shared folder invitations will be removed if you change your email address.}}"},{count:this.props.inboxCount});return e&&"personal"===this.props.user.role?a=r.intl.formatMessage({id:"hImpHR",defaultMessage:"{count, plural, one{Your {count} existing shared folder invitation in your personal Dropbox will be removed if you change your email address.} other{Your {count} existing shared folder invitations in your personal Dropbox will be removed if you change your email address.}}"},{count:this.props.inboxCount}):e&&"work"===this.props.user.role&&r.intl.formatMessage({id:"LTnOTV",defaultMessage:"{count, plural, one{Your {count} existing shared folder invitation in your {team} Dropbox will be removed if you change your email address.} other{Your {count} existing shared folder invitations in your {team} Dropbox will be removed if you change your email address.}}"},{count:this.props.inboxCount,team:s.Viewer.get_viewer().team_name}),t.React$1.createElement("div",{className:"db-modal-message"},a)},this.showChange=e=>{var t,s;e.preventDefault();return this.refs.modal.close(),null===(s=(t=this.props).onContinue)||void 0===s?void 0:s.call(t)}}render(){return t.React$1.createElement(i.ModalWithCSS,{title:r.intl.formatMessage({id:"VUO2oS",defaultMessage:"Warning!"}),acceptButtonText:r.intl.formatMessage({id:"3654OT",defaultMessage:"Continue anyway"}),dismissButtonText:r.intl.formatMessage({id:"JKXEU8",defaultMessage:"Cancel"}),onAccept:this.showChange,ref:"modal",style:"default-maestro"},this.getSSOWarning(),this.getInboxWarning())}}q.displayName="ChangeEmailWarningModal";class H extends t.React$1.Component{constructor(){super(...arguments),this.displayName="ChangeEmailModal",this.mounted=!1,this.state={submitting:!1,errors:{},userConfirmedSetPassword:!1},this.formRef=t.React$1.createRef(),this.handleKey=e=>{e.key===s.Key_enum.Key.Enter&&"INPUT"===(null!=e.target?e.currentTarget.tagName:void 0)&&this.handleSubmit(e)},this.handleSubmit=e=>{if(e.preventDefault(),!this.state.submitting)return this.submit()},this.submit=()=>{this.setState({submitting:!0,errors:{}});const e=this.formRef.current;return s.submit(e,this._success,this._error,this._complete)},this._success=e=>{var t,a,i,r;const o=this.formRef.current,n=null!==(a=null===(t=null==o?void 0:o.querySelector('input[name="email"]'))||void 0===t?void 0:t.value)&&void 0!==a?a:"",l="NEEDS_VERIFICATION"===e;return s.unmountModal(),l?null===(i=this.props)||void 0===i?void 0:i.onVerificationCheck(n):null===(r=this.props)||void 0===r?void 0:r.onChange(n)},this._error=e=>"string"==typeof e?o.Notify.error(e):e?this.setState({errors:e}):o.Notify.error(r.intl.formatMessage({id:"A1ZtqA",defaultMessage:"There was a problem completing this request."})),this._complete=()=>{if(this.mounted)return this.setState({submitting:!1})},this.getPrompt=()=>{const{is_paired:e}=s.Viewer.get_viewer(),t=this.props.user.email_verified;return e&&"personal"===this.props.user.role?t?r.intl.formatMessage({id:"SSo9BY",defaultMessage:"Enter a new email address for your personal Dropbox. You’ll need to verify your new email address in order to finish updating your personal email."}):r.intl.formatMessage({id:"2v/Ulh",defaultMessage:"Enter a new email address for your personal Dropbox."}):e&&"work"===this.props.user.role?t?r.intl.formatMessage({id:"w72QA8",defaultMessage:"Enter a new email address for your {team} Dropbox. You’ll need to verify your new email address in order to finish updating your {team} email."},{team:s.Viewer.get_viewer().team_name}):r.intl.formatMessage({id:"DbvzPc",defaultMessage:"Enter a new email address for your personal Dropbox."}):t?r.intl.formatMessage({id:"BFwGQf",defaultMessage:"You’ll need to verify your new email address in order to finish updating your email."}):""}}render(){return this.props.user.has_never_set_password&&!this.state.userConfirmedSetPassword?t.React$1.createElement(U,{email:this.props.user.email,reason:r.intl.formatMessage({id:"Vrzvo2",defaultMessage:"For your security, Dropbox requires you to set a password to change your email."}),onUserConfirm:()=>this.setState({userConfirmedSetPassword:!0})}):this.props.reason&&Y.includes(this.props.reason)?t.React$1.createElement(i.ModalWithCSS,{title:r.intl.formatMessage({id:"THOQIj",defaultMessage:"Update ‘{email}’"},{email:this.props.user.email}),className:"change-email-modal--maestro",acceptButtonText:r.intl.formatMessage({id:"hPUPiA",defaultMessage:"Update email"}),dismissButtonText:r.intl.formatMessage({id:"8fk5Hk",defaultMessage:"Cancel"}),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal",style:"default-maestro"},t.React$1.createElement(W,null,t.React$1.createElement("form",{action:"/account/change_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:this.formRef},t.React$1.createElement("div",{className:"change-email-message"},this.getPrompt()),t.React$1.createElement("div",{className:"change-email-inputs"},t.React$1.createElement("div",{className:"change-email-input"},t.React$1.createElement("div",{className:"change-email-input-label"},r.intl.formatMessage({id:"mMKYfC",defaultMessage:"New email"})),t.React$1.createElement(B,{className:"change-email-input",name:"email",label:r.intl.formatMessage({id:"R5DNWc",defaultMessage:"you@mail.com"}),error:this.state.errors.email,autoComplete:"off"})),t.React$1.createElement("div",{className:"change-email-input"},t.React$1.createElement("div",{className:"change-email-input-label"},r.intl.formatMessage({id:"VvZ36k",defaultMessage:"Confirm email"})),t.React$1.createElement(B,{className:"change-email-input",name:"confirm_email",label:r.intl.formatMessage({id:"R5DNWc",defaultMessage:"you@mail.com"}),error:this.state.errors.confirm_email,autoComplete:"off"})),t.React$1.createElement("div",{className:"change-email-input"},t.React$1.createElement("div",{className:"change-email-input-label"},r.intl.formatMessage({id:"ICoFby",defaultMessage:"Dropbox password"})),t.React$1.createElement(j,{className:"change-email-input",name:"password",label:r.intl.formatMessage({id:"Lo93wl",defaultMessage:"Minimum 5 characters"}),error:this.state.errors.password,autoComplete:"off"})),t.React$1.createElement("input",{type:"hidden",name:"_subject_uid",value:this.props.user.id}),t.React$1.createElement("input",{type:"hidden",name:"from_checkup",value:`${!!this.props.fromCheckup}`}))))):t.React$1.createElement(i.ModalWithCSS,{title:r.intl.formatMessage({id:"THOQIj",defaultMessage:"Update ‘{email}’"},{email:this.props.user.email}),className:"change-email-modal",acceptButtonText:r.intl.formatMessage({id:"hPUPiA",defaultMessage:"Update email"}),dismissButtonText:r.intl.formatMessage({id:"8fk5Hk",defaultMessage:"Cancel"}),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},t.React$1.createElement(W,null,t.React$1.createElement("form",{action:"/account/change_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:this.formRef},t.React$1.createElement("div",null,this.getPrompt()),t.React$1.createElement("div",{className:"change-email-inputs"},t.React$1.createElement(B,{className:"change-email-input",name:"email",placeholder:r.intl.formatMessage({id:"mMKYfC",defaultMessage:"New email"}),error:this.state.errors.email,autoComplete:"off"}),t.React$1.createElement(B,{className:"change-email-input",name:"confirm_email",placeholder:r.intl.formatMessage({id:"VvZ36k",defaultMessage:"Confirm email"}),error:this.state.errors.confirm_email,autoComplete:"off"}),t.React$1.createElement(j,{className:"change-email-input",name:"password",placeholder:r.intl.formatMessage({id:"TA7IaN",defaultMessage:"Dropbox password"}),error:this.state.errors.password,autoComplete:"off"}),t.React$1.createElement("input",{type:"hidden",name:"_subject_uid",value:this.props.user.id}),t.React$1.createElement("input",{type:"hidden",name:"from_checkup",value:`${!!this.props.fromCheckup}`})))))}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}}H.displayName="ChangeEmailModal";const K={_POLLING:{},send_verification_email:(e,t,a,i)=>s.WebRequest$2({url:"/sendverifyemail",data:{email:t,reason:a},success:()=>null==i?void 0:i(),subject_user:e}),check_verification:(e,t,a,i)=>s.SilentBackgroundRequest$1({url:"/isemailverified",data:{email:t},success:e=>"ok"===e?a():i(),subject_user:e}),listen_for_verification(e,t,s){const a=`${null==e?void 0:e.id}:${t}`;if(!this._POLLING[a])return this._POLLING[a]=!0,this._poll_for_verification(e,t,s)},_poll_for_verification(e,t,s){return this.check_verification(e,t,s,(()=>setTimeout((()=>this._poll_for_verification(e,t,s)),4e3)))}},z=({onClick:e})=>t.React$1.createElement("span",{className:"js-change-email-before-verify",onClick:e},r.intl.formatMessage({id:"62qYaH",defaultMessage:"Update email address"}));z.displayName="ChangeEmail";const G=s.requireCssWithComponent((function(e){const a=()=>{s.unmountModal()};return t.React$1.createElement(s.Modal,{open:!0},t.React$1.createElement(s.Modal.Header,{hasBottomSpacing:"title-standard"},t.React$1.createElement(s.Title,null,t.React$1.createElement("span",{className:"js-email-modal-title"},e.title))),t.React$1.createElement(s.Modal.Body,null,e.children),t.React$1.createElement(s.Modal.Footer,null,e.altAction&&t.React$1.createElement(s.Button,{hasNoUnderline:!0,variant:"transparent"},e.altAction),e.dismissButtonText&&t.React$1.createElement(s.Button,{className:"js-email-modal-button",variant:"opacity",onClick:e.onDismiss||a},e.dismissButtonText),t.React$1.createElement(s.Button,{className:"js-email-modal-button",variant:"primary",onClick:e.onAccept||a},e.acceptButtonText)))}),["/static/metaserver/static/css/dig-components/index.web-vflvPodS4.css","/static/metaserver/static/css/dig-fonts/index.metaserver-vflgFIjQa.css"]);class Z extends t.React$1.Component{constructor(){super(...arguments),this.displayName="VerifyEmailModal",this.sendEmail=e=>(e.preventDefault(),K.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)),this.cancel=()=>{this.props.onCancel&&this.props.onCancel(),this.close()},this.close=()=>{s.unmountModal()},this.emailSent=()=>{var e;return this.close(),null===(e=this.props)||void 0===e?void 0:e.onEmailSent()},this.showChangeEmail=e=>{var t;const a={reason:this.props.reason};return s.UserActivityLogger.log("web","email_verify_change_first",a),e.preventDefault(),this.close(),null===(t=this.props)||void 0===t?void 0:t.onShowChange()},this.getPrompt=()=>{var e,i;switch(this.props.reason){case a.EmailVerificationReasons.ADD_COMMENT:return r.intl.formatMessage({id:"IqQ43j",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can add comments. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.SUBSCRIBE_TO_COMMENTS:return r.intl.formatMessage({id:"vL8W0q",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can subscribe. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.SHARE_FOLDER:return r.intl.formatMessage({id:"uhaAo6",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to share folders. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.NEW_DFB_TEAM_TRY:case a.EmailVerificationReasons.NEW_DFB_TEAM_BUY:return r.intl.formatMessage({id:"AeBfu4",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to add members to your team. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.SHMODAL:case a.EmailVerificationReasons.SHARE_FILEVIEWER:return r.intl.formatMessage({id:"snZuZp",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to share links. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.SEND_TRANSFER_VIA_EMAIL:return r.intl.formatMessage({id:"KJO3V/",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to send transfers. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.CREATE_API_APP:return r.intl.formatMessage({id:"zLfhKE",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can register an API app. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.PUBLIC_FOLDER:return r.intl.formatMessage({id:"yAlYzI",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to enable your Public folder. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.CHANGE_EMAIL:const{is_paired:o}=s.Viewer.get_viewer();return o&&"personal"===(null===(e=this.props.user)||void 0===e?void 0:e.role)?r.intl.formatMessage({id:"mdc1jT",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to finish updating your personal email. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email}):o&&"work"===(null===(i=this.props.user)||void 0===i?void 0:i.role)?r.intl.formatMessage({id:"7PsqE/",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to finish updating your {team} email. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email,team:s.Viewer.get_viewer().team_name}):r.intl.formatMessage({id:"2HVRJ2",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to finish updating your email. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.CREATE_FILE_COLLECTOR:return r.intl.formatMessage({id:"KyKro/",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to create file requests. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.GIFT_BUY:return r.intl.formatMessage({id:"ObebZe",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can send gifts to your friends. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.REFER_FRIENDS:return r.intl.formatMessage({id:"NgyUVU",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can invite friends. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.CREATE_TEAM:return r.intl.formatMessage({id:"7AVwhM",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can create or join a team. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.CLOUD_DOCS:return r.intl.formatMessage({id:"fmvo35",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can open or create this document type. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.MOUNT_FOLDER:return r.intl.formatMessage({id:"HF21ec",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can join this folder. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.FOLDER_PREVIEW_SAVE_FOLDER:return r.intl.formatMessage({id:"3acALd",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to save folders to your Dropbox account. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.FOLDER_PREVIEW_SAVE_FILE:return r.intl.formatMessage({id:"S0u9OK",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to save files to your Dropbox account. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.SIGN_DOCUMENTS:return r.intl.formatMessage({id:"ytvkH2",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can have documents signed. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.EFL_UPLOAD_FILES:return r.intl.formatMessage({id:"nVS2hj",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> to upload files to this folder. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.TFA_SMS_REGISTRATION:return r.intl.formatMessage({id:"GbfjRU",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can use text messages for two-step authentication. It’s as simple as clicking the link in the verification email we send to you."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});default:return r.intl.formatMessage({id:"MOMy71",defaultMessage:"Verify your email address at <strong>{email}</strong> to share folders and ensure your account can be recovered."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email})}}}render(){const e={reason:this.props.reason};return s.UserActivityLogger.log("web","email_verify_shown",e),t.React$1.createElement(G,{title:r.intl.formatMessage({id:"qSfYsl",defaultMessage:"Verify your email address"}),acceptButtonText:r.intl.formatMessage({id:"ldGo0I",defaultMessage:"Send email"}),dismissButtonText:r.intl.formatMessage({id:"rH6g3h",defaultMessage:"Cancel"}),onAccept:this.sendEmail,onDismiss:this.cancel,altAction:!this.props.hideChangeEmail&&t.React$1.createElement(z,{onClick:this.showChangeEmail})},t.React$1.createElement("div",{className:"js-modal-content"},this.getPrompt()))}}Z.displayName="VerifyEmailModal";class Q extends t.React$1.Component{constructor(){super(...arguments),this.displayName="ResendVerifyEmailModal",this.cancel=()=>{this.props.onCancel&&this.props.onCancel(),this.close()},this.close=()=>{s.unmountModal()},this.showChangeEmail=e=>{var t;const a={reason:this.props.reason};return s.UserActivityLogger.log("web","email_verify_resend_change_first",a),e.preventDefault(),this.close(),null===(t=this.props)||void 0===t?void 0:t.onShowChange()},this.sendEmail=e=>(e.preventDefault(),K.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)),this.emailSent=()=>{var e;return this.close(),null===(e=this.props)||void 0===e?void 0:e.onEmailSent()},this.getPrompt=()=>{var e,i;const{is_paired:o}=s.Viewer.get_viewer();return this.props.reason===a.EmailVerificationReasons.REFER_FRIENDS?r.intl.formatMessage({id:"V5m/DU",defaultMessage:"Dropbox needs to verify your email address <strong>{email}</strong> before you can invite friends. Check your inbox and click the link in the email to verify your address. If you can’t find it, check your spam folder."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email}):this.props.reason!==a.EmailVerificationReasons.CHANGE_EMAIL?r.intl.formatMessage({id:"1B+7Tj",defaultMessage:"Dropbox has sent a verification email to <strong>{email}</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email}):o&&"personal"===(null===(e=this.props.user)||void 0===e?void 0:e.role)?r.intl.formatMessage({id:"0BEy+K",defaultMessage:"Dropbox has sent a verification email to <strong>{email}</strong>. Check your inbox and click on the link in the email to finish updating your personal email. If you can't find it, check your spam folder or click the button to resend the email."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email}):o&&"work"===(null===(i=this.props.user)||void 0===i?void 0:i.role)?r.intl.formatMessage({id:"XICSrF",defaultMessage:"Dropbox has sent a verification email to <strong>{email}</strong>. Check your inbox and click on the link in the email to finish updating your {team} email. If you can't find it, check your spam folder or click the button to resend the email."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email,team:s.Viewer.get_viewer().team_name}):r.intl.formatMessage({id:"MbQzS4",defaultMessage:"Dropbox has sent a verification email to <strong>{email}</strong>. Check your inbox and click on the link in the email to finish updating your email. If you can't find it, check your spam folder or click the button to resend the email."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email})}}render(){const e={reason:this.props.reason};return s.UserActivityLogger.log("web","email_verify_resend_shown",e),t.React$1.createElement(G,{title:r.intl.formatMessage({id:"LX3/hN",defaultMessage:"Verify your email address"}),altAction:!this.props.hideChangeEmail&&t.React$1.createElement(z,{onClick:this.showChangeEmail}),acceptButtonText:r.intl.formatMessage({id:"Xm2xLZ",defaultMessage:"Resend email"}),onAccept:this.sendEmail,dismissButtonText:r.intl.formatMessage({id:"HFcTbV",defaultMessage:"Done"}),onDismiss:this.cancel},t.React$1.createElement("div",{className:"js-modal-content"},this.getPrompt()))}}Q.displayName="ResendVerifyEmailModal";class J extends t.React$1.Component{render(){const e=r.intl.formatMessage({id:"+0qvoG",defaultMessage:"Dropbox has sent a verification email to <strong>{email}</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});return t.React$1.createElement(G,{title:r.intl.formatMessage({id:"lL1Onf",defaultMessage:"Verification email sent!"}),acceptButtonText:r.intl.formatMessage({id:"W0X0fi",defaultMessage:"Done"})},t.React$1.createElement("div",{className:"js-modal-content"},e))}}J.displayName="VerifyEmailSentModal";class X extends t.React$1.Component{constructor(){super(...arguments),this.getPrompt=()=>{switch(this.props.reason){case a.EmailVerificationReasons.CREATE_TEAM:return r.intl.formatMessage({id:"CYHyF8",defaultMessage:"Thanks for verifying your email address: <strong>{email}</strong>. Now you can invite members to your team."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.SHARE_FOLDER:case a.EmailVerificationReasons.SEND_TRANSFER_VIA_EMAIL:return r.intl.formatMessage({id:"4MDP+O",defaultMessage:"Thanks for verifying your email address: <strong>{email}</strong>. You can now share and receive files on Dropbox."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.CREATE_API_APP:return r.intl.formatMessage({id:"5NNqJD",defaultMessage:"Thanks for verifying your email address: <strong>{email}</strong>. You can now register API apps."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});case a.EmailVerificationReasons.PUBLIC_FOLDER:return r.intl.formatMessage({id:"hDvsGe",defaultMessage:"Thanks for verifying your email address. You can now enable the Public folder for your <strong>{email}</strong> Dropbox."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email});default:return r.intl.formatMessage({id:"KIf0WS",defaultMessage:"Thanks for verifying your email address: <strong>{email}</strong>."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email})}}}render(){return t.React$1.createElement(G,{title:r.intl.formatMessage({id:"hzY9FQ",defaultMessage:"Your email address is now verified"}),acceptButtonText:r.intl.formatMessage({id:"iJbj1c",defaultMessage:"Done"})},t.React$1.createElement("div",{className:"js-modal-content"},this.getPrompt()))}}X.displayName="EmailVerifiedModal";class ee extends t.React$1.Component{constructor(){super(...arguments),this.getPrompt=()=>{var e,a;const{is_paired:i}=s.Viewer.get_viewer();return i&&"personal"===(null===(e=this.props.user)||void 0===e?void 0:e.role)?r.intl.formatMessage({id:"NWO11b",defaultMessage:"Thanks for verifying your email address <strong>{email}</strong>. Your personal account has successfully been changed."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email}):i&&"work"===(null===(a=this.props.user)||void 0===a?void 0:a.role)?r.intl.formatMessage({id:"TJea5z",defaultMessage:"Thanks for verifying your email address <strong>{email}</strong>. Your {team} account has successfully been changed."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email,team:s.Viewer.get_viewer().team_name}):r.intl.formatMessage({id:"X16ZP1",defaultMessage:"Thanks for verifying your email address <strong>{email}</strong>. Your account has successfully been changed."},{strong:e=>t.React$1.createElement("strong",null,e),email:this.props.email})}}render(){return t.React$1.createElement(G,{title:r.intl.formatMessage({id:"BOuYz9",defaultMessage:"Your email address is now verified"}),acceptButtonText:r.intl.formatMessage({id:"0+WBOf",defaultMessage:"Done"})},t.React$1.createElement("div",{className:"js-modal-content"},this.getPrompt()))}}ee.displayName="ChangedEmailVerifiedModal";class te{constructor(e,t){var a;this.role=e,this.user=t?s.Viewer.get_viewer().get_user_by_id(t,!0):this.role?s.Viewer.get_viewer().get_user_by_role(this.role,!0):s.Viewer.get_viewer().deprecated_first_user_in_the_cookie,this.email_to_verify=null===(a=this.user)||void 0===a?void 0:a.email,this.verify_for_change=!1}static initClass(){this.prototype.polling=!1,this.prototype.show_resend=!1}static get_for_user(e){return this.getForRole(null==e?void 0:e.role)}static getForRole(e){return this.initializedForRole||(this.legacy=new te(void 0),this.personal=new te("personal"),this.work=new te("work"),null!=this.reason&&this.propagate_reason(),this.initializedForRole=!0),"personal"===e?this.personal:"work"===e?this.work:this.legacy}static getForUID(e){if(!this.initializedForUID){this.legacy=new te(void 0);const e=s.Viewer.get_viewer().linked_users_set.get_users();for(const t of e)this.emailVerificationByUID.set(t.id,new te(t.role,t.id));null!=this.reason&&this.propagate_reason(),this.initializedForUID=!0}if(e){const t=this.emailVerificationByUID.get(e);if(t)return t}return this.legacy}static reset(){this.initializedForRole=!1,this.initializedForUID=!1}static set_reason(e){this.reason=e,(this.initializedForRole||this.initializedForUID)&&this.propagate_reason()}static propagate_reason(){if(this.emailVerificationByUID.size>0)for(const e of this.emailVerificationByUID.values())e.reason=this.reason;else[this.legacy,this.personal,this.work].map((e=>e.reason=this.reason))}set_email_to_verify(e){var t;return null===e&&(e=void 0),this.email_to_verify=e,this.verify_for_change=this.email_to_verify!==(null===(t=this.user)||void 0===t?void 0:t.email)}send_email(e,t){return K.send_verification_email(this.user,this.email_to_verify,e,t)}flash_email_sent_notification(){return o.Notify.success(r.intl.formatMessage({id:"EEEqGq",defaultMessage:"Verification email sent to {email}"},{email:this.email_to_verify}))}ensure_polling(e){return K.listen_for_verification(this.user,this.email_to_verify,(()=>{if(e&&this.user)return this.user.is_email_verified=!0,e();const{reason:t}=te;if(t===a.EmailVerificationReasons.EFL_UPLOAD_FILES){const e=s.get_uri().updateQuery("upload","true");window.history.replaceState({},document.title,e)}return s.reload()}))}email_sent(e,t,s){return this.show_resend=!0,this.show(void 0,t),s&&this.flash_email_sent_notification(),this.ensure_polling(e)}show(e,t,s){return t&&te.set_reason(t),this.show_resend?this.show_resend_verify_modal(t,s):this.show_verify_modal(e,t,s)}_inferReason(e){if(e)return a.EmailVerificationReasons.CHANGE_EMAIL;const{reason:t}=te;if(t)return t;l.reportStack("Email Verification reason should not be null",{severity:c.SEVERITY.NONCRITICAL,tags:["email_verify:null_reason"]})}show_verify_modal(e,a,i,r){return a||(a=this._inferReason(this.verify_for_change)),s.mountModal(t.React$1.createElement(Z,{user:this.user,reason:a,email:this.email_to_verify,onCancel:i,onShowChange:()=>ae.show(this.user,a),onEmailSent:()=>te.get_for_user(this.user).email_sent(e,a,!0),hideChangeEmail:null==r?void 0:r.hideChangeEmail}))}show_resend_verify_modal(e,a,i){return null==e&&(e=this._inferReason(this.verify_for_change)),s.mountModal(t.React$1.createElement(Q,{user:this.user,email:this.email_to_verify,reason:e,onShowChange:()=>ae.show(this.user,e),onEmailSent:()=>te.get_for_user(this.user).email_sent(void 0,e,!0),onCancel:a,hideChangeEmail:null==i?void 0:i.hideChangeEmail}))}verified_or_send_and_show(e,t){var s;return(null===(s=this.user)||void 0===s?void 0:s.is_email_verified)?(t&&t(),!0):(this.send_email(e,(()=>this.email_sent((()=>(this.close(),t?t():void 0)),e))),!1)}verified_or_show(e,t){return!(!this.user||!this.user.is_email_verified)||(this.show(void 0,e,t),!1)}show_sent_modal(){return s.mountModal(t.React$1.createElement(J,{email:this.email_to_verify}))}show_verified_modal(){return s.mountModal(t.React$1.createElement(X,{reason:te.reason,email:this.email_to_verify}))}show_verified_and_changed_modal(){return s.mountModal(t.React$1.createElement(ee,{user:this.user,email:this.email_to_verify}))}close(){return s.unmountModal()}}te.emailVerificationByUID=new Map,te.initClass();const se=new class{constructor(){this.listeners={},this.addListener=(e,t)=>{var s;const a=null!==(s=this.listeners[e])&&void 0!==s?s:[];a.push(t),this.listeners[e]=a},this.removeListener=(e,t)=>{var s;const a=null!==(s=this.listeners[e])&&void 0!==s?s:[],i=a.indexOf(t);i>-1&&a.slice(i,1)},this.trigger=(e,t)=>{var s;for(const a of null!==(s=this.listeners[e])&&void 0!==s?s:[])a(t)}}},ae={show:(e,t)=>ae._should_show_warning(e)?ae._show_warning_modal(e,t):ae._show_change_modal(e,t),_should_show_warning(e){const{is_paired:t}=s.Viewer.get_viewer();return t&&"work"===(null==e?void 0:e.role)&&(null==e?void 0:e.sso_required)},_show_change_modal:(e,a)=>s.mountModal(t.React$1.createElement(H,{user:e,reason:a,onChange:t=>(ae.trigger_change(e,t,!1),"/account"!==m.URI.parse(s.get_href()).getPath()?s.redirect("/home?send_verification_email=1"):t!==e.email?s.reload():void 0),onVerificationCheck:t=>{ae.trigger_change(e,t,e.is_email_verified);const s=te.get_for_user(e);return s.set_email_to_verify(t),s.email_sent(void 0,a,!0)}})),_show_warning_modal:(e,a)=>s.mountModal(t.React$1.createElement(q,{user:e,onContinue:()=>ae._show_change_modal(e,a)})),add_listener(e,t){se.addListener(e.id,t)},remove_listener(e,t){se.removeListener(e.id,t)},trigger_change(e,t,s){se.trigger(e.id,{email:t,requiresVerification:s})}};e.ChangeEmail=ae,e.EmailVerification=te}));
//# sourceMappingURL=c_account_email.js-vflT1BLt1.map
