define(["exports","./c_tslib","./e_core_exception","./c_core_exception_info","./c_core_uri","metaserver/static/js/modules/constants/request","./c_browser_cookies"],(function(e,t,r,s,o,n,a){"use strict";function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var p,c,d,u=i(n);e.ApiV2HeaderNames=void 0,(p=e.ApiV2HeaderNames||(e.ApiV2HeaderNames={})).DropboxApiArg="Dropbox-API-Arg",p.DropboxApiSelectAdmin="Dropbox-API-Select-Admin",p.DropboxPathRoot="X-Dropbox-Path-Root",p.DropboxUid="X-Dropbox-Uid",p.DropboxTeamId="X-Dropbox-Teamid",p.DropboxTeamAuthorization="X-Dropbox-Team-Authorization",p.CsrfToken="X-CSRF-Token",e.TeamAuthRequestRole=void 0,(c=e.TeamAuthRequestRole||(e.TeamAuthRequestRole={}))[c.TeamAdminRole=0]="TeamAdminRole",c[c.MTARole=1]="MTARole",c[c.FederationAdminRole=2]="FederationAdminRole",e.TeamAuthRequestActionType=void 0,(d=e.TeamAuthRequestActionType||(e.TeamAuthRequestActionType={}))[d.AdminAction=0]="AdminAction",d[d.AssumeAction=1]="AssumeAction",d[d.OnBehalfOfAction=2]="OnBehalfOfAction";class l{constructor(e,t,r){this.type=e,this.value=t,this.isScalar=r}static parse(e){const t=e[".tag"];return 2===Object.keys(e).length&&null!=e[t]?new h(t,e[t]):new f(t,e)}}class h extends l{constructor(e,t=null){super(e,t,!0)}toJSON(){const e={".tag":this.type};return null!=this.value&&(e[this.type]=this.value),e}}class f extends l{constructor(e,t={}){super(e,t,!1)}toJSON(){return Object.assign({".tag":this.type},this.value||{})}}class m{constructor(e){this.message=e}toString(){return void 0===this.message?"ApiError":this.message}static parseResponse(e,t,o,n=null){let a="";null==n&&(n=e in R?R[e]:e>=500?w:m);const i={raw:{status:e,responseBody:o},summary:null,error:{},headers:t};try{const e=JSON.parse(o)||{};i.error=e.error,i.summary=e.error_summary,a=null!=e.user_message?e.user_message.text:""}catch(e){}return 429!==e||a||r.reportException({err:new Error("Error response is missing message"),severity:s.SEVERITY.NONCRITICAL,tags:["APIV2"],exc_extra:{summary:i.summary||"",error:i.error||""}}),Object.assign(new n(a||void 0),i)}}class _ extends m{}class g extends m{}class A extends m{}class w extends m{}class x extends m{}function b(e){return e instanceof m}const R={400:_,401:g,409:A,429:x};class E extends Error{constructor(e,t){super(t),this.name="FetchAbortError",this.response=e}}class y extends Error{constructor(e,t){super(t),this.name="FetchFailError",this.response=e}}class T extends Error{constructor(e,t){super(t),this.name="FetchResponseError",this.response=e}}function O(e){return"FetchResponseError"===e.name}function j(e){const t={};return e.forEach(((e,r)=>{t[r]=e})),t}class S{executeRpc(e,t,r,s,n){return new Promise((function(a,i){return o.incrementAjaxCount(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:Object.assign(Object.assign({},t),{"Content-Type":s}),body:r,signal:n}).then((e=>e.text().then((t=>({response:e,responseText:t}))))).then((({response:e,responseText:t})=>{if(e.ok)return{response:e,responseText:t};throw new T(e,t)})).then((({response:e,responseText:t})=>a({headers:j(e.headers),result:JSON.parse(t)}))).catch((e=>O(e)?i(m.parseResponse(e.response.status,j(e.response.headers),e.message)):i(m.parseResponse(0,{},"")))).finally(o.decrementAjaxCount)}))}executeBinaryRpc(e,t,r,s,n){return new Promise((function(a,i){return o.incrementAjaxCount(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:Object.assign(Object.assign({},t),{"Content-Type":s}),body:r,signal:n}).then((e=>e.ok?e.arrayBuffer().then((t=>({response:e,responseData:t}))):e.text().then((t=>{throw new T(e,t)})))).then((({response:e,responseData:t})=>a({headers:j(e.headers),result:t}))).catch((e=>O(e)?i(m.parseResponse(e.response.status,j(e.response.headers),e.message)):i(m.parseResponse(0,{},"")))).finally(o.decrementAjaxCount)}))}}class k extends S{}class v{constructor(e){this.uploadEndpoints=new Set(["backups/upload_session/append","files/alpha/upload","files/paper/create","files/paper/update","files/upload","files/upload_session/append_v2","files/upload_session/finish","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","hellosign/self_sign"]),this.downloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/download_zip","files/export","files/get_preview","files/get_thumbnail_v2","paper/docs/download","sharing/get_shared_link_file","sharing/export_shared_link"]),this.supportedUploadEndpoints=new Set(["backups/upload_session/append","files/paper/create","files/paper/update","files/upload","files/upload_session/append_v2","files/upload_session/finish","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","hellosign/self_sign"]),this.supportedDownloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","sharing/get_shared_link_file","sharing/export_shared_link"]),this.transport=e||new k}_upload(e,t,r,s){return this._uploadWithResponseHeaders(e,t,r,s).then((e=>e.result))}_uploadWithResponseHeaders(t,r,s,o){if(!this.uploadEndpoints.has(t))throw new Error(t+" does not use the content-upload endpoint format");if(!this.supportedUploadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-upload endpoints");const n=Object.assign({[e.ApiV2HeaderNames.CsrfToken]:this.csrfToken(),[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(r)},this._headers(o));if("string"==typeof s||void 0===s)return this.executeRpc(t,n,s,"application/octet-stream",o.signal);{const e=new Blob([s],{type:"application/octet-stream"});return this.executeRpc(t,n,e,"application/octet-stream",o.signal)}}_download(e,t,r,s){return this._downloadWithResponseHeaders(e,t,r,s).then((e=>e.result))}_downloadWithResponseHeaders(t,r,s,o){if(void 0===o||!o.hasOwnProperty("dangerouslyFetchUserContent")||!o.dangerouslyFetchUserContent)throw new Error("download requires explicit acknowledgement of the risk");if(!this.downloadEndpoints.has(t))throw new Error(t+" does not use the content-download endpoint format");if(!this.supportedDownloadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-download endpoints");const n=Object.assign({[e.ApiV2HeaderNames.CsrfToken]:this.csrfToken(),[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(r)},this._headers(s));return this.executeBinaryRpc(t,n,"","application/octet-stream",s.signal)}_rpc(e,t,r){return this._rpcWithResponseHeaders(e,t,r).then((e=>e.result))}_rpcWithResponseHeaders(t,r,s){const o=Object.assign({[e.ApiV2HeaderNames.CsrfToken]:this.csrfToken()},this._headers(s));if(this.downloadEndpoints.has(t))throw new Error(t+' does not use the rpc endpoint format. Use "download" instead');if(this.uploadEndpoints.has(t))throw new Error(t+' does not use the rpc endpoint format. Use "upload" instead');const n=JSON.stringify(r||null);return this.executeRpc(t,o,n,"application/json",s.signal)}csrfToken(){return a.Cookies.read("__Host-js_csrf")||""}executeRpc(e,r,s,n,a){return t.__awaiter(this,void 0,void 0,(function*(){const t="client-web.dropbox.com"===window.location.hostname?"client-web.dropbox.com":"www.dropbox.com";let i;u.REQUEST_TRACING_ENABLED&&(i={parent_request_id:u.REQUEST_ID},r["x-dropbox-force-request-tracing"]="ON");const p=new o.URI({scheme:"https",authority:t,path:"/2/"+e,query:i});return yield this.transport.executeRpc(p,r,s,n,a)}))}executeBinaryRpc(e,r,s,n,a){return t.__awaiter(this,void 0,void 0,(function*(){const t="client-web.dropbox.com"===window.location.hostname?"client-web.dropbox.com":"www.dropbox.com";let i;u.REQUEST_TRACING_ENABLED&&(i={parent_request_id:u.REQUEST_ID},r["x-dropbox-force-request-tracing"]="ON");const p=new o.URI({scheme:"https",authority:t,path:"/2/"+e,query:i});return yield this.transport.executeBinaryRpc(p,r,s,n,a)}))}http_header_safe_json(e){return JSON.stringify(e).replace(/[\u007f-\uffff]/g,(function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)}))}}v.prototype.ns=function(e){const t=this;return{rpc:function(r,s,o){return t._rpc(e+"/"+r,s,o)},rpcWithResponseHeaders:function(r,s,o){return t._rpcWithResponseHeaders(e+"/"+r,s,o)},upload:function(r,s,o,n){return t._upload(e+"/"+r,s,o,n)},uploadWithResponseHeaders:function(r,s,o,n){return t._uploadWithResponseHeaders(e+"/"+r,s,o,n)},download:function(r,s,o,n){return t._download(e+"/"+r,s,o,n)},downloadWithResponseHeaders:function(r,s,o,n){return t._downloadWithResponseHeaders(e+"/"+r,s,o,n)}}};class C extends v{constructor(e){super(e)}_headers(t){return Object.assign({[e.ApiV2HeaderNames.DropboxUid]:String(n.LOGGED_OUT_X_DROPBOX_UID)},t.headers)}}var D=Object.freeze({__proto__:null,NoAuthApiV2Client:C});e.ApiError=m,e.ApiV2ClientBase=v,e.AppError=A,e.FetchAbortError=E,e.FetchAsyncTransport=S,e.FetchFailError=y,e.FetchResponseError=T,e.FetchSyncTransport=class{executeRpc(e,t,r,s,n){return o.incrementAjaxCount(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:Object.assign(Object.assign({},t),{"Content-Type":s}),keepalive:!0,body:r,signal:n}).finally(o.decrementAjaxCount),Promise.resolve({headers:{},result:{}})}executeBinaryRpc(e,t,r,s,n){return o.incrementAjaxCount(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:Object.assign(Object.assign({},t),{"Content-Type":s}),keepalive:!0,body:r,signal:n}).finally(o.decrementAjaxCount),Promise.resolve({headers:{},result:new ArrayBuffer(0)})}},e.NoAuthApiV2Client=C,e.RateLimitError=x,e.ServerError=w,e.Union=l,e.UnionScalar=h,e.catchApiError=function(e){return function(t){if(b(t))return e(t);throw t}},e.errorIsFetchAbortError=function(e){return"FetchAbortError"===e.name},e.errorIsFetchFailError=function(e){return"FetchFailError"===e.name},e.errorIsFetchResponseError=O,e.isApiError=b,e.isAppError=function(e){return e instanceof A},e.isAuthError=function(e){return e instanceof g},e.isBadRequestError=function(e){return e instanceof _},e.isRateLimitError=function(e){return e instanceof x},e.isServerError=function(e){return e instanceof w},e.noauth_client_esnext=D}));
//# sourceMappingURL=c_api_v2_noauth_client.js-vflowoI0-.map
