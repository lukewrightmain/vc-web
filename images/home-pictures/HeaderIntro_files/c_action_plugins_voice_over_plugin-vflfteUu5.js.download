define(["exports","./e_edison","./e_ui_page_files_router","./c_file_viewer_sdk_file_viewer_file_viewer","./c_file_store_utils","./c_core_browser_detection","./c_tslib","./c_truncate_index","./c_capture_redux_selectors","./c_capture_sdk_helpers","./c_core_i18n","./c_ui-icon_line_video","./c_capture_hooks","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_notify","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","./c_src_sink_index","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/core/langpack","./c_extensions_data_selectors","./c_downloads","./c_share_download_ui_api","./c_integrations_data_selectors","./c_portable_delete_snackbars","./c_action_bar_action_bar_strings","./c_portable_delete_strings","./c_files_view_file_actions_snackbars","./c_sdk_file_viewer_action_plugins_utils","./c_file_actions_strings","./c_core_types_preview_type","./c_pap-events_enums_file_type-utils","./c_src_file_viewer_components","./c_api_v2_redux_files","./c_resize-observer-polyfill_dist_ResizeObserver","./c_ui-icon_line_collapse-right","./c_ui-icon_line_expand-left","./c_src_file_extension_extension_constants","./c_core_logging_constants","./c_src_logging_performance","./c_core_utils_redesign2023","./c_ui-icon_line_sidebar-show","./c_src_simple-action-bar_action_bar_types","./c_src_toolbar","./c_ui-icon_line_more-horizontal","./c_ui-icon_line_zoom-out","./c_breadcrumb_index","./c_ui-icon_line_move","./c_ui-icon_line_copy","./c_ui-icon_line_cursor","./c_ui-icon_line_delete","./c_auth_login_or_register_types","./c_file_viewer_utils","./c_loggers_device_type","./c_form_row_index","./c_ui_tree_view","./c_sharing_ui_notifications_util","./c_src_utils_logging","./c_account_email","./c_account_email_verify_reasons","./c_ui_modal_dig","./c_ui_input_dig","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","./c_dig-illustrations_spot_file-folders","./c_previews_util","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_history","./c_ux_analytics_dispatch_custom_event","./c_core_logging_video","./c_pap-events_previews_delete_file","./c_pap-events_previews_create_folder","./c_photo-editor_plugin_show-edit-plugin","./c_keymaster","./c_bug_reporting_routing","./c_clipboard_v3","./c_ui-icon_line_dropbox","./c_ui-icon_line_rocket","metaserver/static/js/modules/constants/publish","./c_file_viewer_data_store","./c_previews_data_actions","./c_src_mobile_web","./c_flows_flows_client","./c_docsend_src_utils","./c_src_common_filepath","./c_flows_approval_approval_io_client","./c_typeahead_index","./c_src_preview-photo-editor_types","./c_ui-icon_line_edit","./c_ui-icon_line_share-arrow","./c_src_common_format_bytes","./c_info_blade_content_metadata_image_metadata","./c_ui-icon_line_closed-captions","./c_src_simple-action-bar_inline_action_bar","./c_assets_pictogram_lightbulb","./c_src_highlighted-truncated-string_em-string","./c_size_class_constants","./c_extensions_split_share_button","./c_ui-icon_line_link","./c_share_modal_evolution_utils_logging","./c_team_discovery_data_utils","./c_growth_ui_teams_web_actions_logger_events","./c_teams_let_members_invite_non_admin_invite_modal","./c_loggers_join_flow_logger","./c_contacts_tokenizer_v2","./c_ui-icon_line_import-contacts","./c_integrations_notify","./c_spectrum_tooltip","./c_src_text","./c_spectrum_colorized_icon","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_src_instrumentation_common_context","./c_src_instrumentation_constants","./c_src_instrumentation_function_wrapper","./c_spectrum_facepile_facepile_members","./c_spectrum_avatar_avatar_initials","./c_spectrum_avatar_avatar_color_util","./c_src_components_action-bar-strings","./c_ui-icon_line_crop","./c_ui-icon_line_cut","./c_ui-icon_line_shape-rotate-right","./c_ui-icon_line_flip-vertical","./c_ui-icon_line_slider","./c_ui_hoc","./c_capture_api"],(function(e,t,i,o,a,s,r,_,n,c,l,d,u,p,m,g,v,f,h,b,x,w,y,E,R,k,M,$,C,V,I,j,S,U,T,N,A,B,z,O,D,F,L,P,Q,G,H,W,Z,q,J,K,X,Y,ee,te,ie,oe,ae,se,re,_e,ne,ce,le,de,ue,pe,me,ge,ve,fe,he,be,xe,we,ye,Ee,Re,ke,Me,$e,Ce,Ve,Ie,je,Se,Ue,Te,Ne,Ae,Be,ze,Oe,De,Fe,Le,Pe,Qe,Ge,He,We,Ze,qe,Je,Ke,Xe,Ye,et,tt,it,ot,at,st,rt,_t,nt,ct,lt,dt,ut,pt,mt,gt,vt,ft,ht,bt,xt,wt,yt,Et,Rt,kt,Mt,$t,Ct,Vt,It,jt,St,Ut,Tt,Nt,At,Bt,zt,Ot,Dt,Ft,Lt,Pt,Qt,Gt,Ht,Wt,Zt,qt,Jt){"use strict";const Kt=["ai","psd","sketch","xd"],Xt=["pdf"],Yt=["ppt","pptx","key"],ei=["numbers","ods","xls","xlsm","xlsx"],ti=["doc","docx","odt","pages","rtf","txt"],ii=[...Xt,...ei,...ti,...Yt,...Kt],oi=e=>!!e&&ii.includes(e);i.injectInternalStyle("metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/voice_over_plugin/face_bubble.module.out.css",(e=>"._container_4ad74_1{bottom:50px;height:168px;left:50px;position:absolute;width:168px;z-index:1}._bubble_4ad74_10{height:128px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:128px}._bubble_4ad74_10:hover ._image_4ad74_19{opacity:50%}._bubble_4ad74_10:hover button{display:block}._image_4ad74_19{border-radius:50%;height:100%;width:100%}._button_4ad74_33{border-radius:100px;color:var(--color__standard__text);display:none;left:50%;max-width:101px;position:absolute;top:50%;transform:translate(-50%,-50%)}._button_4ad74_33,._button_4ad74_33:hover{background:var(--color__inverse__core__primary)}._close_4ad74_49{border-radius:100px;display:none;opacity:70%;position:absolute;right:8px;top:8px}._tooltip-title_4ad74_58{min-width:224px}._tooltip-body_4ad74_62{display:block;margin:12px 0 16px}._tooltip-button-container_4ad74_67{display:flex;justify-content:flex-end}._tooltip-cta_4ad74_72{color:var(--color__standard__text);margin-left:8px}._tooltip-cta_4ad74_72,._tooltip-cta_4ad74_72:hover{background:var(--color__inverse__core__primary)}@keyframes _outer-highlight_4ad74_120{0%{height:143px;width:143px}33%{height:158px;width:158px}66%{height:163px;width:163px}to{height:143px;width:143px}}@keyframes _inner-highlight_4ad74_132{0%{height:128px;width:128px}33%{height:128px;width:128px}66%{height:145px;width:145px}to{height:128px;width:128px}}._outer-highlight-bubble_4ad74_120{animation-iteration-count:infinite;animation-name:_outer-highlight_4ad74_120;background:var(--color__attention__background--faint)}._inner-highlight-bubble_4ad74_132,._outer-highlight-bubble_4ad74_120{animation-duration:1.5s;border-radius:50%;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}._inner-highlight-bubble_4ad74_132{animation-iteration-count:infinite;animation-name:_inner-highlight_4ad74_132;background:var(--color__attention__background)}"));const ai="_container_4ad74_1",si="_bubble_4ad74_10",ri="_image_4ad74_19",_i="_button_4ad74_33",ni="_close_4ad74_49",ci="_tooltip-title_4ad74_58",li="_tooltip-body_4ad74_62",di="_tooltip-button-container_4ad74_67",ui="_tooltip-cta_4ad74_72",pi="_outer-highlight-bubble_4ad74_120",mi="_inner-highlight-bubble_4ad74_132",gi=t.static_url("/static/metaserver/static/js/capture/assets/sdk_face_bubble_default-vflB1fqho.gif"),vi="CAPTURE_VOICE_OVERS_HAS_DISMISSED_FACE_BUBBLE",fi="CAPTURE_VOICE_OVERS_HAS_DISMISSED_FACE_BUBBLE_TOOLTIP",hi=({experimentVariant:e,file:s,logUserAction:d,onDismissBubble:u,user:p})=>{var m;const g=t.react.exports.useRef(null),v=i.useDispatch(),f=t.react.exports.useMemo((()=>a.getExtension(s)),[s]),h=i.useSelector(n.getRecorderState),[b,x]=t.react.exports.useState(!1),[w,y]=t.react.exports.useState(!1),E=t.react.exports.useMemo((()=>(e=>Kt.includes(e)?{body:l.intl.formatMessage({id:"jiz+Qn",defaultMessage:"Use video to give an overview of your design concept, share recent changes, or address feedback."}),title:l.intl.formatMessage({id:"QQzHR3",defaultMessage:"Attach a video to explain your design"})}:Xt.includes(e)?{body:l.intl.formatMessage({id:"o5MmUS",defaultMessage:"Use video to give an overview of your file or provide context for forms, invoices, and agreements."}),title:l.intl.formatMessage({id:"0NaONo",defaultMessage:"Attach a video to explain your file"})}:Yt.includes(e)?{body:l.intl.formatMessage({id:"DLuC4i",defaultMessage:"Use video to give an overview of your presentation, share helpful context, or add a human touch."}),title:l.intl.formatMessage({id:"wSW0RB",defaultMessage:"Attach a video to explain your slides"})}:ei.includes(e)?{body:l.intl.formatMessage({id:"Hl+aj9",defaultMessage:"Use video to give an overview of your spreadsheet, highlight key metrics, or share next steps."}),title:l.intl.formatMessage({id:"0P696I",defaultMessage:"Attach a video to explain your data"})}:ti.includes(e)?{body:l.intl.formatMessage({id:"t8ng5o",defaultMessage:"Use video to give an overview of your document, share helpful context, or explain key ideas."}),title:l.intl.formatMessage({id:"0NaONo",defaultMessage:"Attach a video to explain your file"})}:{body:l.intl.formatMessage({id:"IpTfVi",defaultMessage:"Use video to give an overview of your file, share helpful context, or explain key ideas."}),title:l.intl.formatMessage({id:"0NaONo",defaultMessage:"Attach a video to explain your file"})})(f)),[f]),R=t.react.exports.useCallback((t=>{d(t,"capture_voice_over_face_bubble",{experimentVariant:e,hasAvatar:(!!p.photo_url).toString(),extension:f})}),[e,f,d,p]);t.react.exports.useEffect((()=>{r.__awaiter(void 0,void 0,void 0,(function*(){const e=yield i.getUserMetadata([vi,fi],p.id),t=!e[vi]&&ii.includes(f);x(t),y(!e[fi]),t&&R("capture_voice_over_face_bubble_shown")}))}),[f,R,p]),t.react.exports.useEffect((()=>{h.active&&(x(!1),y(!1))}),[h]);const k=()=>r.__awaiter(void 0,void 0,void 0,(function*(){x(!1),y(!1),yield c.handleSafariWorkaround(),v(o.triggerVoiceover(!0))}));return b?t.React$1.createElement("div",{className:ai},t.React$1.createElement("div",{className:pi}),t.React$1.createElement("div",{className:mi}),t.React$1.createElement("div",{className:si},t.React$1.createElement("img",{alt:"",className:ri,ref:g,src:null!==(m=p.photo_url)&&void 0!==m?m:gi}),t.React$1.createElement(i.Button,{className:_i,onClick:()=>{R("capture_voice_over_face_bubble_record_click"),k()},size:"small",variant:"borderless"},t.React$1.createElement(_.Truncate,{maxWidth:77,tooltipControlProps:{placement:"top"}},l.intl.formatMessage({id:"0CQfT/",defaultMessage:"Record video"}))),t.React$1.createElement(i.IconButton,{className:ni,inverse:!0,onClick:()=>{x(!1),y(!1),R("capture_voice_over_face_bubble_dismiss_click"),u(),i.setUserMetadata({[vi]:!0,[fi]:!0},p.id)},size:"small",variant:"filled"},t.React$1.createElement(i.UIIcon,{"aria-label":l.intl.formatMessage({id:"uNoaUx",defaultMessage:"Close"}),src:i.CloseLine})),t.React$1.createElement(i.Tooltip.Control,{auto:!0,open:w,placement:"right",triggerRef:g,variant:"rich"},t.React$1.createElement(i.Title,{className:ci,inverse:!0,size:"medium"},E.title),t.React$1.createElement(i.Text,{className:li,color:"standard",inverse:!0},E.body),t.React$1.createElement("div",{className:di},t.React$1.createElement(i.Button,{onClick:()=>{y(!1),R("capture_voice_over_face_bubble_tooltip_dismiss_click"),i.setUserMetadata({[fi]:!0},p.id)},inverse:!0,variant:"opacity"},l.intl.formatMessage({id:"uNoaUx",defaultMessage:"Close"})),t.React$1.createElement(i.Button,{className:ui,onClick:()=>{R("capture_voice_over_face_bubble_tooltip_record_click"),k()},variant:"borderless"},l.intl.formatMessage({id:"0CQfT/",defaultMessage:"Record video"})))))):null};i.injectInternalStyle("metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/voice_over_plugin/play_video_button.module.out.css",(e=>"._captureViewVideoDropdownFooterWrapper_95ofo_1{background-color:var(--color__attention__background--faint)}._captureViewVideoDropdownFooter_95ofo_1{display:flex;width:300px}._captureViewVideoButtonTooltip_95ofo_10{align-items:center;display:flex}"));const bi="_captureViewVideoButtonTooltip_95ofo_10";function xi({file:e,logUserAction:s,hideIcons:r,experimentVariant:_}){const n=t.React$1.useRef(null),c=i.useDispatch(),l=i.useSelector(o.getShowPostCreationTooltip),u=i.useIntl();t.React$1.useEffect((()=>{s("capture_view_video_action_shown","file_preview_actionbar_dropdown",{experimentVariant:_,extension:a.getExtension(e)})}),[_,e,s]);return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(i.Button,{variant:"opacity",withIconLeft:r?null:t.React$1.createElement(i.UIIcon,{src:d.VideoLine,role:"presentation"}),ref:n,"data-uxa-log":"view_video_actionbar_button","data-testid":"view-video-menu-button","data-campaigns-element-id":"view-video-on-preview",onClick:()=>{l&&c(o.setShowPostCreationTooltip(!1)),c(o.openCaptureFileVoiceover())}},u.formatMessage({id:"HQGi3z",defaultMessage:"Play video"})),t.React$1.createElement(i.Tooltip.Control,{triggerRef:n,placement:"bottom",open:l},t.React$1.createElement("div",{className:bi},t.React$1.createElement(i.Text,{inverse:!0},u.formatMessage({id:"H/EiWQ",defaultMessage:"Open the video for this file at any time"})),t.React$1.createElement(i.IconButton,{inverse:!0,variant:"borderless",onClick:()=>c(o.setShowPostCreationTooltip(!1))},t.React$1.createElement(i.UIIcon,{src:i.CloseLine})))))}i.injectInternalStyle("metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/voice_over_plugin/record_video_button.module.out.css",(e=>"._tooltip-body_12863_1{align-items:center;display:flex}._tooltip-text_12863_6{width:225px}"));const wi="_tooltip-body_12863_1",yi="_tooltip-text_12863_6";function Ei({file:e,user:s,logUserAction:_,hideIcons:l,experimentVariant:u,onCloseTooltip:p,showTooltip:m}){const g=t.react.exports.useRef(null),v=i.useDispatch(),f=i.useSelector(n.getRecorderState),h=i.useIntl();t.React$1.useEffect((()=>{_("capture_record_video_action_shown","file_preview_actionbar_dropdown",{experimentVariant:u,extension:a.getExtension(e)})}),[u,e,_]);const b=t=>{_("capture_record_video_with_camera_failure","file_preview_actionbar_dropdown",{reason:t,experimentVariant:u,extension:a.getExtension(e)})};return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(i.Button,{variant:"opacity",withIconLeft:l?null:t.React$1.createElement(i.UIIcon,{src:d.VideoLine,role:"presentation"}),id:"capture-record-video-menu-button","data-uxa-log":"record_video_on_previews_click","data-testid":"record-video-menu-button","data-campaigns-element-id":"record-video-on-preview",disabled:null==f?void 0:f.active,onClick:()=>r.__awaiter(this,void 0,void 0,(function*(){_(`capture_record_video_with_camera_${"click"}`,"file_preview_actionbar_dropdown",{experimentVariant:u,extension:a.getExtension(e)}),s?oi(a.getExtension(e))?(yield c.handleSafariWorkaround(),v(o.triggerVoiceover(!0))):b("invalid_file"):b("invalid_user")})),ref:g},h.formatMessage({id:"kruZZo",defaultMessage:"Record video"})),t.React$1.createElement(i.Tooltip.Control,{open:m,placement:"bottom","max-width":"300",triggerRef:g},t.React$1.createElement("div",{className:wi},t.React$1.createElement(i.Text,{className:yi,color:"standard",inverse:!0,size:"small"},h.formatMessage({id:"5GGxzT",defaultMessage:"Record a video for your file at any time"})),t.React$1.createElement(i.IconButton,{inverse:!0,onClick:p,size:"small",variant:"borderless"},t.React$1.createElement(i.UIIcon,{"aria-label":h.formatMessage({id:"uNoaUx",defaultMessage:"Close"}),src:i.CloseLine})))))}const Ri=({file:e,hideIcons:i,logUserAction:a,recordExperimentVariant:r,user:_,viewExperimentVariant:n})=>{const c=u.useCaptureAccess(_),l=o.useIsFileOwner(_,e),{shortLabel:d}=o.useCaptureForFile(_,e,a),[p,m]=t.react.exports.useState(!1),[g,v]=t.react.exports.useState(!0);t.react.exports.useEffect((()=>{v(!1)}),[]);const f=t.react.exports.useCallback((()=>{m(!0)}),[m]),h=t.react.exports.useCallback((()=>{m(!1)}),[m]),b=t.react.exports.useMemo((()=>"OFF"!==n&&d),[d,n]),x=t.react.exports.useMemo((()=>["V1","V2"].includes(r)&&!s.safari&&c&&l&&!d&&!s.is_supported_mobile_browser()),[c,l,r,d]);return b?t.React$1.createElement(xi,{file:e,logUserAction:a,hideIcons:i,experimentVariant:r}):x?t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(Ei,{file:e,user:_,logUserAction:a,hideIcons:i,experimentVariant:r,onCloseTooltip:h,showTooltip:p}),t.React$1.createElement(hi,{experimentVariant:r,file:e,logUserAction:a,onDismissBubble:f,user:_})):!g||null!==c&&null!==l?null:t.React$1.createElement("div",{style:{width:"140px"}})};e.logRecordVideoButtonExposure=function(e){i.getGatingClientSingleton().logExposure({stormcrowVariantInfo:{feature:"capture_sdk_integration_voice_overs_v2",variant:e}})},e.logViewCaptureVideoButtonExposure=function(e){i.getGatingClientSingleton().logExposure({stormcrowVariantInfo:{feature:"capture_sdk_integration_voice_overs_view_button",variant:e}})},e.makeVoiceOverEntrypoint=(e,s,r,_,n)=>({actionDefinitions:()=>(e=>{const c=a.getExtension(e.file);return{atTopLevelIfSpace:oi(c)?[{renderButton:o=>{const a=e.file,c=i.getStoreForCapture();return t.React$1.createElement(i.Provider,{store:c},t.React$1.createElement(Ri,{file:a,hideIcons:o,logUserAction:n.logUserAction,recordExperimentVariant:r,user:s,viewExperimentVariant:_}))},id:o.VOICE_OVER_PLUGIN_ID}]:[]}})(e())})}));
//# sourceMappingURL=c_action_plugins_voice_over_plugin.js-vflKpfF2G.map
