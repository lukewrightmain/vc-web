define(["exports","./e_edison","./e_ui_page_files_router","./e_core_exception","./c_browse","./c_data_action_creators_index","./c_lodash-es_lodash","./c_tslib","./c_core_uri","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_notify","./c_core_i18n","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","./c_bug_reporting_routing","./c_history","./c_ux_analytics_dispatch_custom_event","./c_pagelet_logger","./c_pagination_manager","./c_browse_actions","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_action_bar_file_actions_logging","./c_files_view_file_actions_snackbars","./c_sync_everything_hive_logger","./c_pap-events_previews_delete_file","./c_sharing_async_share_modal_util","./c_flows_utils_async_modal_launchers","./c_browse_file_actions_action_handlers","./c_views_copy_link_mini_modal","./c_share_modal_evolution_utils_logging","./c_src_utils_logging","./c_components_sharing_spinner","./c_ui-icon_line_link","./c_truncate_index","./c_clipboard_v3","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_downloads","./c_extensions_data_selectors","./c_share_download_ui_api","./c_integrations_data_selectors","./c_browse_interface","./c_file_actions_portable_go_to_folder","./c_file_viewer_async_controller","./c_src_logging_performance","./c_cloud_docs_gdd_migration_gdd_ui_blocking","./c_plusplus_file_actions","./c_vault_constants","./c_src_file_extension_extension_constants","./c_gdd_migration_ui_utils","./c_file_imports_gdrive_file_picker","./c_components_modals_show_modal","./c_spectrum_modal_utility_modal","./c_spectrum_tertiary_link_tertiary_list","./c_icon_templates_actionable_index","./c_spectrum_svg_icon_bundle","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_exenv_index","./c_ux_analytics_modal_tracking","./c_file_transfers_async_browse_entry_point_onboarding_modal_async","./c_starred_actions","./c_starred_constants","./c_starred_star","./c_ui-icon_fill_star","./c_common_uuid","./c_files_view_files_view_logging","./c_sharing_browse_exports","./c_unity_features","metaserver/static/js/modules/constants/unity","./c_file_store_utils","./c_file_transfers_lib_urls","./c_src_common_constants2","./c_browse_tts","./c_file_uploader_upload_kit_provider","./c_browse_crypto_subtle_digest","./c_file_uploader_utils","./c_pap-events_enums_file_type-utils","metaserver/static/js/modules/constants/global_file_upload","./c_base64","./c_upload_kit_lib_types","./c_file_uploader_result_type","./c_file_uploader_actions_adapter","./c_data_store","./c_data_slice","./c_upload_kit_scheduler_types","./c_upload_kit_uploader_context","./c_upload_kit_uploader_upload_abort_controller","./c_resize-observer-polyfill_dist_ResizeObserver","./c_ui-icon_line_repeat","./c_ui-icon_line_upload-folder","./c_src_simple-action-bar_inline_action_bar","./c_src_simple-action-bar_action_bar_types","./c_assets_pictogram_lightbulb","./c_ui-icon_line_more-horizontal","./c_src_highlighted-truncated-string_em-string","./c_action_bar_file_actions","./c_ui-icon_line_to-do","./c_unity_check_file_cache","./c_action_bar_action_bar_strings","./c_ui-icon_line_automation","./c_flows_redux_store","./c_flows_redux_reducer","./c_flows_lib_api","./c_flows_logging_flows_loggers","./c_src_common_constants","./c_flows_constants","./c_flows_redux_selectors","./c_ui-icon_line_comment","./c_ui-icon_line_copy","./c_action_bar_action_bar_constants","./c_file_actions_portable_copy","./c_hive_schemas_web-modal-activity","./c_file_actions_portable_move","./c_ui_fileops_actions","./c_ui-icon_line_delete","./c_ui-icon_line_download","./c_ui-icon_line_edit","./c_ui-icon_line_convert-file","./c_flows_conversions_conversion_actions","./c_flows_conversions_convert","./c_flows_redux_actions","./c_flows_utils_browse_logger","./c_workflow_builder_workflow_actions_action_ui_config","./c_ui-icon_line_audio","./c_ui-icon_line_arrow-right","./c_ui-icon_line_zip","./c_controls_index","./c_form_row_index","./c_ui-icon_line_image","./c_ui-icon_line_move","./c_ui_tree_view","./c_components_spacer_index","./c_ui-icon_line_add-folder","./c_ui-icon_line_cursor","./c_naming_conventions_utils","./c_ui-icon_line_tag","./c_tagging_components_tags_container","./c_components_item_truncation_container","./c_hooks_resize_observer","./c_tagging_components_tags_search","./c_typeahead_index","./c_modal_filters_view_tidy_filters","./c_folder_dialog_folder_picker_dig","./c_table_columns_file_name_column","./c_src_table","./c_ui-icon_line_arrow-down","./c_ui-icon_line_arrow-up","./c_react-table_index","./c_src_icons_file_icon","./c_src_icons_file_icon_extensions","./c_combinations_index","./c_spectrum_icon_arrow_index","./c_keymaster","./c_breadcrumb_index","./c_ui_hoc","./c_ui-icon_line_stamp","./c_plugin_utils_tilingFunc","./c_plugin_utils_getImageDefaultSizes","./c_flows_flows_client","./c_ui-icon_line_file","./c_ui-icon_line_video","./c_spectrum_icon_partners_index","./c_icon_shortcuts_icon","./c_icon_file_icon","./c_ui_title_bubble","./c_ui_overlay","./c_raf_throttle","./c_ui-icon_line_folder-show","./c_ui-icon_line_settings","./c_growth_ui_teams_web_actions_logger_events","./c_sharing_wizard_async_wizard_modals","./c_extensions_extensions_menu_component_v2","./c_spectrum_tooltip","./c_ui-icon_line_dropbox-replay","./c_ui-icon_line_dropbox","./c_ui-icon_line_finder","./c_ui-icon_line_globe","./c_ui-icon_line_show","./c_extensions_extensions_utils","metaserver/static/js/modules/constants/payments","./c_account_email","./c_account_email_verify_reasons","./c_ui_modal_dig","./c_ui_input_dig","./c_ui-icon_fill_fail","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","metaserver/static/js/modules/constants/reel","./c_ui-icon_line_delete-forever","./c_ui-icon_line_file-request","./c_ui-icon_line_restore","./c_ui-icon_line_share-arrow","./c_components_approval-forms_approval_request_modal","./c_flows_approval_approval_io_client","./c_components_approval-forms_approval_checkbox_in_share","./c_components_approval-forms_gating_utils","./c_extensions_split_share_button","./c_ui-icon_line_send","./c_ui-icon_line_signature","./c_ui-icon_line_rewind","./c_ui-icon_line_lock","./c_ui-icon_line_highlight","./c_shallow_equal","./c_ui-icon_line_thumbs-up","./c_flows_approval_approval_request_modal","./c_ui-icon_line_add-to-collection","./c_components_saver_modal_index","./c_collections_utils_file_identifier","./c_ui-icon_line_add","./c_ui-icon_line_collection","./c_ui-icon_line_sort-type","./c_collections_utils_thumbnails","./c_collections_lib_survey","./c_sync_everything_strings","./c_conversions_actions_unzip","./c_photo-editor_plugin_show-edit-plugin","./c_components_add-content-menu_index","./c_cloud_docs_create_api","./c_folder_dialog_async","./c_pap-events_manual_upload_select_upload","./c_ui-icon_line_team","./c_ui-icon_line_record-screen-camera","./c_capture_sdk_helpers","./c_capture_redux_selectors","./c_capture_async_recorder","./c_ui-icon_line_upload","./c_file_uploader_types","./c_flows_utils_exposure_logger","./c_ui-icon_line_hide","./c_components_loading_indicator","./c_sharing_actions_share_modal","./c_previews_util","./c_file_viewer_utils","./c_core_logging_constants","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_core_types_preview_type","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_confirmation_modals_reset_access_modal","./c_ui_flag","./c_components_form_validation_message","./c_hooks_lib_index","./c_ui-icon_line_calendar","./c_components_icons_icon_dropdown_selected","./c_components_sharing_modal_banner","./c_es_src_dropbox","./c_sharing_ui_notifications_util","./c_integrations_hellosign_deep_integration_launcher","./c_src_instrumentation_function_wrapper","./c_src_instrumentation_constants","./c_table_index","./c_src_text","./c_dropins_sdk_refactor_src_v2_entry","./c_stormcrow_stormcrow_exposure_logger","./c_docsend_analytics_add_on_data_apiUtils","./c_docsend_src_utils","./c_sharing_upsells_util","./c_flux_store_listener","./c_tabs_index","./c_sharing_content_manager","./c_spectrum_colorized_icon","./c_ui_bubble_dropdown_v2","./c_components_auto-folder-setup-checkbox_index","./c_avatar_initials_avatar","./c_avatar_size","./c_spectrum_avatar_avatar_initials","./c_spectrum_avatar_avatar_color_util","./c_prop-types_index","./c_spectrum_dropdown_button","./c_integrations_profile_card_popover","./c_integrations_notify","./c_src_instrumentation_common_context","./c_spectrum_facepile_facepile_members","./c_spectrum_culled_list","./c_spectrum_util_raf_throttle","./c_sharing_member_avatars","./c_ui_tooltip","./c_sharing_share_modal_util","./c_collections_utils_file","./c_onboarding_checklist_async_share_button_tooltip","./c_jquery","./c_Key","./c_growth_ui_send_app_link_form","./c_auth_authenticator","./c_security_crypto","./c_error_boundary","./c_react-error-boundary","./c_file_info_utils","./c_browse_selection_indicator","./c_capture_api","./c_browse_element_width","./c_spectrum_media_table_skeleton","./c_spectrum_media_table_media_cell","./c_spectrum_dimensions","./c_spectrum_vertically_fixed","./c_spectrum_overflow_button","./c_campaigns_campaigns_element_id_enum","./c_files_view_keyboard_shortcuts","./c_ui_selectable_list","./c_filename_highlights","./c_src_highlighted-truncated-string_index","./c_files_view_file_thumbnail","./c_icon_file_folder_icon","./c_sync_everything_utils_deep_link_utils","./c_core_custom_protocol","./c_web_util_errors","./c_aspect_ratio_index","./c_src_common_file","./c_ui-icon_line_more-vertical","./c_content_suggestions_models_suggested_item","./c_ui_section_header_tooltip","./c_ui-icon_line_info-small","./c_ui_section_section_header","./c_content_suggestions_api","./c_ui_section_section_empty_text","./c_api_v2_team_client","./c_react_query_api_helpers_helpers","./c_api_v2_redux_files","./c_ui-icon_line_collapse-right","./c_ui-icon_line_expand-left","./c_ui-icon_line_folder-history","./c_right_rail_file_activity_file_activity_blade","./c_info_blade_content_metadata_image_metadata","./c_src_common_filepath","./c_comments_component_pane","./c_ui-icon_line_emoji-smile","./c_comments_data_store","./c_src_right-rail_hooks","./c_ui-icon_line_mention","./c_components_utils_throttle-debounce","./c_spectrum_popover_popover_content","./c_components_section_tags_section_preview","./c_components_flows-icon-button_index","./c_flows_version_change_log_section","./c_file_activity_component_file_activity_blade","./c_ui-icon_line_file-history","./c_file_activity_data_store","./c_trash_constants","./c_proto_edison_redirect_messages_pb","./c_hooks_use_stabilized_callback","./c_maestro_layout_search","./c_spectrum_match","./c_edison_ui_spa_chrome","./c_activation_data_store","./c_onboarding_checklist_constants","./c_security_csrf_hmac","./c_ui-icon_external-logo_windows","./c_ui-icon_line_computer","./c_campaigns_campaign_enums"],(function(e,_,t,i,c,s,o,n,a,r,l,u,d,p,m,h,g,f,b,v,w,y,x,k,B,j,C,R,D,S,I,N,U,F,L,q,z,E,O,M,$,T,H,Q,A,J,K,V,G,P,W,X,Y,Z,ee,_e,te,ie,ce,se,oe,ne,ae,re,le,ue,de,pe,me,he,ge,fe,be,ve,we,ye,xe,ke,Be,je,Ce,Re,De,Se,Ie,Ne,Ue,Fe,Le,qe,ze,Ee,Oe,Me,$e,Te,He,Qe,Ae,Je,Ke,Ve,Ge,Pe,We,Xe,Ye,Ze,e_,__,t_,i_,c_,s_,o_,n_,a_,r_,l_,u_,d_,p_,m_,h_,g_,f_,b_,v_,w_,y_,x_,k_,B_,j_,C_,R_,D_,S_,I_,N_,U_,F_,L_,q_,z_,E_,O_,M_,$_,T_,H_,Q_,A_,J_,K_,V_,G_,P_,W_,X_,Y_,Z_,et,_t,tt,it,ct,st,ot,nt,at,rt,lt,ut,dt,pt,mt,ht,gt,ft,bt,vt,wt,yt,xt,kt,Bt,jt,Ct,Rt,Dt,St,It,Nt,Ut,Ft,Lt,qt,zt,Et,Ot,Mt,$t,Tt,Ht,Qt,At,Jt,Kt,Vt,Gt,Pt,Wt,Xt,Yt,Zt,ei,_i,ti,ii,ci,si,oi,ni,ai,ri,li,ui,di,pi,mi,hi,gi,fi,bi,vi,wi,yi,xi,ki,Bi,ji,Ci,Ri,Di,Si,Ii,Ni,Ui,Fi,Li,qi,zi,Ei,Oi,Mi,$i,Ti,Hi,Qi,Ai,Ji,Ki,Vi,Gi,Pi,Wi,Xi,Yi,Zi,ec,_c,tc,ic,cc,sc,oc,nc,ac,rc,lc,uc,dc,pc,mc,hc,gc,fc,bc,vc,wc,yc,xc,kc,Bc,jc,Cc,Rc,Dc,Sc,Ic,Nc,Uc,Fc,Lc,qc,zc,Ec,Oc,Mc,$c,Tc,Hc,Qc,Ac,Jc,Kc,Vc,Gc,Pc,Wc,Xc,Yc,Zc,es,_s,ts,is,cs,ss,os,ns,as,rs,ls,us,ds,ps,ms,hs,gs,fs,bs,vs,ws,ys,xs,ks,Bs,js,Cs,Rs,Ds,Ss,Is,Ns,Us,Fs,Ls,qs,zs,Es,Os,Ms,$s,Ts,Hs,Qs,As,Js,Ks,Vs,Gs,Ps,Ws,Xs,Ys,Zs,eo,_o,to,io){"use strict";class co{constructor(e,_=null){this.onBoltRefresh=()=>{this.logRefresh(),this.isDisconnected=!0,this.handleBoltRefresh()},this.logRefresh=()=>{this.isDisconnected||c.browseClientMetrics.newRefreshTriggered()},this.onBoltUpdate=()=>{this.isDisconnected&&(this.isDisconnected=!1,c.browseClientMetrics.newRefreshCompleted()),this.handleUpdate&&this.handleUpdate()},this.updateBoltClient=(e=!1)=>{const _=this.boltData.map((e=>new t.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)));_.length>0&&(!this.boltClient||e?(this.boltClient=new t.BoltClient(_,this.onBoltUpdate,this.onBoltRefresh),this.boltClient.start(),this.boltClient.setSuccessMinimumDelay(5)):this.boltClient.clearAndUpdateStates(_))},this.userId=e,this.status=t.BrowseBoltClientStatus.NotReady,this.boltData=[],this.rootNamespaceIdentifier=_}isReady(){return this.status!==t.BrowseBoltClientStatus.NotReady}setInitialBoltData(e){this.boltData=e,this.status=t.BrowseBoltClientStatus.NotLive,c.browseClientMetrics.namespaceCount(e.length)}fetchInitialBoltData(){const e=new t.UserApiV2Client,_=null!==this.rootNamespaceIdentifier?{current_ns_id:this.rootNamespaceIdentifier}:{};return e.ns("files").rpc("get_browse_bolt_data",_,{subjectUserId:this.userId}).then((e=>{void 0===e.bolt_token_response&&i.reportException({err:new Error("Receive empty bolt token response from /get_browse_bolt_data"),severity:"non-critical",tags:["js:browse"]});const _=e.bolt_token_response||[],t=[];_.forEach((e=>{t.push({bolt_token:e.bolt_token||"",bolt_unique_id:e.bolt_unique_id||"",latest_sjid:(e.latest_sjid||0).toString()})})),this.setInitialBoltData(t)}),(e=>{var _;let c=(null===(_=e.raw)||void 0===_?void 0:_.status)||0;c>=400&&c<500&&this.setInitialBoltData([]),this.status=t.BrowseBoltClientStatus.NotReady,i.reportException({err:new Error("Error getting bolt data from /get_browse_bolt_data"),severity:"non-critical",tags:["js:browse"]})}))}handleUpdateBoltClient(e){const _=this.boltData.length-e.length;c.browseClientMetrics.namespaceCountChange(_),this.boltData=e,this.updateBoltClient()}getNsMap(){const e={};return this.boltData.forEach((_=>{e[_.bolt_unique_id]=parseInt(_.latest_sjid,10)})),e}startLiveUpdate(e=null){this.isReady()&&(e&&(this.handleUpdate=e),this.updateBoltClient(),this.status=t.BrowseBoltClientStatus.Live)}stopLiveUpdate(){this.status=t.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()}handleBoltRefresh(){this.boltClient&&this.boltClient.unsubscribe(),this.fetchInitialBoltData().then((()=>{this.updateBoltClient(!0),this.status=t.BrowseBoltClientStatus.Live}))}}var so;!function(e){e.ON="ON",e.CONTROL="CONTROL",e.OFF="OFF"}(so||(so={}));const oo=({user:e,path:i,shouldShowDeletedFiles:s,rootNamespaceIdentifier:n,browseLimitBoltScope:a,applyBoltUpdates:r,applyBoltUpdatesForFileExplorer:l})=>{const u=_.React$1.useRef(i),d=_.React$1.useRef(s),p=_.React$1.useRef();return _.React$1.useEffect((()=>{u.current=i,d.current=s})),_.React$1.useEffect((()=>{const _=new co(e.id,n);let i,s=0,m=0,h=!1,g=new c.NonQueuedUpdateSimulator;function f(){if(g.notificationOccurred(),i||h)return h=!0,void m++;s=Date.now(),m=0,h=!1,g.initializeIfNeeded(s),i=t.getChangesForDirectory({path:u.current,userId:e.id,namespaceToJournalIdMap:_.getNsMap(),rootNamespaceIdentifier:null!=n?n:void 0,includeDeletedFiles:d.current,limitScope:a===so.ON,onSuccess:e=>{i=void 0,c.browseHandlerMetrics.recordQueuedLatency(s),c.browseHandlerMetrics.recordNumberRequestsQueued(m),g.queuedUpdateComplete(s),r({path:u.current,updates:e}),l({path:u.current,updates:e}),_.handleUpdateBoltClient(e.bolt_data)},onComplete:()=>{i=void 0,h&&o.defer((()=>{h=!1,f()}))}})}return p.current=t.makeCancelable(t.waitForTTI().then((()=>_.fetchInitialBoltData()))),p.current.then((()=>{_.startLiveUpdate(f)})),()=>{var e;null===(e=p.current)||void 0===e||e.cancel(),g.reset(),_.stopLiveUpdate(),i&&i.abort()}}),[r,l,e]),_.React$1.createElement(_.React$1.Fragment,null)};oo.displayName="BoltHandler";const no={applyBoltUpdates:s.applyBoltUpdates,applyBoltUpdatesForFileExplorer:t.applyBoltUpdates},ao=t.connect((function(e){return{user:t.user(e),path:t.path(e),shouldShowDeletedFiles:t.shouldShowDeletedFiles(e),rootNamespaceIdentifier:t.isInsideBackupFolder(e)?t.context(e).rootNSID:null,browseLimitBoltScope:t.experiments(e).browseLimitBoltScope}}),no)(oo);e.BoltHandler=oo,e.ConnectedBoltHandler=ao}));
//# sourceMappingURL=c_browse_bolt_handler.js-vfl9FApar.map
