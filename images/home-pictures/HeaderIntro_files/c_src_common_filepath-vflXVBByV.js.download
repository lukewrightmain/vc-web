define(["exports","./e_edison","./e_ui_page_files_router","./c_breadcrumb_index","./c_lodash-es_lodash","./c_flows_approval_approval_io_client"],(function(e,t,n,a,i,r){"use strict";const s="request_approval",o="approval_comment",l=e=>{const t=new URLSearchParams(window.location.search);if(0==t.toString().length)return null;const n=t.get(e);return n&&(t.delete(e),t.toString().length>0?window.history.replaceState(null,"","?"+t.toString()+window.location.hash):window.history.replaceState(null,"",window.location.href.split("?")[0]+window.location.hash)),n},c=e=>{const t=new URLSearchParams(window.location.search),n=(e=>({key:o,value:e}))(e);t.set(n.key,n.value),window.history.replaceState(null,"","?"+t.toString()+window.location.hash)};const u=t.React$1.memo((({fileId:e,getApprovalStatus:i,InfoBladeRowComponent:r,onClick:s,logger:o})=>{const[l,u]=t.react.exports.useState(null),[p,h]=t.react.exports.useState(null),d=n.useIntl(),m={pending:d.formatMessage({id:"bxXd24",defaultMessage:"Pending approval"}),approved:d.formatMessage({id:"wtrJLn",defaultMessage:"Approved"}),no_status:null,other:null};if(t.react.exports.useEffect((()=>{let t=!0;return u(null),i(e).then((e=>{var n;const a=null===(n=e.status)||void 0===n?void 0:n[".tag"];if(!a||"pending"!==a&&"approved"!=a)return;const i=e.comment_id;if(i&&t){u(m[a]),h(i)}})),()=>{t=!1}}),[e]),!l||!p)return null;return t.React$1.createElement(r,{title:d.formatMessage({id:"vautul",defaultMessage:"Status"}),data:t.React$1.createElement(a.Breadcrumb,{size:"small"},t.React$1.createElement(a.Breadcrumb.Link,{onClick:()=>{o&&o(l),c(p),s()}},t.React$1.createElement(n.Text,{variant:"paragraph",size:"small"},l)))})}));function p(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:n.getInitials(e.name),public:n.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}u.displayName="ApprovalMetadata";class h{constructor(e,t=!1){this.cache={},this.filterContact=e=>{const t=!!e.group_id,n=!this.allowMentionSelf&&e.email===this.user.email;return!(t||n)},this.updateCache=(e,t,n)=>{let a;const i=t.map(p);if(n){a=[...this.cache[e]||[],...i]}else a=i;return this.cache=Object.assign(Object.assign({},this.cache),{[e]:a}),this.cache},this.user=e,this.allowMentionSelf=t,this.dataSource=new n.ContactsDataSourceV2(e,this.filterContact)}query(e,t,n){this.dataSource.search(e,(n=>{t(this.updateCache(e,n,!1))}),(a=>{(n||t)(this.updateCache(e,a,!0))}))}getMatchesWithStarterSuggestions(){const e=n.BloodhoundContactsV2.getAll(this.user).filter(this.filterContact).map(p),t=i.sortBy(e.slice(0,50),(e=>e.name||e.email));return this.cache=Object.assign(Object.assign({},this.cache),{"":t}),this.cache}}function d(e,t){return e?new h(e,t):{cache:{},query:()=>{},getMatchesWithStarterSuggestions:()=>({})}}const m={client:null,subscribe({app_id:e,revision:t,token:a,unique_id:i},r,s){const o=new n.SignedChannelState(e,i,t,a);m.client?m.client.update_states([o]):(m.client=new n.BoltClient([o],r,s),m.client.start())},unsubscribe(){m.client&&(m.client.unsubscribe(),m.client=null)}};function g(e){return e?("/"!==e.charAt(0)&&(e=`/${e}`),"/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e):""}function f(e){return e.split("/").slice(0,-1).join("/")||"/"}e.ApprovalMetadata=u,e.dbxUserToIUser=function(e){return{id:e.account_id,name:{display:e.display_name,initials:n.getInitials(e.display_name),public:n.getShortName(e.display_name)},photoUrl:e.photo_circle_url}},e.file_extension=function(e){return function(e){if(!e)return{name:"",ext:""};const t=e.split("."),n=e.length>0&&"."===e[0];let a=e.indexOf(".")<0;n&&(a=t.length<=2);const i=t.pop();return i&&!a?{name:t.join("."),ext:i}:{name:e,ext:""}}(e).ext.toLowerCase()},e.filename=function(e,t){const n=(e=g(e)).split("/").pop();return n||(t||"Dropbox")},e.getApprovalCommentId=()=>l(o),e.isRequestApproval=()=>{const e={key:s,value:"1"};return l(s)===e.value},e.isVersioningMVPEnabled=e=>"MVP"===e,e.makeComments2Client=function(e){let t;if(e){let n=null;const a=()=>{const t=d(e);return{search(e,n){0!==e.length?t.query(e,n):n(t.getMatchesWithStarterSuggestions())}}};t=()=>(n||(n=a()),n)}return{boltIOClient:(e=>{let t=e=>{};return{subscribe:n=>(n.forEach((n=>{e.subscribe(function({channelId:e,revisionInfo:t}){return{app_id:e.appId,unique_id:e.uniqueId,revision:t.revision.toString(),token:t.token}}(n),t,t)})),Promise.resolve()),unsubscribe:()=>Promise.resolve(e.unsubscribe()),onSignal:e=>{t=t=>{const n=t.map((e=>{return{channelId:{appId:(t=e).app_id,uniqueId:t.unique_id},revisionInfo:{revision:parseInt(null!==(n=t.revision)&&void 0!==n?n:"",10),token:t.token}};var t,n}));e({updatedChannels:n})}}}})(m),mentionsIOClient:t,approvalIOClient:e?r.approvalIOClient(e.id):void 0}},e.mentionsApi=d,e.normalize=g,e.parentDirName=function(e){const t=e.split("/");return t.length>1?t[t.length-2]:""},e.parent_dirs=function(e){const t=[];let n=f(e);for(;"/"!==n;)t.push(n),n=f(n);return t},e.useTooltipPlacement=function(){const[e,n]=t.react.exports.useState("top"),a=t.react.exports.useCallback((e=>{n(e)}),[n]);return{placement:e,onChangePlacement:a}}}));
//# sourceMappingURL=c_src_common_filepath.js-vfls7V2bb.map
