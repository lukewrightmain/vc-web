define(["exports","./e_edison","./e_ui_page_files_router","./c_tslib","./c_docsend_analytics_add_on_data_apiUtils","./c_controls_index","./c_core_i18n","./c_docsend_analytics_add_on_components_snackbar_utils","./c_docsend_src_utils","./c_csrf","./c_table_index","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_notify","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/core/langpack","./c_ui-icon_line_arrow-down","./c_ui-icon_line_arrow-up"],(function(e,t,a,i,s,n,l,r,c,o,d,m,f,_,u,g,p,v,E,h,y,R,b,w,k,$,x,N,M,T,S,D,A,C,L,I,V,O,P,U,B,F,j,K){"use strict";var z,W;!function(e){e.UNKNOWN="UNKNOWN",e.UNABLE_TO_GET_PLAN_STATUS="UNABLE_TO_GET_PLAN_STATUS"}(z||(z={})),function(e){e.PROVISIONED="PROVISIONED",e.NONE="NONE"}(W||(W={}));var q;!function(e){e.UNKNOWN="UNKNOWN"}(q||(q={}));a.injectInternalStyle("metaserver/static/js/docsend_analytics_add_on/components/docsend_analytics_add_on_modal.module.out.css",(e=>"._ds-analytics-header_1pfff_2{align-items:center;display:flex;font-size:16px;gap:var(--spacing__base_unit);line-height:26px}._ds-analytics-header-filename_1pfff_10{font-size:16px;font-weight:500;line-height:26px}._divider_1pfff_16{background-color:var(--color__faint__border);flex:none;flex-grow:0;height:1px;order:0;width:652px}._spinner-container_1pfff_25{align-items:center;display:flex;height:400px;justify-content:center;width:100%}._spinner-with-text_1pfff_33{display:flex;flex-direction:row;gap:var(--spacing__base_unit)}._spinner-text_1pfff_39{font-size:16px;font-weight:500}._modal-content_1pfff_44{gap:var(--spacing__unit--3)}._modal-content_1pfff_44,._tos-section_1pfff_50{display:flex;flex-direction:column}._tos-section_1pfff_50{gap:var(--spacing__unit--2_5)}._tos-heading_1pfff_56{display:flex;flex-direction:column;gap:var(--spacing__base_unit)}._tos-title_1pfff_62{font-size:16px;font-weight:500;line-height:24px}._tos-checkbox-section_1pfff_68{display:flex;flex-direction:row;gap:var(--spacing__base_unit)}._tos-error_1pfff_74{margin-bottom:var(--spacing__unit--0_5)!important}._link-section_1pfff_78{display:flex;flex-direction:column;gap:var(--spacing__unit--2)}._link-permission_1pfff_84{font-weight:500}._link-options_1pfff_88{gap:var(--spacing__unit--1_5)}._link-details_1pfff_94,._link-options_1pfff_88{display:flex;flex-direction:row}._link-details_1pfff_94{align-items:center;gap:18px}._link-area_1pfff_101{height:40px;width:544px}._summary-analytics-section_1pfff_106{display:flex;flex-direction:column;gap:var(--spacing__unit--2_5);max-height:100px}._summary-analytics-data_1pfff_113{display:grid;grid-template-columns:2fr 3fr 3fr 4fr}._summary-analytics-data_1pfff_113,._summary-analytics-data-image_1pfff_120{padding-left:var(--spacing__unit--2);padding-right:var(--spacing__unit--2)}._summary-analytics-data-image_1pfff_120{display:flex;flex-direction:row;justify-content:space-around}._summary-analytics-data-image_1pfff_120>div,._summary-analytics-data_1pfff_113>div{display:grid;row-gap:var(--spacing__base_unit)}._summary-data-label_1pfff_134{color:var(--color__faint__text)}._top-pages-chart_1pfff_138{align-items:end;column-gap:var(--spacing__unit--1_5);display:grid;grid-auto-flow:column;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(2,auto);justify-items:center;row-gap:var(--spacing__unit--0_5)}._chart-bar_1pfff_149{background:var(--color__attention__background);cursor:default;width:40px}._chart-bar_1pfff_149:hover:before,._chart-bar_1pfff_149:not(:focus):before{background-color:unset;transition:unset}._chart-label_1pfff_161{color:var(--color__faint__text)}._visit-analytics-section_1pfff_165{display:flex;flex-direction:column;gap:var(--spacing__unit--2_5);min-height:75px}._visit-analytics-table_1pfff_172{display:flex;margin-bottom:var(--spacing__unit--3);max-height:350px;overflow-y:auto}._visit-analytics-table-header_1pfff_179{background-color:var(--color__elevated__background);position:-webkit-sticky;position:sticky;top:0}._visit-count-section_1pfff_185{margin-left:var(--spacing__unit--2)}._visit-count_1pfff_185{font-size:20px;font-weight:500;line-height:30px}._name-cell_1pfff_195{align-items:center;display:flex;flex-direction:row;gap:10px}._email-box_1pfff_202{display:flex;flex-direction:column;gap:2px}._email_1pfff_202{font-size:14px;font-weight:400;line-height:18px}._disabled-text_1pfff_214{color:var(--color__disabled__text)}._document-version-container_1pfff_218{align-items:center;display:flex;flex-direction:row;gap:var(--spacing__base_unit)}._onboarding-image_1pfff_225{align-items:center;background-color:var(--color__attention__background);display:flex;justify-content:center;margin-bottom:var(--spacing__unit--3);padding:var(--spacing__unit--3)}._onboarding-image_1pfff_225>img{display:block}._teams-close-button_1pfff_238{margin-left:auto}._teams-survey-slide-content_1pfff_242{width:100%}._teams-survey-subtext_1pfff_246{margin-bottom:var(--spacing__unit--3)!important}._teams-survey-question-label_1pfff_250{height:auto!important;margin-bottom:var(--spacing__unit--1_5)}._teams-survey-checkbox-row_1pfff_255{display:flex;margin-bottom:var(--spacing__unit--2_5);margin-top:var(--spacing__unit--3)}._teams-survey-checkbox-label_1pfff_261{margin-left:var(--spacing__unit--1_5)}._teams-survey-empty-form-error_1pfff_265{margin-top:var(--spacing__unit--3)}._teams-survey-select-menu_1pfff_269{display:block;width:100%}._teams-survey-select-trigger_1pfff_274{width:100%}._teams-survey-select-trigger-text_1pfff_278{max-width:calc(100% - 28px);overflow:hidden;text-overflow:ellipsis}"));const G="_ds-analytics-header_1pfff_2",H="_ds-analytics-header-filename_1pfff_10",X="_divider_1pfff_16",J="_spinner-container_1pfff_25",Y="_spinner-with-text_1pfff_33",Z="_spinner-text_1pfff_39",Q="_modal-content_1pfff_44",ee="_tos-section_1pfff_50",te="_tos-heading_1pfff_56",ae="_tos-title_1pfff_62",ie="_tos-checkbox-section_1pfff_68",se="_tos-error_1pfff_74",ne="_link-section_1pfff_78",le="_link-permission_1pfff_84",re="_link-options_1pfff_88",ce="_link-details_1pfff_94",oe="_link-area_1pfff_101",de="_summary-analytics-section_1pfff_106",me="_summary-analytics-data_1pfff_113",fe="_summary-analytics-data-image_1pfff_120",_e="_summary-data-label_1pfff_134",ue="_top-pages-chart_1pfff_138",ge="_chart-bar_1pfff_149",pe="_chart-label_1pfff_161",ve="_visit-analytics-section_1pfff_165",Ee="_visit-analytics-table_1pfff_172",he="_visit-analytics-table-header_1pfff_179",ye="_visit-count-section_1pfff_185",Re="_visit-count_1pfff_185",be="_name-cell_1pfff_195",we="_email-box_1pfff_202",ke="_email_1pfff_202",$e="_disabled-text_1pfff_214",xe="_document-version-container_1pfff_218",Ne="_onboarding-image_1pfff_225",Me=()=>t.React$1.createElement("div",{className:J,"data-testid":"centered-spinner"},t.React$1.createElement(a.Spinner,null)),Te=({text:e})=>t.React$1.createElement("div",{className:Y,"data-testid":"spinner-with-text"},t.React$1.createElement(a.Spinner,{"aria-valuetext":e,size:"xsmall"}),t.React$1.createElement(a.Text,{className:Z},e)),Se=t.React$1.memo((()=>t.React$1.createElement("div",{className:Ne,"data-testid":"onboarding-image"},t.React$1.createElement("img",{src:t.static_url("/static/metaserver/static/images/docsend_addon/abstract_ui-vflEMii5w.png"),alt:"",width:320,height:286}))));var De;Se.displayName="OnboardingImage",function(e){e.UNABLE_TO_PROVISION_ACCOUNT="UNABLE_TO_PROVISION_ACCOUNT",e.UNABLE_TO_CREATE_LINK="UNABLE_TO_CREATE_LINK"}(De||(De={}));const Ae=({onAcceptedTOS:e,fileId:c,fileExt:o,user:d,entryPoint:m})=>{const[f,_]=t.React$1.useState(!1),[u,g]=t.React$1.useState(!1),p=t.React$1.useMemo((()=>new a.DefaultUserApiV2Client(d)),[d]),[v,E]=t.React$1.useState(!1),h=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){if(!f)return g(!0),void a.ProEventsLogger.log("docsend_analytics_add_on_failed_to_accept_tos",{fileExt:o,entryPoint:m});E(!0);if(yield s.provisionAccount(p,m)){const t=yield s.getOrCreateLink(p,c,o,m);t||r.showSnackbar("fail",l.intl.formatMessage({id:"LGBKXL",defaultMessage:"There was a problem creating this link."})),e(null==t?void 0:t.link,null==t?void 0:t.file_has_newer_version,null==t?void 0:t.file_hlc_unix_micros)}else r.showSnackbar("fail",l.intl.formatMessage({id:"y6HA13",defaultMessage:"There was a problem provisioning your account."}));E(!1)}))),[p,c,e,m,o,g,f]),y=t.React$1.useCallback((()=>{_((e=>!e)),g(!1)}),[]);return t.React$1.createElement("div",{className:ee,"data-testid":"terms-of-service-section"},v?t.React$1.createElement(Te,{text:l.intl.formatMessage({id:"R6/Bzs",defaultMessage:"Creating link..."})}):t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement("div",{className:X}),t.React$1.createElement("div",{className:te},t.React$1.createElement(a.Title,{className:ae}," ",l.intl.formatMessage({id:"xt9dt6",defaultMessage:"Try analytics in Dropbox"})," "),t.React$1.createElement(a.Text,null,l.intl.formatMessage({id:"vH5eUV",defaultMessage:"Get page-by-page viewer insights for the documents you share using Dropbox."}))),t.React$1.createElement("div",null,t.React$1.createElement("div",{className:ie},t.React$1.createElement(n.Checkbox,{checked:f,onChange:y,"data-testid":"terms-of-service-checkbox",autoFocus:!0}),t.React$1.createElement(a.Text,null,l.intl.formatMessage({id:"yAx7CP",defaultMessage:"I agree to <link1>DocSend Terms</link1> and <link2>Privacy Policy</link2>. We’ll create a DocSend account with your Dropbox email address. If you have an existing DocSend account, we will create a separate account to power the analytics feature. This new account will be linked across platforms."},{link1:e=>t.React$1.createElement(a.Link,{rel:"noreferrer",target:"_blank",hasNoUnderline:!0,href:"https://www.docsend.com/terms-of-service/",key:"terms"},e),link2:e=>t.React$1.createElement(a.Link,{rel:"noreferrer",target:"_blank",hasNoUnderline:!0,href:"https://www.docsend.com/privacy-policy/",key:"privacy-policy"},e)}))),u&&t.React$1.createElement(a.Text,{tagName:"p",className:se,color:"error","data-testid":"tos-error"},l.intl.formatMessage({id:"q02yFP",defaultMessage:"Please agree to the terms of service."}))),t.React$1.createElement("div",null,t.React$1.createElement(a.Button,{variant:"primary",size:"large",onClick:h,"data-testid":"terms-of-service-button"},l.intl.formatMessage({id:"bElaaI",defaultMessage:"Get 30 days free access"})))))};var Ce;!function(e){e.UNABLE_TO_CREATE_LINK="UNABLE_TO_CREATE_LINK"}(Ce||(Ce={}));const Le=({apiV2Client:e,fileId:n,fileExt:c,link:o,hasNewerFileVersion:d,fileTimestampMicro:m,entryPoint:f})=>{const[_,u]=t.React$1.useState(!1),[g,p]=t.React$1.useState(!d),[v,E]=t.React$1.useState(!1),[h,y]=t.React$1.useState(m?m/1e3:void 0),R=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){u(!0);const t=yield s.updateDocument(e,n,c,f,o);t?(y((t.file_hlc_unix_micros||0)/1e3),E(!0),p(!0)):r.showSnackbar("fail",l.intl.formatMessage({id:"DQ80ri",defaultMessage:"There was a problem updating this link"})),u(!1)}))),[]);if(_)return t.React$1.createElement("div",{className:xe,"data-testid":"loading-latest-version"},t.React$1.createElement(Te,{text:l.intl.formatMessage({id:"FJY4Sn",defaultMessage:"Loading latest version..."})}));if(!g)return t.React$1.createElement("div",{className:xe,"data-testid":"update-document-banner"},t.React$1.createElement(a.UIIcon,{src:a.WarningLine,size:"small"}),t.React$1.createElement(a.Text,null,l.intl.formatMessage({id:"gpZE8T",defaultMessage:"There is a new version of this file. Update it so viewers can see your latest changes."})),t.React$1.createElement(a.Button,{variant:"transparent",onClick:R,"data-testid":"update-button"},l.intl.formatMessage({id:"OwaQ5z",defaultMessage:"Update"})));if(!h||!v)return null;const b=new Date(h),w=b.toLocaleDateString(),k=b.toLocaleTimeString();return t.React$1.createElement("div",{className:xe,"data-testid":"latest-version-banner"},t.React$1.createElement(a.UIIcon,{src:a.CheckmarkCircleLine,size:"small",color:"var(--color__faint__text)"}),t.React$1.createElement(a.Text,{color:"faint"},l.intl.formatMessage({id:"gSpGZq",defaultMessage:"Latest version. Last updated on {date} at {time}."},{date:w,time:k})))},Ie=({onUpdatedLink:e,link:n,fileId:o,user:d,fileExt:m,didDeleteLink:f,onShowDeleteLinkModal:_,hasNewerFileVersion:u,fileTimestampMicro:g,entryPoint:p})=>{const v=t.React$1.useMemo((()=>new a.DefaultUserApiV2Client(d)),[d]),[E,h]=t.React$1.useState(!1),[y,R]=t.React$1.useState(void 0),b=t.React$1.useRef(null),w=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){h(!0);const t=yield s.getOrCreateLink(v,o,m,p);t?(R(void 0),e(t.link)):(R(Ce.UNABLE_TO_CREATE_LINK),r.showSnackbar("fail",l.intl.formatMessage({id:"Uwmac/",defaultMessage:"There was a problem creating or getting this link"}))),h(!1)}))),[v,o,e,m]),k=t.React$1.useCallback((()=>{var e;const t=c.getLinkIdFromLink(n);navigator.clipboard.writeText(null===(e=b.current)||void 0===e?void 0:e.textContent).then((()=>{a.ProEventsLogger.log("docsend_analytics_add_on_copy_link_success",{fileExt:m,linkId:t,entryPoint:p}),r.showSnackbar("complete",l.intl.formatMessage({id:"hdfAQY",defaultMessage:"Link copied. Allows viewing."}))})).catch((()=>{a.ProEventsLogger.log("docsend_analytics_add_on_copy_link_failure",{fileExt:m,linkId:t,entryPoint:p}),r.showSnackbar("fail",l.intl.formatMessage({id:"g71D9h",defaultMessage:"There was a problem copying this link"}))}))}),[m]),$=t.React$1.useCallback((()=>{const e=c.getLinkIdFromLink(n);a.ProEventsLogger.log("docsend_analytics_add_on_manually_copy_link_success",{fileExt:m,linkId:e,entryPoint:p}),r.showSnackbar("complete",l.intl.formatMessage({id:"hdfAQY",defaultMessage:"Link copied. Allows viewing."}))}),[m]),x=t.React$1.useCallback((()=>{_()}),[_]);return t.React$1.useEffect((()=>{n?h(!1):(w(),h(!0))}),[n,w]),E?t.React$1.createElement("div",{className:ne,"data-testid":"link-section"},t.React$1.createElement(Te,{text:l.intl.formatMessage({id:"R6/Bzs",defaultMessage:"Creating link..."})})):y||f?t.React$1.createElement("div",{className:ne,"data-testid":"link-section"},t.React$1.createElement("div",{className:ce},t.React$1.createElement(a.Button,{variant:"primary",onClick:w,"data-testid":"create-link-button",autoFocus:!0},l.intl.formatMessage({id:"JalrqG",defaultMessage:"Create shareable link"})))):t.React$1.createElement("div",{className:ne,"data-testid":"link-section"},t.React$1.createElement(a.Text,null,l.intl.formatMessage({id:"fZek45",defaultMessage:"Copy and share this link to get page-by-page viewer insights for your document."})," "),t.React$1.createElement(Le,{hasNewerFileVersion:u,fileTimestampMicro:g,apiV2Client:v,fileId:o,fileExt:m,link:n,entryPoint:p}),t.React$1.createElement("div",{className:ce,"data-testid":"link-details-section"},t.React$1.createElement(a.TextArea,{"aria-labelledby":l.intl.formatMessage({id:"FGPqKs",defaultMessage:"Link textbox"}),ref:b,onCopy:$,className:oe,readOnly:!0,value:n,"data-testid":"link-text-area"}),t.React$1.createElement(a.Button,{variant:"primary",size:"large",onClick:k,"data-testid":"copy-link-button",autoFocus:!0},l.intl.formatMessage({id:"fMWfC+",defaultMessage:"Copy link"}))),t.React$1.createElement("div",{className:re},t.React$1.createElement(a.Text,null," ",l.intl.formatMessage({id:"ohyMJi",defaultMessage:"Anyone with this link "})," ",t.React$1.createElement(a.Text,{className:le}," ",l.intl.formatMessage({id:"X8/J/n",defaultMessage:"can view "}))," ",l.intl.formatMessage({id:"VIfxi5",defaultMessage:"this document"})," "),t.React$1.createElement(a.Button,{"data-testid":"delete-link-button",variant:"transparent",onClick:x},l.intl.formatMessage({id:"peEHe5",defaultMessage:"Delete link"}))))};class Ve extends t.React$1.Component{constructor(e){super(e),this.triggerSubmit=()=>{this.form.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))},this.handleSubmit=e=>{if(e.preventDefault(),"function"!=typeof this.form.submit)throw new Error("Form has child element with name or id submit overwriting submit function");o.assertDropboxDomain(this.form.action);let t="";"POST"===this.props.method.toUpperCase()&&(t=o.readCsrfToken()||""),this.setState({csrf:t},(()=>{let e=!1;this.props.handleSubmit&&(e=this.props.handleSubmit(new FormData(this.form))),e||this.form.submit(),setTimeout((()=>this.setState({csrf:""})),0)}))},this.checkValidity=()=>this.form.checkValidity(),this.setFormAction=e=>{this.form.action=e},this.state={csrf:""}}render(){return t.React$1.createElement("form",{ref:e=>{this.form=e},action:this.props.action,method:this.props.method,onSubmit:this.handleSubmit,target:this.props.target||"_self"},""!==this.state.csrf&&t.React$1.createElement("input",{type:"hidden",name:"t",value:this.state.csrf}),this.props.children)}}Ve.displayName="DropboxForm";class Oe extends t.React$1.Component{constructor(e){super(e),this.handleSubmit=e=>{e.set("is_xhr","true");const t=new XMLHttpRequest;return t.onreadystatechange=()=>{t.readyState===XMLHttpRequest.DONE&&this.props.responseDone&&this.props.responseDone(t)},t.open("POST",this.props.action),t.setRequestHeader("Content-Type","multipart/form-data"),t.send(e),!1}}render(){return t.React$1.createElement(Ve,{action:this.props.action,method:"POST",handleSubmit:this.handleSubmit},this.props.children)}}Oe.displayName="DropboxLegacyAjaxForm";const Pe=({daysRemaining:e,stormcrowVariant:i,fileId:s,filePath:n,user:r,fileExt:o,entryPoint:d,link:m})=>{const[f,_]=t.React$1.useState(!0),u=t.React$1.useCallback((()=>{_(!1)}),[_]),g=`https://${document.location.host.replace(/^www./g,"")}${a.get_browse_root(r)}${n}?analytics_file_id=${s}&plan_upgraded=true`,p=c.getUpgradeURL(null!=i?i:"",g),v=t.React$1.useCallback((()=>(a.ProEventsLogger.log("docsend_analytics_add_on_upgrade_button_click",{daysRemaining:e,stormcrowVariant:i,fileExt:o,entryPoint:d,linkId:c.getLinkIdFromLink(m)}),!1)),[e,i,o,d,m]);return void 0!==e&&f?e>5?t.React$1.createElement(a.Banner,{type:"attention",withLeftIcon:!1,withCloseButton:"Close",onRequestClose:u,"data-testid":"upgrade-banner-attention"},t.React$1.createElement(a.Banner.Message,null,l.intl.formatMessage({id:"XFu8X8",defaultMessage:"You have {daysRemaining, number} days to access analytics. Add analytics to your Dropbox plan now."},{daysRemaining:e})),t.React$1.createElement(a.Banner.Actions,null,t.React$1.createElement(Ve,{action:p,method:"post",handleSubmit:v},t.React$1.createElement(a.Button,{variant:"transparent","data-testid":"upgrade-button"},l.intl.formatMessage({id:"sOfbLs",defaultMessage:"Upgrade"}))))):e>0?t.React$1.createElement(a.Banner,{type:"warning",withLeftIcon:!1,withCloseButton:"Close",onRequestClose:u,"data-testid":"upgrade-banner-warning"},t.React$1.createElement(a.Banner.Message,null,l.intl.formatMessage({id:"8egoWm",defaultMessage:"You will lose access to analytics in {daysRemaining, plural, one {# day} other {# days}}. Add it to your Dropbox plan now."},{daysRemaining:e})),t.React$1.createElement(a.Banner.Actions,null,t.React$1.createElement(Ve,{action:p,method:"post",handleSubmit:v},t.React$1.createElement(a.Button,{variant:"transparent"},l.intl.formatMessage({id:"sOfbLs",defaultMessage:"Upgrade"}))))):t.React$1.createElement(a.Banner,{variant:"rich",type:"alert",withLeftPictogram:null,"data-testid":"upgrade-banner-alert"},t.React$1.createElement(a.Banner.Message,null,t.React$1.createElement(a.Title,{size:"small"},l.intl.formatMessage({id:"rfgp7o",defaultMessage:"Your access to analytics has ended"})),t.React$1.createElement(a.Text,null,l.intl.formatMessage({id:"/M90bu",defaultMessage:"Add analytics to your Dropbox plan now to continue getting real-time document analytics and more."}))),t.React$1.createElement(a.Banner.Actions,null,t.React$1.createElement(Ve,{action:p,method:"post",handleSubmit:v},t.React$1.createElement(a.Button,{variant:"outline"},l.intl.formatMessage({id:"XKOnEF",defaultMessage:"Upgrade now"}))))):null};var Ue;!function(e){e.UNKNOWN="UNKNOWN",e.LINK_NOT_FOUND="LINK_NOT_FOUND"}(Ue||(Ue={}));const Be=(e,t)=>e&&t?{numVisitors:e.num_visitors,avgViewTimeMs:e.average_view_time_ms,numDownloads:e.num_downloads,pageViews:t.top_viewed_pages,pageAvgViewTime:t.top_viewed_pages_average_time_ms}:{},Fe=({label:e,value:i,disabled:s})=>t.React$1.createElement("div",null,t.React$1.createElement(a.Text,{className:s?$e:_e,variant:"label",size:"small"},e),t.React$1.createElement(a.Text,{className:s?$e:"",variant:"label",size:"xlarge",isBold:!0,"data-testid":"summary-data-value"},i)),je=({pageViews:e,pageAvgViewTime:i,disabled:s})=>(void 0===e&&(e={}),void 0===i&&(i={}),t.React$1.createElement("div",null,t.React$1.createElement(a.Text,{className:s?$e:_e,variant:"label",size:"small"},l.intl.formatMessage({id:"0upQrV",defaultMessage:"Top pages (latest file version)"})),t.React$1.createElement(Ke,{pageViews:e,pageAvgViewTime:i,disabled:s}))),Ke=({pageViews:e,pageAvgViewTime:i,disabled:s})=>{if(s||0===Object.keys(e).length)return t.React$1.createElement(a.Text,{className:s?$e:"",variant:"label",size:"xlarge",isBold:!0},l.intl.formatMessage({id:"/Eqf0q",defaultMessage:"N/A"}));{const s=Object.keys(i).sort(((e,t)=>i[t]-i[e]));s.length>3&&(s.length=3);const n=s.reduce(((t,a)=>[...t,{pageNum:a,views:e[a],avgViewTime:i[a]}]),[]),r=[];return n.forEach((e=>{const i=qe(e,n),s=e.pageNum,o=c.convertToHumanReadableTime(e.avgViewTime),d=t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Text,{variant:"label",tagName:"p",inverse:!0},l.intl.formatMessage({id:"owVLCX",defaultMessage:"Avg. visit time: {avgViewTime}"},{avgViewTime:o})),t.React$1.createElement(a.Text,{variant:"label",tagName:"p",inverse:!0},l.intl.formatMessage({id:"BXZjTy",defaultMessage:"Views: {views}"},{views:e.views}))),m=t.React$1.createRef();r.push(t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Tooltip,{title:d,triggerRef:m,placement:"bottom"},t.React$1.createElement(a.Button,{variant:"primary",style:{height:`${i}px`},className:ge})),t.React$1.createElement(a.Text,{className:pe,variant:"label",size:"xsmall",ref:m},l.intl.formatMessage({id:"4OIiar",defaultMessage:"p. {pageNum}"},{pageNum:s}))))})),t.React$1.createElement("div",{className:ue,"data-testid":"top-pages-chart"},r)}},ze={numVisitors:0,avgViewTimeMs:0,numDownloads:0,pageViews:{},pageAvgViewTime:{}},We=({fileId:e,fileExt:n,link:o,user:d,disabled:m,entryPoint:f,skip:_})=>{const u=_||m,{isSummaryAnalyticsLoading:g,summaryData:p,summaryDataError:v}=(({fileId:e,fileExt:n,link:l,user:r,skip:c,entryPoint:o})=>{const[d,m]=t.react.exports.useState(!0),[f,_]=t.react.exports.useState({}),[u,g]=t.react.exports.useState(void 0),p=t.react.exports.useMemo((()=>new a.DefaultUserApiV2Client(r)),[r]),v=t.react.exports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){if(l){const[t,a]=yield Promise.all([s.getSummaryAnalytics(p,e,l,n,o),s.getAnalyticsForDocumentVersion(p,e,l,n,o)]);if(void 0===t||void 0===a)g(Ue.UNKNOWN);else{const e=Be(t,a);_(e)}}else a.ProEventsLogger.log("docsend_analytics_add_on_use_summary_analytics_failure",{error:Ue.LINK_NOT_FOUND,fileExt:n,entryPoint:o}),g(Ue.LINK_NOT_FOUND);m(!1)}))),[p,e,l]);return t.react.exports.useEffect((()=>{c||v()}),[v,c]),c?{}:{isSummaryAnalyticsLoading:d,summaryData:f,summaryDataError:u}})({user:d,fileId:e,link:o,skip:u,fileExt:n,entryPoint:f});if(t.React$1.useEffect((()=>{v&&r.showSnackbar("fail",l.intl.formatMessage({id:"ixxWOz",defaultMessage:"There was a problem getting summmary analytics."}))}),[v]),g)return t.React$1.createElement("div",{className:de},t.React$1.createElement("div",{className:X}),t.React$1.createElement(Me,null));const E=m||!!v,h=u||E?ze:p;return t.React$1.createElement("div",{className:de},t.React$1.createElement("div",{className:X}),t.React$1.createElement("div",{className:c.isImage(n)?fe:me,"data-testid":"summary-analytics-data"},t.React$1.createElement(Fe,{label:l.intl.formatMessage({id:"Ju+Xsr",defaultMessage:"Viewers"}),value:null==h?void 0:h.numVisitors,disabled:E}),t.React$1.createElement(Fe,{label:l.intl.formatMessage({id:"apw/4g",defaultMessage:"Avg. visit time"}),value:c.convertToHumanReadableTime(null==h?void 0:h.avgViewTimeMs),disabled:E}),t.React$1.createElement(Fe,{label:l.intl.formatMessage({id:"31KJBU",defaultMessage:"Downloads"}),value:null==h?void 0:h.numDownloads,disabled:E}),!c.isImage(n)&&t.React$1.createElement(je,{pageViews:null==h?void 0:h.pageViews,pageAvgViewTime:null==h?void 0:h.pageAvgViewTime,disabled:E})))},qe=(e,t)=>{const a=Math.floor(24*e.avgViewTime/t[0].avgViewTime);return Math.max(a,6)};var Ge,He;!function(e){e.UNKNOWN="UNKNOWN",e.LINK_NOT_FOUND="LINK_NOT_FOUND",e.GET_MORE_VISIT_DATA_FAILED="GET_MORE_VISIT_DATA_FAILED"}(Ge||(Ge={})),function(e){e.EMAIL="email",e.DATE="date",e.VIEW_TIME="view_time",e.PERCENT_VIEWED="percent_viewed",e.NONE="none"}(He||(He={}));const Xe=e=>!!(e.totalCount&&e.visits&&e.visits.length<e.totalCount),Je=(e,t,a,n,l,r,c,o,d,m)=>i.__awaiter(void 0,void 0,void 0,(function*(){const i=t;let f=m;if(!i.totalCount||!i.visits)return;let _=1,u=i.totalCount-i.visits.length;for(;u>0;){_++;const t=yield s.getVisitAnalytics(e,a,n,l,d,_,o,f);if(!t){c(Ge.GET_MORE_VISIT_DATA_FAILED);break}{const e=at(t);if(!e.visits)break;i.visits=[...i.visits,...e.visits],i.cursor=e.cursor,f=i.cursor,u-=e.visits.length}}r(i)})),Ye=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>e.email.localeCompare(t.email))),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>t.email.localeCompare(e.email))),Object.assign({},e)}return e},Ze=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>new Date(e.occurredAt).getTime()-new Date(t.occurredAt).getTime())),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>new Date(t.occurredAt).getTime()-new Date(e.occurredAt).getTime())),Object.assign({},e)}return e},Qe=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>e.timeSpentMs-t.timeSpentMs)),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>t.timeSpentMs-e.timeSpentMs)),Object.assign({},e)}return e},et=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>tt(e.numPagesViewed,e.totalPages)-tt(t.numPagesViewed,t.totalPages))),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>tt(t.numPagesViewed,t.totalPages)-tt(e.numPagesViewed,e.totalPages))),Object.assign({},e)}return e},tt=(e,t)=>e&&t?Math.ceil(e/t*100):0,at=e=>{return e?{cursor:e.cursor,pageSize:e.page_size,totalCount:e.total_count,visits:(t=e.visits,t?t.map((e=>({timeSpentMs:e.time_spent_ms,occurredAt:e.occurred_at,email:e.email,visitorName:e.visitor_name,numPagesViewed:e.num_pages_viewed,totalPages:e.total_pages,downloaded:e.downloaded,documentVersion:e.document_version}))):[])}:{};var t},it=({email:e,initials:i,disabled:s})=>{const n=`${ke} ${$e}`;return t.React$1.createElement("div",{className:be},t.React$1.createElement("div",null,t.React$1.createElement(a.Avatar,{size:"standard",backgroundColor:a.avatarColorForUserIdentifier(i),isInactive:s},s?"":i)),t.React$1.createElement("div",{className:we},t.React$1.createElement(a.Text,{"data-testid":"email-text",className:s?n:ke},e)))},st=({visit:e,index:i,disabled:s,hidePercentViewed:n})=>{let r="";if(e.occurredAt){const t=new Date(e.occurredAt);r=isNaN(t.getTime())?e.occurredAt:t.toLocaleDateString()}const o=ot(e.numPagesViewed,e.totalPages);return t.React$1.createElement(d.Table.Row,{key:i,"data-testid":`row-${i}`},t.React$1.createElement(d.Table.Cell,null,t.React$1.createElement(it,{email:e.email,initials:dt(e.email),disabled:s})),t.React$1.createElement(d.Table.Cell,null,t.React$1.createElement(a.Text,{"data-testid":"date-text",className:s?$e:""},r)),t.React$1.createElement(d.Table.Cell,null,t.React$1.createElement(a.Text,{"data-testid":"time-spent-text",className:s?$e:""},c.convertToHumanReadableTime(e.timeSpentMs))),!n&&t.React$1.createElement(d.Table.Cell,null,t.React$1.createElement(a.Text,{"data-testid":"percent-viewed-text",className:s?$e:""},l.intl.formatMessage({id:"ZLFg36",defaultMessage:"{percentViewed}%"},{percentViewed:o}))))},nt=()=>{const e={timeSpentMs:0,occurredAt:l.intl.formatMessage({id:"/Eqf0q",defaultMessage:"N/A"}),email:l.intl.formatMessage({id:"GrD0Fp",defaultMessage:"Email address"}),numPagesViewed:0,totalPages:0,downloaded:!1,documentVersion:0};return t.React$1.createElement("div",{className:ve,"data-testid":"disabled-visit-analytics"},t.React$1.createElement("div",{className:X}),t.React$1.createElement(lt,{numVisits:0,disabled:!0}),t.React$1.createElement("div",{className:Ee},t.React$1.createElement(d.Table,{spacing:"large"},t.React$1.createElement(rt,{disabled:!0}),t.React$1.createElement(d.Table.Body,null,t.React$1.createElement(st,{key:0,visit:e,index:0,disabled:!0})))))},lt=({numVisits:e,disabled:i})=>t.React$1.createElement("div",{className:ye,"data-testid":"visit-count-section"},t.React$1.createElement(a.Text,{className:`${Re} ${i?$e:""}`}," ",l.intl.formatMessage({id:"aNjPN4",defaultMessage:"{numVisits, plural, one {# visit} other {# visits}}"},{numVisits:e}))),rt=({disabled:e,changeSortDirection:a,sortState:i,hidePercentViewed:s})=>{const n=t.React$1.useCallback(((e,t)=>t.columnName===e?t.sortDirection:"none"),[]);return t.React$1.createElement(d.Table.Header,{className:he},t.React$1.createElement(d.Table.Row,null,t.React$1.createElement(d.Table.HeaderCell,Object.assign({"data-testid":"email-header",className:e?$e:""},a&&i?{sortDirection:n(He.EMAIL,i),onSort:()=>a(He.EMAIL)}:{}),l.intl.formatMessage({id:"BLNJWZ",defaultMessage:"Email"})),t.React$1.createElement(d.Table.HeaderCell,Object.assign({"data-testid":"date-header",className:e?$e:""},a&&i?{sortDirection:n(He.DATE,i),onSort:()=>a(He.DATE)}:{}),l.intl.formatMessage({id:"U0C7zN",defaultMessage:"Date"})),t.React$1.createElement(d.Table.HeaderCell,Object.assign({"data-testid":"view-time-header",className:e?$e:""},a&&i?{sortDirection:n(He.VIEW_TIME,i),onSort:()=>a(He.VIEW_TIME)}:{}),l.intl.formatMessage({id:"bGYbSG",defaultMessage:"Visit time"})),!s&&t.React$1.createElement(d.Table.HeaderCell,Object.assign({"data-testid":"percent-viewed-header",className:e?$e:""},a&&i?{sortDirection:n(He.PERCENT_VIEWED,i),onSort:()=>a(He.PERCENT_VIEWED)}:{}),l.intl.formatMessage({id:"xFgp/b",defaultMessage:"Percent viewed"}))))},ct=({fileId:e,fileExt:n,link:o,user:m,disabled:f,entryPoint:_,skip:u})=>{var g,p;const v=u||f,{isVisitAnalyticsLoading:E,visitData:h,visitDataError:y,sortVisitData:R}=(({fileId:e,fileExt:n,link:l,cursor:r,pageSize:o,user:d,skip:m,entryPoint:f})=>{const[_,u]=t.react.exports.useState(!0),[g,p]=t.react.exports.useState({}),[v,E]=t.react.exports.useState(void 0),h=t.react.exports.useMemo((()=>new a.DefaultUserApiV2Client(d)),[d]),y=t.react.exports.useCallback(((e,t)=>{var i;switch(e){case He.EMAIL:p(Ye(g,t));break;case He.DATE:p(Ze(g,t));break;case He.VIEW_TIME:p(Qe(g,t));break;case He.PERCENT_VIEWED:p(et(g,t))}a.ProEventsLogger.log(`docsend_analytics_add_on_sort_visit_table_by_${e}_${t}`,{fileExt:n,entryPoint:f,linkId:c.getLinkIdFromLink(l),pageSize:g.pageSize,pageCount:null===(i=g.visits)||void 0===i?void 0:i.length,totalCount:g.totalCount})}),[g]),R=t.react.exports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){if(l){const t=yield s.getVisitAnalytics(h,e,l,n,o,1,f,r);if(t){const i=at(t);p(i),i.totalCount&&a.UserSurvey.trackEvent("viewed_analytics_on_file_shared_with_docsend_analytics_add_on","docsend_analytics_add_on_modal"),Xe(i)&&Je(h,Object.assign({},i),e,l,n,p,E,f,o,t.cursor)}else E(Ge.UNKNOWN)}else a.ProEventsLogger.log("docsend_analytics_add_on_use_visit_analytics_failure",{error:Ge.LINK_NOT_FOUND,fileExt:n,entryPoint:f}),E(Ge.LINK_NOT_FOUND);u(!1)}))),[h,e,l,r,o]);return t.react.exports.useEffect((()=>{m||R()}),[R,m]),m?{}:{isVisitAnalyticsLoading:_,visitData:g,visitDataError:v,sortVisitData:y}})({user:m,fileId:e,link:o,fileExt:n,skip:v,entryPoint:_}),[b,w]=t.React$1.useState({columnName:He.NONE,sortDirection:"none"});t.React$1.useEffect((()=>{if(y){let e=l.intl.formatMessage({id:"niUAOO",defaultMessage:"There was a problem getting visit analytics."});y===Ge.GET_MORE_VISIT_DATA_FAILED&&(e=l.intl.formatMessage({id:"ViJ/ns",defaultMessage:"There was a problem getting more visit analytics."})),r.showSnackbar("fail",e)}}),[y]);const k=t.React$1.useCallback((e=>{switch(b.columnName!==e&&(b.columnName=e,b.sortDirection="none"),b.sortDirection){case"asc":b.sortDirection="desc";break;case"desc":case"none":b.sortDirection="asc"}R&&(R(b.columnName,b.sortDirection),w({columnName:b.columnName,sortDirection:b.sortDirection}))}),[R]);if(f||y&&y!==Ge.GET_MORE_VISIT_DATA_FAILED)return t.React$1.createElement(nt,null);if(E)return t.React$1.createElement("div",{className:ve},t.React$1.createElement("div",{className:X}),t.React$1.createElement(Me,null));const $=(null===(g=null==h?void 0:h.visits)||void 0===g?void 0:g.length)||0;return t.React$1.createElement("div",{className:ve},t.React$1.createElement("div",{className:X}),t.React$1.createElement(lt,{numVisits:$}),$>0&&(null===(p=null==h?void 0:h.visits)||void 0===p?void 0:p.length)?t.React$1.createElement("div",{className:Ee},t.React$1.createElement(d.Table,{spacing:"large","data-testid":"visit-analytics-table"},t.React$1.createElement(rt,{changeSortDirection:k,sortState:b,hidePercentViewed:c.isImage(n)}),t.React$1.createElement(d.Table.Body,null,h.visits.map(((e,a)=>t.React$1.createElement(st,{key:a,visit:e,index:a,hidePercentViewed:c.isImage(n)})))))):null)},ot=(e,t)=>e&&t?Math.ceil(e/t*100):0,dt=e=>e?e.charAt(0).toUpperCase():"",mt=({fileName:e,fileId:n,fileExt:o,link:d,user:m,onCloseDeleteLinkModal:f,entryPoint:_})=>{const[u,g]=t.React$1.useState(!1),p=t.React$1.useMemo((()=>new a.DefaultUserApiV2Client(m)),[m]),v=t.React$1.useCallback((()=>{a.dispatchModalClosed(),f(!1);const e=c.getLinkIdFromLink(d);a.ProEventsLogger.log("docsend_analytics_add_on_delete_link_cancel",{fileExt:o,entryPoint:_,linkId:e})}),[f]),E=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){g(!0),r.showSnackbar("sync",l.intl.formatMessage({id:"3/ldox",defaultMessage:"Deleting link to {fileName}."},{fileName:e}),0);(yield s.deleteLink(p,n,d,o,_))?(r.showSnackbar("complete",l.intl.formatMessage({id:"3qNu/U",defaultMessage:"Deleted link to {fileName}."},{fileName:e})),a.dispatchModalClosed(),f(!0)):r.showSnackbar("fail",l.intl.formatMessage({id:"aIZcFS",defaultMessage:"There was a problem deleting this link."})),g(!1)}))),[p,e,d,n,f]);return t.React$1.useEffect((()=>{a.dispatchModalOpened()}),[]),t.React$1.createElement(a.Modal,{open:!0,isCentered:!0,className:"uxa-modal",id:"docsend_analytics_add_on_delete_link_modal","aria-labelledby":"ds-analytics-delete-link-modal-title","data-testid":"delete-link-modal"},t.React$1.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},t.React$1.createElement(a.Modal.Title,{id:"ds-analytics-delete-link-modal-title"},l.intl.formatMessage({id:"Q9LBuK",defaultMessage:'Delete link to "{fileName}"'},{fileName:e}))),t.React$1.createElement(a.Modal.Body,{hasVerticalSpacing:!0},t.React$1.createElement(a.Text,null,l.intl.formatMessage({id:"ZWg0m3",defaultMessage:"By deleting this link you will lose access to all past analytics. A new link can be created to track future analytics."}))),t.React$1.createElement(a.Modal.Footer,null,t.React$1.createElement(a.Button,{"data-testid":"cancel-button",variant:"opacity",onClick:v,autoFocus:!0},l.intl.formatMessage({id:"q/OeYK",defaultMessage:"Cancel"})),t.React$1.createElement(a.Button,{"data-testid":"delete-link-button",variant:"primary",onClick:E,disabled:u,autoFocus:!0},l.intl.formatMessage({id:"zpwh5R",defaultMessage:"Delete"}))))};mt.displayName="DeleteLinkModal";const ft=({accountStatus:e,link:i,fileId:s,filePath:n,user:l,fileExt:r,accountStatusError:c,didDeleteLink:o,onShowDeleteLinkModal:d,onUpdatedLink:m,hasNewerFileVersion:f,fileTimestampMicro:_,stormcrowVariant:u,entryPoint:g,isNewLink:p})=>{const[v,E]=t.React$1.useState(!1),[h,y]=t.React$1.useState(e.daysRemaining),[R,b]=t.React$1.useState(f),[w,k]=t.React$1.useState(_),$=t.React$1.useRef(null),x=t.React$1.useCallback(((e,t,a)=>{b(t),k(a),m(e),E(!0),y(30)}),[m]);t.React$1.useEffect((()=>{$.current&&(a.dispatchModalOpened(),a.UserSurvey.trackEvent("viewed_docsend_analytics_add_on_modal","docsend_analytics_add_on_modal"))}),[$]);const N=e.isProvisioned||i||v||o,M=!c&&!N,T=!i||o||!e.hasAddOnAccess&&!v,S=(e.isProvisioned||v)&&!e.hasActivePlan;return t.React$1.createElement("div",{className:Q,ref:$},S&&t.React$1.createElement(Pe,{daysRemaining:h,stormcrowVariant:u,fileId:s,filePath:n,user:l,fileExt:r,entryPoint:g,link:i}),N?t.React$1.createElement(Ie,{link:i,onUpdatedLink:m,fileId:s,user:l,fileExt:r,didDeleteLink:o,onShowDeleteLinkModal:d,hasNewerFileVersion:R,fileTimestampMicro:w,entryPoint:g}):M?t.React$1.createElement(Ae,{onAcceptedTOS:x,user:l,fileId:s,fileExt:r,entryPoint:g}):null,M?t.React$1.createElement(Se,null):t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(We,{fileId:s,fileExt:r,user:l,link:i,disabled:T,entryPoint:g,skip:p}),t.React$1.createElement(ct,{fileId:s,fileExt:r,user:l,link:i,disabled:T,entryPoint:g,skip:p})))},_t=({fileName:e,fileId:n,filePath:c,user:o,stormcrowVariant:d,entryPoint:m})=>{var f;const _=a.file_extension(e),[u,g]=t.React$1.useState(!0),{isAccountStatusLoading:p,accountStatus:v,accountStatusError:E}=(({user:e,entryPoint:n})=>{const[l,r]=t.react.exports.useState(!0),[c,o]=t.react.exports.useState({}),[d,m]=t.react.exports.useState(void 0),f=t.react.exports.useMemo((()=>new a.DefaultUserApiV2Client(e)),[e]),_=t.react.exports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){const e=yield s.getPlanStatus(f,n);if(e){const t={hasActivePlan:e.has_active_plan,hasAddOnAccess:e.has_addon_access,daysRemaining:e.trial_days_left,isProvisioned:e.provision_status===W.PROVISIONED};o(t)}else m(z.UNABLE_TO_GET_PLAN_STATUS);r(!1)}))),[f]);return t.react.exports.useEffect((()=>{_()}),[_]),{isAccountStatusLoading:l,accountStatus:c,accountStatusError:d}})({user:o,entryPoint:m}),{isAnalyticsLinkLoading:h,linkData:y,linkDataError:R}=(({skip:e,fileId:n,fileExt:l,user:r,entryPoint:c})=>{const[o,d]=t.react.exports.useState(!0),[m,f]=t.react.exports.useState({}),[_,u]=t.react.exports.useState(void 0),g=t.react.exports.useMemo((()=>new a.DefaultUserApiV2Client(r)),[r]),p=t.react.exports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){const e=yield s.getOrCreateLink(g,n,l,c);e?f({link:null==e?void 0:e.link,hasNewerFileVersion:e.file_has_newer_version,fileTimestampMicro:e.file_hlc_unix_micros,isNewLink:e.is_new_link}):u(q.UNKNOWN),d(!1)}))),[g,n]);return t.react.exports.useEffect((()=>{e||p()}),[p,e]),e?{}:{isAnalyticsLinkLoading:o,linkData:m,linkDataError:_}})({user:o,skip:p||!!E||!v.isProvisioned,fileId:n,fileExt:_,entryPoint:m}),[b,w]=t.React$1.useState(!1),[k,$]=t.React$1.useState(!1),[x,N]=t.React$1.useState(null==y?void 0:y.link),M=t.React$1.useCallback((e=>{N(e),$(!1)}),[]);t.React$1.useEffect((()=>{(null==y?void 0:y.link)&&N(y.link)}),[y]);const T=t.React$1.useCallback((e=>{e&&$(!0),w(!1)}),[]),S=t.React$1.useCallback((()=>{w(!0)}),[]),D=t.React$1.useCallback((()=>{g(!1),a.dispatchModalClosed()}),[]),A=p||h;return t.React$1.useEffect((()=>{(E||R)&&r.showSnackbar("fail",l.intl.formatMessage({id:"CXl2Hh",defaultMessage:"There was a problem completing this request"}))}),[E,R]),b&&x?t.React$1.createElement(mt,{link:x,fileExt:_,fileName:e,fileId:n,user:o,onCloseDeleteLinkModal:T,entryPoint:m}):t.React$1.createElement(a.Modal,{open:u,isCentered:!0,withCloseButton:"Close",className:"uxa-modal",id:"docsend_analytics_add_on_modal",width:700,onRequestClose:D,"aria-labelledby":"ds-analytics-modal-title"},t.React$1.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},t.React$1.createElement(a.Modal.Title,{id:"ds-analytics-modal-title",className:G},t.React$1.createElement("div",null,l.intl.formatMessage({id:"m/4By6",defaultMessage:"Analytics for "}),t.React$1.createElement(a.Text,{className:H},e)),t.React$1.createElement(a.AccessoryBadge,{"data-testid":"beta-badge"},l.intl.formatMessage({id:"QT7EnD",defaultMessage:"Beta"})))),t.React$1.createElement(a.Modal.Body,{hasVerticalSpacing:!0},A?t.React$1.createElement(Me,null):t.React$1.createElement(ft,{accountStatus:v,link:x,hasNewerFileVersion:null==y?void 0:y.hasNewerFileVersion,fileTimestampMicro:null==y?void 0:y.fileTimestampMicro,user:o,fileId:n,filePath:c,fileExt:a.file_extension(e),accountStatusError:E,didDeleteLink:k,onShowDeleteLinkModal:S,onUpdatedLink:M,stormcrowVariant:d,entryPoint:m,isNewLink:null===(f=null==y?void 0:y.isNewLink)||void 0===f||f})))};_t.displayName="DocSendAnalyticsModal";e.showDocsendModal=e=>{(e=>{a.Modal$1.showInstance(t.React$1.createElement(_t,Object.assign({},e)))})(e)}}));
//# sourceMappingURL=c_docsend_analytics_add_on_helpers_modals.js-vfleJLg-E.map
