define(["require","exports","./c_tslib","./e_ui_page_files_router","./c_apex-metrics_src_types","./c_files_view_file_actions_file_from_metadata","./c_history","./c_browse_crypto_subtle_digest","./c_core_i18n","./c_lodash-es_lodash","./e_edison","./c_api_v2_noauth_client","./c_src_sink_index","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/trademark","./c_core_uri"],(function(e,t,o,i,a,s,n,r,d,l,c,p,f,_,u,m,h){"use strict";class S extends a.Message{constructor(e){super(),this.actionSource="",a.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new S).fromBinary(e,t)}static fromJson(e,t){return(new S).fromJson(e,t)}static fromJsonString(e,t){return(new S).fromJsonString(e,t)}static equals(e,t){return a.proto3.util.equals(S,e,t)}}S.runtime=a.proto3,S.typeName="hql_events.WebBrowseSelectRow",S.fields=a.proto3.util.newFieldList((()=>[{no:1,name:"action_source",kind:"scalar",T:9},{no:2,name:"hql_metadata",kind:"message",T:i.HQLMetadata}]));const E=d.intl.formatMessage({id:"A5Lqjf",defaultMessage:"Add a few details about this folder here."});d.intl.formatMessage({id:"ssdefa",defaultMessage:"Can’t save changes. Paste text elsewhere to save, then click Refresh."});const g=d.intl.formatMessage({id:"5dt0hu",defaultMessage:"Can’t save changes. Reload the page and try again."}),T=d.intl.formatMessage({id:"PM6K+P",defaultMessage:"Can’t save changes."});d.intl.formatMessage({id:"9C/lc5",defaultMessage:"Can’t @mention someone in your Personal Dropbox."});const v=d.intl.formatMessage({id:"+dhj1b",defaultMessage:"Can’t @mention someone in your member folder."}),I=d.intl.formatMessage({id:"b7//2e",defaultMessage:"You don’t have permission to share this folder."}),y=i.defineMessage({id:"mjXnuX",defaultMessage:"Pinned to {folderName}"}),F=i.defineMessage({id:"A1Fokf",defaultMessage:"Unpinned from {folderName}"}),O=i.defineMessage({id:"8msMyU",defaultMessage:"Show"});d.intl.formatMessage({id:"HRXOjw",defaultMessage:"opt"}),d.intl.formatMessage({id:"RIxWSs",defaultMessage:"alt"}),d.intl.formatMessage({id:"FL9yea",defaultMessage:"ctrl"}),d.intl.formatMessage({id:"NWv/3R",defaultMessage:"⌘"});const R=d.intl.formatMessage({id:"Kud10T",defaultMessage:"Everyone in this folder can see notes, tasks, and pinned items"}),w=i.defineMessage({id:"xkXFjI",defaultMessage:"Hi {user_name}, I @mentioned you in this folder. Take a look."}),A=i.defineMessage({id:"YzaJIx",defaultMessage:"Hi {user_name}, I @mentioned you in the {folder_name} folder. Take a look."}),N=d.intl.formatMessage({id:"sl5Fj7",defaultMessage:"I @mentioned you in this folder. Take a look."}),M=i.defineMessage({id:"erm7J0",defaultMessage:"I @mentioned you in the {folder_name} folder. Take a look."}),L=[1,0,1],b=i.defineMessage({id:"kh62rs",defaultMessage:"Pin “{name}” to..."}),D=i.defineMessage({id:"oU0z79",defaultMessage:"Pin {num} items to..."}),C=i.defineMessage({id:"BGyZpk",defaultMessage:"You do not have permission to pin to {path}"}),P=i.defineMessage({id:"UD2+LM",defaultMessage:"Can't pin files or folders to a read-only folder"}),k=i.defineMessage({id:"PX5Hq1",defaultMessage:"Deleted {time_ago} by you"}),U=i.defineMessage({id:"7V5b6j",defaultMessage:"Deleted {time_ago} by {name}"}),x=i.defineMessage({id:"oA46AW",defaultMessage:"Updated {time_ago} by you"}),q=i.defineMessage({id:"MP7zas",defaultMessage:"Updated {time_ago} by {name}"}),B=i.defineMessage({id:"PHRYz8",defaultMessage:"Your changes weren’t saved because you and {user} are editing at the same time."}),V=d.intl.formatMessage({id:"tc/4YZ",defaultMessage:"Your changes weren’t saved because you are editing this description elsewhere."}),H=d.intl.formatMessage({id:"4aEgv5",defaultMessage:"Please wait until they’re done before making changes."}),j=d.intl.formatMessage({id:"oYSO1Z",defaultMessage:"Please save your other changes before making them here."}),$=d.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),W=[],z=e=>i.getStateAtNamespace(e,i.FOLDER_OVERVIEW_NAMESPACE_KEY)||i.defaultFolderOverviewState,Y=e=>z(e).folderDataCache,G=e=>z(e).fileIdCache,J=(e,t)=>G(e)[i.normalizePath(t.path)],K=e=>z(e).nsIdCache,Q=(e,t)=>K(e)[i.normalizePath(t.path)],Z=e=>z(e).accountCache,X=e=>z(e).componentDataCache,ee=e=>e.BROWSE&&e.BROWSE.user||i.mkUser(e.SEARCH.user),te=(e,t)=>X(e)[t.componentNamespace],oe=(e,t)=>{const o=J(e,t);return Y(e)[o]},ie=(e,t)=>{const o=oe(e,t);return o?o.sharedFolderPath||t.path:void 0},ae=(e,t)=>{var o;const i=se(e,t);return null!==(o=null==i?void 0:i.userId)&&void 0!==o?o:void 0},se=(e,t)=>{const{descriptionLastModified:o}=oe(e,t)||{};return o},ne=i.createSelector(oe,(e=>e?e.descriptionFormatVersion:void 0)),re=i.createSelector(oe,(e=>{if(e&&e.description)try{return JSON.parse(e.description)}catch(e){return}})),de=i.createSelector(oe,(e=>{if(void 0!==e&&void 0!==e.contentReferences)return 0===e.contentReferences.length?W:i.convertContentReferencesToSortedFiles(e.contentReferences)})),le=i.createSelector(re,i.isEmptyDescription),ce=()=>i.createSelector(te,(e=>{if(!e||0===e.requiredComponents.length)return!1;return 0===e.requiredComponents.filter((t=>!e.loadedComponents.includes(t))).length})),pe=()=>i.createSelector(te,(e=>!!e&&e.hasFailedToLoad)),fe=()=>i.createSelector(J,(e=>e)),_e=i.createSelector(ee,i.convertDbxUserToIUser),ue=()=>i.createSelector(oe,(e=>e?e.loggingFileId:void 0)),me=()=>i.createSelector(de,(e=>e)),he=ce(),Se=pe(),Ee=fe(),ge=ue(),Te=me(),ve=e=>Ee(e,{path:i.path(e)}),Ie=e=>Te(e,{path:i.path(e)}),ye=e=>i.browseLoadingState(e)===i.LoadingState.LOADED?i.sortedFiles(e).count():i.getBrowseState(e).paginatedTotalNumFiles,Fe=i.createSelector(i.context,ye,((e,t)=>e.isInsideVaultFolder&&null!=e.currentNSPath&&i.paths_are_equal(e.currentNSPath,"")&&0===t)),Oe=i.createSelector(i.context,ye,i.experiments,((e,t,o)=>e.isInFamilySharedFolder&&null!=e.currentNSPath&&i.paths_are_equal(e.currentNSPath,"")&&0===t));var Re=Object.freeze({__proto__:null,haveAllComponentsLoaded:e=>he(e,{componentNamespace:i.BrowseFolderOverviewComponentNamespace}),hasFailedToLoad:e=>Se(e,{componentNamespace:i.BrowseFolderOverviewComponentNamespace}),folderOverviewFolderFileId:ve,folderOverviewLoggingFileId:e=>ge(e,{path:i.path(e)}),folderOverviewPinnedItems:Ie,paginatedTotalNumFiles:ye,shouldShowVaultEmptyState:Fe,shouldShowFamilyEmptyState:Oe});const we=new i.UserApiV2Client;class Ae extends i.UserApiV2Client{constructor(e,t){super(t),this.user=e}_headers(e){return this.user.is_cdm_member&&this.user.is_team_admin&&this.user.team_member_id?Object.assign({[p.ApiV2HeaderNames.DropboxApiSelectAdmin]:this.user.team_member_id},super._headers(e)):super._headers(e)}}const Ne=(e,t)=>we.ns("files").rpc("get_description_batch",{file_ids:[t]},{subjectUserId:e}).then((e=>{if(!e||!e.items||1!==e.items.length)throw new Error("Unexpected response from get_description_batch");return e.items[0]})),Me=(e,t)=>we.ns("files").rpc("get_content_references_info",{file_id:t},{subjectUserId:e});class Le extends f.EventEmitter{constructor(){super(),this.setUpdateChannelForType=(e,t)=>{this.signedChannelStates[e]=new i.SignedChannelState(t.appId,t.uniqueId,t.revision,t.token),this.boltClient.update_states(l.values(this.signedChannelStates)),this.boltClient.start()},this.handleUpdate=e=>{const t=[];e.forEach((e=>{const o=l.findKey(this.signedChannelStates,{app_id:e.app_id,unique_id:e.unique_id});o&&!t.includes(o)&&(this.emit("update",{type:o}),t.push(o))}))},this.handleRefresh=()=>{this.boltClient.update_states(l.values(this.signedChannelStates))},this.boltClient=new i.BoltClient([],this.handleUpdate,this.handleRefresh),this.signedChannelStates={}}stop(){this.boltClient.unsubscribe()}}const be=new Le,De=new i.HiveLogger;function Ce(e){return e.blocks.map((e=>e.text.length)).reduce(((e,t)=>e+t),0)}function Pe(e){let t=i.immutable.exports.OrderedSet();return t=t.merge(e.blocks.map((e=>e.type)).filter((e=>"unstyled"!==e))),e.blocks.forEach((e=>e.inlineStyleRanges.forEach((e=>{t=t.add(e.style)})))),e.blocks.forEach((o=>o.entityRanges.forEach((o=>{t=t.add(e.entityMap[o.key].type)})))),t.toArray().sort()}const ke=(e,t)=>{const o=Y(t)[e];return o&&o.contentReferences||[]},Ue=e=>{if(!e)return"";const t=i.sjcl.exports.hash.sha256.hash(e.toLowerCase());return i.sjcl.exports.codec.hex.fromBits(t)},xe=e=>(e||"/").split("/").map(Ue).join("/"),qe=e=>{const t=i.normalize(e).split("/");return Ue(t.pop())},Be=({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a})=>{const s=i.getStoreForFolderOverview().getState(),n=function(e){const t=function(e){const t={all:0,checked:0};return e?(e.blocks.forEach((e=>{"task-block"===e.type&&(t.all+=1,e.data&&e.data.checked&&(t.checked+=1))})),t):t}(e);return{length:e?Ce(e):0,features:e?Pe(e):[],tasks:t.all,checkedTasks:t.checked}}(((e,t)=>{const o=Y(t)[e];if(o&&o.descriptionDraft)try{return JSON.parse(o.descriptionDraft)}catch(e){return}})(e,s)),r=Ve({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a});if(r)return Object.assign(Object.assign({},r),{length:n.length.toString(),formatting:JSON.stringify(n.features),tasks:n.tasks.toString(),checkedTasks:n.checkedTasks.toString(),pins:JSON.stringify(ke(e,s).map((e=>({file_id:e.ns_path?e.file_id:e.ns_id,file_obj_id:e.file_id,resource:{resource_title:qe(e.fq_path),resource_type:e.is_dir?"SFJ_FOLDER":"SFJ_FILE",ns_id:`${e.ns_id}`,resource_path:xe(e.fq_path),resource_namespace_path:xe(e.ns_path)}}))))})},Ve=({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a})=>{const s=i.getStoreForFolderOverview().getState(),n=((e,t)=>{const o=G(t);for(const t in o)if(o[t]===e)return t})(e,s);if(void 0===n)return;const{nsId:r,nsPath:d}=(l=K(s)[n])?{nsId:i.extractSharedFolderId(l),nsPath:i.extractSharedFolderPath(l)}:{};var l;return r?{resource_type:"SFJ_FOLDER",resource_title:qe(n),ns_id:r,resource_path:xe(n),resource_namespace_path:xe(d),file_id:(d?t:r)||null,file_obj_id:e,is_offline:"false",action_surface:o,retrieval_source:a}:void 0},He=(e,t,o,a={})=>{let s={user_id:t,event_name:e};o&&(s=Object.assign(Object.assign({},s),{file_nsid:o.ns_id,file_sjid:o.sjid,file_id:o.file_id,file_name:i.filename(o.fq_path),file_path:o.fq_path,file_extension:o.ext})),De.log(new i.WebUserActionRow(Object.assign(Object.assign({},s),{extra:Object.assign({},a)})))},je=({folderFileId:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(a()).id;i.UserLocalStorage.clearOtherUsers([o]);const s=i.UserLocalStorage.get(o,`folder-overview-${e}`);s&&t(Xe({fileId:e,folderData:s}))})),$e=({componentNamespace:e,component:t})=>({type:i.ActionTypes.ADD_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}}),We=({componentNamespace:e,component:t})=>({type:i.ActionTypes.REMOVE_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}}),ze=({componentNamespace:e,hasFailedToLoad:t})=>({type:i.ActionTypes.SET_FAILED_TO_LOAD,payload:{componentNamespace:e,hasFailedToLoad:t}}),Ye=(e,t,o)=>{const{text:a,latest_revision_id:s,file_obj_id:n,bolt_channel_state:r,format_version:d,last_modified_time:l,last_modified_user:c}=e;if(!n)throw new Error("Unexpected response from Sprinkle");t(Xe({fileId:n,folderData:{description:a,descriptionBaseRevision:s||"",descriptionDraft:void 0,descriptionSaveState:i.DescriptionSaveState.IDLE,descriptionFormatVersion:d,descriptionBoltChannelState:r,descriptionLastUpdated:Date.now()}})),t($e({componentNamespace:o,component:"description"})),t(nt({folderFileId:n,modifiedInfo:{timestamp:l,userId:c},field:"description"})),rt("description",r)},Ge=(e,t,o,i)=>{const a=t.content_references||[],s=t.latest_revision_id,n=t.last_modified_time,r=t.last_modified_user;o(Xe({fileId:e,folderData:{contentReferences:a,contentReferencesRevision:s,contentReferencesBoltChannelState:t.bolt_channel_state,contentReferencesLastUpdated:Date.now()}})),o(nt({folderFileId:e,modifiedInfo:{timestamp:n,userId:r},field:"contentReferences"})),o($e({componentNamespace:i,component:"content_references"})),rt("content_references",t.bolt_channel_state)},Je=({folderFileId:e,componentNamespace:t})=>(i,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(a());try{const a=yield Me(o.id,e);Ge(e,a,i,t)}catch(t){_.reportException({err:t,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}}));function Ke(e){i.Snackbar.complete(d.intl.formatMessage({id:"sz+AhS",defaultMessage:"{count, plural, one{Pinned {count} item.} other{Pinned {count} items.}}"},{count:e}),"folder-overview-pin-current-folder")}const Qe=({folderName:e,onShow:t})=>{i.Snackbar.show(c.react.exports.createElement(i.Snackbar,{title:d.intl.formatMessage(y,{folderName:e}),timeoutDelayMs:5e3,actionButtonText:t?d.intl.formatMessage(O):void 0,closeButtonText:d.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:t?()=>{i.Snackbar.close("folder-overview-pin"),t()}:void 0,id:"folder-overview-pin"}))},Ze=({folderFileId:e,fileIds:t,componentNamespace:i,snackbarConfig:a})=>(s,n)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(null===t||0===t.length)return;const o=ee(n()).id;try{yield((e,t,o)=>we.ns("files").rpc("add_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e}))(o,e,t),a?Qe(a):Ke(t.length),s(Je({folderFileId:e,componentNamespace:i}))}catch(e){_.reportException({err:e,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),Xe=({fileId:e,folderData:t})=>({type:i.ActionTypes.UPDATE_FOLDER_DATA_CACHE,payload:{fileId:e,folderData:t}}),et=({componentNamespace:e,requiredComponents:t})=>({type:i.ActionTypes.SET_REQUIRED_COMPONENTS,payload:{componentNamespace:e,requiredComponents:t}});function tt(e){const t=e.description?d.intl.formatMessage({id:"BV1uZg",defaultMessage:"Folder overview changed."}):d.intl.formatMessage({id:"MLktc7",defaultMessage:"Folder overview added."});i.Snackbar.generic(t,"folder-overview-change")}const ot=e=>!!e&&(e.descriptionSaveState!==i.DescriptionSaveState.CONFLICT&&(e.descriptionSaveState!==i.DescriptionSaveState.SAVING&&i.hasUnsavedDescriptionDraft(e))),it=({path:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(i.paths_are_equal(e,"/"))return;const o=i.normalizePath(e),s=K(a())[o];if(!s)return;const n=G(a())[o],r=ee(a()).id,d=i.extractSharedFolderId(s);if(d)try{const e=yield(({userId:e,sharedFolderId:t})=>we.ns("files").rpc("get_metadata",{path:`ns:${t}`},{subjectUserId:e}).then((e=>e.is_shareable?e.path_display:void 0)))({userId:r,sharedFolderId:d});t(Xe({fileId:n,folderData:{sharedFolderPath:e}}))}catch(e){_.reportException({err:e,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),at=({accountId:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(a());if(!e)return;if(e in Z(a()))return;if(e===o.account_id)return;const s=yield(({userId:e,accountId:t})=>we.ns("users").rpc("get_account",{account_id:t},{subjectUserId:e}))({userId:o.id,accountId:e});t({type:i.ActionTypes.UPDATE_ACCOUNT_CACHE,payload:{accountCache:{[e]:s}}})})),st=({path:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(i.paths_are_equal(e,"/"))return;if(i.paths_are_equal(i.context(a()).currentFQPath,e)&&!i.context(a()).currentNSPath)return;const o=i.normalizePath(e),s=G(a())[o],n=ee(a()).id;try{const e=yield(({userId:e,path:t})=>we.ns("files").rpc("get_metadata",{path:t},{subjectUserId:e}).then((e=>e.id)))({userId:n,path:o});t(Xe({fileId:s,folderData:{loggingFileId:e}}))}catch(e){_.reportException({err:e,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),nt=({folderFileId:e,modifiedInfo:t,field:o})=>(i,a)=>{if(!t.timestamp||!t.userId)return;const s=Y(a())[e];if(!s)return;const n="contentReferences"===o?"contentReferencesLastModified":"descriptionLastModified",r=s[n];(null==r?void 0:r.timestamp)&&t.timestamp<r.timestamp||(i(Xe({fileId:e,folderData:{[n]:t}})),i(at({accountId:t.userId})))},rt=(e,t)=>{if(void 0!==t)try{const{channel_id:o,revision:i,token:a}=t;if(void 0===o||void 0===i||void 0===a)return;const{unique_id:s,app_id:n}=o;if(void 0===s||void 0===n)return;be.setUpdateChannelForType(e,{uniqueId:s,appId:n,token:a,revision:`${i}`})}catch(e){_.reportException({err:e,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}},dt=({folderFileId:e})=>(t,i)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(i()),{last_modified_time:a,last_modified_user:s}=yield Ne(o.id,e);t(nt({folderFileId:e,modifiedInfo:{timestamp:a,userId:s},field:"description"}))})),lt=(e,t,o,i,a)=>o.latest_revision_id?(Ye(o,e,i),!0):(e($e({componentNamespace:i,component:"description"})),e(Xe({fileId:t,folderData:{descriptionBoltChannelState:o.bolt_channel_state,descriptionLastUpdated:a}})),rt("description",o.bolt_channel_state),!1),ct=(e,t,o,i,a,s)=>o.latest_revision_id?(Ge(t,o,e,a),!0):(e(Xe({fileId:t,folderData:{contentReferences:[],contentReferencesBoltChannelState:o.bolt_channel_state,contentReferencesLastUpdated:s}})),e($e({componentNamespace:a,component:"content_references"})),!1),pt=()=>({}),ft=i.getStoreForSharedWith(),_t=e=>({type:i.ActionTypes$1.POP_BOLT_IGNORE,payload:e}),ut=({fqPathsToSelect:e})=>({type:i.ActionTypes$1.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:e}}),mt=({clipboard:e})=>({type:i.ActionTypes$1.SET_CLIPBOARD_FILES,payload:{clipboard:e}}),ht=({context:e})=>({type:i.ActionTypes$1.SET_CONTEXT,payload:{context:e}}),St=({currentFolderInfo:e})=>({type:i.ActionTypes$1.SET_CURRENT_FOLDER_INFO,payload:{currentFolderInfo:e}}),Et=({fileJumpFilter:e})=>({type:i.ActionTypes$1.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:e}}),gt=({filePathsToSelectOnNextUpdate:e})=>({type:i.ActionTypes$1.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:e}}),Tt=({loadingState:e,path:t})=>({type:i.ActionTypes$1.SET_LOADING_STATE,payload:{loadingState:e,path:t}}),vt=({mountPoints:e})=>({type:i.ActionTypes$1.SET_MOUNT_POINTS,payload:{mountPoints:e}}),It=({newFolderCreationState:e})=>({type:i.ActionTypes$1.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:e}}),yt=({paginatedTotalNumFiles:e})=>({type:i.ActionTypes$1.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:e}}),Ft=({path:e="",qargs:t,expandedBlade:o="info",forceExpandRightRail:a=!1})=>(s,r)=>{n.DBHistory.push_state(i.urlPrefix(r())+h.URI.encode_parts(e),l.omitBy(Object.assign(Object.assign({},l.pick(i.getQueryArgs(),["d"])),t),l.isUndefined)),s(wt({skipLogging:!0})),s(bt(o)),a&&s(Lt(!1))},Ot=({path:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){var o;t({type:i.ActionTypes$1.SET_PATH,payload:{path:e}});const s=i.backups(a()),n=yield r.hashString(e);if(n||_.reportException({err:new Error("hashString returned null"),tags:["browse"],severity:u.SEVERITY.NONCRITICAL}),t({type:i.ActionTypes$1.SET_VIEW_SCOPE,payload:{viewScope:n}}),e){const t=null===(o=null==s?void 0:s.find((t=>t.fqPath===e)))||void 0===o?void 0:o.displayName;document.title=i.isBackupBrowse()?d.intl.formatMessage({id:"IePl0Y",defaultMessage:"{folder_name} - Dropbox Backup"},{folder_name:i.filename_without_extension(i.filename(s?null!=t?t:e:"",d.intl.formatMessage({id:"UwzCW9",defaultMessage:"Backups"})))}):d.intl.formatMessage({id:"dbYCaa",defaultMessage:"{folder_name} - Dropbox"},{folder_name:i.filename(e,d.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"}))})}})),Rt=({selection:e,actionSource:t,skipLogging:o})=>(a,s)=>{if(!o){const o=s(),{event:a,itemId:n}=i.makeSelectionEvent(i.selection(o),e),r=i.selectFileByFullPath(o,{path:n});if(r){const{num_files_selected:n,num_folders_selected:d}=i.countFilesAndFolders(i.selectFilesForSelection(o,{selection:e}));a===i.WebUserActionLogEvent.SELECT_ROW&&i.logEvent$1(new S({actionSource:t})),i.logBrowseAction({uid:i.user(o).id,action:a,action_source:t,num_files_selected:n,num_folders_selected:d,view_type:i.selectViewType(s(),{instanceId:i.BROWSE_FILES_VIEW_ID}),result:r,extra:{entity_type:r.is_dir?"folder":"file"}})}}a({type:i.ActionTypes$1.SET_SELECTION,payload:{selection:e,actionSource:t}}),Mt(a,s,e)},wt=({actionSource:e,skipLogging:t}={})=>Rt({actionSource:e,skipLogging:t,selection:i.createSelection()}),At=({unsortedFiles:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=i.user(a());t({type:i.ActionTypes$1.SET_UNSORTED_FILES,payload:{unsortedFiles:e}}),i.initializeStore(o,e.toArray())}));const Nt=({unsortedFiles:e})=>(t,o)=>{const a=i.filePathsToSelectOnNextUpdate(o()).toArray().map((e=>e.toLowerCase())),s=e.toArray().filter((e=>a.includes(e.fq_path.toLowerCase()))).map((e=>e.fq_path.toLowerCase())),n=a.filter((e=>!s.includes(e.toLowerCase())));0!==s.length&&(t(ut({fqPathsToSelect:s})),t(gt({filePathsToSelectOnNextUpdate:i.immutable.exports.Set(n)})))},Mt=(e,t,o)=>{if(!o||0===o.selected.count())return;const a=i.unsortedFiles(t()),s=null==a?void 0:a.filter((e=>o.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl)),n=[];if(null==s||s.forEach((e=>{n.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})})),n.length>0){const o=i.user(t()).id;e(i.loadPreviewThumbnails(n,o,i.BROWSE_FILES_VIEW_ID))}},Lt=e=>(t,o)=>{const a=i.user(o());t({type:i.ActionTypes$1.SET_RIGHTRAIL_IS_COLLAPSED,payload:{collapsed:e}}),i.setIsCollapsed(a.id,e)},bt=e=>({type:i.ActionTypes$1.SET_EXPANDED_BLADE,payload:{expandedBlade:e}});t.CONFLICT_POPUP_BUTTON=$,t.CONFLICT_POPUP_CONTENT=H,t.CONFLICT_POPUP_CONTENT_YOU=j,t.CONFLICT_POPUP_TITLE=B,t.CONFLICT_POPUP_TITLE_YOU=V,t.DESCRIPTION_LAST_EDIT=q,t.DESCRIPTION_LAST_EDIT_EMPTY=U,t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=k,t.DESCRIPTION_LAST_EDIT_YOU=x,t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=E,t.DESCRIPTION_SAVE_DELAY_MS=3e3,t.ERROR_SHARE_MEMBER_FOLDER=v,t.ERROR_SHARE_NO_PERMISSION=I,t.FOLDER_OVERVIEW_EDITOR_EDITING=R,t.FolderOverviewSelectors=Re,t.PIN_TO_MODAL_TITLE_MULTIPLE=D,t.PIN_TO_MODAL_TITLE_SINGLE=b,t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=A,t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=M,t.SHARING_MODAL_MESSAGE_SAME_FOLDER=w,t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=N,t.addContentReferences=Ze,t.addContentReferencesForPath=({path:e,files:t,currentPath:a,snackbarConfig:s})=>(n,r)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(r());try{yield((e,t,o)=>we.ns("files").rpc("add_content_references_to_path",{path:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e}))(o.id,e,t.map(i.fileToContentReferenceId)),s?Qe(s):a!==e?i.Snackbar.complete(d.intl.formatMessage({id:"Mflc9Z",defaultMessage:"{count, plural, one{Pinned {count} item to {folder}.} other{Pinned {count} items to {folder}.}}"},{count:t.length,folder:i.filename(e,i.Viewer.get_root_name(o))}),"folder-overview-pin"):Ke(t.length);const l=G(r())[i.normalizePath(e)];l&&n(Je({folderFileId:l,componentNamespace:"BROWSE"}))}catch(a){_.reportException({err:a,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]});try{if("permission_denied"===a.error.status[".tag"]){const t=s?d.intl.formatMessage(P):d.intl.formatMessage(C,{path:i.filename(e,i.Viewer.get_root_name(o))});return void i.Snackbar.fail(t,"folder-overview-pin")}}catch(e){}i.Snackbar.fail(d.intl.formatMessage({id:"LYVKP8",defaultMessage:"{count, plural, one{Failed to pin {count} item to {folder}.} other{Failed to pin {count} items to {folder}.}}"},{count:t.length,folder:i.filename(e,i.Viewer.get_root_name(o))}),"folder-overview-pin")}})),t.addFileJumpKeyCode=({keyChar:e})=>(t,o)=>{const a=i.fileJumpFilter(o())+e.toLowerCase();t(Et({fileJumpFilter:a}));let s=null;const n=i.fileJumpIndex(o());for(const{fqPath:e,filename:t}of n)if(t>=a){s=e;break}null!=s&&t(ut({fqPathsToSelect:[s]}))},t.addFromGdrive=()=>({type:i.ActionTypes$1.ADD_FROM_GDRIVE}),t.addLoadedComponent=$e,t.appInit=({props:e,user:t,viewer:o})=>a=>{a({type:i.ActionTypes$1.APP_INIT,payload:{props:e,user:t,viewer:o}}),a(i.loadScopedSortOrders({user:t,defaultSort:{sortField:i.SortField.FILENAME,sortDirection:i.SortDirection.ASCENDING}}))},t.appendFiles=({path:e,files:t,currentFolderInfo:o})=>(a,s)=>{if(!i.paths_are_equal(e,i.path(s())))return;if(i.selectedFilter(s())!==i.BrowseFilterType.NONE)return;const n=i.unsortedFiles(s()),r=n.size;let d=r;t.forEach((e=>{n.has(e.fq_path)||d++}));const l=n.merge(i.immutable.exports.Map(t.map((e=>[e.fq_path,e]))));At({unsortedFiles:l})(a,s,pt),Nt({unsortedFiles:l})(a,s,pt),i.isFetchTagsOnBrowseEnabled(i.manualTaggingVariant(s()))&&(o=null!=o?o:i.getCurrentFolderInfo(s()),a(i.fetchTagsForFiles({user:i.user(s()),files:o?[...t,o]:[...t],override:0===r}))),ft.dispatch(i.pathLoaded({path:e})),l.size!==d&&_.reportException({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:u.SEVERITY.NONCRITICAL,exc_extra:{previous_unsorted_files_size:r,incoming_files_size:t.length,expected_files_size:d,updated_unsorted_files_size:l.size,is_deleted_files_on:i.shouldShowDeletedFiles(s())}})},t.applyBoltUpdates=({path:t,updates:o})=>(a,s)=>{const{parent_changes:n}=o,r=i.user(s()),c=Date.now();if(new Promise((function(t,o){e(["./c_file_uploader_actions_adapter"],t,o)})).then((({ActionsAdapter:e})=>e.emit("boltUpdate",{ts:c}))),i.paths_are_equal(t,i.path(s()))){if(n&&n.change_to_fq_path)return((e,t)=>{switch(null!=t.change_type?t.change_type.toLowerCase():null){case"moved":i.Snackbar.complete(d.intl.formatMessage({id:"dte+6z",defaultMessage:"This folder has been moved"}),"browse-notification");break;case"renamed":i.Snackbar.complete(d.intl.formatMessage({id:"y/ubfn",defaultMessage:"This folder has been renamed to “{folder_name}”"},{folder_name:o(t.change_to_fq_path)}),"browse-notification");break;case"deleted":i.Snackbar.fail(d.intl.formatMessage({id:"MK7bBv",defaultMessage:"The folder “{folder_name}” has been deleted"},{folder_name:o(t.old_fq_path)}),"browse-notification")}function o(e){return l.escape(i.filename(e))}})(0,n),void Ft({path:n.change_to_fq_path})(a,s,pt);!function(e,t,o){const{mount_points:a}=o,s=i.path(t()),[n,r]=((e,t,o)=>{const i=e=>t===e;let a,s;return o&&o.find(i)?(s=o.find(i)||null,a=e[o.findKey(i)]||null):(s=null,a=l.find(e,i)||null),[s,a]})(a,s,i.mountPoints(t()));!n||r||i.isBackupBrowse()||i.Snackbar.complete(d.intl.formatMessage({id:"QB9ZqK",defaultMessage:"The folder was unshared."}),"browse-unshare");const c=((e,t,o)=>e&&!t?o:e&&t?i.paths_are_equal(e,t)?null:t:!e&&t?o:null)(n,r,s);if(c)return void e(Ot({path:c}));e(vt({mountPoints:a}))}(a,s,o),function(e,t,o){const{added:a,moved:s,removed:n}=o,r=i.path(t());let d=i.unsortedFiles(t()),l=i.folderSizes(t()),c=d.size;const p={added:new Set([]),moved:new Set([]),removed:new Set([])};e(_t(p)),d=d.withMutations((e=>{l=l.withMutations((t=>{const o=e=>i.paths_are_equal(i.parent_dir(e.fq_path),r),d=t=>{o(t)&&(e.set(t.fq_path,i.File.fromServerObject(t)),c+=1)},l=(o,i)=>{const a=e.get(o);if(a&&a.sjid>=i.sjid&&o===i.fq_path)return;e.remove(o),c-=1,d(i);const s=t.get(o);s&&(t.remove(o),t.set(i.fq_path,s))},p=o=>{e.remove(o),t.remove(o),c-=1};for(const t of a)e.has(t.fq_path)?l(t.fq_path,t):d(t);for(const[t,o]of s)e.has(t)?l(t,o):e.has(o.fq_path)?l(o.fq_path,o):d(o);for(const t of n){const o=e.find((e=>e.fq_path.toLowerCase()===t.toLowerCase()));o&&p(o.fq_path)}}))})),d.size!==c&&_.reportException({err:new Error("applyBoltUpdates ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:u.SEVERITY.NONCRITICAL,exc_extra:{expected_unsorted_files_size:c,actual_unsorted_files_size:d.size,is_deleted_files_on:i.shouldShowDeletedFiles(t()),filesAdded:a,filesRemoved:n,filesMove:s}});d!==i.unsortedFiles(t())&&(At({unsortedFiles:d})(e,t,pt),ft.dispatch(i.filesChanged(r)));l!==i.folderSizes(t())&&e((({folderSizes:e})=>({type:i.ActionTypes$1.SET_FOLDER_SIZES,payload:{folderSizes:e}}))({folderSizes:l}));Nt({unsortedFiles:d})(e,t,pt)}(a,s,o),i.isTaggingEnabled(i.manualTaggingVariant(s()))&&function(e,t,o,a){if(0===o.moved.length)return;const s=[];for(const e of o.moved){const{fq_path:o}=e[1],a=i.selectFileByFullPath(t(),{path:o});void 0!==a&&s.push(a)}e(i.fetchTagsForFiles({user:a,files:s}))}(a,s,o,r)}},t.clearSelection=wt,t.completeFolderSizes=({fetchFolderSizeState:e})=>({type:i.ActionTypes$1.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:e}}),t.createFolder=({pathName:e,folderName:t,user:a,checkFSWs:n,showShareModalOnSuccess:r,redirectOnSuccess:d,redirectOnCancel:l,selectCreatedFolder:c=!0,origin:p})=>(f,_)=>o.__awaiter(void 0,void 0,void 0,(function*(){f(It({newFolderCreationState:i.NewFolderCreationState.SAVING_INPUT}));const o=yield s.createFolder({destination:e,name:t,user:a,checkFsw:n,origin:p,surface:"browse"});if(f(It({newFolderCreationState:i.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),"success"===o.type){const e=s.folderFromFolderMetadata(o.folder);c&&f(ut({fqPathsToSelect:[e.fq_path]})),d&&d(e.fq_path),r&&r(e,i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL)}else l&&l()})),t.descriptionAuthorSelector=_e,t.expandBlade=bt,t.fetchDataForFolder=({path:e,nsId:t,componentNamespace:a,fetchContentReferences:s})=>(n,r)=>o.__awaiter(void 0,void 0,void 0,(function*(){let o,d=!1;const l=i.normalizePath(e),c=Date.now(),p=X(r())[a];if(!p||0===p.requiredComponents.length){n(et({componentNamespace:a,requiredComponents:s?["content_references","description","draftjs"]:["description","draftjs"]}))}const f=[];try{const p=ee(r()).id;o=G(r())[l];const _=o||K(r())[l]||t;if(!_)throw new Error("Unable to get file ID or NS ID for current folder");n(ze({componentNamespace:a,hasFailedToLoad:!1}));let u=o?Y(r())[o]:void 0;u&&u.descriptionLastUpdated&&c-u.descriptionLastUpdated<3e4?(d=!!u.descriptionBaseRevision,n($e({componentNamespace:a,component:"description"})),f.push(Promise.resolve(null))):(n(We({componentNamespace:a,component:"description"})),f.push(Ne(p,_))),u&&u.contentReferencesLastUpdated&&c-u.contentReferencesLastUpdated<3e4?(n($e({componentNamespace:a,component:"content_references"})),f.push(Promise.resolve(null))):s&&(n(We({componentNamespace:a,component:"content_references"})),f.push(Me(p,_)));const[m,h]=yield Promise.all(f);if(m&&(o=m.file_obj_id),!o)throw new Error("Did not get a file ID from the Sprinkle description payload");n({type:i.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[i.normalizePath(e)]:o}}}),d=!!m&&lt(n,o,m,a,c),h&&ct(n,o,h,d,a,c),u=Y(r())[o],u&&u.sharedFolderPath||n(it({path:e})),u&&u.loggingFileId||n(st({path:e})),n(je({folderFileId:o}))}catch(t){_.reportException({err:t,severity:"non-critical",exc_extra:{path:e}}),n(ze({componentNamespace:a,hasFailedToLoad:!0}))}})),t.folderOverviewFolderFileId=ve,t.folderOverviewLiveUpdateManager=be,t.folderOverviewPinnedItems=Ie,t.getFolderAccess=({userId:e,sharedFolderId:t,accountId:o,accountEmail:i})=>we.ns("files").rpc("has_folder_access",{shared_folder_id:t,account_id:o,account_email:i},{subjectUserId:e}),t.handleAppCleanup=()=>({type:i.ActionTypes$1.HANDLE_APP_CLEANUP}),t.handlePrefetch=({path:e,content_references:t,description:a,componentNamespace:s,ts:n=Date.now()})=>r=>o.__awaiter(void 0,void 0,void 0,(function*(){try{const o=a||{},d=t||{},l=o.file_obj_id;if(!l)throw new Error("Did not get a file ID from the Odyssey prefetch payload");r({type:i.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[i.normalizePath(e)]:l}}});const c=o&&lt(r,l,o,s,n);d&&ct(r,l,d,c,s,n)}catch(t){_.reportException({err:t,severity:"non-critical",exc_extra:{path:e}}),r(ze({componentNamespace:s,hasFailedToLoad:!0}))}})),t.hideFolderHistoryPanel=()=>({type:i.ActionTypes$1.HIDE_FOLDER_HISTORY_PANEL,payload:{}}),t.hideRewind=()=>({type:i.ActionTypes$1.HIDE_TIMELINE,payload:{}}),t.logFolderOverviewAction=He,t.makeDescriptionBaseRevisionSelector=()=>i.createSelector(oe,(e=>e?e.descriptionBaseRevision:void 0)),t.makeDescriptionContentSelector=()=>i.createSelector(re,(e=>e)),t.makeDescriptionFormatValidSelector=()=>i.createSelector(ne,(e=>{if(!e)return!0;const t=e.split(".").map((e=>parseInt(e,10)));return!(t[0]>L[0])&&!(t[0]===L[0]&&t[1]>L[1])})),t.makeDescriptionHasFocusSelector=()=>i.createSelector(te,(e=>!!e&&e.descriptionHasFocus)),t.makeDescriptionSaveStateSelector=()=>i.createSelector(oe,(e=>e?e.descriptionSaveState:void 0)),t.makeDoesFolderOverviewExistSelector=()=>i.createSelector(oe,(e=>!!e&&(!!e.descriptionBaseRevision||!!e.contentReferencesRevision))),t.makeFolderFileIdSelector=fe,t.makeFolderNsIdSelector=()=>i.createSelector(Q,(e=>e)),t.makeHasFailedToLoadSelector=pe,t.makeHasUnsavedDescriptionDraftSelector=()=>i.createSelector(oe,i.hasUnsavedDescriptionDraft),t.makeHaveAllComponentsLoadedSelector=ce,t.makeIsFolderOverviewEmptySelector=()=>i.createSelector(le,de,((e,t)=>e&&!(t&&t.length))),t.makeLastModifiedTimeSelector=()=>i.createSelector(se,(e=>{var t;return null!==(t=null==e?void 0:e.timestamp)&&void 0!==t?t:void 0})),t.makeLastModifiedUserIdSelector=()=>i.createSelector(ae,(e=>e)),t.makeLastModifiedUserSelector=()=>i.createSelector(ae,Z,((e,t)=>e?t[e]:void 0)),t.makeLoggingFileIdSelector=ue,t.makeOverviewResourceExtras=Ve,t.makePinnedItemsSelector=me,t.makeSharedFolderIdSelector=()=>i.createSelector(Q,(e=>{if(e)return i.extractSharedFolderId(e)})),t.makeSharedFolderNameSelector=()=>i.createSelector(ie,(e=>e?i.filename(e):void 0)),t.makeSharedFolderPathSelector=()=>i.createSelector(ie,(e=>e)),t.paginatedTotalNumFiles=ye,t.pasteFilesFromClipboard=({copyFiles:e,moveFiles:t})=>(o,a)=>{const s=a(),n=i.user(s),{files:r,action:d}=i.clipboard(a()),l=i.path(a());r.length<=0||("cut"===d?(i.paths_are_equal(i.parent_dir(r[0].fq_path),l)||t({user:n,files:r,newPath:"/"===l?"":l,checkFSWs:!0}),o(mt({clipboard:{files:[]}}))):e({user:n,files:r,newPath:l,checkFSWs:!0,onSuccess:e=>{}}))},t.popBoltIgnore=_t,t.pushBoltIgnore=e=>({type:i.ActionTypes$1.PUSH_BOLT_IGNORE,payload:e}),t.refreshPinnedItems=()=>(e,t)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ve(t());e(Je({folderFileId:o,componentNamespace:i.BrowseFolderOverviewComponentNamespace}))})),t.reloadContentReferences=Je,t.reloadDescription=({folderFileId:e,componentNamespace:t})=>(i,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(a());try{const a=yield Ne(o.id,e);i(Xe({fileId:e,folderData:{descriptionBaseRevision:""}})),Ye(a,i,t)}catch(t){_.reportException({err:t,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}})),t.removeContentReferences=({folderFileId:e,fileIds:t,componentNamespace:a,snackbarConfig:s})=>(n,r)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(r()).id;try{yield((e,t,o)=>we.ns("files").rpc("remove_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e}))(o,e,t),s?i.Snackbar.show(c.react.exports.createElement(i.Snackbar,{title:d.intl.formatMessage(F,{folderName:s.folderName}),variant:"complete",actionButtonText:d.intl.formatMessage({id:"GUtve/",defaultMessage:"Undo"}),closeButtonText:d.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:()=>{i.Snackbar.close("folder-overview-unpin"),n(Ze({folderFileId:e,fileIds:t,componentNamespace:a,snackbarConfig:s}))},timeoutDelayMs:5e3,id:"folder-overview-unpin"})):i.Snackbar.generic(d.intl.formatMessage({id:"0bkx9E",defaultMessage:"{count, plural, one{Unpinned {count} item.} other{Unpinned {count} items.}}"},{count:t.length}),"folder-overview-unpin"),n(Je({folderFileId:e,componentNamespace:a}))}catch(e){_.reportException({err:e,severity:u.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),t.requestFolderSizes=({fqPath:e})=>({type:i.ActionTypes$1.REQUEST_FOLDER_SIZES,payload:{fqPath:e}}),t.resetFileJumpFilter=()=>(e,t)=>{i.logKeyboardShortcutUsage({user_id:i.user(t()).id,keyboard_shortcut_type:"jump",view_type:i.selectViewType(t(),{instanceId:i.BROWSE_FILES_VIEW_ID})}),e(Et({fileJumpFilter:""}))},t.saveDescriptionDraft=({folderFileId:e,componentNamespace:t})=>(a,s)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=ee(s());try{const a=Y(s())[e];if(!a||!ot(a))return;r({descriptionSaveState:i.DescriptionSaveState.SAVING});const n=yield((e,t,o,i,a)=>new Ae(e).ns("files").rpc("set_description",{file_id:t,current_revision_id:o,text:i,format_version:a},{subjectUserId:e.id}))(o,e,a.descriptionLatestRevision,a.descriptionDraft,L.join(".")),d=X(s())[t];(null==d?void 0:d.descriptionHasFocus)||void 0===a.descriptionOpenedAtRevision||tt(a);const{text:l,latest_revision_id:c,last_modified_time:p,last_modified_user:f}=n;r({description:l,descriptionSaveState:i.DescriptionSaveState.IDLE,descriptionLastModified:{timestamp:p,userId:f},descriptionBaseRevision:c,descriptionLatestRevision:c});const _="BROWSE"===t?i.ActionSurfaceLogValue.CENTER_PANE:i.ActionSurfaceLogValue.RIGHT_SIDEBAR,u="search-sidebar"===t?i.RetrievalSourceValue.SEARCH:i.RetrievalSourceValue.BROWSE;(({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a})=>{const s=i.getStoreForFolderOverview().getState();He(i.WebUserActionLogEvent.FOLDER_OVERVIEW_EDITED,ee(s).id,null,Be({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a}))})({folderFileId:e,action_surface:_,retrievalSource:u,loggingFileId:a.loggingFileId})}catch(t){(n=t).error&&n.error.status&&"conflict"===n.error.status[".tag"]?(r({descriptionSaveState:i.DescriptionSaveState.CONFLICT,descriptionLastModified:{userId:void 0}}),a(dt({folderFileId:e}))):(e=>e.error&&e.error.status&&"bad_format_version"===e.error.status[".tag"])(t)?(i.Snackbar.fail(g,"folder-overview"),r({descriptionSaveState:i.DescriptionSaveState.ERROR})):(i.Snackbar.fail(T,"folder-overview"),r({descriptionSaveState:i.DescriptionSaveState.ERROR}))}var n;function r(t){a(Xe({fileId:e,folderData:t}))}})),t.selectFilesByFqPath=ut,t.setAndStoreSortOrder=e=>(t,o)=>{const a=o(),s=i.user(a);i.logSortRecords({uid:s.id,sort_by:e.sortField,sort_direction:e.sortDirection,view_type:i.selectViewType(a,{instanceId:i.BROWSE_FILES_VIEW_ID})}),t(i.setSort({user:s,sort:e,viewScope:i.selectViewTypeScope$1(a,{instanceId:i.BROWSE_FILES_VIEW_ID}),updateGlobalScope:!0})),t((({sortOrder:e})=>({type:i.ActionTypes$1.SET_SORT_ORDER,payload:{sortOrder:e}}))({sortOrder:e}))},t.setArePostTTIModulesLoaded=({arePostTTIModulesLoaded:e})=>({type:i.ActionTypes$1.SET_ARE_POST_TTI_MODULES_LOADED,payload:{arePostTTIModulesLoaded:e}}),t.setBrowsePostTTIData=({browsePostTTIData:e})=>{const t=Object.assign({},e);return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),{type:i.ActionTypes$1.SET_BROWSE_POST_TTI_DATA,payload:{browsePostTTIData:t}}},t.setBrowsePostTTIExperiments=({browsePostTTIExperiments:e})=>({type:i.ActionTypes$1.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:e}}),t.setCanDisplayFolderSizes=({canDisplayFolderSizes:e})=>({type:i.ActionTypes$1.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:e}}),t.setContext=ht,t.setCreateMenuOpenRequest=e=>({type:i.ActionTypes$1.SET_CREATE_MENU_OPEN_REQUEST,payload:{createMenuOpenRequest:e}}),t.setCurrentFolderInfo=St,t.setDescriptionHasFocus=({componentNamespace:e,descriptionHasFocus:t,folderFileId:o})=>(a,s)=>{const n=X(s())[e];if(t&&n&&!n.descriptionHasFocus){const e=Y(s())[o].descriptionBaseRevision;a(Xe({fileId:o,folderData:{descriptionLatestRevision:e,descriptionOpenedAtRevision:e}}))}else if(!t&&(null==n?void 0:n.descriptionHasFocus)){const e=Y(s())[o];e&&(null==e?void 0:e.descriptionOpenedAtRevision)!==(null==e?void 0:e.descriptionLatestRevision)&&(tt(e),a(Xe({fileId:o,folderData:{descriptionOpenedAtRevision:void 0}})))}a({type:i.ActionTypes.SET_DESCRIPTION_HAS_FOCUS,payload:{componentNamespace:e,descriptionHasFocus:t}})},t.setFilePathsToSelectOnNextUpdate=gt,t.setFilesToClipboard=({clipboard:e})=>t=>{const{files:o}=e;o.length&&(o.some((e=>e.isDeleted||e.is_unmounted))?i.Snackbar.fail(d.intl.formatMessage({id:"jdnaZR",defaultMessage:"Deleted files cannot be added to the clipboard"}),"browse-clipboard-copy"):o.some(i.File.isTeamSharedFolder)||o.some(i.File.isTeamMemberFolder)?i.Snackbar.fail(d.intl.formatMessage({id:"0Nkg/N",defaultMessage:"Team Folders cannot be added to the clipboard"}),"browse-clipboard-copy"):o.some(i.File.isFamilySharedFolder)?i.Snackbar.fail(d.intl.formatMessage({id:"KMcV0/",defaultMessage:"Family shared folders cannot be added to the clipboard"}),"browse-clipboard-copy"):o.some((e=>e.type===i.FileTypes.VAULT_FOLDER))?i.Snackbar.fail(d.intl.formatMessage({id:"La991r",defaultMessage:"{TRADEMARK_VAULT} cannot be added to the clipboard"},{TRADEMARK_VAULT:m.TRADEMARK_VAULT}),"browse-clipboard-copy"):(i.Snackbar.complete(d.intl.formatMessage({id:"BvUPS9",defaultMessage:"{count, plural, one{Added {count} item to clipboard.} other{Added {count} items to clipboard.}}"},{count:o.length}),"browse-clipboard-copy"),t(mt({clipboard:e}))))},t.setFilterTypes=e=>({type:i.ActionTypes$1.SET_FILTER_TYPES,payload:{filterTypes:i.immutable.exports.Set(e)}}),t.setFilteredViewData=(e,t)=>(a,s)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=i.user(s()).id;if(e!==i.BrowseFilterType.NONE){a(Tt({loadingState:i.LoadingState.UPDATING_FILTERED_VIEW,path:t}));try{if(e===i.BrowseFilterType.STARRED){const e=function(e){const t=(e||[]).filter((e=>void 0!==e.file_info)).map((e=>{const t=e.file_info.fq_path,o=i.File.fromApiV2Object(e.file_info);return t?o:new i.File(Object.assign(Object.assign({},o),{fq_path:e.file_info.ns_path||"",icon:e.file_info.icon||""}))})).filter((e=>!!e.fq_path));return i.immutable.exports.Map(t.map((e=>[e.fq_path,e])))}((yield i.fetchStarred(o)).paginated_file_info);At({unsortedFiles:e})(a,s,pt)}else if(e===i.BrowseFilterType.RECENTS){const e=function(e){if(!e)return i.immutable.exports.Map([]);const t=e.filter((e=>void 0!==e.item&&"paginated_file_info"===e.item[".tag"])).map((e=>{const t=e.item,o=t.file_info.fq_path,a=i.File.fromApiV2Object(t.file_info);return o?a:new i.File(Object.assign(Object.assign({},a),{fq_path:t.file_info.ns_path||"",icon:t.file_info.icon||""}))})),o=e.filter((e=>e.item&&"legacy_paper_info"===e.item[".tag"])).map((e=>{const t=e.item;return i.File.fromRecentsV2LegacyPaper(t)})),a=t.concat(o).filter((e=>!!e.fq_path));return i.immutable.exports.Map(a.map((e=>[e.fq_path,e])))}((yield i.fetchRecents(o,i.DEFAULT_RECENTS_LIMIT)).recent_items);At({unsortedFiles:e})(a,s,pt)}a(Tt({loadingState:i.LoadingState.LOADED,path:t}))}catch(e){a(Tt({loadingState:i.LoadingState.LOAD_ERROR,path:t}))}}})),t.setFolderMemberCounts=e=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const{contentId:o,userId:s}=e;let n;n=i.isInsideBackupFolder(a())?1:yield i.getFolderMemberCounts(o,s),t({type:i.ActionTypes$1.SET_FOLDER_MEMBER_COUNTS,payload:{value:n}})})),t.setFolderSizesPending=({fetchFolderSizesResp:e})=>({type:i.ActionTypes$1.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:e}}),t.setHideFilesAndSidebar=({shouldHideFilesAndSidebar:e})=>({type:i.ActionTypes$1.SET_HIDE_FILES_AND_SIDEBAR,payload:{shouldHideFilesAndSidebar:e}}),t.setInlineOverflowMenuOpenRequest=e=>({type:i.ActionTypes$1.SET_INLINE_OVERFLOW_MENU_OPEN_REQUEST,payload:{inlineOverflowMenuOpenRequest:e}}),t.setIsFileViewerShown=({isShown:e})=>({type:i.ActionTypes$1.SET_IS_FILE_VIEWER_SHOWN,payload:{isShown:e}}),t.setIsRewindButtonEnabled=e=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const{path:o,userId:a,userSkuHasRewind:s}=e;if(!s)return void t({type:i.ActionTypes$1.SET_IS_REWIND_ENABLED,payload:{value:!0}});const n=yield i.isRewindButtonEnabled(o,a);t({type:i.ActionTypes$1.SET_IS_REWIND_ENABLED,payload:{value:!!n.can_rewind}})})),t.setLoadingState=Tt,t.setMountPoints=vt,t.setNewFolderCreationState=It,t.setOverflowMenuCloseRequest=e=>({type:i.ActionTypes$1.SET_OVERFLOW_MENU_CLOSE_REQUEST,payload:{overflowMenuCloseRequest:e}}),t.setOverflowMenuCoordinates=e=>({type:i.ActionTypes$1.SET_OVERFLOW_MENU_COORDINATES,payload:{overflowMenuCoordinates:e}}),t.setOverflowMenuOpenRequest=e=>({type:i.ActionTypes$1.SET_OVERFLOW_MENU_OPEN_REQUEST,payload:{overflowMenuOpenRequest:e}}),t.setPaginatedTotalNumFiles=yt,t.setPath=Ot,t.setPathData=({path:t,files:o,paginatedTotalNumFiles:a,context:s,currentFolderInfo:n})=>(r,d)=>{if(!i.paths_are_equal(t,i.path(d())))return;const l=i.immutable.exports.Map(o.map((e=>[e.fq_path,e])));r(ht({context:s})),r(St({currentFolderInfo:n})),At({unsortedFiles:l})(r,d,pt),r(yt({paginatedTotalNumFiles:a})),r(wt({skipLogging:!0})),Nt({unsortedFiles:l})(r,d,pt),i.isFetchTagsOnBrowseEnabled(i.manualTaggingVariant(d()))&&r(i.fetchTagsForFiles({user:i.user(d()),files:n?[...o,n]:[...o],override:!0})),setTimeout((()=>{ft.dispatch(i.pathLoaded({path:t}));const o={path:t,hasPermissionToUploadToFolder:s.isCurrentPathWriteable(),isMovingIntoVault:s.isInsideVaultFolder};new Promise((function(t,o){e(["./c_data_slice"],t,o)})).then((function(e){return e.slice_esnext})).then((({uploadActionCreators:e})=>{r(e.setPath(o))}))}),1)},t.setRightRailIsCollapsed=Lt,t.setSelection=Rt,t.setShouldShowDeletedFiles=({shouldShowDeletedFiles:e})=>({type:i.ActionTypes$1.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:e}}),t.setUnsortedFiles=At,t.setUrl=Ft,t.setViewType=e=>(t,o)=>{const a=o();t(i.setViewType({user:i.user(a),viewType:e,viewTypeScope:i.selectViewTypeScope(a),updateGlobalScope:!0}))},t.showFolderHistoryPanel=()=>({type:i.ActionTypes$1.SHOW_FOLDER_HISTORY_PANEL,payload:{timestamp:(new Date).getTime()}}),t.showRewind=()=>({type:i.ActionTypes$1.SHOW_TIMELINE,payload:{timestamp:(new Date).getTime()}}),t.toggleSpacesEntryPoint=({value:e})=>({type:i.ActionTypes$1.TOGGLE_SPACES_ENTRY_POINT,payload:{value:e}}),t.updateFolderDataCache=Xe,t.updateStarredView=e=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(i.unsortedFiles(a()).has(e.fq_path)){const o=i.unsortedFiles(a()).delete(e.fq_path);At({unsortedFiles:o})(t,a,pt)}})),t.user=ee}));
//# sourceMappingURL=c_data_action_creators_index.js-vflJEtNTq.map
