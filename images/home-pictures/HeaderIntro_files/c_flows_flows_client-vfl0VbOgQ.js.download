define(["require","exports","./c_tslib"],(function(t,e,o){"use strict";const i=t=>{var e;return(null===(e=t.headers)||void 0===e?void 0:e["x-dropbox-request-id"])||""};e.makeFlowsClient=e=>({submitFileWorkflow:(r,n)=>o.__awaiter(void 0,void 0,void 0,(function*(){var s,a,l;const c=null===(l=null===(a=null===(s=r.template)||void 0===s?void 0:s.sequence)||void 0===a?void 0:a[0].workflow_action)||void 0===l?void 0:l[".tag"];if(!c)throw new Error("Unknown operation");const{FlowsBoltClient:u,isCompleteFlowsBoltPayload:d}=yield new Promise((function(e,o){t(["./c_flows_utils_bolt"],e,o)}));let _;const f=Date.now(),w=window.setTimeout((()=>{v({status:"error",error:"timeout",errorReason:"timeout",timeToStartRecieved:_})}),1e3*n);let v;const m=new Promise((t=>{v=e=>{window.clearTimeout(w),t(e)}}));u.subscribe((e=>{e.forEach((e=>{if(d(e)&&e.action_type===c){if(function(e){o.__awaiter(this,void 0,void 0,(function*(){const{preprocessPayload:o,handleMultiStepNotification:i,handleSingleStepNotification:r}=yield new Promise((function(e,o){t(["./c_flows_utils_notifications"],e,o)})),n=o(e);if(n.template&&n.template.length>1)i([n],(()=>{}));else{if(!n.action_type||"list_directory"===n.action_type||"transcribe_media"===n.action_type||"video_edit"===n.action_type)return;const[{getAllowedWorkflowActions:e},{getStoreForAutomations:o},{loadWorkflowActionUi:i}]=yield Promise.all([new Promise((function(e,o){t(["./c_flows_redux_selectors"],e,o)})),new Promise((function(e,o){t(["./c_flows_redux_store"],e,o)})),new Promise((function(e,o){t(["./c_workflow_builder_workflow_actions_action_ui_config"],e,o)})).then((function(t){return t.action_ui_config_esnext}))]),s=e(o().getState()),a=i(n.action_type);a&&s.includes(n.action_type)&&r([n],a,(()=>{}))}}))}(e),"start"===e.status)return void(_=Date.now()-f);"fail"===e.status?v({status:"error",error:"failure",errorReason:e.exit_reason,timeToStartRecieved:_}):"success"===e.status&&v({status:"success",createdFqPath:e.created_fq_path})}}))})),yield e.ns("flows").rpcWithResponseHeaders("submit_file_workflow",r,{}).catch((t=>{var e,o;const r=(null===(e=null==t?void 0:t.error)||void 0===e?void 0:e[".tag"])||(null===(o=t.raw)||void 0===o?void 0:o.status)||"";v({status:"error",error:"failed_to_submit",requestId:i(t),errorReason:r,timeToStartRecieved:_})}));return yield m}))})}));
//# sourceMappingURL=c_flows_flows_client.js-vflwklfLC.map
