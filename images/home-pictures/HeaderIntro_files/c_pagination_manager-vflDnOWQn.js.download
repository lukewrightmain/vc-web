define(["exports","./e_ui_page_files_router","./c_core_i18n","./c_core_notify"],(function(e,t,s,a){"use strict";class i{constructor(e){this.hasMoreItems=e}areAllItemsReady(){return!this.hasMoreItems}invalidateHasMore(){this.hasMoreItems=!0}addDataToAjax(e){}}class h{constructor(e){this.handleNextPageSuccess=e=>{this.nextRequestVoucher=e.next_request_voucher,this.mode.hasMoreItems=e.has_more_items,this.autoFetching&&this.fetchNext(),this.addPage(e.items)},this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items),this.fetchNextFn=e.fetchNextFn}areAllItemsReady(){return this.mode.areAllItemsReady()}addPage(e){const t=[],i=[];for(const h of e){const e=h[this.keyName];if(null==e)return void a.Notify.warning(s.intl.formatMessage({id:"xlabvw",defaultMessage:"Invalid server response"}));this.items[e]||(this.items[e]=[]),this.items[e].push(h),i.push(h),t.push(e)}this.pages.push(t),this.newDataCallback(this,i)}startAutoFetching(){this.autoFetching=!0,this.fetchNext()}stopAutoFetching(){this.autoFetching=!1}reSync(e=!1){e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);const t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()}fetchNext(){if(this.mode.areAllItemsReady())return;const e={};this.nextRequestVoucher&&(e.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(e),this.fetchNextFn(this.nextRequestVoucher||"",this.fqPathPrefix,this.userID,e).then((e=>{this.handleNextPageSuccess(e)})).catch((()=>{t.Snackbar.fail(s.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}),"browse")}))}loadedPageCount(){return this.pages.length}getLoadedPage(e){const t=this.pages[e];if(null==t)return null;const s=[];return t.forEach((e=>{s.push(...this.items[e])})),s}getLastLoadedPage(){return this.getLoadedPage(this.loadedPageCount()-1)}}class r extends h{constructor(e){super(Object.assign(Object.assign({},e),{mode:new i(e.firstPage.has_more_items)}))}static create(e){return new r(e)}}e.BasePaginationManager=h,e.LegacyFetchNextFn=(e,s)=>(a,i,h,r)=>(a&&(r.voucher=a),new Promise(((a,n)=>{t.WebRequest$1({url:e,data:r,dataType:"text",subject_user:h,success:(e,t)=>{a(s(t,i))},error:n})}))),e.PaginationManager=r}));
//# sourceMappingURL=c_pagination_manager.js-vflRj8eUc.map
