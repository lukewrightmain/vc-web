define(["exports","./c_account_email","./c_account_email_verify_reasons","./e_ui_page_files_router","./c_sharing_actions_share_modal","./c_previews_util","./c_sharing_ui_util","./c_src_utils_logging","./c_flows_approval_approval_io_client","./e_edison","./c_tslib","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","./c_ui_modal_dig","./c_core_notify","./c_core_i18n","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","./c_ui_input_dig","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_confirmation_modals_reset_access_modal","./c_spectrum_modal_utility_modal","./c_spectrum_tertiary_link_tertiary_list","./c_icon_templates_actionable_index","./c_spectrum_svg_icon_bundle","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_exenv_index","./c_ux_analytics_modal_tracking","./c_ui_flag","./c_sharing_share_page_action_types","./c_components_form_validation_message","./c_hooks_lib_index","./c_ui-icon_line_calendar","./c_combinations_index","./c_sharing_settings_utils_sharing_settings_util","./c_components_icons_icon_dropdown_selected","./c_truncate_index","./c_components_sharing_modal_banner","./c_controls_index","./c_ui-icon_line_settings","./c_es_src_dropbox","./c_ui-icon_line_edit","./c_ui-icon_line_show","./c_typeahead_index","./c_sharing_ui_notifications_util","./c_contacts_contact_token_state","./c_share_modal_evolution_utils_logging","./c_ui-icon_line_send","./c_ui-icon_line_video","./c_flows_logging_flows_loggers","./c_integrations_hellosign_deep_integration_launcher","./c_ui-icon_line_signature","./c_src_instrumentation_function_wrapper","./c_src_instrumentation_constants","./c_ui-icon_line_delete","./c_table_index","./c_ui-icon_line_arrow-down","./c_ui-icon_line_arrow-up","./c_src_text","./c_dropins_sdk_refactor_src_v2_entry","./c_base64","./c_stormcrow_stormcrow_exposure_logger","./c_flows_utils_async_modal_launchers","./c_integrations_data_selectors","./c_docsend_analytics_add_on_data_apiUtils","./c_docsend_src_utils","./c_sharing_upsells_util","./c_flux_store_listener","./c_sharing_gating_util","./c_tabs_index","./c_sharing_content_manager","./c_browse_tts","./c_spectrum_colorized_icon","./c_clipboard_v3","./c_ui_bubble_dropdown_v2","./c_ui_overlay","./c_raf_throttle","./c_components_auto-folder-setup-checkbox_index","./c_form_row_index","./c_icon_file_icon","./c_ui_title_bubble","./c_icon_icon_helper","./c_avatar_initials_avatar","./c_avatar_size","./c_spectrum_avatar_avatar_initials","./c_spectrum_avatar_avatar_color_util","./c_prop-types_index","./c_spectrum_tooltip","./c_spectrum_dropdown_button","./c_integrations_profile_card_popover","./c_integrations_notify","./c_src_instrumentation_common_context","./c_spectrum_facepile_facepile_members","./c_resize-observer-polyfill_dist_ResizeObserver","./c_spectrum_culled_list","./c_spectrum_util_raf_throttle","./c_ui-icon_line_link","./c_components_sharing_spinner","./c_components_approval-forms_approval_checkbox_in_share","./c_flows_redux_selectors","./c_flows_constants","./c_flows_redux_reducer","./c_flows_lib_api","./c_src_common_constants","./c_flows_redux_store","./c_file_viewer_utils","./c_core_logging_constants","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_core_types_preview_type","./c_src_file_extension_extension_constants","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments"],(function(e,t,n,s,i,o,a,r,_,c,l,d,u,m,p,h,f,g,v,S,I,w,C,x,A,b,N,E,y,F,P,R,T,j,M,k,O,L,D,G,H,V,q,B,U,z,Y,Q,W,K,Z,J,X,$,ee,te,ne,se,ie,oe,ae,re,_e,ce,le,de,ue,me,pe,he,fe,ge,ve,Se,Ie,we,Ce,xe,Ae,be,Ne,Ee,ye,Fe,Pe,Re,Te,je,Me,ke,Oe,Le,De,Ge,He,Ve,qe,Be,Ue,ze,Ye,Qe,We,Ke,Ze,Je,Xe,$e,et,tt,nt,st,it,ot,at,rt,_t,ct,lt,dt,ut,mt,pt,ht,ft,gt,vt,St,It,wt,Ct,xt,At,bt,Nt,Et,yt,Ft,Pt,Rt,Tt,jt,Mt){"use strict";const kt=()=>(new Date).getTime().toString(),Ot=function(e,t,n){let i=null;"number"==typeof e&&(e=s.Viewer.get_viewer().get_user_by_id(e)),null==n.userHomeNs&&(n.userHomeNs=e.home_ns_id);let a=Dt(t),r=null;if(null!=a){if(a=Object.assign(Object.assign({},a),n),a.modalSessionId||(a.modalSessionId=kt()),void 0===n.logShareModalView||n.logShareModalView){const{nsId:t,sjid:n,fileId:i,filename:o,fqPath:r}=a;s.logViewShareModal({uid:e.id,modal_session_id:a.modalSessionId||"",file_nsid:t,file_sjid:n,file_id:i,file_name:o,file_path:r})}try{i=o.ContentInfo.createFromParams(a)}catch(e){i=null}r=t instanceof s.BrowseContext?t:a.browseContext}return{browseContext:r,contentInfo:i,shareModalInfo:a,user:e}},Lt=function(e,o,c,l,d,u=!0){let m,p,h;if(({browseContext:m,contentInfo:p,shareModalInfo:h,user:e}=Ot(e,o,c)),null==p||null==h)return!1;a.logTiburonEvent(p,e.id,r.TiburonEventName.BeginShareFlow);const f=(null!=m?m.isNonUserRelativeContext:void 0)||h.isNonUserRelativeContext;let g=n.EmailVerificationReasons.SHMODAL;if(h.origin===s.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE&&(g=n.EmailVerificationReasons.SHARE_FILEVIEWER),f||t.EmailVerification.get_for_user(e).verified_or_show(g,h.onCancel)){const t=new(p.isFolder()?s.FolderShareApiClient:s.FileShareApiClient)({userId:e.id,isNonUserRelativeContext:f}),n=_.approvalIOClient(e.id),a=new i.ShareModalActionHandler(t,e,i.ShareModal,l,d,c.openSettingsFromTheExternalSharePageQuickActions,n),{inLinksPage:r}=h,m=h.prefillContacts,g=a.initializeShareModal({contentInfo:p,initialRecipientTokens:m,inLinksPage:r},{client:t,content:o,user:e,onDeleteLink:h.onDeleteLink,teamGroupInfo:p.teamGroupInfo(),isInContentManager:!!f,onSuccessSharing:h.onSuccessSharing,shareAsConfidential:!!h.shareAsConfidential,initialContentName:h.initialContentName,shouldSyncThisFolder:h.shouldSyncThisFolder,recipientMessage:h.recipientMessage,onCreateGroupCallback:h.onCreateGroupCallback,onShareClick:h.onShareClick,shouldSuppressRedirectToBrowse:h.shouldSuppressRedirectToBrowse,shouldCloseImmediately:h.shouldCloseImmediately,onCancel:h.onCancel,onClose:h.onClose,onSetContentNameAndSendShareFail:h.onSetContentNameAndSendShareFail,shareButtonLabelOverride:h.shareButtonLabelOverride,focusOnMount:u,referrer:h.referrer,experiments:h.experiments,showApproval:h.showApproval,approvalClient:n,onCreateApprovalSuccess:h.onCreateApprovalSuccess,automationOptionChecked:c.automationOptionChecked,docsendAnalyticsAddOn:h.docsendAnalyticsAddOn,defaultRecipientAccessLevel:c.defaultRecipientAccessLevel});c.defaultRecipientAccessLevel&&a.changeRecipientAccess(c.defaultRecipientAccessLevel),c.openLinkSettings?g.then((()=>a.handleLinkSettingsClick())):c.initialScreen&&c.initialScreen===s.MANAGE_SCREEN?a.showScreen(s.MANAGE_SCREEN):a.openShareModal()}else a.logTiburonEvent(p,e.id,r.TiburonEventName.ShareModalEmailUnverified);return!0},Dt=function(e){if(e instanceof s.File){const t=[s.FileTypes.FILE,s.FileTypes.PACKAGE].indexOf(e.type)>-1;return{exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,isFolder:!t,isTeamSharedFolder:e.type===s.FileTypes.TEAM_SHARED_FOLDER,isFolderInsideTeamFolderTree:e.is_in_team_folder_tree,sjid:e.sjid,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}}return e instanceof s.BrowseContext?Gt(e):e},Gt=function(e){return e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}};e.generateModalSessionId=kt,e.getShareModalInfo=Dt,e.getSharingInfo=Ot,e.showNewFolderShareModal=function(e,t=null,n=null,i=null,o=!1,r=!1,_=null,c,l,d,u,m=null,p=null,h,f,g,v,S=!0,I,w,C){t||(t=kt());const x={fqPath:function(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=1;n<=100;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return a.getNewFolderPathFromContentName(e,n||"")}(),isFolder:!0,exists:!1,origin:s.SHARE_ACTION_ORIGIN_TYPE.WIZARD,modalSessionId:t,isNonUserRelativeContext:r,isTeamSharedFolder:!1,initialContentName:i,shareAsConfidential:o,shouldSyncThisFolder:_,shouldSuppressRedirectToBrowse:m,shouldCloseImmediately:p,onCancel:h,onClose:f,onSetContentNameAndSendShareFail:g,shareButtonLabelOverride:v,logShareModalView:S,experiments:I,defaultRecipientAccessLevel:C},A={origin:s.SHARE_ACTION_ORIGIN_TYPE.WIZARD};return d&&(A.onSuccessSharing=d),u&&(A.onShareClick=u),A.automationOptionChecked=w,A.defaultRecipientAccessLevel=C,Lt(e,x,A,c,l)},e.showPrefilledShareModal=function({user:e,sharePrefillEmails:t,content:n,setUrl:i,contentManagerValidateFolderPath:o,extras:a}){let r,_;return t&&t.length>0?(r=s.SHARE_ACTION_ORIGIN_TYPE.GRANT_ACCESS,_=t.map((e=>new s.Contact({type:s.ContactTypes.EMAIL,email:e,name:"",query:e,pending:!0})))):(r=s.SHARE_ACTION_ORIGIN_TYPE.DESKTOP_CLIENT,_=[]),Lt(e,n,Object.assign({origin:r,prefillContacts:_},a),i,o)},e.showShareModal=Lt}));
//# sourceMappingURL=c_sharing_share_modal_util.js-vfl7qPY2I.map
