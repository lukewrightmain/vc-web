define(["exports","./c_tslib","./c_security_crypto","./c_csrf","./c_core_uri"],(function(e,n,t,r,o){"use strict";function i(e,i,c){return n.__awaiter(this,void 0,void 0,(function*(){const s=o.URI.parse(e),d=yield function(e){return n.__awaiter(this,void 0,void 0,(function*(){const n=encodeURIComponent(e),o=t.stringToBytes(n),i=r.readCsrfToken();if(""===i||null===i)throw new Error("Missing CSRF token");const c=t.stringToBytes(i),s=yield t.hmacMessage(c,o);return btoa(t.bytesToString(s))}))}(c);return s.updateQuery({[i]:d}),s.toString()}))}e.addHeaderRedirectToken=function(e){return n.__awaiter(this,void 0,void 0,(function*(){return yield i(e,"rtoken","header_redirect")}))},e.readHmacCookieToken=function(e,o){return n.__awaiter(this,void 0,void 0,(function*(){const n=e.split(":");if(3!==n.length)return null;const[i,c,s]=n;if("1"!==i)return null;const d=(new TextEncoder).encode(c);let u=decodeURIComponent(s);try{u=atob(u)}catch(e){return null}const a=t.stringToBytes(u),l=(new TextEncoder).encode(null!=o?o:r.readCsrfToken());return(yield t.verifyMessageHmac(l,d,a))?decodeURIComponent(c):null}))}}));
//# sourceMappingURL=c_security_csrf_hmac.js-vflT4Xay9.map
