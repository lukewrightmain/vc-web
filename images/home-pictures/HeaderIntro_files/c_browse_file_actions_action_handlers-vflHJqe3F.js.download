define(["require","exports","./c_views_copy_link_mini_modal","./e_ui_page_files_router","./c_tslib","./c_downloads","./c_extensions_data_selectors","./c_browse_interface","./c_file_actions_portable_go_to_folder","./c_browse_actions","./c_data_action_creators_index","./c_file_viewer_async_controller","./c_cloud_docs_gdd_migration_gdd_ui_blocking","./c_plusplus_file_actions","./c_vault_constants","./c_sync_everything_hive_logger","./c_src_file_extension_extension_constants","./e_edison","./c_core_i18n","./c_gdd_migration_ui_utils","./c_components_modals_show_modal","./c_spectrum_modal_utility_modal","./c_ux_analytics_modal_tracking","./c_browser_cookies","./c_file_transfers_async_browse_entry_point_onboarding_modal_async","./c_starred_actions","./c_starred_constants","./c_starred_star","./c_files_view_files_view_logging","./c_sharing_browse_exports","./c_unity_features","./c_core_notify","./c_file_store_utils","./c_file_transfers_lib_urls","./c_browse_tts"],(function(e,t,o,i,n,s,r,a,l,c,d,_,f,u,h,g,p,m,S,w,E,v,F,b,k,R,A,y,M,L,C,I,T,O,U){"use strict";const x=e=>m.React$1.createElement(w.ModalTemplate,Object.assign({open:!0},(({onClose:e,onLearnMore:t})=>({title:S.intl.formatMessage({id:"el417s",defaultMessage:"Can’t open this file"}),bodyText:S.intl.formatMessage({id:"1gEouT",defaultMessage:"To access this file, save it as a Microsoft file or Google shortcut. <button>Learn more</button>"},{button:e=>m.React$1.createElement(i.Button,{variant:"transparent",onClick:t},e)}),tertiaryActions:m.React$1.createElement(i.Button,{variant:"primary",onClick:e},w.Strings.OK),width:"standard",withCloseButton:w.Strings.CLOSE}))(e),{onRequestClose:e.onClose}));x.displayName="CannotOpenFileComponent";const N=new class{constructor(){this.setUrl=({path:e,qargs:t,expandedBlade:o,forceExpandRightRail:i})=>{this.reduxStore.dispatch(d.setUrl({path:e,qargs:t,expandedBlade:o,forceExpandRightRail:i}))},this.onRestore=(e,t,o)=>{i.restoreFiles({files:t,userId:e,onSuccess:()=>{i.notifyRestoreSuccess(t)},isSearchMode:o})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=i.user(this.reduxStore.getState()),o=i.context(this.reduxStore.getState());i.showUnifiedTrashModal({userId:t.id,context:o,files:e,onRestore:(e,t)=>{this.onRestore(e,t,!1)}})},this.reduxStore=i.getStoreForBrowse()}reloadCurrentPath(){this.setUrl({path:i.path(this.reduxStore.getState()),qargs:{reload:!0}})}navigateToFileOrFolder({file:e,shouldFocusComment:t=!1,activeCommentThreadId:o,onFileViewerUnmount:n,fileViewOrigin:s=i.FileViewOriginType.BROWSE,skipFileViewerRouting:r=!1,performSpaRouting:a=!1,href:l,middleClick:c=!1}){var d;const _=i.experiments(this.reduxStore.getState()),p=i.getFileExt(e);if(i.isGoogleFileByExtension(p)&&f.isBlockedByGddMigration(_))return void i.Modal$1.showInstance(m.React$1.createElement(x,{onClose:i.Modal$1.close,onLearnMore:()=>i.open_tab(w.HELP_CENTER_ARTICLE_URL)}));const S=i.user(this.reduxStore.getState()),E=i.context(this.reduxStore.getState()),v=i.browsePostTTIExperiments(i.getStoreForBrowse().getState());if(e.isDeleted)this.doRestoreFilesWithUnifiedTrashModal({files:[e]});else{if(i.isSupportedLinkNodeClickAction(e.per_node_metadata))return void u.handleLinkNodeAction(e.per_node_metadata,(e=>{f.logProductAnalytics(S.id,"web","select",e,"files_main_bar")}));if(e.is_dir)if(e.type===i.FileTypes.VAULT_FOLDER)i.redirect(h.VAULT_URL);else if(i.isBackupFolderIcon(e)&&v.expEnableBackupWeb&&!i.isBackupBrowse()){const t=i.backupUrlForFqPath(e.fq_path);g.logEvent({event:"click_backup",page_source:"browse",action_surface:"file_list"}),i.open_tab(t)}else i.File.isNoAccessSharedFolder(e)?i.showNoAccess(S,e.fq_path,E):(i.isBackupBrowse()&&g.logEvent({page_source:"browse",action_surface:"file_list",event:(null===(d=e.per_node_metadata)||void 0===d?void 0:d.suppress_delete)?"click_system_folder":"click_folder"}),this.setUrl({path:e.fq_path}));else{const d=()=>{l&&c?i.open_tab(l):this.openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:o,user:S,fileViewOrigin:s,onFileViewerUnmount:n,skipFileViewerRouting:r,performSpaRouting:a})},{preferredEditors:_}=i.browsePostTTIData(this.reduxStore.getState());!t&&_&&i.hasPreferredEditorSupport(e)?i.openInPreferredEditor(S,e,_,d,{fileViewOrigin:s}):d()}}}openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:o,user:n,fileViewOrigin:s,onFileViewerUnmount:r,shouldFocusApproval:a,skipFileViewerRouting:l,performSpaRouting:c,editActivationParams:d}){const f=i.context(this.reduxStore.getState()),{isOverFreeQuota:u,hasExcludedNsIds:h}=i.browsePostTTIData(this.reduxStore.getState());let g=i.getIndexOfFile(e,this.reduxStore.getState());const m=g<0?[e]:i.sortedFilesWithFolderSizes(this.reduxStore.getState()).toArray();g<0?g=0:m[g]=e;if(i.browsePostTTIExperiments(i.getStoreForBrowse().getState()).expCloudDocsWebShortcutPreviews?e.is_cloud_doc&&!p.POINTER_CLOUD_DOC_EXTS.includes(e.ext):e.is_cloud_doc)i.openCloudDoc(e,n,i.WebBrowseSource);else{const r=l?()=>{const e=i.CompatLocation.getLocation(),t=new URLSearchParams(e.search);t.delete("preview"),i.CompatNavigate.navigateReplace(`${e.pathname}?${t.toString()}`)}:void 0,p="browse_previews";_.initializeAjaxPreviewTiming(p,!0),_.asyncOpenPreview({containerId:i.BROWSE_FILE_VIEWER_ELEMENT_ID,files:m,indexOfPreviewFile:g,shouldFocusComment:t,activeCommentThreadId:o,user:n,fileViewOrigin:s,browseContext:f,browseExceptions:{hasExcludedNsIds:h,isOverFreeQuota:u},shouldFocusApproval:a,skipFileViewerRouting:l,onCloseViewer:r,ajaxTimerName:p,editActivationParams:d}).then((()=>{if(c){const t=i.CompatLocation.getLocation(),o=new URLSearchParams(t.search);o.append("preview",i.getFilename(e)),i.CompatNavigate.navigate(`${t.pathname}?${o.toString()}`)}}))}}};function P({args:e,action_type:t,action_source:o,action_surface:n,extra:s}){var r;const{user:a,files:l,isSearchMode:c,source:d,viewType:_,isSidebar:f}=e,{num_files_selected:u,num_folders_selected:h}=i.countFilesAndFolders(l),g=e.actionSurface?e.actionSurface:n||(f?i.ActionSurfaceLogValue.RIGHT_SIDEBAR:i.ActionSurfaceLogValue.OVERFLOW_MENU),p=e.actionSource?e.actionSource:o,m=l.first();c?i.logResultAction(t,i.resultsList(i.getStoreForSearch().getState()),m,g,p,Object.assign(Object.assign({},s),{num_files_selected:u.toString(),num_folders_selected:h.toString(),right_sidebar_state:null!==(r=e.rightRailState)&&void 0!==r?r:null})):m instanceof i.FileSharedWithMe||i.logBrowseAction({uid:a.id,source:d,action:t,num_files_selected:u,num_folders_selected:h,view_type:_,result:m,action_surface:g,action_source:p,right_sidebar_state:e.rightRailState,extra:s})}class D extends m.React$1.Component{constructor(e){super(e),this.onClickCheckbox=()=>{this.setState({checkboxMarked:!this.state.checkboxMarked})},this.onRequestClose=()=>{this.setState({isModalOpen:!1}),i.dispatchModalClosed()},this.onRequestLock=()=>{this.props.onLock(),this.state.checkboxMarked&&this.props.onNeverShowAgain()},this.state={checkboxMarked:!1,isModalOpen:!0}}render(){const e=S.intl.formatMessage({id:"cRptek",defaultMessage:"Lock editing for this file?"}),t=i.defineMessage({id:"dBZbCY",defaultMessage:"Only you can make changes to <st>{path}</st> while editing is locked. Anyone else with access to the file can still view it."}),o=S.intl.formatMessage({id:"iR68zV",defaultMessage:"Lock"}),n=S.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),s=S.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),r=S.intl.formatMessage({id:"s0mqEc",defaultMessage:"Don’t ask me this again"});return m.React$1.createElement(v.UtilityModal,{title:e,primaryAction:o,onReady:i.dispatchModalOpened,onPrimaryAction:this.onRequestLock,secondaryAction:n,onRequestClose:this.onRequestClose,ariaLabel:e,open:this.state.isModalOpen,shouldFocusAfterRender:!0,link:s,onLink:()=>{i.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},m.React$1.createElement(F.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),S.intl.formatMessage(t,{st:e=>m.React$1.createElement("strong",null,e),path:this.props.filename}),m.React$1.createElement("div",{className:"checkbox-with-label"},m.React$1.createElement(i.Checkbox,{checked:this.state.checkboxMarked?"checked":"unchecked",onChange:this.onClickCheckbox,id:"accept-checkbox"}),m.React$1.createElement("label",{className:"checkbox-with-label-label",htmlFor:"accept-checkbox"},m.React$1.createElement("div",null,r))))}}D.displayName="FileLockConfirmModalBase";const W=i.requireCssWithComponent(D,["/static/metaserver/static/css/file_locking/file_locking_modal-vflDp2_5Q.css"]),B=e=>()=>{e(),i.dispatchModalClosed()},V="do_not_show_lock_confirmation_dialog";function q(){return S.intl.formatMessage({id:"uGHYAs",defaultMessage:"Unlocked editing. Any one else with access can edit again."})}function $(e){return{entries:e.map((e=>({path:e.fq_path})))}}function H(e){return e.result.then((t=>t.entries&&t.entries.length>0&&t.entries.every((e=>"success"===e[".tag"]))?(i.Snackbar.complete(e.onSuccessMsg(t),"file-lock-status"),Promise.resolve()):Promise.reject())).catch((()=>(i.Snackbar.fail(e.onFailMsg,"file-lock-status"),Promise.reject())))}function j(e,t){const o=()=>{!function(e,t){n.__awaiter(this,void 0,void 0,(function*(){const o=(new i.UserApiV2Client).ns("files").rpc("lock_file_batch",$(t),{subjectUserId:e});yield H({result:o,onSuccessMsg:e=>S.intl.formatMessage({id:"nv3jy/",defaultMessage:"Editing locked. Now only you can make changes."}),onFailMsg:S.intl.formatMessage({id:"MmwXT2",defaultMessage:"Locking editing failed."})})}))}(e,[t])},s=()=>{b.Cookies.create(V,"true",365)};"true"===b.Cookies.read(V)?o():E.showModal((({filename:e,onLock:t,onNeverShowAgain:o})=>m.React$1.createElement(W,{onLock:t,onNeverShowAgain:o,filename:e}))({filename:i.filename(t.fq_path),onLock:o,onNeverShowAgain:s}))}function G(e,t){void 0!==t.ts_locked&&void 0!==t.lockholder_name?E.showModal((({lockCreatedTime:e,lockholderName:t,onRequestUnlock:o})=>{const n=S.intl.formatMessage({id:"yd0RsA",defaultMessage:"Editing is locked for this file"}),s=i.defineMessage({id:"iRKebb",defaultMessage:"{lockholder_name} temporarily locked editing for this file {ago}. You can view it while it’s locked, or ask them to unlock it."}),r=S.intl.formatMessage({id:"PMI4xl",defaultMessage:"Ask to unlock"}),a=S.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),l=S.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),c=1e3*Number(e),d=i.agoFromDate(new Date(c),new Date);return m.React$1.createElement(v.UtilityModal,{title:n,primaryAction:r,onReady:i.dispatchModalOpened,onPrimaryAction:B(o),secondaryAction:a,onRequestClose:i.dispatchModalClosed,ariaLabel:n,open:!0,shouldFocusAfterRender:!0,link:l,onLink:()=>{i.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},m.React$1.createElement(F.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),S.intl.formatMessage(s,{lockholder_name:t,ago:d}))})({lockCreatedTime:t.ts_locked,lockholderName:t.lockholder_name,onRequestUnlock:()=>{!function(e,t){n.__awaiter(this,void 0,void 0,(function*(){const o=i.File.getFilename(t[0]),n=t[0].lockholder_name,s=(new i.UserApiV2Client).ns("files").rpc("request_unlock_file_batch",$(t),{subjectUserId:e});yield H({result:s,onSuccessMsg:e=>{const t=e.entries[0];return t.lock&&t.lock.content&&"unlocked"===t.lock.content[".tag"]?q():S.intl.formatMessage({id:"im3MR+",defaultMessage:"Asked {name} to unlock {filename}"},{filename:o,name:n})},onFailMsg:S.intl.formatMessage({id:"i/KiYl",defaultMessage:"Error asking {name} to unlock {filename}"},{filename:o,name:n})})}))}(e,[t])}})):i.Snackbar.fail(S.intl.formatMessage({id:"LDj5Eu",defaultMessage:"Could not ask to unlock. Please try again later."}),"file-lock-status")}function K(e){P({args:e,action_type:i.WebUserActionLogEvent.REQUEST_FILES_CLICK});const{ns_id:t,ns_path:o}=e.files.first();i.redirect(`/requests?ns_id=${t}&path=${o}&referrer=web_browse_file_action`)}function z(e){P({args:e,action_type:i.WebUserActionLogEvent.RENAME});i.getStoreForFilesView().dispatch(i.setFileRename({file:e.files.first(),renameState:i.RenameState.PENDING_INPUT}))}function Y(e,t){U.logBrowseTTS("download_file"),P({args:e,action_type:i.WebUserActionLogEvent.DOWNLOAD});const{user:o,files:a}=e;!function({files:e,context:t,user:o,source:a,root_ns_id:l}){n.__awaiter(this,void 0,void 0,(function*(){if(1===e.count()&&!e.first().is_dir&&!i.isUnmountedBackupBrowse(o,l)){const t=e.first();return void r.downloadSingleFile({href:t.href,source:a,isFswm:t instanceof i.FileSharedWithMe})}if(!t.blockHash)return;const n=t.currentFQPath,c=e.toArray().map((e=>e.fq_path));s.get_zip({fq_paths:c,subject_uid:o.id,block_hash:t.blockHash,parent_path:n,source:`${a}_zip`,root_ns_id:l})}))}({files:a,context:t,user:o,source:e.isSearchMode?"search":"browse",root_ns_id:i.isBackupBrowse()&&t.rootNSID?t.rootNSID:void 0}),i.UserSurvey.trackEvent("download_item","browse")}function Q(e){P({args:e,action_type:i.WebUserActionLogEvent.ADD_COMMENT});const t=e.files.first();t instanceof i.FileSharedWithMe?i.redirect(t.href):e.isSearchMode?i.getStoreForSearch().dispatch(i.setPreviewFile({previewFileId:t.file_id})):N.navigateToFileOrFolder({file:t,shouldFocusComment:!0})}function X(e){P({args:e,action_type:i.WebUserActionLogEvent.RENAME_TEAM_FOLDER}),i.showContentManagerBridge(e.files.toArray(),"rename",i.Viewer.get_viewer().team_is_limited)}function Z(e){P({args:e,action_type:i.WebUserActionLogEvent.ARCHIVE}),i.showContentManagerBridge(e.files.toArray(),"archive",i.Viewer.get_viewer().team_is_limited)}function J(e){P({args:e,action_type:i.WebUserActionLogEvent.LOCK_FILE}),j(e.user.id,e.files.first())}function ee(e){P({args:e,action_type:i.WebUserActionLogEvent.UNLOCK_FILE}),function(e,t){n.__awaiter(this,void 0,void 0,(function*(){const o=(new i.UserApiV2Client).ns("files").rpc("unlock_file_batch",$(t),{subjectUserId:e});yield H({result:o,onSuccessMsg:e=>q(),onFailMsg:S.intl.formatMessage({id:"v/COiN",defaultMessage:"Unlocking editing failed."})})}))}(e.user.id,[e.files.first()])}function te(e){P({args:e,action_type:i.WebUserActionLogEvent.REQUEST_UNLOCK_FILE}),G(e.user.id,e.files.first())}function oe(e){var t,o;P({args:e,action_type:i.WebUserActionLogEvent.VERSIONS});const n=i.isBackupBrowse()&&(null===(t=e.context)||void 0===t?void 0:t.rootNSID)?{inside_backup:"true",ns_id:`${null===(o=e.context)||void 0===o?void 0:o.rootNSID}`,return_url:i.get_href()}:{},s=a.getFileHistoryUrl({fqPath:e.files.first().fq_path,userId:e.user.id},n);i.redirect(s)}function ie(e){P({args:e,action_type:i.WebUserActionLogEvent.EVENTS}),i.redirect(`/events?ns=${e.files.first().target_ns}`)}function ne(e){P({args:e,action_type:i.WebUserActionLogEvent.CALCULATE_SIZE});const{files:t}=e;c.browseActions.fetchMultipleFolderSizes({files:t})}function se(t){new Promise((function(t,o){e(["./c_sharing_content_manager"],t,o)})).then((({goToContentManagerForPath:e})=>{const o=t.files.first();e({containingFolder:o.is_dir?o.fq_path:i.parent_dir(o.fq_path)})}))}function re(e,{snackbarWithShowButton:t}){P({args:e,action_type:i.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN});const o=i.getStoreForFolderOverview(),n=i.path(o.getState());o.dispatch(d.addContentReferences({folderFileId:d.folderOverviewFolderFileId(o.getState()),fileIds:e.files.toArray().map(i.fileToContentReferenceId),componentNamespace:i.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{c.browseActions.setUrl({path:n,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:i.filename(n,i.Viewer.get_root_name(e.user))}:void 0}))}function ae(t,o,{snackbarWithShowButton:n}){const{files:s,user:r}=t;(t=>{new Promise((function(t,o){e(["./c_folder_overview_pin_to_modal"],t,o)})).then((({FolderOverviewPinToModal:e})=>e.show(t)))})({user:r,path:o.currentFQPath,files:s.toArray(),onFolderSelected:e=>{P({args:t,action_type:i.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN}),i.getStoreForFolderOverview().dispatch(d.addContentReferencesForPath({files:s.toArray(),path:e,currentPath:o.currentFQPath,snackbarConfig:n?{onShow:()=>{c.browseActions.setUrl({path:e,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:i.filename(e,i.Viewer.get_root_name(r))}:void 0}))},isCurrentPathReadOnly:!o.isCurrentPathWriteable()})}function le(e,t){P({args:e,action_type:i.WebUserActionLogEvent.FOLDER_OVERVIEW_UNPIN});const o=i.getStoreForFolderOverview(),n=i.path(o.getState());o.dispatch(d.removeContentReferences({folderFileId:d.folderOverviewFolderFileId(o.getState()),fileIds:e.files.toArray().map(i.fileToContentReferenceId),componentNamespace:i.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{c.browseActions.setUrl({path:n,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:i.filename(n,i.Viewer.get_root_name(e.user))}:void 0}))}function ce(e,t){U.logBrowseTTS("delete_file"),P({args:e,action_type:i.WebUserActionLogEvent.DELETE}),i.UserSurvey.trackEvent("delete_item","browse");const o=e.files.toArray(),n=o.some(i.File.isTeamSharedFolder),s=o.some((e=>e.read_only)),r=o.every((e=>e.isDeleted));if(!t.isCurrentPathWriteable()||n||s)n?I.Notify.error(S.intl.formatMessage({id:"AjarNz",defaultMessage:"Team folders can’t be deleted."})):I.Notify.warning(S.intl.formatMessage({id:"q5LxGC",defaultMessage:"You don’t have permission to delete files in this folder."}));else if(e.isSearchMode){const n=i.getStoreForSearch();r?n.dispatch(i.purgeFiles({files:o,user:e.user,context:t})):n.dispatch(M.deleteFiles({files:o}))}else r?c.browseActions.doPermanentDeleteWithModal(o):c.browseActions.doDeleteFilesWithModal({files:o})}function de(e){P({args:e,action_type:i.WebUserActionLogEvent.DELETE_DEVICE_FOLDER});const t=e.files.map((e=>e.fq_path)).toArray();c.browseActions.openBackupDeleteDeviceFolderModal(t)}function _e(e,t){P({args:e,action_type:i.WebUserActionLogEvent.RESTORE});const o=e.files.toArray();if(e.isSearchMode){i.getStoreForSearch().dispatch(i.restoreFiles$1({files:o,user:e.user,context:t}))}else c.browseActions.doRestoreFilesWithUnifiedTrashModal({files:o})}function fe(e,t){P({args:e,action_type:i.WebUserActionLogEvent.PERMANENT_DELETE});const o=e.files.toArray();if(e.isSearchMode){i.getStoreForSearch().dispatch(i.purgeFiles({files:o,user:e.user,context:t}))}else c.browseActions.doPermanentDeleteWithModal(o)}function ue(e){P({args:e,action_type:i.WebUserActionLogEvent.STAR}),ge(e,!0)}function he(e){P({args:e,action_type:i.WebUserActionLogEvent.REMOVE_STAR}),ge(e,!1)}function ge(e,t){const o=e.files.first();i.getStoreForStarred().dispatch(i.updateStarredStatus({id:o.file_id,newStatus:t,itemName:i.itemNameFromStarrableItem(o),showSnackbar:!0}))}function pe(e,t){P({args:e,action_type:i.WebUserActionLogEvent.OPEN_EXTENSIONS,action_surface:t})}function me(e,t,o){P({args:e,action_type:i.WebUserActionLogEvent.EXTENSIONS_SELECTED,action_surface:t,extra:{extensions_option:o||"unknown"}})}function Se(e){P({args:e,action_type:i.WebUserActionLogEvent.REWIND_CLICK});const t=i.browse_uri_for_fq_path(e.user,e.files.first().fq_path);t.setQuery({rewind:"true"}),i.replace_location(t.toString())}function we(e,t){const o=e.files.first().target_ns;o?(P({args:e,action_type:i.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK}),L.asyncMountSharedFolder({shared_folder_id:o,origin:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,target_file:null,user:e.user})):P({args:e,action_type:i.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK,extra:{error:"No nsId found, no-op"}})}function Ee(e){P({args:e,action_type:i.WebUserActionLogEvent.ADD_TO_TRANSFER});k.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>{const t=e.files.toArray(),o=O.prepareFileIdsParam(t);i.Snackbar.sync(S.intl.formatMessage({id:"EmOY+w",defaultMessage:"Creating new transfer..."}),!1,"create-transfer");let n="browse";e.actionSurface&&(n=`browse_${e.actionSurface}`,e.actionSurface===i.ActionSurfaceLogValue.RIGHT_SIDEBAR&&1===t.length?n=`browse_${e.actionSurface}_single_file`:e.actionSurface===i.ActionSurfaceLogValue.RIGHT_SIDEBAR&&t.length>1&&(n=`browse_${e.actionSurface}_multi_file`)),i.redirect(O.createTransferUrlWithParams({referrer:n,fileids:o}))},userId:e.user.id})}function ve(e){const{files:t}=e,o=t.first(),{file_id:n}=o;i.unsafeRedirect(`https://replay.dropbox.com/project/creating/${n}?creationSource=dropbox_web`)}function Fe(e){U.logBrowseTTS("open_in_new_tab");const{files:t,user:o}=e,n=t.first();let s;s=n.is_dir?i.browse_uri_for_fq_path(o,n.fq_path):i.preview_uri_for_fq_path(o,n.fq_path),window.open(s.toString(),"_blank")}function be(e,t){U.logBrowseTTS("preview_dropbox");const{files:o,user:n,rightRailState:s}=e,r=o.first();if(e.isSearchMode){i.getStoreForSearch().dispatch(i.handleNavigateToFileOrFolder(r,{actionSource:t}))}else{const{ns_id:o,sjid:a,file_id:l,fq_path:c,bytes:d,ext:_,request_id:f}=r;i.logOpenRow({uid:n.id,entity_type:r.is_dir?"folder":"file",source:"list_browse",view_type:e.viewType,file_nsid:o,file_sjid:a,file_id:l,file_name:i.filename(r.fq_path),file_path:c,file_size:d,file_type:r.type,file_extension:_,request_id:f,action_source:t,rightRailState:s}),t===i.ActionSourceValue.DETAILS_PANE_PREVIEW&&i.logBrowseAction({uid:n.id,num_files_selected:1,num_folders_selected:0,action:i.WebUserActionLogEvent.THUMBNAIL_OPEN_PREVIEW,action_surface:i.ActionSurfaceLogValue.RIGHT_SIDEBAR,right_sidebar_state:"opened"}),N.openPreviewForBrowseFile({file:r,shouldFocusComment:!1,user:n,fileViewOrigin:i.FileViewOriginType.BROWSE,onFileViewerUnmount:()=>{}})}}function ke(e,t,o,n=!0){var s,r;P({args:e,action_type:i.WebUserActionLogEvent.OPEN_DESKTOP});const a=e.files.first(),l=a?a.ns_id:null===(s=e.context)||void 0===s?void 0:s.currentNSID,c=a?a.ns_path:null===(r=e.context)||void 0===r?void 0:r.currentNSPath;C.UnityFeatures.open_file(l||null,c||"/",e.user.id,t,o,n)}function Re(e,t,o,i){U.logBrowseTTS("open_in_finder");ke(e,(e=>(t&&t(e),C.UnityFeatures.standard_open_file_handler(e))),(e=>{o&&o(e),C.UnityFeatures.standard_open_file_handler(!1)}),i)}function Ae(e,t,n,s,r,a){U.logBrowseTTS("copy_link"),P({args:e,action_type:i.WebUserActionLogEvent.SHARE_COPY_LINK});const l=e.isSearchMode?i.getStoreForSearch():i.getStoreForBrowse();o.CopyLinkMiniModal.show({user:e.user,file:e.files.first()||e.currentFolderInfo,setIsCreatingSharedLink:(t,o)=>{l.dispatch({type:e.isSearchMode?i.ActionTypes$2.SET_IS_CREATING_SHARED_LINK:i.ActionTypes$1.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:o,isCreatingSharedLink:t}})},userActionSource:e.actionSource,anchorRef:t,onHoverLocked:n,onActionFlowComplete:s,userActionSurfaceLogValue:e.actionSurface,rightRailCollapsed:"collapsed"===e.rightRailState,isInCopyLinkRightRailExpt:"ON"===a,isInUserLevelSharingSettings:"ON"===r})}function ye(e){const{user:t,files:o}=e,n=o.map((e=>e.fq_path)).toArray();P({args:e,action_type:i.WebUserActionLogEvent.SHOW_IN_FOLDER}),l.handleShowInFolder({fqPaths:n,user:t})}function Me(t,o){const{files:n,user:s}=t,r=n.first();return r&&T.isBrowseFile(r)&&s?".pdf"===r.ext&&o?(P({args:t,action_type:i.WebUserActionLogEvent.SELF_SIGN_ENTRY_POINT}),N.openPreviewForBrowseFile({file:r,shouldFocusComment:!1,user:s,fileViewOrigin:i.FileViewOriginType.BROWSE,onFileViewerUnmount:()=>{},editActivationParams:{source:"browse_overflow_menu_self_sign",highlight:"sign"}}),Promise.resolve()):new Promise((function(t,o){e(["./c_integrations_hellosign_deep_integration_launcher"],t,o)})).then((({getLauncher:e})=>{const n=e();return n.init({entryPoint:o?"file_hover_overflow_menu_self_sign":"file_hover_overflow_menu",file:r,user:s,source:o?"dropbox-file-hover-overflow-menu-send-for-self-sign":"dropbox-file-hover-overflow-menu-send-for-esign",selfSign:o}),P({args:t,action_type:o?i.WebUserActionLogEvent.SELF_SIGN_ENTRY_POINT:i.WebUserActionLogEvent.SEND_FOR_SIGNATURE}),n})).then((e=>(e.launch(),e))):Promise.resolve()}var Le=Object.freeze({__proto__:null,handleRequestFiles:K,handleRename:z,handleDownload:Y,handleComment:Q,handleRenameTeamFolder:X,handleArchive:Z,handleFileLock:J,handleFileUnlock:ee,handleFileRequestUnlock:te,handleVersions:oe,handleEvents:ie,handleCalculateFolderSize:ne,handleManageAsAdmin:se,handleBrowsePin:re,handleBrowsePinTo:ae,handleUnpin:le,handleDelete:ce,handleBackupDeleteDeviceFolder:de,handleRestore:_e,handlePermanentDelete:fe,handleStar:ue,handleUnstar:he,handleExtensionDropdownOpen:pe,handleExtensionClick:me,handleRewind:Se,handleReAdd:we,handleAddToTransfer:Ee,handleReplay:ve,handleOpenInNewTab:Fe,handlePreview:be,handleOpenInDesktopWithoutStandardHandlers:ke,handleOpenInDesktop:Re,handleShareCopyLink:Ae,handleShowInFolder:ye,handleSendForSignature:Me});t.action_handlers_esnext=Le,t.browseNavigateActions=N,t.handleAddToTransfer=Ee,t.handleArchive=Z,t.handleBackupDeleteDeviceFolder=de,t.handleBrowsePin=re,t.handleBrowsePinTo=ae,t.handleCalculateFolderSize=ne,t.handleComment=Q,t.handleDelete=ce,t.handleDownload=Y,t.handleEvents=ie,t.handleExtensionClick=me,t.handleExtensionDropdownOpen=pe,t.handleFileLock=J,t.handleFileRequestUnlock=te,t.handleFileUnlock=ee,t.handleManageAsAdmin=se,t.handleOpenInDesktop=Re,t.handleOpenInDesktopWithoutStandardHandlers=ke,t.handleOpenInNewTab=Fe,t.handlePermanentDelete=fe,t.handlePreview=be,t.handleReAdd=we,t.handleRename=z,t.handleRenameTeamFolder=X,t.handleReplay=ve,t.handleRequestFiles=K,t.handleRestore=_e,t.handleRewind=Se,t.handleSendForSignature=Me,t.handleShareCopyLink=Ae,t.handleShowInFolder=ye,t.handleStar=ue,t.handleUnpin=le,t.handleUnstar=he,t.handleVersions=oe,t.logUserEventOnFile=P}));
//# sourceMappingURL=c_browse_file_actions_action_handlers.js-vfl58BflG.map
