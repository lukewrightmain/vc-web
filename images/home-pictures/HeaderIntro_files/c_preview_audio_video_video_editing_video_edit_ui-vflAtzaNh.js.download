define(["exports","./e_edison","./e_ui_page_files_router","./c_tslib","./c_src_preview_audio_video_preview_video","./c_core_utils_time_utils","./c_preview_audio_video_video_editing_utils","./c_src_file_viewer_components","./c_preview_audio_video_helper_utils","./c_ui-icon_line_shape-rotate-right","./c_ui-icon_line_flip-vertical","./c_ui-icon_line_sound-on","./c_ui-icon_line_redo","./c_ui-icon_line_undo","./c_preview_audio_video_video_editing_strings","./c_src_video_controls_audio_video_markers","./c_src_core_resizer","./c_core_logging_constants","./c_src_video_controls_video_controls_toolbar","./c_src_ui_error_boundary","./c_core_uri","./c_lodash-es_lodash","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_notify","./c_core_i18n","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","./c_videojs_dist_video","./c__node-resolve_empty","./c_preview_audio_video_helper_image_size","./c_ui-icon_line_settings","./c_ui-icon_fill_sound-on","./c_ui-icon_line_sidebar-show","./c_core_logging_video","./c_src_logging_performance","./c_ui-icon_fill_play-circle","./c_src_hooks_use_toolbar_override","./c_core_utils_redesign2023","./c_api_v2_redux_files","./c_resize-observer-polyfill_dist_ResizeObserver","./c_ui-icon_line_collapse-right","./c_ui-icon_line_expand-left","./c_truncate_index","./c_core_types_preview_type","./c_src_file_extension_extension_constants","./c_src_simple-action-bar_action_bar_types","./c_src_toolbar","./c_ui-icon_line_more-horizontal","./c_ui-icon_line_zoom-out","./c_breadcrumb_index","./c_ui-icon_line_comment","./c_ui-icon_line_rotate-left","./c_ui-icon_line_closed-captions","./c_ui-icon_line_globe","./c_ui-icon_line_video","./c_ui-icon_line_audio"],(function(e,t,a,i,n,r,o,l,c,s,d,u,m,g,p,f,v,_,R,E,h,C,$,b,y,T,w,k,M,V,S,A,x,I,F,N,U,O,P,D,B,H,j,L,z,K,W,J,q,G,X,Z,Q,Y,ee,te,ae,ie,ne,re,oe,le,ce,se,de,ue,me,ge,pe,fe,ve,_e,Re,Ee,he,Ce,$e,be,ye,Te,we,ke){"use strict";const Me=t.React$1.memo((()=>t.React$1.createElement("svg",{width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t.React$1.createElement("rect",{x:"6.5",y:"3.66663",width:"11",height:"18",rx:"1.5",fill:"#1E1919"}),t.React$1.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.875 16.2916V9.04163H11.625V16.2916H10.875Z",fill:"#F7F5F2"}),t.React$1.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.375 16.2916V9.04163H13.125V16.2916H12.375Z",fill:"#F7F5F2"}))));Me.displayName="HandleIconSvg";const Ve=t.React$1.memo((e=>{var{className:r}=e,o=i.__rest(e,["className"]);return t.React$1.createElement("div",Object.assign({className:a.classnames(n.trimHandle,r)},o,{tabIndex:0}),t.React$1.createElement(Me,null))}));Ve.displayName="HandleIcon";const Se=({duration:e,isDragging:i,position:l,tooltipRef:c,onDrag:s,onKeyDown:d})=>{const[u,m]=t.React$1.useState("left"===l?0:e),[g,p]=t.React$1.useState("left"===l?null:e),[f,v]=t.React$1.useState(!1),_=r.formatTime(u,e,r.showTimestampDecimalPlaces(e)),R=t.React$1.useRef(null),E=t.React$1.useRef(null),h=t.React$1.useRef();t.React$1.useImperativeHandle(c,(()=>({updateTimestamp:e=>{m(e)},updateTrimmedDuration:e=>{p(e)},showTooltip:()=>{var e;null===(e=E.current)||void 0===e||e.update(),v(!0),null!=h.current&&(window.clearTimeout(h.current),h.current=null),h.current=window.setTimeout((()=>{v(!1),h.current=null}),o.TOOLTIP_TIMEOUT)}})));const C=t.React$1.useCallback((()=>{v(!1)}),[]),$=t.React$1.useCallback((e=>{var t;v(!0),null===(t=E.current)||void 0===t||t.update(),s(e)}),[]),b=t.React$1.useCallback((()=>{v(!0)}),[]),y=t.React$1.useCallback((()=>{v(!1)}),[]),T=t.React$1.useCallback((e=>{e.stopPropagation()}),[]),w="right"===l&&null!=g&&!isNaN(g)&&!i&&e>0,k=((e,t)=>{const i=a.useIntl();return"left"===e?i.formatMessage({id:"Lz9Zn2",defaultMessage:"Minimum trim position: {timeStamp}. Use arrow keys to adjust"},{timeStamp:t}):i.formatMessage({id:"8l1nHe",defaultMessage:"Maximum trim position: {timeStamp}. Use arrow keys to adjust"},{timeStamp:t})})(l,_);return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement("div",{className:a.classnames(n.trimDragBox,{[n.leftBox]:"left"===l,[n.rightBox]:"right"===l}),ref:R},t.React$1.createElement("div",{className:n.trimHandleWrapper},t.React$1.createElement(Ve,{className:a.classnames({[n.rightHandle]:"right"===l,[n.leftHandle]:"left"===l}),onFocus:b,onBlur:y,draggable:!0,onClick:T,onDrag:$,onDragEnd:C,onKeyDown:d,"aria-label":k})),w&&t.React$1.createElement(a.AccessoryBadge,{status:"attention",className:n.trimTimestamp},r.formatTime(g,e,r.showTimestampDecimalPlaces(e)))),t.React$1.createElement(a.Tooltip.Control,{open:f,placement:"top",triggerRef:R,auto:!0,ref:E,inverse:!1},_))};Se.displayName="TrimControlBarHandle";const Ae=({markerRef:e,tooltipControlRef:i,className:r,isMarkerVisible:l})=>{const[c,s]=t.React$1.useState(!1),[d,u]=t.React$1.useState(""),m=t.React$1.useRef(null),g=t.React$1.useRef();return t.React$1.useImperativeHandle(i,(()=>({showTooltip:e=>{var t;null===(t=m.current)||void 0===t||t.update(),s(!0),null!=g.current&&(window.clearTimeout(g.current),g.current=null),g.current=window.setTimeout((()=>{s(!1),g.current=null}),o.TOOLTIP_TIMEOUT),u(e)}}))),t.React$1.useEffect((()=>{var t;null===(t=m.current)||void 0===t||t.update(),o.updateElementVisibility(e,!l),l||s(!1)}),[l]),t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement("div",{className:a.classnames(n.trimTimeMarker,r),ref:e,style:{left:o.TRIM_BORDER_ADJUSTMENT},tabIndex:0}),t.React$1.createElement(a.Tooltip.Control,{open:c,placement:"top",triggerRef:e,auto:!0,inverse:!1,ref:m,shouldDisablePointerEvents:!0},d))};Ae.displayName="TimeMarker";const xe=e=>{var{labelControlRef:n}=e,r=i.__rest(e,["labelControlRef"]);const o=a.useIntl();return t.React$1.useImperativeHandle(n,(()=>({updateAriaLabel:e=>{r.markerRef.current&&(r.markerRef.current.ariaLabel=o.formatMessage({id:"anC2Jd",defaultMessage:"Current playback position: {timeStamp}"},{timeStamp:e}))}}))),t.React$1.createElement(Ae,Object.assign({},r))};xe.displayName="PlaybackTimeMarker";const Ie=({containerWidth:e,duration:i,player:s,updateVideoEditState:d,overrideTrimState:u,currentTrimState:m,trimUiWrapperRef:g,lastCursorRef:p})=>{const f=a.useIntl(),v=t.React$1.useMemo((()=>o.getWrapperBounds(e)),[e]),_=t.React$1.useMemo((()=>o.getEmptyDragImage()),[]),R=t.React$1.useRef(null),E=t.React$1.useRef(null),h=t.React$1.useRef(null),C=t.React$1.useRef(null),$=t.React$1.useRef(null),b=t.React$1.useRef(null),y=t.React$1.useRef(null),T=t.React$1.useRef(null),w=t.React$1.useRef(null),k=t.React$1.useRef(null),M=t.React$1.useRef(0),V=t.React$1.useRef(i),S=t.React$1.useRef(0),A=t.React$1.useRef(o.getRightPositionFromTimestamp(i,i,v)),[x,I]=t.React$1.useState(!1),[F,N]=t.React$1.useState(!1),[U,O]=t.React$1.useState(!1),P=t.React$1.useCallback((e=>{R.current=e,null==e||e.focus()}),[]),D=t.react.exports.useCallback((({leftHandle:e,rightHandle:t})=>{var a,n,r;if(null==e&&null==t)return;const l=null!=e?e:S.current,c=null!=t?t:A.current;o.updatePositionStyle(E,{left:l,width:c-l}),o.updatePositionStyle(h,{width:l}),o.updatePositionStyle(C,{width:Math.max(v.trackEnd-c,0),right:0}),S.current=l,A.current=c;const s=o.getLeftTimestamp(S.current,i,v),d=o.getRightTimestamp(A.current,i,v);null===(a=w.current)||void 0===a||a.updateTimestamp(s),null===(n=k.current)||void 0===n||n.updateTimestamp(d),null===(r=k.current)||void 0===r||r.updateTrimmedDuration(d-s),M.current=s,V.current=d}),[i,e]),B=t.react.exports.useCallback((e=>{var t;const a=r.formatTime(null!=e?e:s.currentTime(),i,r.showTimestampDecimalPlaces(i));null===(t=b.current)||void 0===t||t.updateAriaLabel(a)}),[s,i]),H=t.react.exports.useCallback((e=>{const t=o.getPlaybackTimestamp(e,i,v);s.currentTime(t),B(t)}),[s,i,v]),j=t.react.exports.useCallback(((e,t)=>{o.updatePositionStyle(e,{left:t})}),[]);t.React$1.useEffect((()=>{if(s&&i>0&&u){const e=o.getLeftPositionFromTimestamp(u.start,i,v),t=o.getRightPositionFromTimestamp(u.end,i,v);D({leftHandle:e,rightHandle:t});const a=o.getPlaybackTimeMarkerPositionFromTimestamp(s.currentTime(),i,v),n=e+o.LEFT_BORDER_ADJUSTMENT,r=t-o.RIGHT_BORDER_ADJUSTMENT;if(a<n||a>r){const e=Math.max(n,Math.min(r,a));j($,e),s.pause(),H(e)}}}),[u]),t.React$1.useEffect((()=>{if(m&&s){const e=o.getLeftPositionFromTimestamp(m.start,i,v),t=o.getRightPositionFromTimestamp(m.end,i,v);D({leftHandle:e,rightHandle:t});const a=o.getPlaybackTimeMarkerPositionFromTimestamp(s.currentTime(),i,v);j($,a)}}),[e]);const L=t.React$1.useCallback((e=>{const t=o.getLeftTimestamp(e.leftHandle,i,v),a=o.getRightTimestamp(e.rightHandle,i,v);d((e=>Object.assign(Object.assign({},e),{trim:{start:t,end:a},counts:Object.assign(Object.assign({},e.counts),{trim:e.counts.trim+1})})))}),[i,v,d]);t.React$1.useEffect((()=>c.setupVideoJsEvents(s,{timeupdate:W,play:z,ended:K})),[s]);const z=l.useStabilizedCallback((()=>{if(s){if(O(!0),null==V.current)return;const e=s.currentTime();if(e>=V.current||0===e||e<M.current){const e=o.getLeftTimestamp(S.current,i,v);s.currentTime(e),B(e),s.play()}}})),K=l.useStabilizedCallback((()=>{if(s){const e=Math.min(s.currentTime(),V.current),t=o.getPlaybackTimeMarkerPositionFromTimestamp(e,i,v);j($,t),B(e)}})),W=l.useStabilizedCallback((()=>{if(s&&!s.paused()){s.currentTime()>V.current&&s.pause();const e=Math.min(s.currentTime(),V.current),t=o.getPlaybackTimeMarkerPositionFromTimestamp(e,i,v);j($,t),B(e)}}));t.React$1.useEffect((()=>{s&&s.currentTime()>0&&(O(!0),W())}),[]);const J=l.useStabilizedCallback((e=>{x&&(e.preventDefault(),I(!1),L({leftHandle:S.current,rightHandle:A.current}))})),q=l.useStabilizedCallback((e=>{var t;e.stopPropagation();const a=e.clientX||(null===(t=p.current)||void 0===t?void 0:t.clientX)||0,i=o.calculateLeftHandlePosition(a,R,v,A.current);if(null!=i){s.paused()||s.pause();const e=o.getElementLeft($);if(e&&i<e&&o.shouldAutoSnapHandle(i,e))D({leftHandle:e-o.LEFT_BORDER_ADJUSTMENT});else{D({leftHandle:i});const t=i+o.LEFT_BORDER_ADJUSTMENT;H(t),j(y,t),e&&e<t&&j($,t)}I(!0),O(!0)}})),G=l.useStabilizedCallback((e=>{var t;e.stopPropagation();const a=e.clientX||(null===(t=p.current)||void 0===t?void 0:t.clientX)||0,i=o.calculateRightHandlePosition(a,R,v,S.current);if(i){s.paused()||s.pause();const e=o.getElementLeft($);if(e&&i>e&&o.shouldAutoSnapHandle(i,e))D({rightHandle:e+o.RIGHT_BORDER_ADJUSTMENT});else{D({rightHandle:i});const t=i-o.RIGHT_BORDER_ADJUSTMENT;H(t),j(y,t),e&&e>t&&j($,t)}I(!0),O(!0)}})),X=t.React$1.useCallback((e=>{var t;const a=o.getArrowKeyTimeDelta(e,i);if(0==a)return;const{start:n,end:r}=m,l=o.clamp(n+a,0,r),c=o.getLeftPositionFromTimestamp(l,i,v);D({leftHandle:c}),j($,c+o.LEFT_BORDER_ADJUSTMENT),H(c),null===(t=w.current)||void 0===t||t.showTooltip(),L({leftHandle:c,rightHandle:A.current})}),[i,m]),Z=t.React$1.useCallback((e=>{var t;const a=o.getArrowKeyTimeDelta(e,i);if(0==a)return;const{start:n,end:r}=m,l=o.clamp(r+a,n,i),c=o.getRightPositionFromTimestamp(l,i,v);D({rightHandle:c}),j($,c-o.RIGHT_BORDER_ADJUSTMENT),H(c),null===(t=k.current)||void 0===t||t.showTooltip(),L({leftHandle:S.current,rightHandle:c})}),[i,m]),Q=t.React$1.useCallback((e=>{const t=o.getContainerLeft(R);if(null==t)return;O(!0);const a=e.clientX-t;if(a<S.current)L({leftHandle:a,rightHandle:A.current}),D({leftHandle:a});else if(a>A.current)L({leftHandle:S.current,rightHandle:a}),D({rightHandle:a});else{const t=o.calculatePlaybackTimeMarkerPosition(e,R,v,S.current,A.current);if(null==t)return;j($,t),H(t)}}),[e,i,v,L,D,j,H]),Y=t.React$1.useCallback((e=>{var t;const a=o.calculatePlaybackTimeMarkerPosition(e,R,v,S.current,A.current);if(null==a)return;j(y,a);const n=o.getHoverTimestamp(a,i,v),l=r.formatTime(n,i,r.showTimestampDecimalPlaces(i));null===(t=T.current)||void 0===t||t.showTooltip(l)}),[v,i]);t.React$1.useEffect((()=>{const e=e=>{e&&e.dataTransfer&&(e.dataTransfer.setDragImage(_,0,0),e.dataTransfer.effectAllowed="move"),e.stopPropagation()},t=e=>{e.preventDefault()},a=g.current;return a&&(a.addEventListener("dragstart",e),a.addEventListener("dragenter",t),a.addEventListener("drop",J)),()=>{a&&(a.removeEventListener("dragstart",e),a.removeEventListener("dragenter",t),a.removeEventListener("drop",J))}}),[J,g.current]);const ee=t.React$1.useMemo((()=>({left:0,width:0})),[]),te=t.React$1.useMemo((()=>({right:0,width:0})),[]),ae=t.React$1.useMemo((()=>({left:v.trackStart,width:v.trackRightOuterBound})),[]);return t.React$1.createElement("div",{className:n.trimControlTrackWrapper,ref:P,onClick:Q,onMouseMove:Y,onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),tabIndex:-1,"aria-label":f.formatMessage({id:"9pEqiL",defaultMessage:"Trim Controls"})},t.React$1.createElement("div",{className:a.classnames(n.trimControlTrackOverlay,n.leftTrackOverlay),ref:h,style:ee}),t.React$1.createElement("div",{className:a.classnames(n.trimControlTrackOverlay,n.rightTrackOverlay),ref:C,style:te}),t.React$1.createElement(xe,{className:n.trimCurrentTimeMarker,markerRef:$,isMarkerVisible:U,labelControlRef:b}),t.React$1.createElement(Ae,{className:n.trimHoverTimeMarker,markerRef:y,tooltipControlRef:T,isMarkerVisible:F&&!x}),t.React$1.createElement("div",{className:n.trimControlTrack,ref:E,style:ae},t.React$1.createElement(Se,{duration:i,isDragging:x,position:"left",tooltipRef:w,onDrag:q,onKeyDown:X}),t.React$1.createElement(Se,{isDragging:x,duration:i,position:"right",tooltipRef:k,onDrag:G,onKeyDown:Z})))},Fe=({player:e,featureConfig:i,isReplaceOriginalEnabled:r,onCancel:o,onRedo:c,onUndo:f,onSaveMenuSelection:v,isSaveEnabled:_,onRotate:R,onFlip:E})=>{const{isVideoPlaying:h,toggleVideoPlayback:C}=n.useVideoPlaybackState(e),{cancelMessage:$,saveMessage:b,saveACopyMessage:y,replaceOriginalMessage:T,undoMessage:w,redoMessage:k,replaceOriginalDisabledTooltip:M,rotateRightTooltip:V,rotateLeftTooltip:S,undoTooltipMac:A,undoTooltipWin:x,redoTooltipMac:I,redoTooltipWin:F,playButtonTooltip:N,pauseButtonTooltip:U,playLabel:O,pauseLabel:P,rotateLeftLabel:D,rotateRightLabel:B,flipHorizontallyTootltip:H,flipVerticallyTooltip:j}=p.useStrings(),L=t.React$1.useCallback((()=>R(!1)),[R]),z=t.React$1.useCallback((()=>R(!0)),[R]),K=t.React$1.useCallback((()=>E("horizontal")),[E]),W=t.React$1.useCallback((()=>E("vertical")),[E]),J=t.React$1.useMemo((()=>t.React$1.createElement(a.Button,{variant:"opacity",inverse:!0,disabled:!f,onClick:f,withIconLeft:t.React$1.createElement(a.UIIcon,{src:g.UndoLine,role:"presentation"}),style:{marginLeft:16}},w)),[f,w]),q=t.React$1.useMemo((()=>t.React$1.createElement(a.Button,{variant:"opacity",inverse:!0,disabled:!c,onClick:c,withIconLeft:t.React$1.createElement(a.UIIcon,{src:m.RedoLine,role:"presentation"})},k)),[c,k]);return t.React$1.createElement("div",{className:n.trimButtonHolder},t.React$1.createElement(a.Tooltip,{placement:"top",title:h?U:N,inverse:!1},t.React$1.createElement(a.IconButton,{variant:"opacity",inverse:!0},t.React$1.createElement(a.UIIcon,{src:h?u.PauseLine:u.PlayLine,onClick:C,"aria-label":h?P:O}))),t.React$1.createElement(a.Tooltip,{placement:"top",title:S,inverse:!1},t.React$1.createElement(a.IconButton,{variant:"opacity",inverse:!0,onClick:L,style:{marginLeft:16}},t.React$1.createElement(a.UIIcon,{src:s.ShapeRotateLeftLine,"aria-label":D}))),t.React$1.createElement(a.Tooltip,{placement:"top",title:V,inverse:!1},t.React$1.createElement(a.IconButton,{variant:"opacity",inverse:!0,onClick:z},t.React$1.createElement(a.UIIcon,{src:s.ShapeRotateRightLine,"aria-label":B}))),i.previews_exp_video_edit_flip&&t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Tooltip,{placement:"top",title:H,inverse:!1},t.React$1.createElement(a.IconButton,{variant:"opacity",inverse:!0,onClick:K,style:{marginLeft:16}},t.React$1.createElement(a.UIIcon,{src:s.FlipHorizontalLine,"aria-label":H}))),t.React$1.createElement(a.Tooltip,{placement:"top",title:j,inverse:!1},t.React$1.createElement(a.IconButton,{variant:"opacity",inverse:!0,onClick:W},t.React$1.createElement(a.UIIcon,{src:d.FlipVerticalLine,"aria-label":j})))),f?t.React$1.createElement(a.Tooltip,{placement:"top",title:l.mac?A:x,inverse:!1},J):J,c?t.React$1.createElement(a.Tooltip,{placement:"top",title:l.mac?I:F,inverse:!1},q):q,t.React$1.createElement(a.Button,{onClick:o,variant:"opacity",inverse:!0,style:{marginLeft:"auto",marginRight:8}},$),t.React$1.createElement(a.Menu.Wrapper,{onSelection:e=>{"disabled"!==e&&v(e)}},(({getTriggerProps:e,getContentProps:i})=>t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Button,Object.assign({inverse:!0,withDropdownIcon:!0,variant:"outline",disabled:!_},e()),b),t.React$1.createElement(a.Menu.Content,Object.assign({},i(),{placement:"top-end"}),t.React$1.createElement(a.Menu.Segment,null,t.React$1.createElement(a.Menu.ActionItem,{value:"save_copy"},y),r?t.React$1.createElement(a.Menu.ActionItem,{value:"replace_original"},T):t.React$1.createElement(a.Tooltip,{placement:"left",title:M,inverse:!1},t.React$1.createElement(a.Menu.ActionItem,{value:"disabled",disabled:!0,style:{pointerEvents:"all",cursor:"not-allowed"}},T))))))))};Fe.displayName="TrimControlButtonRow";const Ne=({vttThumbnailsUrl:e,duration:a,containerWidth:i,videoDimensions:r})=>{const[l,c]=t.React$1.useState(null),s=t.React$1.useRef({height:0,width:0}),d=t.React$1.useRef(1),u=t.React$1.useRef(0),m=i-2*o.TRIM_BORDER_ADJUSTMENT-2*o.TRIM_BAR_HORIZONTAL_PADDING,g=r.width/r.height;return t.React$1.useEffect((()=>{let t=!1;return f.loadVtt(e).then((e=>{const i=e.map(f.parseVttCue),{imageWidth:n,imageHeight:r}=i[0];if(null==n||null==r||m<0)return;s.current={height:r,width:Math.min(1.7777777777777777*r,r*g)},d.current=o.TRIM_BAR_HEIGHT/r,u.current=Math.max((n-s.current.width)/2,0);const l=Math.ceil(m/Math.floor(s.current.width*d.current))+1,p=[...Array(l).keys()].map((e=>o.calculateTimeFromPosition(m,m/l*e,a))).map((e=>i[Math.min(i.length-1,Math.round(e/a*i.length))])).filter(Boolean);t||c(p)})),()=>{t=!0}}),[e,i,r]),l?t.React$1.createElement("div",{className:n.trimPreviews},l.map((({imageUrl:e,imageX:a=0},i)=>{const n={backgroundImage:`url("${e}")`,backgroundRepeat:"no-repeat",backgroundPositionX:`-${a+u.current}px`,width:s.current.width,height:s.current.height,transform:`scale(${d.current})`,position:"absolute",left:i*Math.ceil(s.current.width*d.current),transformOrigin:"left"};return t.React$1.createElement("div",{key:i,style:n})}))):null};Ne.displayName="TrimPreviews";const Ue=({onCancel:e})=>{const i=t.React$1.useMemo((()=>[l.getKeyboardBinding({key:a.Key_enum.Key.Escape,callback:e})]),[e]);return t.React$1.createElement(l.KeyboardBindingConnector,{keyboardBindings:i,name:"modal",scope:!0})};Ue.displayName="CloseModalBinding";const Oe=({cancel:e,undo:i,redo:n,onRotate:r,player:o})=>{const s=t.React$1.useMemo((()=>[l.getKeyboardBinding({key:a.Key_enum.Key.Escape,callback:e}),c.getPlayPauseKeybinding(o),l.getKeyboardBinding({key:"z",osModifierKey:!0,callback:()=>null==i?void 0:i()}),l.mac?l.getKeyboardBinding({key:"z",shift:!0,osModifierKey:!0,callback:()=>null==n?void 0:n()}):l.getKeyboardBinding({key:"y",osModifierKey:!0,callback:()=>null==n?void 0:n()}),l.getKeyboardBinding({key:"l",callback:()=>null==r?void 0:r(!1)}),l.getKeyboardBinding({key:"r",callback:()=>null==r?void 0:r(!0)})]),[e,i,n]);return t.React$1.createElement(l.KeyboardBindingConnector,{keyboardBindings:s,name:"video_editing",scope:!0})};Oe.displayName="VideoEditingBindings";const Pe=t.React$1.memo((({onConfirm:e,onCancel:i,fileViewerId:n,previewKey:r})=>{var c;const s=a.useIntl(),d=a.useDispatch(),u=null===(c=l.usePreviewKeySelector(l.getFileContentMetadata,r))||void 0===c?void 0:c.metadata,m=u&&"video"===u[".tag"]?u:null,g=s.formatMessage({id:"FFSuL/",defaultMessage:"Replace original video?"}),p=s.formatMessage({id:"mSJaIb",defaultMessage:"Replacing it will overwrite the current video. All changes will be available to everyone with access to this video."}),f=s.formatMessage({id:"pT5oWx",defaultMessage:"Replacing it will overwrite the current video and update the codec to improve editing performance. All changes will be available to everyone with access to this video."}),v=s.formatMessage({id:"Llt0Rs",defaultMessage:"Replace original"}),R=s.formatMessage({id:"4IgcNN",defaultMessage:"Cancel"});return t.React$1.useEffect((()=>{d(l.logUserActionEvent({userAction:_.UserAction.EditVideoReplaceOriginalClicked,fileViewerId:n,actionContext:_.UserActionContext.VideoEditing}))}),[]),t.React$1.createElement(Be,{onConfirm:()=>{d(l.logUserActionEvent({userAction:_.UserAction.EditVideoReplaceOriginalConfirmed,fileViewerId:n,actionContext:_.UserActionContext.VideoEditing})),e()},onCancel:()=>{d(l.logUserActionEvent({userAction:_.UserAction.EditVideoReplaceOriginalCancel,fileViewerId:n,actionContext:_.UserActionContext.VideoEditing})),i()},titleMessage:g,bodyMessage:o.isChangingCodecDuringEdit(null==m?void 0:m.codec)?f:p,confirmMessage:v,cancelMessage:R})}));Pe.displayName="ReplaceOriginalModal";const De=t.React$1.memo((({onConfirm:e,onCancel:i,fileViewerId:n})=>{const r=a.useIntl(),o=a.useDispatch(),c=r.formatMessage({id:"hIkZeL",defaultMessage:"Discard changes?"}),s=r.formatMessage({id:"sokAC/",defaultMessage:"This video contains unsaved changes. If you leave the page now, your changes will be lost. To save your changes, stay on the page and click Save."}),d=r.formatMessage({id:"/5JPCW",defaultMessage:"Discard changes"}),u=r.formatMessage({id:"96jHHO",defaultMessage:"Stay on page"});return t.React$1.useEffect((()=>{o(l.logUserActionEvent({userAction:_.UserAction.EditVideoDiscardChangesClicked,fileViewerId:n,actionContext:_.UserActionContext.VideoEditing}))}),[]),t.React$1.createElement(Be,{onConfirm:()=>{o(l.logUserActionEvent({userAction:_.UserAction.EditVideoDiscardChangesConfirmed,fileViewerId:n,actionContext:_.UserActionContext.VideoEditing})),e()},onCancel:()=>{o(l.logUserActionEvent({userAction:_.UserAction.EditVideoDiscardChangesCancel,fileViewerId:n,actionContext:_.UserActionContext.VideoEditing})),i()},titleMessage:c,bodyMessage:s,confirmMessage:d,cancelMessage:u})}));De.displayName="DiscardChangesModal";const Be=e=>{const{onCancel:i,onConfirm:n,titleMessage:r,bodyMessage:o,confirmMessage:l,cancelMessage:c}=e;return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(Ue,{onCancel:i}),t.React$1.createElement(a.Modal,{open:!0,isCentered:!0,shouldCloseOnOverlayClick:!1},t.React$1.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},t.React$1.createElement(a.Modal.Title,null,r)),t.React$1.createElement(a.Modal.Body,{hasVerticalSpacing:!1},t.React$1.createElement(a.Text,{variant:"paragraph"},o)),t.React$1.createElement(a.Modal.Footer,null,t.React$1.createElement(a.Button,{variant:"opacity",onClick:i},c),t.React$1.createElement(a.Button,{variant:"primary",onClick:n},l))))};Be.displayName="ConfirmationModal";function He(e){switch(e.errorReason){case"over_quota":return n.VideoEditErrorType.OVER_QUOTA;case"in_progress":return n.VideoEditErrorType.ON_GOING_EDITING_JOB;default:return}}const je=({children:e})=>{const a=l.useMountTransition();return t.React$1.createElement(l.SlideTransition,{active:a,direction:"up",offScreenElement:!0,end:8,className:n.trimmingUi},e)};je.displayName="TrimmerAnimation";const Le=t.React$1.memo((({fileViewerId:e,featureConfig:i,vttThumbnailsUrl:r,duration:c,player:s,previewKey:d,fileSaver:u,fileConfig:m,videoDimensions:g,onRotateFlipChange:p,timeRange:f,lastCursorRef:h})=>{const C=a.useDispatch(),$=l.useRootFileInfo(e),b=l.useFileMetadata(d);if(!b||!$)throw new Error;const{file_id:y,url:T}=$,{file_name:w,file_path:k}=b,M=m.canEdit,V=t.React$1.useRef(null),S=t.React$1.useRef(null),[A,x]=t.React$1.useState(!1),[I,F]=t.React$1.useState(!1),[N,U]=t.React$1.useState(!1),[O,P]=t.React$1.useState(),D=a.useSelector((t=>l.getFileViewerUi(t,e))),B=null==D?void 0:D.isFullScreen,{state:H,overrideState:j,updateState:L,undo:z,redo:K,reset:W,hasUndo:J,hasRedo:q,updateEditProgress:G,onEditError:X,updateLiveFeedback:Z,resetLiveFeedback:Q,isVideoEditing:Y}=t.React$1.useContext(n.VideoEditingContext),ee=o.checkHasAnyChange(H,c),te=t.React$1.useCallback((()=>{p({rotate:0,flip:!1})}),[p]),ae=t.React$1.useCallback((({shouldResetVideoEdit:t})=>{null==s||s.pause(),C(l.cancelEditingVideo({fileViewerId:e,sourceContext:_.UserActionContext.VideoEditing})),W(o.createInitialVideoEditState(c,f)),t&&te()}),[s,te]);l.useRecordPreviewsTimerOnMount(e,_.PreviewsTimer.VideoEditorOpen),n.useVideoEditHistoryChange((e=>{ee?(e.forward(),F(!0)):ae({shouldResetVideoEdit:!0})})),t.React$1.useEffect((()=>{Q(),J||W(o.createInitialVideoEditState(c,f))}),[c]),t.React$1.useEffect((()=>{j&&p({rotate:null!=(null==j?void 0:j.rotate)?j.rotate:H.rotate,flip:j?j.horizontalFlip:H.horizontalFlip})}),[null==j?void 0:j.rotate,null==j?void 0:j.horizontalFlip]),t.React$1.useEffect((()=>{Y&&(G({progress:"save-error",originalFileName:w,fileName:w,filePath:k,errorType:n.VideoEditErrorType.ON_GOING_EDITING_JOB}),ae({shouldResetVideoEdit:!1}))}),[Y]);const{onSaveCopy:ie,onReplaceOriginal:ne}=(({previewKey:e,fileViewerId:i,fileId:r,url:c,videoEditState:s,duration:d,updateEditProgress:u,updateLiveFeedback:m,closeEditor:g,resetVideoEdit:p,fileName:f,filePath:v})=>{var R;const E=a.useDispatch(),{pluginNavigation:h,batteries:{coreIOClients:{apiv2ClientBase:C},optionalIOClients:{urlClient:$,flowsClient:b}},featureConfig:{video_edit_async:y,previews_exp_video_edit_trim_optimization:T}}=l.useFileViewerContext(),w=null===(R=l.usePreviewKeySelector(l.getFileContentMetadata,e))||void 0===R?void 0:R.metadata;return t.React$1.useMemo((()=>{const e=o.checkHasTrimChange(s.trim,d),t=T&&e?{trim_accuracy_threshold_msec:o.getTrimAccuracyThresholdMsec(s.trim)}:null,a=[e?{operation:{".tag":"trim",start:s.trim.start,end:s.trim.end}}:null,0!==s.rotate?{operation:{".tag":"rotate",degrees:s.rotate}}:null,void 0!==s.crop?{operation:{".tag":"crop",x:Math.floor(s.crop.left),y:Math.floor(s.crop.top),w:Math.floor(s.crop.width),h:Math.floor(s.crop.height)}}:null,s.horizontalFlip?{operation:{".tag":"flip",horizontal:s.horizontalFlip}}:null].filter(Boolean),R=c&&(c.indexOf("/scl/fi/")>=0||c.indexOf("/scl/fo/")>=0),k=y||R,M=s.trim.end-s.trim.start,V=Object.assign(Object.assign({duration:(null==d?void 0:d.toFixed(2))||"",newDuration:M.toFixed(2),trim_count:String(s.counts.trim),rotate_count:String(s.counts.rotate),crop_count:String(s.counts.crop),flip_count:String(s.counts.flip)},o.getVideoEditLoggingExtras(f,w)),{async:String(k)}),S=e=>{var t;return(null===(t=e.headers)||void 0===t?void 0:t["x-dropbox-request-id"])||""};if(k)return{onSaveCopy:(e,n,o)=>{E(l.logUserActionEvent({userAction:_.UserAction.EditVideoSaveCopyConfirmed,fileViewerId:i,actionContext:_.UserActionContext.VideoEditing}));const s=Object.assign({operations:a,dest_fq_path:o},t),d=Object.assign(Object.assign({},s),{".tag":"video_edit"});u({progress:"saving-copy",originalFileName:e,fileName:n,filePath:o}),m({type:"save-in-progress"});const f=Date.now();b.submitFileWorkflow({template:{sequence:[{workflow_action:d}]},file_ids:[r],shared_link_url:c},120).then((t=>{if("success"===t.status){const a=t.createdFqPath,n=l.getFilenameFromPath(a);u({progress:"saved-copy",originalFileName:e,fileName:n,filePath:a}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveSucceeded,fileViewerId:i,extra:Object.assign({replace_original:"false",save_time:String(Date.now()-f),context:"save_a_copy"},V)})),null==$||$.openFile(a,!0)}else u({progress:"save-error",originalFileName:e,fileName:n,filePath:o,errorType:He(t)}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveFailed,fileViewerId:i,extra:Object.assign({replace_original:"false",save_time:String(Date.now()-f),error:t.error,error_type:t.errorReason||"unknown",time_to_start:String(t.timeToStartRecieved),context:"save_a_copy"},V)})),p()})),g({shouldResetVideoEdit:!1})},onReplaceOriginal:()=>{const e=Object.assign({operations:a},t),n=Object.assign(Object.assign({},e),{".tag":"video_edit"}),o=v||void 0;u({progress:"saving-original",originalFileName:f,fileName:f,filePath:o}),m({type:"save-in-progress"});const s=Date.now();b.submitFileWorkflow({template:{sequence:[{workflow_action:n}]},file_ids:[r],shared_link_url:c},120).then((e=>{"success"===e.status?(u({progress:"saved-original",originalFileName:f,fileName:f,filePath:o}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveSucceeded,fileViewerId:i,extra:Object.assign({replace_original:"true",save_time:String(Date.now()-s),context:"replace_original"},V)})),h.reinitializeFileViewer()):(u({progress:"save-error",originalFileName:f,fileName:f,filePath:o,errorType:He(e)}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveFailed,fileViewerId:i,extra:Object.assign({replace_original:"true",save_time:String(Date.now()-s),error:e.error,error_type:e.errorReason||"unknown",time_to_start:String(e.timeToStartRecieved),context:"replace_original"},V)})),p())})),g({shouldResetVideoEdit:!1})}};{const e=c?{identifier:{".tag":"shared_link_url",shared_link_url:c}}:{identifier:{".tag":"file_id",file_id:r}},o=(r,o,c)=>{E(l.logUserActionEvent({userAction:_.UserAction.EditVideoSaveCopyConfirmed,fileViewerId:i,actionContext:_.UserActionContext.VideoEditing}));const s=Object.assign({file:e,operations:a,dest_path:c},t);u({progress:"saving-copy",originalFileName:r,fileName:o,filePath:c}),m({type:"save-in-progress"});const d=Date.now();C.ns("flows").rpcWithResponseHeaders("edit_video",s,{}).then((e=>{const t=e.result.path,a=l.getFilenameFromPath(t);u({progress:"saved-copy",originalFileName:r,fileName:a,filePath:t}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveSucceeded,fileViewerId:i,extra:Object.assign({replace_original:"false",save_time:String(Date.now()-d),request_id:S(e),context:"save_a_copy"},V)})),null==$||$.openFile(t,!0)})).catch((e=>{var t,a;const s=null===(t=null==e?void 0:e.error)||void 0===t?void 0:t[".tag"],m=s===n.VideoEditErrorType.OVER_QUOTA?n.VideoEditErrorType.OVER_QUOTA:void 0,g=null===(a=null==e?void 0:e.raw)||void 0===a?void 0:a.status;u({progress:"save-error",originalFileName:r,fileName:o,filePath:c,errorType:m}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveFailed,fileViewerId:i,extra:Object.assign({replace_original:"false",save_time:String(Date.now()-d),request_id:S(e),error_type:s||g,context:"save_a_copy"},V)})),p()})),g({shouldResetVideoEdit:!1})},s=()=>{const n=Object.assign({file:e,operations:a},t),r=v||void 0;u({progress:"saving-original",originalFileName:f,fileName:f,filePath:r}),m({type:"save-in-progress"});const o=Date.now();C.ns("flows").rpcWithResponseHeaders("edit_video",n,{}).then((e=>{u({progress:"saved-original",originalFileName:f,fileName:f,filePath:r}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveSucceeded,fileViewerId:i,extra:Object.assign({replace_original:"true",save_time:String(Date.now()-o),request_id:S(e),context:"replace_original"},V)})),h.reinitializeFileViewer()})).catch((e=>{var t,a;const n=null===(t=null==e?void 0:e.error)||void 0===t?void 0:t[".tag"],c=null===(a=null==e?void 0:e.raw)||void 0===a?void 0:a.status;u({progress:"save-error",originalFileName:f,fileName:f,filePath:r}),E(l.logBackgroundEvent({event:_.BackgroundEvent.EditVideoSaveFailed,fileViewerId:i,extra:Object.assign({replace_original:"true",save_time:String(Date.now()-o),request_id:S(e),error_type:n||c,context:"replace_original"},V)})),p()})),g({shouldResetVideoEdit:!1})};return{onSaveCopy:o,onReplaceOriginal:s}}}),[r,c,s])})({previewKey:d,fileViewerId:e,fileId:y,url:T,duration:c,videoEditState:H,updateEditProgress:G,closeEditor:ae,fileName:w,filePath:k,resetVideoEdit:te,updateLiveFeedback:Z}),re=t.React$1.useCallback((e=>{L((t=>{const a=o.getNextRotation(t.rotate,t.horizontalFlip,e);return p({rotate:a,flip:t.horizontalFlip}),Object.assign(Object.assign({},t),{rotate:a,counts:Object.assign(Object.assign({},t.counts),{rotate:t.counts.rotate+1})})}))}),[s,L]),oe=t.React$1.useCallback((e=>{L((t=>{const[a,i]=o.getNextFlip(t.horizontalFlip,t.rotate,e);return p({rotate:i,flip:a}),Object.assign(Object.assign({},t),{horizontalFlip:a,rotate:i,counts:Object.assign(Object.assign({},t.counts),{flip:t.counts.flip+1})})}))}),[s,L]),le=t.React$1.useCallback((({width:e})=>{P(e)}),[]),ce=t.React$1.useCallback((()=>{C(l.logUserActionEvent({userAction:_.UserAction.EditVideoCancel,fileViewerId:e,actionContext:_.UserActionContext.VideoEditing,extra:{have_changes:String(J)}})),J?F(!0):(ae({shouldResetVideoEdit:!0}),Z({type:"cancel"}))}),[J]),se=t.React$1.useCallback((()=>{z(),C(l.logUserActionEvent({userAction:_.UserAction.EditVideoUndo,fileViewerId:e,actionContext:_.UserActionContext.VideoEditing}))}),[z,e]),de=t.React$1.useCallback((()=>{K(),C(l.logUserActionEvent({userAction:_.UserAction.EditVideoRedo,fileViewerId:e,actionContext:_.UserActionContext.VideoEditing}))}),[K,e]);return t.React$1.createElement(E.ErrorBoundary,{fallback:null,onError:X},t.React$1.createElement("div",{className:a.classnames(R.editUiWrapper,{[R.isFullScreen]:B}),ref:S},t.React$1.createElement(Oe,{cancel:ce,undo:se,redo:de,player:s,onRotate:re}),N&&u&&t.React$1.createElement(ze,{fileName:w,filePath:k,onSaveCopy:ie,setSaveCopyModalOpen:U,fileSaver:u,fileViewerId:e}),A&&t.React$1.createElement(Pe,{onConfirm:ne,onCancel:()=>x(!1),fileViewerId:e,previewKey:d}),I&&t.React$1.createElement(De,{onConfirm:()=>{ae({shouldResetVideoEdit:!0}),Z({type:"cancel"})},onCancel:()=>F(!1),fileViewerId:e}),t.React$1.createElement(je,null,t.React$1.createElement(v.Resizer,{elementRef:V,onResize:le,boxSizing:"borderBox"},t.React$1.createElement("div",{className:n.trimControlBar,ref:V},null!=O&&null!=c&&t.React$1.createElement(t.React$1.Fragment,null,r&&null!=g&&t.React$1.createElement(Ne,{vttThumbnailsUrl:r,duration:c,containerWidth:O,videoDimensions:g}),t.React$1.createElement(Ie,{containerWidth:O,duration:c,player:s,trimUiWrapperRef:S,updateVideoEditState:L,overrideTrimState:null==j?void 0:j.trim,currentTrimState:H.trim,lastCursorRef:h})))),t.React$1.createElement(Fe,{featureConfig:i,isReplaceOriginalEnabled:M,onCancel:ce,onRedo:q?de:void 0,onUndo:J?se:void 0,onSaveMenuSelection:e=>{"save_copy"===e?U(!0):"replace_original"===e&&x(!0)},isSaveEnabled:ee,onRotate:re,onFlip:oe,player:s}))))}));Le.displayName="VideoEditUi";const ze=({fileSaver:e,setSaveCopyModalOpen:i,fileName:n,filePath:r,fileViewerId:o,onSaveCopy:c})=>{const s=a.useDispatch(),d=t.React$1.useCallback((()=>{s(l.logUserActionEvent({userAction:_.UserAction.EditVideoSaveCopyCancel,fileViewerId:o,actionContext:_.UserActionContext.VideoEditing})),i(!1)}),[o]),u=t.React$1.useCallback((()=>{s(l.logUserActionEvent({userAction:_.UserAction.EditVideoNewFolderAttempt,fileViewerId:o,actionContext:_.UserActionContext.VideoEditing}))}),[o]),m=t.React$1.useCallback((()=>{s(l.logUserActionEvent({userAction:_.UserAction.EditVideoNewFolderConfirm,fileViewerId:o,actionContext:_.UserActionContext.VideoEditing}))}),[o]),g=t.React$1.useCallback((()=>{s(l.logUserActionEvent({userAction:_.UserAction.EditVideoNewFolderSuccess,fileViewerId:o,actionContext:_.UserActionContext.VideoEditing}))}),[o]),p=t.React$1.useCallback((e=>{s(l.logUserActionEvent({userAction:_.UserAction.EditVideoNewFolderFailure,fileViewerId:o,actionContext:_.UserActionContext.VideoEditing,extra:{error:e||"unknown"}}))}),[o]),f=t.React$1.useCallback((()=>{s(l.logUserActionEvent({userAction:_.UserAction.EditVideoNewFolderCancel,fileViewerId:o,actionContext:_.UserActionContext.VideoEditing}))}),[o]);return t.react.exports.useEffect((()=>{s(l.logUserActionEvent({userAction:_.UserAction.EditVideoSaveCopyClicked,fileViewerId:o,actionContext:_.UserActionContext.VideoEditing}))}),[o]),t.React$1.createElement(e,{fileName:n,filePath:r,onSave:c,onCancel:d,onCreateFolderClicked:u,onCreateFolderConfirm:m,onCreateFolderSuccess:g,onCreateFolderFailed:p,onCreateFolderCanceled:f})};ze.displayName="SaveCopyModal",e.VideoEditUi=Le}));
//# sourceMappingURL=c_preview_audio_video_video_editing_video_edit_ui.js-vflEJz55n.map
