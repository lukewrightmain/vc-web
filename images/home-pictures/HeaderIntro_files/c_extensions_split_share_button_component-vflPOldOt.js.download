define(["require","exports","./c_tslib","./e_ui_page_files_router","./e_edison","./c_assets_pictogram_lightbulb","./c_ui-icon_line_analytics","./c_ui-icon_line_collection","./c_ui-icon_line_dropbox-replay","./c_ui-icon_line_dropbox-transfer","./c_ui-icon_line_rocket","./c_ui-icon_line_send","./c_ui-icon_line_share-arrow","./c_ui-icon_line_tag","./c_spectrum_tooltip","./c_core_i18n","./c_controls_index","./c_mjs_hero_share","./c_components_chooser_default_chooser","./c_docsend_src_utils","./c_hooks_lib_index","./c_form_row_index","./c_core_uri","./e_core_exception","./c_integrations_data_selectors","./c_extensions_extensions_utils","./c_extensions_data_selectors","./c_src_instrumentation_common_context","./c_src_instrumentation_constants","./c_loggers_device_type","metaserver/static/js/modules/constants/env","./c_history","./c_core_browser_detection","./c_file_transfers_lib_utils","./c_file_transfers_async_browse_entry_point_onboarding_modal_async","./c_onboarding_checklist_async_share_button_tooltip","./c_browse_tts","./c_campaigns_campaigns_element_id_enum","./c_docsend_analytics_add_on_helpers_modals","./c_collections_utils_file_identifier","./c_sharing_upsells_util","./c_publish_publish_modal","./c_pap-events_publish_modal_shown_publish_entrypoint","./c_pap-events_publish_modal_select_publish_entrypoint","./c_lodash-es_lodash"],(function(e,t,n,a,r,i,o,s,l,c,d,u,p,m,_,h,g,f,v,E,S,y,A,b,O,R,x,w,M,C,T,k,I,D,$,F,N,P,L,V,B,U,H,j,W){"use strict";const G={};function q(e){return void 0===G[e]?(G[e]=a.getUserMetadata(["DOCSEND_ADDON_SHARING_DO_NOT_SHOW_WELCOME_MODAL"],e).then((e=>!!e.DOCSEND_ADDON_SHARING_DO_NOT_SHOW_WELCOME_MODAL)),G[e]):G[e]}a.injectInternalStyle("typescript/component_libraries/docsend/src/components/sharing/welcome_modal.module.out.css",(e=>"._hero_1c7lx_1{background-color:var(--color__core__secondary)}._dontShowAgainCheckbox_1c7lx_5{display:flex;margin-left:0;margin-right:auto}._dontShowAgainCheckbox_1c7lx_5>*+*{margin-left:var(--spacing__base_unit)}"));const z="_hero_1c7lx_1",Y="_dontShowAgainCheckbox_1c7lx_5",X=({isOpen:e,closeModal:t,onSubmit:n})=>{const i=a.useIntl(),[o,s]=r.react.exports.useState(!1);return r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(a.Modal,{open:e,isCentered:!0,withCloseButton:i.formatMessage({id:"vawEMm",defaultMessage:"Close"}),"aria-labelledby":"welcome-modal-title",onRequestClose:t},r.React$1.createElement("div",{className:z},r.React$1.createElement(f.ShareHero,{aspectRatio:"16:9"})),r.React$1.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(a.Modal.Title,{id:"welcome-modal-title"},r.React$1.createElement(a.FormattedMessage,{id:"/kM+cl",defaultMessage:"Send a copy of this file with advanced tracking"}))),r.React$1.createElement(a.Modal.Body,null,r.React$1.createElement(a.FormattedMessage,{id:"1ZZUut",defaultMessage:"Securely share this file and track real-time engagement metrics to help refine your content."})),r.React$1.createElement(a.Modal.Footer,null,r.React$1.createElement("div",{className:Y},r.React$1.createElement(g.Checkbox,{id:"welcome_modal-dontshowagain",onChange:e=>s(e.currentTarget.checked)}),r.React$1.createElement(a.Text,{tagName:"label",htmlFor:"welcome_modal-dontshowagain"},r.React$1.createElement(a.FormattedMessage,{id:"TeQ39/",defaultMessage:"Don’t show again"}))),r.React$1.createElement(a.Button,{variant:"opacity",onClick:t},r.React$1.createElement(a.FormattedMessage,{id:"uZz9YD",defaultMessage:"Cancel"})),r.React$1.createElement(a.Button,{variant:"primary",onClick:()=>n({dontShowAgain:o})},r.React$1.createElement(a.FormattedMessage,{id:"WoOMK6",defaultMessage:"Send a copy"})))))};var K;X.displayName="WelcomeModal",function(e){e.SAVE_PROGRESS="save_progress"}(K||(K={})),r.React$1.createContext(null);const Z={Sidebar:v.Sidebar,Header:v.Header,Search:v.Search,ViewToggleMenu:v.ViewToggleMenu,ActionsMenu:v.ActionsMenu,FileView:v.FileView,Footer:v.Footer,Container:v.ChooserContainer};a.injectInternalStyle("typescript/component_libraries/docsend/src/components/dropbox_chooser/dropbox_chooser.module.out.css",(e=>"._dropins-chooser-modal_132vk_1{display:flex;flex-direction:column}._dropzone-container_132vk_6{margin-top:var(--spacing__unit--3)}._dropins-chooser-modal-footer_132vk_10{padding-top:0}._dropbox-chooser-container_132vk_14{display:flex;flex-grow:1;height:500px}._dropins-chooser-copy-chooser_132vk_20{display:flex;flex-direction:column;flex-grow:1}"));const Q="_dropins-chooser-modal_132vk_1",J="_dropzone-container_132vk_6",ee="_dropins-chooser-modal-footer_132vk_10",te="_dropbox-chooser-container_132vk_14",ne="_dropins-chooser-copy-chooser_132vk_20";function ae(e){const{onAfterClose:t,onCopyFile:n,onClose:i,onCancel:o,isOpen:s,isCopying:l,logModalButtonSelectEvent:c}=e,d=a.useIntl();return r.React$1.createElement(a.Modal,{open:s,onAfterOpen:()=>c("copy_file"),isCentered:!0,shouldCloseOnOverlayClick:!1,withCloseButton:"Close",onAfterClose:t,onRequestClose:i,"aria-labelledby":"dropbox-chooser-modal-title"},r.React$1.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(a.Modal.Title,{id:"dropbox-chooser-modal-title","data-testid":"DropboxChooserModal_Title"},l?r.React$1.createElement(a.FormattedMessage,{id:"tCgmet",defaultMessage:"Creating a copy of this file …"}):r.React$1.createElement(a.FormattedMessage,{id:"xecksd",defaultMessage:"Create a copy"}))),r.React$1.createElement(a.Modal.Body,{className:Q},e.isCopying?r.React$1.createElement("div",{className:J},r.React$1.createElement("div",{className:"dig-Dropzone-container"},r.React$1.createElement("div",{className:"dig-Dropzone-wrapper"},r.React$1.createElement("div",{className:"dig-Dropzone-progress-bar"},r.React$1.createElement(a.ProgressBar,{isIndeterminate:!0,in:!0})),r.React$1.createElement("span",{className:"dig-Text dig-Text--variant-paragraph dig-Text--size-standard dig-Text--color-standard"},d.formatMessage({id:"bxJzuw",defaultMessage:"Copying …"}))))):r.React$1.createElement(Z.Container,{auth:e.auth,onSubmit:n,onCancel:o,extensions:E.ACCEPTED_EXTENSIONS,fileSelect:!0,folderSelect:!1,multiSelect:!1,className:te},r.React$1.createElement("div",{className:ne},r.React$1.createElement(Z.Search,null),r.React$1.createElement(Z.ActionsMenu,{showTabs:!1}),r.React$1.createElement(Z.FileView,null),r.React$1.createElement(Z.Footer,{cancelText:d.formatMessage({id:"lEKwwg",defaultMessage:"Back"}),submitText:d.formatMessage({id:"BN9N67",defaultMessage:"Create copy"})})))),r.React$1.createElement(a.Modal.Footer,{className:ee}))}var re=e=>"checkbox"===e.type,ie=e=>e instanceof Date,oe=e=>null==e;const se=e=>"object"==typeof e;var le=e=>!oe(e)&&!Array.isArray(e)&&se(e)&&!ie(e),ce=e=>le(e)&&e.target?re(e.target)?e.target.checked:e.target.value:e,de=(e,t)=>e.has((e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e)(t)),ue=e=>Array.isArray(e)?e.filter(Boolean):[],pe=e=>void 0===e,me=(e,t,n)=>{if(!t||!le(e))return n;const a=ue(t.split(/[,[\].]+?/)).reduce(((e,t)=>oe(e)?e:e[t]),e);return pe(a)||a===e?pe(e[t])?n:e[t]:a};const _e="blur",he="focusout",ge="change",fe="onBlur",ve="onChange",Ee="onSubmit",Se="onTouched",ye="all",Ae="max",be="min",Oe="maxLength",Re="minLength",xe="pattern",we="required",Me="validate",Ce=r.React$1.createContext(null),Te=()=>r.React$1.useContext(Ce);var ke=(e,t,n,a=!0)=>{const r={};for(const i in e)Object.defineProperty(r,i,{get:()=>{const r=i;return t[r]!==ye&&(t[r]=!a||ye),n&&(n[r]=!0),e[r]}});return r},Ie=e=>le(e)&&!Object.keys(e).length,De=(e,t,n)=>{const{name:a,...r}=e;return Ie(r)||Object.keys(r).length>=Object.keys(t).length||Object.keys(r).find((e=>t[e]===(!n||ye)))},$e=e=>Array.isArray(e)?e:[e],Fe=(e,t,n)=>n&&t?e===t:!e||!t||e===t||$e(e).some((e=>e&&(e.startsWith(t)||t.startsWith(e))));function Ne(e){const t=r.React$1.useRef(e);t.current=e,r.React$1.useEffect((()=>{const n=!e.disabled&&t.current.subject.subscribe({next:t.current.callback});return()=>(e=>{e&&e.unsubscribe()})(n)}),[e.disabled])}var Pe=e=>"string"==typeof e,Le=(e,t,n,a)=>{const r=Array.isArray(e);return Pe(e)?(a&&t.watch.add(e),me(n,e)):r?e.map((e=>(a&&t.watch.add(e),me(n,e)))):(a&&(t.watchAll=!0),n)},Ve=e=>"function"==typeof e,Be=e=>{for(const t in e)if(Ve(e[t]))return!0;return!1};function Ue(e){const t=Te(),{name:n,control:a=t.control,shouldUnregister:i}=e,o=de(a._names.array,n),s=function(e){const t=Te(),{control:n=t.control,name:a,defaultValue:i,disabled:o,exact:s}=e||{},l=r.React$1.useRef(a);l.current=a;const c=r.React$1.useCallback((e=>{if(Fe(l.current,e.name,s)){const t=Le(l.current,n._names,e.values||n._formValues);u(pe(l.current)||le(t)&&!Be(t)?{...t}:Array.isArray(t)?[...t]:pe(t)?i:t)}}),[n,s,i]);Ne({disabled:o,subject:n._subjects.watch,callback:c});const[d,u]=r.React$1.useState(pe(i)?n._getWatch(a):i);return r.React$1.useEffect((()=>{n._removeUnmounted()})),d}({control:a,name:n,defaultValue:me(a._formValues,n,me(a._defaultValues,n,e.defaultValue)),exact:!0}),l=function(e){const t=Te(),{control:n=t.control,disabled:a,name:i,exact:o}=e||{},[s,l]=r.React$1.useState(n._formState),c=r.React$1.useRef({isDirty:!1,dirtyFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1}),d=r.React$1.useRef(i),u=r.React$1.useRef(!0);return d.current=i,Ne({disabled:a,callback:r.React$1.useCallback((e=>u.current&&Fe(d.current,e.name,o)&&De(e,c.current)&&l({...n._formState,...e})),[n,o]),subject:n._subjects.state}),r.React$1.useEffect((()=>(u.current=!0,()=>{u.current=!1})),[]),ke(s,n._proxyFormState,c.current,!1)}({control:a,name:n}),c=r.React$1.useRef(a.register(n,{...e.rules,value:s}));return r.React$1.useEffect((()=>{const e=(e,t)=>{const n=me(a._fields,e);n&&(n._f.mount=t)};return e(n,!0),()=>{const t=a._options.shouldUnregister||i;(o?t&&!a._stateFlags.action:t)?a.unregister(n):e(n,!1)}}),[n,a,o,i]),{field:{name:n,value:s,onChange:r.React$1.useCallback((e=>{c.current.onChange({target:{value:ce(e),name:n},type:ge})}),[n]),onBlur:r.React$1.useCallback((()=>{c.current.onBlur({target:{value:me(a._formValues,n),name:n},type:_e})}),[n,a]),ref:r.React$1.useCallback((e=>{const t=me(a._fields,n);e&&t&&e.focus&&(t._f.ref={focus:()=>e.focus(),select:()=>e.select(),setCustomValidity:t=>e.setCustomValidity(t),reportValidity:()=>e.reportValidity()})}),[n,a._fields])},formState:l,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!me(l.errors,n)},isDirty:{enumerable:!0,get:()=>!!me(l.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!me(l.touchedFields,n)},error:{enumerable:!0,get:()=>me(l.errors,n)}})}}const He=e=>e.render(Ue(e));var je=(e,t,n,a,r)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[a]:r||!0}}:{},We=e=>/^\w*$/.test(e),Ge=e=>ue(e.replace(/["|']|\]/g,"").split(/\.|\[/));function qe(e,t,n){let a=-1;const r=We(t)?[t]:Ge(t),i=r.length,o=i-1;for(;++a<i;){const t=r[a];let i=n;if(a!==o){const n=e[t];i=le(n)||Array.isArray(n)?n:isNaN(+r[a+1])?{}:[]}e[t]=i,e=e[t]}return e}const ze=(e,t,n)=>{for(const a of n||Object.keys(e)){const n=me(e,a);if(n){const{_f:e,...a}=n;if(e&&t(e.name)){if(e.ref.focus&&pe(e.ref.focus()))break;if(e.refs){e.refs[0].focus();break}}else le(a)&&ze(a,t)}}};var Ye=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some((t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))))),Xe=(e,t,n)=>{const a=ue(me(e,n));return qe(a,"root",t[n]),qe(e,n,a),e},Ke=e=>"boolean"==typeof e,Ze=e=>"file"===e.type,Qe=e=>Pe(e)||r.React$1.isValidElement(e),Je=e=>"radio"===e.type,et=e=>e instanceof RegExp;const tt={value:!1,isValid:!1},nt={value:!0,isValid:!0};var at=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter((e=>e&&e.checked&&!e.disabled)).map((e=>e.value));return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!pe(e[0].attributes.value)?pe(e[0].value)||""===e[0].value?nt:{value:e[0].value,isValid:!0}:nt:tt}return tt};const rt={isValid:!1,value:null};var it=e=>Array.isArray(e)?e.reduce(((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e),rt):rt;function ot(e,t,n="validate"){if(Qe(e)||Array.isArray(e)&&e.every(Qe)||Ke(e)&&!e)return{type:n,message:Qe(e)?e:"",ref:t}}var st=e=>le(e)&&!et(e)?e:{value:e,message:""},lt=async(e,t,n,a,r)=>{const{ref:i,refs:o,required:s,maxLength:l,minLength:c,min:d,max:u,pattern:p,validate:m,name:_,valueAsNumber:h,mount:g,disabled:f}=e._f;if(!g||f)return{};const v=o?o[0]:i,E=e=>{a&&v.reportValidity&&(v.setCustomValidity(Ke(e)?"":e||" "),v.reportValidity())},S={},y=Je(i),A=re(i),b=y||A,O=(h||Ze(i))&&!i.value||""===t||Array.isArray(t)&&!t.length,R=je.bind(null,_,n,S),x=(e,t,n,a=Oe,r=Re)=>{const o=e?t:n;S[_]={type:e?a:r,message:o,ref:i,...R(e?a:r,o)}};if(r?!Array.isArray(t)||!t.length:s&&(!b&&(O||oe(t))||Ke(t)&&!t||A&&!at(o).isValid||y&&!it(o).isValid)){const{value:e,message:t}=Qe(s)?{value:!!s,message:s}:st(s);if(e&&(S[_]={type:we,message:t,ref:v,...R(we,t)},!n))return E(t),S}if(!(O||oe(d)&&oe(u))){let e,a;const r=st(u),o=st(d);if(oe(t)||isNaN(t)){const n=i.valueAsDate||new Date(t);Pe(r.value)&&(e=n>new Date(r.value)),Pe(o.value)&&(a=n<new Date(o.value))}else{const n=i.valueAsNumber||(t?+t:t);oe(r.value)||(e=n>r.value),oe(o.value)||(a=n<o.value)}if((e||a)&&(x(!!e,r.message,o.message,Ae,be),!n))return E(S[_].message),S}if((l||c)&&!O&&(Pe(t)||r&&Array.isArray(t))){const e=st(l),a=st(c),r=!oe(e.value)&&t.length>e.value,i=!oe(a.value)&&t.length<a.value;if((r||i)&&(x(r,e.message,a.message),!n))return E(S[_].message),S}if(p&&!O&&Pe(t)){const{value:e,message:a}=st(p);if(et(e)&&!t.match(e)&&(S[_]={type:xe,message:a,ref:i,...R(xe,a)},!n))return E(a),S}if(m)if(Ve(m)){const e=ot(await m(t),v);if(e&&(S[_]={...e,...R(Me,e.message)},!n))return E(e.message),S}else if(le(m)){let e={};for(const a in m){if(!Ie(e)&&!n)break;const r=ot(await m[a](t),v,a);r&&(e={...r,...R(a,r.message)},E(r.message),n&&(S[_]=e))}if(!Ie(e)&&(S[_]={ref:v,...e},!n))return S}return E(!0),S},ct="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function dt(e){let t;const n=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else{if(ct&&(e instanceof Blob||e instanceof FileList)||!n&&!le(e))return e;t=n?[]:{};for(const n in e){if(Ve(e[n])){t=e;break}t[n]=dt(e[n])}}return t}var ut=e=>({isOnSubmit:!e||e===Ee,isOnBlur:e===fe,isOnChange:e===ve,isOnAll:e===ye,isOnTouch:e===Se});function pt(e){for(const t in e)if(!pe(e[t]))return!1;return!0}function mt(e,t){const n=We(t)?[t]:Ge(t),a=1==n.length?e:function(e,t){const n=t.slice(0,-1).length;let a=0;for(;a<n;)e=pe(e)?a++:e[t[a++]];return e}(e,n),r=n[n.length-1];let i;a&&delete a[r];for(let t=0;t<n.slice(0,-1).length;t++){let a,r=-1;const o=n.slice(0,-(t+1)),s=o.length-1;for(t>0&&(i=e);++r<o.length;){const t=o[r];a=a?a[t]:e[t],s===r&&(le(a)&&Ie(a)||Array.isArray(a)&&pt(a))&&(i?delete i[t]:delete e[t]),i=a}}return e}function _t(){let e=[];return{get observers(){return e},next:t=>{for(const n of e)n.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter((e=>e!==t))}}),unsubscribe:()=>{e=[]}}}var ht=e=>oe(e)||!se(e);function gt(e,t){if(ht(e)||ht(t))return e===t;if(ie(e)&&ie(t))return e.getTime()===t.getTime();const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(const r of n){const n=e[r];if(!a.includes(r))return!1;if("ref"!==r){const e=t[r];if(ie(n)&&ie(e)||le(n)&&le(e)||Array.isArray(n)&&Array.isArray(e)?!gt(n,e):n!==e)return!1}}return!0}var ft=e=>{const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},vt=e=>"select-multiple"===e.type,Et=e=>ft(e)&&e.isConnected;function St(e,t={}){const n=Array.isArray(e);if(le(e)||n)for(const n in e)Array.isArray(e[n])||le(e[n])&&!Be(e[n])?(t[n]=Array.isArray(e[n])?[]:{},St(e[n],t[n])):oe(e[n])||(t[n]=!0);return t}function yt(e,t,n){const a=Array.isArray(e);if(le(e)||a)for(const a in e)Array.isArray(e[a])||le(e[a])&&!Be(e[a])?pe(t)||ht(n[a])?n[a]=Array.isArray(e[a])?St(e[a],[]):{...St(e[a])}:yt(e[a],oe(t)?{}:t[a],n[a]):n[a]=!gt(e[a],t[a]);return n}var At=(e,t)=>yt(e,t,St(t)),bt=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:a})=>pe(e)?e:t?""===e?NaN:e?+e:e:n&&Pe(e)?new Date(e):a?a(e):e;function Ot(e){const t=e.ref;if(!(e.refs?e.refs.every((e=>e.disabled)):t.disabled))return Ze(t)?t.files:Je(t)?it(e.refs).value:vt(t)?[...t.selectedOptions].map((({value:e})=>e)):re(t)?at(e.refs).value:bt(pe(t.value)?e.ref.value:t.value,e)}var Rt=e=>pe(e)?void 0:et(e)?e.source:le(e)?et(e.value)?e.value.source:e.value:e;function xt(e,t,n){const a=me(e,n);if(a||We(n))return{error:a,name:n};const r=n.split(".");for(;r.length;){const a=r.join("."),i=me(t,a),o=me(e,a);if(i&&!Array.isArray(i)&&n!==a)return{name:n};if(o&&o.type)return{name:a,error:o};r.pop()}return{name:n}}const wt={mode:Ee,reValidateMode:ve,shouldFocusError:!0};function Mt(e={}){let t,n={...wt,...e},a={isDirty:!1,isValidating:!1,dirtyFields:{},isSubmitted:!1,submitCount:0,touchedFields:{},isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,errors:{}},r={},i=dt(n.defaultValues)||{},o=n.shouldUnregister?{}:dt(i),s={action:!1,mount:!1,watch:!1},l={mount:new Set,unMount:new Set,array:new Set,watch:new Set},c=0,d={};const u={isDirty:!1,dirtyFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},p={watch:_t(),array:_t(),state:_t()},m=ut(n.mode),_=ut(n.reValidateMode),h=n.criteriaMode===ye,g=async e=>{let t=!1;return u.isValid&&(t=n.resolver?Ie((await S()).errors):await y(r,!0),e||t===a.isValid||(a.isValid=t,p.state.next({isValid:t}))),t},f=(e,t,n,a)=>{const l=me(r,e);if(l){const r=me(o,e,pe(n)?me(i,e):n);pe(r)||a&&a.defaultChecked||t?qe(o,e,t?r:Ot(l._f)):O(e,r),s.mount&&g()}},v=(e,t,n,r,o)=>{let s=!1;const l={name:e},c=me(a.touchedFields,e);if(u.isDirty){const e=a.isDirty;a.isDirty=l.isDirty=A(),s=e!==l.isDirty}if(u.dirtyFields&&(!n||r)){const n=me(a.dirtyFields,e);gt(me(i,e),t)?mt(a.dirtyFields,e):qe(a.dirtyFields,e,!0),l.dirtyFields=a.dirtyFields,s=s||n!==me(a.dirtyFields,e)}return n&&!c&&(qe(a.touchedFields,e,n),l.touchedFields=a.touchedFields,s=s||u.touchedFields&&c!==n),s&&o&&p.state.next(l),s?l:{}},E=async(n,r,i,o)=>{const s=me(a.errors,n),l=u.isValid&&a.isValid!==r;var m;if(e.delayError&&i?(m=()=>((e,t)=>{qe(a.errors,e,t),p.state.next({errors:a.errors})})(n,i),t=e=>{clearTimeout(c),c=window.setTimeout(m,e)},t(e.delayError)):(clearTimeout(c),t=null,i?qe(a.errors,n,i):mt(a.errors,n)),(i?!gt(s,i):s)||!Ie(o)||l){const e={...o,...l?{isValid:r}:{},errors:a.errors,name:n};a={...a,...e},p.state.next(e)}d[n]--,u.isValidating&&!Object.values(d).some((e=>e))&&(p.state.next({isValidating:!1}),d={})},S=async e=>n.resolver?await n.resolver({...o},n.context,((e,t,n,a)=>{const r={};for(const n of e){const e=me(t,n);e&&qe(r,n,e._f)}return{criteriaMode:n,names:[...e],fields:r,shouldUseNativeValidation:a}})(e||l.mount,r,n.criteriaMode,n.shouldUseNativeValidation)):{},y=async(e,t,r={valid:!0})=>{for(const i in e){const s=e[i];if(s){const{_f:e,...i}=s;if(e){const i=l.array.has(e.name),c=await lt(s,me(o,e.name),h,n.shouldUseNativeValidation,i);if(c[e.name]&&(r.valid=!1,t))break;!t&&(me(c,e.name)?i?Xe(a.errors,c,e.name):qe(a.errors,e.name,c[e.name]):mt(a.errors,e.name))}i&&await y(i,t,r)}}return r.valid},A=(e,t)=>(e&&t&&qe(o,e,t),!gt(C(),i)),b=(e,t,n)=>{const a={...s.mount?o:pe(t)?i:Pe(e)?{[e]:t}:t};return Le(e,l,a,n)},O=(e,t,n={})=>{const a=me(r,e);let i=t;if(a){const n=a._f;n&&(!n.disabled&&qe(o,e,bt(t,n)),i=ct&&ft(n.ref)&&oe(t)?"":t,vt(n.ref)?[...n.ref.options].forEach((e=>e.selected=i.includes(e.value))):n.refs?re(n.ref)?n.refs.length>1?n.refs.forEach((e=>!e.disabled&&(e.checked=Array.isArray(i)?!!i.find((t=>t===e.value)):i===e.value))):n.refs[0]&&(n.refs[0].checked=!!i):n.refs.forEach((e=>e.checked=e.value===i)):Ze(n.ref)?n.ref.value="":(n.ref.value=i,n.ref.type||p.watch.next({name:e})))}(n.shouldDirty||n.shouldTouch)&&v(e,i,n.shouldTouch,n.shouldDirty,!0),n.shouldValidate&&M(e)},R=(e,t,n)=>{for(const a in t){const i=t[a],o=`${e}.${a}`,s=me(r,o);!l.array.has(e)&&ht(i)&&(!s||s._f)||ie(i)?O(o,i,n):R(o,i,n)}},x=(e,t,n={})=>{const s=me(r,e),c=l.array.has(e),d=dt(t);qe(o,e,d),c?(p.array.next({name:e,values:o}),(u.isDirty||u.dirtyFields)&&n.shouldDirty&&(a.dirtyFields=At(i,o),p.state.next({name:e,dirtyFields:a.dirtyFields,isDirty:A(e,d)}))):!s||s._f||oe(d)?O(e,d,n):R(e,d,n),Ye(e,l)&&p.state.next({}),p.watch.next({name:e})},w=async e=>{const i=e.target;let s=i.name;const c=me(r,s);if(c){let f,y;const A=i.type?Ot(c._f):ce(e),b=e.type===_e||e.type===he,O=!((u=c._f).mount&&(u.required||u.min||u.max||u.maxLength||u.minLength||u.pattern||u.validate)||n.resolver||me(a.errors,s)||c._f.deps)||((e,t,n,a,r)=>!r.isOnAll&&(!n&&r.isOnTouch?!(t||e):(n?a.isOnBlur:r.isOnBlur)?!e:!(n?a.isOnChange:r.isOnChange)||e))(b,me(a.touchedFields,s),a.isSubmitted,_,m),R=Ye(s,l,b);qe(o,s,A),b?(c._f.onBlur&&c._f.onBlur(e),t&&t(0)):c._f.onChange&&c._f.onChange(e);const x=v(s,A,b,!1),w=!Ie(x)||R;if(!b&&p.watch.next({name:s,type:e.type}),O)return w&&p.state.next({name:s,...R?{}:x});if(!b&&R&&p.state.next({}),d[s]=(d[s],1),p.state.next({isValidating:!0}),n.resolver){const{errors:e}=await S([s]),t=xt(a.errors,r,s),n=xt(e,r,t.name||s);f=n.error,s=n.name,y=Ie(e)}else f=(await lt(c,me(o,s),h,n.shouldUseNativeValidation))[s],y=await g(!0);c._f.deps&&M(c._f.deps),E(s,y,f,x)}var u},M=async(e,t={})=>{let i,o;const s=$e(e);if(p.state.next({isValidating:!0}),n.resolver){const t=await(async e=>{const{errors:t}=await S();if(e)for(const n of e){const e=me(t,n);e?qe(a.errors,n,e):mt(a.errors,n)}else a.errors=t;return t})(pe(e)?e:s);i=Ie(t),o=e?!s.some((e=>me(t,e))):i}else e?(o=(await Promise.all(s.map((async e=>{const t=me(r,e);return await y(t&&t._f?{[e]:t}:t)})))).every(Boolean),(o||a.isValid)&&g()):o=i=await y(r);return p.state.next({...!Pe(e)||u.isValid&&i!==a.isValid?{}:{name:e},...n.resolver?{isValid:i}:{},errors:a.errors,isValidating:!1}),t.shouldFocus&&!o&&ze(r,(e=>me(a.errors,e)),e?s:l.mount),o},C=e=>{const t={...i,...s.mount?o:{}};return pe(e)?t:Pe(e)?me(t,e):e.map((e=>me(t,e)))},T=(e,t)=>({invalid:!!me((t||a).errors,e),isDirty:!!me((t||a).dirtyFields,e),isTouched:!!me((t||a).touchedFields,e),error:me((t||a).errors,e)}),k=(e,t={})=>{for(const s of e?$e(e):l.mount)l.mount.delete(s),l.array.delete(s),me(r,s)&&(t.keepValue||(mt(r,s),mt(o,s)),!t.keepError&&mt(a.errors,s),!t.keepDirty&&mt(a.dirtyFields,s),!t.keepTouched&&mt(a.touchedFields,s),!n.shouldUnregister&&!t.keepDefaultValue&&mt(i,s));p.watch.next({}),p.state.next({...a,...t.keepDirty?{isDirty:A()}:{}}),!t.keepIsValid&&g()},I=(e,t={})=>{let a=me(r,e);const c=Ke(t.disabled);return qe(r,e,{...a||{},_f:{...a&&a._f?a._f:{ref:{name:e}},name:e,mount:!0,...t}}),l.mount.add(e),a?c&&qe(o,e,t.disabled?void 0:me(o,e,Ot(a._f))):f(e,!0,t.value),{...c?{disabled:t.disabled}:{},...n.shouldUseNativeValidation?{required:!!t.required,min:Rt(t.min),max:Rt(t.max),minLength:Rt(t.minLength),maxLength:Rt(t.maxLength),pattern:Rt(t.pattern)}:{},name:e,onChange:w,onBlur:w,ref:o=>{if(o){I(e,t),a=me(r,e);const n=pe(o.value)&&o.querySelectorAll&&o.querySelectorAll("input,select,textarea")[0]||o,s=(e=>Je(e)||re(e))(n),l=a._f.refs||[];if(s?l.find((e=>e===n)):n===a._f.ref)return;qe(r,e,{_f:{...a._f,...s?{refs:[...l.filter(Et),n,...Array.isArray(me(i,e))?[{}]:[]],ref:{type:n.type,name:e}}:{ref:n}}}),f(e,!1,void 0,n)}else a=me(r,e,{}),a._f&&(a._f.mount=!1),(n.shouldUnregister||t.shouldUnregister)&&(!de(l.array,e)||!s.action)&&l.unMount.add(e)}}};return{control:{register:I,unregister:k,getFieldState:T,_executeSchema:S,_getWatch:b,_getDirty:A,_updateValid:g,_removeUnmounted:()=>{for(const e of l.unMount){const t=me(r,e);t&&(t._f.refs?t._f.refs.every((e=>!Et(e))):!Et(t._f.ref))&&k(e)}l.unMount=new Set},_updateFieldArray:(e,t=[],n,l,c=!0,d=!0)=>{if(l&&n){if(s.action=!0,d&&Array.isArray(me(r,e))){const t=n(me(r,e),l.argA,l.argB);c&&qe(r,e,t)}if(u.errors&&d&&Array.isArray(me(a.errors,e))){const t=n(me(a.errors,e),l.argA,l.argB);c&&qe(a.errors,e,t),((e,t)=>{!ue(me(e,t)).length&&mt(e,t)})(a.errors,e)}if(u.touchedFields&&d&&Array.isArray(me(a.touchedFields,e))){const t=n(me(a.touchedFields,e),l.argA,l.argB);c&&qe(a.touchedFields,e,t)}u.dirtyFields&&(a.dirtyFields=At(i,o)),p.state.next({isDirty:A(e,t),dirtyFields:a.dirtyFields,errors:a.errors,isValid:a.isValid})}else qe(o,e,t)},_getFieldArray:t=>ue(me(s.mount?o:i,t,e.shouldUnregister?me(i,t,[]):[])),_subjects:p,_proxyFormState:u,get _fields(){return r},get _formValues(){return o},get _stateFlags(){return s},set _stateFlags(e){s=e},get _defaultValues(){return i},get _names(){return l},set _names(e){l=e},get _formState(){return a},set _formState(e){a=e},get _options(){return n},set _options(e){n={...n,...e}}},trigger:M,register:I,handleSubmit:(e,t)=>async i=>{i&&(i.preventDefault&&i.preventDefault(),i.persist&&i.persist());let s=!0,c=dt(o);p.state.next({isSubmitting:!0});try{if(n.resolver){const{errors:e,values:t}=await S();a.errors=e,c=t}else await y(r);Ie(a.errors)?(p.state.next({errors:{},isSubmitting:!0}),await e(c,i)):(t&&await t({...a.errors},i),n.shouldFocusError&&ze(r,(e=>me(a.errors,e)),l.mount))}catch(e){throw s=!1,e}finally{a.isSubmitted=!0,p.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ie(a.errors)&&s,submitCount:a.submitCount+1,errors:a.errors})}},watch:(e,t)=>Ve(e)?p.watch.subscribe({next:n=>e(b(void 0,t),n)}):b(e,t,!0),setValue:x,getValues:C,reset:(t,n)=>((t,n={})=>{const c=t||i,d=dt(c),m=t&&!Ie(t)?d:i;if(n.keepDefaultValues||(i=c),!n.keepValues){if(n.keepDirtyValues)for(const e of l.mount)me(a.dirtyFields,e)?qe(m,e,me(o,e)):x(e,me(m,e));else{if(ct&&pe(t))for(const e of l.mount){const t=me(r,e);if(t&&t._f){const e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;try{if(ft(e)){e.closest("form").reset();break}}catch(e){}}}r={}}o=e.shouldUnregister?n.keepDefaultValues?dt(i):{}:d,p.array.next({values:m}),p.watch.next({values:m})}l={mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},s.mount=!u.isValid||!!n.keepIsValid,s.watch=!!e.shouldUnregister,p.state.next({submitCount:n.keepSubmitCount?a.submitCount:0,isDirty:n.keepDirty||n.keepDirtyValues?a.isDirty:!(!n.keepDefaultValues||gt(t,i)),isSubmitted:!!n.keepIsSubmitted&&a.isSubmitted,dirtyFields:n.keepDirty||n.keepDirtyValues?a.dirtyFields:n.keepDefaultValues&&t?At(i,t):{},touchedFields:n.keepTouched?a.touchedFields:{},errors:n.keepErrors?a.errors:{},isSubmitting:!1,isSubmitSuccessful:!1})})(Ve(t)?t(o):t,n),resetField:(e,t={})=>{me(r,e)&&(pe(t.defaultValue)?x(e,me(i,e)):(x(e,t.defaultValue),qe(i,e,t.defaultValue)),t.keepTouched||mt(a.touchedFields,e),t.keepDirty||(mt(a.dirtyFields,e),a.isDirty=t.defaultValue?A(e,me(i,e)):A()),t.keepError||(mt(a.errors,e),u.isValid&&g()),p.state.next({...a}))},clearErrors:e=>{e?$e(e).forEach((e=>mt(a.errors,e))):a.errors={},p.state.next({errors:a.errors})},unregister:k,setError:(e,t,n)=>{const i=(me(r,e,{_f:{}})._f||{}).ref;qe(a.errors,e,{...t,ref:i}),p.state.next({name:e,errors:a.errors,isValid:!1}),n&&n.shouldFocus&&i&&i.focus&&i.focus()},setFocus:(e,t={})=>{const n=me(r,e)._f,a=n.refs?n.refs[0]:n.ref;a.focus(),t.shouldSelect&&a.select()},getFieldState:T}}function Ct(e){const t=e.toTimeString().split(" ")[0].split(":");return`${t[0]}:${t[1]}`}a.injectInternalStyle("typescript/component_libraries/docsend/src/components/sharing/link_modal.module.out.css",(e=>"._modalBody_5k6al_2 legend{margin:unset}._form-footer_5k6al_6{align-items:center;display:flex;justify-content:flex-end;width:100%}._button-group_5k6al_13{display:flex}._link-settings_5k6al_17{display:grid;gap:var(--spacing__unit--1)}._delete-button-container_5k6al_22{width:100%}._error-banner_5k6al_26{margin-bottom:var(--spacing__unit--3)}._loading-body_5k6al_30{align-items:center;display:flex;justify-content:center;min-height:350px}._password-input_5k6al_36{width:75%}._expire-date-time-container_5k6al_40{display:flex;gap:var(--spacing__unit--2_5)}._expire-date-container_5k6al_45{width:50%}._expire-date-container_5k6al_45 [class*=dig-ClickOutside]{width:100%}._expire-time-container_5k6al_53{width:50%}._expire-time-container_5k6al_53 [class*=dig-TextInputContainer]{width:100%}._disabled_5k6al_61{color:var(--dig-color__disabled__base);pointer-events:none}"));const Tt="_modalBody_5k6al_2",kt="_form-footer_5k6al_6",It="_button-group_5k6al_13",Dt="_link-settings_5k6al_17",$t="_delete-button-container_5k6al_22",Ft="_error-banner_5k6al_26",Nt="_loading-body_5k6al_30",Pt="_password-input_5k6al_36",Lt="_expire-date-time-container_5k6al_40",Vt="_expire-date-container_5k6al_45",Bt="_expire-time-container_5k6al_53",Ut="_disabled_5k6al_61",Ht=({isEditingLink:e})=>r.React$1.createElement(a.Modal.Title,{id:"create-edit-link-modal-title"},e?r.React$1.createElement(a.FormattedMessage,{id:"nOpl1K",defaultMessage:"Edit link settings"}):r.React$1.createElement(a.FormattedMessage,{id:"CiNEXx",defaultMessage:"Create a link to share this file"}));function jt({isEdittingLink:e,defaultValues:t,onSubmit:i,downloadOnly:o,isOpen:s,closeModal:l,onDelete:c,submitErrorMessage:d,reportModalException:u}){const p=a.useIntl(),m=r.React$1.useMemo((()=>new Date((new Date).setHours(0,0,0,0))),[]),_=r.React$1.useCallback((e=>!!e&&e<m),[m]),h=r.React$1.useMemo((()=>{var e,n,a;return{account:null!==(e=null==t?void 0:t.account)&&void 0!==e?e:p.formatMessage({id:"UCjwYX",defaultMessage:"Link {createdTime, date, short} at {createdTime, time, short}"},{createdTime:new Date}),requireEmail:!!(null==t?void 0:t.requireEmail),passcode:null!==(n=null==t?void 0:t.passcode)&&void 0!==n?n:null,allowDownloading:!!o||!!(null==t?void 0:t.allowDownloading),expireDate:null!==(a=null==t?void 0:t.expireDateTime)&&void 0!==a?a:null,expireTime:(null==t?void 0:t.expireDateTime)?Ct(t.expireDateTime):null}}),[p,t]),{handleSubmit:f,control:v,formState:{isSubmitting:E,errors:A},reset:b,watch:O,setValue:R}=function(e={}){const t=r.React$1.useRef(),[n,a]=r.React$1.useState({isDirty:!1,isValidating:!1,dirtyFields:{},isSubmitted:!1,submitCount:0,touchedFields:{},isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,errors:{}});t.current?t.current.control._options=e:t.current={...Mt(e),formState:n};const i=t.current.control,o=r.React$1.useCallback((e=>{De(e,i._proxyFormState,!0)&&(i._formState={...i._formState,...e},a({...i._formState}))}),[i]);return Ne({subject:i._subjects.state,callback:o}),r.React$1.useEffect((()=>{i._stateFlags.mount||(i._proxyFormState.isValid&&i._updateValid(),i._stateFlags.mount=!0),i._stateFlags.watch&&(i._stateFlags.watch=!1,i._subjects.state.next({})),i._removeUnmounted()})),t.current.formState=ke(n,i._proxyFormState),t.current}({reValidateMode:"onSubmit",defaultValues:h}),x=r.react.exports.useRef(null),w=r.react.exports.useRef(null),M=e=>{e.currentTarget.select()},C=new Date(Date.now()+864e5);C.setSeconds(0,0);const T=O("expireDate"),k=O("expireTime"),[I,D]=r.React$1.useState(!!(null==t?void 0:t.expireDateTime)&&t.expireDateTime<=new Date);r.React$1.useEffect((()=>{(!T||!k||Gt(T,k)>new Date)&&D(!1)}),[T,k]);const[$,F]=r.React$1.useState(null),N=r.React$1.useCallback((e=>n.__awaiter(this,void 0,void 0,(function*(){F(null);try{yield i(function(e){var t;const{expireTime:a,expireDate:r,account:i}=e,o=n.__rest(e,["expireTime","expireDate","account"]),s=null!==(t=null==i?void 0:i.trim())&&void 0!==t?t:null;if(""===a||!r)return Object.assign(Object.assign({},o),{account:s,expireDateTime:r});return Object.assign(Object.assign({},o),{account:s,expireDateTime:Gt(r,a)})}(e))}catch(e){null==u||u(e instanceof Error?e:new Error(`Unexpected link submission error: ${e}`),["owner-docsend-gf","docsend-hub-link-submission-error"]),d&&F(d)}}))),[i,d]),P=r.React$1.useCallback((()=>{F(null),b(h),D(!!(null==t?void 0:t.expireDateTime)&&t.expireDateTime<new Date)}),[null==t?void 0:t.expireDateTime,h,b]);r.react.exports.useEffect((()=>{s&&P()}),[P,s]);const L=p.formatMessage({id:"3qttDa",defaultMessage:"Enter a link name"});return r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(a.Modal.Body,{className:Tt},I&&r.React$1.createElement(a.Banner,{type:"warning",className:Ft},r.React$1.createElement(a.Banner.Message,null,r.React$1.createElement(a.FormattedMessage,{id:"+7xLKD",defaultMessage:"Link expired. Remove the expiration date or select a date in the future."}))),!!$&&r.React$1.createElement(a.Banner,{type:"alert",className:Ft},r.React$1.createElement(a.Banner.Message,null,$)),r.React$1.createElement(y.FormRow,null,r.React$1.createElement("div",{ref:x},r.React$1.createElement(y.FormLabel,{htmlFor:"link-name-field","aria-describedby":"link-name-desc"},r.React$1.createElement(a.FormattedMessage,{id:"mDkVSH",defaultMessage:"Link name"}))),r.React$1.createElement(He,{control:v,name:"account",defaultValue:null==t?void 0:t.account,rules:{required:L,maxLength:{value:255,message:p.formatMessage({id:"DpjHDU",defaultMessage:"Link name is too long. Keep it under 255 characters."})},validate:{notEmptyString:e=>!!(null==e?void 0:e.trim())||L}},render:({field:{value:e,onChange:t}})=>r.React$1.createElement(a.TextInput,{id:"link-name-field",onChange:t,value:null!=e?e:"",onFocus:M})}),A.account?r.React$1.createElement(y.FormHelperText,{variant:"alert"},A.account.message):r.React$1.createElement(y.FormHelperText,{id:"link-name-field-desc"},r.React$1.createElement(a.FormattedMessage,{id:"XW/z2H",defaultMessage:"Naming a link makes it easy to identify at a glance. Link names are only visible to you."}))),r.React$1.createElement(y.FormControlGroup,null,r.React$1.createElement("div",{className:Dt,ref:w},r.React$1.createElement(y.FormLabel,{tagName:"legend"},r.React$1.createElement(a.FormattedMessage,{id:"TF+xyZ",defaultMessage:"Link security settings"})),r.React$1.createElement(y.FormRow,{variant:"control"},r.React$1.createElement(He,{control:v,name:"requireEmail",render:({field:{value:e,onChange:t}})=>r.React$1.createElement(g.Checkbox,{id:"require-email-checkbox",checked:e,onChange:t})}),r.React$1.createElement(a.Label,{htmlFor:"require-email-checkbox"},r.React$1.createElement(a.FormattedMessage,{id:"PkuF0m",defaultMessage:"Require an email to view"}))),r.React$1.createElement(Wt,{id:"expiration-checkbox",labelText:p.formatMessage({id:"2GOJGt",defaultMessage:"Set an expiration date"}),defaultValue:!!(null==t?void 0:t.expireDateTime),onChangeCallback:e=>{!0===e&&(R("expireDate",C),R("expireTime",Ct(C)))}},r.React$1.createElement(y.FormRow,null,r.React$1.createElement("div",{className:Lt},r.React$1.createElement("div",{className:Vt},r.React$1.createElement(He,{control:v,name:"expireDate",shouldUnregister:!0,rules:{required:p.formatMessage({id:"bu3TEP",defaultMessage:"Select a date in the future"}),validate:{pastDate:e=>!_(e)||p.formatMessage({id:"61iDEu",defaultMessage:"Select a date in the future"})}},render:({field:{value:e,onChange:t}})=>r.React$1.createElement(S.DatePickerInput,{value:null!=e?e:null,id:"expiration-picker",onChange:t,"data-testid":"CreateEditLinkModal__DatePickerInput",isInvalid:!!A.expireDate,isDateBlocked:_,dayLabelFormat:e=>p.formatDate(e,{day:"2-digit"}),monthLabelFormat:e=>p.formatDate(e,{month:"long",year:"numeric"}),weekdayLabelFormat:e=>p.formatDate(e,{weekday:"narrow"})})}),A.expireDate&&r.React$1.createElement(y.FormHelperText,{variant:"alert"},A.expireDate.message)),r.React$1.createElement("div",{className:Bt},r.React$1.createElement(He,{control:v,name:"expireTime",shouldUnregister:!0,rules:{required:p.formatMessage({id:"q6m95e",defaultMessage:"Enter a valid time"}),validate:{pastTime:e=>!T||Gt(T,e)>new Date||p.formatMessage({id:"ZfORMN",defaultMessage:"Select a time in the future"})}},render:({field:{value:e,onChange:t}})=>r.React$1.createElement(a.TextInput,{type:"time",value:null!=e?e:"",id:"expiration-picker",onChange:t,isInvalid:!!A.expireTime,"data-testid":"CreateEditLinkModal__TimePickerInput"})}),A.expireTime&&r.React$1.createElement(y.FormHelperText,{variant:"alert"},A.expireTime.message))))),r.React$1.createElement(Wt,{id:"passcode-checkbox",labelText:p.formatMessage({id:"L4mvAK",defaultMessage:"Add password protection"}),defaultValue:!!(null==t?void 0:t.passcode)},r.React$1.createElement(y.FormRow,null,r.React$1.createElement(He,{control:v,name:"passcode",shouldUnregister:!0,rules:{required:p.formatMessage({id:"S9/hCj",defaultMessage:"Enter a password"}),maxLength:{value:100,message:p.formatMessage({id:"h5iTH4",defaultMessage:"Password is too long. Keep it under 100 characters."})}},render:({field:{value:e,onChange:t}})=>r.React$1.createElement("div",{className:Pt},r.React$1.createElement(a.TextInput,{id:"passcode-field",onChange:t,value:null!=e?e:"","data-testid":"CreateEditLinkModal__PasscodeInput",isInvalid:!!A.passcode}))}),A.passcode&&r.React$1.createElement(y.FormHelperText,{variant:"alert"},A.passcode.message))),r.React$1.createElement(y.FormRow,{variant:"control"},r.React$1.createElement(He,{control:v,name:"allowDownloading",render:({field:{value:e,onChange:t}})=>r.React$1.createElement(g.Checkbox,{id:"download-checkbox",className:o?Ut:"",checked:!!o||e,onChange:t,disabled:o})}),r.React$1.createElement(a.Label,{htmlFor:"download-checkbox",className:o?Ut:""},r.React$1.createElement(a.FormattedMessage,{id:"DfeWE8",defaultMessage:"Allow downloads"})))))),r.React$1.createElement(a.Modal.Footer,null,r.React$1.createElement("div",{className:kt},e&&c&&r.React$1.createElement("div",{className:$t},r.React$1.createElement(a.Button,{variant:"transparent",onClick:c,disabled:E},r.React$1.createElement(a.Text,{color:"error"},r.React$1.createElement(a.FormattedMessage,{id:"ts+c+9",defaultMessage:"Delete link"})))),r.React$1.createElement("div",{className:It},r.React$1.createElement(a.Button,{variant:"opacity",onClick:l},r.React$1.createElement(a.FormattedMessage,{id:"//TQQx",defaultMessage:"Cancel"})),r.React$1.createElement(a.Button,{variant:"primary",onClick:f(N),disabled:E||I},e?r.React$1.createElement(a.FormattedMessage,{id:"xTDvqL",defaultMessage:"Save"}):r.React$1.createElement(a.FormattedMessage,{id:"5zfDki",defaultMessage:"Create link"}))))))}function Wt({children:e,defaultValue:t=!1,id:n,labelText:i,onChangeCallback:o}){const[s,l]=r.React$1.useState(t);return r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(y.FormRow,{variant:"control"},r.React$1.createElement(g.Checkbox,{id:n,checked:s,onChange:()=>{const e=!s;l(e),o&&o(e)}}),!!i&&r.React$1.createElement(a.Label,{htmlFor:n},i)),s&&e)}function Gt(e,t){if(!t)return e;const n=t.split(":"),a=new Date(e);return a.setHours(Number(n[0]),Number(n[1])),a}function qt(e){var{isLoading:t,isOpen:i,closeModal:o,reportModalException:s}=e,l=n.__rest(e,["isLoading","isOpen","closeModal","reportModalException"]);const c=a.useIntl();return r.React$1.createElement(a.Modal,{open:i,isCentered:!0,shouldCloseOnOverlayClick:!1,withCloseButton:c.formatMessage({id:"vawEMm",defaultMessage:"Close"}),"aria-labelledby":"create-edit-link-modal-title",onRequestClose:o},r.React$1.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(Ht,{isEditingLink:!!l.isEdittingLink})),t?r.React$1.createElement(a.Modal.Body,{className:Nt},r.React$1.createElement(a.Spinner,{"data-testid":"spinner"})):r.React$1.createElement(jt,Object.assign({isOpen:i,closeModal:o,reportModalException:s},l)))}Ht.displayName="ModalTitle";const zt=({closeModal:e,documentGroup:t,onSubmit:n})=>{const i=a.useIntl(),[o,s]=r.react.exports.useState(null);return r.react.exports.useEffect((()=>{t.then((e=>s(e)))}),[t]),o?r.React$1.createElement(qt,{isOpen:!0,onSubmit:e=>n(o.documentGroupId,e),closeModal:e,submitErrorMessage:i.formatMessage({id:"XskuuZ",defaultMessage:"Couldn’t create link. Try again later."}),downloadOnly:o.downloadOnly}):r.React$1.createElement(ae,{isOpen:!0,isCopying:!0,onCopyFile:()=>{},onClose:e,onCancel:e,onAfterClose:()=>{},logModalButtonSelectEvent:()=>{}})};function Yt(e){var t,n,a;const r=(null!==(n=null===(t=e.expireDateTime)||void 0===t?void 0:t.getTime())&&void 0!==n?n:0)/1e3;return{require_email:!!e.requireEmail,downloadable:!!e.allowDownloading,passcode:null!==(a=e.passcode)&&void 0!==a?a:void 0,expire_at:r}}function Xt(e,t){const i=new a.DefaultUserApiV2Client(e),o=function(e,t){var r,i;return n.__awaiter(this,void 0,void 0,(function*(){const n=new a.DefaultUserApiV2Client(e);yield n.ns("docsend_hub").rpc("provision",{},{});const o=yield n.ns("docsend_hub").rpc("create_document_from_dropbox",{file_id:t},{});return{documentGroupId:`${null===(r=o.document)||void 0===r?void 0:r.id}`,downloadOnly:!!(null===(i=o.document)||void 0===i?void 0:i.download_only)}}))}(e,t),s=e=>{b.reportException({err:e}),a.Snackbar.fail(r.React$1.createElement(h.Provider,{value:h.intl},r.React$1.createElement(a.FormattedMessage,{id:"eIkVAu",defaultMessage:"Something went wrong. Try again later."}))),a.unmountModal()};a.mountModal(r.React$1.createElement(h.Provider,{value:h.intl},r.React$1.createElement(zt,{documentGroup:o,closeModal:a.unmountModal,onSubmit:(e,t)=>i.ns("docsend_hub").rpc("create_link",function(e,t){var n;return{link_name:null!==(n=t.account)&&void 0!==n?n:void 0,document_group_id:e,link_settings:Yt(t)}}(e,t),{}).then((t=>function(e,t){const n=new URLSearchParams;n.set("link",t),a.redirect(new A.URI({path:`/docsend/files/${e}`,fragment:n.toString()}))}(e,t.link_url||""))).catch(s)}))),o.catch(s)}function Kt(e,t){return n.__awaiter(this,void 0,void 0,(function*(){var n;!(yield(n=e.id,Promise.race([q(n),new Promise((e=>setTimeout((()=>e(!1)),100)))])))?a.mountModal(r.React$1.createElement(h.Provider,{value:h.intl},r.React$1.createElement(X,{isOpen:!0,closeModal:a.unmountModal,onSubmit:n=>{n.dontShowAgain&&function(e){G[e]=Promise.resolve(!0),a.setUserMetadata({DOCSEND_ADDON_SHARING_DO_NOT_SHOW_WELCOME_MODAL:!0},e)}(e.id),Xt(e,t)}}))):Xt(e,t)}))}var Zt;zt.displayName="SendAndTrackModal",function(e){e[e.NO_TOOLTIP=0]="NO_TOOLTIP",e[e.BIG_ONBOARDING_TOOLTIP=1]="BIG_ONBOARDING_TOOLTIP",e[e.SMALL_TOOLTIP=2]="SMALL_TOOLTIP"}(Zt||(Zt={}));const Qt=new a.ProfileServicesLinkingHandler,Jt={zoom:"zoom",slack_dropbox:"dropbox_slack",trello:"trello"};function en(e,t,n,a,r={}){return{event_name:M.InstrEventType.ServiceConnectionFlowEnd,service_type:e[".tag"],feature_name:t,extra:Object.assign(Object.assign({},r),{desired_outcome:n,outcome:a,was_successful:`${a===n}`})}}function tn(e,t){return!!e&&t in e&&"is_connected"===e[t].connection_state[".tag"]}function nn(e,t,r,i,o,s){return n.__awaiter(this,void 0,void 0,(function*(){if(tn(t,i))return!0;const l=w.withDefaults(a.createIntegrationsActionsLogger().logEvent,{extra:w.getCommonContextExtra({serviceList:Object.keys(t).map((e=>t[e]))})}),c=t[i];c&&l(function(e,t,n,a,r={}){return{event_name:M.InstrEventType.ServiceConnectionFlowStart,service_type:e[".tag"],feature_name:n,extra:Object.assign(Object.assign({},r),{connection_state:t[".tag"],desired_outcome:a})}}(c.service_type,c.connection_state,o,M.InstrConnectServiceFlowOutcome.Connected));try{yield function(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){const n={".tag":t},i=()=>{const t=a.ProfileServicesConstants.from_api_service_type(n),{action:r}=a.ProfileServicesConstants.get_service_data(n,"profile_card_v2");return r?Qt.auth_service_with_user_promise(t,e,null,r):Promise.reject({reason:"no_service_action"})};if(r&&Jt[t]){const e=yield Qt.auth_service_with_user_with_landing_page(n,i);a.ProfileServicesLinkingHandler.show_import_notifications(e)}else{const e=yield i();a.ProfileServicesLinkingHandler.show_import_notifications(e)}}))}(e.id,i,s);const t=yield function(e,t){return new Promise((n=>t({user:e,onRefresh:n})))}(e,r),d=tn(t,i);return c&&l(en(c.service_type,o,M.InstrConnectServiceFlowOutcome.Connected,d?M.InstrConnectServiceFlowOutcome.Connected:M.InstrConnectServiceFlowOutcome.Error)),d}catch(e){throw c&&l(en(c.service_type,o,M.InstrConnectServiceFlowOutcome.Connected,M.InstrConnectServiceFlowOutcome.Error,{error:JSON.stringify(e)})),e}}))}const an=new class{constructor(){this.events=[],this.listeners=new Set}push(e){this.events=[e,...this.events],this.listeners.forEach((e=>e(this.events)))}subscribe(e){this.listeners.add(e),e(this.events)}unsubscribe(e){this.listeners.delete(e)}};function rn(e,t,n){an.push({eventName:e,data:t,eventType:n})}function on(e,t={}){a.logEvent(e,t,"commerce");try{const t=function(e){var t;return null===(t=e.constructor.getTypeUrl())||void 0===t?void 0:t.split(".").pop()}(e);rn(t,e,"pap")}catch(e){console.error(e)}}const sn=()=>{var e;const t=a.Viewer.get_viewer(),n=t.is_signed_in?null!==(e=a.getActiveUser())&&void 0!==e?e:t.personal_user:void 0,r=null==n?void 0:n.email;return!!r&&/@(dropbox|dbx51)\.com$/i.test(r)},ln=(e,t)=>(Object.keys(e).forEach((t=>{"object"==typeof e[t]?e[t]=ln(e[t],!0):-1===[null,void 0].indexOf(e[t])&&(e[t]=String(e[t]))})),t||(e.eventId=a.UUID.v4()),e);var cn,dn;!function(e){e.SEND_VERIFY_EMAIL="send_verify_email"}(cn||(cn={})),function(e){e[e.FINDING_IN_PROGRESS=0]="FINDING_IN_PROGRESS",e[e.NOT_CREATED=1]="NOT_CREATED",e[e.CREATED=2]="CREATED"}(dn||(dn={}));const un=(e,t)=>{const n=(e=>e.map((e=>e.file_id)).join("."))(e);var r;a.open_tab((r={referrer:t,fileIds:n},new A.URI({scheme:"https",authority:"www.dropbox.com",path:"/shop/create",query:r}).toString()))},pn=e=>{const t={audio:0,document:0,image:0,other:0,video:0};return e.forEach((e=>{const n=a.file_extension(a.filename(e.fq_path)),r=a.ExtensionCategories[n].toLowerCase();r in t?t[r]++:t.other++})),t};a.injectInternalStyle("metaserver/static/js/extensions/split_share_button_component.module.out.css",(e=>"._docsend_tooltip_image_x0mff_1{height:98px;width:157px}._docsend_lightbulb_icon_x0mff_6{color:var(--color__attention__text);height:14px;width:16px}._docsend_badge_x0mff_12{background:var(--color__attention__background);height:18px;width:26px}._button-wrapper_x0mff_18{display:flex;white-space:nowrap}._button-wrapper_x0mff_18._invisible_x0mff_23{display:none}._share-fake-split-button_x0mff_27>.extensions-split-share__share-button{margin-right:1px}._unportaled-menu_x0mff_31{white-space:nowrap}"));const mn="_docsend_tooltip_image_x0mff_1",_n="_docsend_lightbulb_icon_x0mff_6",hn="_docsend_badge_x0mff_12",gn="_button-wrapper_x0mff_18",fn="_invisible_x0mff_23",vn="_share-fake-split-button_x0mff_27",En="_unportaled-menu_x0mff_31",Sn=a.getStore(),yn=r.React$1.forwardRef(((e,t)=>{var{openOption:i,description:o,rightAccessory:s,experimentInfo:l,actionSurface:c,fileExt:d,campaignAnchorName:u,dataTooltipId:p,onImpression:m}=e,_=n.__rest(e,["openOption","description","rightAccessory","experimentInfo","actionSurface","fileExt","campaignAnchorName","dataTooltipId","onImpression"]);let h;return h=i.iconElement?i.iconElement:i.iconUrl?r.React$1.createElement("img",{alt:"",src:i.iconUrl,width:24,height:24}):null,r.React$1.useEffect((()=>{"docsend_analytics_add_on"===(null==l?void 0:l.experimentName)&&a.ProEventsLogger.log(`docsend_analytics_add_on_${l.variant}`,{entryPoint:"split_share_menu",actionSurface:c,fileExt:d}),null==m||m()}),[]),r.React$1.createElement(a.Menu.ActionItem,Object.assign({value:i,withLeftAccessory:h,withSubtitle:o,withRightAccessory:s,"data-testid":i?`split-share-menu-action-${i.userAction}`:"","data-campaigns-element-id":u,"data-tooltip":p,ref:t},_),i.text)}));yn.displayName="MenuContentItem";class An extends r.React$1.Component{constructor(t){super(t),this.preloadCampaignMenuItemAssets=()=>{new Promise((function(t,n){e(["./c_campaign_formats_menu_campaign_menu_item"],t,n)}))},this.handleClickShare=e=>{e.preventDefault(),this.props.onShowShare(),this.props.logShareButtonClick&&this.props.logShareButtonClick(this.props.renderMenuOnly?a.ActionSourceValue.OVERFLOW_MENU:a.ActionSourceValue.SPLIT_SHARE),this.currentSession&&this.currentSession.event("click_share",{trigger_type:this.props.triggerType}),e.stopPropagation()},this.handleSelectAction=e=>{e.handler()},this.logSelectActionOverflowMenu=(e,t)=>{var n,r;this.props.logShareButtonClick&&this.props.logShareButtonClick(this.props.renderMenuOnly?a.ActionSourceValue.OVERFLOW_MENU:a.ActionSourceValue.SPLIT_SHARE,e),null===(r=(n=this.props).previewsLogUserAction)||void 0===r||r.call(n,e,this.props.renderMenuOnly?a.ActionSourceValue.OVERFLOW_MENU:a.ActionSourceValue.SPLIT_SHARE),x.logEvent(this.currentSession,"select_action",{type:t,trigger_type:this.props.triggerType})},this.handlePreventMouseDown=e=>{e.preventDefault(),this.state.tooltipState===Zt.BIG_ONBOARDING_TOOLTIP&&(this.markSplitShareTooltipViewed(),this.setState({tooltipState:Zt.NO_TOOLTIP})),e.stopPropagation()},this.handlePopoverHover=()=>{this.currentSession&&this.currentSession.event("popover_trigger_hover",{trigger_type:this.props.triggerType})},this.handleShareHover=()=>{this.currentSession&&this.currentSession.event("share_hover",{trigger_type:this.props.triggerType})},this.handlePopoverToggle=({isOpen:e})=>{const{onDropdownOpen:t,onDropdownClose:n,triggerType:a}=this.props;e&&t?t():!e&&n&&n(),this.currentSession&&this.currentSession.event(e?"open_popover":"close_popover",{trigger_type:a})},this.handleUploadToCanvas=(t,a,r)=>{const{refreshSharingServiceInfo:i,sharingServiceInfo:o,landingPageEnabled:s}=this.props;o&&i&&function(t,a,r,i,o,s,l){nn(t,a,r,"canvas",o,s).then((a=>n.__awaiter(this,void 0,void 0,(function*(){if(a){l&&l();const{showUploadToCanvasModal:n}=yield new Promise((function(t,n){e(["./c_integrations_canvas_upload_to_canvas"],t,n)}));n(t,i)}}))))}(a,o,i,t,"split_share_button",s,r)},this.handleUpdateLinkState=(e,t)=>{const{updateLinkState:n}=this.props;n({actionId:e,linkState:t})},this.handleAppAction=(e,t,n)=>{const{context:a,featureFlags:r}=this.props,i=e.map((e=>e));R.redirectToActionOrShowAuth(t,i,n,r,a,this.handleUpdateLinkState,this.handleShareAction),x.logEvent(this.currentSession,"select_action",x.getAppActionExtras(n))},this.handleShareAction=(e,t,n)=>{N.logBrowseTTS("share_with_external_app");const a=n.handler.service_type[".tag"],r={".tag":"profile_linked"},i=()=>{this.handleUpdateLinkState(n.id,r),R.authorizeNoRedirect(e,n.id)};if("canvas"===a)return this.handleUploadToCanvas(t,e,i)},this.getAppActionIconUrl=e=>{const{icon:t}=e;return t&&t.url&&!t.is_static?t.url:r.static_url("/static/metaserver/static/images/generic_app_icon-vflIPYT1H.png")},this.getAppActionOpenOptionActions=({handler:e})=>{if("profile_service"!==e[".tag"])return{type:x.OpenButtonAction.APP_ACTION,userAction:a.UserAction.ShareToAction};e.service_type[".tag"];return{type:x.OpenButtonAction.APP_ACTION,userAction:a.UserAction.ShareToAction}},this.handleHellosignDeepIntegrationLaunch=(t,n,a,r)=>new Promise((function(t,n){e(["./c_integrations_hellosign_deep_integration_launcher"],t,n)})).then((({getLauncher:e})=>{const i=e();return i.init({entryPoint:r||"share_menu",file:t,user:n,source:a}),i})).then((e=>(e.launch(),e))),this.getHellosignOpenOption=(e,t)=>{const n=h.intl.formatMessage({id:"KPapIP",defaultMessage:"Send for signature"});return{handler:(n,r)=>{this.handleHellosignDeepIntegrationLaunch(e,t,n,r),this.logSelectActionOverflowMenu(a.UserAction.SendForSignatureAction,x.OpenButtonAction.PREPARE_FOR_SIGNATURE)},iconElement:r.React$1.createElement(a.UIIcon,{src:u.SendLine}),spriteName:null,text:n,type:x.OpenButtonAction.PREPARE_FOR_SIGNATURE,userAction:a.UserAction.SendForSignatureAction}},this.handleShareWithAnalytics=(e,t,n,r,i)=>{a.ProEventsLogger.log(`docsend_analytics_add_on_${n}_click`,{entryPoint:"split_share_menu",actionSource:this.props.actionSurface,fileExt:i}),this.logSelectActionOverflowMenu(a.UserAction.ShareWithAnalytics,x.OpenButtonAction.SHARE_WITH_ANALYTICS),r.useDocSendHub?Kt(t,e.file_id):L.showDocsendModal({fileId:e.file_id,fileName:a.filename(e.fq_path),filePath:a.parent_dir(e.fq_path),user:t,stormcrowVariant:n,entryPoint:"split_share_menu"+(this.props.actionSurface?`_${this.props.actionSurface}`:"")})},this.getAppActionOpenOption=(e,t,n,a={})=>{const{type:r,userAction:i}=this.getAppActionOpenOptionActions(n);return Object.assign({handler:()=>{this.handleAppAction(e,t,n),this.logSelectActionOverflowMenu(i,r)},spriteName:null,text:n.description,type:r,userAction:i,iconUrl:this.getAppActionIconUrl(n)},a)},this.getDocSendOpenOption=(e,t,n,r={},i,o,s)=>{const{type:l,userAction:c}=this.getAppActionOpenOptionActions(n);return Object.assign({handler:()=>{this.handleAppAction(e,t,n),this.logSelectActionOverflowMenu(c,l),o&&a.logEvent({class:"onboard",action:"click",object:"core_act_docsend_advanced_sharing_split_share_menu",properties:{experimentVariant:s}}),i&&(B.setHasConfirmedDocsendSplitShareItemInUserMetadata(this.props.user.id),Sn.dispatch(a.setDocsendAdvancedSharingHasConfirmedSplitShareMenu({docsendAdvancedSharingHasConfirmedSplitShareMenu:!0})))},spriteName:null,text:n.description,type:l,userAction:c,iconUrl:this.getAppActionIconUrl(n)},r)},this.getMoreAppsOpenOption=(e,t)=>({handler:()=>{this.handleMoreApps(e,t),x.logEvent(this.currentSession,"select_show_more",{}),this.logSelectActionOverflowMenu(a.UserAction.OpenMoreApps,x.OpenButtonAction.OPEN_MORE_APPS)},text:h.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}),type:x.OpenButtonAction.OPEN_MORE_APPS,userAction:a.UserAction.OpenMoreApps,spriteName:null,iconElement:r.React$1.createElement(a.UIIcon,{src:a.AddCircleLine})}),this.getAddAppsOpenOption=(e,t)=>({handler:()=>{this.handleMoreApps(e,t),x.logEvent(this.currentSession,"select_add_apps",{}),this.logSelectActionOverflowMenu(a.UserAction.OpenAddApps,x.OpenButtonAction.OPEN_ADD_APPS)},text:h.intl.formatMessage({id:"XFA09U",defaultMessage:"Connect apps"}),type:x.OpenButtonAction.OPEN_ADD_APPS,userAction:a.UserAction.OpenAddApps,spriteName:null,iconElement:r.React$1.createElement(a.UIIcon,{src:a.AddCircleLine})}),this.getAppCenterLinkOpenOption=()=>({handler:()=>{x.logEvent(this.currentSession,"select_show_more",{}),this.logSelectActionOverflowMenu(a.UserAction.OpenMoreApps,x.OpenButtonAction.OPEN_MORE_APPS),a.open_tab(new A.URI({path:"/apps"}))},text:h.intl.formatMessage({id:"Gevpqz",defaultMessage:"Connect more apps"}),type:x.OpenButtonAction.OPEN_MORE_APPS,userAction:a.UserAction.OpenMoreApps,spriteName:null,iconElement:r.React$1.createElement(a.UIIcon,{src:a.AddCircleLine})}),this.handleMoreApps=(e,t)=>{const{appActions:n,featureFlags:a,context:r,categoryInfo:i}=this.props,o=R.getCategoryIdToInfos(i);R.showExtensionsMiniDirectoryModal(h.intl.formatMessage({id:"A7cFjC",defaultMessage:"Share with these apps"}),t,e,n.filter((e=>![x.TRANSFER_FP_APP_ID].includes(e.app_id))).sort(x.actionCompareFn),o,a,this.handleUpdateLinkState,r,this.currentSession,this.handleShareAction)},this.computeReferrer=e=>{const t=this.props.renderMenuOnly?a.ActionSourceValue.OVERFLOW_MENU:a.ActionSourceValue.SPLIT_SHARE;return R.computeSplitShareMenuReferrer(e,t,this.props.retrievalSource,this.props.actionSurface)},this.handleAddToTransfer=(t,a,r)=>{const{fileTransfersModalExp:i}=this.props.featureFlags;"ON"===i?((t,a,r)=>{n.__awaiter(void 0,void 0,void 0,(function*(){const{showTransferModal:n}=yield new Promise((function(t,n){e(["./c_containers_transfer_modal"],t,n)}));return n(t,a,r)}))})(r,t,a):$.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>D.redirectToCreateTransferWithFiles(t,a),userId:r.id})},this.handleSellWithShop=(t,a,r,i)=>{var o;(({files:e,referrer:t,experimentVariant:n="OFF"})=>{const a=pn(e);on({class:"commerce_web_entry_points",action:"click",object:"split_share_menu_item",properties:{isDropboxer:sn(),commerceTotalAudioFilesAdded:a.audio,commerceTotalImageFilesAdded:a.image,commerceTotalSsrDocFilesAdded:a.document,commerceTotalVideoFilesAdded:a.video,commerceTotalOtherFilesAdded:a.other,commerceWebEntryPointLocation:t,experimentVariant:n}})})({files:t,referrer:a,experimentVariant:i}),r?(o=t,n.__awaiter(void 0,void 0,void 0,(function*(){const{showSellACopyModal:t}=yield new Promise((function(t,n){e(["./c_commerce_components_sell_a_copy_modal"],t,n)}));return t(o)}))):un(t,a)},this.shouldShowReplayOpenOption=e=>{const t=a.file_extension(a.filename(e.fq_path)),n=a.ExtensionCategories[t];return"VIDEO"===n||"AUDIO"===n||"IMAGE"===n},this.getReplayOpenOption=e=>({handler:()=>{const t=`https://replay.dropbox.com/project/creating/${e}?creationSource=dropbox_share_action`;window.open(t),this.logSelectActionOverflowMenu(a.UserAction.OpenInReplay,x.OpenButtonAction.OPEN_IN_REPLAY)},spriteName:null,text:h.intl.formatMessage({id:"lOEIzZ",defaultMessage:"Get feedback"}),type:x.OpenButtonAction.OPEN_IN_REPLAY,userAction:a.UserAction.OpenInReplay,iconElement:r.React$1.createElement(a.UIIcon,{src:l.DropboxReplayLine})}),this.getPublishOption=(e,t,n)=>({handler:()=>{const r=a.file_extension(a.filename(t.fq_path)),i=a.ExtensionCategories[r];!i||"IMAGE"!==i&&"VIDEO"!==i||a.logEvent(j.PAP_Select_PublishEntrypoint({publishItemType:"IMAGE"===i?"image":"video",publishEntrypointLocation:void 0===n?"previews_share_dropdown":"browse_share_dropdown"})),U.showPublishModal(e,t)},spriteName:null,text:h.intl.formatMessage({id:"u+gDFt",defaultMessage:"Publish to social"}),type:x.OpenButtonAction.PUBLISH_TO_SOCIAL,userAction:a.UserAction.PublishToSocial,iconElement:r.React$1.createElement(a.UIIcon,{src:d.RocketLine})}),this.getShareWithEmailOpenOption=()=>{const{onShowShare:e}=this.props;return{handler:()=>{e(),this.logSelectActionOverflowMenu(a.UserAction.InviteViaEmail,x.OpenButtonAction.INVITE_VIA_EMAIL)},spriteName:null,text:h.intl.formatMessage({id:"8U/qbn",defaultMessage:"Share with Dropbox"}),type:x.OpenButtonAction.INVITE_VIA_EMAIL,userAction:a.UserAction.InviteViaEmail,iconElement:r.React$1.createElement(a.UIIcon,{className:"test-id-share-dig-icon",src:p.ShareArrowLine})}},this.getShareWithCollectionOptions=e=>({handler:()=>{e(),this.logSelectActionOverflowMenu(a.UserAction.ShareWithCollection,x.OpenButtonAction.SHARE_WITH_COLLECTION)},spriteName:null,text:h.intl.formatMessage({id:"wBdEdI",defaultMessage:"Send as a collection"}),type:x.OpenButtonAction.SHARE_WITH_COLLECTION,userAction:a.UserAction.ShareWithCollection,iconElement:r.React$1.createElement(a.UIIcon,{src:s.CollectionLine})}),this.getTransferOpenOptions=e=>({handler:()=>{e(),this.logSelectActionOverflowMenu(a.UserAction.Transfer,x.OpenButtonAction.TRANSFER)},spriteName:null,text:h.intl.formatMessage({id:"3MahuB",defaultMessage:"Send a copy"}),type:x.OpenButtonAction.TRANSFER,userAction:a.UserAction.Transfer,iconElement:r.React$1.createElement(a.UIIcon,{src:c.DropboxTransferLine})}),this.getShopOpenOptions=e=>({handler:e,spriteName:null,text:h.intl.formatMessage({id:"7UOMXW",defaultMessage:"Sell a copy"}),type:x.OpenButtonAction.SELL_WITH_SHOP,userAction:a.UserAction.SellWithShop,iconElement:r.React$1.createElement(a.UIIcon,{src:m.TagLine})}),this.getPopoverTriggerRenderer=(e,t,n)=>i=>{const{isVisible:o,variant:s}=this.props,l=Object.assign({className:a.classnames("extensions-split-share-menu__trigger",{"extensions-split-share-menu__trigger--collapsed":e}),tabIndex:o?void 0:-1,onMouseEnter:this.handlePopoverHover,"aria-label":h.intl.formatMessage({id:"5MpLpV",defaultMessage:"Expand share menu"}),"data-testid":"share-menu-dropdown"},i);return e?r.React$1.createElement(_.Tooltip,{positionOffset:8,positioning:"left",tooltipContent:h.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"})},r.React$1.createElement(a.IconButton,Object.assign({variant:"primary"===s?"filled":s},l),r.React$1.createElement(a.UIIcon,{src:p.ShareArrowLine,"aria-label":n}))):t?r.React$1.createElement(a.Button,Object.assign({},l,{withIconLeft:r.React$1.createElement(a.UIIcon,{src:p.ShareArrowLine,className:"extensions-split-share--icon"}),variant:s,withDropdownIcon:!0}),h.intl.formatMessage({id:"DHK0zq",defaultMessage:"Share all selected"})):r.React$1.createElement(a.Button,Object.assign({},l,{variant:s,withDropdownIcon:!0,_hasSquaredSize:!0}))},this.renderPopoverItems=()=>{const{user:e,files:t,appActions:s,nonHellosignAppActions:l,featureFlags:{docsendAnalyticsAddOn:c,hellosignDeepIntegration:d,dndSplitShare:u,fileTransfersAppAction:p,replayDropboxShareActionExp:m,commerceDeprecationM2Enabled:_,commerceSellerFeaturesEnabled:g,commerceSellACopyExperiment:f,shareWithCollection:v,coreActDocsendAdvancedSharing:S,publishShareEntrypointEnabled:y},isSendForSignatureEnabled:A}=this.props,b=1===t.length,O=t[0],R=t.map((e=>e)),w=this.computeReferrer(R),M="DEEP_INTEGRATION"===d&&!I.is_supported_mobile_browser(),C=b&&a.isHellosignFileByExtension(x.getFileExt(Object.assign(Object.assign({},O),{bytes:0})));let T=null,k=s;if(M&&C&&A){k=l;const t=this.getHellosignOpenOption(O,e);T=r.React$1.createElement(yn,{openOption:t})}const $=a.file_extension(a.filename(O.fq_path)),F=E.getDocsendAnalyticsAddOnConfig(e,c),N=b&&F.isSupportedFile(O.bytes,$),L=this.userEligibilityOnDocSendAdvanceCampaign(),B=L||"CONTROL"===S&&!I.is_supported_mobile_browser();let U=null;if("ON"===u&&!F.splitShare.removeDocsendAppAction){const n=k.find((e=>e.app_id===a.DOCSEND_PROD_APP_ID));if(n){k=k.filter((e=>e.app_id!==a.DOCSEND_PROD_APP_ID));const o=this.getDocSendOpenOption(t,e,n,{text:F.splitShare.moveDocsendEntryPoint?h.intl.formatMessage({id:"oziSoO",defaultMessage:"Send with DocSend"}):h.intl.formatMessage({id:"r4C3UE",defaultMessage:"Send and track"})},L,B,S);let s;F.splitShare.logExposure&&N&&(s={experimentName:"docsend_analytics_add_on",variant:F.variantForLogging});const l=r.static_url("/static/metaserver/static/js/extensions/assets/DocsendTootltipImage-vflti6T_M.png"),c=h.intl.formatMessage({id:"WX5xac",defaultMessage:"Secure sharing and analytics to help win new clients"});let d=null;const u=r.React$1.createRef();let p=null;L&&(p=r.React$1.createElement(a.AccessoryBadge,{"data-testid":"core_act_docsend_advanced_sharing_badge",className:hn},r.React$1.createElement(a.UIIcon,{className:_n,src:i.LightbulbPictogram})),d=r.React$1.createElement(a.Tooltip.Control,{variant:"rich",open:this.state.showDocsendAdvanceCampaignTooltip,triggerRef:u,auto:!0,placement:"left","data-testid":"core_act_docsend_advanced_sharing_tooltip"},r.React$1.createElement("div",{style:{width:"157px"}},r.React$1.createElement("img",{src:l,className:mn,alt:""}),c))),U=r.React$1.createElement("div",{ref:u,onMouseEnter:()=>this.setState({showDocsendAdvanceCampaignTooltip:!0}),onMouseLeave:()=>this.setState({showDocsendAdvanceCampaignTooltip:!1})},d,r.React$1.createElement(yn,{"data-testid":n.app_id,key:o.text,openOption:o,experimentInfo:s,actionSurface:this.props.actionSurface,fileExt:$,rightAccessory:p,onImpression:()=>{L&&this.onImpressionDocSendAdvanceCampaign()}}))}}F.splitShare.removeDocsendAppAction&&(k=k.filter((e=>e.app_id!==a.DOCSEND_PROD_APP_ID)));let j=null;if(F.splitShare.showMenuItem&&N){const t={handler:()=>{this.handleShareWithAnalytics(O,e,F.variantForLogging,F,$)},spriteName:null,text:h.intl.formatMessage({id:"yP4n16",defaultMessage:"Send and track"}),type:x.OpenButtonAction.SHARE_WITH_ANALYTICS,userAction:a.UserAction.ShareWithAnalytics,iconElement:r.React$1.createElement(a.UIIcon,{src:o.AnalyticsLine})};j=r.React$1.createElement(a.Tooltip,{title:h.intl.formatMessage({id:"iZTVjV",defaultMessage:"Get viewer insights for the files you share using Dropbox"}),placement:"left"},r.React$1.createElement(yn,{"data-testid":"analytics-add-on-menu-item",key:t.text,openOption:t,experimentInfo:{experimentName:"docsend_analytics_add_on",variant:F.variantForLogging},actionSurface:this.props.actionSurface,rightAccessory:r.React$1.createElement(a.AccessoryBadge,null,h.intl.formatMessage({id:"QT7EnD",defaultMessage:"Beta"})),fileExt:$}))}const G=k.find((e=>e.app_id===x.TRANSFER_FP_APP_ID)),q=D.shouldShowTransferInSplitShare(!!G||"ON"===p,R),z="V1"===v&&((Y=R).length>1&&Y.length<V.MAX_ITEMS_IN_COLLECTION&&!Y.some((e=>e.is_dir)));var Y;const X=()=>{(e=>{n.__awaiter(void 0,void 0,void 0,(function*(){try{a.Snackbar.sync(h.intl.formatMessage({id:"cPT7lZ",defaultMessage:"Creating your collection…"}),!0,"share-with-collection"),V.logEntryPointNewCollection("share_with_collection",e.length);const{id:t,sharingInfo:n}=yield V.createCollection(`${e.length} files`,{shared_link_info:{link_type:{".tag":"view"},link_settings:{allow_download:!0,audience:{".tag":"public"}}}});yield V.addFilesToCollection(t,V.mapFileIdsToFileIdentifiers(e.map((e=>e.file_id))));let r=h.intl.formatMessage({id:"thkRGH",defaultMessage:"The link to the collection was copied to your clipboard."});const i=`${V.COLLECTIONS_PAGE_BASENAME}/${t}?share=1`;a.browserRedirectWrapper(i);try{yield navigator.clipboard.writeText(n.viewLink.url)}catch(e){r=h.intl.formatMessage({id:"lyObby",defaultMessage:"The link to the collection has been created. You can share the collection by copying it."})}a.Snackbar.complete(r,"share-with-collection")}catch(e){return void a.Snackbar.fail(h.intl.formatMessage({id:"F/SGkz",defaultMessage:"Couldn’t create the collection, but you can try again later."}),"share-with-collection")}}))})(R)},K=()=>this.handleAddToTransfer(R,w,e),Z=((e,t)=>{const n=t.every((e=>{const t=a.file_extension(a.filename(e.fq_path)),n=a.ExtensionCategories[t];return"VIDEO"===n||"AUDIO"===n||"IMAGE"===n||"pdf"===t}));return e&&t.length>0&&n&&!I.is_mobile_or_tablet()})("ON"===g&&"ON"!==_,R),Q="ON"===f,J="ON"===y&&(()=>{if("fq_path"in O){const e=a.ExtensionCategories[$];return"VIDEO"===e||"IMAGE"===e}return!1})()&&b,{installedActions:ee,unpromotedActions:te}=x.partitionActions(k),ne=Boolean(b),ae=ne||Boolean(q)||Boolean(U)||Boolean(T)||Boolean(Z)||Boolean(z)||Boolean(J),re=F.splitShare.moveDocsendEntryPoint,ie=(!W.isEmpty(te)||!W.isEmpty(ee)||!ae||re&&U)&&r.React$1.createElement(a.Menu.Segment,null,re?U:null,ee.map((n=>{const a=this.getAppActionOpenOption(t,e,n);return r.React$1.createElement(yn,{"data-testId":n.app_id,key:a.text,openOption:a})})),!W.isEmpty(te)&&b?r.React$1.createElement(yn,{openOption:W.isEmpty(ee)?this.getAddAppsOpenOption(O,e):this.getMoreAppsOpenOption(O,e)}):!ae&&W.isEmpty(ee)&&r.React$1.createElement(yn,{openOption:this.getAppCenterLinkOpenOption()}));return r.React$1.createElement(r.react.exports.Fragment,null,ae&&r.React$1.createElement(a.Menu.Segment,null,ne&&r.React$1.createElement(yn,{campaignAnchorName:P.CampaignsElementIdEnum.BROWSE_VIEW_RIGHT_PANEL_SHARE_WITH_DROPBOX_BUTTON,openOption:this.getShareWithEmailOpenOption()}),J&&r.React$1.createElement(yn,{openOption:this.getPublishOption(this.props.user,O,this.props.retrievalSource),campaignAnchorName:P.CampaignsElementIdEnum.PUBLISH_SHARE_DROPDOWN_ENTRYPOINT,rightAccessory:r.React$1.createElement(a.AccessoryBadge,null,h.intl.formatMessage({id:"LlL5Qr",defaultMessage:"New"})),onImpression:()=>{const e=a.ExtensionCategories[$];!e||"IMAGE"!==e&&"VIDEO"!==e||a.logEvent(H.PAP_Shown_PublishEntrypoint({publishItemType:"IMAGE"===e?"image":"video",publishEntrypointLocation:void 0===this.props.retrievalSource?"previews_share_dropdown":"browse_share_dropdown"}))}}),j,"ON"===m&&b&&this.shouldShowReplayOpenOption(O)&&r.React$1.createElement(yn,{openOption:this.getReplayOpenOption(O.file_id),rightAccessory:r.React$1.createElement(a.AccessoryBadge,null,h.intl.formatMessage({id:"LlL5Qr",defaultMessage:"New"}))}),q&&K&&r.React$1.createElement(yn,{campaignAnchorName:P.CampaignsElementIdEnum.BROWSE_VIEW_RIGHT_PANEL_SEND_A_COPY_BUTTON,dataTooltipId:"split-share-menu-transfer-menu-item",openOption:this.getTransferOpenOptions(K)}),T,re?null:U,Z&&r.React$1.createElement(yn,{openOption:this.getShopOpenOptions((()=>{this.handleSellWithShop(R,w,Q,f),this.logSelectActionOverflowMenu(a.UserAction.SellWithShop,x.OpenButtonAction.SELL_WITH_SHOP)})),onImpression:()=>(({files:e,referrer:t,experimentVariant:n="OFF"})=>{const a=pn(e);on({class:"commerce_web_entry_points",action:"shown",object:"split_share_menu_item",properties:{isDropboxer:sn(),commerceTotalAudioFilesAdded:a.audio,commerceTotalImageFilesAdded:a.image,commerceTotalSsrDocFilesAdded:a.document,commerceTotalVideoFilesAdded:a.video,commerceTotalOtherFilesAdded:a.other,commerceWebEntryPointLocation:t,experimentVariant:n}})})({files:R,referrer:w,experimentVariant:f})}),z&&r.React$1.createElement(yn,{openOption:(()=>this.getShareWithCollectionOptions(X))()})),ie)},this.markSplitShareTooltipViewed=()=>{a.markTooltipViewed(this.props.user.id,"split_share_edu")},this.state={tooltipState:Zt.NO_TOOLTIP,showDocsendAdvanceCampaignTooltip:!1},this.telemetryClient=R.createTelemetryClient(Object.assign({component:"split-share-btn"},t.context)),this.onboardingChecklistShareButtonTooltipTriggerRef=r.React$1.createRef()}componentDidMount(){this.props.showEduTooltip&&this.setEduTooltip(),this.preloadCampaignMenuItemAssets(),this.preloadDocSendHubWelcomeModal()}preloadDocSendHubWelcomeModal(){E.getDocsendAnalyticsAddOnConfig(this.props.user,this.props.featureFlags.docsendAnalyticsAddOn).useDocSendHub&&q(this.props.user.id)}userEligibilityOnDocSendAdvanceCampaign(){const{docsendAdvancedSharingHasOpenedSharingSettings:e,docsendAdvancedSharingHasConfirmedSplitShareMenu:t,docsendAdvancedSharingHasShared:n,docsendAdvancedSharingHasSeenShareModal:a,featureFlags:{coreActDocsendAdvancedSharing:r}}=this.props;return"V1"===r&&(e&&n&&!t&&!a&&!I.is_supported_mobile_browser())}onImpressionDocSendAdvanceCampaign(){const{featureFlags:{coreActDocsendAdvancedSharing:e}}=this.props;"V1"===e&&a.logEvent({class:"onboard",action:"shown",object:"core_act_docsend_advanced_sharing_split_share_menu",properties:{experimentVariant:e}})}setEduTooltip(){return n.__awaiter(this,void 0,void 0,(function*(){const e=yield a.getTooltipHistory(this.props.user.id,["open_with_edu","split_share_edu"]),t=this.props.files[0];"split_share_edu"===a.allowedTooltips(this.props.appActions.length>0,t.fq_path?"."+a.file_extension(a.filename(t.fq_path)):"",this.props.featureFlags).find((t=>void 0!==e[t]&&!e[t]))&&this.setState({tooltipState:Zt.BIG_ONBOARDING_TOOLTIP})}))}render(){const{files:e,context:t,isVisible:n,shareButtonLabel:i,triggerType:o,isCollapsed:s,shouldUsePortalPopover:l,appActions:c,featureFlags:d,showLeftDigIcon:u,variant:m,renderMenuOnly:_,expActionBarRedesignEnabled:h}=this.props,g=1===e.length,f=e[0];t?this.currentSession=this.telemetryClient.session({ext:R.getPiiSafeExtension(f?"."+a.file_extension(a.filename(f.fq_path)):"")}):delete this.currentSession;const v={"aria-label":i,className:a.classnames("extensions-split-share__share-button",{"primary-action-menu__button":o===a.TriggerType.SidebarPrimaryButton}),onClick:this.handleClickShare,tabIndex:n?void 0:-1,onMouseEnter:this.handleShareHover},E=r.React$1.createElement(a.Button,Object.assign({},v,{withIconLeft:u&&r.React$1.createElement(a.UIIcon,{src:p.ShareArrowLine,className:"extensions-split-share--icon"}),variant:m,"data-testid":"share-button"}),r.React$1.createElement(a.UserEducationEffect,{containerName:"SplitShareButton",name:"ShareButtonLabel",useSpan:!0},i)),S=this.getPopoverTriggerRenderer(s,!g,i),y=g&&"DEEP_INTEGRATION"===d.hellosignDeepIntegration&&a.isHellosignFileByExtension(x.getFileExt(Object.assign(Object.assign({},f),{bytes:0})))&&!I.is_supported_mobile_browser();return _?this.renderPopoverItems():r.React$1.createElement("div",{className:a.classnames(gn,"extensions-split-share-btn",{[fn]:!n,"hellosign-available":y,[vn]:!W.isEmpty(c)}),ref:this.onboardingChecklistShareButtonTooltipTriggerRef},!s&&g&&E,r.React$1.createElement(F.AsyncOnboardingChecklistShareButtonTooltip,{triggerRef:this.onboardingChecklistShareButtonTooltipTriggerRef}),r.React$1.createElement(a.Menu.Wrapper,{className:a.classnames("extensions-split-share__popover",{"hellosign-available-dropdown":y,[En]:!l,"down-arrow-share-button-prompt-select":!0}),onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,onSelection:this.handleSelectAction,onToggle:this.handlePopoverToggle,closeOnSelection:!0,isPortaled:l,"data-campaigns-element-id":P.CampaignsElementIdEnum.BROWSE_VIEW_RIGHT_PANEL_SHARE_DROPDOWN_BUTTON,"data-tooltip":"split-share-menu"},(({getContentProps:e,getTriggerProps:t})=>r.React$1.createElement(r.React$1.Fragment,null,S(t()),r.React$1.createElement(a.Menu.Content,Object.assign({placement:"bottom-end",className:h?"rc-action-bar-submenu-content":""},e()),this.renderPopoverItems())))))}}An.defaultProps={isVisible:!0,shareButtonLabel:h.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"}),triggerType:a.TriggerType.PrimaryButton,variant:"opacity"},An.displayName="SplitShareButtonComponent";const bn={refreshSharingServiceInfo:a.refreshSharingServiceInfoAdapter,updateLinkState:a.updateLinkState},On=a.connect(((e,t)=>{const n=t.files.map((e=>Object.assign(Object.assign({},e),{bytes:0})));return{appActions:x.getShareActionsForFiles(e,n),nonHellosignAppActions:x.getNonHellosignActionsForFiles(e,n,a.HELLOSIGN_PROD_APP_ID),categoryInfo:x.getCategoryInfos(e),featureFlags:x.getFeatureFlags(e),sharingServiceInfo:x.getSharingServiceInfoAdapter(e),landingPageEnabled:O.isConnectServiceLandingPagesEnabled(e),isSendForSignatureEnabled:O.isSendForSignatureEnabled(e),docsendAdvancedSharingHasOpenedSharingSettings:x.getDocsendAdvancedSharingHasOpenedSharingSettings(e),docsendAdvancedSharingHasShared:x.getDocsendAdvancedSharingHasShared(e),docsendAdvancedSharingHasSeenShareModal:x.getDocsendAdvancedSharingHasSeenShareModal(e),docsendAdvancedSharingHasConfirmedSplitShareMenu:x.getDocsendAdvancedSharingHasConfirmedSplitShareMenu(e)}}),bn)(An),Rn=On,xn=a.requireCssWithComponent(On,["/static/metaserver/static/css/app_actions/index-vflXUc6ye.css"]);var wn=Object.freeze({__proto__:null,SplitShareButtonComponent:An,__dontUse:Rn,SplitShareButton:xn});t.COMMERCE_CREATE_LISTING="COMMERCE_CREATE_LISTING_PAGE",t.ORDERS_SURFACE="COMMERCE_ORDERS",t.PRODUCTS_PAGE_FULL_PATH="/shop/products",t.SELLER_DASHBOARD_SURFACE="SELLER_DASHBOARD",t.SELL_A_COPY_SURFACE="COMMERCE_SELL_A_COPY",t.chunkArray=function(e,t){t<1&&(t=e.length);const n=[];for(let a=0;a<e.length;a+=t)n.push(e.slice(a,a+t));return n},t.getFileAccessCountsForLogging=e=>{const t={unknown_file_access:0,downloadable_file_access:0,view_only_file_access:0,other:0,total:0};return null==e||e.forEach((e=>{const n=(e=>{var t;return(null===(t=e.access_type)||void 0===t?void 0:t[".tag"])||"other"})(e);n in t&&t[n]++,t.total++})),t},t.getFileTypesForLogging=e=>{const t={audio:0,cloud_doc:0,excel:0,html:0,image:0,linkfile:0,other:0,restricted:0,ssr_doc:0,video:0};return null==e||e.forEach((e=>{(null==e?void 0:e.type)&&(null==e?void 0:e.type)in t?t[null==e?void 0:e.type]++:t.other++})),t},t.getUserOSName=function(e){e||(e=navigator.userAgent);let t="Unknown";return-1!==e.indexOf("Win")&&(t="Windows"),-1!==e.indexOf("Mac")&&(t="Mac"),-1!==e.indexOf("Linux")&&(t="Linux"),-1!==e.indexOf("Android")&&(t="Android"),-1!==e.indexOf("like Mac")&&(t="iOS"),t},t.isDropboxer=sn,t.logEvent=rn,t.logEvent$1=on,t.logManageProducts=()=>{on({class:"commerce_web_entry_points",action:"click",object:"manage_your_products",properties:{isDropboxer:sn()}})},t.logViewProductPage=()=>{on({class:"commerce_web_entry_points",action:"click",object:"view_product_page",properties:{isDropboxer:sn()}})},t.split_share_button_component_esnext=wn,t.toEventExtraValues=ln}));
//# sourceMappingURL=c_extensions_split_share_button_component.js-vflis3udF.map
