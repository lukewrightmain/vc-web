define(["require","exports","./e_edison","./e_ui_page_files_router","./e_core_exception","./c_core_browser_detection","./c_core_i18n","./c_tslib","./c_file_uploader_types","./c_growth_ui_send_app_link_form","./c_src_sink_index","./c_apex-metrics_src_types","./c_lodash-es_lodash","./c_core_custom_protocol","./c_core_uri","./c_ui-icon_line_lock","./c_ui-icon_line_passwords","./c_ui-icon_line_shield","./c_ui_trials_types","./c_ui-icon_line_expand-left","./c_core_exception_info","metaserver/static/js/modules/constants/files_spa","./c_core_notify","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_api_v2_noauth_client","metaserver/static/js/modules/constants/request","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","metaserver/static/js/modules/constants/page_load","./c_csrf","./c_core_xhr","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/constants/contacts","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/modules/core/langpack","./c_form_row_index"],(function(e,t,a,o,s,i,n,l,r,c,d,m,u,_,p,g,b,y,S,E,C,h,R,k,M,f,A,O,I,N,v,T,$,B,w,x,L,D,j,U,P,F,H,V,G,W,q){"use strict";var K;!function(e){e.DISMISS_BTN="dismiss_btn"}(K||(K={}));class z extends o.GrowthUserActionTracker{constructor(){super(...arguments),this.project="continuous_onboarding"}}const Y=(e,t)=>{const a=Object.keys(e.module_map).reduce(((t,a)=>{const o=e.module_map[a];return!o.is_seen&&o.should_show&&t.push(o.seen_string),t}),[]);a.length&&o.markModulesAsCompleted(t,a)},Z=e=>{for(let t=0;t<e.module_ids.length;t++){const a=e.module_map[e.module_ids[t]];if(a.should_show)return a.module_id}return null};var Q;!function(e){e.OPEN_SIDEBAR="open-sidebar",e.CLOSE_SIDEBAR="close-sidebar",e.HIDE_SIDEBAR="hide-sidebar",e.SET_ACTIVE_MODULE="set-active-module",e.FORCE_CLOSE="force-close",e.REOPEN_IF_CLOSED_BY_ACTIVE_BACKGROUND="reopen-if-closed-by-active-background",e.SET_SIDEBAR="set-sidebar",e.BOLT_SIDEBAR_UPDATE="bolt-sidebar-update",e.NEW_MODULE_UPDATE="new-module-update",e.HIDE_MODULE="hide-module",e.SET_MILESTONE_COMPLETE="set-milestone-complete"}(Q||(Q={}));const X={isOpen:!1,isClosedDueToActiveBackground:!1,activeModuleId:null,showOpenButtonWhenCollapsed:!0,showCompletedState:!1},J=(e,t)=>{switch(t.type){case Q.OPEN_SIDEBAR:return Object.assign(Object.assign({},e),{isOpen:!0,isClosedDueToActiveBackground:!1,showOpenButtonWhenCollapsed:!0});case Q.CLOSE_SIDEBAR:return Object.assign(Object.assign({},e),{isOpen:!1,isClosedDueToActiveBackground:!1,showOpenButtonWhenCollapsed:!0});case Q.HIDE_SIDEBAR:return Object.assign(Object.assign({},e),{isOpen:!1,showOpenButtonWhenCollapsed:!1});case Q.SET_ACTIVE_MODULE:return Object.assign(Object.assign({},e),{activeModuleId:t.activeModuleId});case Q.FORCE_CLOSE:return Object.assign(Object.assign({},e),{isOpen:!1,isClosedDueToActiveBackground:e.isOpen,showOpenButtonWhenCollapsed:!0});case Q.REOPEN_IF_CLOSED_BY_ACTIVE_BACKGROUND:return Object.assign(Object.assign({},e),{isOpen:e.isClosedDueToActiveBackground||e.isOpen,isClosedDueToActiveBackground:!1});case Q.SET_SIDEBAR:{const{progression:a,display_surface_props:o,bolt_channel_states:s}=t,i=Z(a);return null===i?Object.assign({},e):Object.assign(Object.assign({},e),{progression:a,display_surface_props:o,bolt_channel_states:s,showOpenButtonWhenCollapsed:!o.open_on_load,activeModuleId:i})}case Q.BOLT_SIDEBAR_UPDATE:{const{progression:a,bolt_channel_states:o,display_surface_props:s}=t;if(e.progression){const t=e.progression.progression_id!==a.progression_id?a:Object.assign(Object.assign({},e.progression),{milestone_map:Object.assign(Object.assign({},e.progression.milestone_map),a.milestone_map),implementation_data:Object.assign(Object.assign({},e.progression.implementation_data),a.implementation_data)}),i=e.activeModuleId&&t.module_map[e.activeModuleId]&&t.module_map[e.activeModuleId].should_show?e.activeModuleId:Z(t);return Object.assign(Object.assign({},e),{progression:t,activeModuleId:i,display_surface_props:s,bolt_channel_states:o,showCompletedState:!a.module_ids.length})}return Object.assign({},e)}case Q.NEW_MODULE_UPDATE:{const{progression:a}=t;if(e.progression){const t=[],o={};a.module_ids.forEach((s=>{-1===e.progression.module_ids.indexOf(s)&&(t.push(s),o[s]=a.module_map[s])}));const s=Object.assign(Object.assign({},e.progression),{module_ids:[...e.progression.module_ids,...t],module_map:Object.assign(Object.assign({},e.progression.module_map),o)}),i=e.activeModuleId&&s.module_map[e.activeModuleId].should_show?e.activeModuleId:Z(s);return Object.assign(Object.assign({},e),{progression:s,activeModuleId:i})}return Object.assign({},e)}case Q.HIDE_MODULE:if(e.progression){const a=Object.assign({},e.progression);return a.module_map[t.module_id]=Object.assign(Object.assign({},a.module_map[t.module_id]),{should_show:!1}),Object.assign(Object.assign({},e),{progression:a,activeModuleId:Z(a)})}return Object.assign({},e);case Q.SET_MILESTONE_COMPLETE:if(e.progression){const a=Object.assign({},e.progression);return a.milestone_map[t.milestoneKey]=Object.assign(Object.assign({},a.milestone_map[t.milestoneKey]),{is_completed:!0}),Object.assign(Object.assign({},e),{progression:a})}return Object.assign({},e);default:throw new Error("No such action")}},ee={surface:{".tag":"web_sidebar"}},te=(e,t)=>{let a=0;const s=()=>(ee.surface_path=o.get_pathname(),(new o.UserApiV2Client).ns("growth").rpc("get_continuous_onboarding",ee,{subjectUserId:e}).then(t).catch((()=>{a<2&&(a++,setTimeout(s,3e3))})));s()},ae=(e,t,a,s)=>{let i;const n=Object.keys(s).map((e=>{const{unique_id:t,revision:a,token:i}=s[e];return new o.SignedChannelState(e,t,a,i)}));if(n.length){const s=o=>{const s=o[0].app_id;e.logBoltNotification(s),te(a,(({progression:e,bolt_channel_states:o,display_surface_props:s})=>{if(e){const i=s;Y(e,a),t({type:Q.BOLT_SIDEBAR_UPDATE,progression:e,bolt_channel_states:o,display_surface_props:i}),setTimeout((()=>{t({type:Q.NEW_MODULE_UPDATE,progression:e})}),600)}}))},l=()=>{i.unsubscribe(),te(a,(({bolt_channel_states:o})=>{ae(e,t,a,o)}))};return i=new o.BoltClient(n,s,l),i.start(),i}},oe=(e,t,o)=>{const[s,i]=a.React$1.useState(!1);a.React$1.useEffect((()=>{o&&!s&&(e[t](),i(!0))}),[o,e,t,s])};const se=({handleHideSidebar:e,emptyStateProps:t,isSidebarComplete:s,logger:i})=>{oe(i,"logSidebarEmptyStateViewed",s);const{dismiss_button_text:n,description:l,image_url:r,image_url_hi_res:c,image_alt:d}=t,m=o.classnames({"continuous-onboarding__complete-view":!0,"continuous-onboarding__complete-view--isVisible":s});return a.React$1.createElement("div",{className:m,"aria-hidden":!s},a.React$1.createElement("div",{className:"continuous-onboarding__complete-view__content"},r&&a.React$1.createElement(o.Image,{className:"continuous-onboarding__complete-view__image",alt:d,src:r,srcHiRes:c}),a.React$1.createElement(o.Text,{className:"continuous-onboarding__complete-view__text",isBold:!0},l)),a.React$1.createElement("div",null,a.React$1.createElement(o.Button,{className:"continuous-onboarding__complete-view__dismiss-btn",variant:"primary",onClick:()=>{i.logSidebarEmptyStateDismissed(),e()}},n)))};se.displayName="CompletedView",se.displayName="CompletedView";const ie=({children:e,className:t,cardBodyAccessibilityProps:s})=>{const i=o.classnames({"module-card__body":!0,[t||""]:!!t});return a.React$1.createElement("div",Object.assign({className:i},s),e)};ie.displayName="ModuleCardBodyContainer",ie.displayName="ModuleCardBodyContainer";const ne=({src:e,srcHiRes:t,alt:s})=>a.React$1.createElement(o.Image,{className:"module-card__image",alt:s,src:e,srcHiRes:t});ne.displayName="ModuleCardImage",ne.displayName="ModuleCardImage";const le=({description:e})=>a.React$1.createElement(o.Text,{className:"module-card__description",tagName:"p",color:"faint"},e);le.displayName="ModuleCardDescription",le.displayName="ModuleCardDescription";const re={primary:"primary",secondary:"opacity",outline:"outline",other:"primary"},ce=({primaryCtaStyle:e,onCtaClick:t,ctaText:s,onSkipClick:i,primaryButton:l,disabled:r})=>{const c=e?re[e[".tag"]]:"primary",d=a.React$1.createElement(o.Button,{variant:c,onClick:t,disabled:r,className:"module-card__button-group__primary-cta"},s);return a.React$1.createElement("div",{className:"module-card__button-group"},l||d,i&&a.React$1.createElement(o.Button,{variant:"transparent",onClick:i,disabled:r,className:"module-card__button-group__skip-cta"},n.intl.formatMessage({id:"2iucH+",defaultMessage:"Skip"})))};ce.displayName="ModuleCardButtonGroup",ce.displayName="ModuleCardButtonGroup";const de=e=>{const{description:t,imageUrl:o,imageUrlHiRes:s,imageAlt:i,onCtaClick:n,onSkipClick:l,ctaText:r,primaryCtaStyle:c,cardBodyAccessibilityProps:d,className:m,buttonsDisabled:u}=e;return a.React$1.createElement(ie,{cardBodyAccessibilityProps:d,className:m},o&&a.React$1.createElement(ne,{alt:i,src:o,srcHiRes:s}),t&&a.React$1.createElement(le,{description:t}),n&&a.React$1.createElement(ce,{primaryCtaStyle:c,onCtaClick:n,ctaText:r,onSkipClick:l,disabled:u}))};de.displayName="ModuleCardBody",de.displayName="ModuleCardBody";const me=e=>{const{module:t,logger:o,isOpen:s}=e,{module_id:i,success_description:n,success_image_url:l,success_image_url_hi_res:r,success_image_alt:c}=t;return a.React$1.useEffect((()=>{s&&o.logModuleCompletedView(i)}),[o,i,s]),a.React$1.createElement(de,{className:"module-card__completed-card-body",description:n,imageUrl:l,imageUrlHiRes:r,imageAlt:c,cardBodyAccessibilityProps:{"aria-hidden":!1,id:`content-${i}-complete`}})};me.displayName="CompletedCardBody",me.displayName="CompletedCardBody";const ue=e=>{const{module:{module_id:t,module_index:s},milestone:{milestone_id:i,milestone_type_props:n},logger:l,markAsComplete:r,onSkipClick:c,cardBodyAccessibilityProps:d}=e,{does_cta_complete_milestone:m,description:u,image_url:_,image_url_hi_res:p,image_alt:g,cta_text:b,cta_href:y,button_style:S,open_in_new_tab:E}=n;return a.React$1.createElement(de,{description:u,imageUrl:_,imageUrlHiRes:p,imageAlt:g,onCtaClick:()=>{l.logMilestoneCtaClick(t,i,{module_index:s}),m&&r({shouldOptimisticallyUpdate:!1}),E?o.open_tab(y):o.redirect(y)},onSkipClick:c,ctaText:b,primaryCtaStyle:S,cardBodyAccessibilityProps:d})};var _e;ue.displayName="LinkTypeCardBody",ue.displayName="LinkTypeCardBody",function(e){e.TEST_ACTION="other",e.SHARE_FOLDER="launch_file_share",e.UPLOAD_FILE="launch_file_uploader"}(_e||(_e={}));const pe={[_e.TEST_ACTION]:()=>l.__awaiter(void 0,void 0,void 0,(function*(){})),[_e.SHARE_FOLDER]:({userId:t})=>l.__awaiter(void 0,void 0,void 0,(function*(){const{asyncShowShareAFolderWizardModal:a}=yield new Promise((function(t,a){e(["./c_sharing_wizard_async_wizard_modals"],t,a)}));a(o.Viewer.get_viewer().get_user_by_id(t))})),[_e.UPLOAD_FILE]:({markAsComplete:t})=>l.__awaiter(void 0,void 0,void 0,(function*(){const{FileUploaderController:a}=yield new Promise((function(t,a){e(["./c_file_uploader_types"],t,a)})).then((function(e){return e.file_uploader_esnext}));a.handleUploadButtonClick({folderUpload:!1,onNextFileUploadComplete:()=>t(),actionElement:r.UploadElement.ACTION_BAR,actionScreen:"continuous_onboarding"})}))},ge=e=>{const{module:{module_id:t,module_index:o},milestone:{milestone_id:s,milestone_type_props:i},logger:n,markAsComplete:l,onSkipClick:r,cardBodyAccessibilityProps:c,userId:d}=e,{does_cta_complete_milestone:m,description:u,image_url:_,image_url_hi_res:p,image_alt:g,cta_text:b,button_style:y,action:S}=i;return a.React$1.createElement(de,{description:u,imageUrl:_,imageUrlHiRes:p,imageAlt:g,onCtaClick:()=>{n.logMilestoneCtaClick(t,s,{module_index:o}),m&&l();const e=pe[S[".tag"]];e&&e({userId:d,markAsComplete:l})},onSkipClick:r,ctaText:b,primaryCtaStyle:y,cardBodyAccessibilityProps:c})};var be,ye;ge.displayName="ActionTypeCardBody",ge.displayName="ActionTypeCardBody",function(e){e.SMS="sms",e.EMAIL="email"}(be||(be={})),function(e){e.SUCCESS="success",e.INVALID="invalid",e.FAIL="fail"}(ye||(ye={}));class Se{constructor(){}log(e,t={}){const a=this.project;a&&o.ProEventsLogger.log(`growth_continuous_onboarding_${e}`,Object.assign(Object.assign({},t),{project:a}),void 0,!1,a)}setProject(e){this.project=e}logSidebarViewed(){this.log("viewed")}logSidebarManuallyExpanded(){this.log("sidebar_manually_expanded")}logSidebarManuallyCollapsed(){this.log("sidebar_manually_collapsed")}logSidebarAutoExpanded(){this.log("sidebar_auto_expanded")}logSidebarAutoCollapsed(){this.log("sidebar_auto_collapsed")}logSidebarEmptyStateViewed(){this.log("completed_viewed")}logSidebarEmptyStateDismissed(){this.log("completed_dismissed")}logSidebarNonEmptyStateDismissed(){this.log("uncompleted_dismissed")}logMilestoneViewed(e,t,a){this.log("milestone_viewed",{module:e,milestone:t,module_index:a})}logModuleSkipped(e,t,a){this.log("module_skip_clicked",{module:e,milestone:t,module_index:a})}logMilestoneCtaClick(e,t,a={}){this.log("milestone_cta_clicked",Object.assign(Object.assign({},a),{module:e,milestone:t}))}logMobileLinkSubmitStatus(e,t,a,o){this.log(`mobile_link_send_${o}`,{module:e,milestone:t,message_type:a})}logMobileLinkSwitchForm(e,t,a){this.log("mobile_link_switch_form",{module:e,milestone:t,new_message_type:a})}logModuleCompletedView(e){this.log("module_complete_viewed",{module:e})}logModuleCompletedDismissed(e){this.log("module_complete_dismissed",{module:e})}logBoltNotification(e){this.log("bolt_notification_received",{channel_name:e})}logDeepLinkFailureNoApp(e,t){this.log("deep_link_failure_no_app",{module:e,milestone:t})}logDeepLinkFailureOther(e,t){this.log("deep_link_failure_other",{module:e,milestone:t})}logDeepLinkFailureCtaClick(e,t){this.log("deep_link_failure_cta_click",{module:e,milestone:t})}logModalView(e,t){this.log("modal_view",{module:e,milestone:t})}logModalCtaClick(e,t){this.log("modal_cta_click",{module:e,milestone:t})}logModalCancelClick(e,t){this.log("modal_cancel_click",{module:e,milestone:t})}logTrialStartSuccess(e,t){this.log("trial_start_success",{module:e,milestone:t})}logTrialStartError(e,t,a){this.log("trial_start_error",{module:e,milestone:t,reason:a})}logTimeToApiResponse(){const e=o.time_since_start();if(!e)return;const t=o.get_pathname();let a="other";0===t.indexOf("/home")||0===t.indexOf("/personal")?a="browse":"/h"===t&&(a="home");d.getMetricsReporter$1().createStats({ns:"continuous_onboarding",name:"time_to_api_response"},{progression:this.project||"",route:a}).recordDuration(e,m.TimeUnit.MILLISECONDS)}}const Ee=e=>{const{module:{module_id:t,module_index:o},milestone:{milestone_id:s,milestone_type_props:i},implementationData:l,onSkipClick:r,cardBodyAccessibilityProps:d,logger:m}=e,{description:u,email_success_description:_,sms_success_description:p,email_success_text:g,sms_success_text:b,email_input_field_placeholder:y,sms_input_field_placeholder:S,email_input_invalid_error_text:E,sms_input_invalid_error_text:C,send_email_cta_text:h,send_sms_cta_text:R,resend_email_cta_text:k,resend_sms_cta_text:M,send_button_style:f,resend_button_style:A,default_delivery_method:O}=i,I="sms"===O[".tag"],[N,v]=a.React$1.useState(!1),[T,$]=a.React$1.useState(I?c.SendAppLinkFormType.SMS:c.SendAppLinkFormType.EMAIL),[B,w]=a.React$1.useState(""),[x,L]=a.React$1.useState(""),D={onSkipClick:r,hasPrimaryCtaStyle:N?"primary"===A[".tag"]:"primary"===f[".tag"],send_email_cta_text:N?k:h,send_sms_cta_text:N?M:R},j=B||u;return a.React$1.createElement(ie,{className:"module-card__mobile-link",cardBodyAccessibilityProps:d},j&&a.React$1.createElement(le,{description:j}),a.React$1.createElement(c.SendAppLinkForm,{formTypes:I?[c.SendAppLinkFormType.SMS,c.SendAppLinkFormType.EMAIL]:[c.SendAppLinkFormType.EMAIL,c.SendAppLinkFormType.SMS],buttonPosition:c.SendAppLinkButtonPosition.BOTTOM,phoneInputData:l.phone_input_data,SubmitButton:Ce(D),onStatusChange:({sendStatus:e,currentFormType:a})=>{switch(e){case c.SendStatus.SUCCESS:v(!0),L(a===c.SendAppLinkFormType.SMS?b:g),w(a===c.SendAppLinkFormType.SMS?p:_),m.logMobileLinkSubmitStatus(t,s,a===c.SendAppLinkFormType.SMS?be.SMS:be.EMAIL,ye.SUCCESS);break;case c.SendStatus.INVALID:L(a===c.SendAppLinkFormType.SMS?C:E),m.logMobileLinkSubmitStatus(t,s,a===c.SendAppLinkFormType.SMS?be.SMS:be.EMAIL,ye.INVALID);break;case c.SendStatus.FAILURE:L(n.intl.formatMessage({id:"8NCBLs",defaultMessage:"There was an error sending your link"})),m.logMobileLinkSubmitStatus(t,s,a===c.SendAppLinkFormType.SMS?be.SMS:be.EMAIL,ye.FAIL);break;default:L("")}},onSwitchFormType:e=>{$(e),m.logMobileLinkSwitchForm(t,s,e===c.SendAppLinkFormType.SMS?be.SMS:be.EMAIL)},onSubmit:()=>{m.logMilestoneCtaClick(t,s,{message_type:T===c.SendAppLinkFormType.SMS?be.SMS:be.EMAIL,module_index:o})},inputHelperText:x,isFullWidth:!0,showDisclaimer:!0,formLayout:c.SendAppLinkFormLayout.SUBMIT_ON_BOTTOM,smsInputPlaceholder:S,emailInputPlaceholder:y}))};Ee.displayName="MobileLinkTypeCardBody",Ee.displayName="MobileLinkTypeCardBody";const Ce=u.memoize((({onSkipClick:e,hasPrimaryCtaStyle:t,send_sms_cta_text:s,send_email_cta_text:i})=>({sendStatus:l,currentFormType:r})=>{const d={default:s,[c.SendStatus.SENDING]:n.intl.formatMessage({id:"nCZAww",defaultMessage:"Sending..."}),[c.SendStatus.SUCCESS]:s,[c.SendStatus.INVALID]:s,[c.SendStatus.FAILURE]:s},m={default:i,[c.SendStatus.SENDING]:n.intl.formatMessage({id:"nCZAww",defaultMessage:"Sending..."}),[c.SendStatus.SUCCESS]:i,[c.SendStatus.INVALID]:i,[c.SendStatus.FAILURE]:i},u=r===c.SendAppLinkFormType.SMS?d:m,_=l?u[l]:u.default,p=l===c.SendStatus.SENDING,g=a.React$1.createElement(o.Button,{className:"module-card__button-group__primary-cta",variant:t?"primary":"opacity",disabled:p,type:"submit"},_);return a.React$1.createElement(ce,{onSkipClick:e,primaryButton:g,disabled:p})})),he=e=>{const{module:{module_id:t,module_index:s},milestone:{milestone_id:i,milestone_type_props:n},onSkipClick:l,markAsComplete:c,cardBodyAccessibilityProps:d,logger:m}=e,{image_url:u,image_url_hi_res:_,image_alt:p,description:g,cta_text:b,upload_files_button_copy:y,upload_folder_button_copy:S}=n,E=a.React$1.createElement(o.Menu.Wrapper,{onSelection:e=>{var a;a="folder"===e,r.FileUploaderController.handleUploadButtonClick({folderUpload:a,onNextFileUploadComplete:()=>c(),actionElement:r.UploadElement.ACTION_BAR,actionScreen:"continuous_onboarding"}),m.logMilestoneCtaClick(t,i,{upload_type:e,module_index:s})}},(({getTriggerProps:e,getContentProps:t})=>a.React$1.createElement(a.React$1.Fragment,null,a.React$1.createElement(o.Button,Object.assign({variant:"primary",className:"module-card__button-group__primary-cta",withDropdownIcon:!0},e()),b),a.React$1.createElement(o.Menu.Content,Object.assign({},t()),a.React$1.createElement(o.Menu.Segment,null,a.React$1.createElement(o.Menu.ActionItem,{value:"file"},y),a.React$1.createElement(o.Menu.ActionItem,{value:"folder"},S))))));return a.React$1.createElement(ie,{className:"module-card__upload-files",cardBodyAccessibilityProps:d},u&&a.React$1.createElement(ne,{alt:p,src:u,srcHiRes:_}),g&&a.React$1.createElement(le,{description:g}),a.React$1.createElement(ce,{primaryButton:E,onSkipClick:l}))};he.displayName="UploadContentTypeCardBody",he.displayName="UploadContentTypeCardBody";const Re=e=>{if("dropbox_client"===e[".tag"])return"dropbox-client";throw new Error(`Unknown deep link scheme: ${e[".tag"]}`)},ke=e=>{const{module:{module_id:t,module_index:s},milestone:{milestone_id:i,milestone_type_props:n},logger:l,markAsComplete:r,onSkipClick:c,cardBodyAccessibilityProps:d}=e,[m,u]=a.React$1.useState(!1),[g,b]=function(e=1e3){const[t,o]=a.React$1.useState(!1),[s,i]=a.React$1.useState();return a.React$1.useEffect((()=>()=>{s&&clearTimeout(s)}),[]),[t,()=>{o(!0),i(setTimeout((()=>o(!1)),e))}]}(1e3),[y,S]=a.React$1.useState(0),{scheme:E,path:C,does_cta_complete_milestone:h,description:R,image_url:k,image_url_hi_res:M,image_alt:f,cta_text:A,button_style:O,deep_link_failure_cta_href:I,deep_link_failure_cta_text:N,deep_link_failure_description:v,deep_link_failure_image_url:T,deep_link_failure_image_url_hi_res:$,deep_link_failure_image_alt:B,deep_link_failure_button_style:w}=n,x=m?{description:v,imageUrl:T,imageUrlHiRes:$,imageAlt:B,ctaText:N,primaryCtaStyle:w}:{description:R,imageUrl:k,imageUrlHiRes:M,imageAlt:f,ctaText:A,primaryCtaStyle:O};return a.React$1.createElement(de,Object.assign({},x,{onCtaClick:()=>{if(b(),m)l.logDeepLinkFailureCtaClick(t,i),o.redirect(I);else{l.logMilestoneCtaClick(t,i,{module_index:s}),_.launchUri(((e,t)=>new p.URI({scheme:Re(e),path:`//${t}`}).toString())(E,C)).then((()=>{h&&r()})).catch((()=>{l.logDeepLinkFailureNoApp(t,i),u(!0)}));const e=y+1;e>=2&&(l.logDeepLinkFailureOther(t,i),u(!0)),S(e)}},onSkipClick:c,buttonsDisabled:g,cardBodyAccessibilityProps:d}))};ke.displayName="ClientDeepLinkTypeCardBody",ke.displayName="ClientDeepLinkTypeCardBody";const Me=({children:e,open:t,onRequestClose:s,imageProps:{imageSrc:i,imageSrcHiRes:n,imageAlt:l}})=>a.React$1.createElement(o.Modal,{className:"continuous-onboarding-modal",open:t,width:"large",isCentered:!0,onRequestClose:s},a.React$1.createElement("div",{className:"continuous-onboarding-modal__container"},a.React$1.createElement("div",{className:"continuous-onboarding-modal__content-pane"},e),a.React$1.createElement("div",{className:"continuous-onboarding-modal__image-pane"},a.React$1.createElement(o.Image,{className:"continuous-onboarding-modal__image-pane__image",alt:l,src:i,srcHiRes:n}))));Me.displayName="SplitPaneModal",Me.displayName="SplitPaneModal";const fe=({preButtonText:e,isLoading:t,isError:s,onSubmit:i,onCancelClick:l,primaryCtaText:r})=>{const c=o.classnames({"continuous-onboarding-modal__footer__error-text":s});return a.React$1.createElement(o.Modal.Footer,{className:"continuous-onboarding-modal__footer"},e&&a.React$1.createElement(o.Text,{size:"small",isBold:!0,className:c},e),a.React$1.createElement("div",{className:"continuous-onboarding-modal__footer__button-group"},a.React$1.createElement(o.Button,{className:"continuous-onboarding-modal__cancel",variant:"opacity",onClick:l,disabled:t},n.intl.formatMessage({id:"YALbcv",defaultMessage:"Cancel"})),a.React$1.createElement(o.Button,{className:"continuous-onboarding-modal__submit",variant:"primary",onClick:i,isLoading:t,disabled:s},r)))};fe.displayName="SplitPaneModalFooter",fe.displayName="SplitPaneModalFooter";const Ae=({children:e})=>a.React$1.createElement("ul",{className:"continuous-onboarding-modal__feature-list"},e);Ae.displayName="IconBulletList",Ae.displayName="IconBulletList";const Oe=({text:e,iconSrc:t})=>a.React$1.createElement("li",{className:"continuous-onboarding-modal__icon-bullet"},a.React$1.createElement(o.UIIcon,{className:"continuous-onboarding-modal__icon-bullet__icon",src:t}),a.React$1.createElement(o.Text,{className:"continuous-onboarding-modal__icon-bullet__text"},e));Oe.displayName="IconBulletListItem",Oe.displayName="IconBulletListItem";const Ie=e=>a.React$1.createElement("b",{key:0},e),Ne=({userId:e,modalOpen:t,closeModal:s,markAsComplete:i,logger:l,moduleId:r,milestoneId:c})=>{a.React$1.useEffect((()=>{o.Modal.setAppElement(document.getElementById("embedded-app")||document.body)}),[]),((e,t,o,s)=>{a.React$1.useEffect((()=>{e&&t.logModalView(o,s)}),[e,t,o,s])})(t,l,r,c);const[d,m]=a.React$1.useState(!1),[u,_]=a.React$1.useState(!1),p=()=>{d||(l.logModalCancelClick(r,c),s())},{title:E,bulletOne:C,bulletTwo:h,bulletThree:R,splitPaneImageAlt:k,preButtonText:M,primaryCtaText:f,errorText:A}={title:n.intl.formatMessage({id:"9XdwOI",defaultMessage:"Try Dropbox Plus for passwords and more"}),bulletOne:n.intl.formatMessage({id:"rcbdKo",defaultMessage:"<bold>Sync your passwords</bold> and access them across devices"},{bold:Ie}),bulletTwo:n.intl.formatMessage({id:"b3FNKE",defaultMessage:"<bold>Sign into websites instantly</bold> with the browser extension"},{bold:Ie}),bulletThree:n.intl.formatMessage({id:"96hRce",defaultMessage:"<bold>Keep passwords encrypted</bold> to protect against hacks"},{bold:Ie}),primaryCtaText:n.intl.formatMessage({id:"qMMLEM",defaultMessage:"Get the app"}),preButtonText:n.intl.formatMessage({id:"I6hPTR",defaultMessage:"Get the Passwords app and start your 14-day trial"}),splitPaneImageAlt:n.intl.formatMessage({id:"sLvLeQ",defaultMessage:"Someone saves and syncs their Facebook account credentials across devices using Dropbox Passwords."}),errorText:n.intl.formatMessage({id:"Qry3+4",defaultMessage:"Unable to start your free trial"})},O={imageSrc:a.static_url("/static/metaserver/static/images/continuous_onboarding/passwords_sync_across_devices_desktop_1x-vflNY03Lm.gif"),imageSrcHiRes:a.static_url("/static/metaserver/static/images/continuous_onboarding/passwords_sync_across_devices_desktop_2x-vflxgvTNT.gif"),imageAlt:k};return a.React$1.createElement(Me,{open:t,onRequestClose:p,imageProps:O},a.React$1.createElement(o.Modal.Header,{hasBottomSpacing:"title-standard"},a.React$1.createElement(o.Title,null,E)),a.React$1.createElement(o.Modal.Body,null,a.React$1.createElement(Ae,null,a.React$1.createElement(Oe,{iconSrc:g.LockLine,text:C}),a.React$1.createElement(Oe,{iconSrc:b.PasswordsLine,text:h}),a.React$1.createElement(Oe,{iconSrc:y.ShieldLine,text:R}))),a.React$1.createElement(fe,{preButtonText:u?A:M,primaryCtaText:f,onCancelClick:p,onSubmit:()=>{m(!0),l.logModalCtaClick(r,c);(new o.UserApiV2Client).ns("growth").rpc("plus_npt_start",{trial_project_type:S.ProjectType.NCCT_PLUS_TRIALS},{subjectUserId:e}).then((()=>{l.logTrialStartSuccess(r,c),o.redirect("/getpasswords"),i({shouldOptimisticallyUpdate:!1}),setTimeout((()=>{o.reload()}),500)})).catch((e=>{l.logTrialStartError(r,c,e.summary),m(!1),_(!0)}))},isLoading:d,isError:u}))};Ne.displayName="PasswordsNptModal",Ne.displayName="PasswordsNptModal";const ve=e=>{const{module:{module_id:t,module_index:o},milestone:{milestone_id:s,milestone_type_props:i},logger:n,markAsComplete:l,onSkipClick:r,cardBodyAccessibilityProps:c,userId:d}=e,{does_cta_complete_milestone:m,description:u,image_url:_,image_url_hi_res:p,image_alt:g,cta_text:b,button_style:y,modal:S}=i,[E,C]=a.React$1.useState(!1),h=(e=>{if("passwords_npt"===e[".tag"])return Ne;throw new Error("Unknown modal type")})(S);return a.React$1.createElement(a.React$1.Fragment,null,a.React$1.createElement(de,{description:u,imageUrl:_,imageUrlHiRes:p,imageAlt:g,onCtaClick:()=>{n.logMilestoneCtaClick(t,s,{module_index:o}),m&&l(),C(!0)},onSkipClick:r,ctaText:b,primaryCtaStyle:y,cardBodyAccessibilityProps:c}),a.React$1.createElement(h,{userId:d,modalOpen:E,closeModal:()=>C(!1),markAsComplete:l,logger:n,moduleId:t,milestoneId:s}))};ve.displayName="ModalTypeCardBodyComponent",ve.displayName="ModalTypeCardBody";const Te=o.requireCssWithComponent(ve,["/static/metaserver/static/css/growth/continuous_onboarding/continuous_onboarding_modal-vfl0BtDE9.css"]),$e=e=>{const{milestone:t,module:o,implementationData:s,isActive:i,markMilestoneAsComplete:n,skipModule:l,userId:r,cardBodyAccessibilityProps:c,logger:d,isOpen:m}=e,{module_id:u,module_index:_,milestone_keys_allowing_module_skipping:p}=o,{milestone_id:g,milestone_key:b,milestone_type_props:y}=t;a.React$1.useEffect((()=>{i&&g&&m&&d.logMilestoneViewed(u,g,_)}),[i,g,d,u,_,m]);const S=p.includes(b)?()=>{d.logModuleSkipped(u,g,_),l()}:void 0,E=({shouldOptimisticallyUpdate:e=!0}={})=>{n(g,b,e)};if((e=>"link"===e[".tag"])(y))return a.React$1.createElement(ue,{milestone:t,module:o,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d});if((e=>"action"===e[".tag"])(y))return a.React$1.createElement(ge,{milestone:t,module:o,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d,userId:r});if((e=>"mobile_link"===e[".tag"])(y))return a.React$1.createElement(Ee,{milestone:t,module:o,implementationData:s,cardBodyAccessibilityProps:c,onSkipClick:S,logger:d});if((e=>"upload_content"===e[".tag"])(y))return a.React$1.createElement(he,{milestone:t,module:o,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d});if((e=>"client_deep_link"===e[".tag"])(y))return a.React$1.createElement(ke,{milestone:t,module:o,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d});if((e=>"modal"===e[".tag"])(y))return a.React$1.createElement(Te,{milestone:t,module:o,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d,userId:r});throw new Error(`Unknown milestone type: ${y[".tag"]}`)};$e.displayName="MilestoneCardBody",$e.displayName="MilestoneCardBody";const Be=e=>{const{module:t,implementationData:s,isActive:i,shouldImmediatelyExpandModule:l,setActive:r,markMilestoneAsComplete:c,skipModule:d,dismissCompletedModule:m,userId:u,logger:_,isOpen:p}=e,{module_id:g,next_incomplete_milestone:b,title:y,should_show:S}=t,E=!b;let C,h;if(void 0===b)C=a.React$1.createElement(me,{module:t,dismissCompletedModule:m,logger:_,isOpen:p}),h=a.React$1.createElement(o.IconButton,{variant:"transparent",className:"module-card__heading__dismiss-btn",onClick:()=>{m(),_.logModuleCompletedDismissed(g)}},a.React$1.createElement(o.UIIcon,{src:o.CloseLine,"aria-label":n.intl.formatMessage({id:"ZXDoHc",defaultMessage:"Dismiss completed module"})}));else{const e={"aria-hidden":!i,id:`content-${b.milestone_id}`};C=a.React$1.createElement($e,{milestone:b,module:t,implementationData:s,isActive:i,markMilestoneAsComplete:c,skipModule:d,userId:u,cardBodyAccessibilityProps:e,logger:_,isOpen:p}),h=a.React$1.createElement(o.IconButton,{id:`module-card-accordion-btn-${g}`,variant:"transparent",className:"module-card__heading__accordion-btn",onClick:()=>r(!i),"aria-controls":e.id,"aria-expanded":i,"aria-labelledby":`module-card-heading-${g}`},a.React$1.createElement(o.UIIcon,{src:i?o.ChevronUpLine:o.ChevronDownLine,"aria-label":i?n.intl.formatMessage({id:"DAPFIt",defaultMessage:"Collapse module"}):n.intl.formatMessage({id:"nOS+/t",defaultMessage:"Expand module"})}))}const R=o.classnames({"module-card":!0,[`module-card__${g}`]:!0,"module-card--isActive":E||i,"module-card--isActive--immediatelyExpand":l,"module-card--isHidden":!S});return a.React$1.createElement("li",{className:R,"aria-hidden":!S},a.React$1.createElement("div",{className:"module-card__heading"},a.React$1.createElement("div",{className:"module-card__heading__title-container"},a.React$1.createElement(o.Text,{id:`module-card-heading-${g}`,className:"module-card__heading__title-text",tagName:"h3",isBold:!0},y)),h),C)};Be.displayName="ModuleCardNoCss",Be.displayName="ModuleCard";const we=o.requireCssWithComponent(Be,["/static/metaserver/static/css/growth/continuous_onboarding/module_card-vflhO8I1R.css"]),xe=({userId:e,dispatch:t,modules:s,implementationData:i,activeModuleId:n,logger:l,isOpen:r})=>{const c=function(e){const t=a.React$1.useRef();return a.React$1.useEffect((()=>{t.current=e})),t.current}(n),{isScrolled:d,handleScroll:m}=(()=>{const[e,t]=a.React$1.useState(!1);return{isScrolled:e,handleScroll:e=>{t(e.currentTarget.scrollTop>0)}}})(),u=o.classnames({"continuous-onboarding__card-container":!0,"continuous-onboarding__card-container--is-scrolled":d});return a.React$1.createElement("ul",{className:u,onScroll:m},s.map((s=>{const d=s.module_id===n;return a.React$1.createElement(we,{key:s.module_id,userId:e,module:s,implementationData:i,isActive:d,shouldImmediatelyExpandModule:d&&null===c,setActive:e=>t({type:Q.SET_ACTIVE_MODULE,activeModuleId:e?s.module_id:null}),markMilestoneAsComplete:(a,s,i=!0)=>{o.markModuleAsCompleted(e,a),i&&t({type:Q.SET_MILESTONE_COMPLETE,milestoneKey:s})},skipModule:()=>{o.markModuleAsCompleted(e,s.skip_string),t({type:Q.HIDE_MODULE,module_id:s.module_id})},dismissCompletedModule:()=>{o.markModuleAsCompleted(e,s.dismiss_string),t({type:Q.HIDE_MODULE,module_id:s.module_id})},logger:l,isOpen:r})})))};xe.displayName="ModuleCardList",xe.displayName="ModuleCardList";const Le=a.React$1.forwardRef((({isOpen:e,title:t,handleOpen:s},i)=>{const l=n.intl.formatMessage({id:"xIG5bM",defaultMessage:"Open sidebar ({title})"},{title:t});return a.React$1.createElement("button",{className:"continuous-onboarding__open-btn","aria-label":l,"aria-hidden":e,id:"continuous-onboarding-expand-btn",onClick:s,"aria-expanded":!1,"aria-controls":"continuous-onboarding-container",ref:i},a.React$1.createElement("div",{className:"continuous-onboarding__open-btn__container"},a.React$1.createElement(o.Title,{className:"continuous-onboarding__open-btn__text",size:"small",isBold:!0},t),a.React$1.createElement(o.UIIcon,{className:"continuous-onboarding__open-btn__icon",src:E.ExpandLeftLine,"aria-hidden":!0})))}));Le.displayName="SidebarExpandBar",Le.displayName="SidebarExpandBar";const De=a.React$1.forwardRef((({title:e,handleCollapse:t},s)=>a.React$1.createElement("div",{className:"continuous-onboarding__heading"},a.React$1.createElement(o.Title,{className:"continuous-onboarding__heading__text",size:"small",isBold:!0},e),t&&a.React$1.createElement(o.IconButton,{id:"continuous-onboarding-collapse-btn",variant:"transparent",className:"continuous-onboarding__heading__collapse-btn",onClick:t,"aria-expanded":!0,"aria-controls":"continuous-onboarding-container",ref:s},a.React$1.createElement(o.UIIcon,{src:o.CloseLine,"aria-label":n.intl.formatMessage({id:"HI573A",defaultMessage:"Collapse sidebar"})})))));De.displayName="SidebarHeader",De.displayName="SidebarHeader";class je extends a.React$1.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){this.props.onExpandChange&&this.props.onExpandChange(!1),s.reportException({err:e,severity:C.SEVERITY.CRITICAL,tags:["continuous_onboarding_web"],exc_extra:{component_stacktrace:t&&t.componentStack}})}render(){return this.state.hasError?null:a.React$1.createElement(Pe,Object.assign({},this.props))}}je.displayName="ContinuousOnboardingErrorBoundary";const Ue="basic_plan_reonboarding_user_progression",Pe=a.React$1.memo((({userId:e,isBackgroundActive:t,onExpandChange:s})=>{const n=a.React$1.useRef(new Se).current,l=a.react.exports.useRef(null),r=a.react.exports.useRef(null),c=a.react.exports.useRef(!1),d=a.react.exports.useRef(!1),[m,u]=a.React$1.useReducer(J,X),{isOpen:_,activeModuleId:p,showOpenButtonWhenCollapsed:g,progression:b,display_surface_props:y,showCompletedState:S}=m;if(((e,t,o,s)=>{const[n,l]=a.React$1.useState(null);a.React$1.useEffect((()=>{i.is_supported_mobile_browser()||te(o,(({progression:a,display_surface_props:s,bolt_channel_states:i})=>{if("basic_welcome_user_progression"===(null==a?void 0:a.progression_id))return;if(!a||!a.module_ids.length)return;const n=s;Y(a,o);const r=ae(e,t,o,i);if(t({type:Q.SET_SIDEBAR,progression:a,display_surface_props:n,bolt_channel_states:i}),e.setProject(a.progression_id),e.logTimeToApiResponse(),n.open_on_load&&a.module_ids.length){const e=setTimeout((()=>{t({type:Q.OPEN_SIDEBAR}),l(null)}),500);l(e)}return()=>{r&&r.unsubscribe()}}))}),[]),a.React$1.useEffect((()=>{n&&s&&(t({type:Q.FORCE_CLOSE}),clearTimeout(n),l(null))}),[s,n])})(n,u,e,t),((e,t,o)=>{a.React$1.useEffect((()=>{if(void 0!==o){let a;o?(a=Q.FORCE_CLOSE,e.logSidebarAutoCollapsed()):(a=Q.REOPEN_IF_CLOSED_BY_ACTIVE_BACKGROUND,e.logSidebarAutoExpanded()),t({type:a})}}),[o])})(n,u,t),((e,t,o)=>{oe(e,"logSidebarViewed",t),a.React$1.useEffect((()=>{o&&o(t)}),[t,o])})(n,_,s),!y||!b)return null;const E=(e=>{const{module_ids:t,module_map:a,milestone_map:o}=e,s=t.map(((e,t)=>Object.assign(Object.assign({},a[e]),{milestones:[],module_index:t})));return s.forEach((e=>{e.milestones=e.milestone_keys.map((e=>o[e])),e.next_incomplete_milestone=(e=>{for(let t=e.length-1;t>=0;t--)if(e[t].is_completed)return e[t+1];return e[0]})(e.milestones)})),s})(b),C=!_&&!g,h=(null==b?void 0:b.progression_id)===Ue;return a.React$1.createElement("aside",{className:o.classnames({"continuous-onboarding":!0,"continuous-onboarding--open":_}),"aria-hidden":C,onTransitionEnd:()=>{if(d.current||c.current)return d.current?(d.current=!1,void(l.current&&l.current.focus())):void(c.current&&(c.current=!1,r.current&&r.current.focus()))}},g&&a.React$1.createElement(Le,{isOpen:_,title:y.collapsed_title,handleOpen:()=>{n.logSidebarManuallyExpanded(),o.setUserMetadata({CONTINUOUS_ONBOARDING_IS_COLLAPSED:!1},e),u({type:Q.OPEN_SIDEBAR}),d.current=!0},ref:r}),a.React$1.createElement("div",{id:"continuous-onboarding-container",className:"continuous-onboarding__container","aria-hidden":!_},a.React$1.createElement(De,{title:y.expanded_title,handleCollapse:S?void 0:()=>{n.logSidebarManuallyCollapsed(),o.setUserMetadata({CONTINUOUS_ONBOARDING_IS_COLLAPSED:!0},e),u({type:Q.CLOSE_SIDEBAR}),c.current=!0},ref:l}),a.React$1.createElement(xe,{userId:e,modules:E,implementationData:b.implementation_data,dispatch:u,activeModuleId:p,logger:n,isOpen:_}),!S&&h&&a.React$1.createElement("div",{className:"continuous-onboarding__dismiss-button"},a.React$1.createElement(o.Button,{variant:"transparent",onClick:()=>{n.logSidebarNonEmptyStateDismissed(),function(e){const t=K.DISMISS_BTN;new z(e).track(t)}(e),u({type:Q.HIDE_SIDEBAR})}},y.empty_state_props.dismiss_button_text)),a.React$1.createElement(se,{isSidebarComplete:S,handleHideSidebar:()=>u({type:Q.HIDE_SIDEBAR}),emptyStateProps:y.empty_state_props,logger:n})))}));Pe.displayName="ContinuousOnboardingNoCss",Pe.displayName="ContinuousOnboarding";const Fe=o.requireCssWithComponent(je,["/static/metaserver/static/css/growth/continuous_onboarding/continuous_onboarding-vfld6LLGP.css"]);t.ContinuousOnboarding=Fe,t.ContinuousOnboardingErrorBoundary=je,t.ContinuousOnboardingNoCss=Pe,t.REONBARDING_PROGRESSION_ID=Ue}));
//# sourceMappingURL=c_continuous_onboarding.js-vflMStBQk.map
