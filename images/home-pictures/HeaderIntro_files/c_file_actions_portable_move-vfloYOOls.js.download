define(["require","exports","./c_tslib","./c_src_sink_index","./c_apex-metrics_src_types","./c_files_view_file_actions_file_from_metadata","./c_hive_schemas_web-modal-activity","./c_ui_fileops_actions","./e_ui_page_files_router","./c_action_bar_file_actions_logging"],(function(e,o,t,n,a,i,r,s,c,_){"use strict";function d(o){new Promise((function(o,t){e(["./c_folder_dialog_move_dialog_modal"],o,t)})).then((({MoveDialogModal:e})=>e.show(o)))}function l(o,n,a,i,r,s){return t.__awaiter(this,void 0,void 0,(function*(){const{showOverquota:t}=yield new Promise((function(o,t){e(["./c_overquota_overquota_modal_controller"],o,t)}));t({oqa:o,tagline:r,headline:s,nsId:n,activeUserId:a,origin:i})}))}function u(e){return{class:"previews",action:"move",object:"file",properties:e}}const m=({currentFQPath:e,exceptions:o,filesPath:m,source:g,user:v,createNewFolderInMoveDialog:h,nsId:S,extraForLogging:f},p={})=>t.__awaiter(void 0,void 0,void 0,(function*(){if(o.isOverFreeQuota&&!o.hasExcludedNsIds)return void l("wb_oq_mv_cp",S,v.id,c.SHARE_ACTION_ORIGIN_TYPE.BROWSE_MOVE_ACTION);const t=m.reduce(((e,o)=>e+(o.is_dir?0:1)),0),I=m.reduce(((e,o)=>e+(o.is_dir?1:0)),0),M=n.getMetricsReporter$1(),E={surface:g,batchSizeBucket:i.bucketForBatchSize(m.length),contentType:i.batchContentType(m)},A={totalLatency:M.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/latency_total_ms"},E),averageLatency:M.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/latency_average_ms"},E),completed:M.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/completed"},E),started:M.createCounter({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/started"},E),succeeded:M.createCounter({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/status"},Object.assign(Object.assign({},E),{status:"success"}))};let C;const w=(e,o)=>{var t;if(C){const e=C.success(o);A.totalLatency.recordDuration(e,a.TimeUnit.MILLISECONDS),A.averageLatency.recordDuration(e/m.length,a.TimeUnit.MILLISECONDS),A.completed.record(1),A.succeeded.increment(1),A.succeeded.record()}null===(t=p.onSuccess)||void 0===t||t.call(p,e)},O=e=>{var o;if(C){const o=C.failed(e);A.totalLatency.recordDuration(o,a.TimeUnit.MILLISECONDS),A.averageLatency.recordDuration(o/m.length,a.TimeUnit.MILLISECONDS),"internal_error"!==e&&A.completed.record(0);const t=M.createCounter({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/status"},Object.assign(Object.assign({},E),{status:e}));t.increment(1),t.record()}null===(o=p.onError)||void 0===o||o.call(p)},P=p.onUndo;A.started.increment(1),A.started.record();d({operation:c.Operation.MOVE,modalName:r.ModalName.MOVE,user:v,apiClient:{moveToFolder:(o,n,a)=>(C=_.startFileActionLogging(u,Object.assign({actionSurface:g,numFiles:t,numFolders:I},f)),s.moveFiles({user:v,files:m,path:"browse"===g?e:void 0,onSuccess:w,onUndo:P,onError:O,newPath:o,checkFSWs:!0,isLockedVaultFolder:a,actionId:C.actionId}),Promise.resolve()),getFolderContents:c.Viewer.get_viewer().is_team_assume_user_session?c.getFolderContents:c.getFolderContentsAPIv2,getFolderSuggestion:c.getFolderSuggestion},entries:m,initialFolderSelection:e,onSuccess:()=>{},onCancel:()=>{},showFolderSuggestion:!0,createNewFolderInMoveDialog:h})}));var g=Object.freeze({__proto__:null,portableMove:m});o.move_esnext=g,o.portableMove=m,o.showMoveDialog=d,o.showNamingConventionsModal=function(o){new Promise((function(o,t){e(["./c_naming_conventions_naming_conventions_modal"],o,t)})).then((({showNamingConventionsModal:e})=>e(o)))},o.showOverquota=l,o.showTidyUpDialog=function(o){new Promise((function(o,t){e(["./c_tidy_up_modal_tidy_up_modal"],o,t)})).then((({showTidyUpModal:e})=>e(o)))},o.showUpgradeProductPlanModal=function(o){new Promise((function(o,t){e(["./c_components_modals_upgrade_plan_modal"],o,t)})).then((({showUpgradeProductPlanModal:e})=>e(o)))}}));
//# sourceMappingURL=c_file_actions_portable_move.js-vflSaeRRR.map
